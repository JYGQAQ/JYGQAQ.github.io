<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>Nettyå­¦ä¹ </title>
    <link href="/2023/05/03/Netty%E5%AD%A6%E4%B9%A0/"/>
    <url>/2023/05/03/Netty%E5%AD%A6%E4%B9%A0/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸€-NIO-åŸºç¡€"><a href="#ä¸€-NIO-åŸºç¡€" class="headerlink" title="ä¸€. NIO åŸºç¡€"></a>ä¸€. NIO åŸºç¡€</h1><p>non-blocking io éé˜»å¡ IO</p><h2 id="1-ä¸‰å¤§ç»„ä»¶"><a href="#1-ä¸‰å¤§ç»„ä»¶" class="headerlink" title="1. ä¸‰å¤§ç»„ä»¶"></a>1. ä¸‰å¤§ç»„ä»¶</h2><h3 id="1-1-Channel-amp-Buffer"><a href="#1-1-Channel-amp-Buffer" class="headerlink" title="1.1 Channel &amp; Buffer"></a>1.1 Channel &amp; Buffer</h3><p>channel æœ‰ä¸€ç‚¹ç±»ä¼¼äº streamï¼Œå®ƒå°±æ˜¯è¯»å†™æ•°æ®çš„<strong>åŒå‘é€šé“</strong>ï¼Œå¯ä»¥ä» channel å°†æ•°æ®è¯»å…¥ bufferï¼Œä¹Ÿå¯ä»¥å°† buffer çš„æ•°æ®å†™å…¥ channelï¼Œè€Œä¹‹å‰çš„ stream è¦ä¹ˆæ˜¯è¾“å…¥ï¼Œè¦ä¹ˆæ˜¯è¾“å‡ºï¼Œchannel æ¯” stream æ›´ä¸ºåº•å±‚</p><pre><code class=" mermaid">graph LRchannel --&gt; bufferbuffer --&gt; channel</code></pre><p>å¸¸è§çš„ Channel æœ‰</p><ul><li>FileChannel</li><li>DatagramChannel</li><li>SocketChannel</li><li>ServerSocketChannel</li></ul><p>buffer åˆ™ç”¨æ¥ç¼“å†²è¯»å†™æ•°æ®ï¼Œå¸¸è§çš„ buffer æœ‰</p><ul><li>ByteBufferï¼ˆæŠ½è±¡ç±»ï¼‰<ul><li>MappedByteBufferï¼ˆå®ç°ç±»ï¼‰</li><li>DirectByteBufferï¼ˆå®ç°ç±»ï¼‰</li><li>HeapByteBufferï¼ˆå®ç°ç±»ï¼‰</li></ul></li><li>ShortBuffer</li><li>IntBuffer</li><li>LongBuffer</li><li>FloatBuffer</li><li>DoubleBuffer</li><li>CharBuffer</li></ul><h3 id="1-2-Selector"><a href="#1-2-Selector" class="headerlink" title="1.2 Selector"></a>1.2 Selector</h3><p>selector å•ä»å­—é¢æ„æ€ä¸å¥½ç†è§£ï¼Œéœ€è¦ç»“åˆæœåŠ¡å™¨çš„è®¾è®¡æ¼”åŒ–æ¥ç†è§£å®ƒçš„ç”¨é€”</p><h4 id="å¤šçº¿ç¨‹ç‰ˆè®¾è®¡"><a href="#å¤šçº¿ç¨‹ç‰ˆè®¾è®¡" class="headerlink" title="å¤šçº¿ç¨‹ç‰ˆè®¾è®¡"></a>å¤šçº¿ç¨‹ç‰ˆè®¾è®¡</h4><p>ä¸€ä¸ªè¿æ¥ä¸€ä¸ªçº¿ç¨‹ï¼ŒBIOï¼ˆé˜»å¡IOï¼‰è®¾è®¡ã€‚</p><pre><code class=" mermaid">graph TDsubgraph å¤šçº¿ç¨‹ç‰ˆt1(thread) --&gt; s1(socket1)t2(thread) --&gt; s2(socket2)t3(thread) --&gt; s3(socket3)end</code></pre><h4 id="âš ï¸-å¤šçº¿ç¨‹ç‰ˆç¼ºç‚¹"><a href="#âš ï¸-å¤šçº¿ç¨‹ç‰ˆç¼ºç‚¹" class="headerlink" title="âš ï¸ å¤šçº¿ç¨‹ç‰ˆç¼ºç‚¹"></a>âš ï¸ å¤šçº¿ç¨‹ç‰ˆç¼ºç‚¹</h4><ul><li>å†…å­˜å ç”¨é«˜ï¼Œæ¯ä¸ªçº¿ç¨‹éœ€è¦å ç”¨ä¸€å®šçš„å†…å­˜ï¼Œå¤šä¸ªçº¿ç¨‹å ç”¨å†…å­˜è¿‡å¤š</li><li>çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢æˆæœ¬é«˜ï¼ˆå¦‚æœä¸€ä¸ªæœåŠ¡å™¨åªæœ‰16æ ¸ï¼Œå¦‚æœæœ‰å¤šä½™16ä¸ªçº¿ç¨‹åŒæ—¶åœ¨è¿è¡Œï¼Œé‚£ä¹ˆè¿™å¤šä¸ªçº¿ç¨‹é¢‘ç¹åˆ‡æ¢ï¼Œæ‰€å¸¦æ¥çš„çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢æˆæœ¬è¿‡é«˜ï¼‰</li><li>åªé€‚åˆè¿æ¥æ•°å°‘çš„åœºæ™¯</li></ul><h4 id="çº¿ç¨‹æ± ç‰ˆè®¾è®¡"><a href="#çº¿ç¨‹æ± ç‰ˆè®¾è®¡" class="headerlink" title="çº¿ç¨‹æ± ç‰ˆè®¾è®¡"></a>çº¿ç¨‹æ± ç‰ˆè®¾è®¡</h4><pre><code class=" mermaid">graph TDsubgraph çº¿ç¨‹æ± ç‰ˆt4(thread) --&gt; s4(socket1)t5(thread) --&gt; s5(socket2)t4(thread) -.-&gt; s6(socket3)t5(thread) -.-&gt; s7(socket4)end</code></pre><h4 id="âš ï¸-çº¿ç¨‹æ± ç‰ˆç¼ºç‚¹"><a href="#âš ï¸-çº¿ç¨‹æ± ç‰ˆç¼ºç‚¹" class="headerlink" title="âš ï¸ çº¿ç¨‹æ± ç‰ˆç¼ºç‚¹"></a>âš ï¸ çº¿ç¨‹æ± ç‰ˆç¼ºç‚¹</h4><ul><li>é˜»å¡æ¨¡å¼ä¸‹ï¼Œä¸€ä¸ªçº¿ç¨‹åŒä¸€æ—¶é—´å†…ä»…èƒ½å¤„ç†ä¸€ä¸ª socket è¿æ¥ï¼ˆå³ä¸€ä¸ªçº¿ç¨‹ï¼Œåªæœ‰ç­‰åˆ°å½“å‰<code>socket</code>è¿æ¥æ–­å¼€ä»¥åï¼Œæ‰èƒ½å¤„ç†ä¸‹ä¸€ä¸ª<code>socket</code>è¿æ¥ï¼‰</li><li>ä»…é€‚åˆçŸ­è¿æ¥åœºæ™¯ï¼ˆæ‰€ä»¥æ—©æœŸæœåŠ¡å™¨ï¼ˆæ¯”å¦‚ï¼šæ—©æœŸTomcatæœåŠ¡å™¨ï¼‰éƒ½æ˜¯çŸ­è¿æ¥ï¼Œåœ¨å¤„ç†å®Œä¸€é¡¹ä¸šåŠ¡åï¼Œèµ¶ç´§æ–­å¼€<code>socket</code>è¿æ¥ï¼Œé‡Šæ”¾å½“å‰çº¿ç¨‹ï¼Œè®©å½“å‰çº¿ç¨‹å»å¤„ç†å…¶ä»–ä¸šåŠ¡ï¼‰</li><li>æ€»è€Œè¨€ä¹‹ï¼Œç”±äº<code>socket</code>æ˜¯é˜»å¡IOï¼Œå¯¼è‡´çº¿ç¨‹çš„åˆ©ç”¨ç‡ä¸é«˜</li></ul><h4 id="selector-ç‰ˆè®¾è®¡"><a href="#selector-ç‰ˆè®¾è®¡" class="headerlink" title="selector ç‰ˆè®¾è®¡"></a>selector ç‰ˆè®¾è®¡</h4><p>selector çš„ä½œç”¨å°±æ˜¯é…åˆä¸€ä¸ªçº¿ç¨‹æ¥ç®¡ç†å¤šä¸ª channelï¼Œè·å–è¿™äº› channel ä¸Šå‘ç”Ÿçš„äº‹ä»¶ï¼Œè¿™äº› channel å·¥ä½œåœ¨<strong>éé˜»å¡æ¨¡å¼</strong>ä¸‹ï¼Œä¸ä¼šè®©çº¿ç¨‹åŠæ­»åœ¨ä¸€ä¸ª channel ä¸Šã€‚é€‚åˆ<strong>è¿æ¥æ•°ç‰¹åˆ«å¤š</strong>ï¼Œä½†<strong>æµé‡ä½</strong>çš„åœºæ™¯ï¼ˆlow trafficï¼‰</p><pre><code class=" mermaid">graph TDsubgraph selector ç‰ˆthread --&gt; selectorselector --&gt; c1(channel)selector --&gt; c2(channel)selector --&gt; c3(channel)end</code></pre><p>è°ƒç”¨ selector çš„ select() ä¼šé˜»å¡ç›´åˆ° channel å‘ç”Ÿäº†è¯»å†™å°±ç»ªäº‹ä»¶ï¼Œè¿™äº›äº‹ä»¶å‘ç”Ÿï¼Œselect æ–¹æ³•å°±ä¼šè¿”å›è¿™äº›äº‹ä»¶äº¤ç»™ thread æ¥å¤„ç†ã€‚</p><h2 id="2-ByteBuffer"><a href="#2-ByteBuffer" class="headerlink" title="2. ByteBuffer"></a>2. ByteBuffer</h2><p>æœ‰ä¸€æ™®é€šæ–‡æœ¬æ–‡ä»¶ data.txtï¼Œå†…å®¹ä¸º</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">1234567890abcd<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨ FileChannel æ¥è¯»å–æ–‡ä»¶å†…å®¹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ChannelDemo1</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> (RandomAccessFile file = <span class="hljs-keyword">new</span> RandomAccessFile(<span class="hljs-string">&quot;helloword/data.txt&quot;</span>, <span class="hljs-string">&quot;rw&quot;</span>)) &#123;<br>            FileChannel channel = file.getChannel();<br>            ByteBuffer buffer = ByteBuffer.allocate(<span class="hljs-number">10</span>);<br>            <span class="hljs-keyword">do</span> &#123;<br>                <span class="hljs-comment">// å‘ buffer å†™å…¥</span><br>                <span class="hljs-keyword">int</span> len = channel.read(buffer);<br>                log.debug(<span class="hljs-string">&quot;è¯»åˆ°å­—èŠ‚æ•°ï¼š&#123;&#125;&quot;</span>, len);<br>                <span class="hljs-keyword">if</span> (len == -<span class="hljs-number">1</span>) &#123;<br>                    <span class="hljs-keyword">break</span>;<br>                &#125;<br>                <span class="hljs-comment">// åˆ‡æ¢ buffer è¯»æ¨¡å¼</span><br>                buffer.flip();<br>                <span class="hljs-keyword">while</span>(buffer.hasRemaining()) &#123;<br>                    log.debug(<span class="hljs-string">&quot;&#123;&#125;&quot;</span>, (<span class="hljs-keyword">char</span>)buffer.get());<br>                &#125;<br>                <span class="hljs-comment">// åˆ‡æ¢ buffer å†™æ¨¡å¼</span><br>                buffer.clear();<br>            &#125; <span class="hljs-keyword">while</span> (<span class="hljs-keyword">true</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-number">10</span>:<span class="hljs-number">39</span>:<span class="hljs-number">03</span> <span class="hljs-selector-attr">[DEBUG]</span> <span class="hljs-selector-attr">[main]</span> c<span class="hljs-selector-class">.i</span><span class="hljs-selector-class">.n</span><span class="hljs-selector-class">.ChannelDemo1</span> - è¯»åˆ°å­—èŠ‚æ•°ï¼š<span class="hljs-number">10</span><br><span class="hljs-number">10</span>:<span class="hljs-number">39</span>:<span class="hljs-number">03</span> <span class="hljs-selector-attr">[DEBUG]</span> <span class="hljs-selector-attr">[main]</span> c<span class="hljs-selector-class">.i</span><span class="hljs-selector-class">.n</span><span class="hljs-selector-class">.ChannelDemo1</span> - <span class="hljs-number">1</span><br><span class="hljs-number">10</span>:<span class="hljs-number">39</span>:<span class="hljs-number">03</span> <span class="hljs-selector-attr">[DEBUG]</span> <span class="hljs-selector-attr">[main]</span> c<span class="hljs-selector-class">.i</span><span class="hljs-selector-class">.n</span><span class="hljs-selector-class">.ChannelDemo1</span> - <span class="hljs-number">2</span><br><span class="hljs-number">10</span>:<span class="hljs-number">39</span>:<span class="hljs-number">03</span> <span class="hljs-selector-attr">[DEBUG]</span> <span class="hljs-selector-attr">[main]</span> c<span class="hljs-selector-class">.i</span><span class="hljs-selector-class">.n</span><span class="hljs-selector-class">.ChannelDemo1</span> - <span class="hljs-number">3</span><br><span class="hljs-number">10</span>:<span class="hljs-number">39</span>:<span class="hljs-number">03</span> <span class="hljs-selector-attr">[DEBUG]</span> <span class="hljs-selector-attr">[main]</span> c<span class="hljs-selector-class">.i</span><span class="hljs-selector-class">.n</span><span class="hljs-selector-class">.ChannelDemo1</span> - <span class="hljs-number">4</span><br><span class="hljs-number">10</span>:<span class="hljs-number">39</span>:<span class="hljs-number">03</span> <span class="hljs-selector-attr">[DEBUG]</span> <span class="hljs-selector-attr">[main]</span> c<span class="hljs-selector-class">.i</span><span class="hljs-selector-class">.n</span><span class="hljs-selector-class">.ChannelDemo1</span> - <span class="hljs-number">5</span><br><span class="hljs-number">10</span>:<span class="hljs-number">39</span>:<span class="hljs-number">03</span> <span class="hljs-selector-attr">[DEBUG]</span> <span class="hljs-selector-attr">[main]</span> c<span class="hljs-selector-class">.i</span><span class="hljs-selector-class">.n</span><span class="hljs-selector-class">.ChannelDemo1</span> - <span class="hljs-number">6</span><br><span class="hljs-number">10</span>:<span class="hljs-number">39</span>:<span class="hljs-number">03</span> <span class="hljs-selector-attr">[DEBUG]</span> <span class="hljs-selector-attr">[main]</span> c<span class="hljs-selector-class">.i</span><span class="hljs-selector-class">.n</span><span class="hljs-selector-class">.ChannelDemo1</span> - <span class="hljs-number">7</span><br><span class="hljs-number">10</span>:<span class="hljs-number">39</span>:<span class="hljs-number">03</span> <span class="hljs-selector-attr">[DEBUG]</span> <span class="hljs-selector-attr">[main]</span> c<span class="hljs-selector-class">.i</span><span class="hljs-selector-class">.n</span><span class="hljs-selector-class">.ChannelDemo1</span> - <span class="hljs-number">8</span><br><span class="hljs-number">10</span>:<span class="hljs-number">39</span>:<span class="hljs-number">03</span> <span class="hljs-selector-attr">[DEBUG]</span> <span class="hljs-selector-attr">[main]</span> c<span class="hljs-selector-class">.i</span><span class="hljs-selector-class">.n</span><span class="hljs-selector-class">.ChannelDemo1</span> - <span class="hljs-number">9</span><br><span class="hljs-number">10</span>:<span class="hljs-number">39</span>:<span class="hljs-number">03</span> <span class="hljs-selector-attr">[DEBUG]</span> <span class="hljs-selector-attr">[main]</span> c<span class="hljs-selector-class">.i</span><span class="hljs-selector-class">.n</span><span class="hljs-selector-class">.ChannelDemo1</span> - <span class="hljs-number">0</span><br><span class="hljs-number">10</span>:<span class="hljs-number">39</span>:<span class="hljs-number">03</span> <span class="hljs-selector-attr">[DEBUG]</span> <span class="hljs-selector-attr">[main]</span> c<span class="hljs-selector-class">.i</span><span class="hljs-selector-class">.n</span><span class="hljs-selector-class">.ChannelDemo1</span> - è¯»åˆ°å­—èŠ‚æ•°ï¼š<span class="hljs-number">4</span><br><span class="hljs-number">10</span>:<span class="hljs-number">39</span>:<span class="hljs-number">03</span> <span class="hljs-selector-attr">[DEBUG]</span> <span class="hljs-selector-attr">[main]</span> c<span class="hljs-selector-class">.i</span><span class="hljs-selector-class">.n</span><span class="hljs-selector-class">.ChannelDemo1</span> - <span class="hljs-selector-tag">a</span><br><span class="hljs-number">10</span>:<span class="hljs-number">39</span>:<span class="hljs-number">03</span> <span class="hljs-selector-attr">[DEBUG]</span> <span class="hljs-selector-attr">[main]</span> c<span class="hljs-selector-class">.i</span><span class="hljs-selector-class">.n</span><span class="hljs-selector-class">.ChannelDemo1</span> - <span class="hljs-selector-tag">b</span><br><span class="hljs-number">10</span>:<span class="hljs-number">39</span>:<span class="hljs-number">03</span> <span class="hljs-selector-attr">[DEBUG]</span> <span class="hljs-selector-attr">[main]</span> c<span class="hljs-selector-class">.i</span><span class="hljs-selector-class">.n</span><span class="hljs-selector-class">.ChannelDemo1</span> - c<br><span class="hljs-number">10</span>:<span class="hljs-number">39</span>:<span class="hljs-number">03</span> <span class="hljs-selector-attr">[DEBUG]</span> <span class="hljs-selector-attr">[main]</span> c<span class="hljs-selector-class">.i</span><span class="hljs-selector-class">.n</span><span class="hljs-selector-class">.ChannelDemo1</span> - d<br><span class="hljs-number">10</span>:<span class="hljs-number">39</span>:<span class="hljs-number">03</span> <span class="hljs-selector-attr">[DEBUG]</span> <span class="hljs-selector-attr">[main]</span> c<span class="hljs-selector-class">.i</span><span class="hljs-selector-class">.n</span><span class="hljs-selector-class">.ChannelDemo1</span> - è¯»åˆ°å­—èŠ‚æ•°ï¼š-<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><h3 id="2-1-ByteBuffer-æ­£ç¡®ä½¿ç”¨å§¿åŠ¿"><a href="#2-1-ByteBuffer-æ­£ç¡®ä½¿ç”¨å§¿åŠ¿" class="headerlink" title="2.1  ByteBuffer æ­£ç¡®ä½¿ç”¨å§¿åŠ¿"></a>2.1  ByteBuffer æ­£ç¡®ä½¿ç”¨å§¿åŠ¿</h3><ol><li>å‘ buffer å†™å…¥æ•°æ®ï¼Œä¾‹å¦‚è°ƒç”¨ channel.read(buffer)</li><li>è°ƒç”¨ flip() åˆ‡æ¢è‡³<strong>è¯»æ¨¡å¼</strong></li><li>ä» buffer è¯»å–æ•°æ®ï¼Œä¾‹å¦‚è°ƒç”¨ buffer.get()</li><li>è°ƒç”¨ clear() æˆ– compact() åˆ‡æ¢è‡³<strong>å†™æ¨¡å¼</strong></li><li>é‡å¤ 1~4 æ­¥éª¤</li></ol><h3 id="2-2-ByteBuffer-ç»“æ„"><a href="#2-2-ByteBuffer-ç»“æ„" class="headerlink" title="2.2 ByteBuffer ç»“æ„"></a>2.2 ByteBuffer ç»“æ„</h3><p>ByteBuffer æœ‰ä»¥ä¸‹é‡è¦å±æ€§</p><ul><li>capacity</li><li>position</li><li>limit</li></ul><p>ä¸€å¼€å§‹</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/0021.png"></p><p>å†™æ¨¡å¼ä¸‹ï¼Œposition æ˜¯å†™å…¥ä½ç½®ï¼Œlimit ç­‰äºå®¹é‡ï¼Œä¸‹å›¾è¡¨ç¤ºå†™å…¥äº† 4 ä¸ªå­—èŠ‚åçš„çŠ¶æ€</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/0018.png"></p><p>flip åŠ¨ä½œå‘ç”Ÿåï¼Œposition åˆ‡æ¢ä¸ºè¯»å–ä½ç½®ï¼Œlimit åˆ‡æ¢ä¸ºè¯»å–é™åˆ¶</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/0019.png"></p><p>è¯»å– 4 ä¸ªå­—èŠ‚åï¼ŒçŠ¶æ€</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/0020.png"></p><p>clear åŠ¨ä½œå‘ç”Ÿåï¼ŒçŠ¶æ€:ï¼ˆ<strong>clearåŠ¨ä½œå¹¶ä¸ä¼šæ¸…æ¥šæ•°æ®ï¼Œåªæ˜¯ç§»åŠ¨äº†Positionå’ŒLimitæŒ‡é’ˆ</strong>ï¼‰</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/3124123412342.png"></p><p>compact æ–¹æ³•ï¼Œæ˜¯æŠŠæœªè¯»å®Œçš„éƒ¨åˆ†å‘å‰å‹ç¼©ï¼Œç„¶ååˆ‡æ¢è‡³å†™æ¨¡å¼</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/0022.png"></p><h4 id="ğŸ’¡-è°ƒè¯•å·¥å…·ç±»"><a href="#ğŸ’¡-è°ƒè¯•å·¥å…·ç±»" class="headerlink" title="ğŸ’¡ è°ƒè¯•å·¥å…·ç±»"></a>ğŸ’¡ è°ƒè¯•å·¥å…·ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ByteBufferUtil</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">char</span>[] BYTE2CHAR = <span class="hljs-keyword">new</span> <span class="hljs-keyword">char</span>[<span class="hljs-number">256</span>];<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">char</span>[] HEXDUMP_TABLE = <span class="hljs-keyword">new</span> <span class="hljs-keyword">char</span>[<span class="hljs-number">256</span> * <span class="hljs-number">4</span>];<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String[] HEXPADDING = <span class="hljs-keyword">new</span> String[<span class="hljs-number">16</span>];<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String[] HEXDUMP_ROWPREFIXES = <span class="hljs-keyword">new</span> String[<span class="hljs-number">65536</span> &gt;&gt;&gt; <span class="hljs-number">4</span>];<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String[] BYTE2HEX = <span class="hljs-keyword">new</span> String[<span class="hljs-number">256</span>];<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String[] BYTEPADDING = <span class="hljs-keyword">new</span> String[<span class="hljs-number">16</span>];<br><br>    <span class="hljs-keyword">static</span> &#123;<br>        <span class="hljs-keyword">final</span> <span class="hljs-keyword">char</span>[] DIGITS = <span class="hljs-string">&quot;0123456789abcdef&quot;</span>.toCharArray();<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">256</span>; i++) &#123;<br>            HEXDUMP_TABLE[i &lt;&lt; <span class="hljs-number">1</span>] = DIGITS[i &gt;&gt;&gt; <span class="hljs-number">4</span> &amp; <span class="hljs-number">0x0F</span>];<br>            HEXDUMP_TABLE[(i &lt;&lt; <span class="hljs-number">1</span>) + <span class="hljs-number">1</span>] = DIGITS[i &amp; <span class="hljs-number">0x0F</span>];<br>        &#125;<br><br>        <span class="hljs-keyword">int</span> i;<br><br>        <span class="hljs-comment">// Generate the lookup table for hex dump paddings</span><br>        <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; HEXPADDING.length; i++) &#123;<br>            <span class="hljs-keyword">int</span> padding = HEXPADDING.length - i;<br>            StringBuilder buf = <span class="hljs-keyword">new</span> StringBuilder(padding * <span class="hljs-number">3</span>);<br>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; padding; j++) &#123;<br>                buf.append(<span class="hljs-string">&quot;   &quot;</span>);<br>            &#125;<br>            HEXPADDING[i] = buf.toString();<br>        &#125;<br><br>        <span class="hljs-comment">// Generate the lookup table for the start-offset header in each row (up to 64KiB).</span><br>        <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; HEXDUMP_ROWPREFIXES.length; i++) &#123;<br>            StringBuilder buf = <span class="hljs-keyword">new</span> StringBuilder(<span class="hljs-number">12</span>);<br>            buf.append(NEWLINE);<br>            buf.append(Long.toHexString(i &lt;&lt; <span class="hljs-number">4</span> &amp; <span class="hljs-number">0xFFFFFFFFL</span> | <span class="hljs-number">0x100000000L</span>));<br>            buf.setCharAt(buf.length() - <span class="hljs-number">9</span>, <span class="hljs-string">&#x27;|&#x27;</span>);<br>            buf.append(<span class="hljs-string">&#x27;|&#x27;</span>);<br>            HEXDUMP_ROWPREFIXES[i] = buf.toString();<br>        &#125;<br><br>        <span class="hljs-comment">// Generate the lookup table for byte-to-hex-dump conversion</span><br>        <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; BYTE2HEX.length; i++) &#123;<br>            BYTE2HEX[i] = <span class="hljs-string">&#x27; &#x27;</span> + StringUtil.byteToHexStringPadded(i);<br>        &#125;<br><br>        <span class="hljs-comment">// Generate the lookup table for byte dump paddings</span><br>        <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; BYTEPADDING.length; i++) &#123;<br>            <span class="hljs-keyword">int</span> padding = BYTEPADDING.length - i;<br>            StringBuilder buf = <span class="hljs-keyword">new</span> StringBuilder(padding);<br>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; padding; j++) &#123;<br>                buf.append(<span class="hljs-string">&#x27; &#x27;</span>);<br>            &#125;<br>            BYTEPADDING[i] = buf.toString();<br>        &#125;<br><br>        <span class="hljs-comment">// Generate the lookup table for byte-to-char conversion</span><br>        <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; BYTE2CHAR.length; i++) &#123;<br>            <span class="hljs-keyword">if</span> (i &lt;= <span class="hljs-number">0x1f</span> || i &gt;= <span class="hljs-number">0x7f</span>) &#123;<br>                BYTE2CHAR[i] = <span class="hljs-string">&#x27;.&#x27;</span>;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                BYTE2CHAR[i] = (<span class="hljs-keyword">char</span>) i;<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ‰“å°æ‰€æœ‰å†…å®¹</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> buffer</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">debugAll</span><span class="hljs-params">(ByteBuffer buffer)</span> </span>&#123;<br>        <span class="hljs-keyword">int</span> oldlimit = buffer.limit();<br>        buffer.limit(buffer.capacity());<br>        StringBuilder origin = <span class="hljs-keyword">new</span> StringBuilder(<span class="hljs-number">256</span>);<br>        appendPrettyHexDump(origin, buffer, <span class="hljs-number">0</span>, buffer.capacity());<br>        System.out.println(<span class="hljs-string">&quot;+--------+-------------------- all ------------------------+----------------+&quot;</span>);<br>        System.out.printf(<span class="hljs-string">&quot;position: [%d], limit: [%d]\n&quot;</span>, buffer.position(), oldlimit);<br>        System.out.println(origin);<br>        buffer.limit(oldlimit);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ‰“å°å¯è¯»å–å†…å®¹</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> buffer</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">debugRead</span><span class="hljs-params">(ByteBuffer buffer)</span> </span>&#123;<br>        StringBuilder builder = <span class="hljs-keyword">new</span> StringBuilder(<span class="hljs-number">256</span>);<br>        appendPrettyHexDump(builder, buffer, buffer.position(), buffer.limit() - buffer.position());<br>        System.out.println(<span class="hljs-string">&quot;+--------+-------------------- read -----------------------+----------------+&quot;</span>);<br>        System.out.printf(<span class="hljs-string">&quot;position: [%d], limit: [%d]\n&quot;</span>, buffer.position(), buffer.limit());<br>        System.out.println(builder);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">appendPrettyHexDump</span><span class="hljs-params">(StringBuilder dump, ByteBuffer buf, <span class="hljs-keyword">int</span> offset, <span class="hljs-keyword">int</span> length)</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (isOutOfBounds(offset, length, buf.capacity())) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IndexOutOfBoundsException(<br>                    <span class="hljs-string">&quot;expected: &quot;</span> + <span class="hljs-string">&quot;0 &lt;= offset(&quot;</span> + offset + <span class="hljs-string">&quot;) &lt;= offset + length(&quot;</span> + length<br>                            + <span class="hljs-string">&quot;) &lt;= &quot;</span> + <span class="hljs-string">&quot;buf.capacity(&quot;</span> + buf.capacity() + <span class="hljs-string">&#x27;)&#x27;</span>);<br>        &#125;<br>        <span class="hljs-keyword">if</span> (length == <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        dump.append(<br>                <span class="hljs-string">&quot;         +-------------------------------------------------+&quot;</span> +<br>                        NEWLINE + <span class="hljs-string">&quot;         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |&quot;</span> +<br>                        NEWLINE + <span class="hljs-string">&quot;+--------+-------------------------------------------------+----------------+&quot;</span>);<br><br>        <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> startIndex = offset;<br>        <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> fullRows = length &gt;&gt;&gt; <span class="hljs-number">4</span>;<br>        <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> remainder = length &amp; <span class="hljs-number">0xF</span>;<br><br>        <span class="hljs-comment">// Dump the rows which have 16 bytes.</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> row = <span class="hljs-number">0</span>; row &lt; fullRows; row++) &#123;<br>            <span class="hljs-keyword">int</span> rowStartIndex = (row &lt;&lt; <span class="hljs-number">4</span>) + startIndex;<br><br>            <span class="hljs-comment">// Per-row prefix.</span><br>            appendHexDumpRowPrefix(dump, row, rowStartIndex);<br><br>            <span class="hljs-comment">// Hex dump</span><br>            <span class="hljs-keyword">int</span> rowEndIndex = rowStartIndex + <span class="hljs-number">16</span>;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = rowStartIndex; j &lt; rowEndIndex; j++) &#123;<br>                dump.append(BYTE2HEX[getUnsignedByte(buf, j)]);<br>            &#125;<br>            dump.append(<span class="hljs-string">&quot; |&quot;</span>);<br><br>            <span class="hljs-comment">// ASCII dump</span><br>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = rowStartIndex; j &lt; rowEndIndex; j++) &#123;<br>                dump.append(BYTE2CHAR[getUnsignedByte(buf, j)]);<br>            &#125;<br>            dump.append(<span class="hljs-string">&#x27;|&#x27;</span>);<br>        &#125;<br><br>        <span class="hljs-comment">// Dump the last row which has less than 16 bytes.</span><br>        <span class="hljs-keyword">if</span> (remainder != <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">int</span> rowStartIndex = (fullRows &lt;&lt; <span class="hljs-number">4</span>) + startIndex;<br>            appendHexDumpRowPrefix(dump, fullRows, rowStartIndex);<br><br>            <span class="hljs-comment">// Hex dump</span><br>            <span class="hljs-keyword">int</span> rowEndIndex = rowStartIndex + remainder;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = rowStartIndex; j &lt; rowEndIndex; j++) &#123;<br>                dump.append(BYTE2HEX[getUnsignedByte(buf, j)]);<br>            &#125;<br>            dump.append(HEXPADDING[remainder]);<br>            dump.append(<span class="hljs-string">&quot; |&quot;</span>);<br><br>            <span class="hljs-comment">// Ascii dump</span><br>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = rowStartIndex; j &lt; rowEndIndex; j++) &#123;<br>                dump.append(BYTE2CHAR[getUnsignedByte(buf, j)]);<br>            &#125;<br>            dump.append(BYTEPADDING[remainder]);<br>            dump.append(<span class="hljs-string">&#x27;|&#x27;</span>);<br>        &#125;<br><br>        dump.append(NEWLINE +<br>                <span class="hljs-string">&quot;+--------+-------------------------------------------------+----------------+&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">appendHexDumpRowPrefix</span><span class="hljs-params">(StringBuilder dump, <span class="hljs-keyword">int</span> row, <span class="hljs-keyword">int</span> rowStartIndex)</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (row &lt; HEXDUMP_ROWPREFIXES.length) &#123;<br>            dump.append(HEXDUMP_ROWPREFIXES[row]);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            dump.append(NEWLINE);<br>            dump.append(Long.toHexString(rowStartIndex &amp; <span class="hljs-number">0xFFFFFFFFL</span> | <span class="hljs-number">0x100000000L</span>));<br>            dump.setCharAt(dump.length() - <span class="hljs-number">9</span>, <span class="hljs-string">&#x27;|&#x27;</span>);<br>            dump.append(<span class="hljs-string">&#x27;|&#x27;</span>);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">short</span> <span class="hljs-title">getUnsignedByte</span><span class="hljs-params">(ByteBuffer buffer, <span class="hljs-keyword">int</span> index)</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> (<span class="hljs-keyword">short</span>) (buffer.get(index) &amp; <span class="hljs-number">0xFF</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2-3-ByteBuffer-å¸¸è§æ–¹æ³•"><a href="#2-3-ByteBuffer-å¸¸è§æ–¹æ³•" class="headerlink" title="2.3 ByteBuffer å¸¸è§æ–¹æ³•"></a>2.3 ByteBuffer å¸¸è§æ–¹æ³•</h3><h4 id="åˆ†é…ç©ºé—´"><a href="#åˆ†é…ç©ºé—´" class="headerlink" title="åˆ†é…ç©ºé—´"></a>åˆ†é…ç©ºé—´</h4><p>å¯ä»¥ä½¿ç”¨ allocate æ–¹æ³•ä¸º ByteBuffer åˆ†é…ç©ºé—´ï¼ˆ<strong>ä¸å¯ä»¥åŠ¨æ€è°ƒæ•´</strong>ï¼‰ï¼Œå…¶å®ƒ buffer ç±»ä¹Ÿæœ‰è¯¥æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">System.out.println(ByteBuffer.allocate(<span class="hljs-number">10</span>));<span class="hljs-comment">//java.nio.HeapByteBuffer[pos=0 lim=10 cap=10]</span><br>System.out.println(ByteBuffer.allocateDirect(<span class="hljs-number">10</span>));<span class="hljs-comment">//java.nio.DirectByteBuffer[pos=0 lim=10 cap=10]</span><br></code></pre></td></tr></table></figure><p><strong>class java.nio.HeapByteBuffer  java å †å†…å­˜,è¯»å†™æ•ˆç‡è¾ƒä½ï¼Œå—åˆ°JVMçš„GCçš„å½±å“(å¤åˆ¶å’Œæ ‡è®°-æ•´ç†åƒåœ¾å›æ”¶ç®—æ³•æœ‰å¯èƒ½ä¸ºäº†å‡å°‘å†…å­˜ç¢ç‰‡ï¼Œä¼šæ¥å›çš„æ‹·è´è¯¥å†…å­˜)</strong></p><p><strong>class java.nio.DirectByteBuffer ç›´æ¥å†…å­˜,è¯»å†™æ•ˆç‡é«˜ï¼ˆå°‘ä¸€æ¬¡æ‹·è´ï¼‰ï¼Œä¸ä¼šå—åˆ°JVMçš„GCå½±å“ï¼›ç”±äºç›´æ¥å†…å­˜æ˜¯ç³»ç»Ÿå†…å­˜ï¼Œåˆ†é…æ—¶éœ€è¦è°ƒç”¨ç³»ç»Ÿå‡½æ•°ï¼Œåˆ†é…çš„æ•ˆç‡ä½ï¼Œå¹¶ä¸”ä½¿ç”¨ç»“æŸï¼Œéœ€è¦æ­£ç¡®é‡Šæ”¾ç›´æ¥å†…å­˜ï¼Œå¦åˆ™ä¼šé€ æˆå†…å­˜æ³„éœ²ã€‚</strong></p><h4 id="å‘-buffer-å†™å…¥æ•°æ®"><a href="#å‘-buffer-å†™å…¥æ•°æ®" class="headerlink" title="å‘ buffer å†™å…¥æ•°æ®"></a>å‘ buffer å†™å…¥æ•°æ®</h4><p>æœ‰ä¸¤ç§åŠæ³•</p><ul><li>è°ƒç”¨ channel çš„ read æ–¹æ³•</li><li>è°ƒç”¨ buffer è‡ªå·±çš„ put æ–¹æ³•</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">int</span> readBytes = channel.read(buf);<br></code></pre></td></tr></table></figure><p>å’Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">buf.put((<span class="hljs-keyword">byte</span>)<span class="hljs-number">127</span>);<br></code></pre></td></tr></table></figure><h4 id="ä»-buffer-è¯»å–æ•°æ®"><a href="#ä»-buffer-è¯»å–æ•°æ®" class="headerlink" title="ä» buffer è¯»å–æ•°æ®"></a>ä» buffer è¯»å–æ•°æ®</h4><p>åŒæ ·æœ‰ä¸¤ç§åŠæ³•</p><ul><li>è°ƒç”¨ channel çš„ write æ–¹æ³•</li><li>è°ƒç”¨ buffer è‡ªå·±çš„ get æ–¹æ³•</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">int</span> writeBytes = channel.write(buf);<br></code></pre></td></tr></table></figure><p>å’Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">byte</span> b = buf.get();<br></code></pre></td></tr></table></figure><p>get æ–¹æ³•ä¼šè®© position è¯»æŒ‡é’ˆå‘åèµ°ï¼Œå¦‚æœæƒ³é‡å¤è¯»å–æ•°æ®</p><ul><li><p>å¯ä»¥è°ƒç”¨ rewind æ–¹æ³•å°† position é‡æ–°ç½®ä¸º 0ï¼Œä»å¤´é‡æ–°è¯»å–ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java">ByteBuffer buffer = ByteBuffer.allocate(<span class="hljs-number">10</span>);<br>buffer.put(<span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[]&#123;<span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;c&#x27;</span>, <span class="hljs-string">&#x27;d&#x27;</span>&#125;);<br>buffer.flip();<br><br>buffer.get(<span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[<span class="hljs-number">2</span>]);<br>System.out.println(buffer);<span class="hljs-comment">//java.nio.HeapByteBuffer[pos=2 lim=4 cap=10]</span><br>buffer.rewind();<br>System.out.println(buffer);<span class="hljs-comment">//java.nio.HeapByteBuffer[pos=0 lim=4 cap=10]</span><br></code></pre></td></tr></table></figure></li><li><p>æˆ–è€…è°ƒç”¨ get(int i) æ–¹æ³•è·å–ç´¢å¼• i çš„å†…å®¹ï¼Œå®ƒä¸ä¼šç§»åŠ¨è¯»æŒ‡é’ˆ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java">ByteBuffer buffer = ByteBuffer.allocate(<span class="hljs-number">10</span>);<br>buffer.put(<span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[]&#123;<span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;c&#x27;</span>, <span class="hljs-string">&#x27;d&#x27;</span>&#125;);<br>buffer.flip();<br><br>System.out.println(buffer);<span class="hljs-comment">//java.nio.HeapByteBuffer[pos=0 lim=4 cap=10]</span><br>System.out.println(buffer.get(<span class="hljs-number">1</span>)); <span class="hljs-comment">//98</span><br>System.out.println(buffer);<span class="hljs-comment">//java.nio.HeapByteBuffer[pos=0 lim=4 cap=10]</span><br></code></pre></td></tr></table></figure></li></ul><h4 id="mark-å’Œ-reset"><a href="#mark-å’Œ-reset" class="headerlink" title="mark å’Œ reset"></a>mark å’Œ reset</h4><p>mark() æ˜¯åœ¨è¯»å–æ—¶ï¼Œåšä¸€ä¸ªæ ‡è®°ï¼Œå³ä½¿ position æ”¹å˜ï¼Œåªè¦è°ƒç”¨ reset() å°±èƒ½å›åˆ° mark çš„ä½ç½®ã€‚ç›®çš„æ˜¯é‡å¤è¯»å–æŸæ®µæ•°æ®ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java">ByteBuffer buffer = ByteBuffer.allocate(<span class="hljs-number">10</span>);<br>buffer.put(<span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[]&#123;<span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;c&#x27;</span>, <span class="hljs-string">&#x27;d&#x27;</span>&#125;);<br>buffer.flip();<br><br>buffer.get(<span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[<span class="hljs-number">2</span>]);<br>System.out.println(buffer);<span class="hljs-comment">//java.nio.HeapByteBuffer[pos=2 lim=4 cap=10]</span><br>buffer.mark();<br>buffer.get(<span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[<span class="hljs-number">2</span>]);<br>System.out.println(buffer);<span class="hljs-comment">//java.nio.HeapByteBuffer[pos=4 lim=4 cap=10]</span><br>buffer.reset();<br>System.out.println(buffer);<span class="hljs-comment">//java.nio.HeapByteBuffer[pos=2 lim=4 cap=10]</span><br></code></pre></td></tr></table></figure><blockquote><p><strong>æ³¨æ„</strong></p><p>rewind å’Œ flip éƒ½ä¼šæ¸…é™¤ mark ä½ç½®</p></blockquote><h4 id="å­—ç¬¦ä¸²ä¸-ByteBuffer-äº’è½¬"><a href="#å­—ç¬¦ä¸²ä¸-ByteBuffer-äº’è½¬" class="headerlink" title="å­—ç¬¦ä¸²ä¸ ByteBuffer äº’è½¬"></a>å­—ç¬¦ä¸²ä¸ ByteBuffer äº’è½¬</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.nio.ByteBuffer;<br><span class="hljs-keyword">import</span> java.nio.charset.Charset;<br><span class="hljs-keyword">import</span> java.nio.charset.StandardCharsets;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Netty</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br><br>        <span class="hljs-comment">//1.å­—ç¬¦ä¸²è½¬ä¸º byte[] ç„¶åputå…¥ ByteBuffer</span><br>        ByteBuffer buffer1 = ByteBuffer.allocate(<span class="hljs-number">16</span>);<br>        buffer1.put(<span class="hljs-string">&quot;hello&quot;</span>.getBytes());<br>        System.out.println(buffer1); <span class="hljs-comment">//java.nio.HeapByteBuffer[pos=5 lim=16 cap=16]</span><br>        buffer1.flip(); <span class="hljs-comment">//åˆ‡æ¢åˆ°è¯»æ¨¡å¼</span><br>        String str1 = StandardCharsets.UTF_8.decode(buffer1).toString(); <span class="hljs-comment">//è¿™ä¸ªdecode()å‡½æ•°ä»bufferçš„positionå¼€å§‹è¯»ï¼Œæ‰€ä»¥è¦åˆ‡æ¢åˆ°è¯»æ¨¡å¼</span><br>        System.out.println(str1); <span class="hljs-comment">//hello</span><br><br><br>        <span class="hljs-comment">//2.Charsetç±»ï¼Œå¹¶ä¸”åœ¨putå…¥ByteBufferä¹‹åï¼Œç›´æ¥å°†positionç½®0ï¼Œå°±å¯ä»¥å¼€å§‹è¯»ï¼Œä¸ç”¨è°ƒç”¨flip()</span><br>        ByteBuffer buffer2 = StandardCharsets.UTF_8.encode(<span class="hljs-string">&quot;ä½ å¥½&quot;</span>);<br>        <span class="hljs-comment">//ByteBuffer buffer2 = Charset.forName(&quot;UTF-8&quot;).encode(&quot;ä½ å¥½&quot;);</span><br>        System.out.println(buffer2); <span class="hljs-comment">//java.nio.HeapByteBuffer[pos=0 lim=6 cap=11]</span><br>        String str2 = StandardCharsets.UTF_8.decode(buffer2).toString(); <span class="hljs-comment">//è¿™ä¸ªdecode()å‡½æ•°ä»bufferçš„positionå¼€å§‹è¯»ï¼Œæ‰€ä»¥è¦åˆ‡æ¢åˆ°è¯»æ¨¡å¼</span><br>        System.out.println(str2);<span class="hljs-comment">// ä½ å¥½</span><br>        <br><br>        ByteBuffer buffer3 = ByteBuffer.wrap(<span class="hljs-string">&quot;ä½ å¥½&quot;</span>.getBytes(StandardCharsets.UTF_8));<br>        System.out.println(buffer3); <span class="hljs-comment">//java.nio.HeapByteBuffer[pos=0 lim=6 cap=6]</span><br>        String str3 = StandardCharsets.UTF_8.decode(buffer3).toString();<br>        System.out.println(str3);<span class="hljs-comment">//ä½ å¥½</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="âš ï¸-Buffer-çš„çº¿ç¨‹å®‰å…¨"><a href="#âš ï¸-Buffer-çš„çº¿ç¨‹å®‰å…¨" class="headerlink" title="âš ï¸ Buffer çš„çº¿ç¨‹å®‰å…¨"></a>âš ï¸ Buffer çš„çº¿ç¨‹å®‰å…¨</h4><blockquote><p>Buffer æ˜¯<strong>éçº¿ç¨‹å®‰å…¨çš„</strong></p></blockquote><h3 id="2-4-Scattering-Reads"><a href="#2-4-Scattering-Reads" class="headerlink" title="2.4 Scattering Reads"></a>2.4 Scattering Reads</h3><p>åˆ†æ•£è¯»å–ï¼Œæœ‰ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ 3parts.txt</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">onetwothree</span><br></code></pre></td></tr></table></figure><p>ä½¿ç”¨å¦‚ä¸‹æ–¹å¼è¯»å–ï¼Œå¯ä»¥å°†æ•°æ®å¡«å……è‡³å¤šä¸ª buffer</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">try</span> (RandomAccessFile file = <span class="hljs-keyword">new</span> RandomAccessFile(<span class="hljs-string">&quot;helloword/3parts.txt&quot;</span>, <span class="hljs-string">&quot;rw&quot;</span>)) &#123;<br>    FileChannel channel = file.getChannel();<br>    ByteBuffer a = ByteBuffer.allocate(<span class="hljs-number">3</span>);<br>    ByteBuffer b = ByteBuffer.allocate(<span class="hljs-number">3</span>);<br>    ByteBuffer c = ByteBuffer.allocate(<span class="hljs-number">5</span>);<br>    channel.read(<span class="hljs-keyword">new</span> ByteBuffer[]&#123;a, b, c&#125;);<br>    a.flip();<br>    b.flip();<br>    c.flip();<br>    debug(a);<br>    debug(b);<br>    debug(c);<br>&#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>    e.printStackTrace();<br>&#125;<br></code></pre></td></tr></table></figure><p>ç»“æœ</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-code">         +-------------------------------------------------+</span><br><span class="hljs-section">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br><span class="hljs-section">|00000000| 6f 6e 65                                        |one             |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br><span class="hljs-code">         +-------------------------------------------------+</span><br><span class="hljs-section">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br><span class="hljs-section">|00000000| 74 77 6f                                        |two             |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br><span class="hljs-code">         +-------------------------------------------------+</span><br><span class="hljs-section">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br><span class="hljs-section">|00000000| 74 68 72 65 65                                  |three           |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br></code></pre></td></tr></table></figure><h3 id="2-5-Gathering-Writes"><a href="#2-5-Gathering-Writes" class="headerlink" title="2.5 Gathering Writes"></a>2.5 Gathering Writes</h3><p>ä½¿ç”¨å¦‚ä¸‹æ–¹å¼å†™å…¥ï¼Œå¯ä»¥å°†å¤šä¸ª buffer çš„æ•°æ®å¡«å……è‡³ channel</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">try</span> (RandomAccessFile file = <span class="hljs-keyword">new</span> RandomAccessFile(<span class="hljs-string">&quot;helloword/3parts.txt&quot;</span>, <span class="hljs-string">&quot;rw&quot;</span>)) &#123;<br>    FileChannel channel = file.getChannel();<br>    ByteBuffer d = ByteBuffer.allocate(<span class="hljs-number">4</span>);<br>    ByteBuffer e = ByteBuffer.allocate(<span class="hljs-number">4</span>);<br>    channel.position(<span class="hljs-number">11</span>);<br><br>    d.put(<span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[]&#123;<span class="hljs-string">&#x27;f&#x27;</span>, <span class="hljs-string">&#x27;o&#x27;</span>, <span class="hljs-string">&#x27;u&#x27;</span>, <span class="hljs-string">&#x27;r&#x27;</span>&#125;);<br>    e.put(<span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[]&#123;<span class="hljs-string">&#x27;f&#x27;</span>, <span class="hljs-string">&#x27;i&#x27;</span>, <span class="hljs-string">&#x27;v&#x27;</span>, <span class="hljs-string">&#x27;e&#x27;</span>&#125;);<br>    d.flip();<br>    e.flip();<br>    debug(d);<br>    debug(e);<br>    channel.write(<span class="hljs-keyword">new</span> ByteBuffer[]&#123;d, e&#125;);<br>&#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>    e.printStackTrace();<br>&#125;<br></code></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-code">         +-------------------------------------------------+</span><br><span class="hljs-section">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br><span class="hljs-section">|00000000| 66 6f 75 72                                     |four            |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br><span class="hljs-code">         +-------------------------------------------------+</span><br><span class="hljs-section">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br><span class="hljs-section">|00000000| 66 69 76 65                                     |five            |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br></code></pre></td></tr></table></figure><p>æ–‡ä»¶å†…å®¹</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">onetwothreefourfive</span><br></code></pre></td></tr></table></figure><p><strong>ä½¿ç”¨å¤šä¸ªbufferåˆ†æ•£è¯»å’Œåˆ†æ•£å†™ï¼Œè¿™æ ·å‡å°‘äº†æ•°æ®åœ¨å„ä¸ªbufferæˆ–è€…æ•°ç»„ä¹‹é—´æ¥å›æ‹·è´ï¼Œæé«˜äº†æ•ˆç‡ã€‚</strong></p><h3 id="2-6-ç»ƒä¹ "><a href="#2-6-ç»ƒä¹ " class="headerlink" title="2.6 ç»ƒä¹ "></a>2.6 ç»ƒä¹ </h3><h4 id="é»åŒ…å’ŒåŠåŒ…ç°è±¡"><a href="#é»åŒ…å’ŒåŠåŒ…ç°è±¡" class="headerlink" title="é»åŒ…å’ŒåŠåŒ…ç°è±¡"></a>é»åŒ…å’ŒåŠåŒ…ç°è±¡</h4><p>ç½‘ç»œä¸Šæœ‰å¤šæ¡æ•°æ®å‘é€ç»™æœåŠ¡ç«¯ï¼Œæ•°æ®ä¹‹é—´ä½¿ç”¨ \n è¿›è¡Œåˆ†éš”<br>ä½†ç”±äºæŸç§åŸå› è¿™äº›æ•°æ®åœ¨æ¥æ”¶æ—¶ï¼Œè¢«è¿›è¡Œäº†é‡æ–°ç»„åˆï¼Œä¾‹å¦‚åŸå§‹æ•°æ®æœ‰3æ¡ä¸º</p><ul><li>Hello,world\n</li><li>Iâ€™m zhangsan\n</li><li>How are you?\n</li></ul><p>å˜æˆäº†ä¸‹é¢çš„ä¸¤ä¸ª byteBuffer (é»åŒ…ï¼ŒåŠåŒ…)</p><ul><li>Hello,world\nIâ€™m zhangsan\nHo</li><li>w are you?\n</li></ul><p>ç°åœ¨è¦æ±‚ä½ ç¼–å†™ç¨‹åºï¼Œå°†é”™ä¹±çš„æ•°æ®æ¢å¤æˆåŸå§‹çš„æŒ‰ \n åˆ†éš”çš„æ•°æ®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>    ByteBuffer source = ByteBuffer.allocate(<span class="hljs-number">32</span>);<br>    <span class="hljs-comment">//                     11            24</span><br>    source.put(<span class="hljs-string">&quot;Hello,world\nI&#x27;m zhangsan\nHo&quot;</span>.getBytes());<br>    split(source);<br><br>    source.put(<span class="hljs-string">&quot;w are you?\nhaha!\n&quot;</span>.getBytes());<br>    split(source);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">split</span><span class="hljs-params">(ByteBuffer source)</span> </span>&#123;<br>    source.flip();<br>    <span class="hljs-keyword">int</span> oldLimit = source.limit();<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; oldLimit; i++) &#123;<br>        <span class="hljs-keyword">if</span> (source.get(i) == <span class="hljs-string">&#x27;\n&#x27;</span>) &#123;<br>            System.out.println(i);<br>            ByteBuffer target = ByteBuffer.allocate(i + <span class="hljs-number">1</span> - source.position());<br>            <span class="hljs-comment">// 0 ~ limit</span><br>            source.limit(i + <span class="hljs-number">1</span>);<br>            target.put(source); <span class="hljs-comment">// ä» source çš„positionè¯»åˆ°limitï¼ˆä¸åŒ…å«limitï¼ŒåªåŒ…å«positionï¼‰ï¼Œç§»åŠ¨positionæŒ‡é’ˆåˆ°limitï¼Œç„¶åå‘ target å†™</span><br>            debugAll(target);<br>            source.limit(oldLimit);<br>        &#125;<br>    &#125;<br>    source.compact();<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="3-æ–‡ä»¶ç¼–ç¨‹"><a href="#3-æ–‡ä»¶ç¼–ç¨‹" class="headerlink" title="3. æ–‡ä»¶ç¼–ç¨‹"></a>3. æ–‡ä»¶ç¼–ç¨‹</h2><h3 id="3-1-FileChannel"><a href="#3-1-FileChannel" class="headerlink" title="3.1 FileChannel"></a>3.1 FileChannel</h3><h4 id="âš ï¸-FileChannel-å·¥ä½œæ¨¡å¼"><a href="#âš ï¸-FileChannel-å·¥ä½œæ¨¡å¼" class="headerlink" title="âš ï¸ FileChannel å·¥ä½œæ¨¡å¼"></a>âš ï¸ FileChannel å·¥ä½œæ¨¡å¼</h4><blockquote><p>FileChannel åªèƒ½å·¥ä½œåœ¨é˜»å¡æ¨¡å¼ä¸‹ï¼Œä¸èƒ½é…åˆSelectorè¿è¡Œ</p></blockquote><h4 id="è·å–"><a href="#è·å–" class="headerlink" title="è·å–"></a>è·å–</h4><p>ä¸èƒ½ç›´æ¥æ‰“å¼€ FileChannelï¼Œå¿…é¡»é€šè¿‡ FileInputStreamã€FileOutputStream æˆ–è€… RandomAccessFile æ¥è·å– FileChannelï¼Œå®ƒä»¬éƒ½æœ‰ getChannel æ–¹æ³•</p><ul><li>é€šè¿‡ FileInputStream è·å–çš„ channel åªèƒ½è¯»</li><li>é€šè¿‡ FileOutputStream è·å–çš„ channel åªèƒ½å†™</li><li>é€šè¿‡ RandomAccessFile æ˜¯å¦èƒ½è¯»å†™æ˜¯æ ¹æ®æ„é€  RandomAccessFile æ—¶çš„è¯»å†™æ¨¡å¼å†³å®šçš„</li></ul><h4 id="è¯»å–"><a href="#è¯»å–" class="headerlink" title="è¯»å–"></a>è¯»å–</h4><p>ä¼šä» channel è¯»å–æ•°æ®å¡«å…… ByteBufferï¼Œè¿”å›å€¼è¡¨ç¤ºè¯»åˆ°äº†å¤šå°‘å­—èŠ‚ï¼Œ-1 è¡¨ç¤ºåˆ°è¾¾äº†æ–‡ä»¶çš„æœ«å°¾</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">int</span> readBytes = channel.read(buffer);<br></code></pre></td></tr></table></figure><h4 id="å†™å…¥"><a href="#å†™å…¥" class="headerlink" title="å†™å…¥"></a>å†™å…¥</h4><p>å†™å…¥çš„æ­£ç¡®å§¿åŠ¿å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java">ByteBuffer buffer = ...;<br>buffer.put(...); <span class="hljs-comment">// å­˜å…¥æ•°æ®</span><br>buffer.flip();   <span class="hljs-comment">// åˆ‡æ¢è¯»æ¨¡å¼</span><br><br><span class="hljs-keyword">while</span>(buffer.hasRemaining()) &#123;<br>    channel.write(buffer);<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨ while ä¸­è°ƒç”¨ channel.write æ˜¯å› ä¸º write æ–¹æ³•å¹¶ä¸èƒ½ä¿è¯ä¸€æ¬¡å°† buffer ä¸­çš„å†…å®¹å…¨éƒ¨å†™å…¥ channelï¼ˆchannelçš„å†™å…¥èƒ½åŠ›æ˜¯æœ‰ä¸Šé™çš„ï¼ŒFileChannelæ²¡æœ‰è¿™ä¸ªé™åˆ¶ï¼Œä½†æ˜¯åé¢ç”¨åˆ°çš„SocketChannelæœ‰ä¸Šé™ï¼‰ã€‚</p><h4 id="å…³é—­"><a href="#å…³é—­" class="headerlink" title="å…³é—­"></a>å…³é—­</h4><p>channel å¿…é¡»å…³é—­ï¼Œä¸è¿‡è°ƒç”¨äº† FileInputStreamã€FileOutputStream æˆ–è€… RandomAccessFile çš„ close æ–¹æ³•ä¼šé—´æ¥åœ°è°ƒç”¨ channel çš„ close æ–¹æ³•ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥åªè°ƒç”¨channelçš„closeæ–¹æ³•ã€‚</p><h4 id="ä½ç½®"><a href="#ä½ç½®" class="headerlink" title="ä½ç½®"></a>ä½ç½®</h4><p>è·å–å½“å‰ä½ç½®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">long</span> position = channel.position();<br></code></pre></td></tr></table></figure><p>è®¾ç½®å½“å‰ä½ç½®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">long</span> newPos = ...;<br>channel.position(newPos);<br></code></pre></td></tr></table></figure><p>è®¾ç½®å½“å‰ä½ç½®æ—¶ï¼Œå¦‚æœè®¾ç½®ä¸ºæ–‡ä»¶çš„æœ«å°¾</p><ul><li>è¿™æ—¶è¯»å–ä¼šè¿”å› -1 </li><li>è¿™æ—¶å†™å…¥ï¼Œä¼šè¿½åŠ å†…å®¹ï¼Œä½†è¦æ³¨æ„å¦‚æœ position è¶…è¿‡äº†æ–‡ä»¶æœ«å°¾ï¼Œå†å†™å…¥æ—¶åœ¨æ–°å†…å®¹å’ŒåŸæœ«å°¾ä¹‹é—´ä¼šæœ‰ç©ºæ´ï¼ˆ00ï¼‰</li></ul><h4 id="å¤§å°"><a href="#å¤§å°" class="headerlink" title="å¤§å°"></a>å¤§å°</h4><p>ä½¿ç”¨ size æ–¹æ³•è·å–æ–‡ä»¶çš„å¤§å°</p><h4 id="å¼ºåˆ¶å†™å…¥"><a href="#å¼ºåˆ¶å†™å…¥" class="headerlink" title="å¼ºåˆ¶å†™å…¥"></a>å¼ºåˆ¶å†™å…¥</h4><p>æ“ä½œç³»ç»Ÿå‡ºäºæ€§èƒ½çš„è€ƒè™‘ï¼Œä¼šå°†æ•°æ®ç¼“å­˜ï¼Œä¸æ˜¯ç«‹åˆ»å†™å…¥ç£ç›˜ã€‚å¯ä»¥è°ƒç”¨ force(true)  æ–¹æ³•å°†æ–‡ä»¶å†…å®¹å’Œå…ƒæ•°æ®ï¼ˆæ–‡ä»¶çš„æƒé™ç­‰ä¿¡æ¯ï¼‰ç«‹åˆ»å†™å…¥ç£ç›˜</p><h3 id="3-2-ä¸¤ä¸ª-Channel-ä¼ è¾“æ•°æ®"><a href="#3-2-ä¸¤ä¸ª-Channel-ä¼ è¾“æ•°æ®" class="headerlink" title="3.2 ä¸¤ä¸ª Channel ä¼ è¾“æ•°æ®"></a>3.2 ä¸¤ä¸ª Channel ä¼ è¾“æ•°æ®</h3><p><strong><code>FileChannel.transferTo()</code>æ•ˆç‡é«˜ï¼Œåº•å±‚ä¼šåˆ©ç”¨æ“ä½œç³»ç»Ÿçš„é›¶æ‹·è´è¿›è¡Œä¼˜åŒ–ã€‚</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java">String FROM = <span class="hljs-string">&quot;helloword/data.txt&quot;</span>;<br>String TO = <span class="hljs-string">&quot;helloword/to.txt&quot;</span>;<br><span class="hljs-keyword">long</span> start = System.nanoTime();<br><span class="hljs-keyword">try</span> (FileChannel from = <span class="hljs-keyword">new</span> FileInputStream(FROM).getChannel();<br>     FileChannel to = <span class="hljs-keyword">new</span> FileOutputStream(TO).getChannel();<br>) &#123;<br>    from.transferTo(<span class="hljs-number">0</span>, from.size(), to);<br>&#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>    e.printStackTrace();<br>&#125;<br><span class="hljs-keyword">long</span> end = System.nanoTime();<br>System.out.println(<span class="hljs-string">&quot;transferTo ç”¨æ—¶ï¼š&quot;</span> + (end - start) / <span class="hljs-number">1000_000.0</span>);<br></code></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">transferTo</span> ç”¨æ—¶ï¼š<span class="hljs-number">8</span>.<span class="hljs-number">2011</span><br></code></pre></td></tr></table></figure><p><strong><code>FileChannel.transferTo()</code>æ¯æ¬¡ä¼ è¾“æœ€å¤§2Gå­—èŠ‚ï¼Œå¦‚æœè¶…è¿‡2Gå­—èŠ‚ï¼Œéœ€è¦å¤šæ¬¡ä¼ è¾“ã€‚</strong></p><p>è¶…è¿‡ 2g å¤§å°çš„æ–‡ä»¶ä¼ è¾“</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestFileChannelTransferTo</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> (<br>                FileChannel from = <span class="hljs-keyword">new</span> FileInputStream(<span class="hljs-string">&quot;data.txt&quot;</span>).getChannel();<br>                FileChannel to = <span class="hljs-keyword">new</span> FileOutputStream(<span class="hljs-string">&quot;to.txt&quot;</span>).getChannel();<br>        ) &#123;<br>            <span class="hljs-comment">// æ•ˆç‡é«˜ï¼Œåº•å±‚ä¼šåˆ©ç”¨æ“ä½œç³»ç»Ÿçš„é›¶æ‹·è´è¿›è¡Œä¼˜åŒ–</span><br>            <span class="hljs-keyword">long</span> size = from.size();<br>            <span class="hljs-comment">// left å˜é‡ä»£è¡¨è¿˜å‰©ä½™å¤šå°‘å­—èŠ‚</span><br>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">long</span> left = size; left &gt; <span class="hljs-number">0</span>; ) &#123;<br>                System.out.println(<span class="hljs-string">&quot;position:&quot;</span> + (size - left) + <span class="hljs-string">&quot; left:&quot;</span> + left);<br>                left -= from.transferTo((size - left), left, to);<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å®é™…ä¼ è¾“ä¸€ä¸ªè¶…å¤§æ–‡ä»¶</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">position</span>:<span class="hljs-number">0</span> left:<span class="hljs-number">7769948160</span><br><span class="hljs-attribute">position</span>:<span class="hljs-number">2147483647</span> left:<span class="hljs-number">5622464513</span><br><span class="hljs-attribute">position</span>:<span class="hljs-number">4294967294</span> left:<span class="hljs-number">3474980866</span><br><span class="hljs-attribute">position</span>:<span class="hljs-number">6442450941</span> left:<span class="hljs-number">1327497219</span><br></code></pre></td></tr></table></figure><h3 id="3-3-Path"><a href="#3-3-Path" class="headerlink" title="3.3 Path"></a>3.3 Path</h3><p>jdk7 å¼•å…¥äº† Path å’Œ Paths ç±»</p><ul><li>Path ç”¨æ¥è¡¨ç¤ºæ–‡ä»¶è·¯å¾„</li><li>Paths æ˜¯å·¥å…·ç±»ï¼Œç”¨æ¥è·å– Path å®ä¾‹</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java">Path source = Paths.get(<span class="hljs-string">&quot;1.txt&quot;</span>); <span class="hljs-comment">// ç›¸å¯¹è·¯å¾„ ä½¿ç”¨ user.dir ç¯å¢ƒå˜é‡æ¥å®šä½ 1.txt</span><br><br>Path source = Paths.get(<span class="hljs-string">&quot;d:\\1.txt&quot;</span>); <span class="hljs-comment">// ç»å¯¹è·¯å¾„ ä»£è¡¨äº†  d:\1.txt</span><br><br>Path source = Paths.get(<span class="hljs-string">&quot;d:/1.txt&quot;</span>); <span class="hljs-comment">// ç»å¯¹è·¯å¾„ åŒæ ·ä»£è¡¨äº†  d:\1.txt</span><br><br>Path projects = Paths.get(<span class="hljs-string">&quot;d:\\data&quot;</span>, <span class="hljs-string">&quot;projects&quot;</span>); <span class="hljs-comment">// ä»£è¡¨äº†  d:\data\projects</span><br></code></pre></td></tr></table></figure><ul><li><code>.</code> ä»£è¡¨äº†å½“å‰è·¯å¾„</li><li><code>..</code> ä»£è¡¨äº†ä¸Šä¸€çº§è·¯å¾„</li></ul><p>ä¾‹å¦‚ç›®å½•ç»“æ„å¦‚ä¸‹</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs 1c">d:<br><span class="hljs-string">|- data</span><br><span class="hljs-string">|- projects</span><br><span class="hljs-string">|- a</span><br><span class="hljs-string">|- b</span><br></code></pre></td></tr></table></figure><p>ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">Path path = Paths.get(<span class="hljs-string">&quot;d:\\data\\projects\\a\\..\\b&quot;</span>);<br>System.out.println(path);<br>System.out.println(path.normalize()); <span class="hljs-comment">// æ­£å¸¸åŒ–è·¯å¾„</span><br></code></pre></td></tr></table></figure><p>ä¼šè¾“å‡º</p><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs taggerscript">d:<span class="hljs-symbol">\d</span>ata<span class="hljs-symbol">\p</span>rojects<span class="hljs-symbol">\a</span><span class="hljs-symbol">\.</span>.<span class="hljs-symbol">\b</span><br>d:<span class="hljs-symbol">\d</span>ata<span class="hljs-symbol">\p</span>rojects<span class="hljs-symbol">\b</span><br></code></pre></td></tr></table></figure><h3 id="3-4-Files"><a href="#3-4-Files" class="headerlink" title="3.4 Files"></a>3.4 Files</h3><p>æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">Path path = Paths.get(<span class="hljs-string">&quot;helloword/data.txt&quot;</span>);<br>System.out.println(Files.exists(path));<br></code></pre></td></tr></table></figure><p>åˆ›å»ºä¸€çº§ç›®å½•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">Path path = Paths.get(<span class="hljs-string">&quot;helloword/d1&quot;</span>);<br>Files.createDirectory(path);<br></code></pre></td></tr></table></figure><ul><li>å¦‚æœç›®å½•å·²å­˜åœ¨ï¼Œä¼šæŠ›å¼‚å¸¸ FileAlreadyExistsException</li><li>ä¸èƒ½ä¸€æ¬¡åˆ›å»ºå¤šçº§ç›®å½•ï¼Œå¦åˆ™ä¼šæŠ›å¼‚å¸¸ NoSuchFileException</li></ul><p>åˆ›å»ºå¤šçº§ç›®å½•ç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">Path path = Paths.get(<span class="hljs-string">&quot;helloword/d1/d2&quot;</span>);<br>Files.createDirectories(path);<br></code></pre></td></tr></table></figure><p>æ‹·è´æ–‡ä»¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">Path source = Paths.get(<span class="hljs-string">&quot;helloword/data.txt&quot;</span>);<br>Path target = Paths.get(<span class="hljs-string">&quot;helloword/target.txt&quot;</span>);<br><br>Files.copy(source, target);<br></code></pre></td></tr></table></figure><ul><li>å¦‚æœæ–‡ä»¶å·²å­˜åœ¨ï¼Œä¼šæŠ›å¼‚å¸¸ FileAlreadyExistsException</li></ul><p>å¦‚æœå¸Œæœ›ç”¨ source è¦†ç›–æ‰ targetï¼Œéœ€è¦ç”¨ StandardCopyOption æ¥æ§åˆ¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">Files.copy(source, target, StandardCopyOption.REPLACE_EXISTING);<br></code></pre></td></tr></table></figure><p><strong>Files.copyå’ŒFileChannel.transferToçš„å…·ä½“å®ä¹ ä¸åŒï¼Œä½†æ˜¯æ€§èƒ½éƒ½å¾ˆå¥½ï¼ŒFiles.copyè°ƒç”¨äº†æ“ä½œç³»ç»Ÿçš„ç³»ç»Ÿè°ƒç”¨ã€‚</strong></p><p>ç§»åŠ¨æ–‡ä»¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">Path source = Paths.get(<span class="hljs-string">&quot;helloword/data.txt&quot;</span>);<br>Path target = Paths.get(<span class="hljs-string">&quot;helloword/data.txt&quot;</span>);<br><br>Files.move(source, target, StandardCopyOption.ATOMIC_MOVE);<br></code></pre></td></tr></table></figure><ul><li>StandardCopyOption.ATOMIC_MOVE ä¿è¯æ–‡ä»¶ç§»åŠ¨çš„åŸå­æ€§</li></ul><p>åˆ é™¤æ–‡ä»¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">Path target = Paths.get(<span class="hljs-string">&quot;helloword/target.txt&quot;</span>);<br><br>Files.delete(target);<br></code></pre></td></tr></table></figure><ul><li>å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œä¼šæŠ›å¼‚å¸¸ NoSuchFileException</li></ul><p>åˆ é™¤ç›®å½•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">Path target = Paths.get(<span class="hljs-string">&quot;helloword/d1&quot;</span>);<br><br>Files.delete(target);<br></code></pre></td></tr></table></figure><ul><li>å¦‚æœç›®å½•è¿˜æœ‰å†…å®¹ï¼Œä¼šæŠ›å¼‚å¸¸ DirectoryNotEmptyException</li></ul><p>éå†ç›®å½•æ–‡ä»¶</p><p>ä½¿ç”¨Filesç±»çš„walkFileTree()æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>    Path path = Paths.get(<span class="hljs-string">&quot;C:\\Program Files\\Java\\jdk1.8.0_91&quot;</span>);<br>    AtomicInteger dirCount = <span class="hljs-keyword">new</span> AtomicInteger();<br>    AtomicInteger fileCount = <span class="hljs-keyword">new</span> AtomicInteger();<br>    Files.walkFileTree(path, <span class="hljs-keyword">new</span> SimpleFileVisitor&lt;Path&gt;()&#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-function"><span class="hljs-keyword">public</span> FileVisitResult <span class="hljs-title">preVisitDirectory</span><span class="hljs-params">(Path dir, BasicFileAttributes attrs)</span> </span><br><span class="hljs-function">            <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>            System.out.println(dir);<br>            dirCount.incrementAndGet();<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">super</span>.preVisitDirectory(dir, attrs);<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-function"><span class="hljs-keyword">public</span> FileVisitResult <span class="hljs-title">visitFile</span><span class="hljs-params">(Path file, BasicFileAttributes attrs)</span> </span><br><span class="hljs-function">            <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>            System.out.println(file);<br>            fileCount.incrementAndGet();<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">super</span>.visitFile(file, attrs);<br>        &#125;<br>    &#125;);<br>    System.out.println(dirCount); <span class="hljs-comment">// 133</span><br>    System.out.println(fileCount); <span class="hljs-comment">// 1479</span><br>&#125;<br></code></pre></td></tr></table></figure><p><strong>ä¸Šé¢è¿™æ®µä»£ç ï¼Œä½¿ç”¨åˆ°äº†è®¿é—®è€…æ¨¡å¼ã€‚</strong></p><p>ç»Ÿè®¡ jar çš„æ•°ç›®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java">Path path = Paths.get(<span class="hljs-string">&quot;C:\\Program Files\\Java\\jdk1.8.0_91&quot;</span>);<br>AtomicInteger fileCount = <span class="hljs-keyword">new</span> AtomicInteger();<br>Files.walkFileTree(path, <span class="hljs-keyword">new</span> SimpleFileVisitor&lt;Path&gt;()&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> FileVisitResult <span class="hljs-title">visitFile</span><span class="hljs-params">(Path file, BasicFileAttributes attrs)</span> </span><br><span class="hljs-function">        <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>        <span class="hljs-keyword">if</span> (file.toFile().getName().endsWith(<span class="hljs-string">&quot;.jar&quot;</span>)) &#123;<br>            fileCount.incrementAndGet();<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">super</span>.visitFile(file, attrs);<br>    &#125;<br>&#125;);<br>System.out.println(fileCount); <span class="hljs-comment">// 724</span><br></code></pre></td></tr></table></figure><p>åˆ é™¤å¤šçº§ç›®å½•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java">Path path = Paths.get(<span class="hljs-string">&quot;d:\\a&quot;</span>);<br>Files.walkFileTree(path, <span class="hljs-keyword">new</span> SimpleFileVisitor&lt;Path&gt;()&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> FileVisitResult <span class="hljs-title">visitFile</span><span class="hljs-params">(Path file, BasicFileAttributes attrs)</span> </span><br><span class="hljs-function">        <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>        Files.delete(file);<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">super</span>.visitFile(file, attrs);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> FileVisitResult <span class="hljs-title">postVisitDirectory</span><span class="hljs-params">(Path dir, IOException exc)</span> </span><br><span class="hljs-function">        <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>        Files.delete(dir);<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">super</span>.postVisitDirectory(dir, exc);<br>    &#125;<br>&#125;);<br></code></pre></td></tr></table></figure><h4 id="âš ï¸-åˆ é™¤å¾ˆå±é™©"><a href="#âš ï¸-åˆ é™¤å¾ˆå±é™©" class="headerlink" title="âš ï¸ åˆ é™¤å¾ˆå±é™©"></a>âš ï¸ åˆ é™¤å¾ˆå±é™©</h4><blockquote><p>åˆ é™¤æ˜¯å±é™©æ“ä½œï¼Œç¡®ä¿è¦é€’å½’åˆ é™¤çš„æ–‡ä»¶å¤¹æ²¡æœ‰é‡è¦å†…å®¹ï¼Œè°ƒç”¨Files.deleteæ–¹æ³•æ˜¯ç›´æ¥åˆ é™¤æ–‡ä»¶ï¼Œä¸ä¼šåœ¨å›æ”¶ç«™ä¸­ä¿å­˜æ–‡ä»¶ã€‚</p></blockquote><p>æ‹·è´å¤šçº§ç›®å½•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">long</span> start = System.currentTimeMillis();<br>String source = <span class="hljs-string">&quot;D:\\Snipaste-1.16.2-x64&quot;</span>;<br>String target = <span class="hljs-string">&quot;D:\\Snipaste-1.16.2-x64aaa&quot;</span>;<br><br>Files.walk(Paths.get(source)).forEach(path -&gt; &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>        String targetName = path.toString().replace(source, target);<br>        <span class="hljs-comment">// æ˜¯ç›®å½•</span><br>        <span class="hljs-keyword">if</span> (Files.isDirectory(path)) &#123;<br>            Files.createDirectory(Paths.get(targetName));<br>        &#125;<br>        <span class="hljs-comment">// æ˜¯æ™®é€šæ–‡ä»¶</span><br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (Files.isRegularFile(path)) &#123;<br>            Files.copy(path, Paths.get(targetName));<br>        &#125;<br>    &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>        e.printStackTrace();<br>    &#125;<br>&#125;);<br><span class="hljs-keyword">long</span> end = System.currentTimeMillis();<br>System.out.println(end - start);<br></code></pre></td></tr></table></figure><h2 id="4-ç½‘ç»œç¼–ç¨‹"><a href="#4-ç½‘ç»œç¼–ç¨‹" class="headerlink" title="4. ç½‘ç»œç¼–ç¨‹"></a>4. ç½‘ç»œç¼–ç¨‹</h2><h3 id="4-1-éé˜»å¡-vs-é˜»å¡"><a href="#4-1-éé˜»å¡-vs-é˜»å¡" class="headerlink" title="4.1 éé˜»å¡ vs é˜»å¡"></a>4.1 éé˜»å¡ vs é˜»å¡</h3><h4 id="é˜»å¡"><a href="#é˜»å¡" class="headerlink" title="é˜»å¡"></a>é˜»å¡</h4><ul><li>é˜»å¡æ¨¡å¼ä¸‹ï¼Œç›¸å…³æ–¹æ³•éƒ½ä¼šå¯¼è‡´çº¿ç¨‹æš‚åœ<ul><li>ServerSocketChannel.accept ä¼šåœ¨æ²¡æœ‰è¿æ¥å»ºç«‹æ—¶è®©çº¿ç¨‹æš‚åœ</li><li>SocketChannel.read ä¼šåœ¨æ²¡æœ‰æ•°æ®å¯è¯»æ—¶è®©çº¿ç¨‹æš‚åœ</li><li>é˜»å¡çš„è¡¨ç°å…¶å®å°±æ˜¯çº¿ç¨‹æš‚åœäº†ï¼Œæš‚åœæœŸé—´ä¸ä¼šå ç”¨ cpuï¼Œä½†çº¿ç¨‹ç›¸å½“äºé—²ç½®</li></ul></li><li>å•çº¿ç¨‹ä¸‹ï¼Œé˜»å¡æ–¹æ³•ä¹‹é—´ç›¸äº’å½±å“ï¼Œå‡ ä¹ä¸èƒ½æ­£å¸¸å·¥ä½œï¼Œéœ€è¦å¤šçº¿ç¨‹æ”¯æŒ</li><li>ä½†å¤šçº¿ç¨‹ä¸‹ï¼Œæœ‰æ–°çš„é—®é¢˜ï¼Œä½“ç°åœ¨ä»¥ä¸‹æ–¹é¢<ul><li>32 ä½ jvm ä¸€ä¸ªçº¿ç¨‹ 320kï¼Œ64 ä½ jvm ä¸€ä¸ªçº¿ç¨‹ 1024kï¼Œå¦‚æœè¿æ¥æ•°è¿‡å¤šï¼Œå¿…ç„¶å¯¼è‡´ OOMï¼Œå¹¶ä¸”çº¿ç¨‹å¤ªå¤šï¼Œåè€Œä¼šå› ä¸ºé¢‘ç¹ä¸Šä¸‹æ–‡åˆ‡æ¢å¯¼è‡´æ€§èƒ½é™ä½</li><li>å¯ä»¥é‡‡ç”¨çº¿ç¨‹æ± æŠ€æœ¯æ¥å‡å°‘çº¿ç¨‹æ•°å’Œçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œä½†æ²»æ ‡ä¸æ²»æœ¬ï¼Œå¦‚æœæœ‰å¾ˆå¤šè¿æ¥å»ºç«‹ï¼Œä½†é•¿æ—¶é—´ inactiveï¼Œå¯èƒ½ä¼šé˜»å¡çº¿ç¨‹æ± ä¸­æ‰€æœ‰çº¿ç¨‹ï¼Œå› æ­¤ä¸é€‚åˆé•¿è¿æ¥ï¼Œåªé€‚åˆ<strong>çŸ­è¿æ¥</strong></li></ul></li></ul><p>æœåŠ¡å™¨ç«¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// ä½¿ç”¨ nio æ¥ç†è§£é˜»å¡æ¨¡å¼, å•çº¿ç¨‹</span><br><span class="hljs-comment">// 0. ByteBuffer</span><br>ByteBuffer buffer = ByteBuffer.allocate(<span class="hljs-number">16</span>);<br><span class="hljs-comment">// 1. åˆ›å»ºäº†æœåŠ¡å™¨</span><br>ServerSocketChannel ssc = ServerSocketChannel.open();<br><br><span class="hljs-comment">// 2. ç»‘å®šç›‘å¬ç«¯å£</span><br>ssc.bind(<span class="hljs-keyword">new</span> InetSocketAddress(<span class="hljs-number">8080</span>));<br><br><span class="hljs-comment">// 3. è¿æ¥é›†åˆ</span><br>List&lt;SocketChannel&gt; channels = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<br><span class="hljs-keyword">while</span> (<span class="hljs-keyword">true</span>) &#123;<br>    <span class="hljs-comment">// 4. accept å»ºç«‹ä¸å®¢æˆ·ç«¯è¿æ¥ï¼Œ SocketChannel ç”¨æ¥ä¸å®¢æˆ·ç«¯ä¹‹é—´é€šä¿¡</span><br>    log.debug(<span class="hljs-string">&quot;connecting...&quot;</span>);<br>    SocketChannel sc = ssc.accept(); <span class="hljs-comment">// é˜»å¡æ–¹æ³•ï¼Œçº¿ç¨‹åœæ­¢è¿è¡Œ</span><br>    log.debug(<span class="hljs-string">&quot;connected... &#123;&#125;&quot;</span>, sc);<br>    channels.add(sc);<br>    <span class="hljs-keyword">for</span> (SocketChannel channel : channels) &#123;<br>        <span class="hljs-comment">// 5. æ¥æ”¶å®¢æˆ·ç«¯å‘é€çš„æ•°æ®</span><br>        log.debug(<span class="hljs-string">&quot;before read... &#123;&#125;&quot;</span>, channel);<br>        channel.read(buffer); <span class="hljs-comment">// é˜»å¡æ–¹æ³•ï¼Œçº¿ç¨‹åœæ­¢è¿è¡Œ</span><br>        buffer.flip();<br>        debugRead(buffer);<br>        buffer.clear();<br>        log.debug(<span class="hljs-string">&quot;after read...&#123;&#125;&quot;</span>, channel);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">SocketChannel sc = SocketChannel.open();<br>sc.connect(<span class="hljs-keyword">new</span> InetSocketAddress(<span class="hljs-string">&quot;localhost&quot;</span>, <span class="hljs-number">8080</span>));<br>System.out.println(<span class="hljs-string">&quot;waiting...&quot;</span>);<br></code></pre></td></tr></table></figure><h4 id="éé˜»å¡"><a href="#éé˜»å¡" class="headerlink" title="éé˜»å¡"></a>éé˜»å¡</h4><ul><li>éé˜»å¡æ¨¡å¼ä¸‹ï¼Œç›¸å…³æ–¹æ³•éƒ½ä¼šä¸ä¼šè®©çº¿ç¨‹æš‚åœ<ul><li>åœ¨ ServerSocketChannel.accept åœ¨æ²¡æœ‰è¿æ¥å»ºç«‹æ—¶ï¼Œä¼šè¿”å› nullï¼Œç»§ç»­è¿è¡Œ</li><li>SocketChannel.read åœ¨æ²¡æœ‰æ•°æ®å¯è¯»æ—¶ï¼Œä¼šè¿”å› 0ï¼Œä½†çº¿ç¨‹ä¸å¿…é˜»å¡ï¼Œå¯ä»¥å»æ‰§è¡Œå…¶å®ƒ SocketChannel çš„ read æˆ–æ˜¯å»æ‰§è¡Œ ServerSocketChannel.accept </li><li>å†™æ•°æ®æ—¶ï¼Œçº¿ç¨‹åªæ˜¯ç­‰å¾…æ•°æ®å†™å…¥ Channel å³å¯ï¼Œæ— éœ€ç­‰ Channel é€šè¿‡ç½‘ç»œæŠŠæ•°æ®å‘é€å‡ºå»</li></ul></li><li>ä½†éé˜»å¡æ¨¡å¼ä¸‹ï¼Œå³ä½¿æ²¡æœ‰è¿æ¥å»ºç«‹ï¼Œå’Œå¯è¯»æ•°æ®ï¼Œçº¿ç¨‹ä»ç„¶åœ¨ä¸æ–­è¿è¡Œï¼Œç™½ç™½æµªè´¹äº† cpu</li><li>æ•°æ®å¤åˆ¶è¿‡ç¨‹ä¸­ï¼Œçº¿ç¨‹å®é™…è¿˜æ˜¯é˜»å¡çš„ï¼ˆAIO æ”¹è¿›çš„åœ°æ–¹ï¼‰</li></ul><p>æœåŠ¡å™¨ç«¯ï¼Œå®¢æˆ·ç«¯ä»£ç ä¸å˜</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// ä½¿ç”¨ nio æ¥ç†è§£éé˜»å¡æ¨¡å¼, å•çº¿ç¨‹</span><br><span class="hljs-comment">// 0. ByteBuffer</span><br>ByteBuffer buffer = ByteBuffer.allocate(<span class="hljs-number">16</span>);<br><span class="hljs-comment">// 1. åˆ›å»ºäº†æœåŠ¡å™¨</span><br>ServerSocketChannel ssc = ServerSocketChannel.open();<br>ssc.configureBlocking(<span class="hljs-keyword">false</span>); <span class="hljs-comment">// éé˜»å¡æ¨¡å¼</span><br><span class="hljs-comment">// 2. ç»‘å®šç›‘å¬ç«¯å£</span><br>ssc.bind(<span class="hljs-keyword">new</span> InetSocketAddress(<span class="hljs-number">8080</span>));<br><span class="hljs-comment">// 3. è¿æ¥é›†åˆ</span><br>List&lt;SocketChannel&gt; channels = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<br><span class="hljs-keyword">while</span> (<span class="hljs-keyword">true</span>) &#123;<br>    <span class="hljs-comment">// 4. accept å»ºç«‹ä¸å®¢æˆ·ç«¯è¿æ¥ï¼Œ SocketChannel ç”¨æ¥ä¸å®¢æˆ·ç«¯ä¹‹é—´é€šä¿¡</span><br>    SocketChannel sc = ssc.accept(); <span class="hljs-comment">// éé˜»å¡ï¼Œçº¿ç¨‹è¿˜ä¼šç»§ç»­è¿è¡Œï¼Œå¦‚æœæ²¡æœ‰è¿æ¥å»ºç«‹ï¼Œä½†scæ˜¯null</span><br>    <span class="hljs-keyword">if</span> (sc != <span class="hljs-keyword">null</span>) &#123;<br>        log.debug(<span class="hljs-string">&quot;connected... &#123;&#125;&quot;</span>, sc);<br>        sc.configureBlocking(<span class="hljs-keyword">false</span>); <span class="hljs-comment">// éé˜»å¡æ¨¡å¼</span><br>        channels.add(sc);<br>    &#125;<br>    <span class="hljs-keyword">for</span> (SocketChannel channel : channels) &#123;<br>        <span class="hljs-comment">// 5. æ¥æ”¶å®¢æˆ·ç«¯å‘é€çš„æ•°æ®</span><br>        <span class="hljs-keyword">int</span> read = channel.read(buffer);<span class="hljs-comment">// éé˜»å¡ï¼Œçº¿ç¨‹ä»ç„¶ä¼šç»§ç»­è¿è¡Œï¼Œå¦‚æœæ²¡æœ‰è¯»åˆ°æ•°æ®ï¼Œread è¿”å› 0</span><br>        <span class="hljs-keyword">if</span> (read &gt; <span class="hljs-number">0</span>) &#123;<br>            buffer.flip();<br>            debugRead(buffer);<br>            buffer.clear();<br>            log.debug(<span class="hljs-string">&quot;after read...&#123;&#125;&quot;</span>, channel);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="å¤šè·¯å¤ç”¨"><a href="#å¤šè·¯å¤ç”¨" class="headerlink" title="å¤šè·¯å¤ç”¨"></a>å¤šè·¯å¤ç”¨</h4><p>å•çº¿ç¨‹å¯ä»¥é…åˆ Selector å®Œæˆå¯¹å¤šä¸ª Channel å¯è¯»å†™äº‹ä»¶çš„ç›‘æ§ï¼Œè¿™ç§°ä¹‹ä¸ºå¤šè·¯å¤ç”¨</p><ul><li>å¤šè·¯å¤ç”¨ä»…é’ˆå¯¹ç½‘ç»œ IOã€æ™®é€šæ–‡ä»¶ IO æ²¡æ³•åˆ©ç”¨å¤šè·¯å¤ç”¨</li><li>å¦‚æœä¸ç”¨ Selector çš„éé˜»å¡æ¨¡å¼ï¼Œçº¿ç¨‹å¤§éƒ¨åˆ†æ—¶é—´éƒ½åœ¨åšæ— ç”¨åŠŸï¼Œè€Œ Selector èƒ½å¤Ÿä¿è¯<ul><li>æœ‰å¯è¿æ¥äº‹ä»¶æ—¶æ‰å»è¿æ¥</li><li>æœ‰å¯è¯»äº‹ä»¶æ‰å»è¯»å–</li><li>æœ‰å¯å†™äº‹ä»¶æ‰å»å†™å…¥<ul><li>é™äºç½‘ç»œä¼ è¾“èƒ½åŠ›ï¼ŒChannel æœªå¿…æ—¶æ—¶å¯å†™ï¼Œä¸€æ—¦ Channel å¯å†™ï¼Œä¼šè§¦å‘ Selector çš„å¯å†™äº‹ä»¶</li></ul></li></ul></li></ul><p>IOå¤šè·¯å¤ç”¨æ˜¯<strong>ä¸€ç§åŒæ­¥çš„IOæ¨¡å‹</strong>ã€‚ åˆ©ç”¨IOå¤šè·¯å¤ç”¨æ¨¡å‹ï¼Œå¯ä»¥å®ç°ä¸€ä¸ªçº¿ç¨‹ç›‘è§†å¤šä¸ªæ–‡ä»¶å¥æŸ„ï¼›ä¸€æ—¦æŸä¸ªæ–‡ä»¶å¥æŸ„å°±ç»ªï¼Œå°±èƒ½å¤Ÿé€šçŸ¥åˆ°å¯¹åº”åº”ç”¨ç¨‹åºè¿›è¡Œç›¸åº”çš„è¯»å†™æ“ä½œï¼›æ²¡æœ‰æ–‡ä»¶å¥æŸ„å°±ç»ªæ—¶å°±ä¼šé˜»å¡åº”ç”¨ç¨‹åºï¼Œä»è€Œé‡Šæ”¾å‡ºCPUèµ„æºã€‚ å¤ç”¨æ˜¯æŒ‡å¤ç”¨ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹èµ„æºã€‚</p><h3 id="4-2-Selector"><a href="#4-2-Selector" class="headerlink" title="4.2 Selector"></a>4.2 Selector</h3><pre><code class=" mermaid">graph TDsubgraph selector ç‰ˆthread --&gt; selectorselector --&gt; c1(channel)selector --&gt; c2(channel)selector --&gt; c3(channel)end</code></pre><p>å¥½å¤„</p><ul><li>ä¸€ä¸ªçº¿ç¨‹é…åˆ selector å°±å¯ä»¥ç›‘æ§å¤šä¸ª channel çš„äº‹ä»¶ï¼Œäº‹ä»¶å‘ç”Ÿçº¿ç¨‹æ‰å»å¤„ç†ã€‚é¿å…éé˜»å¡æ¨¡å¼ä¸‹æ‰€åšæ— ç”¨åŠŸ</li><li>è®©è¿™ä¸ªçº¿ç¨‹èƒ½å¤Ÿè¢«å……åˆ†åˆ©ç”¨</li><li>èŠ‚çº¦äº†çº¿ç¨‹çš„æ•°é‡</li><li>å‡å°‘äº†çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢</li></ul><h4 id="åˆ›å»º"><a href="#åˆ›å»º" class="headerlink" title="åˆ›å»º"></a>åˆ›å»º</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">Selector selector = Selector.open();<br></code></pre></td></tr></table></figure><h4 id="ç»‘å®š-Channel-äº‹ä»¶"><a href="#ç»‘å®š-Channel-äº‹ä»¶" class="headerlink" title="ç»‘å®š Channel äº‹ä»¶"></a>ç»‘å®š Channel äº‹ä»¶</h4><p>ä¹Ÿç§°ä¹‹ä¸ºæ³¨å†Œäº‹ä»¶ï¼Œç»‘å®šçš„äº‹ä»¶ selector æ‰ä¼šå…³å¿ƒ </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">channel.configureBlocking(<span class="hljs-keyword">false</span>);<br>SelectionKey key = channel.register(selector, ç»‘å®šäº‹ä»¶);<br></code></pre></td></tr></table></figure><ul><li><strong>channel å¿…é¡»å·¥ä½œåœ¨éé˜»å¡æ¨¡å¼</strong></li><li>FileChannel æ²¡æœ‰éé˜»å¡æ¨¡å¼ï¼Œå› æ­¤ä¸èƒ½é…åˆ selector ä¸€èµ·ä½¿ç”¨</li><li>ç»‘å®šçš„äº‹ä»¶ç±»å‹å¯ä»¥æœ‰<ul><li>connect - å®¢æˆ·ç«¯è¿æ¥æˆåŠŸæ—¶è§¦å‘</li><li>accept - æœåŠ¡å™¨ç«¯æˆåŠŸæ¥å—è¿æ¥æ—¶è§¦å‘</li><li>read - æ•°æ®å¯è¯»å…¥æ—¶è§¦å‘ï¼Œæœ‰å› ä¸ºæ¥æ”¶èƒ½åŠ›å¼±ï¼Œæ•°æ®æš‚ä¸èƒ½è¯»å…¥çš„æƒ…å†µ</li><li>write - æ•°æ®å¯å†™å‡ºæ—¶è§¦å‘ï¼Œæœ‰å› ä¸ºå‘é€èƒ½åŠ›å¼±ï¼Œæ•°æ®æš‚ä¸èƒ½å†™å‡ºçš„æƒ…å†µ</li></ul></li></ul><h4 id="ç›‘å¬-Channel-äº‹ä»¶"><a href="#ç›‘å¬-Channel-äº‹ä»¶" class="headerlink" title="ç›‘å¬ Channel äº‹ä»¶"></a>ç›‘å¬ Channel äº‹ä»¶</h4><p>å¯ä»¥é€šè¿‡ä¸‹é¢ä¸‰ç§æ–¹æ³•æ¥ç›‘å¬æ˜¯å¦æœ‰äº‹ä»¶å‘ç”Ÿï¼Œæ–¹æ³•çš„è¿”å›å€¼ä»£è¡¨æœ‰å¤šå°‘ channel å‘ç”Ÿäº†äº‹ä»¶</p><p>æ–¹æ³•1ï¼Œé˜»å¡ç›´åˆ°ç»‘å®šäº‹ä»¶å‘ç”Ÿ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">int</span> count = selector.select();<br></code></pre></td></tr></table></figure><p>æ–¹æ³•2ï¼Œé˜»å¡ç›´åˆ°ç»‘å®šäº‹ä»¶å‘ç”Ÿï¼Œæˆ–æ˜¯è¶…æ—¶ï¼ˆæ—¶é—´å•ä½ä¸º msï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">int</span> count = selector.select(<span class="hljs-keyword">long</span> timeout);<br></code></pre></td></tr></table></figure><p>æ–¹æ³•3ï¼Œä¸ä¼šé˜»å¡ï¼Œä¹Ÿå°±æ˜¯ä¸ç®¡æœ‰æ²¡æœ‰äº‹ä»¶ï¼Œç«‹åˆ»è¿”å›ï¼Œè‡ªå·±æ ¹æ®è¿”å›å€¼æ£€æŸ¥æ˜¯å¦æœ‰äº‹ä»¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">int</span> count = selector.selectNow();<br></code></pre></td></tr></table></figure><h4 id="ğŸ’¡-select-ä½•æ—¶ä¸é˜»å¡"><a href="#ğŸ’¡-select-ä½•æ—¶ä¸é˜»å¡" class="headerlink" title="ğŸ’¡ select() ä½•æ—¶ä¸é˜»å¡"></a>ğŸ’¡ select() ä½•æ—¶ä¸é˜»å¡</h4><p>select() åœ¨äº‹ä»¶æœªå¤„ç†æ—¶ï¼Œå®ƒä¸ä¼šé˜»å¡ï¼›æ²¡æœ‰äº‹ä»¶å‘ç”Ÿã€äº‹ä»¶å‘ç”Ÿåè¢«å¤„ç†ã€äº‹ä»¶å‘ç”Ÿåè¢«å–æ¶ˆï¼ˆcancelï¼‰ï¼Œå®ƒä¼šé˜»å¡ã€‚æ€»è€Œè¨€ä¹‹ï¼Œä½¿ç”¨select() äº‹ä»¶å‘ç”Ÿåè¦ä¹ˆå¤„ç†ï¼Œè¦ä¹ˆå–æ¶ˆï¼Œä¸èƒ½ç½®ä¹‹ä¸ç†ã€‚</p><blockquote><ul><li>äº‹ä»¶å‘ç”Ÿæ—¶<ul><li>å®¢æˆ·ç«¯å‘èµ·è¿æ¥è¯·æ±‚ï¼Œä¼šè§¦å‘ accept äº‹ä»¶ï¼Œæ­¤æ—¶select()ä¸ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°äº‹ä»¶è¢«å¤„ç†æˆ–è€…è¢«å–æ¶ˆï¼ˆcancelï¼‰</li><li>å®¢æˆ·ç«¯å‘é€æ•°æ®è¿‡æ¥ï¼Œå®¢æˆ·ç«¯æ­£å¸¸ã€å¼‚å¸¸å…³é—­æ—¶ï¼Œéƒ½ä¼šè§¦å‘ read äº‹ä»¶ï¼Œå¦å¤–å¦‚æœå‘é€çš„æ•°æ®å¤§äº buffer ç¼“å†²åŒºï¼Œä¼šè§¦å‘å¤šæ¬¡è¯»å–äº‹ä»¶</li><li>channel å¯å†™ï¼Œä¼šè§¦å‘ write äº‹ä»¶</li><li>åœ¨ linux ä¸‹ nio bug å‘ç”Ÿæ—¶ï¼Œè¿™æ˜¯å› ä¸ºJavaå¯¹ä¸åŒå¹³å°çš„ä»£ç å®ç°ä¸åŒï¼Œæ•…è€Œåœ¨linuxä¸‹æœ‰bugï¼Œè‡³ä»Šæœªè¢«å¤„ç†ã€‚</li></ul></li><li>è°ƒç”¨ selector.wakeup()</li><li>è°ƒç”¨ selector.close()</li><li>selector æ‰€åœ¨çº¿ç¨‹ interrupt</li></ul></blockquote><h3 id="4-3-å¤„ç†-accept-äº‹ä»¶"><a href="#4-3-å¤„ç†-accept-äº‹ä»¶" class="headerlink" title="4.3 å¤„ç† accept äº‹ä»¶"></a>4.3 å¤„ç† accept äº‹ä»¶</h3><p>å®¢æˆ·ç«¯ä»£ç ä¸º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Client</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> (Socket socket = <span class="hljs-keyword">new</span> Socket(<span class="hljs-string">&quot;localhost&quot;</span>, <span class="hljs-number">8080</span>)) &#123;<br>            System.out.println(socket);<br>            socket.getOutputStream().write(<span class="hljs-string">&quot;world&quot;</span>.getBytes());<br>            System.in.read();<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æœåŠ¡å™¨ç«¯ä»£ç ä¸º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ChannelDemo6</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> (ServerSocketChannel channel = ServerSocketChannel.open()) &#123;<br>            channel.bind(<span class="hljs-keyword">new</span> InetSocketAddress(<span class="hljs-number">8080</span>));<br>            System.out.println(channel);<br>            Selector selector = Selector.open();<br>            channel.configureBlocking(<span class="hljs-keyword">false</span>);<br>            channel.register(selector, SelectionKey.OP_ACCEPT);<br><br>            <span class="hljs-keyword">while</span> (<span class="hljs-keyword">true</span>) &#123;<br>                <span class="hljs-keyword">int</span> count = selector.select();<br><span class="hljs-comment">//                int count = selector.selectNow();</span><br>                log.debug(<span class="hljs-string">&quot;select count: &#123;&#125;&quot;</span>, count);<br><span class="hljs-comment">//                if(count &lt;= 0) &#123;</span><br><span class="hljs-comment">//                    continue;</span><br><span class="hljs-comment">//                &#125;</span><br><br>                <span class="hljs-comment">// è·å–æ‰€æœ‰äº‹ä»¶</span><br>                Set&lt;SelectionKey&gt; keys = selector.selectedKeys();<br><br>                <span class="hljs-comment">// éå†æ‰€æœ‰äº‹ä»¶ï¼Œé€ä¸€å¤„ç†</span><br>                Iterator&lt;SelectionKey&gt; iter = keys.iterator();<br>                <span class="hljs-keyword">while</span> (iter.hasNext()) &#123;<br>                    SelectionKey key = iter.next();<br>                    <span class="hljs-comment">// åˆ¤æ–­äº‹ä»¶ç±»å‹</span><br>                    <span class="hljs-keyword">if</span> (key.isAcceptable()) &#123;<br>                        ServerSocketChannel c = (ServerSocketChannel) key.channel();<br>                        <span class="hljs-comment">// å¿…é¡»å¤„ç†</span><br>                        SocketChannel sc = c.accept();<br>                        log.debug(<span class="hljs-string">&quot;&#123;&#125;&quot;</span>, sc);<br>                    &#125;<br>                    <span class="hljs-comment">// å¤„ç†å®Œæ¯•ï¼Œå¿…é¡»å°†äº‹ä»¶ç§»é™¤</span><br>                    iter.remove();<br>                &#125;<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="ğŸ’¡-äº‹ä»¶å‘ç”Ÿåèƒ½å¦ä¸å¤„ç†"><a href="#ğŸ’¡-äº‹ä»¶å‘ç”Ÿåèƒ½å¦ä¸å¤„ç†" class="headerlink" title="ğŸ’¡ äº‹ä»¶å‘ç”Ÿåèƒ½å¦ä¸å¤„ç†"></a>ğŸ’¡ äº‹ä»¶å‘ç”Ÿåèƒ½å¦ä¸å¤„ç†</h4><blockquote><p>äº‹ä»¶å‘ç”Ÿåï¼Œè¦ä¹ˆå¤„ç†ï¼Œè¦ä¹ˆå–æ¶ˆï¼ˆcancelï¼‰ï¼Œä¸èƒ½ä»€ä¹ˆéƒ½ä¸åšï¼Œå¦åˆ™ä¸‹æ¬¡è¯¥äº‹ä»¶ä»ä¼šè§¦å‘ï¼Œè¿™æ˜¯å› ä¸º nio åº•å±‚ä½¿ç”¨çš„æ˜¯æ°´å¹³è§¦å‘</p></blockquote><h3 id="4-4-å¤„ç†-read-äº‹ä»¶"><a href="#4-4-å¤„ç†-read-äº‹ä»¶" class="headerlink" title="4.4 å¤„ç† read äº‹ä»¶"></a>4.4 å¤„ç† read äº‹ä»¶</h3><p><strong>å®¢æˆ·ç«¯ä¸è®ºæ˜¯æ­£å¸¸æ–­å¼€ï¼Œè¿˜æ˜¯å¼‚å¸¸æ–­å¼€ï¼Œéƒ½ä¼šä¸æ–­åœ°è§¦å‘readäº‹ä»¶ã€‚ä¸åŒç‚¹æ˜¯ï¼Œæ­£å¸¸æ–­å¼€æ—¶æœåŠ¡å™¨channel.read()è¿”å›-1ï¼›å¼‚å¸¸æ–­å¼€ç›´æ¥æŠ›å‡ºå¼‚å¸¸ã€‚éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œä¸è®ºæ˜¯æ­£å¸¸æ–­å¼€(è°ƒç”¨Channel.close()æ–¹æ³•)ï¼Œè¿˜æ˜¯å¼‚å¸¸æ–­å¼€ï¼Œå¦å¤–ä¸€æ–¹éƒ½ä¼šä¸æ–­æ”¶åˆ°readäº‹ä»¶ï¼Œæ‰€ä»¥åœ¨åˆ¤æ–­æ–­å¼€è¿æ¥åéœ€è¦å–æ¶ˆæ‰æ£€æµ‹è¯¥Channelçš„readäº‹ä»¶çš„SelectionKeyã€‚</strong></p><p><strong>å¦‚æœä¸€æ¬¡readäº‹ä»¶æ²¡æœ‰æŠŠæ¶ˆæ¯å…¨éƒ¨è¯»å®Œï¼Œé‚£ä¹ˆä¼šè§¦å‘å¤šä¸ªreadäº‹ä»¶ï¼Œç›´åˆ°è¯»å®Œå‘é€æ¥çš„æ‰€æœ‰æ¶ˆæ¯ã€‚</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ChannelDemo6</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> (ServerSocketChannel channel = ServerSocketChannel.open()) &#123;<br>            channel.bind(<span class="hljs-keyword">new</span> InetSocketAddress(<span class="hljs-number">8080</span>));<br>            System.out.println(channel);<br>            Selector selector = Selector.open();<br>            channel.configureBlocking(<span class="hljs-keyword">false</span>);<br>            channel.register(selector, SelectionKey.OP_ACCEPT);<br><br>            <span class="hljs-keyword">while</span> (<span class="hljs-keyword">true</span>) &#123;<br>                <span class="hljs-keyword">int</span> count = selector.select();<br><span class="hljs-comment">//                int count = selector.selectNow();</span><br>                log.debug(<span class="hljs-string">&quot;select count: &#123;&#125;&quot;</span>, count);<br><span class="hljs-comment">//                if(count &lt;= 0) &#123;</span><br><span class="hljs-comment">//                    continue;</span><br><span class="hljs-comment">//                &#125;</span><br><br>                <span class="hljs-comment">// è·å–æ‰€æœ‰äº‹ä»¶</span><br>                Set&lt;SelectionKey&gt; keys = selector.selectedKeys();<br><br>                <span class="hljs-comment">// éå†æ‰€æœ‰äº‹ä»¶ï¼Œé€ä¸€å¤„ç†</span><br>                Iterator&lt;SelectionKey&gt; iter = keys.iterator();<br>                <span class="hljs-keyword">while</span> (iter.hasNext()) &#123;<br>                    SelectionKey key = iter.next();<br>                    <span class="hljs-comment">// åˆ¤æ–­äº‹ä»¶ç±»å‹</span><br>                    <span class="hljs-keyword">if</span> (key.isAcceptable()) &#123;<br>                        ServerSocketChannel c = (ServerSocketChannel) key.channel();<br>                        <span class="hljs-comment">// å¿…é¡»å¤„ç†</span><br>                        SocketChannel sc = c.accept();<br>                        sc.configureBlocking(<span class="hljs-keyword">false</span>);<br>                        sc.register(selector, SelectionKey.OP_READ);<br>                        log.debug(<span class="hljs-string">&quot;è¿æ¥å·²å»ºç«‹: &#123;&#125;&quot;</span>, sc);<br>                    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (key.isReadable()) &#123;<br>                        SocketChannel sc = (SocketChannel) key.channel();<br>                        ByteBuffer buffer = ByteBuffer.allocate(<span class="hljs-number">128</span>);<br>                        <span class="hljs-keyword">int</span> read = sc.read(buffer);<br>                        <span class="hljs-keyword">if</span>(read == -<span class="hljs-number">1</span>) &#123;<br>                            key.cancel();<br>                            sc.close();<br>                        &#125; <span class="hljs-keyword">else</span> &#123;<br>                            buffer.flip();<br>                            debug(buffer);<br>                        &#125;<br>                    &#125;<br>                    <span class="hljs-comment">// å¤„ç†å®Œæ¯•ï¼Œå¿…é¡»å°†äº‹ä»¶ç§»é™¤</span><br>                    iter.remove();<br>                &#125;<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¼€å¯ä¸¤ä¸ªå®¢æˆ·ç«¯ï¼Œä¿®æ”¹ä¸€ä¸‹å‘é€æ–‡å­—ï¼Œè¾“å‡º</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">sun.nio.ch.ServerSocketChannelImpl[/0:0:0:0:0:0:0:0:8080]<br>21:16:39 [DEBUG] [main] c.i.n.ChannelDemo6 - select count: 1<br>21:16:39 [DEBUG] [main] c.i.n.ChannelDemo6 - è¿æ¥å·²å»ºç«‹: java.nio.channels.SocketChannel[connected local=/127.0.0.1:8080 remote=/127.0.0.1:60367]<br>21:16:39 [DEBUG] [main] c.i.n.ChannelDemo6 - select count: 1<br><span class="hljs-code">         +-------------------------------------------------+</span><br><span class="hljs-section">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br><span class="hljs-section">|00000000| 68 65 6c 6c 6f                                  |hello           |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br>21:16:59 [DEBUG] [main] c.i.n.ChannelDemo6 - select count: 1<br>21:16:59 [DEBUG] [main] c.i.n.ChannelDemo6 - è¿æ¥å·²å»ºç«‹: java.nio.channels.SocketChannel[connected local=/127.0.0.1:8080 remote=/127.0.0.1:60378]<br>21:16:59 [DEBUG] [main] c.i.n.ChannelDemo6 - select count: 1<br><span class="hljs-code">         +-------------------------------------------------+</span><br><span class="hljs-section">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br><span class="hljs-section">|00000000| 77 6f 72 6c 64                                  |world           |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br></code></pre></td></tr></table></figure><h4 id="ğŸ’¡-ä¸ºä½•è¦-iter-remove"><a href="#ğŸ’¡-ä¸ºä½•è¦-iter-remove" class="headerlink" title="ğŸ’¡ ä¸ºä½•è¦ iter.remove()"></a>ğŸ’¡ ä¸ºä½•è¦ iter.remove()</h4><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20230407133032171.png"></p><blockquote><p>å› ä¸º selector åœ¨äº‹ä»¶å‘ç”Ÿåï¼Œå°±ä¼šå°†ç›¸å…³çš„ key æ”¾å…¥ selectedKeys é›†åˆï¼Œä½†ä¸ä¼šåœ¨å¤„ç†å®Œåä» selectedKeys é›†åˆä¸­ç§»é™¤ï¼Œéœ€è¦æˆ‘ä»¬è‡ªå·±ç¼–ç åˆ é™¤ã€‚ä¾‹å¦‚</p><ul><li>ç¬¬ä¸€æ¬¡è§¦å‘äº† ssckey ä¸Šçš„ accept äº‹ä»¶ï¼Œæ²¡æœ‰ç§»é™¤ ssckey ï¼Œä½†æ˜¯ssckeyä¸Šçš„acceptäº‹ä»¶åœ¨è¢«å¤„ç†åæ ‡è®°ä¸ºå·²å¤„ç†ã€‚</li><li>ç¬¬äºŒæ¬¡è§¦å‘äº† sckey ä¸Šçš„ read äº‹ä»¶ï¼Œä½†è¿™æ—¶ selectedKeys ä¸­è¿˜æœ‰ä¸Šæ¬¡çš„ ssckey ï¼Œåœ¨å¤„ç†æ—¶å› ä¸ºæ²¡æœ‰çœŸæ­£çš„ serverSocket è¿ä¸Šäº†ï¼Œå°±ä¼šå¯¼è‡´ç©ºæŒ‡é’ˆå¼‚å¸¸</li></ul></blockquote><h4 id="ğŸ’¡-cancel-çš„ä½œç”¨"><a href="#ğŸ’¡-cancel-çš„ä½œç”¨" class="headerlink" title="ğŸ’¡ cancel çš„ä½œç”¨"></a>ğŸ’¡ cancel çš„ä½œç”¨</h4><blockquote><p>cancel ä¼šå–æ¶ˆæ³¨å†Œåœ¨ selector ä¸Šçš„ channelï¼Œå¹¶ä» keys é›†åˆä¸­åˆ é™¤ key åç»­ä¸ä¼šå†ç›‘å¬äº‹ä»¶</p></blockquote><h4 id="âš ï¸-ä¸å¤„ç†è¾¹ç•Œçš„é—®é¢˜"><a href="#âš ï¸-ä¸å¤„ç†è¾¹ç•Œçš„é—®é¢˜" class="headerlink" title="âš ï¸  ä¸å¤„ç†è¾¹ç•Œçš„é—®é¢˜"></a>âš ï¸  ä¸å¤„ç†è¾¹ç•Œçš„é—®é¢˜</h4><p>ä»¥å‰æœ‰åŒå­¦å†™è¿‡è¿™æ ·çš„ä»£ç ï¼Œæ€è€ƒæ³¨é‡Šä¸­ä¸¤ä¸ªé—®é¢˜ï¼Œä»¥ bio ä¸ºä¾‹ï¼Œå…¶å® nio é“ç†æ˜¯ä¸€æ ·çš„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Server</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>        ServerSocket ss=<span class="hljs-keyword">new</span> ServerSocket(<span class="hljs-number">9000</span>);<br>        <span class="hljs-keyword">while</span> (<span class="hljs-keyword">true</span>) &#123;<br>            Socket s = ss.accept();<br>            InputStream in = s.getInputStream();<br>            <span class="hljs-comment">// è¿™é‡Œè¿™ä¹ˆå†™ï¼Œæœ‰æ²¡æœ‰é—®é¢˜</span><br>            <span class="hljs-keyword">byte</span>[] arr = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[<span class="hljs-number">4</span>];<br>            <span class="hljs-keyword">while</span>(<span class="hljs-keyword">true</span>) &#123;<br>                <span class="hljs-keyword">int</span> read = in.read(arr);<br>                <span class="hljs-comment">// è¿™é‡Œè¿™ä¹ˆå†™ï¼Œæœ‰æ²¡æœ‰é—®é¢˜</span><br>                <span class="hljs-keyword">if</span>(read == -<span class="hljs-number">1</span>) &#123;<br>                    <span class="hljs-keyword">break</span>;<br>                &#125;<br>                System.out.println(<span class="hljs-keyword">new</span> String(arr, <span class="hljs-number">0</span>, read));<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Client</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>        Socket max = <span class="hljs-keyword">new</span> Socket(<span class="hljs-string">&quot;localhost&quot;</span>, <span class="hljs-number">9000</span>);<br>        OutputStream out = max.getOutputStream();<br>        out.write(<span class="hljs-string">&quot;hello&quot;</span>.getBytes());<br>        out.write(<span class="hljs-string">&quot;world&quot;</span>.getBytes());<br>        out.write(<span class="hljs-string">&quot;ä½ å¥½&quot;</span>.getBytes());<br>        max.close();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs avrasm">hell<br>owor<br><span class="hljs-keyword">ld</span>ï¿½<br>ï¿½å¥½<br><br></code></pre></td></tr></table></figure><p>ä¸ºä»€ä¹ˆï¼Ÿ</p><h4 id="å¤„ç†æ¶ˆæ¯çš„è¾¹ç•Œ"><a href="#å¤„ç†æ¶ˆæ¯çš„è¾¹ç•Œ" class="headerlink" title="å¤„ç†æ¶ˆæ¯çš„è¾¹ç•Œ"></a>å¤„ç†æ¶ˆæ¯çš„è¾¹ç•Œ</h4><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/0023.png"></p><ul><li>ä¸€ç§æ€è·¯æ˜¯å›ºå®šæ¶ˆæ¯é•¿åº¦ï¼Œæ•°æ®åŒ…å¤§å°ä¸€æ ·ï¼Œå®¢æˆ·ç«¯æŒ‰é¢„å®šé•¿åº¦å‘é€ï¼ŒæœåŠ¡å™¨æŒ‰é¢„å®šé•¿åº¦è¯»å–ï¼Œç¼ºç‚¹æ˜¯æµªè´¹å¸¦å®½ã€‚</li><li>å¦ä¸€ç§æ€è·¯æ˜¯æŒ‰åˆ†éš”ç¬¦æ‹†åˆ†ï¼Œç¼ºç‚¹æ˜¯æ•ˆç‡ä½ã€‚è¿™ç§æ€è·¯æœ‰ä¸¤ä¸ªé—®é¢˜ï¼Œç¬¬ä¸€å¦‚æœå®¢æˆ·ç«¯å‘é€çš„æ¶ˆæ¯åŒ…é•¿åº¦å¤§äºæœåŠ¡å™¨çš„bufferï¼Œé‚£ä¹ˆæœåŠ¡å™¨éœ€è¦æ‰©å®¹ï¼ˆæ¯”å¦‚bufferçš„capacityå˜ä¸º2å€ï¼‰ï¼Œæ‰èƒ½å®¹çº³è¿™æ¬¡çš„æ¶ˆæ¯åŒ…ï¼›ç¬¬äºŒä¸ªé—®é¢˜æ˜¯æœåŠ¡å™¨æ”¶åˆ°æ¶ˆæ¯ï¼Œéœ€è¦æŒ‰åˆ†éš”ç¬¦æ‹†åˆ†æ¶ˆæ¯åŒ…ï¼Œæ•ˆç‡ä½ã€‚</li><li>TLV æ ¼å¼ï¼Œå³ Type ç±»å‹ã€Length é•¿åº¦ã€Value æ•°æ®ï¼Œç±»å‹å’Œé•¿åº¦å·²çŸ¥çš„æƒ…å†µä¸‹ï¼Œå°±å¯ä»¥æ–¹ä¾¿è·å–æ¶ˆæ¯å¤§å°ï¼Œåˆ†é…åˆé€‚çš„ bufferï¼Œç¼ºç‚¹æ˜¯ buffer éœ€è¦æå‰åˆ†é…ï¼Œå¦‚æœå†…å®¹è¿‡å¤§ï¼Œåˆ™å½±å“ server ååé‡<ul><li>Http 1.1 æ˜¯ TLV æ ¼å¼</li><li>Http 2.0 æ˜¯ LTV æ ¼å¼</li></ul></li></ul><pre><code class=" mermaid">sequenceDiagram participant c1 as å®¢æˆ·ç«¯1participant s as æœåŠ¡å™¨participant b1 as ByteBuffer1participant b2 as ByteBuffer2c1 -&gt;&gt; s: å‘é€ 01234567890abcdef3333\rs -&gt;&gt; b1: ç¬¬ä¸€æ¬¡ read å­˜å…¥ 01234567890abcdefs -&gt;&gt; b2: æ‰©å®¹b1 -&gt;&gt; b2: æ‹·è´ 01234567890abcdefs -&gt;&gt; b2: ç¬¬äºŒæ¬¡ read å­˜å…¥ 3333\rb2 -&gt;&gt; b2: 01234567890abcdef3333\r</code></pre><p>æœåŠ¡å™¨ç«¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">split</span><span class="hljs-params">(ByteBuffer source)</span> </span>&#123;<br>    source.flip();<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; source.limit(); i++) &#123;<br>        <span class="hljs-comment">// æ‰¾åˆ°ä¸€æ¡å®Œæ•´æ¶ˆæ¯</span><br>        <span class="hljs-keyword">if</span> (source.get(i) == <span class="hljs-string">&#x27;\n&#x27;</span>) &#123;<br>            <span class="hljs-keyword">int</span> length = i + <span class="hljs-number">1</span> - source.position();<br>            <span class="hljs-comment">// æŠŠè¿™æ¡å®Œæ•´æ¶ˆæ¯å­˜å…¥æ–°çš„ ByteBuffer</span><br>            ByteBuffer target = ByteBuffer.allocate(length);<br>            <span class="hljs-comment">// ä» source è¯»ï¼Œå‘ target å†™</span><br>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; length; j++) &#123;<br>                target.put(source.get());<br>            &#125;<br>            debugAll(target);<br>        &#125;<br>    &#125;<br>    source.compact(); <span class="hljs-comment">// 0123456789abcdef  position 16 limit 16</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>    <span class="hljs-comment">// 1. åˆ›å»º selector, ç®¡ç†å¤šä¸ª channel</span><br>    Selector selector = Selector.open();<br>    ServerSocketChannel ssc = ServerSocketChannel.open();<br>    ssc.configureBlocking(<span class="hljs-keyword">false</span>);<br>    <span class="hljs-comment">// 2. å»ºç«‹ selector å’Œ channel çš„è”ç³»ï¼ˆæ³¨å†Œï¼‰</span><br>    <span class="hljs-comment">// SelectionKey å°±æ˜¯å°†æ¥äº‹ä»¶å‘ç”Ÿåï¼Œé€šè¿‡å®ƒå¯ä»¥çŸ¥é“äº‹ä»¶å’Œå“ªä¸ªchannelçš„äº‹ä»¶</span><br>    SelectionKey sscKey = ssc.register(selector, <span class="hljs-number">0</span>, <span class="hljs-keyword">null</span>);<br>    <span class="hljs-comment">// key åªå…³æ³¨ accept äº‹ä»¶</span><br>    sscKey.interestOps(SelectionKey.OP_ACCEPT);<br>    log.debug(<span class="hljs-string">&quot;sscKey:&#123;&#125;&quot;</span>, sscKey);<br>    ssc.bind(<span class="hljs-keyword">new</span> InetSocketAddress(<span class="hljs-number">8080</span>));<br>    <span class="hljs-keyword">while</span> (<span class="hljs-keyword">true</span>) &#123;<br>        <span class="hljs-comment">// 3. select æ–¹æ³•, æ²¡æœ‰äº‹ä»¶å‘ç”Ÿï¼Œçº¿ç¨‹é˜»å¡ï¼Œæœ‰äº‹ä»¶ï¼Œçº¿ç¨‹æ‰ä¼šæ¢å¤è¿è¡Œ</span><br>        <span class="hljs-comment">// select åœ¨äº‹ä»¶æœªå¤„ç†æ—¶ï¼Œå®ƒä¸ä¼šé˜»å¡, äº‹ä»¶å‘ç”Ÿåè¦ä¹ˆå¤„ç†ï¼Œè¦ä¹ˆå–æ¶ˆï¼Œä¸èƒ½ç½®ä¹‹ä¸ç†</span><br>        selector.select();<br>        <span class="hljs-comment">// 4. å¤„ç†äº‹ä»¶, selectedKeys å†…éƒ¨åŒ…å«äº†æ‰€æœ‰å‘ç”Ÿçš„äº‹ä»¶</span><br>        Iterator&lt;SelectionKey&gt; iter = selector.selectedKeys().iterator(); <span class="hljs-comment">// accept, read</span><br>        <span class="hljs-comment">// è¦åœ¨é›†åˆéå†æ—¶ï¼Œåˆ é™¤ï¼Œåº”è¯¥ä½¿ç”¨è¿­ä»£å™¨ï¼Œè€Œä¸æ˜¯ä½¿ç”¨å¢å¼ºfor</span><br>        <span class="hljs-keyword">while</span> (iter.hasNext()) &#123;<br>            SelectionKey key = iter.next();<br>            <span class="hljs-comment">// å¤„ç†key æ—¶ï¼Œè¦ä» selectedKeys é›†åˆä¸­åˆ é™¤ï¼Œå¦åˆ™ä¸‹æ¬¡å¤„ç†å°±ä¼šæœ‰é—®é¢˜</span><br>            iter.remove();<br>            log.debug(<span class="hljs-string">&quot;key: &#123;&#125;&quot;</span>, key);<br>            <span class="hljs-comment">// 5. åŒºåˆ†äº‹ä»¶ç±»å‹</span><br>            <span class="hljs-keyword">if</span> (key.isAcceptable()) &#123; <span class="hljs-comment">// å¦‚æœæ˜¯ accept</span><br>                ServerSocketChannel channel = (ServerSocketChannel) key.channel();<br>                SocketChannel sc = channel.accept();<br>                sc.configureBlocking(<span class="hljs-keyword">false</span>);<br>                ByteBuffer buffer = ByteBuffer.allocate(<span class="hljs-number">16</span>); <span class="hljs-comment">// attachment</span><br>                <span class="hljs-comment">// å°†ä¸€ä¸ª byteBuffer ä½œä¸ºé™„ä»¶å…³è”åˆ° selectionKey ä¸Š</span><br>                SelectionKey scKey = sc.register(selector, <span class="hljs-number">0</span>, buffer);<br>                scKey.interestOps(SelectionKey.OP_READ);<br>                log.debug(<span class="hljs-string">&quot;&#123;&#125;&quot;</span>, sc);<br>                log.debug(<span class="hljs-string">&quot;scKey:&#123;&#125;&quot;</span>, scKey);<br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (key.isReadable()) &#123; <span class="hljs-comment">// å¦‚æœæ˜¯ read</span><br>                <span class="hljs-keyword">try</span> &#123;<br>                    SocketChannel channel = (SocketChannel) key.channel(); <span class="hljs-comment">// æ‹¿åˆ°è§¦å‘äº‹ä»¶çš„channel</span><br>                    <span class="hljs-comment">// è·å– selectionKey ä¸Šå…³è”çš„é™„ä»¶</span><br>                    ByteBuffer buffer = (ByteBuffer) key.attachment();<br>                    <span class="hljs-keyword">int</span> read = channel.read(buffer); <span class="hljs-comment">// å¦‚æœæ˜¯æ­£å¸¸æ–­å¼€ï¼Œread çš„æ–¹æ³•çš„è¿”å›å€¼æ˜¯ -1</span><br>                    <span class="hljs-keyword">if</span>(read == -<span class="hljs-number">1</span>) &#123;<br>                        key.cancel();<br>                    &#125; <span class="hljs-keyword">else</span> &#123;<br>                        split(buffer);<br>                        <span class="hljs-comment">// éœ€è¦æ‰©å®¹</span><br>                        <span class="hljs-keyword">if</span> (buffer.position() == buffer.limit()) &#123;<br>                            ByteBuffer newBuffer = ByteBuffer.allocate(buffer.capacity() * <span class="hljs-number">2</span>);<br>                            buffer.flip();<br>                            newBuffer.put(buffer); <span class="hljs-comment">// 0123456789abcdef3333\n</span><br>                            key.attach(newBuffer);<br>                        &#125;<br>                    &#125;<br><br>                &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>                    e.printStackTrace();<br>                    key.cancel();  <span class="hljs-comment">// å› ä¸ºå®¢æˆ·ç«¯æ–­å¼€äº†,å› æ­¤éœ€è¦å°† key å–æ¶ˆï¼ˆä» selector çš„ keys é›†åˆä¸­çœŸæ­£åˆ é™¤ keyï¼‰</span><br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java">SocketChannel sc = SocketChannel.open();<br>sc.connect(<span class="hljs-keyword">new</span> InetSocketAddress(<span class="hljs-string">&quot;localhost&quot;</span>, <span class="hljs-number">8080</span>));<br>SocketAddress address = sc.getLocalAddress();<br><span class="hljs-comment">// sc.write(Charset.defaultCharset().encode(&quot;hello\nworld\n&quot;));</span><br>sc.write(Charset.defaultCharset().encode(<span class="hljs-string">&quot;0123\n456789abcdef&quot;</span>));<br>sc.write(Charset.defaultCharset().encode(<span class="hljs-string">&quot;0123456789abcdef3333\n&quot;</span>));<br>System.in.read();<br></code></pre></td></tr></table></figure><h4 id="ByteBuffer-å¤§å°åˆ†é…"><a href="#ByteBuffer-å¤§å°åˆ†é…" class="headerlink" title="ByteBuffer å¤§å°åˆ†é…"></a>ByteBuffer å¤§å°åˆ†é…</h4><ul><li>æ¯ä¸ª channel éƒ½éœ€è¦è®°å½•å¯èƒ½è¢«åˆ‡åˆ†çš„æ¶ˆæ¯ï¼Œå› ä¸º ByteBuffer ä¸èƒ½è¢«å¤šä¸ª channel å…±åŒä½¿ç”¨ï¼Œå› æ­¤éœ€è¦ä¸ºæ¯ä¸ª channel ç»´æŠ¤ä¸€ä¸ªç‹¬ç«‹çš„ ByteBuffer</li><li>ByteBuffer ä¸èƒ½å¤ªå¤§ï¼Œæ¯”å¦‚ä¸€ä¸ª ByteBuffer 1Mb çš„è¯ï¼Œè¦æ”¯æŒç™¾ä¸‡è¿æ¥å°±è¦ 1Tb å†…å­˜ï¼Œå› æ­¤éœ€è¦è®¾è®¡å¤§å°å¯å˜çš„ ByteBuffer<ul><li>ä¸€ç§æ€è·¯æ˜¯é¦–å…ˆåˆ†é…ä¸€ä¸ªè¾ƒå°çš„ bufferï¼Œä¾‹å¦‚ 4kï¼Œå¦‚æœå‘ç°æ•°æ®ä¸å¤Ÿï¼Œå†åˆ†é… 8k çš„ bufferï¼Œå°† 4k buffer å†…å®¹æ‹·è´è‡³ 8k bufferï¼Œä¼˜ç‚¹æ˜¯æ¶ˆæ¯è¿ç»­å®¹æ˜“å¤„ç†ï¼Œç¼ºç‚¹æ˜¯æ•°æ®æ‹·è´è€—è´¹æ€§èƒ½ï¼Œå‚è€ƒå®ç° <a href="http://tutorials.jenkov.com/java-performance/resizable-array.html">http://tutorials.jenkov.com/java-performance/resizable-array.html</a></li><li>å¦ä¸€ç§æ€è·¯æ˜¯ç”¨å¤šä¸ªæ•°ç»„ç»„æˆ bufferï¼Œä¸€ä¸ªæ•°ç»„ä¸å¤Ÿï¼ŒæŠŠå¤šå‡ºæ¥çš„å†…å®¹å†™å…¥æ–°çš„æ•°ç»„ï¼Œä¸å‰é¢çš„åŒºåˆ«æ˜¯æ¶ˆæ¯å­˜å‚¨ä¸è¿ç»­è§£æå¤æ‚ï¼Œä¼˜ç‚¹æ˜¯é¿å…äº†æ‹·è´å¼•èµ·çš„æ€§èƒ½æŸè€—</li></ul></li></ul><h3 id="4-5-å¤„ç†-write-äº‹ä»¶"><a href="#4-5-å¤„ç†-write-äº‹ä»¶" class="headerlink" title="4.5 å¤„ç† write äº‹ä»¶"></a>4.5 å¤„ç† write äº‹ä»¶</h3><h4 id="ä¸€æ¬¡æ— æ³•å†™å®Œä¾‹å­"><a href="#ä¸€æ¬¡æ— æ³•å†™å®Œä¾‹å­" class="headerlink" title="ä¸€æ¬¡æ— æ³•å†™å®Œä¾‹å­"></a>ä¸€æ¬¡æ— æ³•å†™å®Œä¾‹å­</h4><ul><li>éé˜»å¡æ¨¡å¼ä¸‹ï¼Œæ— æ³•ä¿è¯æŠŠ buffer ä¸­æ‰€æœ‰æ•°æ®éƒ½å†™å…¥ channelï¼Œå› æ­¤éœ€è¦è¿½è¸ª write æ–¹æ³•çš„è¿”å›å€¼ï¼ˆä»£è¡¨å®é™…å†™å…¥å­—èŠ‚æ•°ï¼‰</li><li>ç”¨ selector ç›‘å¬æ‰€æœ‰ channel çš„å¯å†™äº‹ä»¶ï¼Œæ¯ä¸ª channel éƒ½éœ€è¦ä¸€ä¸ª key æ¥è·Ÿè¸ª bufferï¼Œä½†è¿™æ ·åˆä¼šå¯¼è‡´å ç”¨å†…å­˜è¿‡å¤šï¼Œå°±æœ‰ä¸¤é˜¶æ®µç­–ç•¥<ul><li>å½“æ¶ˆæ¯å¤„ç†å™¨ç¬¬ä¸€æ¬¡å†™å…¥æ¶ˆæ¯æ—¶ï¼Œæ‰å°† channel æ³¨å†Œåˆ° selector ä¸Š</li><li>selector æ£€æŸ¥ channel ä¸Šçš„å¯å†™äº‹ä»¶ï¼Œå¦‚æœæ‰€æœ‰çš„æ•°æ®å†™å®Œäº†ï¼Œå°±å–æ¶ˆ channel çš„æ³¨å†Œ</li><li>å¦‚æœä¸å–æ¶ˆï¼Œä¼šæ¯æ¬¡å¯å†™å‡ä¼šè§¦å‘ write äº‹ä»¶</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WriteServer</span> </span>&#123;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>        ServerSocketChannel ssc = ServerSocketChannel.open();<br>        ssc.configureBlocking(<span class="hljs-keyword">false</span>);<br>        ssc.bind(<span class="hljs-keyword">new</span> InetSocketAddress(<span class="hljs-number">8080</span>));<br><br>        Selector selector = Selector.open();<br>        ssc.register(selector, SelectionKey.OP_ACCEPT);<br><br>        <span class="hljs-keyword">while</span>(<span class="hljs-keyword">true</span>) &#123;<br>            selector.select();<br><br>            Iterator&lt;SelectionKey&gt; iter = selector.selectedKeys().iterator();<br>            <span class="hljs-keyword">while</span> (iter.hasNext()) &#123;<br>                SelectionKey key = iter.next();<br>                iter.remove();<br>                <span class="hljs-keyword">if</span> (key.isAcceptable()) &#123;<br>                    SocketChannel sc = ssc.accept();<br>                    sc.configureBlocking(<span class="hljs-keyword">false</span>);<br>                    SelectionKey sckey = sc.register(selector, SelectionKey.OP_READ);<br>                    <span class="hljs-comment">// 1. å‘å®¢æˆ·ç«¯å‘é€å†…å®¹</span><br>                    StringBuilder sb = <span class="hljs-keyword">new</span> StringBuilder();<br>                    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">30000000</span>; i++) &#123;<br>                        sb.append(<span class="hljs-string">&quot;a&quot;</span>);<br>                    &#125;<br>                    ByteBuffer buffer = Charset.defaultCharset().encode(sb.toString());<br>                    <span class="hljs-keyword">int</span> write = sc.write(buffer);<br>                    <span class="hljs-comment">// 3. write è¡¨ç¤ºå®é™…å†™äº†å¤šå°‘å­—èŠ‚</span><br>                    System.out.println(<span class="hljs-string">&quot;å®é™…å†™å…¥å­—èŠ‚:&quot;</span> + write);<br>                    <span class="hljs-comment">// 4. å¦‚æœæœ‰å‰©ä½™æœªè¯»å­—èŠ‚ï¼Œæ‰éœ€è¦å…³æ³¨å†™äº‹ä»¶</span><br>                    <span class="hljs-keyword">if</span> (buffer.hasRemaining()) &#123;<br>                        <span class="hljs-comment">// read 1  write 4</span><br>                        <span class="hljs-comment">// åœ¨åŸæœ‰å…³æ³¨äº‹ä»¶çš„åŸºç¡€ä¸Šï¼Œå¤šå…³æ³¨ å†™äº‹ä»¶</span><br>                        sckey.interestOps(sckey.interestOps() + SelectionKey.OP_WRITE);<br>                        <span class="hljs-comment">// æŠŠ buffer ä½œä¸ºé™„ä»¶åŠ å…¥ sckey</span><br>                        sckey.attach(buffer);<br>                    &#125;<br>                &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (key.isWritable()) &#123;<br>                    ByteBuffer buffer = (ByteBuffer) key.attachment();<br>                    SocketChannel sc = (SocketChannel) key.channel();<br>                    <span class="hljs-keyword">int</span> write = sc.write(buffer);<br>                    System.out.println(<span class="hljs-string">&quot;å®é™…å†™å…¥å­—èŠ‚:&quot;</span> + write);<br>                    <span class="hljs-keyword">if</span> (!buffer.hasRemaining()) &#123; <span class="hljs-comment">// å†™å®Œäº†</span><br>                        key.interestOps(key.interestOps() - SelectionKey.OP_WRITE);<br>                        key.attach(<span class="hljs-keyword">null</span>);<br>                    &#125;<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WriteClient</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>        Selector selector = Selector.open();<br>        SocketChannel sc = SocketChannel.open();<br>        sc.configureBlocking(<span class="hljs-keyword">false</span>);<br>        sc.register(selector, SelectionKey.OP_CONNECT | SelectionKey.OP_READ);<br>        sc.connect(<span class="hljs-keyword">new</span> InetSocketAddress(<span class="hljs-string">&quot;localhost&quot;</span>, <span class="hljs-number">8080</span>));<br>        <span class="hljs-keyword">int</span> count = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">while</span> (<span class="hljs-keyword">true</span>) &#123;<br>            selector.select();<br>            Iterator&lt;SelectionKey&gt; iter = selector.selectedKeys().iterator();<br>            <span class="hljs-keyword">while</span> (iter.hasNext()) &#123;<br>                SelectionKey key = iter.next();<br>                iter.remove();<br>                <span class="hljs-keyword">if</span> (key.isConnectable()) &#123;<br>                    System.out.println(sc.finishConnect());<br>                &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (key.isReadable()) &#123;<br>                    ByteBuffer buffer = ByteBuffer.allocate(<span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>);<br>                    count += sc.read(buffer);<br>                    buffer.clear();<br>                    System.out.println(count);<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="ğŸ’¡-write-ä¸ºä½•è¦å–æ¶ˆ"><a href="#ğŸ’¡-write-ä¸ºä½•è¦å–æ¶ˆ" class="headerlink" title="ğŸ’¡ write ä¸ºä½•è¦å–æ¶ˆ"></a>ğŸ’¡ write ä¸ºä½•è¦å–æ¶ˆ</h4><p>åªè¦å‘ channel å‘é€æ•°æ®æ—¶ï¼Œsocket ç¼“å†²å¯å†™ï¼Œè¿™ä¸ªäº‹ä»¶ä¼šé¢‘ç¹è§¦å‘ï¼Œå› æ­¤åº”å½“åªåœ¨ socket ç¼“å†²åŒºå†™ä¸ä¸‹æ—¶å†å…³æ³¨å¯å†™äº‹ä»¶ï¼Œæ•°æ®å†™å®Œä¹‹åå†å–æ¶ˆå…³æ³¨ã€‚</p><h3 id="4-6-æ›´è¿›ä¸€æ­¥"><a href="#4-6-æ›´è¿›ä¸€æ­¥" class="headerlink" title="4.6 æ›´è¿›ä¸€æ­¥"></a>4.6 æ›´è¿›ä¸€æ­¥</h3><h4 id="ğŸ’¡-åˆ©ç”¨å¤šçº¿ç¨‹ä¼˜åŒ–"><a href="#ğŸ’¡-åˆ©ç”¨å¤šçº¿ç¨‹ä¼˜åŒ–" class="headerlink" title="ğŸ’¡ åˆ©ç”¨å¤šçº¿ç¨‹ä¼˜åŒ–"></a>ğŸ’¡ åˆ©ç”¨å¤šçº¿ç¨‹ä¼˜åŒ–</h4><blockquote><p>ç°åœ¨éƒ½æ˜¯å¤šæ ¸ cpuï¼Œè®¾è®¡æ—¶è¦å……åˆ†è€ƒè™‘åˆ«è®© cpu çš„åŠ›é‡è¢«ç™½ç™½æµªè´¹ã€‚</p><p>è¿˜æœ‰å°±æ˜¯å•çº¿ç¨‹å¤„ç†å¤šç§äº‹ä»¶ï¼Œå¦‚æœå…¶ä¸­ä¸€ç§äº‹ä»¶å¤æ‚åº¦é«˜ï¼Œé‚£ä¹ˆä¼šå½±å“å…¶ä»–æ—¶é—´çš„å¤„ç†ï¼Œæ•…è€Œåƒ<code>Redis</code>è¿™ç§å•çº¿ç¨‹ç¨‹åºï¼Œä¸è¦ä½¿ç”¨å¤æ‚åº¦é«˜çš„æ“ä½œï¼Œå¦åˆ™ä¼šå½±å“å…¶ä»–æ“ä½œã€‚</p></blockquote><p>å‰é¢çš„ä»£ç åªæœ‰ä¸€ä¸ªé€‰æ‹©å™¨ï¼Œæ²¡æœ‰å……åˆ†åˆ©ç”¨å¤šæ ¸ cpuï¼Œå¦‚ä½•æ”¹è¿›å‘¢ï¼Ÿ</p><p>åˆ†ä¸¤ç»„é€‰æ‹©å™¨</p><ul><li>å•çº¿ç¨‹é…ä¸€ä¸ªé€‰æ‹©å™¨ï¼Œä¸“é—¨å¤„ç† accept äº‹ä»¶</li><li>åˆ›å»º cpu æ ¸å¿ƒæ•°çš„çº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹é…ä¸€ä¸ªé€‰æ‹©å™¨ï¼Œè½®æµå¤„ç† read äº‹ä»¶</li></ul><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20230407171106729.png"></p><p><code>Boss</code>çº¿ç¨‹åªå¤„ç†acceptäº‹ä»¶ï¼Œ<code>worker0</code>å’Œ<code>worker1</code>å¤„ç†<code>read</code>å’Œ<code>write</code>äº‹ä»¶ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ChannelDemo7</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>        <span class="hljs-keyword">new</span> BossEventLoop().register();<br>    &#125;<br><br><br>    <span class="hljs-meta">@Slf4j</span><br>    <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BossEventLoop</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Runnable</span> </span>&#123;<br>        <span class="hljs-keyword">private</span> Selector boss;<br>        <span class="hljs-keyword">private</span> WorkerEventLoop[] workers;<br>        <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-keyword">boolean</span> start = <span class="hljs-keyword">false</span>;<br>        AtomicInteger index = <span class="hljs-keyword">new</span> AtomicInteger();<br><br>        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">register</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>            <span class="hljs-keyword">if</span> (!start) &#123;<br>                ServerSocketChannel ssc = ServerSocketChannel.open();<br>                ssc.bind(<span class="hljs-keyword">new</span> InetSocketAddress(<span class="hljs-number">8080</span>));<br>                ssc.configureBlocking(<span class="hljs-keyword">false</span>);<br>                boss = Selector.open();<br>                SelectionKey ssckey = ssc.register(boss, <span class="hljs-number">0</span>, <span class="hljs-keyword">null</span>);<br>                ssckey.interestOps(SelectionKey.OP_ACCEPT);<br>                workers = initEventLoops();<br>                <span class="hljs-keyword">new</span> Thread(<span class="hljs-keyword">this</span>, <span class="hljs-string">&quot;boss&quot;</span>).start();<br>                log.debug(<span class="hljs-string">&quot;boss start...&quot;</span>);<br>                start = <span class="hljs-keyword">true</span>;<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> WorkerEventLoop[] initEventLoops() &#123;<br><span class="hljs-comment">//        EventLoop[] eventLoops = new EventLoop[Runtime.getRuntime().availableProcessors()];</span><br>            WorkerEventLoop[] workerEventLoops = <span class="hljs-keyword">new</span> WorkerEventLoop[<span class="hljs-number">2</span>];<br>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; workerEventLoops.length; i++) &#123;<br>                workerEventLoops[i] = <span class="hljs-keyword">new</span> WorkerEventLoop(i);<br>            &#125;<br>            <span class="hljs-keyword">return</span> workerEventLoops;<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;<br>            <span class="hljs-keyword">while</span> (<span class="hljs-keyword">true</span>) &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    boss.select();<br>                    Iterator&lt;SelectionKey&gt; iter = boss.selectedKeys().iterator();<br>                    <span class="hljs-keyword">while</span> (iter.hasNext()) &#123;<br>                        SelectionKey key = iter.next();<br>                        iter.remove();<br>                        <span class="hljs-keyword">if</span> (key.isAcceptable()) &#123;<br>                            ServerSocketChannel c = (ServerSocketChannel) key.channel();<br>                            SocketChannel sc = c.accept();<br>                            sc.configureBlocking(<span class="hljs-keyword">false</span>);<br>                            log.debug(<span class="hljs-string">&quot;&#123;&#125; connected&quot;</span>, sc.getRemoteAddress());<br>                            workers[index.getAndIncrement() % workers.length].register(sc);<br>                        &#125;<br>                    &#125;<br>                &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>                    e.printStackTrace();<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@Slf4j</span><br>    <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WorkerEventLoop</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Runnable</span> </span>&#123;<br>        <span class="hljs-keyword">private</span> Selector worker;<br>        <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-keyword">boolean</span> start = <span class="hljs-keyword">false</span>;<br>        <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> index;<br><br>        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ConcurrentLinkedQueue&lt;Runnable&gt; tasks = <span class="hljs-keyword">new</span> ConcurrentLinkedQueue&lt;&gt;();<br><br>        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">WorkerEventLoop</span><span class="hljs-params">(<span class="hljs-keyword">int</span> index)</span> </span>&#123;<br>            <span class="hljs-keyword">this</span>.index = index;<br>        &#125;<br><br>        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">register</span><span class="hljs-params">(SocketChannel sc)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>            <span class="hljs-keyword">if</span> (!start) &#123;<br>                worker = Selector.open();<br>                <span class="hljs-keyword">new</span> Thread(<span class="hljs-keyword">this</span>, <span class="hljs-string">&quot;worker-&quot;</span> + index).start();<br>                start = <span class="hljs-keyword">true</span>;<br>            &#125;<br>            <br>            <span class="hljs-comment">//å‘é˜Ÿåˆ—æ·»åŠ äº†ä»»åŠ¡ï¼Œä½†è¿™ä¸ªä»»åŠ¡å¹¶æ²¡æœ‰ç«‹åˆ»æ‰§è¡Œ</span><br>            tasks.add(() -&gt; &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    SelectionKey sckey = sc.register(worker, <span class="hljs-number">0</span>, <span class="hljs-keyword">null</span>);<br>                    sckey.interestOps(SelectionKey.OP_READ);<br>                    worker.selectNow();<br>                &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>                    e.printStackTrace();<br>                &#125;<br>            &#125;);<br>            worker.wakeup();<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;<br>            <span class="hljs-keyword">while</span> (<span class="hljs-keyword">true</span>) &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    worker.select();<br>                    Runnable task = tasks.poll();<br>                    <span class="hljs-keyword">if</span> (task != <span class="hljs-keyword">null</span>) &#123;<br>                        task.run();<br>                    &#125;<br>                    Set&lt;SelectionKey&gt; keys = worker.selectedKeys();<br>                    Iterator&lt;SelectionKey&gt; iter = keys.iterator();<br>                    <span class="hljs-keyword">while</span> (iter.hasNext()) &#123;<br>                        SelectionKey key = iter.next();<br>                        <span class="hljs-keyword">if</span> (key.isReadable()) &#123;<br>                            SocketChannel sc = (SocketChannel) key.channel();<br>                            ByteBuffer buffer = ByteBuffer.allocate(<span class="hljs-number">128</span>);<br>                            <span class="hljs-keyword">try</span> &#123;<br>                                <span class="hljs-keyword">int</span> read = sc.read(buffer);<br>                                <span class="hljs-keyword">if</span> (read == -<span class="hljs-number">1</span>) &#123;<br>                                    key.cancel();<br>                                    sc.close();<br>                                &#125; <span class="hljs-keyword">else</span> &#123;<br>                                    buffer.flip();<br>                                    log.debug(<span class="hljs-string">&quot;&#123;&#125; message:&quot;</span>, sc.getRemoteAddress());<br>                                    debugAll(buffer);<br>                                &#125;<br>                            &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>                                e.printStackTrace();<br>                                key.cancel();<br>                                sc.close();<br>                            &#125;<br>                        &#125;<br>                        iter.remove();<br>                    &#125;<br>                &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>                    e.printStackTrace();<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„ï¼š</strong></p><p>Selector.select()çš„æ—¶å€™ä¼šé”ä½keyé›†åˆï¼Œå…ˆselectçš„è¯ï¼ŒSelector.register()æ³¨å†Œå°±è¿›ä¸å»äº†ã€‚</p><p><strong>ä¹Ÿå¯ä»¥ä½¿ç”¨Selector.wakeup()ï¼Œå”¤é†’Selectorå¯¹è±¡ï¼Œå³ä½¿Selectorå¯¹è±¡è¿˜æœªè¢«é˜»å¡ï¼ŒSelector.wakeup()å°±å·²ç»è¿è¡Œï¼Œä¸‹æ¬¡Selector.select()è¿˜æ˜¯ä¸ä¼šè¢«é˜»å¡ï¼Œå› ä¸ºSelector.wakeup()ç›¸å½“äºç»™Selectorå¯¹è±¡å‘äº†ä¸€å¼ ä¸é˜»å¡çš„é—¨ç¥¨ã€‚</strong></p><h4 id="ğŸ’¡-å¦‚ä½•æ‹¿åˆ°-cpu-ä¸ªæ•°"><a href="#ğŸ’¡-å¦‚ä½•æ‹¿åˆ°-cpu-ä¸ªæ•°" class="headerlink" title="ğŸ’¡ å¦‚ä½•æ‹¿åˆ° cpu ä¸ªæ•°"></a>ğŸ’¡ å¦‚ä½•æ‹¿åˆ° cpu ä¸ªæ•°</h4><blockquote><ul><li>Runtime.getRuntime().availableProcessors() å¦‚æœå·¥ä½œåœ¨ docker å®¹å™¨ä¸‹ï¼Œå› ä¸ºå®¹å™¨ä¸æ˜¯ç‰©ç†éš”ç¦»çš„ï¼Œä¼šæ‹¿åˆ°ç‰©ç† cpu ä¸ªæ•°ï¼Œè€Œä¸æ˜¯å®¹å™¨ç”³è¯·æ—¶çš„ä¸ªæ•°</li><li>è¿™ä¸ªé—®é¢˜ç›´åˆ° jdk 10 æ‰ä¿®å¤ï¼Œä½¿ç”¨ jvm å‚æ•° UseContainerSupport é…ç½®ï¼Œ é»˜è®¤å¼€å¯</li></ul></blockquote><h4 id="å¦‚ä½•è®¾ç½®çº¿ç¨‹æ•°"><a href="#å¦‚ä½•è®¾ç½®çº¿ç¨‹æ•°" class="headerlink" title="å¦‚ä½•è®¾ç½®çº¿ç¨‹æ•°"></a>å¦‚ä½•è®¾ç½®çº¿ç¨‹æ•°</h4><ul><li>å¦‚æœä»»åŠ¡æ˜¯cpuå¯†é›†å‹ä»»åŠ¡ï¼šé‚£ä¹ˆçº¿ç¨‹æ•°è®¾ç½®æˆcpuçš„æ ¸å¿ƒæ•°æ¯”è¾ƒåˆé€‚ï¼Œå› ä¸ºå‡å°‘äº†çº¿ç¨‹ä¹‹é—´çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå°½æœ€å¤§é™åº¦åˆ©ç”¨cpuçš„æ—¶é—´ç‰‡å®Œæˆä»»åŠ¡ã€‚</li><li>å¦‚æœä»»åŠ¡æ˜¯ioå¯†é›†å‹ä»»åŠ¡ï¼šé‚£ä¹ˆçº¿ç¨‹æ•°è®¾ç½®æˆå¤§äºcpuçš„æ ¸å¿ƒæ•°æ¯”è¾ƒåˆé€‚ï¼Œå› ä¸ºioå¯†é›†å‹ä»»åŠ¡ï¼Œä¼´éšç€cpuçš„ç©ºè½¬æƒ…å†µï¼Œæ•…è€Œè®¾ç½®æ›´å¤šçš„çº¿ç¨‹æ•°èƒ½å¤Ÿæœ€å¤§é™åº¦åˆ©ç”¨cpuçš„æ—¶é—´ç‰‡ï¼Œå…·ä½“æ•°ç›®å‚è€ƒ<strong>é˜¿å§†è¾¾å°”å®šå¾‹</strong>ã€‚</li></ul><h3 id="4-7-UDP"><a href="#4-7-UDP" class="headerlink" title="4.7 UDP"></a>4.7 UDP</h3><ul><li>UDP æ˜¯æ— è¿æ¥çš„ï¼Œclient å‘é€æ•°æ®ä¸ä¼šç®¡ server æ˜¯å¦å¼€å¯</li><li>server è¿™è¾¹çš„ receive æ–¹æ³•ä¼šå°†æ¥æ”¶åˆ°çš„æ•°æ®å­˜å…¥ bytebufferï¼Œä½†å¦‚æœæ•°æ®æŠ¥æ–‡è¶…è¿‡ buffer å¤§å°ï¼Œå¤šå‡ºæ¥çš„æ•°æ®ä¼šè¢«é»˜é»˜æŠ›å¼ƒ</li></ul><p>é¦–å…ˆå¯åŠ¨æœåŠ¡å™¨ç«¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UdpServer</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> (DatagramChannel channel = DatagramChannel.open()) &#123;<br>            channel.socket().bind(<span class="hljs-keyword">new</span> InetSocketAddress(<span class="hljs-number">9999</span>));<br>            System.out.println(<span class="hljs-string">&quot;waiting...&quot;</span>);<br>            ByteBuffer buffer = ByteBuffer.allocate(<span class="hljs-number">32</span>);<br>            channel.receive(buffer);<br>            buffer.flip();<br>            debug(buffer);<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gams"><span class="hljs-function"><span class="hljs-title">waiting</span></span>...<br></code></pre></td></tr></table></figure><p>è¿è¡Œå®¢æˆ·ç«¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UdpClient</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> (DatagramChannel channel = DatagramChannel.open()) &#123;<br>            ByteBuffer buffer = StandardCharsets.UTF_8.encode(<span class="hljs-string">&quot;hello&quot;</span>);<br>            InetSocketAddress address = <span class="hljs-keyword">new</span> InetSocketAddress(<span class="hljs-string">&quot;localhost&quot;</span>, <span class="hljs-number">9999</span>);<br>            channel.send(buffer, address);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æœåŠ¡å™¨ç«¯è¾“å‡º</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-code">         +-------------------------------------------------+</span><br><span class="hljs-section">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br><span class="hljs-section">|00000000| 68 65 6c 6c 6f                                  |hello           |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br></code></pre></td></tr></table></figure><h2 id="5-NIO-vs-BIO"><a href="#5-NIO-vs-BIO" class="headerlink" title="5. NIO vs BIO"></a>5. NIO vs BIO</h2><h3 id="5-1-stream-vs-channel"><a href="#5-1-stream-vs-channel" class="headerlink" title="5.1 stream vs channel"></a>5.1 stream vs channel</h3><ul><li>stream ä¸ä¼šè‡ªåŠ¨ç¼“å†²æ•°æ®ï¼Œchannel ä¼šåˆ©ç”¨ç³»ç»Ÿæä¾›çš„å‘é€ç¼“å†²åŒºã€æ¥æ”¶ç¼“å†²åŒºï¼ˆæ›´ä¸ºåº•å±‚ï¼‰</li><li>stream ä»…æ”¯æŒé˜»å¡ APIï¼Œchannel åŒæ—¶æ”¯æŒé˜»å¡ã€éé˜»å¡ APIï¼Œç½‘ç»œ channel å¯é…åˆ selector å®ç°å¤šè·¯å¤ç”¨</li><li>äºŒè€…å‡ä¸ºå…¨åŒå·¥ï¼Œå³è¯»å†™å¯ä»¥åŒæ—¶è¿›è¡Œ</li></ul><h3 id="5-2-IO-æ¨¡å‹"><a href="#5-2-IO-æ¨¡å‹" class="headerlink" title="5.2 IO æ¨¡å‹"></a>5.2 IO æ¨¡å‹</h3><p>åŒæ­¥é˜»å¡ã€åŒæ­¥éé˜»å¡ã€åŒæ­¥å¤šè·¯å¤ç”¨ã€å¼‚æ­¥é˜»å¡ï¼ˆæ²¡æœ‰æ­¤æƒ…å†µï¼‰ã€å¼‚æ­¥éé˜»å¡</p><ul><li>åŒæ­¥ï¼šçº¿ç¨‹è‡ªå·±å»è·å–ç»“æœï¼ˆä¸€ä¸ªçº¿ç¨‹ï¼‰</li><li>å¼‚æ­¥ï¼šçº¿ç¨‹è‡ªå·±ä¸å»è·å–ç»“æœï¼Œè€Œæ˜¯ç”±å…¶å®ƒçº¿ç¨‹ï¼ˆæ¯”å¦‚å†…æ ¸Kernelï¼‰é€ç»“æœï¼ˆè‡³å°‘ä¸¤ä¸ªçº¿ç¨‹ï¼‰</li></ul><p>å½“è°ƒç”¨ä¸€æ¬¡ channel.read æˆ– stream.read åï¼Œä¼šåˆ‡æ¢è‡³æ“ä½œç³»ç»Ÿå†…æ ¸æ€æ¥å®ŒæˆçœŸæ­£æ•°æ®è¯»å–ï¼Œè€Œè¯»å–åˆåˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼Œåˆ†åˆ«ä¸ºï¼š</p><ul><li>ç­‰å¾…æ•°æ®é˜¶æ®µï¼šæ¯”å¦‚ç­‰å¾…å‘é€ç«¯æŠŠæ•°æ®å‘é€è¿‡æ¥ã€‚</li><li>å¤åˆ¶æ•°æ®é˜¶æ®µï¼šæ¯”å¦‚æŠŠå‘é€ç«¯å‘é€æ¥çš„æ•°æ®ä»ç½‘å¡å¤åˆ¶åˆ°å†…å­˜</li></ul><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/0033.png"></p><ul><li><p>é˜»å¡ IO</p><p>åœ¨é˜»å¡IOä¸­ï¼Œç”¨æˆ·çº¿ç¨‹åœ¨ç­‰å¾…æ•°æ®å’Œå¤åˆ¶æ•°æ®é˜¶æ®µä¸€ç›´è¢«é˜»å¡ï¼Œä¸èƒ½å¤„ç†å…¶ä»–ä»»åŠ¡ã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/0039.png"></p></li><li><p>éé˜»å¡  IO</p><p>åœ¨éé˜»å¡IOä¸­ï¼Œç”¨æˆ·çº¿ç¨‹åœ¨ç­‰å¾…æ•°æ®é˜¶æ®µä¸ä¼šè¢«é˜»å¡ä½ï¼Œå¯ä»¥å¤„ç†å…¶ä»–ä»»åŠ¡ï¼›ä½†æ˜¯åœ¨å¤åˆ¶æ•°æ®é˜¶æ®µä»ç„¶ä¼šè¢«é˜»å¡ä½ï¼Œä¸èƒ½å¤„ç†å…¶ä»–ä»»åŠ¡ã€‚ç”¨æˆ·çº¿ç¨‹åœ¨ç­‰å¾…æ•°æ®é˜¶æ®µè°ƒç”¨read()åï¼Œä¸ä¼šè¢«é˜»å¡ä½ï¼Œä¼šç«‹åˆ»å¾—åˆ°è¿”å›å€¼ï¼Œç”¨æˆ·çº¿ç¨‹ä¼šå¾—çŸ¥ç­‰å¾…æ•°æ®é˜¶æ®µæ˜¯å¦å®Œæˆï¼Œå¦‚æœæ²¡æœ‰å®Œæˆï¼Œå¯ä»¥å»å¤„ç†å…¶ä»–ä»»åŠ¡ï¼Œè¿‡ä¸€æ®µæ—¶é—´å†æ¥æŸ¥è¯¢å¸¦å¸¦æ•°æ®é˜¶æ®µæ˜¯å¦å®Œæˆã€‚å¦‚æœç­‰å¾…æ•°æ®é˜¶æ®µå®Œæˆï¼Œè¿›å…¥å¤åˆ¶æ•°æ®é˜¶æ®µï¼Œç”¨æˆ·çº¿ç¨‹ä¼šè¢«é˜»å¡ä½ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<strong>ç”±äºéé˜»å¡IOåœ¨ç­‰å¾…æ•°æ®é˜¶æ®µé¢‘ç¹è°ƒç”¨ç³»ç»Ÿå‡½æ•°read()ï¼Œæ¶‰åŠåˆ°å¤šæ¬¡çš„ç”¨æˆ·æ€å’Œç³»ç»Ÿæ€çš„åˆ‡æ¢ï¼Œæ•…è€Œæ€§èƒ½ä¸ä¸€å®šæ¯”é˜»å¡IOå¥½å¤šå°‘ã€‚</strong></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/0035.png"></p></li><li><p>å¤šè·¯å¤ç”¨</p><p>IOå¤šè·¯å¤ç”¨æ˜¯<strong>ä¸€ç§åŒæ­¥çš„IOæ¨¡å‹</strong>ã€‚ åˆ©ç”¨IOå¤šè·¯å¤ç”¨æ¨¡å‹ï¼Œå¯ä»¥å®ç°ä¸€ä¸ªçº¿ç¨‹ç›‘è§†å¤šä¸ªæ–‡ä»¶å¥æŸ„ï¼›ä¸€æ—¦æŸä¸ªæ–‡ä»¶å¥æŸ„å°±ç»ªï¼Œå°±èƒ½å¤Ÿé€šçŸ¥åˆ°å¯¹åº”åº”ç”¨ç¨‹åºè¿›è¡Œç›¸åº”çš„è¯»å†™æ“ä½œï¼›æ²¡æœ‰æ–‡ä»¶å¥æŸ„å°±ç»ªæ—¶å°±ä¼šé˜»å¡åº”ç”¨ç¨‹åºï¼Œä»è€Œé‡Šæ”¾å‡ºCPUèµ„æºã€‚ å¤ç”¨æ˜¯æŒ‡å¤ç”¨ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹èµ„æºã€‚å¤šè·¯å¤ç”¨æœ‰ä¸‰ç§ï¼šselectorï¼Œpollï¼Œepollã€‚</p><p>IOå¤šè·¯å¤ç”¨æ¨¡å‹æŒ‡çš„æ˜¯ï¼šä½¿ç”¨å•ä¸ªè¿›ç¨‹åŒæ—¶å¤„ç†å¤šä¸ªç½‘ç»œè¿æ¥IOï¼Œä»–çš„åŸç†å°±æ˜¯selectã€ pollã€ epoll ä¸æ–­è½®è¯¢æ‰€è´Ÿè´£çš„æ‰€æœ‰ socketï¼Œ å½“æŸä¸ªsocketæœ‰æ•°æ®åˆ°è¾¾äº†ï¼Œå°±é€šçŸ¥ç”¨æˆ·è¿›ç¨‹ã€‚è¯¥æ¨¡å‹çš„ä¼˜åŠ¿å¹¶ä¸æ˜¯å¯¹äºå•ä¸ªè¿æ¥èƒ½å¤„ç†å¾—æ›´å¿«ï¼Œè€Œæ˜¯åœ¨äºèƒ½å¤„ç†æ›´å¤šçš„è¿æ¥ã€‚</p><p>å¤šè·¯å¤ç”¨ï¼Œselect()æ–¹æ³•åœ¨ç­‰å¾…æ•°æ®é˜¶æ®µé˜»å¡ï¼Œç­‰è·å¾—SelectionKeyä¹‹åï¼Œè°ƒç”¨read()æ–¹æ³•åˆä¼šåœ¨å¤åˆ¶æ•°æ®é˜¶æ®µè¢«é˜»å¡ã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/0038.png"></p></li><li><p>ä¿¡å·é©±åŠ¨</p><p>ä¸å¤ªå¸¸ç”¨ï¼Œä¸åšäº†è§£ã€‚</p></li><li><p>å¼‚æ­¥ IO</p><p>ç”¨æˆ·è¿›ç¨‹å‘èµ· aio_read è°ƒç”¨ä¹‹åï¼Œç«‹åˆ»å°±å¯ä»¥å¼€å§‹å»åšå…¶å®ƒçš„äº‹ã€‚è€Œå¦ä¸€æ–¹é¢ï¼Œä» kernel çš„è§’åº¦ï¼Œå½“å®ƒå‘ç°ä¸€ä¸ª asynchronous read ä¹‹åï¼Œé¦–å…ˆå®ƒä¼šç«‹åˆ»è¿”å›ï¼Œæ‰€ä»¥ä¸ä¼šå¯¹ç”¨æˆ·è¿›ç¨‹äº§ç”Ÿä»»ä½• blockã€‚ç„¶åï¼Œkernel ä¼šç­‰å¾…æ•°æ®å‡†å¤‡å®Œæˆï¼Œç„¶åå°†æ•°æ®æ‹·è´åˆ°ç”¨æˆ·å†…å­˜ï¼Œå½“è¿™ä¸€åˆ‡éƒ½å®Œæˆä¹‹åï¼Œkernel ä¼šç»™ç”¨æˆ·è¿›ç¨‹å‘é€ä¸€ä¸ª signalï¼Œå‘Šè¯‰å®ƒ read æ“ä½œå®Œæˆäº†ã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/0037.png"></p><p>thread1å’Œthread2æ˜¯å¦‚ä½•é€šä¿¡çš„å‘¢ï¼Ÿåœ¨thread1è°ƒç”¨read()æ–¹æ³•æ—¶ï¼Œå®šä¹‰äº†ä¸€ä¸ªå›è°ƒæ–¹æ³•(å‚æ•°)ï¼Œç­‰åˆ°thread2è®²æ•°æ®æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´äº†ï¼Œæ­¤æ—¶thread2ä¼šè°ƒç”¨thread1å®šä¹‰çš„å›è°ƒæ–¹æ³•ï¼Œå¹¶æŠŠç»“æœä½œä¸ºå‚æ•°è¿›è¡Œè¿”å›ï¼Œä»¥æ­¤æ¥è¾¾åˆ°çº¿ç¨‹é—´é€šä¿¡ã€‚</p></li><li><p>é˜»å¡ IO vs å¤šè·¯å¤ç”¨</p><p>é˜»å¡IOåªèƒ½é€šè¿‡å½“å‰äº‹ä»¶çš„ç»“æŸæ¥ç»“æŸé˜»å¡ï¼Œè€Œå¤šè·¯å¤ç”¨å¯ä»¥é€šè¿‡ä»»æ„æ³¨å†Œçš„äº‹ä»¶çš„å‘ç”Ÿæ¥ç»“æŸé˜»å¡ã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/0034.png"></p><p>è€Œå¤šè·¯å¤ç”¨çš„select()æ¯æ¬¡ç­‰å¾…äº‹ä»¶ï¼Œå¯ä»¥ä¸€æ¬¡æ‹¿åˆ°å¤šä¸ªSelectionKeyï¼Œå¤„ç†å¤šä¸ªè¯·æ±‚ï¼Œä¸éœ€è¦åƒé˜»å¡IOé‚£æ ·å¤šæ¬¡è¿›å…¥ç­‰å¾…é˜¶æ®µã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/0036.png"></p></li></ul><h4 id="ğŸ”–-å‚è€ƒ"><a href="#ğŸ”–-å‚è€ƒ" class="headerlink" title="ğŸ”– å‚è€ƒ"></a>ğŸ”– å‚è€ƒ</h4><p>UNIX ç½‘ç»œç¼–ç¨‹ - å· I</p><h3 id="5-3-é›¶æ‹·è´"><a href="#5-3-é›¶æ‹·è´" class="headerlink" title="5.3 é›¶æ‹·è´"></a>5.3 é›¶æ‹·è´</h3><h4 id="ä¼ ç»Ÿ-IO-é—®é¢˜"><a href="#ä¼ ç»Ÿ-IO-é—®é¢˜" class="headerlink" title="ä¼ ç»Ÿ IO é—®é¢˜"></a>ä¼ ç»Ÿ IO é—®é¢˜</h4><p>ä¼ ç»Ÿçš„ IO å°†ä¸€ä¸ªæ–‡ä»¶é€šè¿‡ socket å†™å‡º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java">File f = <span class="hljs-keyword">new</span> File(<span class="hljs-string">&quot;helloword/data.txt&quot;</span>);<br>RandomAccessFile file = <span class="hljs-keyword">new</span> RandomAccessFile(f, <span class="hljs-string">&quot;r&quot;</span>);<br><br><span class="hljs-keyword">byte</span>[] buf = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[(<span class="hljs-keyword">int</span>)f.length()];<br>file.read(buf);<br><br>Socket socket = ...;<br>socket.getOutputStream().write(buf);<br></code></pre></td></tr></table></figure><p>å†…éƒ¨å·¥ä½œæµç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/0024.png"></p><ol><li><p>java æœ¬èº«å¹¶ä¸å…·å¤‡ IO è¯»å†™èƒ½åŠ›ï¼Œå› æ­¤ read æ–¹æ³•è°ƒç”¨åï¼Œè¦ä» java ç¨‹åºçš„<strong>ç”¨æˆ·æ€</strong>åˆ‡æ¢è‡³<strong>å†…æ ¸æ€</strong>ï¼Œå»è°ƒç”¨æ“ä½œç³»ç»Ÿï¼ˆKernelï¼‰çš„è¯»èƒ½åŠ›ï¼Œå°†æ•°æ®è¯»å…¥<strong>å†…æ ¸ç¼“å†²åŒº</strong>ã€‚è¿™æœŸé—´ç”¨æˆ·çº¿ç¨‹é˜»å¡ï¼Œæ“ä½œç³»ç»Ÿä½¿ç”¨ DMAï¼ˆDirect Memory Accessï¼‰æ¥å®ç°æ–‡ä»¶è¯»ï¼Œå…¶é—´ä¹Ÿä¸ä¼šä½¿ç”¨ cpu</p><blockquote><p>DMA ä¹Ÿå¯ä»¥ç†è§£ä¸ºç¡¬ä»¶å•å…ƒï¼Œç”¨æ¥è§£æ”¾ cpu å®Œæˆæ–‡ä»¶ IO</p></blockquote></li><li><p>ä»<strong>å†…æ ¸æ€</strong>åˆ‡æ¢å›<strong>ç”¨æˆ·æ€</strong>ï¼Œå°†æ•°æ®ä»<strong>å†…æ ¸ç¼“å†²åŒº</strong>è¯»å…¥<strong>ç”¨æˆ·ç¼“å†²åŒº</strong>ï¼ˆå³ byte[] bufï¼‰ï¼Œè¿™æœŸé—´ cpu ä¼šå‚ä¸æ‹·è´ï¼Œæ— æ³•åˆ©ç”¨ DMA</p></li><li><p>è°ƒç”¨ write æ–¹æ³•ï¼Œè¿™æ—¶å°†æ•°æ®ä»<strong>ç”¨æˆ·ç¼“å†²åŒº</strong>ï¼ˆbyte[] bufï¼‰å†™å…¥ <strong>socket ç¼“å†²åŒº</strong>ï¼Œcpu ä¼šå‚ä¸æ‹·è´</p></li><li><p>æ¥ä¸‹æ¥è¦å‘ç½‘å¡å†™æ•°æ®ï¼Œè¿™é¡¹èƒ½åŠ› java åˆä¸å…·å¤‡ï¼Œå› æ­¤åˆå¾—ä»<strong>ç”¨æˆ·æ€</strong>åˆ‡æ¢è‡³<strong>å†…æ ¸æ€</strong>ï¼Œè°ƒç”¨æ“ä½œç³»ç»Ÿçš„å†™èƒ½åŠ›ï¼Œä½¿ç”¨ DMA å°† <strong>socket ç¼“å†²åŒº</strong>çš„æ•°æ®å†™å…¥ç½‘å¡ï¼Œä¸ä¼šä½¿ç”¨ cpu</p></li></ol><p>å¯ä»¥çœ‹åˆ°ä¸­é—´ç¯èŠ‚è¾ƒå¤šï¼Œjava çš„ IO å®é™…ä¸æ˜¯ç‰©ç†è®¾å¤‡çº§åˆ«çš„è¯»å†™ï¼Œè€Œæ˜¯ç¼“å­˜çš„å¤åˆ¶ï¼Œåº•å±‚çš„çœŸæ­£è¯»å†™æ˜¯æ“ä½œç³»ç»Ÿæ¥å®Œæˆçš„</p><ul><li>ç”¨æˆ·æ€ä¸å†…æ ¸æ€çš„åˆ‡æ¢å‘ç”Ÿäº† 3 æ¬¡ï¼Œè¿™ä¸ªæ“ä½œæ¯”è¾ƒé‡é‡çº§(ç¬¬ä¸€æ¬¡æ˜¯è°ƒç”¨read()æ–¹æ³•ä»ç”¨æˆ·æ€åˆ°å†…æ ¸æ€ï¼Œç¬¬äºŒæ¬¡æ˜¯read()æ–¹æ³•ç»“æŸä»å†…æ ¸æ€åˆ°ç”¨æˆ·æ€ï¼Œç¬¬ä¸‰æ¬¡æ˜¯è°ƒç”¨write()æ–¹æ³•ä»ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€)</li><li>æ•°æ®æ‹·è´äº†å…± 4 æ¬¡</li></ul><h4 id="NIO-ä¼˜åŒ–"><a href="#NIO-ä¼˜åŒ–" class="headerlink" title="NIO ä¼˜åŒ–"></a>NIO ä¼˜åŒ–</h4><p>é€šè¿‡ DirectByteBuf </p><ul><li>ByteBuffer.allocate(10)  HeapByteBuffer ä½¿ç”¨çš„è¿˜æ˜¯ java å†…å­˜</li><li>ByteBuffer.allocateDirect(10)  DirectByteBuffer ä½¿ç”¨çš„æ˜¯æ“ä½œç³»ç»Ÿå†…å­˜ï¼ˆè¿™å—æ“ä½œç³»ç»Ÿå†…å­˜æ¯”è¾ƒç‰¹æ®Šï¼ŒJavaç¨‹åºå’Œæ“ä½œç³»ç»Ÿå‡å¯è®¿é—®ï¼‰</li></ul><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/0025.png"></p><p>å¤§éƒ¨åˆ†æ­¥éª¤ä¸ä¼˜åŒ–å‰ç›¸åŒï¼Œä¸å†èµ˜è¿°ã€‚å”¯æœ‰ä¸€ç‚¹ï¼šjava å¯ä»¥ä½¿ç”¨ DirectByteBuf å°†å †å¤–å†…å­˜æ˜ å°„ï¼ˆ<strong>mmap</strong>ï¼‰åˆ° jvm å†…å­˜ä¸­æ¥ç›´æ¥è®¿é—®ä½¿ç”¨</p><ul><li>è¿™å—å†…å­˜ä¸å— jvm åƒåœ¾å›æ”¶çš„å½±å“ï¼Œå› æ­¤å†…å­˜åœ°å€å›ºå®šï¼Œæœ‰åŠ©äº IO è¯»å†™</li><li>java ä¸­çš„ DirectByteBuf å¯¹è±¡ä»…ç»´æŠ¤äº†æ­¤å†…å­˜çš„è™šå¼•ç”¨ï¼Œå†…å­˜å›æ”¶åˆ†æˆä¸¤æ­¥<ul><li>DirectByteBuf å¯¹è±¡è¢«åƒåœ¾å›æ”¶ï¼Œå°†è™šå¼•ç”¨åŠ å…¥å¼•ç”¨é˜Ÿåˆ—</li><li>é€šè¿‡ä¸“é—¨çº¿ç¨‹è®¿é—®å¼•ç”¨é˜Ÿåˆ—ï¼Œæ ¹æ®è™šå¼•ç”¨é‡Šæ”¾å †å¤–å†…å­˜</li></ul></li><li>å‡å°‘äº†ä¸€æ¬¡æ•°æ®æ‹·è´ï¼Œç”¨æˆ·æ€ä¸å†…æ ¸æ€çš„åˆ‡æ¢æ¬¡æ•°æ²¡æœ‰å‡å°‘</li></ul><p>è¿›ä¸€æ­¥ä¼˜åŒ–ï¼ˆåº•å±‚é‡‡ç”¨äº† linux 2.1 åæä¾›çš„ sendFile æ–¹æ³•ï¼‰ï¼Œjava ä¸­å¯¹åº”ç€ä¸¤ä¸ª channel è°ƒç”¨ transferTo/transferFrom æ–¹æ³•æ‹·è´æ•°æ®</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/0026.png"></p><ol><li>java è°ƒç”¨ transferTo æ–¹æ³•åï¼Œè¦ä» java ç¨‹åºçš„<strong>ç”¨æˆ·æ€</strong>åˆ‡æ¢è‡³<strong>å†…æ ¸æ€</strong>ï¼Œä½¿ç”¨ DMAå°†æ•°æ®è¯»å…¥<strong>å†…æ ¸ç¼“å†²åŒº</strong>ï¼Œä¸ä¼šä½¿ç”¨ cpu</li><li>æ•°æ®ä»<strong>å†…æ ¸ç¼“å†²åŒº</strong>ä¼ è¾“åˆ° <strong>socket ç¼“å†²åŒº</strong>ï¼Œcpu ä¼šå‚ä¸æ‹·è´</li><li>æœ€åä½¿ç”¨ DMA å°† <strong>socket ç¼“å†²åŒº</strong>çš„æ•°æ®å†™å…¥ç½‘å¡ï¼Œä¸ä¼šä½¿ç”¨ cpu</li></ol><p>å¯ä»¥çœ‹åˆ°</p><ul><li>åªå‘ç”Ÿäº†ä¸€æ¬¡ç”¨æˆ·æ€ä¸å†…æ ¸æ€çš„åˆ‡æ¢</li><li>æ•°æ®æ‹·è´äº† 3 æ¬¡</li></ul><p>è¿›ä¸€æ­¥ä¼˜åŒ–ï¼ˆlinux 2.4ï¼‰</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20230503203231669.png"></p><ol><li>java è°ƒç”¨ transferTo æ–¹æ³•åï¼Œè¦ä» java ç¨‹åºçš„<strong>ç”¨æˆ·æ€</strong>åˆ‡æ¢è‡³<strong>å†…æ ¸æ€</strong>ï¼Œä½¿ç”¨ DMAå°†æ•°æ®è¯»å…¥<strong>å†…æ ¸ç¼“å†²åŒº</strong>ï¼Œä¸ä¼šä½¿ç”¨ cpu</li><li>åªä¼šå°†ä¸€äº› offset å’Œ length ä¿¡æ¯æ‹·å…¥ <strong>socket ç¼“å†²åŒº</strong>ï¼Œå‡ ä¹æ— æ¶ˆè€—</li><li>ä½¿ç”¨ DMA å°† <strong>å†…æ ¸ç¼“å†²åŒº</strong>çš„æ•°æ®å†™å…¥ç½‘å¡ï¼Œä¸ä¼šä½¿ç”¨ cpu</li></ol><p>æ•´ä¸ªè¿‡ç¨‹ä»…åªå‘ç”Ÿäº†ä¸€æ¬¡ç”¨æˆ·æ€ä¸å†…æ ¸æ€çš„åˆ‡æ¢ï¼Œæ•°æ®æ‹·è´äº† 2 æ¬¡ã€‚æ‰€è°“çš„ã€é›¶æ‹·è´ã€‘ï¼Œå¹¶ä¸æ˜¯çœŸæ­£æ— æ‹·è´ï¼Œè€Œæ˜¯åœ¨ä¸ä¼šæ‹·è´é‡å¤æ•°æ®åˆ° jvm å†…å­˜ä¸­ï¼Œé›¶æ‹·è´çš„ä¼˜ç‚¹æœ‰</p><ul><li>æ›´å°‘çš„ç”¨æˆ·æ€ä¸å†…æ ¸æ€çš„åˆ‡æ¢</li><li>ä¸åˆ©ç”¨ cpu è®¡ç®—ï¼Œå‡å°‘ cpu ç¼“å­˜ä¼ªå…±äº«ï¼Œdirect memory accessï¼ˆDMAï¼‰ ç›´æ¥å†…å­˜è®¿é—®ï¼Œç¡¬ä»¶ç›´æ¥æ”¯æŒï¼Œä¸ç”¨cpuå‚ä¸ã€‚</li><li>é›¶æ‹·è´é€‚åˆå°æ–‡ä»¶ä¼ è¾“ï¼ˆå¤§æ–‡ä»¶éœ€è¦ä¸€æ¬¡æ€§åŠ è½½åˆ°å†…æ ¸ç¼“å†²åŒºï¼Œä¼šå½±å“å…¶ä»–æ–‡ä»¶çš„è¯»å–ï¼‰</li></ul><h3 id="5-3-AIO"><a href="#5-3-AIO" class="headerlink" title="5.3 AIO"></a>5.3 AIO</h3><p>AIO ç”¨æ¥è§£å†³æ•°æ®å¤åˆ¶é˜¶æ®µçš„é˜»å¡é—®é¢˜</p><ul><li>åŒæ­¥æ„å‘³ç€ï¼Œåœ¨è¿›è¡Œè¯»å†™æ“ä½œæ—¶ï¼Œçº¿ç¨‹éœ€è¦ç­‰å¾…ç»“æœï¼Œè¿˜æ˜¯ç›¸å½“äºé—²ç½®</li><li>å¼‚æ­¥æ„å‘³ç€ï¼Œåœ¨è¿›è¡Œè¯»å†™æ“ä½œæ—¶ï¼Œçº¿ç¨‹ä¸å¿…ç­‰å¾…ç»“æœï¼Œè€Œæ˜¯å°†æ¥ç”±æ“ä½œç³»ç»Ÿæ¥é€šè¿‡å›è°ƒæ–¹å¼ç”±å¦å¤–çš„çº¿ç¨‹æ¥è·å¾—ç»“æœ</li></ul><blockquote><p>å¼‚æ­¥æ¨¡å‹éœ€è¦åº•å±‚æ“ä½œç³»ç»Ÿï¼ˆKernelï¼‰æä¾›æ”¯æŒ</p><ul><li>Windows ç³»ç»Ÿé€šè¿‡ IOCP å®ç°äº†çœŸæ­£çš„å¼‚æ­¥ IO</li><li>Linux ç³»ç»Ÿå¼‚æ­¥ IO åœ¨ 2.6 ç‰ˆæœ¬å¼•å…¥ï¼Œä½†å…¶åº•å±‚å®ç°è¿˜æ˜¯ç”¨å¤šè·¯å¤ç”¨æ¨¡æ‹Ÿäº†å¼‚æ­¥ IOï¼Œæ€§èƒ½æ²¡æœ‰ä¼˜åŠ¿</li></ul></blockquote><h4 id="æ–‡ä»¶-AIO"><a href="#æ–‡ä»¶-AIO" class="headerlink" title="æ–‡ä»¶ AIO"></a>æ–‡ä»¶ AIO</h4><p>å…ˆæ¥çœ‹çœ‹ AsynchronousFileChannel</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AioDemo1</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>        <span class="hljs-keyword">try</span>&#123;<br>            AsynchronousFileChannel s = AsynchronousFileChannel.open(Paths.get(<span class="hljs-string">&quot;1.txt&quot;</span>),ï¼ŒStandardOpenOption.READ);<br>            ByteBuffer buffer = ByteBuffer.allocate(<span class="hljs-number">2</span>);<br>            log.debug(<span class="hljs-string">&quot;begin...&quot;</span>);<br>            <span class="hljs-comment">// readå‚æ•°ï¼š</span><br>            <span class="hljs-comment">//å‚æ•°1 ByteBuffer </span><br>            <span class="hljs-comment">//å‚æ•°2è¯»å–çš„èµ·å§‹ä½ç½® </span><br>            <span class="hljs-comment">//å‚æ•°3é™„ä»¶ </span><br>            <span class="hljs-comment">//å‚æ•°4å›è°ƒå¯¹è±¡ CompletionHandlerå¯¹è±¡</span><br>            s.read(buffer, <span class="hljs-number">0</span>, <span class="hljs-keyword">null</span>, <span class="hljs-keyword">new</span> CompletionHandler&lt;Integer, ByteBuffer&gt;() &#123;<br>                <span class="hljs-comment">//readæˆåŠŸ</span><br>                <span class="hljs-meta">@Override</span><br>                <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">completed</span><span class="hljs-params">(Integer result, ByteBuffer attachment)</span> </span>&#123;<br>                    log.debug(<span class="hljs-string">&quot;read completed...&#123;&#125;&quot;</span>, result);<br>                    buffer.flip();<br>                    debug(buffer);<br>                &#125;<br><br>                <span class="hljs-comment">//readå¤±è´¥</span><br>                <span class="hljs-meta">@Override</span><br>                <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">failed</span><span class="hljs-params">(Throwable exc, ByteBuffer attachment)</span> </span>&#123;<br>                    log.debug(<span class="hljs-string">&quot;read failed...&quot;</span>);<br>                &#125;<br>            &#125;);<br><br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>        log.debug(<span class="hljs-string">&quot;do other things...&quot;</span>);<br>        System.in.read();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">13:44:56 [DEBUG] [main] c.i.aio.AioDemo1 - begin...<br>13:44:56 [DEBUG] [main] c.i.aio.AioDemo1 - do other things...<br>13:44:56 [DEBUG] [Thread-5] c.i.aio.AioDemo1 - read completed...2<br><span class="hljs-code">         +-------------------------------------------------+</span><br><span class="hljs-section">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br><span class="hljs-section">|00000000| 61 0d                                           |a.              |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°</p><ul><li>å“åº”æ–‡ä»¶è¯»å–æˆåŠŸçš„æ˜¯å¦ä¸€ä¸ªçº¿ç¨‹ Thread-5</li><li>ä¸»çº¿ç¨‹å¹¶æ²¡æœ‰ IO æ“ä½œé˜»å¡</li></ul><h4 id="ğŸ’¡-å®ˆæŠ¤çº¿ç¨‹"><a href="#ğŸ’¡-å®ˆæŠ¤çº¿ç¨‹" class="headerlink" title="ğŸ’¡ å®ˆæŠ¤çº¿ç¨‹"></a>ğŸ’¡ å®ˆæŠ¤çº¿ç¨‹</h4><p>é»˜è®¤æ–‡ä»¶ AIO ä½¿ç”¨çš„çº¿ç¨‹éƒ½æ˜¯å®ˆæŠ¤çº¿ç¨‹ï¼Œæ‰€ä»¥æœ€åè¦æ‰§è¡Œ <code>System.in.read()</code> ä»¥é¿å…å®ˆæŠ¤çº¿ç¨‹æ„å¤–ç»“æŸ</p><h4 id="ç½‘ç»œ-AIO"><a href="#ç½‘ç»œ-AIO" class="headerlink" title="ç½‘ç»œ AIO"></a>ç½‘ç»œ AIO</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AioServer</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>        AsynchronousServerSocketChannel ssc = AsynchronousServerSocketChannel.open();<br>        ssc.bind(<span class="hljs-keyword">new</span> InetSocketAddress(<span class="hljs-number">8080</span>));<br>        ssc.accept(<span class="hljs-keyword">null</span>, <span class="hljs-keyword">new</span> AcceptHandler(ssc));<br>        System.in.read();<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">closeChannel</span><span class="hljs-params">(AsynchronousSocketChannel sc)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            System.out.printf(<span class="hljs-string">&quot;[%s] %s close\n&quot;</span>, Thread.currentThread().getName(), sc.getRemoteAddress());<br>            sc.close();<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ReadHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">CompletionHandler</span>&lt;<span class="hljs-title">Integer</span>, <span class="hljs-title">ByteBuffer</span>&gt; </span>&#123;<br>        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> AsynchronousSocketChannel sc;<br><br>        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ReadHandler</span><span class="hljs-params">(AsynchronousSocketChannel sc)</span> </span>&#123;<br>            <span class="hljs-keyword">this</span>.sc = sc;<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">completed</span><span class="hljs-params">(Integer result, ByteBuffer attachment)</span> </span>&#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-keyword">if</span> (result == -<span class="hljs-number">1</span>) &#123;<br>                    closeChannel(sc);<br>                    <span class="hljs-keyword">return</span>;<br>                &#125;<br>                System.out.printf(<span class="hljs-string">&quot;[%s] %s read\n&quot;</span>, Thread.currentThread().getName(), sc.getRemoteAddress());<br>                attachment.flip();<br>                System.out.println(Charset.defaultCharset().decode(attachment));<br>                attachment.clear();<br>                <span class="hljs-comment">// å¤„ç†å®Œç¬¬ä¸€ä¸ª read æ—¶ï¼Œéœ€è¦å†æ¬¡è°ƒç”¨ read æ–¹æ³•æ¥å¤„ç†ä¸‹ä¸€ä¸ª read äº‹ä»¶</span><br>                sc.read(attachment, attachment, <span class="hljs-keyword">this</span>);<br>            &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">failed</span><span class="hljs-params">(Throwable exc, ByteBuffer attachment)</span> </span>&#123;<br>            closeChannel(sc);<br>            exc.printStackTrace();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WriteHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">CompletionHandler</span>&lt;<span class="hljs-title">Integer</span>, <span class="hljs-title">ByteBuffer</span>&gt; </span>&#123;<br>        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> AsynchronousSocketChannel sc;<br><br>        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">WriteHandler</span><span class="hljs-params">(AsynchronousSocketChannel sc)</span> </span>&#123;<br>            <span class="hljs-keyword">this</span>.sc = sc;<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">completed</span><span class="hljs-params">(Integer result, ByteBuffer attachment)</span> </span>&#123;<br>            <span class="hljs-comment">// å¦‚æœä½œä¸ºé™„ä»¶çš„ buffer è¿˜æœ‰å†…å®¹ï¼Œéœ€è¦å†æ¬¡ write å†™å‡ºå‰©ä½™å†…å®¹</span><br>            <span class="hljs-keyword">if</span> (attachment.hasRemaining()) &#123;<br>                sc.write(attachment);<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">failed</span><span class="hljs-params">(Throwable exc, ByteBuffer attachment)</span> </span>&#123;<br>            exc.printStackTrace();<br>            closeChannel(sc);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AcceptHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">CompletionHandler</span>&lt;<span class="hljs-title">AsynchronousSocketChannel</span>, <span class="hljs-title">Object</span>&gt; </span>&#123;<br>        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> AsynchronousServerSocketChannel ssc;<br><br>        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">AcceptHandler</span><span class="hljs-params">(AsynchronousServerSocketChannel ssc)</span> </span>&#123;<br>            <span class="hljs-keyword">this</span>.ssc = ssc;<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">completed</span><span class="hljs-params">(AsynchronousSocketChannel sc, Object attachment)</span> </span>&#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                System.out.printf(<span class="hljs-string">&quot;[%s] %s connected\n&quot;</span>, Thread.currentThread().getName(), sc.getRemoteAddress());<br>            &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>                e.printStackTrace();<br>            &#125;<br>            ByteBuffer buffer = ByteBuffer.allocate(<span class="hljs-number">16</span>);<br>            <span class="hljs-comment">// è¯»äº‹ä»¶ç”± ReadHandler å¤„ç†</span><br>            sc.read(buffer, buffer, <span class="hljs-keyword">new</span> ReadHandler(sc));<br>            <span class="hljs-comment">// å†™äº‹ä»¶ç”± WriteHandler å¤„ç†</span><br>            sc.write(Charset.defaultCharset().encode(<span class="hljs-string">&quot;server hello!&quot;</span>), ByteBuffer.allocate(<span class="hljs-number">16</span>), <span class="hljs-keyword">new</span> WriteHandler(sc));<br>            <span class="hljs-comment">// å¤„ç†å®Œç¬¬ä¸€ä¸ª accpet æ—¶ï¼Œéœ€è¦å†æ¬¡è°ƒç”¨ accept æ–¹æ³•æ¥å¤„ç†ä¸‹ä¸€ä¸ª accept äº‹ä»¶</span><br>            ssc.accept(<span class="hljs-keyword">null</span>, <span class="hljs-keyword">this</span>);<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">failed</span><span class="hljs-params">(Throwable exc, Object attachment)</span> </span>&#123;<br>            exc.printStackTrace();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="æ°´å¹³è§¦å‘å’Œè¾¹æ²¿è§¦å‘"><a href="#æ°´å¹³è§¦å‘å’Œè¾¹æ²¿è§¦å‘" class="headerlink" title="æ°´å¹³è§¦å‘å’Œè¾¹æ²¿è§¦å‘"></a>æ°´å¹³è§¦å‘å’Œè¾¹æ²¿è§¦å‘</h4><p>epollæ¨¡å¼ä¸‹çš„æ°´å¹³è§¦å‘ã€è¾¹æ²¿è§¦å‘</p><p>1ï¼Œepollé»˜è®¤æ˜¯æ°´å¹³è§¦å‘</p><p>2ï¼Œæ°´å¹³è§¦å‘é€šä¿—æ¥è®²ï¼šåªè¦æœ‰æ•°æ®ï¼Œepoll_waitå‡½æ•°å°±ä¸€ç›´è¿”å›ï¼›è¾¹æ²¿è§¦å‘é€šä¿—æ¥è®²ï¼šåªæœ‰socketçŠ¶æ€å‘ç”Ÿå˜åŒ–ï¼Œepoll_waitå‡½æ•°æ‰ä¼šè¿”å›ã€‚</p><p>3ï¼Œæ°´å¹³è§¦å‘ä¼˜ã€ç¼ºç‚¹åŠåº”ç”¨åœºæ™¯ï¼š</p><p>ä¼˜ç‚¹ï¼šå½“è¿›è¡Œsocketé€šä¿¡çš„æ—¶å€™ï¼Œä¿è¯äº†æ•°æ®çš„å®Œæ•´è¾“å‡ºï¼Œè¿›è¡ŒIOæ“ä½œçš„æ—¶å€™ï¼Œå¦‚æœè¿˜æœ‰æ•°æ®ï¼Œå°±ä¼šä¸€ç›´çš„é€šçŸ¥ä½ ã€‚</p><p>ç¼ºç‚¹ï¼šç”±äºåªè¦è¿˜æœ‰æ•°æ®ï¼Œå†…æ ¸å°±ä¼šä¸åœçš„ä»å†…æ ¸ç©ºé—´è½¬åˆ°ç”¨æˆ·ç©ºé—´ï¼Œæ‰€æœ‰å ç”¨äº†å¤§é‡å†…æ ¸èµ„æºï¼Œè¯•æƒ³ä¸€ä¸‹å½“æœ‰å¤§é‡æ•°æ®åˆ°æ¥çš„æ—¶å€™ï¼Œæ¯æ¬¡è¯»å–ä¸€ä¸ªå­—èŠ‚ï¼Œè¿™æ ·å°±ä¼šä¸åœçš„è¿›è¡Œåˆ‡æ¢ã€‚å†…æ ¸èµ„æºçš„æµªè´¹ä¸¥é‡ã€‚æ•ˆç‡æ¥è®²ä¹Ÿæ˜¯å¾ˆä½çš„ã€‚</p><p>åº”ç”¨åœºæ™¯ï¼š</p><p>4ï¼Œè¾¹æ²¿è§¦å‘ä¼˜ã€ç¼ºç‚¹åŠåº”ç”¨åœºæ™¯ï¼š</p><p>ä¼˜ç‚¹ï¼šæ¯æ¬¡å†…æ ¸åªä¼šé€šçŸ¥ä¸€æ¬¡ï¼Œå¤§å¤§å‡å°‘äº†å†…æ ¸èµ„æºçš„æµªè´¹ï¼Œæé«˜æ•ˆç‡ã€‚</p><p>ç¼ºç‚¹ï¼šä¸èƒ½ä¿è¯æ•°æ®çš„å®Œæ•´ã€‚ä¸èƒ½åŠæ—¶çš„å–å‡ºæ‰€æœ‰çš„æ•°æ®ã€‚</p><p>åº”ç”¨åœºæ™¯ï¼šå¤„ç†å¤§æ•°æ®ã€‚ä½¿ç”¨non-blockæ¨¡å¼çš„socketã€‚</p><p>æ€»ç»“ï¼š</p><p>å¦‚æœæˆ‘ä»¬ç”¨æ°´å¹³è§¦å‘ä¸ç”¨æ‹…å¿ƒæ•°æ®æœ‰æ²¡æœ‰è¯»å®Œå› ä¸ºä¸‹æ¬¡epollè¿”å›æ—¶ï¼Œæ²¡æœ‰è¯»å®Œçš„socketä¾ç„¶ä¼šè¢«è¿”å›ï¼Œä½†æ˜¯è¦æ³¨æ„è¿™ç§æ¨¡å¼ä¸‹çš„å†™äº‹ä»¶ï¼Œå› ä¸ºæ˜¯æ°´å¹³è§¦å‘ï¼Œæ¯æ¬¡socketå¯å†™æ—¶epolléƒ½ä¼šè¿”å›ï¼Œå½“æˆ‘ä»¬å†™çš„æ•°æ®åŒ…è¿‡å¤§æ—¶ï¼Œä¸€æ¬¡å†™ä¸å®Œï¼Œè¦å¤šæ¬¡æ‰èƒ½å†™å®Œæˆ–è€…æ¯æ¬¡socketå†™éƒ½å†™ä¸€ä¸ªå¾ˆå°çš„æ•°æ®åŒ…æ—¶ï¼Œæ¯æ¬¡å†™éƒ½ä¼šè¢«epollæ£€æµ‹åˆ°ï¼Œå› æ­¤é•¿æœŸå…³æ³¨socketå†™äº‹ä»¶ä¼šæ— æ•…cpuæ¶ˆè€—è¿‡å¤§ç”šè‡³å¯¼è‡´cpuè·‘æ»¡ï¼Œæ‰€ä»¥åœ¨æ°´å¹³è§¦å‘æ¨¡å¼ä¸‹æˆ‘ä»¬ä¸€èˆ¬ä¸å…³æ³¨socketå¯å†™äº‹ä»¶è€Œæ˜¯é€šè¿‡è°ƒç”¨socket writeæˆ–è€…send apiå‡½æ•°æ¥å†™socketï¼Œè¯´åˆ°è¿™æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™ç§æ¨¡å¼åœ¨æ•ˆç‡ä¸Šæ˜¯æ²¡æœ‰è¾¹ç¼˜è§¦å‘é«˜çš„ï¼Œå› ä¸ºæ¯ä¸ªsocketè¯»æˆ–è€…å†™å¯èƒ½è¢«è¿”å›ä¸¤æ¬¡ç”šè‡³å¤šæ¬¡ï¼Œæ‰€ä»¥æœ‰æ—¶å€™æˆ‘ä»¬ä¹Ÿä¼šç”¨åˆ°è¾¹ç¼˜è§¦å‘ä½†æ˜¯è¿™ç§æ¨¡å¼ä¸‹åœ¨è¯»æ•°æ®çš„æ—¶å€™ä¸€å®šè¦æ³¨æ„ï¼Œå› ä¸ºå¦‚æœä¸€æ¬¡å¯å†™äº‹ä»¶æˆ‘ä»¬æ²¡æœ‰æŠŠæ•°æ®è¯»å®Œï¼Œå¦‚æœæ²¡æœ‰è¯»å®Œï¼Œåœ¨socketæ²¡æœ‰æ–°çš„æ•°æ®å¯è¯»æ—¶epollå°±ä¸å›è¿”å›äº†ï¼Œåªæœ‰åœ¨æ–°çš„æ•°æ®åˆ°æ¥æ—¶ï¼Œæˆ‘ä»¬æ‰èƒ½è¯»å–åˆ°ä¸Šæ¬¡æ²¡æœ‰è¯»å®Œçš„æ•°æ®ã€‚</p><h1 id="äºŒ-Netty-å…¥é—¨"><a href="#äºŒ-Netty-å…¥é—¨" class="headerlink" title="äºŒ. Netty å…¥é—¨"></a>äºŒ. Netty å…¥é—¨</h1><h2 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="1. æ¦‚è¿°"></a>1. æ¦‚è¿°</h2><h3 id="1-1-Netty-æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#1-1-Netty-æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="1.1 Netty æ˜¯ä»€ä¹ˆï¼Ÿ"></a>1.1 Netty æ˜¯ä»€ä¹ˆï¼Ÿ</h3><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs applescript">Netty <span class="hljs-keyword">is</span> an asynchronous event-driven network <span class="hljs-built_in">application</span> framework<br><span class="hljs-keyword">for</span> rapid development <span class="hljs-keyword">of</span> maintainable high performance protocol servers &amp; clients.<br></code></pre></td></tr></table></figure><p>Netty æ˜¯ä¸€ä¸ªå¼‚æ­¥çš„ã€åŸºäºäº‹ä»¶é©±åŠ¨çš„ç½‘ç»œåº”ç”¨æ¡†æ¶ï¼Œç”¨äºå¿«é€Ÿå¼€å‘å¯ç»´æŠ¤ã€é«˜æ€§èƒ½çš„ç½‘ç»œæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ã€‚</p><blockquote><p>è¿™é‡Œè¯´çš„å¼‚æ­¥ä¸æ˜¯æŒ‡å¼‚æ­¥IOï¼ŒNettyåº•å±‚ä½¿ç”¨çš„è¿˜æ˜¯åŒæ­¥å¤šè·¯å¤ç”¨ã€‚è¿™é‡Œçš„å¼‚æ­¥æ˜¯æŒ‡ï¼Œä½¿ç”¨å¤šçº¿ç¨‹å°†æ–¹æ³•è°ƒç”¨å’Œå¤„ç†ç»“æœç›¸åˆ†ç¦»ï¼ˆäºŒè€…å¯ä»¥ä¸æ˜¯åŒä¸€ä¸ªçº¿ç¨‹å¤„ç†ï¼‰ï¼Œç§°ä¸ºå¼‚æ­¥ã€‚</p></blockquote><h3 id="1-2-Netty-çš„ä½œè€…"><a href="#1-2-Netty-çš„ä½œè€…" class="headerlink" title="1.2 Netty çš„ä½œè€…"></a>1.2 Netty çš„ä½œè€…</h3><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20230503203427987.png"></p><p>ä»–è¿˜æ˜¯å¦ä¸€ä¸ªè‘—åç½‘ç»œåº”ç”¨æ¡†æ¶ Mina çš„é‡è¦è´¡çŒ®è€…</p><h3 id="1-3-Netty-çš„åœ°ä½"><a href="#1-3-Netty-çš„åœ°ä½" class="headerlink" title="1.3 Netty çš„åœ°ä½"></a>1.3 Netty çš„åœ°ä½</h3><p>Netty åœ¨ Java ç½‘ç»œåº”ç”¨æ¡†æ¶ä¸­çš„åœ°ä½å°±å¥½æ¯”ï¼šSpring æ¡†æ¶åœ¨ JavaEE å¼€å‘ä¸­çš„åœ°ä½</p><p>ä»¥ä¸‹çš„æ¡†æ¶éƒ½ä½¿ç”¨äº† Nettyï¼Œå› ä¸ºå®ƒä»¬æœ‰ç½‘ç»œé€šä¿¡éœ€æ±‚ï¼</p><ul><li>Cassandra - nosql æ•°æ®åº“</li><li>Spark - å¤§æ•°æ®åˆ†å¸ƒå¼è®¡ç®—æ¡†æ¶</li><li>Hadoop - å¤§æ•°æ®åˆ†å¸ƒå¼å­˜å‚¨æ¡†æ¶</li><li>RocketMQ - ali å¼€æºçš„æ¶ˆæ¯é˜Ÿåˆ—</li><li>ElasticSearch - æœç´¢å¼•æ“</li><li>gRPC - rpc æ¡†æ¶</li><li>Dubbo - rpc æ¡†æ¶</li><li>Spring 5.x - flux api å®Œå…¨æŠ›å¼ƒäº† tomcat ï¼Œä½¿ç”¨ netty ä½œä¸ºæœåŠ¡å™¨ç«¯</li><li>Zookeeper - åˆ†å¸ƒå¼åè°ƒæ¡†æ¶</li></ul><h3 id="1-4-Netty-çš„ä¼˜åŠ¿"><a href="#1-4-Netty-çš„ä¼˜åŠ¿" class="headerlink" title="1.4 Netty çš„ä¼˜åŠ¿"></a>1.4 Netty çš„ä¼˜åŠ¿</h3><ul><li>Netty vs NIOï¼Œå·¥ä½œé‡å¤§ï¼Œbug å¤š<ul><li>éœ€è¦è‡ªå·±æ„å»ºåè®®</li><li>è§£å†³ TCP ä¼ è¾“é—®é¢˜ï¼Œå¦‚ç²˜åŒ…ã€åŠåŒ…</li><li>epoll ç©ºè½®è¯¢å¯¼è‡´ CPU 100%ï¼ˆlinuxçš„epollå¤šè·¯å¤ç”¨æœ‰ä¸€ä¸ªä¸¥é‡çš„bugï¼Œä¼šå¯¼è‡´CPU100%ï¼Œä¹Ÿå°±æ˜¯select()æ–¹æ³•ä¸èƒ½è¢«æ­£å¸¸é˜»å¡ï¼‰</li><li>å¯¹ API è¿›è¡Œå¢å¼ºï¼Œä½¿ä¹‹æ›´æ˜“ç”¨ï¼Œå¦‚ FastThreadLocal =&gt; ThreadLocalï¼ŒByteBuf =&gt; ByteBuffer</li></ul></li><li>Netty vs å…¶å®ƒç½‘ç»œåº”ç”¨æ¡†æ¶<ul><li>Mina ç”± apache ç»´æŠ¤ï¼Œå°†æ¥ 3.x ç‰ˆæœ¬å¯èƒ½ä¼šæœ‰è¾ƒå¤§é‡æ„ï¼Œç ´å APIçš„å‘ä¸‹å…¼å®¹æ€§ï¼ŒNetty çš„å¼€å‘è¿­ä»£æ›´è¿…é€Ÿï¼ŒAPI æ›´ç®€æ´ã€æ–‡æ¡£æ›´ä¼˜ç§€</li><li>ä¹…ç»è€ƒéªŒï¼Œå·²ç»å‘å±•äº†16å¹´ï¼ŒNetty ç‰ˆæœ¬<ul><li>2.x 2004</li><li>3.x 2008</li><li>4.x 2013</li><li>5.x å·²åºŸå¼ƒï¼ˆå¼•å…¥AIOï¼Œä½†æ²¡æœ‰æ˜æ˜¾çš„æ€§èƒ½æå‡ï¼Œç»´æŠ¤æˆæœ¬é«˜ï¼‰</li></ul></li></ul></li></ul><h2 id="2-Hello-World"><a href="#2-Hello-World" class="headerlink" title="2. Hello World"></a>2. Hello World</h2><h3 id="2-1-ç›®æ ‡"><a href="#2-1-ç›®æ ‡" class="headerlink" title="2.1 ç›®æ ‡"></a>2.1 ç›®æ ‡</h3><p>å¼€å‘ä¸€ä¸ªç®€å•çš„æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯</p><ul><li>å®¢æˆ·ç«¯å‘æœåŠ¡å™¨ç«¯å‘é€ hello, world</li><li>æœåŠ¡å™¨ä»…æ¥æ”¶ï¼Œä¸è¿”å›</li></ul><p>åŠ å…¥ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.netty<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>netty-all<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.1.39.Final<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="2-2-æœåŠ¡å™¨ç«¯"><a href="#2-2-æœåŠ¡å™¨ç«¯" class="headerlink" title="2.2 æœåŠ¡å™¨ç«¯"></a>2.2 æœåŠ¡å™¨ç«¯</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//å¯åŠ¨å™¨ï¼Œè´Ÿè´£ç»„è£… netty ç»„ä»¶ï¼Œå¯åŠ¨æœåŠ¡å™¨</span><br><span class="hljs-keyword">new</span> ServerBootstrap() <br>    <span class="hljs-comment">//BossEventLoop, WorkerEventLoop(setector, thread), group ç»„</span><br>    .group(<span class="hljs-keyword">new</span> NioEventLoopGroup()) <span class="hljs-comment">// 1</span><br>    <span class="hljs-comment">//é€‰æ‹© æœåŠ¡å™¨çš„ ServerSocketChanneLå®ç°</span><br>    .channel(NioServerSocketChannel.class) <span class="hljs-comment">// 2</span><br>    <span class="hljs-comment">//bossè´Ÿè´£å¤„ç†è¿æ¥worker(child)è´Ÿè´£å¤„ç†è¯»å†™,å†³å®šäº† worker(child)èƒ½æ‰§è¡Œå“ªäº›æ“ä½œ(handler)</span><br>    .childHandler(<br>    <span class="hljs-comment">//channel ä»£è¡¨å’Œå®¢æˆ·ç«¯è¿›è¡Œæ•°æ®è¯»å†™çš„é€šé“ Initializer åˆå§‹åŒ–,è´Ÿè´£æ·»åŠ åˆ«çš„ handler</span><br>    <span class="hljs-keyword">new</span> ChannelInitializer&lt;NioSocketChannel&gt;() &#123; <span class="hljs-comment">// 3</span><br>        <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initChannel</span><span class="hljs-params">(NioSocketChannel ch)</span> </span>&#123;<br>            <span class="hljs-comment">//æ·»åŠ å…·ä½“ handler</span><br>            ch.pipeline().addLast(<span class="hljs-keyword">new</span> StringDecoder()); <span class="hljs-comment">// 5 //å°† ByteBuf è½¬æ¢ä¸ºå­—ç¬¦ä¸²</span><br>            ch.pipeline().addLast(<span class="hljs-keyword">new</span> SimpleChannelInboundHandler&lt;String&gt;() &#123; <span class="hljs-comment">// 6 //è‡ªå®šä¹‰ handler</span><br>                <span class="hljs-meta">@Override</span> <span class="hljs-comment">//è¯»äº‹ä»¶</span><br>                <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">channelRead0</span><span class="hljs-params">(ChannelHandlerContext ctx, String msg)</span> </span>&#123;<br>                    <span class="hljs-comment">// æ‰“å°ä¸Šä¸€æ­¥è½¬æ¢å¥½çš„å­—ç¬¦ä¸²</span><br>                    System.out.println(msg);<br>                &#125;<br>            &#125;);<br>        &#125;<br>    &#125;)<br>    <span class="hljs-comment">//ç»‘å®šç›‘å¬ç«¯å£</span><br>    .bind(<span class="hljs-number">8080</span>); <span class="hljs-comment">// 4 </span><br></code></pre></td></tr></table></figure><p>ä»£ç è§£è¯»</p><ul><li><p>1 å¤„ï¼Œåˆ›å»º NioEventLoopGroupï¼Œå¯ä»¥ç®€å•ç†è§£ä¸º <code>çº¿ç¨‹æ±  + Selector</code> åé¢ä¼šè¯¦ç»†å±•å¼€</p></li><li><p>2 å¤„ï¼Œé€‰æ‹©æœåŠ¡ ServerSocketChannel å®ç°ç±»ï¼Œå…¶ä¸­ NioServerSocketChannel è¡¨ç¤ºåŸºäº NIO çš„æœåŠ¡å™¨ç«¯å®ç°ï¼Œå…¶å®ƒå®ç°è¿˜æœ‰</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20230503203447852.png"></p></li><li><p>3 å¤„ï¼Œä¸ºå•¥æ–¹æ³•å« childHandlerï¼Œæ˜¯æ¥ä¸‹æ¥æ·»åŠ çš„å¤„ç†å™¨éƒ½æ˜¯ç»™ SocketChannel ç”¨çš„ï¼Œè€Œä¸æ˜¯ç»™ ServerSocketChannelã€‚ChannelInitializer å¤„ç†å™¨ï¼ˆä»…æ‰§è¡Œä¸€æ¬¡ï¼‰ï¼Œå®ƒçš„ä½œç”¨æ˜¯å¾…å®¢æˆ·ç«¯ SocketChannel å»ºç«‹è¿æ¥åï¼Œæ‰§è¡Œ initChannel ä»¥ä¾¿æ·»åŠ æ›´å¤šçš„å¤„ç†å™¨</p></li><li><p>4 å¤„ï¼ŒServerSocketChannel ç»‘å®šçš„ç›‘å¬ç«¯å£</p></li><li><p>5 å¤„ï¼ŒSocketChannel çš„å¤„ç†å™¨ï¼Œè§£ç  ByteBuf =&gt; String</p></li><li><p>6 å¤„ï¼ŒSocketChannel çš„ä¸šåŠ¡å¤„ç†å™¨ï¼Œä½¿ç”¨ä¸Šä¸€ä¸ªå¤„ç†å™¨çš„å¤„ç†ç»“æœ</p></li></ul><h3 id="2-3-å®¢æˆ·ç«¯"><a href="#2-3-å®¢æˆ·ç«¯" class="headerlink" title="2.3 å®¢æˆ·ç«¯"></a>2.3 å®¢æˆ·ç«¯</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//å¯åŠ¨ç±»ï¼Œè´Ÿè´£ç»„è£… netty ç»„ä»¶</span><br><span class="hljs-keyword">new</span> Bootstrap() <br>    <span class="hljs-comment">//æ·»åŠ  EventLoop</span><br>    .group(<span class="hljs-keyword">new</span> NioEventLoopGroup()) <span class="hljs-comment">// 1</span><br>    <span class="hljs-comment">//é€‰æ‹©å®¢æˆ·ç«¯ channelå®ç°</span><br>    .channel(NioSocketChannel.class) <span class="hljs-comment">// 2</span><br>    <span class="hljs-comment">//æ·»åŠ å¤„ç†å™¨</span><br>    .handler(<span class="hljs-keyword">new</span> ChannelInitializer&lt;Channel&gt;() &#123; <span class="hljs-comment">// 3</span><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-comment">//åœ¨è¿æ¥å»ºç«‹åè¢«è°ƒç”¨</span><br>        <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initChannel</span><span class="hljs-params">(Channel ch)</span> </span>&#123;<br>            ch.pipeline().addLast(<span class="hljs-keyword">new</span> StringEncoder()); <span class="hljs-comment">// 8</span><br>        &#125;<br>    &#125;)<br>    <span class="hljs-comment">//è¿æ¥åˆ°æœåŠ¡å™¨</span><br>    .connect(<span class="hljs-string">&quot;127.0.0.1&quot;</span>, <span class="hljs-number">8080</span>) <span class="hljs-comment">// 4</span><br>    .sync() <span class="hljs-comment">// 5</span><br>    .channel() <span class="hljs-comment">// 6</span><br>    <span class="hljs-comment">//å‘æœåŠ¡å™¨å‘é€æ•°æ®</span><br>    .writeAndFlush(<span class="hljs-keyword">new</span> Date() + <span class="hljs-string">&quot;: hello world!&quot;</span>); <span class="hljs-comment">// 7</span><br></code></pre></td></tr></table></figure><p>ä»£ç è§£è¯»</p><ul><li><p>1 å¤„ï¼Œåˆ›å»º NioEventLoopGroupï¼ŒåŒ Server</p></li><li><p>2 å¤„ï¼Œé€‰æ‹©å®¢æˆ· Socket å®ç°ç±»ï¼ŒNioSocketChannel è¡¨ç¤ºåŸºäº NIO çš„å®¢æˆ·ç«¯å®ç°ï¼Œå…¶å®ƒå®ç°è¿˜æœ‰</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20230503203504493.png"></p></li><li><p>3 å¤„ï¼Œæ·»åŠ  SocketChannel çš„å¤„ç†å™¨ï¼ŒChannelInitializer å¤„ç†å™¨ï¼ˆä»…æ‰§è¡Œä¸€æ¬¡ï¼‰ï¼Œå®ƒçš„ä½œç”¨æ˜¯å¾…å®¢æˆ·ç«¯ SocketChannel å»ºç«‹è¿æ¥åï¼Œæ‰§è¡Œ initChannel ä»¥ä¾¿æ·»åŠ æ›´å¤šçš„å¤„ç†å™¨</p></li><li><p>4 å¤„ï¼ŒæŒ‡å®šè¦è¿æ¥çš„æœåŠ¡å™¨å’Œç«¯å£</p></li><li><p>5 å¤„ï¼ŒNetty ä¸­å¾ˆå¤šæ–¹æ³•éƒ½æ˜¯å¼‚æ­¥çš„ï¼Œå¦‚ connectï¼Œè¿™æ—¶éœ€è¦ä½¿ç”¨ sync æ–¹æ³•ç­‰å¾… connect å»ºç«‹è¿æ¥å®Œæ¯•</p></li><li><p>6 å¤„ï¼Œè·å– channel å¯¹è±¡ï¼Œå®ƒå³ä¸ºé€šé“æŠ½è±¡ï¼Œå¯ä»¥è¿›è¡Œæ•°æ®è¯»å†™æ“ä½œ</p></li><li><p>7 å¤„ï¼Œå†™å…¥æ¶ˆæ¯å¹¶æ¸…ç©ºç¼“å†²åŒº</p></li><li><p>8 å¤„ï¼Œæ¶ˆæ¯ä¼šç»è¿‡é€šé“ handler å¤„ç†ï¼Œè¿™é‡Œæ˜¯å°† String =&gt; ByteBuf å‘å‡º</p></li><li><p>æ•°æ®ç»è¿‡ç½‘ç»œä¼ è¾“ï¼Œåˆ°è¾¾æœåŠ¡å™¨ç«¯ï¼ŒæœåŠ¡å™¨ç«¯ 5 å’Œ 6 å¤„çš„ handler å…ˆåè¢«è§¦å‘ï¼Œèµ°å®Œä¸€ä¸ªæµç¨‹</p></li></ul><h3 id="2-4-æµç¨‹æ¢³ç†"><a href="#2-4-æµç¨‹æ¢³ç†" class="headerlink" title="2.4 æµç¨‹æ¢³ç†"></a>2.4 æµç¨‹æ¢³ç†</h3><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20230503203520736.png"></p><h4 id="ğŸ’¡-æç¤º"><a href="#ğŸ’¡-æç¤º" class="headerlink" title="ğŸ’¡ æç¤º"></a>ğŸ’¡ æç¤º</h4><blockquote><p>ä¸€å¼€å§‹éœ€è¦æ ‘ç«‹æ­£ç¡®çš„è§‚å¿µ</p><ul><li>æŠŠ channel ç†è§£ä¸ºæ•°æ®çš„é€šé“</li><li>æŠŠ msg ç†è§£ä¸ºæµåŠ¨çš„æ•°æ®ï¼Œæœ€å¼€å§‹è¾“å…¥æ˜¯ ByteBufï¼Œä½†ç»è¿‡ pipeline çš„åŠ å·¥ï¼Œä¼šå˜æˆå…¶å®ƒç±»å‹å¯¹è±¡ï¼Œæœ€åè¾“å‡ºåˆå˜æˆ ByteBuf</li><li>æŠŠ handler ç†è§£ä¸ºæ•°æ®çš„å¤„ç†å·¥åº<ul><li>å·¥åºæœ‰å¤šé“ï¼Œåˆåœ¨ä¸€èµ·å°±æ˜¯ pipelineï¼Œpipeline è´Ÿè´£å‘å¸ƒäº‹ä»¶ï¼ˆè¯»ã€è¯»å–å®Œæˆâ€¦ï¼‰ä¼ æ’­ç»™æ¯ä¸ª handlerï¼Œ handler å¯¹è‡ªå·±æ„Ÿå…´è¶£çš„äº‹ä»¶è¿›è¡Œå¤„ç†ï¼ˆé‡å†™äº†ç›¸åº”äº‹ä»¶å¤„ç†æ–¹æ³•ï¼‰</li><li>handler åˆ† Inbound(å…¥ç«™) å’Œ Outbound(å‡ºç«™) ä¸¤ç±»</li></ul></li><li>æŠŠ eventLoop ç†è§£ä¸ºå¤„ç†æ•°æ®çš„å·¥äºº<ul><li>å·¥äººå¯ä»¥ç®¡ç†å¤šä¸ª channel çš„ io æ“ä½œï¼Œå¹¶ä¸”ä¸€æ—¦å·¥äººè´Ÿè´£äº†æŸä¸ª channelï¼Œå°±è¦è´Ÿè´£åˆ°åº•ï¼ˆç»‘å®šï¼‰<strong>ç›®çš„æ˜¯ä¸ºäº†çº¿ç¨‹å®‰å…¨ï¼Œé˜²æ­¢å¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œåŒä¸€ä¸ªchannel</strong></li><li>å·¥äººæ—¢å¯ä»¥æ‰§è¡Œ io æ“ä½œï¼Œä¹Ÿå¯ä»¥è¿›è¡Œä»»åŠ¡å¤„ç†ï¼Œæ¯ä½å·¥äººæœ‰ä»»åŠ¡é˜Ÿåˆ—ï¼Œé˜Ÿåˆ—é‡Œå¯ä»¥å †æ”¾å¤šä¸ª channel çš„å¾…å¤„ç†ä»»åŠ¡ï¼Œä»»åŠ¡åˆ†ä¸ºæ™®é€šä»»åŠ¡ã€å®šæ—¶ä»»åŠ¡</li><li>å·¥äººæŒ‰ç…§ pipeline é¡ºåºï¼Œä¾æ¬¡æŒ‰ç…§ handler çš„è§„åˆ’ï¼ˆä»£ç ï¼‰å¤„ç†æ•°æ®ï¼Œå¯ä»¥ä¸ºæ¯é“å·¥åºï¼ˆéIOæ“ä½œçš„å·¥åºï¼‰æŒ‡å®šä¸åŒçš„å·¥äºº</li></ul></li></ul></blockquote><h2 id="3-ç»„ä»¶"><a href="#3-ç»„ä»¶" class="headerlink" title="3. ç»„ä»¶"></a>3. ç»„ä»¶</h2><h3 id="3-1-EventLoop"><a href="#3-1-EventLoop" class="headerlink" title="3.1 EventLoop"></a>3.1 EventLoop</h3><p>äº‹ä»¶å¾ªç¯å¯¹è±¡</p><p>EventLoop æœ¬è´¨æ˜¯ä¸€ä¸ªå•çº¿ç¨‹æ‰§è¡Œå™¨ï¼ˆåŒæ—¶ç»´æŠ¤äº†ä¸€ä¸ª Selectorï¼‰ï¼Œé‡Œé¢æœ‰ run æ–¹æ³•å¤„ç† Channel ä¸Šæºæºä¸æ–­çš„ io äº‹ä»¶ã€‚</p><p>å®ƒçš„ç»§æ‰¿å…³ç³»æ¯”è¾ƒå¤æ‚</p><ul><li>ä¸€æ¡çº¿æ˜¯ç»§æ‰¿è‡ª j.u.c.ScheduledExecutorService å› æ­¤åŒ…å«äº†çº¿ç¨‹æ± ä¸­æ‰€æœ‰çš„æ–¹æ³•</li><li>å¦ä¸€æ¡çº¿æ˜¯ç»§æ‰¿è‡ª netty è‡ªå·±çš„ OrderedEventExecutorï¼Œ<ul><li>æä¾›äº† boolean inEventLoop(Thread thread) æ–¹æ³•åˆ¤æ–­ä¸€ä¸ªçº¿ç¨‹æ˜¯å¦å±äºæ­¤ EventLoop</li><li>æä¾›äº† parent æ–¹æ³•æ¥çœ‹çœ‹è‡ªå·±å±äºå“ªä¸ª EventLoopGroup</li></ul></li></ul><blockquote><p>å•çº¿ç¨‹çš„çº¿ç¨‹æ± çš„æ„æ€æ˜¯ä»çº¿ç¨‹æ± é‡Œæ‹¿ä¸€ä¸ªçº¿ç¨‹ï¼Œä¸æ˜¯çº¿ç¨‹æ± é‡Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹ã€‚å’Œä¸€ä¸ªçº¿ç¨‹çš„åŒºåˆ«æ˜¯çº¿ç¨‹æ„å¤–ç»“æŸåï¼Œå¯ä»¥ç«‹é©¬ä»çº¿ç¨‹æ± é‡Œè°ƒä¸€ä¸ªçº¿ç¨‹</p></blockquote><p>äº‹ä»¶å¾ªç¯ç»„</p><p>EventLoopGroup æ˜¯ä¸€ç»„ EventLoopï¼ŒChannel ä¸€èˆ¬ä¼šè°ƒç”¨ EventLoopGroup çš„ register æ–¹æ³•æ¥ç»‘å®šå…¶ä¸­ä¸€ä¸ª EventLoopï¼Œåç»­è¿™ä¸ª Channel ä¸Šçš„ io äº‹ä»¶éƒ½ç”±æ­¤ EventLoop æ¥å¤„ç†ï¼ˆä¿è¯äº† io äº‹ä»¶å¤„ç†æ—¶çš„çº¿ç¨‹å®‰å…¨ï¼‰ï¼Œå½“ç„¶Channelä¸Šçš„æ™®é€šä»»åŠ¡å’Œå®šæ—¶ä»»åŠ¡ä¹Ÿä¼šç»‘å®šå…¶ä¸­ä¸€ä¸ªEventLoopã€‚</p><ul><li>ç»§æ‰¿è‡ª netty è‡ªå·±çš„ EventExecutorGroup<ul><li>å®ç°äº† Iterable æ¥å£æä¾›éå† EventLoop çš„èƒ½åŠ›</li><li>å¦æœ‰ next æ–¹æ³•è·å–é›†åˆä¸­ä¸‹ä¸€ä¸ª EventLoop</li></ul></li></ul><blockquote><p>NioEventLoopGroupå¯ä»¥å¤„ç†IOäº‹ä»¶ã€æ™®é€šä»»åŠ¡ä»¥åŠå®šæ—¶ä»»åŠ¡ã€‚</p><p>DefaultEventLoopGroupå¯ä»¥å¤„ç†æ™®é€šä»»åŠ¡,å®šæ—¶ä»»åŠ¡</p></blockquote><p>ä»¥ä¸€ä¸ªç®€å•çš„å®ç°ä¸ºä¾‹ï¼š</p><p>åˆ›å»ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// å†…éƒ¨åˆ›å»ºäº†ä¸¤ä¸ª EventLoop, æ¯ä¸ª EventLoop ç»´æŠ¤ä¸€ä¸ªçº¿ç¨‹</span><br>DefaultEventLoopGroup group = <span class="hljs-keyword">new</span> DefaultEventLoopGroup(<span class="hljs-number">2</span>); <span class="hljs-comment">//å¦‚æœä¸æŒ‡å®šçº¿ç¨‹æ•°ï¼Œä¼šä»¥æ“ä½œç³»ç»Ÿæ ¸å¿ƒæ•°*2ä½œä¸ºæ ¸å¿ƒæ•°</span><br></code></pre></td></tr></table></figure><p>ä½¿ç”¨next()å–å‡ºEventLoopï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">System.out.println(group.next());<br>System.out.println(group.next());<br>System.out.println(group.next());<br></code></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">io</span>.netty.channel.DefaultEventLoop@<span class="hljs-number">60</span>f<span class="hljs-number">82</span>f<span class="hljs-number">98</span><br><span class="hljs-attribute">io</span>.netty.channel.DefaultEventLoop@<span class="hljs-number">35</span>f<span class="hljs-number">983</span>a<span class="hljs-number">6</span><br><span class="hljs-attribute">io</span>.netty.channel.DefaultEventLoop@<span class="hljs-number">60</span>f<span class="hljs-number">82</span>f<span class="hljs-number">98</span><br></code></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥ä½¿ç”¨ for å¾ªç¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">DefaultEventLoopGroup group = <span class="hljs-keyword">new</span> DefaultEventLoopGroup(<span class="hljs-number">2</span>);<br><span class="hljs-keyword">for</span> (EventExecutor eventLoop : group) &#123;<br>    System.out.println(eventLoop);<br>&#125;<br></code></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">io</span>.netty.channel.DefaultEventLoop@<span class="hljs-number">60</span>f<span class="hljs-number">82</span>f<span class="hljs-number">98</span><br><span class="hljs-attribute">io</span>.netty.channel.DefaultEventLoop@<span class="hljs-number">35</span>f<span class="hljs-number">983</span>a<span class="hljs-number">6</span><br></code></pre></td></tr></table></figure><p>ä½¿ç”¨EventLoopå¤„ç†æ™®é€šä»»åŠ¡ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">group.next().submit(() -&gt; &#123;<br>    System.out.println(<span class="hljs-string">&quot;ok&quot;</span>);<br>&#125;)<br></code></pre></td></tr></table></figure><h4 id="ğŸ’¡-ä¼˜é›…å…³é—­"><a href="#ğŸ’¡-ä¼˜é›…å…³é—­" class="headerlink" title="ğŸ’¡ ä¼˜é›…å…³é—­"></a>ğŸ’¡ ä¼˜é›…å…³é—­</h4><p>ä¼˜é›…å…³é—­ <code>shutdownGracefully</code> æ–¹æ³•ã€‚è¯¥æ–¹æ³•ä¼šé¦–å…ˆåˆ‡æ¢ <code>EventLoopGroup</code> åˆ°å…³é—­çŠ¶æ€ä»è€Œæ‹’ç»æ–°çš„ä»»åŠ¡çš„åŠ å…¥ï¼Œç„¶ååœ¨ä»»åŠ¡é˜Ÿåˆ—çš„ä»»åŠ¡éƒ½å¤„ç†å®Œæˆåï¼Œåœæ­¢çº¿ç¨‹çš„è¿è¡Œã€‚ä»è€Œç¡®ä¿æ•´ä½“åº”ç”¨æ˜¯åœ¨æ­£å¸¸æœ‰åºçš„çŠ¶æ€ä¸‹é€€å‡ºçš„</p><h4 id="æ¼”ç¤º-NioEventLoop-å¤„ç†-io-äº‹ä»¶"><a href="#æ¼”ç¤º-NioEventLoop-å¤„ç†-io-äº‹ä»¶" class="headerlink" title="æ¼”ç¤º NioEventLoop å¤„ç† io äº‹ä»¶"></a>æ¼”ç¤º NioEventLoop å¤„ç† io äº‹ä»¶</h4><p>æœåŠ¡å™¨ç«¯ä¸€ä¸ªbossEventLoopï¼Œä¸¤ä¸ª nio worker å·¥äºº</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">new</span> ServerBootstrap()<br>    <span class="hljs-comment">//ä¸€ä¸ªbossEventLoopä¸¤ä¸ªworkerEventLoopGroup</span><br>    <span class="hljs-comment">//bossEventLoop åªè´Ÿè´£ServerSocketChannelä¸Šçš„ accept äº‹ä»¶ï¼›workerEventLoop åªè´Ÿè´£SocketChannelä¸Šçš„è¯»å†™äº‹ä»¶</span><br>    <span class="hljs-comment">//  bossEventLoopåªä¼šæœ‰ä¸€ä¸ªçº¿ç¨‹ä¸ServerSocketChannelè¿›è¡Œç»‘å®šï¼ŒEventLoopGroupæœ¬è´¨ä¸Šæ˜¯ä¸ªçº¿ç¨‹æ± ï¼Œçº¿ç¨‹æ± åˆ›å»ºçº¿ç¨‹ä¸æ˜¯ä¸€æ¬¡æ€§åˆ›å»ºçš„ï¼Œå¦‚æœåªè°ƒç”¨ä¸€æ¬¡ï¼Œå°±åªåˆ›å»ºä¸€ä¸ªçº¿ç¨‹ã€‚æ‰€ä»¥è¿™é‡Œä¸è®ºæŒ‡å®šå‡ ä¸ªçº¿ç¨‹æ•°ï¼Œæœ€ç»ˆåªä¼šæœ‰ä¸€ä¸ªbossEventLoopã€‚</span><br>    <span class="hljs-comment">//workerEventLoopæ ¹æ®è‡ªå·±éœ€æ±‚è®¾ç½®çº¿ç¨‹æ•°</span><br>    .group(<span class="hljs-keyword">new</span> NioEventLoopGroup(<span class="hljs-number">1</span>), <span class="hljs-keyword">new</span> NioEventLoopGroup(<span class="hljs-number">2</span>))<br>    .channel(NioServerSocketChannel.class)<br>    .childHandler(<span class="hljs-keyword">new</span> ChannelInitializer&lt;NioSocketChannel&gt;() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initChannel</span><span class="hljs-params">(NioSocketChannel ch)</span> </span>&#123;<br>            ch.pipeline().addLast(<span class="hljs-keyword">new</span> ChannelInboundHandlerAdapter() &#123;<br>                <span class="hljs-meta">@Override</span><br>                <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">channelRead</span><span class="hljs-params">(ChannelHandlerContext ctx, Object msg)</span> </span>&#123;<br>                    ByteBuf byteBuf = msg <span class="hljs-keyword">instanceof</span> ByteBuf ? ((ByteBuf) msg) : <span class="hljs-keyword">null</span>;<br>                    <span class="hljs-keyword">if</span> (byteBuf != <span class="hljs-keyword">null</span>) &#123;<br>                        <span class="hljs-keyword">byte</span>[] buf = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[<span class="hljs-number">16</span>];<br>                        ByteBuf len = byteBuf.readBytes(buf, <span class="hljs-number">0</span>, byteBuf.readableBytes());<br>                        log.debug(<span class="hljs-keyword">new</span> String(buf));<br>                    &#125;<br>                &#125;<br>            &#125;);<br>        &#125;<br>    &#125;).bind(<span class="hljs-number">8080</span>).sync();<br></code></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯ï¼Œå¯åŠ¨ä¸‰æ¬¡ï¼Œåˆ†åˆ«ä¿®æ”¹å‘é€å­—ç¬¦ä¸²ä¸º zhangsanï¼ˆç¬¬ä¸€æ¬¡ï¼‰ï¼Œlisiï¼ˆç¬¬äºŒæ¬¡ï¼‰ï¼Œwangwuï¼ˆç¬¬ä¸‰æ¬¡ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException </span>&#123;<br>    Channel channel = <span class="hljs-keyword">new</span> Bootstrap()<br>            .group(<span class="hljs-keyword">new</span> NioEventLoopGroup(<span class="hljs-number">1</span>))<br>            .handler(<span class="hljs-keyword">new</span> ChannelInitializer&lt;NioSocketChannel&gt;() &#123;<br>                <span class="hljs-meta">@Override</span><br>                <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initChannel</span><span class="hljs-params">(NioSocketChannel ch)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>                    System.out.println(<span class="hljs-string">&quot;init...&quot;</span>);<br>                    ch.pipeline().addLast(<span class="hljs-keyword">new</span> LoggingHandler(LogLevel.DEBUG));<br>                &#125;<br>            &#125;)<br>            .channel(NioSocketChannel.class).connect(<span class="hljs-string">&quot;localhost&quot;</span>, <span class="hljs-number">8080</span>)<br>            .sync()<br>            .channel();<br><br>    channel.writeAndFlush(ByteBufAllocator.DEFAULT.buffer().writeBytes(<span class="hljs-string">&quot;wangwu&quot;</span>.getBytes()));<br>    Thread.sleep(<span class="hljs-number">2000</span>);<br>    channel.writeAndFlush(ByteBufAllocator.DEFAULT.buffer().writeBytes(<span class="hljs-string">&quot;wangwu&quot;</span>.getBytes()));<br></code></pre></td></tr></table></figure><p>æœ€åè¾“å‡º</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-number">22</span>:<span class="hljs-number">03</span>:<span class="hljs-number">34</span> <span class="hljs-selector-attr">[DEBUG]</span> <span class="hljs-selector-attr">[nioEventLoopGroup-3-1]</span> c<span class="hljs-selector-class">.i</span><span class="hljs-selector-class">.o</span><span class="hljs-selector-class">.EventLoopTest</span> - zhangsan       <br><span class="hljs-number">22</span>:<span class="hljs-number">03</span>:<span class="hljs-number">36</span> <span class="hljs-selector-attr">[DEBUG]</span> <span class="hljs-selector-attr">[nioEventLoopGroup-3-1]</span> c<span class="hljs-selector-class">.i</span><span class="hljs-selector-class">.o</span><span class="hljs-selector-class">.EventLoopTest</span> - zhangsan       <br><span class="hljs-number">22</span>:<span class="hljs-number">05</span>:<span class="hljs-number">36</span> <span class="hljs-selector-attr">[DEBUG]</span> <span class="hljs-selector-attr">[nioEventLoopGroup-3-2]</span> c<span class="hljs-selector-class">.i</span><span class="hljs-selector-class">.o</span><span class="hljs-selector-class">.EventLoopTest</span> - lisi           <br><span class="hljs-number">22</span>:<span class="hljs-number">05</span>:<span class="hljs-number">38</span> <span class="hljs-selector-attr">[DEBUG]</span> <span class="hljs-selector-attr">[nioEventLoopGroup-3-2]</span> c<span class="hljs-selector-class">.i</span><span class="hljs-selector-class">.o</span><span class="hljs-selector-class">.EventLoopTest</span> - lisi           <br><span class="hljs-number">22</span>:<span class="hljs-number">06</span>:<span class="hljs-number">09</span> <span class="hljs-selector-attr">[DEBUG]</span> <span class="hljs-selector-attr">[nioEventLoopGroup-3-1]</span> c<span class="hljs-selector-class">.i</span><span class="hljs-selector-class">.o</span><span class="hljs-selector-class">.EventLoopTest</span> - wangwu        <br><span class="hljs-number">22</span>:<span class="hljs-number">06</span>:<span class="hljs-number">11</span> <span class="hljs-selector-attr">[DEBUG]</span> <span class="hljs-selector-attr">[nioEventLoopGroup-3-1]</span> c<span class="hljs-selector-class">.i</span><span class="hljs-selector-class">.o</span><span class="hljs-selector-class">.EventLoopTest</span> - wangwu         <br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ä¸¤ä¸ªå·¥äººè½®æµå¤„ç† channelï¼Œä½†å·¥äººä¸ channel ä¹‹é—´è¿›è¡Œäº†ç»‘å®š</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20230503203539658.png"></p><h4 id="åˆ†å·¥ç»†åŒ–"><a href="#åˆ†å·¥ç»†åŒ–" class="headerlink" title="åˆ†å·¥ç»†åŒ–"></a>åˆ†å·¥ç»†åŒ–</h4><p>ä¸ºä»€ä¹ˆè¦ç»†åˆ†ä»»åŠ¡ï¼Œå¢åŠ DefaultEventLoopGroupå‘¢ï¼Ÿè¿™æ˜¯ä¸ºäº†é˜²æ­¢å¢åŠ NioEventLoopGroupçš„å·¥ä½œé‡ï¼ŒNettyä¸­çš„é»„é‡‘æ³•åˆ™ï¼Œä¸èƒ½é˜»å¡IOçº¿ç¨‹ã€‚</p><p>å†å¢åŠ ä¸¤ä¸ªé nio å·¥äºº</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java">DefaultEventLoopGroup normalWorkers = <span class="hljs-keyword">new</span> DefaultEventLoopGroup(<span class="hljs-number">2</span>);<br><span class="hljs-keyword">new</span> ServerBootstrap()<br>    .group(<span class="hljs-keyword">new</span> NioEventLoopGroup(<span class="hljs-number">1</span>), <span class="hljs-keyword">new</span> NioEventLoopGroup(<span class="hljs-number">2</span>))<br>    .channel(NioServerSocketChannel.class)<br>    .childHandler(<span class="hljs-keyword">new</span> ChannelInitializer&lt;NioSocketChannel&gt;() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initChannel</span><span class="hljs-params">(NioSocketChannel ch)</span>  </span>&#123;<br>            ch.pipeline().addLast(<span class="hljs-keyword">new</span> LoggingHandler(LogLevel.DEBUG));<br>            ch.pipeline().addLast(normalWorkers,<span class="hljs-string">&quot;myhandler&quot;</span>,<br>              <span class="hljs-keyword">new</span> ChannelInboundHandlerAdapter() &#123;<br>                <span class="hljs-meta">@Override</span><br>                <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">channelRead</span><span class="hljs-params">(ChannelHandlerContext ctx, Object msg)</span> </span>&#123;<br>                    ByteBuf byteBuf = msg <span class="hljs-keyword">instanceof</span> ByteBuf ? ((ByteBuf) msg) : <span class="hljs-keyword">null</span>;<br>                    <span class="hljs-keyword">if</span> (byteBuf != <span class="hljs-keyword">null</span>) &#123;<br>                        <span class="hljs-keyword">byte</span>[] buf = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[<span class="hljs-number">16</span>];<br>                        ByteBuf len = byteBuf.readBytes(buf, <span class="hljs-number">0</span>, byteBuf.readableBytes());<br>                        log.debug(<span class="hljs-keyword">new</span> String(buf));<br>                    &#125;<br>                &#125;<br>            &#125;);<br>        &#125;<br>    &#125;).bind(<span class="hljs-number">8080</span>).sync();<br></code></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯ä»£ç ä¸å˜ï¼Œå¯åŠ¨ä¸‰æ¬¡ï¼Œåˆ†åˆ«ä¿®æ”¹å‘é€å­—ç¬¦ä¸²ä¸º zhangsanï¼ˆç¬¬ä¸€æ¬¡ï¼‰ï¼Œlisiï¼ˆç¬¬äºŒæ¬¡ï¼‰ï¼Œwangwuï¼ˆç¬¬ä¸‰æ¬¡ï¼‰</p><p>è¾“å‡º</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">22:19:48 [DEBUG] [nioEventLoopGroup-4-1] i.n.h.l.LoggingHandler - [id: 0x251562d5, L:/127.0.0.1:8080 - R:/127.0.0.1:52588] REGISTERED<br>22:19:48 [DEBUG] [nioEventLoopGroup-4-1] i.n.h.l.LoggingHandler - [id: 0x251562d5, L:/127.0.0.1:8080 - R:/127.0.0.1:52588] ACTIVE<br>22:19:48 [DEBUG] [nioEventLoopGroup-4-1] i.n.h.l.LoggingHandler - [id: 0x251562d5, L:/127.0.0.1:8080 - R:/127.0.0.1:52588] READ: 8B<br><span class="hljs-code">         +-------------------------------------------------+</span><br><span class="hljs-section">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br><span class="hljs-section">|00000000| 7a 68 61 6e 67 73 61 6e                         |zhangsan        |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br>22:19:48 [DEBUG] [nioEventLoopGroup-4-1] i.n.h.l.LoggingHandler - [id: 0x251562d5, L:/127.0.0.1:8080 - R:/127.0.0.1:52588] READ COMPLETE<br>22:19:48 [DEBUG] [defaultEventLoopGroup-2-1] c.i.o.EventLoopTest - zhangsan        <br>22:19:50 [DEBUG] [nioEventLoopGroup-4-1] i.n.h.l.LoggingHandler - [id: 0x251562d5, L:/127.0.0.1:8080 - R:/127.0.0.1:52588] READ: 8B<br><span class="hljs-code">         +-------------------------------------------------+</span><br><span class="hljs-section">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br><span class="hljs-section">|00000000| 7a 68 61 6e 67 73 61 6e                         |zhangsan        |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br>22:19:50 [DEBUG] [nioEventLoopGroup-4-1] i.n.h.l.LoggingHandler - [id: 0x251562d5, L:/127.0.0.1:8080 - R:/127.0.0.1:52588] READ COMPLETE<br>22:19:50 [DEBUG] [defaultEventLoopGroup-2-1] c.i.o.EventLoopTest - zhangsan        <br>22:20:24 [DEBUG] [nioEventLoopGroup-4-2] i.n.h.l.LoggingHandler - [id: 0x94b2a840, L:/127.0.0.1:8080 - R:/127.0.0.1:52612] REGISTERED<br>22:20:24 [DEBUG] [nioEventLoopGroup-4-2] i.n.h.l.LoggingHandler - [id: 0x94b2a840, L:/127.0.0.1:8080 - R:/127.0.0.1:52612] ACTIVE<br>22:20:25 [DEBUG] [nioEventLoopGroup-4-2] i.n.h.l.LoggingHandler - [id: 0x94b2a840, L:/127.0.0.1:8080 - R:/127.0.0.1:52612] READ: 4B<br><span class="hljs-code">         +-------------------------------------------------+</span><br><span class="hljs-section">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br><span class="hljs-section">|00000000| 6c 69 73 69                                     |lisi            |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br>22:20:25 [DEBUG] [nioEventLoopGroup-4-2] i.n.h.l.LoggingHandler - [id: 0x94b2a840, L:/127.0.0.1:8080 - R:/127.0.0.1:52612] READ COMPLETE<br>22:20:25 [DEBUG] [defaultEventLoopGroup-2-2] c.i.o.EventLoopTest - lisi            <br>22:20:27 [DEBUG] [nioEventLoopGroup-4-2] i.n.h.l.LoggingHandler - [id: 0x94b2a840, L:/127.0.0.1:8080 - R:/127.0.0.1:52612] READ: 4B<br><span class="hljs-code">         +-------------------------------------------------+</span><br><span class="hljs-section">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br><span class="hljs-section">|00000000| 6c 69 73 69                                     |lisi            |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br>22:20:27 [DEBUG] [nioEventLoopGroup-4-2] i.n.h.l.LoggingHandler - [id: 0x94b2a840, L:/127.0.0.1:8080 - R:/127.0.0.1:52612] READ COMPLETE<br>22:20:27 [DEBUG] [defaultEventLoopGroup-2-2] c.i.o.EventLoopTest - lisi            <br>22:20:38 [DEBUG] [nioEventLoopGroup-4-1] i.n.h.l.LoggingHandler - [id: 0x79a26af9, L:/127.0.0.1:8080 - R:/127.0.0.1:52625] REGISTERED<br>22:20:38 [DEBUG] [nioEventLoopGroup-4-1] i.n.h.l.LoggingHandler - [id: 0x79a26af9, L:/127.0.0.1:8080 - R:/127.0.0.1:52625] ACTIVE<br>22:20:38 [DEBUG] [nioEventLoopGroup-4-1] i.n.h.l.LoggingHandler - [id: 0x79a26af9, L:/127.0.0.1:8080 - R:/127.0.0.1:52625] READ: 6B<br><span class="hljs-code">         +-------------------------------------------------+</span><br><span class="hljs-section">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br><span class="hljs-section">|00000000| 77 61 6e 67 77 75                               |wangwu          |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br>22:20:38 [DEBUG] [nioEventLoopGroup-4-1] i.n.h.l.LoggingHandler - [id: 0x79a26af9, L:/127.0.0.1:8080 - R:/127.0.0.1:52625] READ COMPLETE<br>22:20:38 [DEBUG] [defaultEventLoopGroup-2-1] c.i.o.EventLoopTest - wangwu          <br>22:20:40 [DEBUG] [nioEventLoopGroup-4-1] i.n.h.l.LoggingHandler - [id: 0x79a26af9, L:/127.0.0.1:8080 - R:/127.0.0.1:52625] READ: 6B<br><span class="hljs-code">         +-------------------------------------------------+</span><br><span class="hljs-section">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br><span class="hljs-section">|00000000| 77 61 6e 67 77 75                               |wangwu          |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br>22:20:40 [DEBUG] [nioEventLoopGroup-4-1] i.n.h.l.LoggingHandler - [id: 0x79a26af9, L:/127.0.0.1:8080 - R:/127.0.0.1:52625] READ COMPLETE<br>22:20:40 [DEBUG] [defaultEventLoopGroup-2-1] c.i.o.EventLoopTest - wangwu          <br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œnio å·¥äººå’Œ é nio å·¥äººä¹Ÿåˆ†åˆ«ç»‘å®šäº† channelï¼ˆLoggingHandler ç”± nio å·¥äººæ‰§è¡Œï¼Œè€Œæˆ‘ä»¬è‡ªå·±çš„ handler ç”±é nio å·¥äººæ‰§è¡Œï¼‰</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20230503203554754.png"></p><h4 id="ğŸ’¡-handler-æ‰§è¡Œä¸­å¦‚ä½•æ¢äººï¼Ÿ"><a href="#ğŸ’¡-handler-æ‰§è¡Œä¸­å¦‚ä½•æ¢äººï¼Ÿ" class="headerlink" title="ğŸ’¡ handler æ‰§è¡Œä¸­å¦‚ä½•æ¢äººï¼Ÿ"></a>ğŸ’¡ handler æ‰§è¡Œä¸­å¦‚ä½•æ¢äººï¼Ÿ</h4><p>ä¸€ä¸ªChannelçš„headleråœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æ˜¯å¦‚ä½•åˆ‡æ¢çº¿ç¨‹çš„å‘¢ï¼Ÿå°±æ˜¯ä½¿ç”¨<code>invokeChannelRead()</code>æ–¹æ³•è°ƒç”¨ä¸‹ä¸€ä¸ªhandlerã€‚</p><p>å…³é”®ä»£ç  <code>io.netty.channel.AbstractChannelHandlerContext#invokeChannelRead()</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">invokeChannelRead</span><span class="hljs-params">(<span class="hljs-keyword">final</span> AbstractChannelHandlerContext next, Object msg)</span> </span>&#123;<br>    <span class="hljs-keyword">final</span> Object m = next.pipeline.touch(ObjectUtil.checkNotNull(msg, <span class="hljs-string">&quot;msg&quot;</span>), next);<br>    <span class="hljs-comment">// è¿”å›ä¸‹ä¸€ä¸ªhandlerçš„EventLoop</span><br>    EventExecutor executor = next.executor();<br>    <br>    <span class="hljs-comment">// ä¸‹ä¸€ä¸ª handler çš„äº‹ä»¶å¾ªç¯æ˜¯å¦ä¸å½“å‰çš„äº‹ä»¶å¾ªç¯æ˜¯åŒä¸€ä¸ªçº¿ç¨‹</span><br>    <span class="hljs-comment">// æ˜¯ï¼Œç›´æ¥è°ƒç”¨</span><br>    <span class="hljs-keyword">if</span> (executor.inEventLoop()) &#123; <span class="hljs-comment">//è°ƒç”¨è€…çš„EventLoopå’Œå½“å‰handlerçš„EventLoopæ˜¯å¦ç›¸ç­‰</span><br>        next.invokeChannelRead(m);<br>    &#125; <br>    <span class="hljs-comment">// ä¸æ˜¯ï¼Œå°†è¦æ‰§è¡Œçš„ä»£ç ä½œä¸ºä»»åŠ¡æäº¤ç»™ä¸‹ä¸€ä¸ªäº‹ä»¶å¾ªç¯å¤„ç†ï¼ˆæ¢äººï¼‰</span><br>    <span class="hljs-keyword">else</span> &#123;<br>        executor.execute(<span class="hljs-keyword">new</span> Runnable() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;<br>                next.invokeChannelRead(m);<br>            &#125;<br>        &#125;);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>å¦‚æœä¸¤ä¸ª handler ç»‘å®šçš„æ˜¯åŒä¸€ä¸ªçº¿ç¨‹ï¼Œé‚£ä¹ˆå°±ç›´æ¥è°ƒç”¨</li><li>å¦åˆ™ï¼ŒæŠŠè¦è°ƒç”¨çš„ä»£ç å°è£…ä¸ºä¸€ä¸ªä»»åŠ¡å¯¹è±¡ï¼Œç”±ä¸‹ä¸€ä¸ª handler çš„çº¿ç¨‹æ¥è°ƒç”¨ï¼Œä¸èƒ½åœ¨å½“å‰EventLoopçº¿ç¨‹ç›´æ¥è°ƒç”¨</li></ul><h4 id="æ¼”ç¤º-NioEventLoop-å¤„ç†æ™®é€šä»»åŠ¡"><a href="#æ¼”ç¤º-NioEventLoop-å¤„ç†æ™®é€šä»»åŠ¡" class="headerlink" title="æ¼”ç¤º NioEventLoop å¤„ç†æ™®é€šä»»åŠ¡"></a>æ¼”ç¤º NioEventLoop å¤„ç†æ™®é€šä»»åŠ¡</h4><p>NioEventLoop é™¤äº†å¯ä»¥å¤„ç† io äº‹ä»¶ï¼ŒåŒæ ·å¯ä»¥å‘å®ƒæäº¤æ™®é€šä»»åŠ¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java">NioEventLoopGroup nioWorkers = <span class="hljs-keyword">new</span> NioEventLoopGroup(<span class="hljs-number">2</span>);<br><br>log.debug(<span class="hljs-string">&quot;server start...&quot;</span>);<br>Thread.sleep(<span class="hljs-number">2000</span>);<br>nioWorkers.execute(()-&gt;&#123;<br>    log.debug(<span class="hljs-string">&quot;normal task...&quot;</span>);<br>&#125;);<br></code></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs prolog"><span class="hljs-number">22</span>:<span class="hljs-number">30</span>:<span class="hljs-number">36</span> [<span class="hljs-symbol">DEBUG</span>] [main] c.i.o.<span class="hljs-symbol">EventLoopTest2</span> - server start...<br><span class="hljs-number">22</span>:<span class="hljs-number">30</span>:<span class="hljs-number">38</span> [<span class="hljs-symbol">DEBUG</span>] [nioEventLoopGroup<span class="hljs-number">-2</span><span class="hljs-number">-1</span>] c.i.o.<span class="hljs-symbol">EventLoopTest2</span> - normal task...<br></code></pre></td></tr></table></figure><blockquote><p>å¯ä»¥ç”¨æ¥æ‰§è¡Œè€—æ—¶è¾ƒé•¿çš„ä»»åŠ¡</p></blockquote><h4 id="æ¼”ç¤º-NioEventLoop-å¤„ç†å®šæ—¶ä»»åŠ¡"><a href="#æ¼”ç¤º-NioEventLoop-å¤„ç†å®šæ—¶ä»»åŠ¡" class="headerlink" title="æ¼”ç¤º NioEventLoop å¤„ç†å®šæ—¶ä»»åŠ¡"></a>æ¼”ç¤º NioEventLoop å¤„ç†å®šæ—¶ä»»åŠ¡</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java">NioEventLoopGroup nioWorkers = <span class="hljs-keyword">new</span> NioEventLoopGroup(<span class="hljs-number">2</span>);<br><br>log.debug(<span class="hljs-string">&quot;server start...&quot;</span>);<br>Thread.sleep(<span class="hljs-number">2000</span>);<br>nioWorkers.scheduleAtFixedRate(() -&gt; &#123;<br>    log.debug(<span class="hljs-string">&quot;running...&quot;</span>);<br>&#125;, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, TimeUnit.SECONDS);<br></code></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-number">22</span>:<span class="hljs-number">35</span>:<span class="hljs-number">15</span> <span class="hljs-selector-attr">[DEBUG]</span> <span class="hljs-selector-attr">[main]</span> c<span class="hljs-selector-class">.i</span><span class="hljs-selector-class">.o</span><span class="hljs-selector-class">.EventLoopTest2</span> - server start...<br><span class="hljs-number">22</span>:<span class="hljs-number">35</span>:<span class="hljs-number">17</span> <span class="hljs-selector-attr">[DEBUG]</span> <span class="hljs-selector-attr">[nioEventLoopGroup-2-1]</span> c<span class="hljs-selector-class">.i</span><span class="hljs-selector-class">.o</span><span class="hljs-selector-class">.EventLoopTest2</span> - running...<br><span class="hljs-number">22</span>:<span class="hljs-number">35</span>:<span class="hljs-number">18</span> <span class="hljs-selector-attr">[DEBUG]</span> <span class="hljs-selector-attr">[nioEventLoopGroup-2-1]</span> c<span class="hljs-selector-class">.i</span><span class="hljs-selector-class">.o</span><span class="hljs-selector-class">.EventLoopTest2</span> - running...<br><span class="hljs-number">22</span>:<span class="hljs-number">35</span>:<span class="hljs-number">19</span> <span class="hljs-selector-attr">[DEBUG]</span> <span class="hljs-selector-attr">[nioEventLoopGroup-2-1]</span> c<span class="hljs-selector-class">.i</span><span class="hljs-selector-class">.o</span><span class="hljs-selector-class">.EventLoopTest2</span> - running...<br><span class="hljs-number">22</span>:<span class="hljs-number">35</span>:<span class="hljs-number">20</span> <span class="hljs-selector-attr">[DEBUG]</span> <span class="hljs-selector-attr">[nioEventLoopGroup-2-1]</span> c<span class="hljs-selector-class">.i</span><span class="hljs-selector-class">.o</span><span class="hljs-selector-class">.EventLoopTest2</span> - running...<br>...<br></code></pre></td></tr></table></figure><blockquote><p>å¯ä»¥ç”¨æ¥æ‰§è¡Œå®šæ—¶ä»»åŠ¡</p></blockquote><h3 id="3-2-Channel"><a href="#3-2-Channel" class="headerlink" title="3.2 Channel"></a>3.2 Channel</h3><p>channel çš„ä¸»è¦ä½œç”¨</p><ul><li>close() å¯ä»¥ç”¨æ¥å…³é—­ channelï¼Œè¿™æ˜¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œ</li><li>closeFuture() ç”¨æ¥å¤„ç† channel çš„å…³é—­<ul><li>sync æ–¹æ³•ä½œç”¨æ˜¯åŒæ­¥ç­‰å¾… channel å…³é—­</li><li>è€Œ addListener æ–¹æ³•æ˜¯å¼‚æ­¥ç­‰å¾… channel å…³é—­</li></ul></li><li>pipeline() æ–¹æ³•æ·»åŠ å¤„ç†å™¨</li><li>write() æ–¹æ³•å°†æ•°æ®å†™å…¥ï¼Œå¯èƒ½ä¸ä¼šç«‹åˆ»åˆ·å‡ºï¼Œå› ä¸ºå¯èƒ½ä¼šå…ˆå­˜æ”¾åœ¨ç¼“å†²åŒºä¸­</li><li>writeAndFlush() æ–¹æ³•å°†æ•°æ®å†™å…¥å¹¶åˆ·å‡º</li></ul><h4 id="ChannelFuture"><a href="#ChannelFuture" class="headerlink" title="ChannelFuture"></a>ChannelFuture</h4><p><strong>å¸¦æœ‰Futureï¼Œ Promise çš„ç±»å‹éƒ½æ˜¯å¼‚æ­¥æ–¹æ³•é…å¥—ä½¿ç”¨ï¼Œç”¨æ¥æ­£ç¡®å¤„ç†ç»“æœ</strong></p><p>è¿™æ—¶åˆšæ‰çš„å®¢æˆ·ç«¯ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">new</span> Bootstrap()<br>    .group(<span class="hljs-keyword">new</span> NioEventLoopGroup())<br>    .channel(NioSocketChannel.class)<br>    .handler(<span class="hljs-keyword">new</span> ChannelInitializer&lt;Channel&gt;() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initChannel</span><span class="hljs-params">(Channel ch)</span> </span>&#123;<br>            ch.pipeline().addLast(<span class="hljs-keyword">new</span> StringEncoder());<br>        &#125;<br>    &#125;)<br>    .connect(<span class="hljs-string">&quot;127.0.0.1&quot;</span>, <span class="hljs-number">8080</span>) <span class="hljs-comment">//è¿”å›ChannelFutureå¯¹è±¡</span><br>    .sync()<br>    .channel()<br>    .writeAndFlush(<span class="hljs-keyword">new</span> Date() + <span class="hljs-string">&quot;: hello world!&quot;</span>);<br></code></pre></td></tr></table></figure><p>ç°åœ¨æŠŠå®ƒæ‹†å¼€æ¥çœ‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java">ChannelFuture channelFuture = <span class="hljs-keyword">new</span> Bootstrap()<br>    .group(<span class="hljs-keyword">new</span> NioEventLoopGroup())<br>    .channel(NioSocketChannel.class)<br>    .handler(<span class="hljs-keyword">new</span> ChannelInitializer&lt;Channel&gt;() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initChannel</span><span class="hljs-params">(Channel ch)</span> </span>&#123;<br>            ch.pipeline().addLast(<span class="hljs-keyword">new</span> StringEncoder());<br>        &#125;<br>    &#125;)<br>    .connect(<span class="hljs-string">&quot;127.0.0.1&quot;</span>, <span class="hljs-number">8080</span>); <span class="hljs-comment">// 1</span><br><br>channelFuture.sync().channel().writeAndFlush(<span class="hljs-keyword">new</span> Date() + <span class="hljs-string">&quot;: hello world!&quot;</span>);<br></code></pre></td></tr></table></figure><ul><li>1 å¤„è¿”å›çš„æ˜¯ ChannelFuture å¯¹è±¡ï¼Œå®ƒçš„ä½œç”¨æ˜¯åˆ©ç”¨ channel() æ–¹æ³•æ¥è·å– Channel å¯¹è±¡</li></ul><p><strong>æ³¨æ„</strong> connect æ–¹æ³•æ˜¯å¼‚æ­¥çš„ï¼Œæ„å‘³ç€ä¸ç­‰è¿æ¥å»ºç«‹ï¼Œæ–¹æ³•æ‰§è¡Œå°±è¿”å›äº†ï¼ˆçœŸæ­£æ‰§è¡Œ connect æ˜¯ nio çº¿ç¨‹ï¼‰ã€‚å› æ­¤ channelFuture å¯¹è±¡ä¸­ä¸èƒ½ã€ç«‹åˆ»ã€‘è·å¾—åˆ°æ­£ç¡®Channel å¯¹è±¡</p><h5 id="æ–¹æ³•ä¸€ï¼šä½¿ç”¨sync-æ–¹æ³•åŒæ­¥å¤„ç†ç»“æœ"><a href="#æ–¹æ³•ä¸€ï¼šä½¿ç”¨sync-æ–¹æ³•åŒæ­¥å¤„ç†ç»“æœ" class="headerlink" title="æ–¹æ³•ä¸€ï¼šä½¿ç”¨sync()æ–¹æ³•åŒæ­¥å¤„ç†ç»“æœ"></a>æ–¹æ³•ä¸€ï¼šä½¿ç”¨sync()æ–¹æ³•åŒæ­¥å¤„ç†ç»“æœ</h5><p>å®éªŒå¦‚ä¸‹ï¼š</p><p>åœ¨è°ƒç”¨sync()æ–¹æ³•æ—¶ï¼Œå½“å‰çº¿ç¨‹ä¼šè¢«é˜»å¡ä½ï¼ŒçŸ¥é“nioçº¿ç¨‹çœŸæ­£å®Œæˆè¿æ¥çš„å»ºç«‹ï¼Œå½“å‰çº¿ç¨‹æ‰ä¼šæ¢å¤è¿è¡Œã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java">ChannelFuture channelFuture = <span class="hljs-keyword">new</span> Bootstrap()<br>    .group(<span class="hljs-keyword">new</span> NioEventLoopGroup())<br>    .channel(NioSocketChannel.class)<br>    .handler(<span class="hljs-keyword">new</span> ChannelInitializer&lt;Channel&gt;() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initChannel</span><span class="hljs-params">(Channel ch)</span> </span>&#123;<br>            ch.pipeline().addLast(<span class="hljs-keyword">new</span> StringEncoder());<br>        &#125;<br>    &#125;)<br>    .connect(<span class="hljs-string">&quot;127.0.0.1&quot;</span>, <span class="hljs-number">8080</span>);<br><br>System.out.println(channelFuture.channel()); <span class="hljs-comment">// 1</span><br>channelFuture.sync(); <span class="hljs-comment">// 2</span><br>System.out.println(channelFuture.channel()); <span class="hljs-comment">// 3</span><br></code></pre></td></tr></table></figure><ul><li>æ‰§è¡Œåˆ° 1 æ—¶ï¼Œè¿æ¥æœªå»ºç«‹ï¼Œæ‰“å° <code>[id: 0x2e1884dd]</code></li><li>æ‰§è¡Œåˆ° 2 æ—¶ï¼Œsync æ–¹æ³•æ˜¯åŒæ­¥ç­‰å¾…è¿æ¥å»ºç«‹å®Œæˆ</li><li>æ‰§è¡Œåˆ° 3 æ—¶ï¼Œè¿æ¥è‚¯å®šå»ºç«‹äº†ï¼Œæ‰“å° <code>[id: 0x2e1884dd, L:/127.0.0.1:57191 - R:/127.0.0.1:8080]</code></li></ul><h5 id="æ–¹æ³•äºŒï¼šä½¿ç”¨-addListener-å›è°ƒå¯¹è±¡-æ–¹æ³•å¼‚æ­¥å¤„ç†ç»“æœ"><a href="#æ–¹æ³•äºŒï¼šä½¿ç”¨-addListener-å›è°ƒå¯¹è±¡-æ–¹æ³•å¼‚æ­¥å¤„ç†ç»“æœ" class="headerlink" title="æ–¹æ³•äºŒï¼šä½¿ç”¨ addListener(å›è°ƒå¯¹è±¡) æ–¹æ³•å¼‚æ­¥å¤„ç†ç»“æœ"></a>æ–¹æ³•äºŒï¼šä½¿ç”¨ addListener(å›è°ƒå¯¹è±¡) æ–¹æ³•å¼‚æ­¥å¤„ç†ç»“æœ</h5><p>è¿æ¥å»ºç«‹ä»¥åï¼Œå½“å‰çº¿ç¨‹ä¹Ÿä¸åšå¤„ç†äº†ï¼Œç”±å…¶ä»–çº¿ç¨‹è¿›è¡Œå¤„ç†ï¼Œæ‰€ä»¥æ˜¯å¼‚æ­¥å¤„ç†ç»“æœã€‚</p><p>é™¤äº†ç”¨ <strong>sync æ–¹æ³•</strong>å¯ä»¥è®©å¼‚æ­¥æ“ä½œåŒæ­¥ä»¥å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨<strong>å›è°ƒçš„æ–¹å¼</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java">ChannelFuture channelFuture = <span class="hljs-keyword">new</span> Bootstrap()<br>    .group(<span class="hljs-keyword">new</span> NioEventLoopGroup())<br>    .channel(NioSocketChannel.class)<br>    .handler(<span class="hljs-keyword">new</span> ChannelInitializer&lt;Channel&gt;() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initChannel</span><span class="hljs-params">(Channel ch)</span> </span>&#123;<br>            ch.pipeline().addLast(<span class="hljs-keyword">new</span> StringEncoder());<br>        &#125;<br>    &#125;)<br>    .connect(<span class="hljs-string">&quot;127.0.0.1&quot;</span>, <span class="hljs-number">8080</span>);<br>System.out.println(channelFuture.channel()); <span class="hljs-comment">// 1</span><br>channelFuture.addListener((ChannelFutureListener) future -&gt; &#123;<br>    System.out.println(future.channel()); <span class="hljs-comment">// 2</span><br>&#125;);<br></code></pre></td></tr></table></figure><ul><li>æ‰§è¡Œåˆ° 1 æ—¶ï¼Œè¿æ¥æœªå»ºç«‹ï¼Œæ‰“å° <code>[id: 0x749124ba]</code></li><li>ChannelFutureListener ä¼šåœ¨è¿æ¥å»ºç«‹æ—¶è¢«è°ƒç”¨ï¼ˆå…¶ä¸­ operationComplete æ–¹æ³•ï¼‰ï¼Œå› æ­¤æ‰§è¡Œåˆ° 2 æ—¶ï¼Œè¿æ¥è‚¯å®šå»ºç«‹äº†ï¼Œæ‰“å° <code>[id: 0x749124ba, L:/127.0.0.1:57351 - R:/127.0.0.1:8080]</code>ï¼ˆåœ¨ nioçº¿ç¨‹è¿æ¥å»ºç«‹å¥½ä¹‹å,ä¼šè°ƒç”¨ operationCompleteï¼Œä¼ å…¥operationCompleteæ–¹æ³•çš„å‚æ•°ï¼Œä¹Ÿæ˜¯å½“å‰è°ƒç”¨addListenerçš„ChannelFutrueå¯¹è±¡ï¼‰</li></ul><h4 id="CloseFuture"><a href="#CloseFuture" class="headerlink" title="CloseFuture"></a>CloseFuture</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CloseFutureClient</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException </span>&#123;<br>        <span class="hljs-function">NioEventLoopGroup group new <span class="hljs-title">NioEventLoopGroup</span><span class="hljs-params">()</span></span>;<br>        ChannelFuture channelFuture = <span class="hljs-keyword">new</span> Bootstrap()<br>                .group(group)<br>                .channel(NioSocketChannel.class)<br>                .handler(<span class="hljs-keyword">new</span> ChannelInitializer&lt;NioSocketChannel&gt;() &#123;<br>                    <span class="hljs-meta">@Override</span> <span class="hljs-comment">// åœ¨è¿æ¥å»ºç«‹åè¢«è°ƒç”¨</span><br>                    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initChannel</span><span class="hljs-params">(NioSocketChannel ch)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>                        ch.pipeline().addLast(<span class="hljs-keyword">new</span> LoggingHandler(LogLevel.DEBUG));<br>                        ch.pipeline().addLast(<span class="hljs-keyword">new</span> StringEncoder());<br>                    &#125;<br>                &#125;)<br>                .connect(<span class="hljs-keyword">new</span> InetSocketAddress(<span class="hljs-string">&quot;localhost&quot;</span>, <span class="hljs-number">8080</span>));<br>        Channel channel = channelFuture.sync().channel();<br>        log.debug(<span class="hljs-string">&quot;&#123;&#125;&quot;</span>, channel);<br>        <span class="hljs-keyword">new</span> Thread(()-&gt;&#123;<br>            Scanner scanner = <span class="hljs-keyword">new</span> Scanner(System.in);<br>            <span class="hljs-keyword">while</span> (<span class="hljs-keyword">true</span>) &#123;<br>                String line = scanner.nextLine();<br>                <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;q&quot;</span>.equals(line)) &#123;<br>                    channel.close(); <span class="hljs-comment">// close å¼‚æ­¥æ“ä½œ 1s ä¹‹å</span><br><span class="hljs-comment">//                    log.debug(&quot;å¤„ç†å…³é—­ä¹‹åçš„æ“ä½œ&quot;); // ä¸èƒ½åœ¨è¿™é‡Œå–„å</span><br>                    <span class="hljs-keyword">break</span>;<br>                &#125;<br>                channel.writeAndFlush(line);<br>            &#125;<br>        &#125;, <span class="hljs-string">&quot;input&quot;</span>).start();<br><br>        <span class="hljs-comment">// è·å– CloseFuture å¯¹è±¡ï¼Œ 1) åŒæ­¥å¤„ç†å…³é—­ï¼Œ 2) å¼‚æ­¥å¤„ç†å…³é—­</span><br>        ChannelFuture closeFuture = channel.closeFuture();<br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         *æ–¹æ³•ä¸€ï¼šåŒæ­¥å¤„ç†å…³é—­</span><br><span class="hljs-comment">         *log.debug(&quot;waiting close...&quot;);</span><br><span class="hljs-comment">         *closeFuture.sync();</span><br><span class="hljs-comment">         *log.debug(&quot;å¤„ç†å…³é—­ä¹‹åçš„æ“ä½œ&quot;);</span><br><span class="hljs-comment">         */</span><br>        <br>        <span class="hljs-comment">// æ–¹å¼äºŒï¼šå¼‚æ­¥å¤„ç†å…³é—­</span><br>        closeFuture.addListener(<span class="hljs-keyword">new</span> ChannelFutureListener() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">operationComplete</span><span class="hljs-params">(ChannelFuture future)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>                log.debug(<span class="hljs-string">&quot;å¤„ç†å…³é—­ä¹‹åçš„æ“ä½œ&quot;</span>);<br>                group.shutdownGracefully();<br>            &#125;<br>        &#125;);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="ğŸ’¡-å¼‚æ­¥æå‡çš„æ˜¯ä»€ä¹ˆ"><a href="#ğŸ’¡-å¼‚æ­¥æå‡çš„æ˜¯ä»€ä¹ˆ" class="headerlink" title="ğŸ’¡ å¼‚æ­¥æå‡çš„æ˜¯ä»€ä¹ˆ"></a>ğŸ’¡ å¼‚æ­¥æå‡çš„æ˜¯ä»€ä¹ˆ</h4><ul><li><p>æœ‰äº›åŒå­¦çœ‹åˆ°è¿™é‡Œä¼šæœ‰ç–‘é—®ï¼šä¸ºä»€ä¹ˆä¸åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­å»æ‰§è¡Œå»ºç«‹è¿æ¥ã€å»æ‰§è¡Œå…³é—­ channelï¼Œé‚£æ ·ä¸æ˜¯ä¹Ÿå¯ä»¥å—ï¼Ÿéè¦ç”¨è¿™ä¹ˆå¤æ‚çš„å¼‚æ­¥æ–¹å¼ï¼šæ¯”å¦‚ä¸€ä¸ªçº¿ç¨‹å‘èµ·å»ºç«‹è¿æ¥ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹å»çœŸæ­£å»ºç«‹è¿æ¥</p></li><li><p>è¿˜æœ‰åŒå­¦ä¼šç¬¼ç»Ÿåœ°å›ç­”ï¼Œå› ä¸º netty å¼‚æ­¥æ–¹å¼ç”¨äº†å¤šçº¿ç¨‹ã€å¤šçº¿ç¨‹å°±æ•ˆç‡é«˜ã€‚å…¶å®è¿™äº›è®¤è¯†éƒ½æ¯”è¾ƒç‰‡é¢ï¼Œå¤šçº¿ç¨‹å’Œå¼‚æ­¥æ‰€æå‡çš„æ•ˆç‡å¹¶ä¸æ˜¯æ‰€è®¤ä¸ºçš„</p></li><li><p><strong>å¼‚æ­¥ future ä½¿ç”¨ä¸»è¦æ˜¯å°†ä»»åŠ¡è¿›è¡Œåˆ’å­ä»»åŠ¡ï¼Œå­ä»»åŠ¡é—´å¯ä»¥è¿›è¡Œå¹¶è¡Œæ“ä½œï¼Œæé«˜æ•ˆç‡ã€‚ å°†ä»»åŠ¡åˆ’åˆ†ä¸ºå­ä»»åŠ¡è¿›è¡Œå¤„ç† å’Œ æ¯ä¸ªä»»åŠ¡ä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹ç›¸æ¯”ï¼Œå‰è€…å¹¶å‘ä¸ä»»åŠ¡æ•°æ— å…³åªä¸å­ä»»åŠ¡åˆ’åˆ†æ•°ç›¸å…³ã€‚å¼‚æ­¥æé«˜çš„æ˜¯ååé‡ã€‚</strong></p></li></ul><p>æ€è€ƒä¸‹é¢çš„åœºæ™¯ï¼Œ4 ä¸ªåŒ»ç”Ÿç»™äººçœ‹ç—…ï¼Œæ¯ä¸ªç—…äººèŠ±è´¹ 20 åˆ†é’Ÿï¼Œè€Œä¸”åŒ»ç”Ÿçœ‹ç—…çš„è¿‡ç¨‹ä¸­æ˜¯ä»¥ç—…äººä¸ºå•ä½çš„ï¼Œä¸€ä¸ªç—…äººçœ‹å®Œäº†ï¼Œæ‰èƒ½çœ‹ä¸‹ä¸€ä¸ªç—…äººã€‚å‡è®¾ç—…äººæºæºä¸æ–­åœ°æ¥ï¼Œå¯ä»¥è®¡ç®—ä¸€ä¸‹ 4 ä¸ªåŒ»ç”Ÿä¸€å¤©å·¥ä½œ 8 å°æ—¶ï¼Œå¤„ç†çš„ç—…äººæ€»æ•°æ˜¯ï¼š<code>4 * 8 * 3 = 96</code></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20230503203612026.png"></p><p>ç»ç ”ç©¶å‘ç°ï¼Œçœ‹ç—…å¯ä»¥ç»†åˆ†ä¸ºå››ä¸ªæ­¥éª¤ï¼Œç»æ‹†åˆ†åæ¯ä¸ªæ­¥éª¤éœ€è¦ 5 åˆ†é’Ÿï¼Œå¦‚ä¸‹</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20230503203629813.png"></p><p>å› æ­¤å¯ä»¥åšå¦‚ä¸‹ä¼˜åŒ–ï¼Œåªæœ‰ä¸€å¼€å§‹ï¼ŒåŒ»ç”Ÿ 2ã€3ã€4 åˆ†åˆ«è¦ç­‰å¾… 5ã€10ã€15 åˆ†é’Ÿæ‰èƒ½æ‰§è¡Œå·¥ä½œï¼Œä½†åªè¦åç»­ç—…äººæºæºä¸æ–­åœ°æ¥ï¼Œä»–ä»¬å°±èƒ½å¤Ÿæ»¡è´Ÿè·å·¥ä½œï¼Œ<del>å¹¶ä¸”å¤„ç†ç—…äººçš„èƒ½åŠ›æé«˜åˆ°äº† <code>4 * 8 * 12</code> æ•ˆç‡å‡ ä¹æ˜¯åŸæ¥çš„å››å€</del>å¤„ç†ç—…äººçš„èƒ½åŠ›ä»ç„¶æ˜¯<code>1 * 8 * 12 = 96</code></p><p>è™½ç„¶çœ‹èµ·æ¥è¿™ä¸ªä¾‹å­ï¼Œå¥½åƒååé‡ä¸Šæ²¡æœ‰æå‡ï¼Œä½†æ˜¯å‡è®¾å°†æŒ‚å·çš„æ—¶é—´ç¼©çŸ­ï¼Œæ¯”å¦‚åªéœ€è¦1åˆ†é’Ÿï¼Œé‚£ä¹ˆå¼‚æ­¥å¤„ç†è¿™ä¸ªä»»åŠ¡ï¼Œååé‡ä¼šå˜æˆåŸæ¥çš„<code>60 / 12 = 5</code>å€ï¼ï¼ï¼</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20230503203735319.png"></p><p><strong>æ—¶é—´æ²¡å˜ï¼Œä½†æ˜¯ååé‡å˜é«˜äº†ï¼Œæœ¬æ¥30åˆ†é’Ÿåªæœ‰4ä¸ªç—…äººå¼€å§‹å¤„ç†ï¼Œnettyçš„å¼‚æ­¥åšæ³•æ˜¯6ä¸ªäººå·²ç»å¼€å§‹å¤„ç†äº†ã€‚</strong></p><p>è¦ç‚¹</p><ul><li>å•çº¿ç¨‹æ²¡æ³•å¼‚æ­¥æé«˜æ•ˆç‡ï¼Œå¿…é¡»é…åˆå¤šçº¿ç¨‹ã€å¤šæ ¸ cpu æ‰èƒ½å‘æŒ¥å¼‚æ­¥çš„ä¼˜åŠ¿</li><li>å¼‚æ­¥å¹¶æ²¡æœ‰ç¼©çŸ­å“åº”æ—¶é—´ï¼Œåè€Œæœ‰æ‰€å¢åŠ ï¼›<strong>å¼‚æ­¥çœŸæ­£å¢åŠ çš„æ˜¯ååé‡</strong></li><li>åˆç†è¿›è¡Œä»»åŠ¡æ‹†åˆ†ï¼Œä¹Ÿæ˜¯åˆ©ç”¨å¼‚æ­¥çš„å…³é”®</li></ul><h3 id="3-3-Future-amp-Promise"><a href="#3-3-Future-amp-Promise" class="headerlink" title="3.3 Future &amp; Promise"></a>3.3 Future &amp; Promise</h3><p>åœ¨å¼‚æ­¥å¤„ç†æ—¶ï¼Œç»å¸¸ç”¨åˆ°è¿™ä¸¤ä¸ªæ¥å£<code>Future</code>å’Œ<code>Promise</code>æ¥å£</p><p>é¦–å…ˆè¦è¯´æ˜ netty ä¸­çš„ Future ä¸ jdk ä¸­çš„ Future åŒåï¼Œä½†æ˜¯æ˜¯ä¸¤ä¸ªæ¥å£ï¼Œnetty çš„ Future ç»§æ‰¿è‡ª jdk çš„ Futureï¼Œè€Œ Promise åˆå¯¹ netty Future è¿›è¡Œäº†æ‰©å±•</p><ul><li>jdk Future åªèƒ½åŒæ­¥ç­‰å¾…ä»»åŠ¡ç»“æŸï¼ˆæˆ–æˆåŠŸã€æˆ–å¤±è´¥ï¼‰æ‰èƒ½å¾—åˆ°ç»“æœ</li><li>netty Future å¯ä»¥åŒæ­¥ç­‰å¾…ä»»åŠ¡ç»“æŸå¾—åˆ°ç»“æœï¼Œä¹Ÿå¯ä»¥å¼‚æ­¥æ–¹å¼å¾—åˆ°ç»“æœï¼Œä½†éƒ½æ˜¯è¦ç­‰ä»»åŠ¡ç»“æŸ</li><li>netty Promise ä¸ä»…æœ‰ netty Future çš„åŠŸèƒ½ï¼Œè€Œä¸”è„±ç¦»äº†ä»»åŠ¡ç‹¬ç«‹å­˜åœ¨ï¼Œåªä½œä¸ºä¸¤ä¸ªçº¿ç¨‹é—´ä¼ é€’ç»“æœçš„å®¹å™¨</li></ul><table><thead><tr><th>åŠŸèƒ½/åç§°</th><th>jdk Future</th><th>netty Future</th><th>Promise</th></tr></thead><tbody><tr><td>cancel</td><td>å–æ¶ˆä»»åŠ¡</td><td>-</td><td>-</td></tr><tr><td>isCanceled</td><td>ä»»åŠ¡æ˜¯å¦å–æ¶ˆ</td><td>-</td><td>-</td></tr><tr><td>isDone</td><td>ä»»åŠ¡æ˜¯å¦å®Œæˆï¼Œä¸èƒ½åŒºåˆ†æˆåŠŸå¤±è´¥</td><td>-</td><td>-</td></tr><tr><td>get</td><td>è·å–ä»»åŠ¡ç»“æœï¼Œé˜»å¡ç­‰å¾…</td><td>-</td><td>-</td></tr><tr><td>getNow</td><td>-</td><td>è·å–ä»»åŠ¡ç»“æœï¼Œéé˜»å¡ï¼Œè¿˜æœªäº§ç”Ÿç»“æœæ—¶è¿”å› null</td><td>-</td></tr><tr><td>await</td><td>-</td><td>ç­‰å¾…ä»»åŠ¡ç»“æŸï¼Œå¦‚æœä»»åŠ¡å¤±è´¥ï¼Œä¸ä¼šæŠ›å¼‚å¸¸ï¼Œè€Œæ˜¯é€šè¿‡ isSuccess åˆ¤æ–­</td><td>-</td></tr><tr><td>sync</td><td>-</td><td>ç­‰å¾…ä»»åŠ¡ç»“æŸï¼Œå¦‚æœä»»åŠ¡å¤±è´¥ï¼ŒæŠ›å‡ºå¼‚å¸¸</td><td>-</td></tr><tr><td>isSuccess</td><td>-</td><td>åˆ¤æ–­ä»»åŠ¡æ˜¯å¦æˆåŠŸ</td><td>-</td></tr><tr><td>cause</td><td>-</td><td>è·å–å¤±è´¥ä¿¡æ¯ï¼Œéé˜»å¡ï¼Œå¦‚æœæ²¡æœ‰å¤±è´¥ï¼Œè¿”å›null</td><td>-</td></tr><tr><td>addListener</td><td>-</td><td>æ·»åŠ å›è°ƒï¼Œå¼‚æ­¥æ¥æ”¶ç»“æœ</td><td>-</td></tr><tr><td>setSuccess</td><td>-</td><td>-</td><td>è®¾ç½®æˆåŠŸç»“æœ</td></tr><tr><td>setFailure</td><td>-</td><td>-</td><td>è®¾ç½®å¤±è´¥ç»“æœ</td></tr></tbody></table><h4 id="JDKçš„Future"><a href="#JDKçš„Future" class="headerlink" title="JDKçš„Future"></a>JDKçš„Future</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.concurrent.*;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> ExecutionException, InterruptedException </span>&#123;<br>        <span class="hljs-comment">// 1. åˆ›å»ºçº¿ç¨‹æ± </span><br>        ExecutorService service = Executors.newFixedThreadPool(<span class="hljs-number">2</span>);<br><br>        <span class="hljs-comment">// 2. æäº¤ä»»åŠ¡</span><br>        Future&lt;Integer&gt; future = service.submit(<span class="hljs-keyword">new</span> Callable&lt;Integer&gt;() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">call</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>                Thread.sleep(<span class="hljs-number">1000</span>);<br>                <span class="hljs-keyword">return</span> <span class="hljs-number">50</span>;<br>            &#125;<br>        &#125;);<br><br>        <span class="hljs-comment">// 3. ä¸»çº¿ç¨‹é˜»å¡ä½ï¼Œç­‰å¾…ä»»åŠ¡ç»“æŸï¼Œå¹¶ä¸”é€šè¿‡Futureå¯¹è±¡è·å–ç»“æœã€‚JDKçš„Futureåªèƒ½åŒæ­¥è·å¾—ç»“æœ</span><br>        Integer result = future.get();<br>        System.out.println(result);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="Nettyçš„Future"><a href="#Nettyçš„Future" class="headerlink" title="Nettyçš„Future"></a>Nettyçš„Future</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> io.netty.channel.EventLoop;<br><span class="hljs-keyword">import</span> io.netty.channel.EventLoopGroup;<br><span class="hljs-keyword">import</span> io.netty.channel.nio.NioEventLoopGroup;<br><span class="hljs-keyword">import</span> io.netty.util.concurrent.Future;<br><br><span class="hljs-keyword">import</span> java.util.concurrent.*;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> ExecutionException, InterruptedException </span>&#123;<br>        <span class="hljs-comment">// 1. åˆ›å»ºEventLoopGroupå¯¹è±¡</span><br>        EventLoopGroup group = <span class="hljs-keyword">new</span> NioEventLoopGroup(<span class="hljs-number">2</span>);<br><br>        <span class="hljs-comment">// 2. æ‹¿åˆ°EventLoopå¯¹è±¡</span><br>        EventLoop eventLoop = group.next();<br><br>        <span class="hljs-comment">// 3. æäº¤ä»»åŠ¡</span><br>        Future&lt;Integer&gt; future = eventLoop.submit(<span class="hljs-keyword">new</span> Callable&lt;Integer&gt;() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">call</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>                Thread.sleep(<span class="hljs-number">1000</span>);<br>                <span class="hljs-keyword">return</span> <span class="hljs-number">50</span>;<br>            &#125;<br>        &#125;);<br><br>        <span class="hljs-comment">// 3. ä¸»çº¿ç¨‹é˜»å¡ä½ï¼Œç­‰å¾…ä»»åŠ¡ç»“æŸï¼Œå¹¶ä¸”é€šè¿‡Futureå¯¹è±¡è·å–ç»“æœã€‚ è¿™æ˜¯åŒæ­¥æ–¹å¼ã€‚</span><br>        Integer result = future.get();<br>        System.out.println(result);<br>        <br>        <span class="hljs-comment">// 4. å¼‚æ­¥è·å¾—ç»“æœã€‚è¿™æ˜¯å¼‚æ­¥æ–¹å¼</span><br>        future.addListener(<span class="hljs-keyword">new</span> GenericFutureListener&lt;Future&lt;? <span class="hljs-keyword">super</span> Integer&gt;&gt;() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">operationComplete</span><span class="hljs-params">(Future&lt;? <span class="hljs-keyword">super</span> Integer&gt; future)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>                Integer result = (Integer) future.getNow();<br>                System.out.println(result);<br>            &#125;<br>        &#125;);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="Nettyçš„Promise"><a href="#Nettyçš„Promise" class="headerlink" title="Nettyçš„Promise"></a>Nettyçš„Promise</h4><p>Nettyçš„Promiseçš„å¯¹è±¡å¯ä»¥æå‰åˆ›å»ºå¥½ï¼Œä¸æƒ³JDKå’ŒNettyçš„Futureéœ€è¦æäº¤ä»»åŠ¡æ‰èƒ½åˆ›å»ºã€‚</p><h5 id="ä¾‹1ï¼šåŒæ­¥å¤„ç†ä»»åŠ¡æˆåŠŸ"><a href="#ä¾‹1ï¼šåŒæ­¥å¤„ç†ä»»åŠ¡æˆåŠŸ" class="headerlink" title="ä¾‹1ï¼šåŒæ­¥å¤„ç†ä»»åŠ¡æˆåŠŸ"></a>ä¾‹1ï¼šåŒæ­¥å¤„ç†ä»»åŠ¡æˆåŠŸ</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 1. å‡†å¤‡ EventLoopå¯¹è±¡</span><br>DefaultEventLoop eventExecutors = <span class="hljs-keyword">new</span> DefaultEventLoop();<br><span class="hljs-comment">// 2. å¯ä»¥ä¸»åŠ¨åˆ›å»º promiseï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªç»“æœå®¹å™¨</span><br><span class="hljs-comment">//                 å‚æ•°å°±æ˜¯ï¼ŒæŒ‡å®š Promise å¯¹è±¡å¼‚æ­¥æ¥æ”¶ç»“æœçº¿ç¨‹</span><br>DefaultPromise&lt;Integer&gt; promise = <span class="hljs-keyword">new</span> DefaultPromise&lt;&gt;(eventExecutors);<br><br><span class="hljs-comment">// 3. ä»»æ„ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œè®¡ç®—ï¼Œè®¡ç®—å®Œæ¯•åå‘ promise å¡«å……ç»“æœ</span><br>eventExecutors.execute(()-&gt;&#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>        Thread.sleep(<span class="hljs-number">1000</span>);<br>    &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>        e.printStackTrace();<br>    &#125;<br>    log.debug(<span class="hljs-string">&quot;set success, &#123;&#125;&quot;</span>,<span class="hljs-number">10</span>);<br>    promise.setSuccess(<span class="hljs-number">10</span>);<br>&#125;);<br><br><span class="hljs-comment">// 4. æ¥æ”¶ç»“æœçš„çº¿ç¨‹</span><br>log.debug(<span class="hljs-string">&quot;start...&quot;</span>);<br>log.debug(<span class="hljs-string">&quot;&#123;&#125;&quot;</span>,promise.getNow()); <span class="hljs-comment">// è¿˜æ²¡æœ‰ç»“æœ</span><br>log.debug(<span class="hljs-string">&quot;&#123;&#125;&quot;</span>,promise.get());<br></code></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-number">11</span>:<span class="hljs-number">51</span>:<span class="hljs-number">53</span> <span class="hljs-selector-attr">[DEBUG]</span> <span class="hljs-selector-attr">[main]</span> c<span class="hljs-selector-class">.i</span><span class="hljs-selector-class">.o</span><span class="hljs-selector-class">.DefaultPromiseTest2</span> - start...<br><span class="hljs-number">11</span>:<span class="hljs-number">51</span>:<span class="hljs-number">53</span> <span class="hljs-selector-attr">[DEBUG]</span> <span class="hljs-selector-attr">[main]</span> c<span class="hljs-selector-class">.i</span><span class="hljs-selector-class">.o</span><span class="hljs-selector-class">.DefaultPromiseTest2</span> - null<br><span class="hljs-number">11</span>:<span class="hljs-number">51</span>:<span class="hljs-number">54</span> <span class="hljs-selector-attr">[DEBUG]</span> <span class="hljs-selector-attr">[defaultEventLoop-1-1]</span> c<span class="hljs-selector-class">.i</span><span class="hljs-selector-class">.o</span><span class="hljs-selector-class">.DefaultPromiseTest2</span> - set success, <span class="hljs-number">10</span><br><span class="hljs-number">11</span>:<span class="hljs-number">51</span>:<span class="hljs-number">54</span> <span class="hljs-selector-attr">[DEBUG]</span> <span class="hljs-selector-attr">[main]</span> c<span class="hljs-selector-class">.i</span><span class="hljs-selector-class">.o</span><span class="hljs-selector-class">.DefaultPromiseTest2</span> - <span class="hljs-number">10</span><br></code></pre></td></tr></table></figure><h5 id="ä¾‹2ï¼šå¼‚æ­¥å¤„ç†ä»»åŠ¡æˆåŠŸ"><a href="#ä¾‹2ï¼šå¼‚æ­¥å¤„ç†ä»»åŠ¡æˆåŠŸ" class="headerlink" title="ä¾‹2ï¼šå¼‚æ­¥å¤„ç†ä»»åŠ¡æˆåŠŸ"></a>ä¾‹2ï¼šå¼‚æ­¥å¤„ç†ä»»åŠ¡æˆåŠŸ</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java">DefaultEventLoop eventExecutors = <span class="hljs-keyword">new</span> DefaultEventLoop();<br>DefaultPromise&lt;Integer&gt; promise = <span class="hljs-keyword">new</span> DefaultPromise&lt;&gt;(eventExecutors);<br><br><span class="hljs-comment">// è®¾ç½®å›è°ƒï¼Œå¼‚æ­¥æ¥æ”¶ç»“æœ</span><br>promise.addListener(future -&gt; &#123;<br>    <span class="hljs-comment">// è¿™é‡Œçš„ future å°±æ˜¯ä¸Šé¢çš„ promise</span><br>    log.debug(<span class="hljs-string">&quot;&#123;&#125;&quot;</span>,future.getNow());<br>&#125;);<br><br><span class="hljs-comment">// ç­‰å¾… 1000 åè®¾ç½®æˆåŠŸç»“æœ</span><br>eventExecutors.execute(()-&gt;&#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>        Thread.sleep(<span class="hljs-number">1000</span>);<br>    &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>        e.printStackTrace();<br>    &#125;<br>    log.debug(<span class="hljs-string">&quot;set success, &#123;&#125;&quot;</span>,<span class="hljs-number">10</span>);<br>    promise.setSuccess(<span class="hljs-number">10</span>);<br>&#125;);<br><br>log.debug(<span class="hljs-string">&quot;start...&quot;</span>);<br></code></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-number">11</span>:<span class="hljs-number">49</span>:<span class="hljs-number">30</span> <span class="hljs-selector-attr">[DEBUG]</span> <span class="hljs-selector-attr">[main]</span> c<span class="hljs-selector-class">.i</span><span class="hljs-selector-class">.o</span><span class="hljs-selector-class">.DefaultPromiseTest2</span> - start...<br><span class="hljs-number">11</span>:<span class="hljs-number">49</span>:<span class="hljs-number">31</span> <span class="hljs-selector-attr">[DEBUG]</span> <span class="hljs-selector-attr">[defaultEventLoop-1-1]</span> c<span class="hljs-selector-class">.i</span><span class="hljs-selector-class">.o</span><span class="hljs-selector-class">.DefaultPromiseTest2</span> - set success, <span class="hljs-number">10</span><br><span class="hljs-number">11</span>:<span class="hljs-number">49</span>:<span class="hljs-number">31</span> <span class="hljs-selector-attr">[DEBUG]</span> <span class="hljs-selector-attr">[defaultEventLoop-1-1]</span> c<span class="hljs-selector-class">.i</span><span class="hljs-selector-class">.o</span><span class="hljs-selector-class">.DefaultPromiseTest2</span> - <span class="hljs-number">10</span><br></code></pre></td></tr></table></figure><h5 id="ä¾‹3ï¼šåŒæ­¥å¤„ç†ä»»åŠ¡å¤±è´¥-sync-amp-get"><a href="#ä¾‹3ï¼šåŒæ­¥å¤„ç†ä»»åŠ¡å¤±è´¥-sync-amp-get" class="headerlink" title="ä¾‹3ï¼šåŒæ­¥å¤„ç†ä»»åŠ¡å¤±è´¥ - sync &amp; get"></a>ä¾‹3ï¼šåŒæ­¥å¤„ç†ä»»åŠ¡å¤±è´¥ - sync &amp; get</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java">DefaultEventLoop eventExecutors = <span class="hljs-keyword">new</span> DefaultEventLoop();<br>      DefaultPromise&lt;Integer&gt; promise = <span class="hljs-keyword">new</span> DefaultPromise&lt;&gt;(eventExecutors);<br><br>      eventExecutors.execute(() -&gt; &#123;<br>          <span class="hljs-keyword">try</span> &#123;<br>              Thread.sleep(<span class="hljs-number">1000</span>);<br>          &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>              e.printStackTrace();<br>          &#125;<br>          RuntimeException e = <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">&quot;error...&quot;</span>);<br>          log.debug(<span class="hljs-string">&quot;set failure, &#123;&#125;&quot;</span>, e.toString());<br>          promise.setFailure(e);<br>      &#125;);<br><br>      log.debug(<span class="hljs-string">&quot;start...&quot;</span>);<br>      log.debug(<span class="hljs-string">&quot;&#123;&#125;&quot;</span>, promise.getNow());<br>      promise.get(); <span class="hljs-comment">// sync() ä¹Ÿä¼šå‡ºç°å¼‚å¸¸ï¼Œåªæ˜¯ get ä¼šå†ç”¨ ExecutionException åŒ…ä¸€å±‚å¼‚å¸¸</span><br></code></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-number">12</span>:<span class="hljs-number">11</span>:<span class="hljs-number">07</span> <span class="hljs-selector-attr">[DEBUG]</span> <span class="hljs-selector-attr">[main]</span> c<span class="hljs-selector-class">.i</span><span class="hljs-selector-class">.o</span><span class="hljs-selector-class">.DefaultPromiseTest2</span> - start...<br><span class="hljs-number">12</span>:<span class="hljs-number">11</span>:<span class="hljs-number">07</span> <span class="hljs-selector-attr">[DEBUG]</span> <span class="hljs-selector-attr">[main]</span> c<span class="hljs-selector-class">.i</span><span class="hljs-selector-class">.o</span><span class="hljs-selector-class">.DefaultPromiseTest2</span> - null<br><span class="hljs-number">12</span>:<span class="hljs-number">11</span>:<span class="hljs-number">08</span> <span class="hljs-selector-attr">[DEBUG]</span> <span class="hljs-selector-attr">[defaultEventLoop-1-1]</span> c<span class="hljs-selector-class">.i</span><span class="hljs-selector-class">.o</span><span class="hljs-selector-class">.DefaultPromiseTest2</span> - set failure, java<span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.RuntimeException</span>: error...<br>Exception <span class="hljs-keyword">in</span> thread <span class="hljs-string">&quot;main&quot;</span> java<span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.concurrent</span><span class="hljs-selector-class">.ExecutionException</span>: java<span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.RuntimeException</span>: error...<br>at io<span class="hljs-selector-class">.netty</span><span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.concurrent</span><span class="hljs-selector-class">.AbstractFuture</span><span class="hljs-selector-class">.get</span>(AbstractFuture<span class="hljs-selector-class">.java</span>:<span class="hljs-number">41</span>)<br>at com<span class="hljs-selector-class">.itcast</span><span class="hljs-selector-class">.oio</span><span class="hljs-selector-class">.DefaultPromiseTest2</span><span class="hljs-selector-class">.main</span>(DefaultPromiseTest2<span class="hljs-selector-class">.java</span>:<span class="hljs-number">34</span>)<br>Caused by: java<span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.RuntimeException</span>: error...<br>at com<span class="hljs-selector-class">.itcast</span><span class="hljs-selector-class">.oio</span><span class="hljs-selector-class">.DefaultPromiseTest2</span>.lambda<span class="hljs-variable">$main</span>$<span class="hljs-number">0</span>(DefaultPromiseTest2<span class="hljs-selector-class">.java</span>:<span class="hljs-number">27</span>)<br>at io<span class="hljs-selector-class">.netty</span><span class="hljs-selector-class">.channel</span><span class="hljs-selector-class">.DefaultEventLoop</span><span class="hljs-selector-class">.run</span>(DefaultEventLoop<span class="hljs-selector-class">.java</span>:<span class="hljs-number">54</span>)<br>at io<span class="hljs-selector-class">.netty</span><span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.concurrent</span>.SingleThreadEventExecutor$<span class="hljs-number">5</span><span class="hljs-selector-class">.run</span>(SingleThreadEventExecutor<span class="hljs-selector-class">.java</span>:<span class="hljs-number">918</span>)<br>at io<span class="hljs-selector-class">.netty</span><span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.internal</span>.ThreadExecutorMap$<span class="hljs-number">2</span><span class="hljs-selector-class">.run</span>(ThreadExecutorMap<span class="hljs-selector-class">.java</span>:<span class="hljs-number">74</span>)<br>at io<span class="hljs-selector-class">.netty</span><span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.concurrent</span><span class="hljs-selector-class">.FastThreadLocalRunnable</span><span class="hljs-selector-class">.run</span>(FastThreadLocalRunnable<span class="hljs-selector-class">.java</span>:<span class="hljs-number">30</span>)<br>at java<span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.Thread</span><span class="hljs-selector-class">.run</span>(Thread<span class="hljs-selector-class">.java</span>:<span class="hljs-number">745</span>)<br></code></pre></td></tr></table></figure><h5 id="ä¾‹4ï¼šåŒæ­¥å¤„ç†ä»»åŠ¡å¤±è´¥-await"><a href="#ä¾‹4ï¼šåŒæ­¥å¤„ç†ä»»åŠ¡å¤±è´¥-await" class="headerlink" title="ä¾‹4ï¼šåŒæ­¥å¤„ç†ä»»åŠ¡å¤±è´¥ - await"></a>ä¾‹4ï¼šåŒæ­¥å¤„ç†ä»»åŠ¡å¤±è´¥ - await</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java">DefaultEventLoop eventExecutors = <span class="hljs-keyword">new</span> DefaultEventLoop();<br>DefaultPromise&lt;Integer&gt; promise = <span class="hljs-keyword">new</span> DefaultPromise&lt;&gt;(eventExecutors);<br><br>eventExecutors.execute(() -&gt; &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>        Thread.sleep(<span class="hljs-number">1000</span>);<br>    &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>        e.printStackTrace();<br>    &#125;<br>    RuntimeException e = <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">&quot;error...&quot;</span>);<br>    log.debug(<span class="hljs-string">&quot;set failure, &#123;&#125;&quot;</span>, e.toString());<br>    promise.setFailure(e);<br>&#125;);<br><br>log.debug(<span class="hljs-string">&quot;start...&quot;</span>);<br>log.debug(<span class="hljs-string">&quot;&#123;&#125;&quot;</span>, promise.getNow());<br>promise.await(); <span class="hljs-comment">// ä¸ sync å’Œ get åŒºåˆ«åœ¨äºï¼Œä¸ä¼šæŠ›å¼‚å¸¸</span><br>log.debug(<span class="hljs-string">&quot;result &#123;&#125;&quot;</span>, (promise.isSuccess() ? promise.getNow() : promise.cause()).toString());<br></code></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-number">12</span>:<span class="hljs-number">18</span>:<span class="hljs-number">53</span> <span class="hljs-selector-attr">[DEBUG]</span> <span class="hljs-selector-attr">[main]</span> c<span class="hljs-selector-class">.i</span><span class="hljs-selector-class">.o</span><span class="hljs-selector-class">.DefaultPromiseTest2</span> - start...<br><span class="hljs-number">12</span>:<span class="hljs-number">18</span>:<span class="hljs-number">53</span> <span class="hljs-selector-attr">[DEBUG]</span> <span class="hljs-selector-attr">[main]</span> c<span class="hljs-selector-class">.i</span><span class="hljs-selector-class">.o</span><span class="hljs-selector-class">.DefaultPromiseTest2</span> - null<br><span class="hljs-number">12</span>:<span class="hljs-number">18</span>:<span class="hljs-number">54</span> <span class="hljs-selector-attr">[DEBUG]</span> <span class="hljs-selector-attr">[defaultEventLoop-1-1]</span> c<span class="hljs-selector-class">.i</span><span class="hljs-selector-class">.o</span><span class="hljs-selector-class">.DefaultPromiseTest2</span> - set failure, java<span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.RuntimeException</span>: error...<br><span class="hljs-number">12</span>:<span class="hljs-number">18</span>:<span class="hljs-number">54</span> <span class="hljs-selector-attr">[DEBUG]</span> <span class="hljs-selector-attr">[main]</span> c<span class="hljs-selector-class">.i</span><span class="hljs-selector-class">.o</span><span class="hljs-selector-class">.DefaultPromiseTest2</span> - result java<span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.RuntimeException</span>: error...<br></code></pre></td></tr></table></figure><h5 id="ä¾‹5ï¼šå¼‚æ­¥å¤„ç†ä»»åŠ¡å¤±è´¥"><a href="#ä¾‹5ï¼šå¼‚æ­¥å¤„ç†ä»»åŠ¡å¤±è´¥" class="headerlink" title="ä¾‹5ï¼šå¼‚æ­¥å¤„ç†ä»»åŠ¡å¤±è´¥"></a>ä¾‹5ï¼šå¼‚æ­¥å¤„ç†ä»»åŠ¡å¤±è´¥</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java">DefaultEventLoop eventExecutors = <span class="hljs-keyword">new</span> DefaultEventLoop();<br>DefaultPromise&lt;Integer&gt; promise = <span class="hljs-keyword">new</span> DefaultPromise&lt;&gt;(eventExecutors);<br><br>promise.addListener(future -&gt; &#123;<br>    log.debug(<span class="hljs-string">&quot;result &#123;&#125;&quot;</span>, (promise.isSuccess() ? promise.getNow() : promise.cause()).toString());<br>&#125;);<br><br>eventExecutors.execute(() -&gt; &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>        Thread.sleep(<span class="hljs-number">1000</span>);<br>    &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>        e.printStackTrace();<br>    &#125;<br>    RuntimeException e = <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">&quot;error...&quot;</span>);<br>    log.debug(<span class="hljs-string">&quot;set failure, &#123;&#125;&quot;</span>, e.toString());<br>    promise.setFailure(e);<br>&#125;);<br><br>log.debug(<span class="hljs-string">&quot;start...&quot;</span>);<br></code></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-number">12</span>:<span class="hljs-number">04</span>:<span class="hljs-number">57</span> <span class="hljs-selector-attr">[DEBUG]</span> <span class="hljs-selector-attr">[main]</span> c<span class="hljs-selector-class">.i</span><span class="hljs-selector-class">.o</span><span class="hljs-selector-class">.DefaultPromiseTest2</span> - start...<br><span class="hljs-number">12</span>:<span class="hljs-number">04</span>:<span class="hljs-number">58</span> <span class="hljs-selector-attr">[DEBUG]</span> <span class="hljs-selector-attr">[defaultEventLoop-1-1]</span> c<span class="hljs-selector-class">.i</span><span class="hljs-selector-class">.o</span><span class="hljs-selector-class">.DefaultPromiseTest2</span> - set failure, java<span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.RuntimeException</span>: error...<br><span class="hljs-number">12</span>:<span class="hljs-number">04</span>:<span class="hljs-number">58</span> <span class="hljs-selector-attr">[DEBUG]</span> <span class="hljs-selector-attr">[defaultEventLoop-1-1]</span> c<span class="hljs-selector-class">.i</span><span class="hljs-selector-class">.o</span><span class="hljs-selector-class">.DefaultPromiseTest2</span> - result java<span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.RuntimeException</span>: error...<br></code></pre></td></tr></table></figure><h5 id="ä¾‹6ï¼šawait-æ­»é”æ£€æŸ¥"><a href="#ä¾‹6ï¼šawait-æ­»é”æ£€æŸ¥" class="headerlink" title="ä¾‹6ï¼šawait æ­»é”æ£€æŸ¥"></a>ä¾‹6ï¼šawait æ­»é”æ£€æŸ¥</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java">DefaultEventLoop eventExecutors = <span class="hljs-keyword">new</span> DefaultEventLoop();<br>DefaultPromise&lt;Integer&gt; promise = <span class="hljs-keyword">new</span> DefaultPromise&lt;&gt;(eventExecutors);<br><br>eventExecutors.submit(()-&gt;&#123;<br>    System.out.println(<span class="hljs-string">&quot;1&quot;</span>);<br>    <span class="hljs-keyword">try</span> &#123;<br>        promise.await();<br>        <span class="hljs-comment">// æ³¨æ„ä¸èƒ½ä»…æ•è· InterruptedException å¼‚å¸¸</span><br>        <span class="hljs-comment">// å¦åˆ™ æ­»é”æ£€æŸ¥æŠ›å‡ºçš„ BlockingOperationException ä¼šç»§ç»­å‘ä¸Šä¼ æ’­</span><br>        <span class="hljs-comment">// è€Œæäº¤çš„ä»»åŠ¡ä¼šè¢«åŒ…è£…ä¸º PromiseTaskï¼Œå®ƒçš„ run æ–¹æ³•ä¸­ä¼š catch æ‰€æœ‰å¼‚å¸¸ç„¶åè®¾ç½®ä¸º Promise çš„å¤±è´¥ç»“æœè€Œä¸ä¼šæŠ›å‡º</span><br>    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123; <br>        e.printStackTrace();<br>    &#125;<br>    System.out.println(<span class="hljs-string">&quot;2&quot;</span>);<br>&#125;);<br>eventExecutors.submit(()-&gt;&#123;<br>    System.out.println(<span class="hljs-string">&quot;3&quot;</span>);<br>    <span class="hljs-keyword">try</span> &#123;<br>        promise.await();<br>    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>        e.printStackTrace();<br>    &#125;<br>    System.out.println(<span class="hljs-string">&quot;4&quot;</span>);<br>&#125;);<br></code></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-number">1</span><br><span class="hljs-number">2</span><br><span class="hljs-number">3</span><br><span class="hljs-number">4</span><br>io<span class="hljs-selector-class">.netty</span><span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.concurrent</span><span class="hljs-selector-class">.BlockingOperationException</span>: DefaultPromise@<span class="hljs-number">47499</span>c2a(incomplete)<br>at io<span class="hljs-selector-class">.netty</span><span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.concurrent</span><span class="hljs-selector-class">.DefaultPromise</span><span class="hljs-selector-class">.checkDeadLock</span>(DefaultPromise<span class="hljs-selector-class">.java</span>:<span class="hljs-number">384</span>)<br>at io<span class="hljs-selector-class">.netty</span><span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.concurrent</span><span class="hljs-selector-class">.DefaultPromise</span><span class="hljs-selector-class">.await</span>(DefaultPromise<span class="hljs-selector-class">.java</span>:<span class="hljs-number">212</span>)<br>at com<span class="hljs-selector-class">.itcast</span><span class="hljs-selector-class">.oio</span><span class="hljs-selector-class">.DefaultPromiseTest</span>.lambda<span class="hljs-variable">$main</span>$<span class="hljs-number">0</span>(DefaultPromiseTest<span class="hljs-selector-class">.java</span>:<span class="hljs-number">27</span>)<br>at io<span class="hljs-selector-class">.netty</span><span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.concurrent</span>.PromiseTask<span class="hljs-variable">$RunnableAdapter</span><span class="hljs-selector-class">.call</span>(PromiseTask<span class="hljs-selector-class">.java</span>:<span class="hljs-number">38</span>)<br>at io<span class="hljs-selector-class">.netty</span><span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.concurrent</span><span class="hljs-selector-class">.PromiseTask</span><span class="hljs-selector-class">.run</span>(PromiseTask<span class="hljs-selector-class">.java</span>:<span class="hljs-number">73</span>)<br>at io<span class="hljs-selector-class">.netty</span><span class="hljs-selector-class">.channel</span><span class="hljs-selector-class">.DefaultEventLoop</span><span class="hljs-selector-class">.run</span>(DefaultEventLoop<span class="hljs-selector-class">.java</span>:<span class="hljs-number">54</span>)<br>at io<span class="hljs-selector-class">.netty</span><span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.concurrent</span>.SingleThreadEventExecutor$<span class="hljs-number">5</span><span class="hljs-selector-class">.run</span>(SingleThreadEventExecutor<span class="hljs-selector-class">.java</span>:<span class="hljs-number">918</span>)<br>at io<span class="hljs-selector-class">.netty</span><span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.internal</span>.ThreadExecutorMap$<span class="hljs-number">2</span><span class="hljs-selector-class">.run</span>(ThreadExecutorMap<span class="hljs-selector-class">.java</span>:<span class="hljs-number">74</span>)<br>at io<span class="hljs-selector-class">.netty</span><span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.concurrent</span><span class="hljs-selector-class">.FastThreadLocalRunnable</span><span class="hljs-selector-class">.run</span>(FastThreadLocalRunnable<span class="hljs-selector-class">.java</span>:<span class="hljs-number">30</span>)<br>at java<span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.Thread</span><span class="hljs-selector-class">.run</span>(Thread<span class="hljs-selector-class">.java</span>:<span class="hljs-number">745</span>)<br>io<span class="hljs-selector-class">.netty</span><span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.concurrent</span><span class="hljs-selector-class">.BlockingOperationException</span>: DefaultPromise@<span class="hljs-number">47499</span>c2a(incomplete)<br>at io<span class="hljs-selector-class">.netty</span><span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.concurrent</span><span class="hljs-selector-class">.DefaultPromise</span><span class="hljs-selector-class">.checkDeadLock</span>(DefaultPromise<span class="hljs-selector-class">.java</span>:<span class="hljs-number">384</span>)<br>at io<span class="hljs-selector-class">.netty</span><span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.concurrent</span><span class="hljs-selector-class">.DefaultPromise</span><span class="hljs-selector-class">.await</span>(DefaultPromise<span class="hljs-selector-class">.java</span>:<span class="hljs-number">212</span>)<br>at com<span class="hljs-selector-class">.itcast</span><span class="hljs-selector-class">.oio</span><span class="hljs-selector-class">.DefaultPromiseTest</span>.lambda<span class="hljs-variable">$main</span>$<span class="hljs-number">1</span>(DefaultPromiseTest<span class="hljs-selector-class">.java</span>:<span class="hljs-number">36</span>)<br>at io<span class="hljs-selector-class">.netty</span><span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.concurrent</span>.PromiseTask<span class="hljs-variable">$RunnableAdapter</span><span class="hljs-selector-class">.call</span>(PromiseTask<span class="hljs-selector-class">.java</span>:<span class="hljs-number">38</span>)<br>at io<span class="hljs-selector-class">.netty</span><span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.concurrent</span><span class="hljs-selector-class">.PromiseTask</span><span class="hljs-selector-class">.run</span>(PromiseTask<span class="hljs-selector-class">.java</span>:<span class="hljs-number">73</span>)<br>at io<span class="hljs-selector-class">.netty</span><span class="hljs-selector-class">.channel</span><span class="hljs-selector-class">.DefaultEventLoop</span><span class="hljs-selector-class">.run</span>(DefaultEventLoop<span class="hljs-selector-class">.java</span>:<span class="hljs-number">54</span>)<br>at io<span class="hljs-selector-class">.netty</span><span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.concurrent</span>.SingleThreadEventExecutor$<span class="hljs-number">5</span><span class="hljs-selector-class">.run</span>(SingleThreadEventExecutor<span class="hljs-selector-class">.java</span>:<span class="hljs-number">918</span>)<br>at io<span class="hljs-selector-class">.netty</span><span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.internal</span>.ThreadExecutorMap$<span class="hljs-number">2</span><span class="hljs-selector-class">.run</span>(ThreadExecutorMap<span class="hljs-selector-class">.java</span>:<span class="hljs-number">74</span>)<br>at io<span class="hljs-selector-class">.netty</span><span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.concurrent</span><span class="hljs-selector-class">.FastThreadLocalRunnable</span><span class="hljs-selector-class">.run</span>(FastThreadLocalRunnable<span class="hljs-selector-class">.java</span>:<span class="hljs-number">30</span>)<br>at java<span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.Thread</span><span class="hljs-selector-class">.run</span>(Thread<span class="hljs-selector-class">.java</span>:<span class="hljs-number">745</span>)<br><br></code></pre></td></tr></table></figure><h3 id="3-4-Handler-amp-Pipeline"><a href="#3-4-Handler-amp-Pipeline" class="headerlink" title="3.4 Handler &amp; Pipeline"></a>3.4 Handler &amp; Pipeline</h3><p>ChannelHandler ç”¨æ¥å¤„ç† Channel ä¸Šçš„å„ç§äº‹ä»¶ï¼Œåˆ†ä¸ºå…¥ç«™ã€å‡ºç«™ä¸¤ç§ã€‚æ‰€æœ‰ ChannelHandler è¢«è¿æˆä¸€ä¸²ï¼Œå°±æ˜¯ Pipeline</p><ul><li>å…¥ç«™å¤„ç†å™¨é€šå¸¸æ˜¯ ChannelInboundHandlerAdapter çš„å­ç±»ï¼Œä¸»è¦ç”¨æ¥è¯»å–å®¢æˆ·ç«¯æ•°æ®ï¼Œå†™å›ç»“æœ</li><li>å‡ºç«™å¤„ç†å™¨é€šå¸¸æ˜¯ ChannelOutboundHandlerAdapter çš„å­ç±»ï¼Œä¸»è¦å¯¹å†™å›ç»“æœè¿›è¡ŒåŠ å·¥</li></ul><p>æ‰“ä¸ªæ¯”å–»ï¼Œæ¯ä¸ª Channel æ˜¯ä¸€ä¸ªäº§å“çš„åŠ å·¥è½¦é—´ï¼ŒPipeline æ˜¯è½¦é—´ä¸­çš„æµæ°´çº¿ï¼ŒChannelHandler å°±æ˜¯æµæ°´çº¿ä¸Šçš„å„é“å·¥åºï¼Œè€Œåé¢è¦è®²çš„ ByteBuf æ˜¯åŸææ–™ï¼Œç»è¿‡å¾ˆå¤šå·¥åºçš„åŠ å·¥ï¼šå…ˆç»è¿‡ä¸€é“é“å…¥ç«™å·¥åºï¼Œå†ç»è¿‡ä¸€é“é“å‡ºç«™å·¥åºæœ€ç»ˆå˜æˆäº§å“</p><p>å…ˆææ¸…æ¥šé¡ºåºï¼ŒæœåŠ¡ç«¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">new</span> ServerBootstrap()<br>    .group(<span class="hljs-keyword">new</span> NioEventLoopGroup())<br>    .channel(NioServerSocketChannel.class)<br>    .childHandler(<span class="hljs-keyword">new</span> ChannelInitializer&lt;NioSocketChannel&gt;() &#123;<br>        <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initChannel</span><span class="hljs-params">(NioSocketChannel ch)</span> </span>&#123;<br>            ch.pipeline().addLast(<span class="hljs-keyword">new</span> ChannelInboundHandlerAdapter()&#123;<br>                <span class="hljs-meta">@Override</span><br>                <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">channelRead</span><span class="hljs-params">(ChannelHandlerContext ctx, Object msg)</span> </span>&#123;<br>                    System.out.println(<span class="hljs-number">1</span>);<br>                    ctx.fireChannelRead(msg); <span class="hljs-comment">// 1</span><br>                &#125;<br>            &#125;);<br>            ch.pipeline().addLast(<span class="hljs-keyword">new</span> ChannelInboundHandlerAdapter()&#123;<br>                <span class="hljs-meta">@Override</span><br>                <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">channelRead</span><span class="hljs-params">(ChannelHandlerContext ctx, Object msg)</span> </span>&#123;<br>                    System.out.println(<span class="hljs-number">2</span>);<br>                    ctx.fireChannelRead(msg); <span class="hljs-comment">// 2</span><br>                &#125;<br>            &#125;);<br>            ch.pipeline().addLast(<span class="hljs-keyword">new</span> ChannelInboundHandlerAdapter()&#123;<br>                <span class="hljs-meta">@Override</span><br>                <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">channelRead</span><span class="hljs-params">(ChannelHandlerContext ctx, Object msg)</span> </span>&#123;<br>                    System.out.println(<span class="hljs-number">3</span>);<br>                    ctx.channel().write(msg); <span class="hljs-comment">// 3</span><br>                &#125;<br>            &#125;);<br>            ch.pipeline().addLast(<span class="hljs-keyword">new</span> ChannelOutboundHandlerAdapter()&#123;<br>                <span class="hljs-meta">@Override</span><br>                <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">write</span><span class="hljs-params">(ChannelHandlerContext ctx, Object msg, </span></span><br><span class="hljs-params"><span class="hljs-function">                                  ChannelPromise promise)</span> </span>&#123;<br>                    System.out.println(<span class="hljs-number">4</span>);<br>                    ctx.write(msg, promise); <span class="hljs-comment">// 4</span><br>                &#125;<br>            &#125;);<br>            ch.pipeline().addLast(<span class="hljs-keyword">new</span> ChannelOutboundHandlerAdapter()&#123;<br>                <span class="hljs-meta">@Override</span><br>                <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">write</span><span class="hljs-params">(ChannelHandlerContext ctx, Object msg, </span></span><br><span class="hljs-params"><span class="hljs-function">                                  ChannelPromise promise)</span> </span>&#123;<br>                    System.out.println(<span class="hljs-number">5</span>);<br>                    ctx.write(msg, promise); <span class="hljs-comment">// 5</span><br>                &#125;<br>            &#125;);<br>            ch.pipeline().addLast(<span class="hljs-keyword">new</span> ChannelOutboundHandlerAdapter()&#123;<br>                <span class="hljs-meta">@Override</span><br>                <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">write</span><span class="hljs-params">(ChannelHandlerContext ctx, Object msg, </span></span><br><span class="hljs-params"><span class="hljs-function">                                  ChannelPromise promise)</span> </span>&#123;<br>                    System.out.println(<span class="hljs-number">6</span>);<br>                    ctx.write(msg, promise); <span class="hljs-comment">// 6</span><br>                &#125;<br>            &#125;);<br>        &#125;<br>    &#125;)<br>    .bind(<span class="hljs-number">8080</span>);<br></code></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">new</span> Bootstrap()<br>    .group(<span class="hljs-keyword">new</span> NioEventLoopGroup())<br>    .channel(NioSocketChannel.class)<br>    .handler(<span class="hljs-keyword">new</span> ChannelInitializer&lt;Channel&gt;() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initChannel</span><span class="hljs-params">(Channel ch)</span> </span>&#123;<br>            ch.pipeline().addLast(<span class="hljs-keyword">new</span> StringEncoder());<br>        &#125;<br>    &#125;)<br>    .connect(<span class="hljs-string">&quot;127.0.0.1&quot;</span>, <span class="hljs-number">8080</span>)<br>    .addListener((ChannelFutureListener) future -&gt; &#123;<br>        future.channel().writeAndFlush(<span class="hljs-string">&quot;hello,world&quot;</span>);<br>    &#125;);<br></code></pre></td></tr></table></figure><p>æœåŠ¡å™¨ç«¯æ‰“å°ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs">1<br>2<br>3<br>6<br>5<br>4<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼ŒChannelInboundHandlerAdapter æ˜¯æŒ‰ç…§ addLast çš„é¡ºåºæ‰§è¡Œçš„ï¼Œè€Œ ChannelOutboundHandlerAdapter æ˜¯æŒ‰ç…§ addLast çš„é€†åºæ‰§è¡Œçš„ã€‚ChannelPipeline çš„å®ç°æ˜¯ä¸€ä¸ª ChannelHandlerContextï¼ˆåŒ…è£…äº† ChannelHandlerï¼‰ ç»„æˆçš„åŒå‘é“¾è¡¨ã€‚è¿™é‡ŒNettyä¼šå¸®åŠ©ç¨‹åºå‘˜è‡ªåŠ¨åˆ›å»ºä½äºé“¾é¦–å’Œé“¾å°¾çš„headå’Œtailè¿™ä¸¤ä¸ªHandlerã€‚<strong>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå…¥ç«™å¤„ç†å™¨ä¸ä¸€å®šè¦åœ¨å‡ºç«™å¤„ç†å™¨å‰é¢ï¼Œè¿™é‡Œå…¥ç«™å¤„ç†å™¨å’Œå‡ºç«™å¤„ç†å™¨çš„é¡ºåºæ˜¯æ ¹æ®ä¸šåŠ¡æ¥çš„ã€‚</strong></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20230503203752899.png"></p><ul><li>å…¥ç«™å¤„ç†å™¨ä¸­ï¼Œctx.fireChannelRead(msg) æ˜¯ <strong>è°ƒç”¨ä¸‹ä¸€ä¸ªå…¥ç«™å¤„ç†å™¨</strong><ul><li>å¦‚æœæ³¨é‡Šæ‰ 1 å¤„ä»£ç ï¼Œåˆ™ä»…ä¼šæ‰“å° 1</li><li>å¦‚æœæ³¨é‡Šæ‰ 2 å¤„ä»£ç ï¼Œåˆ™ä»…ä¼šæ‰“å° 1 2</li></ul></li><li>3 å¤„çš„ ctx.channel().write(msg) ä¼š <strong>ä»å°¾éƒ¨å¼€å§‹è§¦å‘</strong> åç»­å‡ºç«™å¤„ç†å™¨çš„æ‰§è¡Œ<ul><li>å¦‚æœæ³¨é‡Šæ‰ 3 å¤„ä»£ç ï¼Œåˆ™ä»…ä¼šæ‰“å° 1 2 3</li></ul></li><li>ç±»ä¼¼çš„ï¼Œå‡ºç«™å¤„ç†å™¨ä¸­ï¼Œctx.write(msg, promise) çš„è°ƒç”¨ä¹Ÿä¼š <strong>è§¦å‘ä¸Šä¸€ä¸ªå‡ºç«™å¤„ç†å™¨</strong><ul><li>å¦‚æœæ³¨é‡Šæ‰ 6 å¤„ä»£ç ï¼Œåˆ™ä»…ä¼šæ‰“å° 1 2 3 6</li></ul></li><li>ctx.channel().write(msg) vs ctx.write(msg)<ul><li>éƒ½æ˜¯è§¦å‘å‡ºç«™å¤„ç†å™¨çš„æ‰§è¡Œ</li><li>ctx.channel().write(msg) ä»å°¾éƒ¨å¼€å§‹æŸ¥æ‰¾å‡ºç«™å¤„ç†å™¨</li><li>ctx.write(msg) æ˜¯ä»å½“å‰èŠ‚ç‚¹æ‰¾ä¸Šä¸€ä¸ªå‡ºç«™å¤„ç†å™¨</li><li>3 å¤„çš„ ctx.channel().write(msg) å¦‚æœæ”¹ä¸º ctx.write(msg) ä»…ä¼šæ‰“å° 1 2 3ï¼Œå› ä¸ºèŠ‚ç‚¹3 ä¹‹å‰æ²¡æœ‰å…¶å®ƒå‡ºç«™å¤„ç†å™¨äº†ï¼ˆ<strong>å‡è®¾èŠ‚ç‚¹3ä¹‹å‰æœ‰å‡ºç«™å¤„ç†å™¨ï¼Œé‚£ä¹ˆè¿˜æ˜¯ä¼šè°ƒç”¨èŠ‚ç‚¹3ä¹‹å‰çš„å¤„ç†å™¨</strong>ï¼‰</li><li>6 å¤„çš„ ctx.write(msg, promise) å¦‚æœæ”¹ä¸º ctx.channel().write(msg) ä¼šæ‰“å° 1 2 3 6 6 6â€¦ å› ä¸º ctx.channel().write() æ˜¯ä»å°¾éƒ¨å¼€å§‹æŸ¥æ‰¾ï¼Œç»“æœåˆæ˜¯èŠ‚ç‚¹6 è‡ªå·±</li></ul></li></ul><p>å›¾1 - æœåŠ¡ç«¯ pipeline è§¦å‘çš„åŸå§‹æµç¨‹ï¼Œå›¾ä¸­æ•°å­—ä»£è¡¨äº†å¤„ç†æ­¥éª¤çš„å…ˆåæ¬¡åº</p><ul><li>å…¥ç«™æ˜¯ä»<code>head</code>å¼€å§‹å‘åä¼ é€’ï¼Œç›´åˆ°ä¼ é€’åˆ°<code>tail</code></li><li>å‡ºç«™æ˜¯ä»<code>tail</code>å¼€å§‹å‘å‰ä¼ é€’ï¼Œç›´åˆ°ä¼ é€’åˆ°<code>head</code></li></ul><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20230503203806667.png"></p><h4 id="EmbeddedChannel"><a href="#EmbeddedChannel" class="headerlink" title="EmbeddedChannel"></a>EmbeddedChannel</h4><p>EmbenddedChannelæ˜¯Nettyç”¨æ¥æµ‹è¯•çš„ä¸€ä¸ªç±»ï¼Œè¿™æ ·æ¯æ¬¡æµ‹è¯•ä¸éœ€è¦å†é‡æ–°å†™ä¸€ä¸ªå®¢æˆ·ç«¯ä¸€ä¸ªæœåŠ¡ç«¯äº†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> io.netty.channel.ChannelHandlerContext;<br><span class="hljs-keyword">import</span> io.netty.channel.ChannelInboundHandlerAdapter;<br><span class="hljs-keyword">import</span> io.netty.channel.ChannelOutboundHandlerAdapter;<br><span class="hljs-keyword">import</span> io.netty.channel.ChannelPromise;<br><span class="hljs-keyword">import</span> io.netty.channel.embedded.EmbeddedChannel;<br><br><span class="hljs-keyword">import</span> java.util.concurrent.*;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        ChannelInboundHandlerAdapter handler1 = <span class="hljs-keyword">new</span> ChannelInboundHandlerAdapter() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">channelRead</span><span class="hljs-params">(ChannelHandlerContext ctx, Object msg)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>                System.out.println(<span class="hljs-number">1</span>);<br>                <span class="hljs-keyword">super</span>.channelRead(ctx, msg);<br>            &#125;<br>        &#125;;<br>        ChannelInboundHandlerAdapter handler2 = <span class="hljs-keyword">new</span> ChannelInboundHandlerAdapter() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">channelRead</span><span class="hljs-params">(ChannelHandlerContext ctx, Object msg)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>                System.out.println(<span class="hljs-number">2</span>);<br>                <span class="hljs-keyword">super</span>.channelRead(ctx, msg);<br>            &#125;<br>        &#125;;<br>        ChannelInboundHandlerAdapter handler3 = <span class="hljs-keyword">new</span> ChannelInboundHandlerAdapter() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">channelRead</span><span class="hljs-params">(ChannelHandlerContext ctx, Object msg)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>                System.out.println(<span class="hljs-number">3</span>);<br>                <span class="hljs-keyword">super</span>.channelRead(ctx, msg);<br>            &#125;<br>        &#125;;<br>        ChannelOutboundHandlerAdapter handler4 = <span class="hljs-keyword">new</span> ChannelOutboundHandlerAdapter() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">write</span><span class="hljs-params">(ChannelHandlerContext ctx, Object msg, ChannelPromise promise)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>                System.out.println(<span class="hljs-number">4</span>);<br>                <span class="hljs-keyword">super</span>.write(ctx, msg, promise);<br>            &#125;<br>        &#125;;<br>        ChannelOutboundHandlerAdapter handler5 = <span class="hljs-keyword">new</span> ChannelOutboundHandlerAdapter() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">write</span><span class="hljs-params">(ChannelHandlerContext ctx, Object msg, ChannelPromise promise)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>                System.out.println(<span class="hljs-number">5</span>);<br>                <span class="hljs-keyword">super</span>.write(ctx, msg, promise);<br>            &#125;<br>        &#125;;<br>        ChannelOutboundHandlerAdapter handler6 = <span class="hljs-keyword">new</span> ChannelOutboundHandlerAdapter() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">write</span><span class="hljs-params">(ChannelHandlerContext ctx, Object msg, ChannelPromise promise)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>                System.out.println(<span class="hljs-number">6</span>);<br>                <span class="hljs-keyword">super</span>.write(ctx, msg, promise);<br>            &#125;<br>        &#125;;<br>        EmbeddedChannel embeddedChannel = <span class="hljs-keyword">new</span> EmbeddedChannel(handler1, handler2, handler3, handler4, handler5, handler6);<br>        <span class="hljs-comment">// 1. æ¨¡æ‹Ÿå…¥ç«™æ“ä½œ</span><br>        embeddedChannel.writeInbound(<span class="hljs-string">&quot;inbound&quot;</span>);<br><br>        System.out.println(<span class="hljs-string">&quot;-------------------------&quot;</span>);<br><br>        <span class="hljs-comment">// 2. æ¨¡æ‹Ÿå‡ºç«™æ“ä½œ</span><br>        embeddedChannel.writeOutbound(<span class="hljs-string">&quot;oubound&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-number">1</span><br><span class="hljs-number">2</span><br><span class="hljs-number">3</span><br>-------------------------<br><span class="hljs-number">6</span><br><span class="hljs-number">5</span><br><span class="hljs-number">4</span><br></code></pre></td></tr></table></figure><h3 id="3-5-ByteBuf"><a href="#3-5-ByteBuf" class="headerlink" title="3.5 ByteBuf"></a>3.5 ByteBuf</h3><p>æ˜¯å¯¹å­—èŠ‚æ•°æ®çš„å°è£…</p><h4 id="1ï¼‰åˆ›å»º"><a href="#1ï¼‰åˆ›å»º" class="headerlink" title="1ï¼‰åˆ›å»º"></a>1ï¼‰åˆ›å»º</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">ByteBuf buffer = ByteBufAllocator.DEFAULT.buffer(<span class="hljs-number">10</span>);<br>log(buffer);<br></code></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç åˆ›å»ºäº†ä¸€ä¸ªé»˜è®¤çš„ ByteBufï¼ˆæ± åŒ–åŸºäºç›´æ¥å†…å­˜çš„ ByteBufï¼‰ï¼Œåˆå§‹å®¹é‡æ˜¯ 10</p><p>è¾“å‡º</p><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs delphi"><span class="hljs-keyword">read</span> <span class="hljs-keyword">index</span>:<span class="hljs-number">0</span> <span class="hljs-keyword">write</span> <span class="hljs-keyword">index</span>:<span class="hljs-number">0</span> capacity:<span class="hljs-number">10</span><br></code></pre></td></tr></table></figure><p>å…¶ä¸­ log æ–¹æ³•å‚è€ƒå¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">log</span><span class="hljs-params">(ByteBuf buffer)</span> </span>&#123;<br>    <span class="hljs-keyword">int</span> length = buffer.readableBytes();<br>    <span class="hljs-keyword">int</span> rows = length / <span class="hljs-number">16</span> + (length % <span class="hljs-number">15</span> == <span class="hljs-number">0</span> ? <span class="hljs-number">0</span> : <span class="hljs-number">1</span>) + <span class="hljs-number">4</span>;<br>    StringBuilder buf = <span class="hljs-keyword">new</span> StringBuilder(rows * <span class="hljs-number">80</span> * <span class="hljs-number">2</span>)<br>        .append(<span class="hljs-string">&quot;read index:&quot;</span>).append(buffer.readerIndex())<br>        .append(<span class="hljs-string">&quot; write index:&quot;</span>).append(buffer.writerIndex())<br>        .append(<span class="hljs-string">&quot; capacity:&quot;</span>).append(buffer.capacity())<br>        .append(NEWLINE);<br>    appendPrettyHexDump(buf, buffer);<br>    System.out.println(buf.toString());<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="2ï¼‰ç›´æ¥å†…å­˜-vs-å †å†…å­˜"><a href="#2ï¼‰ç›´æ¥å†…å­˜-vs-å †å†…å­˜" class="headerlink" title="2ï¼‰ç›´æ¥å†…å­˜ vs å †å†…å­˜"></a>2ï¼‰ç›´æ¥å†…å­˜ vs å †å†…å­˜</h4><p>å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ä»£ç æ¥åˆ›å»ºæ± åŒ–åŸºäºå †çš„ ByteBuf</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">ByteBuf buffer = ByteBufAllocator.DEFAULT.heapBuffer(<span class="hljs-number">10</span>);<br></code></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ä»£ç æ¥åˆ›å»ºæ± åŒ–åŸºäºç›´æ¥å†…å­˜çš„ ByteBuf</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">ByteBuf buffer = ByteBufAllocator.DEFAULT.directBuffer(<span class="hljs-number">10</span>);<br></code></pre></td></tr></table></figure><ul><li>ç›´æ¥å†…å­˜åˆ›å»ºå’Œé”€æ¯çš„ä»£ä»·æ˜‚è´µï¼Œä½†è¯»å†™æ€§èƒ½é«˜ï¼ˆå°‘ä¸€æ¬¡å†…å­˜å¤åˆ¶ï¼‰ï¼Œé€‚åˆé…åˆæ± åŒ–åŠŸèƒ½ä¸€èµ·ç”¨</li><li>å †å†…å­˜åˆ›å»ºå’Œé”€æ¯çš„ä»£ä»·æ˜‚è´µï¼Œä½†è¯»å†™æ€§èƒ½å·®ï¼ˆå†…å­˜å¤åˆ¶æ¬¡æ•°å¤šï¼‰</li><li>ç›´æ¥å†…å­˜å¯¹ GC å‹åŠ›å°ï¼Œå› ä¸ºè¿™éƒ¨åˆ†å†…å­˜ä¸å— JVM åƒåœ¾å›æ”¶çš„ç®¡ç†ï¼Œä½†ä¹Ÿè¦æ³¨æ„åŠæ—¶ä¸»åŠ¨é‡Šæ”¾</li></ul><h4 id="3ï¼‰æ± åŒ–-vs-éæ± åŒ–"><a href="#3ï¼‰æ± åŒ–-vs-éæ± åŒ–" class="headerlink" title="3ï¼‰æ± åŒ– vs éæ± åŒ–"></a>3ï¼‰æ± åŒ– vs éæ± åŒ–</h4><p>æ± åŒ–çš„æœ€å¤§æ„ä¹‰åœ¨äºå¯ä»¥é‡ç”¨ ByteBufï¼Œä¼˜ç‚¹æœ‰</p><ul><li>æ²¡æœ‰æ± åŒ–ï¼Œåˆ™æ¯æ¬¡éƒ½å¾—åˆ›å»ºæ–°çš„ ByteBuf å®ä¾‹ï¼Œè¿™ä¸ªæ“ä½œå¯¹ç›´æ¥å†…å­˜ä»£ä»·æ˜‚è´µï¼Œå°±ç®—æ˜¯å †å†…å­˜ï¼Œä¹Ÿä¼šå¢åŠ  GC å‹åŠ›</li><li>æœ‰äº†æ± åŒ–ï¼Œåˆ™å¯ä»¥é‡ç”¨æ± ä¸­ ByteBuf å®ä¾‹ï¼Œå¹¶ä¸”é‡‡ç”¨äº†ä¸ jemalloc ç±»ä¼¼çš„å†…å­˜åˆ†é…ç®—æ³•æå‡åˆ†é…æ•ˆç‡</li><li>é«˜å¹¶å‘æ—¶ï¼Œæ± åŒ–åŠŸèƒ½æ›´èŠ‚çº¦å†…å­˜ï¼Œå‡å°‘å†…å­˜æº¢å‡ºçš„å¯èƒ½</li></ul><p>æ± åŒ–åŠŸèƒ½æ˜¯å¦å¼€å¯ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„ç³»ç»Ÿç¯å¢ƒå˜é‡ï¼ˆå³JVMå‚æ•°ï¼‰æ¥è®¾ç½®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">-Dio.netty.allocator.type=&#123;unpooled|pooled&#125;<br></code></pre></td></tr></table></figure><ul><li>4.1 ä»¥åï¼Œé Android å¹³å°é»˜è®¤å¯ç”¨æ± åŒ–å®ç°ï¼ŒAndroid å¹³å°å¯ç”¨éæ± åŒ–å®ç°</li><li>4.1 ä¹‹å‰ï¼Œæ± åŒ–åŠŸèƒ½è¿˜ä¸æˆç†Ÿï¼Œé»˜è®¤æ˜¯éæ± åŒ–å®ç°</li></ul><h4 id="4ï¼‰ç»„æˆ"><a href="#4ï¼‰ç»„æˆ" class="headerlink" title="4ï¼‰ç»„æˆ"></a>4ï¼‰ç»„æˆ</h4><p>ByteBuf ç”±å››éƒ¨åˆ†ç»„æˆ</p><p>é»˜è®¤çš„<code>max capacity </code>= <code>Integer.MAX_VALUE</code>ï¼Œæ‰€ä»¥ByteBufä¸èƒ½æ— é™åˆ¶çš„æ‰©å®¹ã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20230503203822223.png"></p><p>æœ€å¼€å§‹è¯»å†™æŒ‡é’ˆéƒ½åœ¨ 0 ä½ç½®</p><h5 id="ByteBufå’ŒByteBufferç›¸æ¯”"><a href="#ByteBufå’ŒByteBufferç›¸æ¯”" class="headerlink" title="ByteBufå’ŒByteBufferç›¸æ¯”"></a>ByteBufå’ŒByteBufferç›¸æ¯”</h5><ul><li>ByteBufferçš„è¯»å†™æŒ‡é’ˆå…±ç”¨ï¼Œæ‰€ä»¥åœ¨è¯»å†™ä¹‹å‰ï¼Œéœ€è¦åˆ‡æ¢å¯¹åº”çš„è¯»å†™æ¨¡å¼ï¼›ByteBufè¯»å†™æŒ‡é’ˆåˆ†ç¦»ï¼Œæ‰€ä»¥è¯»å†™æ“ä½œä¸éœ€è¦å…ˆåˆ‡æ¢æ¨¡å¼ï¼Œç›´æ¥å¼€å§‹è¯»å†™æ“ä½œã€‚</li><li>ByteBufferå¯¹è±¡ä¸€ç»åˆ›å»ºï¼Œå…¶å®¹é‡ä¸å¯å˜ï¼›ä½†æ˜¯ByteBufå¯¹è±¡å¯ä»¥æ ¹æ®å†™æ“ä½œè‡ªåŠ¨æ‰©å®¹</li><li>ByteBufæœ‰æ± åŒ–åŠŸèƒ½ï¼ŒByteBufferæ²¡æœ‰æ± åŒ–åŠŸèƒ½</li></ul><h4 id="5ï¼‰å†™å…¥"><a href="#5ï¼‰å†™å…¥" class="headerlink" title="5ï¼‰å†™å…¥"></a>5ï¼‰å†™å…¥</h4><p>æ–¹æ³•åˆ—è¡¨ï¼Œçœç•¥ä¸€äº›ä¸é‡è¦çš„æ–¹æ³•</p><table><thead><tr><th>æ–¹æ³•ç­¾å</th><th>å«ä¹‰</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>writeBoolean(boolean value)</td><td>å†™å…¥ boolean å€¼</td><td>ç”¨ä¸€å­—èŠ‚ 01|00 ä»£è¡¨ true|false</td></tr><tr><td>writeByte(int value)</td><td>å†™å…¥ byte å€¼</td><td>writebyteæŠŠJavaå››ä¸ªå­—èŠ‚çš„æœ‰æ•ˆä½å†™è¿›å»ï¼Œä¸€ä¸ªå­—èŠ‚</td></tr><tr><td>writeShort(int value)</td><td>å†™å…¥ short å€¼</td><td></td></tr><tr><td>writeInt(int value)</td><td>å†™å…¥ int å€¼</td><td>Big Endianï¼ˆå¤§ç«¯å†™å…¥ï¼Œå…ˆå†™å…¥å¤§ç«¯ï¼‰ï¼Œå³ 0x250ï¼Œå†™å…¥å 00 00 02 50<strong>ä¸€èˆ¬ç½‘è·¯ç¼–ç¨‹é‡‡ç”¨æ‰“æ–­å†™å…¥</strong></td></tr><tr><td>writeIntLE(int value)</td><td>å†™å…¥ int å€¼</td><td>Little Endianï¼ˆå°ç«¯å†™å…¥ï¼Œå…ˆå†™å…¥å°ç«¯ï¼‰ï¼Œå³ 0x250ï¼Œå†™å…¥å 50 02 00 00</td></tr><tr><td>writeLong(long value)</td><td>å†™å…¥ long å€¼</td><td></td></tr><tr><td>writeChar(int value)</td><td>å†™å…¥ char å€¼</td><td></td></tr><tr><td>writeFloat(float value)</td><td>å†™å…¥ float å€¼</td><td></td></tr><tr><td>writeDouble(double value)</td><td>å†™å…¥ double å€¼</td><td></td></tr><tr><td>writeBytes(ByteBuf src)</td><td>å†™å…¥ netty çš„ ByteBuf</td><td></td></tr><tr><td>writeBytes(byte[] src)</td><td>å†™å…¥ byte[]</td><td></td></tr><tr><td>writeBytes(ByteBuffer src)</td><td>å†™å…¥ nio çš„ ByteBuffer</td><td></td></tr><tr><td>int writeCharSequence(CharSequence sequence, Charset charset)</td><td>å†™å…¥å­—ç¬¦ä¸²</td><td></td></tr></tbody></table><blockquote><p>æ³¨æ„</p><ul><li>è¿™äº›æ–¹æ³•çš„æœªæŒ‡æ˜è¿”å›å€¼çš„ï¼Œå…¶è¿”å›å€¼éƒ½æ˜¯ ByteBufï¼Œæ„å‘³ç€å¯ä»¥é“¾å¼è°ƒç”¨</li><li>ç½‘ç»œä¼ è¾“ï¼Œé»˜è®¤ä¹ æƒ¯æ˜¯ Big Endian</li></ul></blockquote><p>å…ˆå†™å…¥ 4 ä¸ªå­—èŠ‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">buffer.writeBytes(<span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[]&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>&#125;);<br>log(buffer);<br></code></pre></td></tr></table></figure><p>ç»“æœæ˜¯</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">read index:0 write index:4 capacity:10<br><span class="hljs-code">         +-------------------------------------------------+</span><br><span class="hljs-section">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br><span class="hljs-section">|00000000| 01 02 03 04                                     |....            |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br></code></pre></td></tr></table></figure><p>å†å†™å…¥ä¸€ä¸ª int æ•´æ•°ï¼Œä¹Ÿæ˜¯ 4 ä¸ªå­—èŠ‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">buffer.writeInt(<span class="hljs-number">5</span>);<br>log(buffer);<br></code></pre></td></tr></table></figure><p>ç»“æœæ˜¯</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">read index:0 write index:8 capacity:10<br><span class="hljs-code">         +-------------------------------------------------+</span><br><span class="hljs-section">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br><span class="hljs-section">|00000000| 01 02 03 04 00 00 00 05                         |........        |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br></code></pre></td></tr></table></figure><p>è¿˜æœ‰ä¸€ç±»æ–¹æ³•æ˜¯ set å¼€å¤´çš„ä¸€ç³»åˆ—æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥å†™å…¥æ•°æ®ï¼Œä½†ä¸ä¼šæ”¹å˜å†™æŒ‡é’ˆä½ç½®</p><h4 id="6ï¼‰æ‰©å®¹"><a href="#6ï¼‰æ‰©å®¹" class="headerlink" title="6ï¼‰æ‰©å®¹"></a>6ï¼‰æ‰©å®¹</h4><p>å†å†™å…¥ä¸€ä¸ª int æ•´æ•°æ—¶ï¼Œå®¹é‡ä¸å¤Ÿäº†ï¼ˆåˆå§‹å®¹é‡æ˜¯ 10ï¼‰ï¼Œè¿™æ—¶ä¼šå¼•å‘æ‰©å®¹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">buffer.writeInt(<span class="hljs-number">6</span>);<br>log(buffer);<br></code></pre></td></tr></table></figure><p>æ‰©å®¹è§„åˆ™æ˜¯</p><ul><li>å¦‚ä½•å†™å…¥åæ•°æ®å¤§å°æœªè¶…è¿‡ 512ï¼Œåˆ™é€‰æ‹©ä¸‹ä¸€ä¸ª 16 çš„æ•´æ•°å€ï¼Œä¾‹å¦‚å†™å…¥åå¤§å°ä¸º 12 ï¼Œåˆ™æ‰©å®¹å capacity æ˜¯ 16</li><li>å¦‚æœå†™å…¥åæ•°æ®å¤§å°è¶…è¿‡ 512ï¼Œåˆ™é€‰æ‹©ä¸‹ä¸€ä¸ª 2^nï¼Œä¾‹å¦‚å†™å…¥åå¤§å°ä¸º 513ï¼Œåˆ™æ‰©å®¹å capacity æ˜¯ 2^10=1024ï¼ˆ2^9=512 å·²ç»ä¸å¤Ÿäº†ï¼‰</li><li>æ‰©å®¹ä¸èƒ½è¶…è¿‡ max capacity ä¼šæŠ¥é”™</li></ul><p>ç»“æœæ˜¯</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">read index:0 write index:12 capacity:16<br><span class="hljs-code">         +-------------------------------------------------+</span><br><span class="hljs-section">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br><span class="hljs-section">|00000000| 01 02 03 04 00 00 00 05 00 00 00 06             |............    |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br></code></pre></td></tr></table></figure><h4 id="7ï¼‰è¯»å–"><a href="#7ï¼‰è¯»å–" class="headerlink" title="7ï¼‰è¯»å–"></a>7ï¼‰è¯»å–</h4><p>ä¾‹å¦‚è¯»äº† 4 æ¬¡ï¼Œæ¯æ¬¡ä¸€ä¸ªå­—èŠ‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">System.out.println(buffer.readByte());<br>System.out.println(buffer.readByte());<br>System.out.println(buffer.readByte());<br>System.out.println(buffer.readByte());<br>log(buffer);<br></code></pre></td></tr></table></figure><p>è¯»è¿‡çš„å†…å®¹ï¼Œå°±å±äºåºŸå¼ƒéƒ¨åˆ†äº†ï¼Œå†è¯»åªèƒ½è¯»é‚£äº›å°šæœªè¯»å–çš„éƒ¨åˆ†</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">1<br>2<br>3<br>4<br>read index:4 write index:12 capacity:16<br><span class="hljs-code">         +-------------------------------------------------+</span><br><span class="hljs-section">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br><span class="hljs-section">|00000000| 00 00 00 05 00 00 00 06                         |........        |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br></code></pre></td></tr></table></figure><p>å¦‚æœéœ€è¦é‡å¤è¯»å– int æ•´æ•° 5ï¼Œæ€ä¹ˆåŠï¼Ÿ</p><p>å¯ä»¥åœ¨ read å‰å…ˆåšä¸ªæ ‡è®° mark</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">buffer.markReaderIndex();<br>System.out.println(buffer.readInt());<br>log(buffer);<br></code></pre></td></tr></table></figure><p>ç»“æœ</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">5<br>read index:8 write index:12 capacity:16<br><span class="hljs-code">         +-------------------------------------------------+</span><br><span class="hljs-section">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br><span class="hljs-section">|00000000| 00 00 00 06                                     |....            |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br></code></pre></td></tr></table></figure><p>è¿™æ—¶è¦é‡å¤è¯»å–çš„è¯ï¼Œé‡ç½®åˆ°æ ‡è®°ä½ç½® reset</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">buffer.resetReaderIndex();<br>log(buffer);<br></code></pre></td></tr></table></figure><p>è¿™æ—¶</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">read index:4 write index:12 capacity:16<br><span class="hljs-code">         +-------------------------------------------------+</span><br><span class="hljs-section">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br><span class="hljs-section">|00000000| 00 00 00 05 00 00 00 06                         |........        |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br></code></pre></td></tr></table></figure><p>è¿˜æœ‰ç§åŠæ³•æ˜¯é‡‡ç”¨ get å¼€å¤´çš„ä¸€ç³»åˆ—æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•ä¸ä¼šæ”¹å˜ read indexã€‚</p><h4 id="8ï¼‰retain-amp-release-æ–¹æ³•"><a href="#8ï¼‰retain-amp-release-æ–¹æ³•" class="headerlink" title="8ï¼‰retain() &amp; release()æ–¹æ³•"></a>8ï¼‰retain() &amp; release()æ–¹æ³•</h4><p>ç”±äº Netty ä¸­æœ‰å †å¤–å†…å­˜çš„ ByteBuf å®ç°ï¼Œå †å¤–å†…å­˜æœ€å¥½æ˜¯æ‰‹åŠ¨æ¥é‡Šæ”¾ï¼Œè€Œä¸æ˜¯ç­‰ GC åƒåœ¾å›æ”¶ã€‚</p><ul><li>UnpooledHeapByteBuf ä½¿ç”¨çš„æ˜¯ JVM å†…å­˜ï¼Œåªéœ€ç­‰ GC å›æ”¶å†…å­˜å³å¯</li><li>UnpooledDirectByteBuf ä½¿ç”¨çš„å°±æ˜¯ç›´æ¥å†…å­˜äº†ï¼Œè™½ç„¶ç›´æ¥å†…å­˜ä¹Ÿå¯ä»¥ç­‰åˆ°GCå›æ”¶æ—¶ï¼Œé—´æ¥è§¦å‘ç›´æ¥å†…å­˜çš„å›æ”¶ï¼Œä½†æ˜¯è¿™ç§æ•ˆç‡æ¯”è¾ƒæ…¢ï¼Œå¹¶ä¸”ä¸åŠæ—¶ã€‚å¯ä»¥é€šè¿‡ç‰¹æ®Šçš„æ–¹æ³•æ¥å›æ”¶å†…å­˜</li><li>PooledByteBuf å’Œå®ƒçš„å­ç±»ä½¿ç”¨äº†æ± åŒ–æœºåˆ¶ï¼Œéœ€è¦æ›´å¤æ‚çš„è§„åˆ™æ¥å›æ”¶å†…å­˜</li></ul><blockquote><p>å›æ”¶å†…å­˜çš„æºç å®ç°ï¼Œè¯·å…³æ³¨ä¸‹é¢æ–¹æ³•çš„ä¸åŒå®ç°</p><p><code>protected abstract void deallocate()</code></p></blockquote><p>Netty è¿™é‡Œé‡‡ç”¨äº†<strong>å¼•ç”¨è®¡æ•°æ³•</strong>æ¥æ§åˆ¶å›æ”¶å†…å­˜ï¼Œæ¯ä¸ª ByteBuf éƒ½å®ç°äº† ReferenceCounted æ¥å£</p><ul><li>æ¯ä¸ª ByteBuf å¯¹è±¡çš„åˆå§‹è®¡æ•°ä¸º 1</li><li>è°ƒç”¨ release æ–¹æ³•è®¡æ•°å‡ 1ï¼Œå¦‚æœè®¡æ•°ä¸º 0ï¼ŒByteBuf å†…å­˜è¢«å›æ”¶</li><li>è°ƒç”¨ retain æ–¹æ³•è®¡æ•°åŠ  1ï¼Œè¡¨ç¤ºè°ƒç”¨è€…æ²¡ç”¨å®Œä¹‹å‰ï¼Œå…¶å®ƒ handler å³ä½¿è°ƒç”¨äº† release ä¹Ÿä¸ä¼šé€ æˆå›æ”¶</li><li>å½“è®¡æ•°ä¸º 0 æ—¶ï¼Œåº•å±‚å†…å­˜ä¼šè¢«å›æ”¶ï¼Œè¿™æ—¶å³ä½¿ ByteBuf å¯¹è±¡è¿˜åœ¨ï¼Œå…¶å„ä¸ªæ–¹æ³•å‡æ— æ³•æ­£å¸¸ä½¿ç”¨</li></ul><p>è°æ¥è´Ÿè´£è°ƒç”¨ release() æ–¹æ³•å‘¢ï¼Ÿ</p><p>ä¸æ˜¯æˆ‘ä»¬æƒ³è±¡çš„ï¼ˆä¸€èˆ¬æƒ…å†µä¸‹ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java">ByteBuf buf = ...<br><span class="hljs-keyword">try</span> &#123;<br>    ...<br>&#125; <span class="hljs-keyword">finally</span> &#123;<br>    buf.release();<br>&#125;<br></code></pre></td></tr></table></figure><p>è¯·æ€è€ƒï¼Œå› ä¸º pipeline çš„å­˜åœ¨ï¼Œä¸€èˆ¬éœ€è¦å°† ByteBuf ä¼ é€’ç»™ä¸‹ä¸€ä¸ª ChannelHandlerï¼Œå¦‚æœåœ¨ finally ä¸­ release äº†ï¼Œå°±å¤±å»äº†ä¼ é€’æ€§ï¼ˆå½“ç„¶ï¼Œå¦‚æœåœ¨è¿™ä¸ª ChannelHandler å†…è¿™ä¸ª ByteBuf å·²å®Œæˆäº†å®ƒçš„ä½¿å‘½ï¼Œé‚£ä¹ˆä¾¿æ— é¡»å†ä¼ é€’ï¼‰</p><p>åŸºæœ¬è§„åˆ™æ˜¯ï¼Œ<strong>è°æ˜¯æœ€åä½¿ç”¨è€…ï¼Œè°è´Ÿè´£ release</strong>ï¼Œè¯¦ç»†åˆ†æå¦‚ä¸‹</p><ul><li>èµ·ç‚¹ï¼Œå¯¹äº NIO å®ç°æ¥è®²ï¼Œåœ¨ io.netty.channel.nio.AbstractNioByteChannel.NioByteUnsafe#read æ–¹æ³•ä¸­é¦–æ¬¡åˆ›å»º ByteBuf æ”¾å…¥ pipelineï¼ˆline 163 pipeline.fireChannelRead(byteBuf)ï¼‰</li><li>å…¥ç«™ ByteBuf å¤„ç†åŸåˆ™<ul><li>å¯¹åŸå§‹ ByteBuf ä¸åšå¤„ç†ï¼Œè°ƒç”¨ ctx.fireChannelRead(msg) å‘åä¼ é€’ï¼Œè¿™æ—¶æ— é¡» release</li><li>å°†åŸå§‹ ByteBuf è½¬æ¢ä¸ºå…¶å®ƒç±»å‹çš„ Java å¯¹è±¡ï¼Œè¿™æ—¶ ByteBuf å°±æ²¡ç”¨äº†ï¼Œå¿…é¡» release</li><li>å¦‚æœä¸è°ƒç”¨ ctx.fireChannelRead(msg) å‘åä¼ é€’ï¼Œé‚£ä¹ˆä¹Ÿå¿…é¡» release</li><li>æ³¨æ„å„ç§å¼‚å¸¸ï¼Œå¦‚æœ ByteBuf æ²¡æœ‰æˆåŠŸä¼ é€’åˆ°ä¸‹ä¸€ä¸ª ChannelHandlerï¼Œå¿…é¡» release</li><li>å‡è®¾æ¶ˆæ¯ä¸€ç›´å‘åä¼ ï¼Œé‚£ä¹ˆ TailContext ä¼šè´Ÿè´£é‡Šæ”¾æœªå¤„ç†æ¶ˆæ¯ï¼ˆåŸå§‹çš„ ByteBufï¼‰</li></ul></li><li>å‡ºç«™ ByteBuf å¤„ç†åŸåˆ™<ul><li>å‡ºç«™æ¶ˆæ¯æœ€ç»ˆéƒ½ä¼šè½¬ä¸º ByteBuf è¾“å‡ºï¼Œä¸€ç›´å‘å‰ä¼ ï¼Œç”± HeadContext flush å release</li></ul></li><li>å¼‚å¸¸å¤„ç†åŸåˆ™<ul><li>æœ‰æ—¶å€™ä¸æ¸…æ¥š ByteBuf è¢«å¼•ç”¨äº†å¤šå°‘æ¬¡ï¼Œä½†åˆå¿…é¡»å½»åº•é‡Šæ”¾ï¼Œå¯ä»¥å¾ªç¯è°ƒç”¨ release ç›´åˆ°è¿”å› true</li></ul></li></ul><p>TailContext é‡Šæ”¾å…¥ç«™æœªå¤„ç†ByteBufé€»è¾‘</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// io.netty.channel.DefaultChannelPipeline#onUnhandledInboundMessage(java.lang.Object)</span><br><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onUnhandledInboundMessage</span><span class="hljs-params">(Object msg)</span> </span>&#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>        logger.debug(<br>            <span class="hljs-string">&quot;Discarded inbound message &#123;&#125; that reached at the tail of the pipeline. &quot;</span> +<br>            <span class="hljs-string">&quot;Please check your pipeline configuration.&quot;</span>, msg);<br>    &#125; <span class="hljs-keyword">finally</span> &#123;<br>        ReferenceCountUtil.release(msg);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å…·ä½“ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// io.netty.util.ReferenceCountUtil#release(java.lang.Object)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">release</span><span class="hljs-params">(Object msg)</span> </span>&#123;<br>    <span class="hljs-keyword">if</span> (msg <span class="hljs-keyword">instanceof</span> ReferenceCounted) &#123;<br>        <span class="hljs-keyword">return</span> ((ReferenceCounted) msg).release();<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>HeadContext é‡Šæ”¾å‡ºç«™æœªå¤„ç†ByteBufé€»è¾‘</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// io.netty.channel.DefaultChannelPipeline.HeadContext</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">write</span><span class="hljs-params">(ChannelHandlerContext ctx, Object msg, ChannelPromise promise)</span> </span>&#123;<br>    <span class="hljs-keyword">this</span>.unsafe.write(msg, promise);<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//io.netty.channel.AbstractChannel.AbstractUnsafe</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title">write</span><span class="hljs-params">(Object msg, ChannelPromise promise)</span> </span>&#123;<br>    <span class="hljs-keyword">this</span>.assertEventLoop();<br>    ChannelOutboundBuffer outboundBuffer = <span class="hljs-keyword">this</span>.outboundBuffer;<br>    <span class="hljs-keyword">if</span> (outboundBuffer == <span class="hljs-keyword">null</span>) &#123;<br>        <span class="hljs-keyword">this</span>.safeSetFailure(promise, <span class="hljs-keyword">this</span>.newClosedChannelException(AbstractChannel.<span class="hljs-keyword">this</span>.initialCloseCause));<br>        ReferenceCountUtil.release(msg); <span class="hljs-comment">// é‡Šæ”¾ByteBuf</span><br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">int</span> size;<br>        <span class="hljs-keyword">try</span> &#123;<br>            msg = AbstractChannel.<span class="hljs-keyword">this</span>.filterOutboundMessage(msg);<br>            size = AbstractChannel.<span class="hljs-keyword">this</span>.pipeline.estimatorHandle().size(msg);<br>            <span class="hljs-keyword">if</span> (size &lt; <span class="hljs-number">0</span>) &#123;<br>                size = <span class="hljs-number">0</span>;<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (Throwable var6) &#123;<br>            <span class="hljs-keyword">this</span>.safeSetFailure(promise, var6);<br>            ReferenceCountUtil.release(msg);<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br><br>        outboundBuffer.addMessage(msg, size, promise);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="9ï¼‰slice-æ–¹æ³•"><a href="#9ï¼‰slice-æ–¹æ³•" class="headerlink" title="9ï¼‰slice()æ–¹æ³•"></a>9ï¼‰slice()æ–¹æ³•</h4><p>ã€é›¶æ‹·è´ã€‘çš„ä½“ç°ä¹‹ä¸€ï¼Œå¯¹åŸå§‹ ByteBuf è¿›è¡Œåˆ‡ç‰‡æˆå¤šä¸ª ByteBufï¼Œåˆ‡ç‰‡åçš„ ByteBuf å¹¶æ²¡æœ‰å‘ç”Ÿå†…å­˜å¤åˆ¶ï¼Œè¿˜æ˜¯ä½¿ç”¨åŸå§‹ ByteBuf çš„å†…å­˜ï¼Œåˆ‡ç‰‡åçš„ ByteBuf ç»´æŠ¤ç‹¬ç«‹çš„ readï¼Œwrite æŒ‡é’ˆ</p><p><strong>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåˆ‡ç‰‡åçš„ByteBufçš„max capacityè¢«å›ºå®šä¸ºè¯¥åˆ‡ç‰‡çš„å¤§å°ï¼Œä¸èƒ½å®è¡Œè¿½åŠ å†™æ“ä½œï¼Œä½†æ˜¯å¯ä»¥åœ¨è¯¥åˆ‡ç‰‡å¤§å°å†…ä¿®æ”¹å€¼ã€‚</strong></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20230503203838719.png"></p><p>ä¾‹ï¼ŒåŸå§‹ ByteBuf è¿›è¡Œä¸€äº›åˆå§‹æ“ä½œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">ByteBuf origin = ByteBufAllocator.DEFAULT.buffer(<span class="hljs-number">10</span>);<br>origin.writeBytes(<span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[]&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>&#125;);<br>origin.readByte();<br>System.out.println(ByteBufUtil.prettyHexDump(origin));<br></code></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-code">         +-------------------------------------------------+</span><br><span class="hljs-section">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br><span class="hljs-section">|00000000| 02 03 04                                        |...             |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br></code></pre></td></tr></table></figure><p>è¿™æ—¶è°ƒç”¨ slice è¿›è¡Œåˆ‡ç‰‡ï¼Œæ— å‚ slice æ˜¯ä»åŸå§‹ ByteBuf çš„ read index åˆ° write index ä¹‹é—´çš„å†…å®¹è¿›è¡Œåˆ‡ç‰‡ï¼Œåˆ‡ç‰‡åçš„ max capacity è¢«å›ºå®šä¸ºè¿™ä¸ªåŒºé—´çš„å¤§å°ï¼Œå› æ­¤ä¸èƒ½è¿½åŠ  write</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">ByteBuf slice = origin.slice();<br>System.out.println(ByteBufUtil.prettyHexDump(slice));<br><span class="hljs-comment">// slice.writeByte(5); å¦‚æœæ‰§è¡Œï¼Œä¼šæŠ¥ IndexOutOfBoundsException å¼‚å¸¸</span><br></code></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-code">         +-------------------------------------------------+</span><br><span class="hljs-section">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br><span class="hljs-section">|00000000| 02 03 04                                        |...             |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br></code></pre></td></tr></table></figure><p>å¦‚æœåŸå§‹ ByteBuf å†æ¬¡è¯»æ“ä½œï¼ˆåˆè¯»äº†ä¸€ä¸ªå­—èŠ‚ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">origin.readByte();<br>System.out.println(ByteBufUtil.prettyHexDump(origin));<br></code></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-code">         +-------------------------------------------------+</span><br><span class="hljs-section">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br><span class="hljs-section">|00000000| 03 04                                           |..              |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br></code></pre></td></tr></table></figure><p>è¿™æ—¶çš„ slice ä¸å—å½±å“ï¼Œå› ä¸ºå®ƒæœ‰ç‹¬ç«‹çš„è¯»å†™æŒ‡é’ˆ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">System.out.println(ByteBufUtil.prettyHexDump(slice));<br></code></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-code">         +-------------------------------------------------+</span><br><span class="hljs-section">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br><span class="hljs-section">|00000000| 02 03 04                                        |...             |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br></code></pre></td></tr></table></figure><p>å¦‚æœ slice çš„å†…å®¹å‘ç”Ÿäº†æ›´æ”¹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">slice.setByte(<span class="hljs-number">2</span>, <span class="hljs-number">5</span>);<br>System.out.println(ByteBufUtil.prettyHexDump(slice));<br></code></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-code">         +-------------------------------------------------+</span><br><span class="hljs-section">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br><span class="hljs-section">|00000000| 02 03 05                                        |...             |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br></code></pre></td></tr></table></figure><p>è¿™æ—¶ï¼ŒåŸå§‹ ByteBuf ä¹Ÿä¼šå—å½±å“ï¼Œå› ä¸ºåº•å±‚éƒ½æ˜¯åŒä¸€å—å†…å­˜</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ByteBufUtil</span>.</span></span>pretty<span class="hljs-constructor">HexDump(<span class="hljs-params">origin</span>)</span>);<br></code></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-code">         +-------------------------------------------------+</span><br><span class="hljs-section">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br><span class="hljs-section">|00000000| 03 05                                           |..              |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br></code></pre></td></tr></table></figure><blockquote><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼š</p><p>å¦‚æœåŸå§‹ByteBufæˆ–è€…è¯¥å¯¹è±¡çš„åˆ‡ç‰‡è°ƒç”¨release()æ–¹æ³•å¹¶ä¸”å¯¼è‡´è¯¥å¯¹è±¡è¢«é‡Šæ”¾ï¼Œæ­¤æ—¶åŸå§‹çš„ByteBufå¯¹è±¡å’Œæ‰€æœ‰çš„åˆ‡ç‰‡ä¹Ÿè¢«é‡Šæ”¾æ‰äº†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> io.netty.buffer.ByteBuf;<br><span class="hljs-keyword">import</span> io.netty.buffer.ByteBufAllocator;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        ByteBuf buffer = ByteBufAllocator.DEFAULT.buffer(<span class="hljs-number">10</span>);<br>        ByteBuf slice = buffer.slice(<span class="hljs-number">0</span>, <span class="hljs-number">5</span>);<br>        slice.release();<br>        System.out.println(buffer.writeBytes(<span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[]&#123;<span class="hljs-string">&#x27;a&#x27;</span>&#125;));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">Exception in thread &quot;main&quot; io.netty.util.IllegalReferenceCountException: refCnt: 0<br>at io.netty.buffer.AbstractByteBuf.ensureAccessible(AbstractByteBuf.java:1464)<br>at io.netty.buffer.AbstractByteBuf.ensureWritable0(AbstractByteBuf.java:279)<br>at io.netty.buffer.AbstractByteBuf.ensureWritable(AbstractByteBuf.java:274)<br>at io.netty.buffer.AbstractByteBuf.writeBytes(AbstractByteBuf.java:1081)<br>at io.netty.buffer.AbstractByteBuf.writeBytes(AbstractByteBuf.java:1089)<br>at Test.main(Test.java:16)<br></code></pre></td></tr></table></figure></blockquote><h4 id="10ï¼‰duplicate-æ–¹æ³•"><a href="#10ï¼‰duplicate-æ–¹æ³•" class="headerlink" title="10ï¼‰duplicate()æ–¹æ³•"></a>10ï¼‰duplicate()æ–¹æ³•</h4><p>ã€é›¶æ‹·è´ã€‘çš„ä½“ç°ä¹‹ä¸€ï¼Œå°±å¥½æ¯”æˆªå–äº†åŸå§‹ ByteBuf æ‰€æœ‰å†…å®¹ï¼Œå¹¶ä¸”æ²¡æœ‰ max capacity çš„é™åˆ¶ï¼ˆæ„æ€æ˜¯å¯ä»¥è¿½åŠ å†™å…¥ï¼‰ï¼Œä¹Ÿæ˜¯ä¸åŸå§‹ ByteBuf ä½¿ç”¨åŒä¸€å—åº•å±‚å†…å­˜ï¼Œåªæ˜¯è¯»å†™æŒ‡é’ˆæ˜¯ç‹¬ç«‹çš„ã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20230503203854042.png"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> io.netty.buffer.ByteBuf;<br><span class="hljs-keyword">import</span> io.netty.buffer.ByteBufAllocator;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        ByteBuf buffer = ByteBufAllocator.DEFAULT.buffer(<span class="hljs-number">10</span>);<br>        buffer.writeBytes(<span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[]&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>&#125;);<br>        ByteBuf slice = buffer.slice(<span class="hljs-number">0</span>, <span class="hljs-number">5</span>);<br>        ByteBuf duplicate = slice.duplicate();<br>        duplicate.writeBytes(<span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[]&#123;<span class="hljs-number">6</span>&#125;);<br>        System.out.println(buffer.toString());<br>        System.out.println(slice.toString());<br>        System.out.println(duplicate.toString());<br>        System.out.println(buffer.getByte(<span class="hljs-number">5</span>));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">PooledUnsafeDirectByteBuf(ridx: <span class="hljs-number">0</span>, widx: <span class="hljs-number">5</span>, cap: <span class="hljs-number">10</span>)<br>UnpooledSlicedByteBuf(ridx: <span class="hljs-number">0</span>, widx: <span class="hljs-number">5</span>, cap: <span class="hljs-number">5</span>/<span class="hljs-number">5</span>, unwrapped: PooledUnsafeDirectByteBuf(ridx: <span class="hljs-number">0</span>, widx: <span class="hljs-number">5</span>, cap: <span class="hljs-number">10</span>))<br>UnpooledDuplicatedByteBuf(ridx: <span class="hljs-number">0</span>, widx: <span class="hljs-number">6</span>, cap: <span class="hljs-number">10</span>, unwrapped: PooledUnsafeDirectByteBuf(ridx: <span class="hljs-number">0</span>, widx: <span class="hljs-number">5</span>, cap: <span class="hljs-number">10</span>))<br><span class="hljs-number">6</span><br></code></pre></td></tr></table></figure><h4 id="11ï¼‰copy-æ–¹æ³•"><a href="#11ï¼‰copy-æ–¹æ³•" class="headerlink" title="11ï¼‰copy()æ–¹æ³•"></a>11ï¼‰copy()æ–¹æ³•</h4><p>ä¼šå°†åº•å±‚å†…å­˜æ•°æ®è¿›è¡Œæ·±æ‹·è´ï¼Œå› æ­¤æ— è®ºè¯»å†™ï¼Œéƒ½ä¸åŸå§‹ ByteBuf æ— å…³ã€‚</p><h4 id="12ï¼‰CompositeByteBufç±»"><a href="#12ï¼‰CompositeByteBufç±»" class="headerlink" title="12ï¼‰CompositeByteBufç±»"></a>12ï¼‰CompositeByteBufç±»</h4><p>ã€é›¶æ‹·è´ã€‘çš„ä½“ç°ä¹‹ä¸€ï¼Œå¯ä»¥å°†å¤šä¸ª ByteBuf åˆå¹¶ä¸ºä¸€ä¸ªé€»è¾‘ä¸Šçš„ ByteBufï¼Œé¿å…æ‹·è´</p><p>æœ‰ä¸¤ä¸ª ByteBuf å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java">ByteBuf buf1 = ByteBufAllocator.DEFAULT.buffer(<span class="hljs-number">5</span>);<br>buf1.writeBytes(<span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[]&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>&#125;);<br>ByteBuf buf2 = ByteBufAllocator.DEFAULT.buffer(<span class="hljs-number">5</span>);<br>buf2.writeBytes(<span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[]&#123;<span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">10</span>&#125;);<br>System.out.println(ByteBufUtil.prettyHexDump(buf1));<br>System.out.println(ByteBufUtil.prettyHexDump(buf2));<br></code></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-code">         +-------------------------------------------------+</span><br><span class="hljs-section">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br><span class="hljs-section">|00000000| 01 02 03 04 05                                  |.....           |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br><span class="hljs-code">         +-------------------------------------------------+</span><br><span class="hljs-section">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br><span class="hljs-section">|00000000| 06 07 08 09 0a                                  |.....           |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br></code></pre></td></tr></table></figure><p>ç°åœ¨éœ€è¦ä¸€ä¸ªæ–°çš„ ByteBufï¼Œå†…å®¹æ¥è‡ªäºåˆšæ‰çš„ buf1 å’Œ buf2ï¼Œå¦‚ä½•å®ç°ï¼Ÿ</p><p>æ–¹æ³•1ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">ByteBuf buf3 = ByteBufAllocator.DEFAULT<br>    .buffer(buf1.readableBytes()+buf2.readableBytes());<br>buf3.writeBytes(buf1).writeBytes(buf2);<br>System.out.println(ByteBufUtil.prettyHexDump(buf3));<br></code></pre></td></tr></table></figure><p>ç»“æœ</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-code">         +-------------------------------------------------+</span><br><span class="hljs-section">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br><span class="hljs-section">|00000000| 01 02 03 04 05 06 07 08 09 0a                   |..........      |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br></code></pre></td></tr></table></figure><p>è¿™ç§æ–¹æ³•å¥½ä¸å¥½ï¼Ÿå›ç­”æ˜¯ä¸å¤ªå¥½ï¼Œå› ä¸ºè¿›è¡Œäº†æ•°æ®çš„å†…å­˜å¤åˆ¶æ“ä½œ</p><p>æ–¹æ³•2ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">CompositeByteBuf buf3 = ByteBufAllocator.DEFAULT.compositeBuffer();<br><span class="hljs-comment">// true è¡¨ç¤ºå¢åŠ æ–°çš„ ByteBuf è‡ªåŠ¨é€’å¢ write index, å¦åˆ™ write index ä¼šå§‹ç»ˆä¸º 0</span><br>buf3.addComponents(<span class="hljs-keyword">true</span>, buf1, buf2);<br></code></pre></td></tr></table></figure><p>ç»“æœæ˜¯ä¸€æ ·çš„</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-code">         +-------------------------------------------------+</span><br><span class="hljs-section">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br><span class="hljs-section">|00000000| 01 02 03 04 05 06 07 08 09 0a                   |..........      |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br></code></pre></td></tr></table></figure><p>CompositeByteBuf æ˜¯ä¸€ä¸ªç»„åˆçš„ ByteBufï¼Œå®ƒå†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ª Component æ•°ç»„ï¼Œæ¯ä¸ª Component ç®¡ç†ä¸€ä¸ª ByteBufï¼Œè®°å½•äº†è¿™ä¸ª ByteBuf ç›¸å¯¹äºæ•´ä½“åç§»é‡ç­‰ä¿¡æ¯ï¼Œä»£è¡¨ç€æ•´ä½“ä¸­æŸä¸€æ®µçš„æ•°æ®ã€‚</p><ul><li>ä¼˜ç‚¹ï¼Œå¯¹å¤–æ˜¯ä¸€ä¸ªè™šæ‹Ÿè§†å›¾ï¼Œç»„åˆè¿™äº› ByteBuf ä¸ä¼šäº§ç”Ÿå†…å­˜å¤åˆ¶</li><li>ç¼ºç‚¹ï¼Œå¤æ‚äº†å¾ˆå¤šï¼Œå¤šæ¬¡æ“ä½œä¼šå¸¦æ¥æ€§èƒ½çš„æŸè€—</li></ul><h4 id="13ï¼‰Unpooledå·¥å…·ç±»"><a href="#13ï¼‰Unpooledå·¥å…·ç±»" class="headerlink" title="13ï¼‰Unpooledå·¥å…·ç±»"></a>13ï¼‰Unpooledå·¥å…·ç±»</h4><p>Unpooled æ˜¯ä¸€ä¸ªå·¥å…·ç±»ï¼Œç±»å¦‚å…¶åï¼Œæä¾›äº†éæ± åŒ–çš„ ByteBuf åˆ›å»ºã€ç»„åˆã€å¤åˆ¶ç­‰æ“ä½œ</p><p>è¿™é‡Œä»…ä»‹ç»å…¶è·Ÿã€é›¶æ‹·è´ã€‘ç›¸å…³çš„ wrappedBuffer æ–¹æ³•ï¼Œå¯ä»¥ç”¨æ¥åŒ…è£… ByteBuf</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java">ByteBuf buf1 = ByteBufAllocator.DEFAULT.buffer(<span class="hljs-number">5</span>);<br>buf1.writeBytes(<span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[]&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>&#125;);<br>ByteBuf buf2 = ByteBufAllocator.DEFAULT.buffer(<span class="hljs-number">5</span>);<br>buf2.writeBytes(<span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[]&#123;<span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">10</span>&#125;);<br><br><span class="hljs-comment">// å½“åŒ…è£… ByteBuf ä¸ªæ•°è¶…è¿‡ä¸€ä¸ªæ—¶, åº•å±‚ä½¿ç”¨äº† CompositeByteBuf</span><br>ByteBuf buf3 = Unpooled.wrappedBuffer(buf1, buf2);<br>System.out.println(ByteBufUtil.prettyHexDump(buf3));<br></code></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-code">         +-------------------------------------------------+</span><br><span class="hljs-section">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br><span class="hljs-section">|00000000| 01 02 03 04 05 06 07 08 09 0a                   |..........      |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br></code></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥ç”¨æ¥åŒ…è£…æ™®é€šå­—èŠ‚æ•°ç»„ï¼Œåº•å±‚ä¹Ÿä¸ä¼šæœ‰æ‹·è´æ“ä½œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">ByteBuf buf4 = Unpooled.wrappedBuffer(<span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[]&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>&#125;, <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[]&#123;<span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>&#125;);<br>System.out.println(buf4.getClass());<br>System.out.println(ByteBufUtil.prettyHexDump(buf4));<br></code></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">class io.netty.buffer.CompositeByteBuf<br><span class="hljs-code">         +-------------------------------------------------+</span><br><span class="hljs-section">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br><span class="hljs-section">|00000000| 01 02 03 04 05 06                               |......          |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br></code></pre></td></tr></table></figure><h4 id="ğŸ’¡-ByteBuf-ä¼˜åŠ¿"><a href="#ğŸ’¡-ByteBuf-ä¼˜åŠ¿" class="headerlink" title="ğŸ’¡ ByteBuf ä¼˜åŠ¿"></a>ğŸ’¡ ByteBuf ä¼˜åŠ¿</h4><ul><li>æ± åŒ– - å¯ä»¥é‡ç”¨æ± ä¸­ ByteBuf å®ä¾‹ï¼Œæ›´èŠ‚çº¦å†…å­˜ï¼Œå‡å°‘å†…å­˜æº¢å‡ºçš„å¯èƒ½</li><li>è¯»å†™æŒ‡é’ˆåˆ†ç¦»ï¼Œä¸éœ€è¦åƒ ByteBuffer ä¸€æ ·åˆ‡æ¢è¯»å†™æ¨¡å¼</li><li>å¯ä»¥è‡ªåŠ¨æ‰©å®¹</li><li>æ”¯æŒé“¾å¼è°ƒç”¨ï¼Œä½¿ç”¨æ›´æµç•…</li><li>å¾ˆå¤šåœ°æ–¹ä½“ç°é›¶æ‹·è´ï¼Œä¾‹å¦‚ sliceã€duplicateã€CompositeByteBuf</li></ul><h2 id="4-åŒå‘é€šä¿¡"><a href="#4-åŒå‘é€šä¿¡" class="headerlink" title="4. åŒå‘é€šä¿¡"></a>4. åŒå‘é€šä¿¡</h2><h3 id="4-1-ç»ƒä¹ "><a href="#4-1-ç»ƒä¹ " class="headerlink" title="4.1 ç»ƒä¹ "></a>4.1 ç»ƒä¹ </h3><p>å®ç°ä¸€ä¸ª echo server</p><p>ç¼–å†™ server</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">new</span> ServerBootstrap()<br>    .group(<span class="hljs-keyword">new</span> NioEventLoopGroup())<br>    .channel(NioServerSocketChannel.class)<br>    .childHandler(<span class="hljs-keyword">new</span> ChannelInitializer&lt;NioSocketChannel&gt;() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initChannel</span><span class="hljs-params">(NioSocketChannel ch)</span> </span>&#123;<br>            ch.pipeline().addLast(<span class="hljs-keyword">new</span> ChannelInboundHandlerAdapter()&#123;<br>                <span class="hljs-meta">@Override</span><br>                <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">channelRead</span><span class="hljs-params">(ChannelHandlerContext ctx, Object msg)</span> </span>&#123;<br>                    ByteBuf buffer = (ByteBuf) msg;<br>                    System.out.println(buffer.toString(Charset.defaultCharset()));<br><br>                    <span class="hljs-comment">// å»ºè®®ä½¿ç”¨ ctx.alloc() åˆ›å»º ByteBuf</span><br>                    ByteBuf response = ctx.alloc().buffer();<br>                    response.writeBytes(buffer);<br>                    ctx.writeAndFlush(response);<br><br>                    <span class="hljs-comment">// æ€è€ƒï¼šéœ€è¦é‡Šæ”¾ buffer å—         ç­”ï¼šéœ€è¦ï¼Œå› ä¸ºbufferæ²¡æœ‰å‘åä¼ é€’ï¼Œæ‰€ä»¥å¿…é¡»åœ¨è¿™é‡Œé‡Šæ”¾</span><br>                    <span class="hljs-comment">// æ€è€ƒï¼šéœ€è¦é‡Šæ”¾ response å—ç­”ï¼šä¸éœ€è¦ï¼Œå› ä¸ºresponseè¿›å…¥äº†å‡ºç«™æ“ä½œï¼ŒHeadContextä¼šè¿›è¡Œé‡Šæ”¾ï¼Œè¿™é‡Œå¯ä»¥ä¸ç”¨é‡Šæ”¾</span><br>                &#125;<br>            &#125;);<br>        &#125;<br>    &#125;).bind(<span class="hljs-number">8080</span>);<br></code></pre></td></tr></table></figure><p>ç¼–å†™ client</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java">NioEventLoopGroup group = <span class="hljs-keyword">new</span> NioEventLoopGroup();<br>Channel channel = <span class="hljs-keyword">new</span> Bootstrap()<br>    .group(group)<br>    .channel(NioSocketChannel.class)<br>    .handler(<span class="hljs-keyword">new</span> ChannelInitializer&lt;NioSocketChannel&gt;() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initChannel</span><span class="hljs-params">(NioSocketChannel ch)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>            ch.pipeline().addLast(<span class="hljs-keyword">new</span> StringEncoder());<br>            ch.pipeline().addLast(<span class="hljs-keyword">new</span> ChannelInboundHandlerAdapter() &#123;<br>                <span class="hljs-meta">@Override</span><br>                <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">channelRead</span><span class="hljs-params">(ChannelHandlerContext ctx, Object msg)</span> </span>&#123;<br>                    ByteBuf buffer = (ByteBuf) msg;<br>                    System.out.println(buffer.toString(Charset.defaultCharset()));<br><br>                    <span class="hljs-comment">// æ€è€ƒï¼šéœ€è¦é‡Šæ”¾ buffer å—ç­”ï¼šéœ€è¦é‡Šæ”¾bufferï¼Œå› ä¸ºbufferæ²¡æœ‰å‘åä¼ é€’äº†ã€‚</span><br>                &#125;<br>            &#125;);<br>        &#125;<br>    &#125;).connect(<span class="hljs-string">&quot;127.0.0.1&quot;</span>, <span class="hljs-number">8080</span>).sync().channel();<br><br>channel.closeFuture().addListener(future -&gt; &#123;<br>    group.shutdownGracefully();<br>&#125;);<br><br><span class="hljs-keyword">new</span> Thread(() -&gt; &#123;<br>    Scanner scanner = <span class="hljs-keyword">new</span> Scanner(System.in);<br>    <span class="hljs-keyword">while</span> (<span class="hljs-keyword">true</span>) &#123;<br>        String line = scanner.nextLine();<br>        <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;q&quot;</span>.equals(line)) &#123;<br>            channel.close();<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>        channel.writeAndFlush(line);<br>    &#125;<br>&#125;).start();<br></code></pre></td></tr></table></figure><h3 id="ğŸ’¡-è¯»å’Œå†™çš„è¯¯è§£"><a href="#ğŸ’¡-è¯»å’Œå†™çš„è¯¯è§£" class="headerlink" title="ğŸ’¡ è¯»å’Œå†™çš„è¯¯è§£"></a>ğŸ’¡ è¯»å’Œå†™çš„è¯¯è§£</h3><p>æˆ‘æœ€åˆåœ¨è®¤è¯†ä¸Šæœ‰è¿™æ ·çš„è¯¯åŒºï¼Œè®¤ä¸ºåªæœ‰åœ¨ nettyï¼Œnio è¿™æ ·çš„å¤šè·¯å¤ç”¨ IO æ¨¡å‹æ—¶ï¼Œè¯»å†™æ‰ä¸ä¼šç›¸äº’é˜»å¡ï¼Œæ‰å¯ä»¥å®ç°é«˜æ•ˆçš„åŒå‘é€šä¿¡ï¼Œä½†å®é™…ä¸Šï¼ŒJava Socket æ˜¯å…¨åŒå·¥çš„ï¼šåœ¨ä»»æ„æ—¶åˆ»ï¼Œçº¿è·¯ä¸Šå­˜åœ¨<code>A åˆ° B</code> å’Œ <code>B åˆ° A</code> çš„åŒå‘ä¿¡å·ä¼ è¾“ã€‚å³ä½¿æ˜¯é˜»å¡ IOï¼Œè¯»å’Œå†™æ˜¯å¯ä»¥åŒæ—¶è¿›è¡Œçš„ï¼Œåªè¦åˆ†åˆ«é‡‡ç”¨è¯»çº¿ç¨‹å’Œå†™çº¿ç¨‹å³å¯ï¼Œè¯»ä¸ä¼šé˜»å¡å†™ã€å†™ä¹Ÿä¸ä¼šé˜»å¡è¯»</p><p>ä¾‹å¦‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestServer</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>        ServerSocket ss = <span class="hljs-keyword">new</span> ServerSocket(<span class="hljs-number">8888</span>);<br>        Socket s = ss.accept();<br><br>        <span class="hljs-keyword">new</span> Thread(() -&gt; &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                BufferedReader reader = <span class="hljs-keyword">new</span> BufferedReader(<span class="hljs-keyword">new</span> InputStreamReader(s.getInputStream()));<br>                <span class="hljs-keyword">while</span> (<span class="hljs-keyword">true</span>) &#123;<br>                    System.out.println(reader.readLine());<br>                &#125;<br>            &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;).start();<br><br>        <span class="hljs-keyword">new</span> Thread(() -&gt; &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                BufferedWriter writer = <span class="hljs-keyword">new</span> BufferedWriter(<span class="hljs-keyword">new</span> OutputStreamWriter(s.getOutputStream()));<br>                <span class="hljs-comment">// ä¾‹å¦‚åœ¨è¿™ä¸ªä½ç½®åŠ å…¥ thread çº§åˆ«æ–­ç‚¹ï¼Œå¯ä»¥å‘ç°å³ä½¿ä¸å†™å…¥æ•°æ®ï¼Œä¹Ÿä¸å¦¨ç¢å‰é¢çº¿ç¨‹è¯»å–å®¢æˆ·ç«¯æ•°æ®</span><br>                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; i++) &#123;<br>                    writer.write(String.valueOf(i));<br>                    writer.newLine();<br>                    writer.flush();<br>                &#125;<br>            &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;).start();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestClient</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>        Socket s = <span class="hljs-keyword">new</span> Socket(<span class="hljs-string">&quot;localhost&quot;</span>, <span class="hljs-number">8888</span>);<br><br>        <span class="hljs-keyword">new</span> Thread(() -&gt; &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                BufferedReader reader = <span class="hljs-keyword">new</span> BufferedReader(<span class="hljs-keyword">new</span> InputStreamReader(s.getInputStream()));<br>                <span class="hljs-keyword">while</span> (<span class="hljs-keyword">true</span>) &#123;<br>                    System.out.println(reader.readLine());<br>                &#125;<br>            &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;).start();<br><br>        <span class="hljs-keyword">new</span> Thread(() -&gt; &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                BufferedWriter writer = <span class="hljs-keyword">new</span> BufferedWriter(<span class="hljs-keyword">new</span> OutputStreamWriter(s.getOutputStream()));<br>                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; i++) &#123;<br>                    writer.write(String.valueOf(i));<br>                    writer.newLine();<br>                    writer.flush();<br>                &#125;<br>            &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;).start();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="ä¸‰-Netty-è¿›é˜¶"><a href="#ä¸‰-Netty-è¿›é˜¶" class="headerlink" title="ä¸‰. Netty è¿›é˜¶"></a>ä¸‰. Netty è¿›é˜¶</h1><h2 id="1-ç²˜åŒ…ä¸åŠåŒ…"><a href="#1-ç²˜åŒ…ä¸åŠåŒ…" class="headerlink" title="1. ç²˜åŒ…ä¸åŠåŒ…"></a>1. ç²˜åŒ…ä¸åŠåŒ…</h2><h3 id="1-1-ç²˜åŒ…ç°è±¡"><a href="#1-1-ç²˜åŒ…ç°è±¡" class="headerlink" title="1.1 ç²˜åŒ…ç°è±¡"></a>1.1 ç²˜åŒ…ç°è±¡</h3><p>æœåŠ¡ç«¯ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloWorldServer</span> </span>&#123;<br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Logger log = LoggerFactory.getLogger(HelloWorldServer.class);<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">start</span><span class="hljs-params">()</span> </span>&#123;<br>        NioEventLoopGroup boss = <span class="hljs-keyword">new</span> NioEventLoopGroup(<span class="hljs-number">1</span>);<br>        NioEventLoopGroup worker = <span class="hljs-keyword">new</span> NioEventLoopGroup();<br>        <span class="hljs-keyword">try</span> &#123;<br>            ServerBootstrap serverBootstrap = <span class="hljs-keyword">new</span> ServerBootstrap();<br>            serverBootstrap.channel(NioServerSocketChannel.class);<br>            <span class="hljs-comment">// è°ƒæ•´ç³»ç»Ÿçš„æ¥å—ç¼“å†²åŒºï¼ˆæ»‘åŠ¨çª—å£ï¼‰ï¼Œä½†æ˜¯TCPåè®®è‡ªå·±æœ‰æ‹¥å¡æ§åˆ¶ç®—æ³•ï¼Œä¸ç”¨æ‰‹åŠ¨æŒ‡å®šæ»‘åŠ¨çª—å£çš„å¤§å°</span><br>            serverBootstrap.option(ChannelOption.SO_RCVBUF, <span class="hljs-number">10</span>);<br>            <span class="hljs-comment">// è°ƒæ•´ Netty çš„æ¥å—ç¼“å†²åŒºå¤§å°ï¼ˆByteBufï¼‰</span><br>            serverBootstrap.childOption(ChannelOption.RCVBUF_ALLOCATOR, <span class="hljs-keyword">new</span> AdaptiveRecvByteBufAllocator(<span class="hljs-number">16</span>, <span class="hljs-number">16</span>, <span class="hljs-number">16</span>));<br>            serverBootstrap.group(boss, worker);<br>            serverBootstrap.childHandler(<span class="hljs-keyword">new</span> ChannelInitializer&lt;SocketChannel&gt;() &#123;<br>                <span class="hljs-meta">@Override</span><br>                <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initChannel</span><span class="hljs-params">(SocketChannel ch)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>                    ch.pipeline().addLast(<span class="hljs-keyword">new</span> LoggingHandler(LogLevel.DEBUG));<br>                    ch.pipeline().addLast(<span class="hljs-keyword">new</span> ChannelInboundHandlerAdapter() &#123;<br>                        <span class="hljs-meta">@Override</span><br>                        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">channelActive</span><span class="hljs-params">(ChannelHandlerContext ctx)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>                            log.debug(<span class="hljs-string">&quot;connected &#123;&#125;&quot;</span>, ctx.channel());<br>                            <span class="hljs-keyword">super</span>.channelActive(ctx);<br>                        &#125;<br><br>                        <span class="hljs-meta">@Override</span><br>                        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">channelInactive</span><span class="hljs-params">(ChannelHandlerContext ctx)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>                            log.debug(<span class="hljs-string">&quot;disconnect &#123;&#125;&quot;</span>, ctx.channel());<br>                            <span class="hljs-keyword">super</span>.channelInactive(ctx);<br>                        &#125;<br>                    &#125;);<br>                &#125;<br>            &#125;);<br>            ChannelFuture channelFuture = serverBootstrap.bind(<span class="hljs-number">8080</span>);<br>            log.debug(<span class="hljs-string">&quot;&#123;&#125; binding...&quot;</span>, channelFuture.channel());<br>            channelFuture.sync();<br>            log.debug(<span class="hljs-string">&quot;&#123;&#125; bound...&quot;</span>, channelFuture.channel());<br>            channelFuture.channel().closeFuture().sync();<br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>            log.error(<span class="hljs-string">&quot;server error&quot;</span>, e);<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            boss.shutdownGracefully();<br>            worker.shutdownGracefully();<br>            log.debug(<span class="hljs-string">&quot;stoped&quot;</span>);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        <span class="hljs-keyword">new</span> HelloWorldServer().start();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯ä»£ç å¸Œæœ›å‘é€ 10 ä¸ªæ¶ˆæ¯ï¼Œæ¯ä¸ªæ¶ˆæ¯æ˜¯ 16 å­—èŠ‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloWorldClient</span> </span>&#123;<br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Logger log = LoggerFactory.getLogger(HelloWorldClient.class);<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        NioEventLoopGroup worker = <span class="hljs-keyword">new</span> NioEventLoopGroup();<br>        <span class="hljs-keyword">try</span> &#123;<br>            Bootstrap bootstrap = <span class="hljs-keyword">new</span> Bootstrap();<br>            bootstrap.channel(NioSocketChannel.class);<br>            bootstrap.group(worker);<br>            bootstrap.handler(<span class="hljs-keyword">new</span> ChannelInitializer&lt;SocketChannel&gt;() &#123;<br>                <span class="hljs-meta">@Override</span><br>                <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initChannel</span><span class="hljs-params">(SocketChannel ch)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>                    log.debug(<span class="hljs-string">&quot;connetted...&quot;</span>);<br>                    ch.pipeline().addLast(<span class="hljs-keyword">new</span> ChannelInboundHandlerAdapter() &#123;<br>                        <span class="hljs-comment">// ä¼šåœ¨è¿æ¥ channel å»ºç«‹æˆåŠŸåï¼Œä¼šè§¦å‘ active äº‹ä»¶</span><br>                        <span class="hljs-meta">@Override</span><br>                        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">channelActive</span><span class="hljs-params">(ChannelHandlerContext ctx)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>                            log.debug(<span class="hljs-string">&quot;sending...&quot;</span>);<br>                            Random r = <span class="hljs-keyword">new</span> Random();<br>                            <span class="hljs-keyword">char</span> c = <span class="hljs-string">&#x27;a&#x27;</span>;<br>                            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;<br>                                ByteBuf buffer = ctx.alloc().buffer();<br>                                buffer.writeBytes(<span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[]&#123;<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">10</span>, <span class="hljs-number">11</span>, <span class="hljs-number">12</span>, <span class="hljs-number">13</span>, <span class="hljs-number">14</span>, <span class="hljs-number">15</span>&#125;);<br>                                ctx.writeAndFlush(buffer);<br>                            &#125;<br>                        &#125;<br>                    &#125;);<br>                &#125;<br>            &#125;);<br>            ChannelFuture channelFuture = bootstrap.connect(<span class="hljs-string">&quot;127.0.0.1&quot;</span>, <span class="hljs-number">8080</span>).sync();<br>            channelFuture.channel().closeFuture().sync();<br><br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>            log.error(<span class="hljs-string">&quot;client error&quot;</span>, e);<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            worker.shutdownGracefully();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æœåŠ¡å™¨ç«¯çš„æŸæ¬¡è¾“å‡ºï¼Œå¯ä»¥çœ‹åˆ°ä¸€æ¬¡å°±æ¥æ”¶äº† 160 ä¸ªå­—èŠ‚ï¼Œè€Œéåˆ† 10 æ¬¡æ¥æ”¶</p><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs tap">08:24:46 [DEBUG] [main] c.i.n.HelloWorldServer - [id: 0x81e0fda5] binding...<br>08:24:46 [DEBUG] [main] c.i.n.HelloWorldServer - [id: 0x81e0fda5, L:/0:0:0:0:0:0:0:0:8080] bound...<br>08:24:55 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x94132411, L:/127.0.0.1:8080 - R:/127.0.0.1:58177] REGISTERED<br>08:24:55 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x94132411, L:/127.0.0.1:8080 - R:/127.0.0.1:58177] ACTIVE<br>08:24:55 [DEBUG] [nioEventLoopGroup-3-1] c.i.n.HelloWorldServer - connected [id: 0x94132411, L:/127.0.0.1:8080 - R:/127.0.0.1:58177]<br>08:24:55 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x94132411, L:/127.0.0.1:8080 - R:/127.0.0.1:58177] READ: 160B<br>         +-------------------------------------------------+<br>         | <span class="hljs-number"> 0 </span><span class="hljs-number"> 1 </span><span class="hljs-number"> 2 </span><span class="hljs-number"> 3 </span><span class="hljs-number"> 4 </span><span class="hljs-number"> 5 </span><span class="hljs-number"> 6 </span><span class="hljs-number"> 7 </span><span class="hljs-number"> 8 </span><span class="hljs-number"> 9 </span> a  b  c  d  e  f |<br>+--------+-------------------------------------------------+----------------+<br>|00000000|<span class="hljs-number"> 00 </span>01<span class="hljs-number"> 02 </span>03<span class="hljs-number"> 04 </span>05<span class="hljs-number"> 06 </span>07<span class="hljs-number"> 08 </span>09 0a 0b 0c 0d 0e 0f |................|<br>|00000010|<span class="hljs-number"> 00 </span>01<span class="hljs-number"> 02 </span>03<span class="hljs-number"> 04 </span>05<span class="hljs-number"> 06 </span>07<span class="hljs-number"> 08 </span>09 0a 0b 0c 0d 0e 0f |................|<br>|00000020|<span class="hljs-number"> 00 </span>01<span class="hljs-number"> 02 </span>03<span class="hljs-number"> 04 </span>05<span class="hljs-number"> 06 </span>07<span class="hljs-number"> 08 </span>09 0a 0b 0c 0d 0e 0f |................|<br>|00000030|<span class="hljs-number"> 00 </span>01<span class="hljs-number"> 02 </span>03<span class="hljs-number"> 04 </span>05<span class="hljs-number"> 06 </span>07<span class="hljs-number"> 08 </span>09 0a 0b 0c 0d 0e 0f |................|<br>|00000040|<span class="hljs-number"> 00 </span>01<span class="hljs-number"> 02 </span>03<span class="hljs-number"> 04 </span>05<span class="hljs-number"> 06 </span>07<span class="hljs-number"> 08 </span>09 0a 0b 0c 0d 0e 0f |................|<br>|00000050|<span class="hljs-number"> 00 </span>01<span class="hljs-number"> 02 </span>03<span class="hljs-number"> 04 </span>05<span class="hljs-number"> 06 </span>07<span class="hljs-number"> 08 </span>09 0a 0b 0c 0d 0e 0f |................|<br>|00000060|<span class="hljs-number"> 00 </span>01<span class="hljs-number"> 02 </span>03<span class="hljs-number"> 04 </span>05<span class="hljs-number"> 06 </span>07<span class="hljs-number"> 08 </span>09 0a 0b 0c 0d 0e 0f |................|<br>|00000070|<span class="hljs-number"> 00 </span>01<span class="hljs-number"> 02 </span>03<span class="hljs-number"> 04 </span>05<span class="hljs-number"> 06 </span>07<span class="hljs-number"> 08 </span>09 0a 0b 0c 0d 0e 0f |................|<br>|00000080|<span class="hljs-number"> 00 </span>01<span class="hljs-number"> 02 </span>03<span class="hljs-number"> 04 </span>05<span class="hljs-number"> 06 </span>07<span class="hljs-number"> 08 </span>09 0a 0b 0c 0d 0e 0f |................|<br>|00000090|<span class="hljs-number"> 00 </span>01<span class="hljs-number"> 02 </span>03<span class="hljs-number"> 04 </span>05<span class="hljs-number"> 06 </span>07<span class="hljs-number"> 08 </span>09 0a 0b 0c 0d 0e 0f |................|<br>+--------+-------------------------------------------------+----------------+<br>08:24:55 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x94132411, L:/127.0.0.1:8080 - R:/127.0.0.1:58177] READ COMPLETE<br></code></pre></td></tr></table></figure><h3 id="1-2-åŠåŒ…ç°è±¡"><a href="#1-2-åŠåŒ…ç°è±¡" class="headerlink" title="1.2 åŠåŒ…ç°è±¡"></a>1.2 åŠåŒ…ç°è±¡</h3><p>å®¢æˆ·ç«¯ä»£ç å¸Œæœ›å‘é€ 1 ä¸ªæ¶ˆæ¯ï¼Œè¿™ä¸ªæ¶ˆæ¯æ˜¯ 160 å­—èŠ‚ï¼Œä»£ç æ”¹ä¸º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">ByteBuf buffer = ctx.alloc().buffer();<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;<br>    buffer.writeBytes(<span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[]&#123;<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">10</span>, <span class="hljs-number">11</span>, <span class="hljs-number">12</span>, <span class="hljs-number">13</span>, <span class="hljs-number">14</span>, <span class="hljs-number">15</span>&#125;);<br>&#125;<br>ctx.writeAndFlush(buffer);<br></code></pre></td></tr></table></figure><p>ä¸ºç°è±¡æ˜æ˜¾ï¼ŒæœåŠ¡ç«¯ä¿®æ”¹ä¸€ä¸‹æ¥æ”¶ç¼“å†²åŒºï¼Œå…¶å®ƒä»£ç ä¸å˜</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">serverBootstrap.option(ChannelOption.SO_RCVBUF, <span class="hljs-number">10</span>);<br></code></pre></td></tr></table></figure><p>æœåŠ¡å™¨ç«¯çš„æŸæ¬¡è¾“å‡ºï¼Œå¯ä»¥çœ‹åˆ°æ¥æ”¶çš„æ¶ˆæ¯è¢«åˆ†ä¸ºä¸¤èŠ‚ï¼Œç¬¬ä¸€æ¬¡ 20 å­—èŠ‚ï¼Œç¬¬äºŒæ¬¡ 140 å­—èŠ‚</p><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs tap">08:43:49 [DEBUG] [main] c.i.n.HelloWorldServer - [id: 0x4d6c6a84] binding...<br>08:43:49 [DEBUG] [main] c.i.n.HelloWorldServer - [id: 0x4d6c6a84, L:/0:0:0:0:0:0:0:0:8080] bound...<br>08:44:23 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x1719abf7, L:/127.0.0.1:8080 - R:/127.0.0.1:59221] REGISTERED<br>08:44:23 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x1719abf7, L:/127.0.0.1:8080 - R:/127.0.0.1:59221] ACTIVE<br>08:44:23 [DEBUG] [nioEventLoopGroup-3-1] c.i.n.HelloWorldServer - connected [id: 0x1719abf7, L:/127.0.0.1:8080 - R:/127.0.0.1:59221]<br>08:44:24 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x1719abf7, L:/127.0.0.1:8080 - R:/127.0.0.1:59221] READ: 20B<br>         +-------------------------------------------------+<br>         | <span class="hljs-number"> 0 </span><span class="hljs-number"> 1 </span><span class="hljs-number"> 2 </span><span class="hljs-number"> 3 </span><span class="hljs-number"> 4 </span><span class="hljs-number"> 5 </span><span class="hljs-number"> 6 </span><span class="hljs-number"> 7 </span><span class="hljs-number"> 8 </span><span class="hljs-number"> 9 </span> a  b  c  d  e  f |<br>+--------+-------------------------------------------------+----------------+<br>|00000000|<span class="hljs-number"> 00 </span>01<span class="hljs-number"> 02 </span>03<span class="hljs-number"> 04 </span>05<span class="hljs-number"> 06 </span>07<span class="hljs-number"> 08 </span>09 0a 0b 0c 0d 0e 0f |................|<br>|00000010|<span class="hljs-number"> 00 </span>01<span class="hljs-number"> 02 </span>03                                     |....            |<br>+--------+-------------------------------------------------+----------------+<br>08:44:24 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x1719abf7, L:/127.0.0.1:8080 - R:/127.0.0.1:59221] READ COMPLETE<br>08:44:24 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x1719abf7, L:/127.0.0.1:8080 - R:/127.0.0.1:59221] READ: 140B<br>         +-------------------------------------------------+<br>         | <span class="hljs-number"> 0 </span><span class="hljs-number"> 1 </span><span class="hljs-number"> 2 </span><span class="hljs-number"> 3 </span><span class="hljs-number"> 4 </span><span class="hljs-number"> 5 </span><span class="hljs-number"> 6 </span><span class="hljs-number"> 7 </span><span class="hljs-number"> 8 </span><span class="hljs-number"> 9 </span> a  b  c  d  e  f |<br>+--------+-------------------------------------------------+----------------+<br>|00000000|<span class="hljs-number"> 04 </span>05<span class="hljs-number"> 06 </span>07<span class="hljs-number"> 08 </span>09 0a 0b 0c 0d 0e 0f<span class="hljs-number"> 00 </span>01<span class="hljs-number"> 02 </span>03 |................|<br>|00000010|<span class="hljs-number"> 04 </span>05<span class="hljs-number"> 06 </span>07<span class="hljs-number"> 08 </span>09 0a 0b 0c 0d 0e 0f<span class="hljs-number"> 00 </span>01<span class="hljs-number"> 02 </span>03 |................|<br>|00000020|<span class="hljs-number"> 04 </span>05<span class="hljs-number"> 06 </span>07<span class="hljs-number"> 08 </span>09 0a 0b 0c 0d 0e 0f<span class="hljs-number"> 00 </span>01<span class="hljs-number"> 02 </span>03 |................|<br>|00000030|<span class="hljs-number"> 04 </span>05<span class="hljs-number"> 06 </span>07<span class="hljs-number"> 08 </span>09 0a 0b 0c 0d 0e 0f<span class="hljs-number"> 00 </span>01<span class="hljs-number"> 02 </span>03 |................|<br>|00000040|<span class="hljs-number"> 04 </span>05<span class="hljs-number"> 06 </span>07<span class="hljs-number"> 08 </span>09 0a 0b 0c 0d 0e 0f<span class="hljs-number"> 00 </span>01<span class="hljs-number"> 02 </span>03 |................|<br>|00000050|<span class="hljs-number"> 04 </span>05<span class="hljs-number"> 06 </span>07<span class="hljs-number"> 08 </span>09 0a 0b 0c 0d 0e 0f<span class="hljs-number"> 00 </span>01<span class="hljs-number"> 02 </span>03 |................|<br>|00000060|<span class="hljs-number"> 04 </span>05<span class="hljs-number"> 06 </span>07<span class="hljs-number"> 08 </span>09 0a 0b 0c 0d 0e 0f<span class="hljs-number"> 00 </span>01<span class="hljs-number"> 02 </span>03 |................|<br>|00000070|<span class="hljs-number"> 04 </span>05<span class="hljs-number"> 06 </span>07<span class="hljs-number"> 08 </span>09 0a 0b 0c 0d 0e 0f<span class="hljs-number"> 00 </span>01<span class="hljs-number"> 02 </span>03 |................|<br>|00000080|<span class="hljs-number"> 04 </span>05<span class="hljs-number"> 06 </span>07<span class="hljs-number"> 08 </span>09 0a 0b 0c 0d 0e 0f             |............    |<br>+--------+-------------------------------------------------+----------------+<br>08:44:24 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x1719abf7, L:/127.0.0.1:8080 - R:/127.0.0.1:59221] READ COMPLETE<br></code></pre></td></tr></table></figure><blockquote><p><strong>æ³¨æ„</strong></p><p>serverBootstrap.option(ChannelOption.SO_RCVBUF, 10) å½±å“çš„åº•å±‚æ¥æ”¶ç¼“å†²åŒºï¼ˆå³æ»‘åŠ¨çª—å£ï¼‰å¤§å°ï¼Œä»…å†³å®šäº† netty è¯»å–çš„æœ€å°å•ä½ï¼Œnetty å®é™…æ¯æ¬¡è¯»å–çš„ä¸€èˆ¬æ˜¯å®ƒçš„æ•´æ•°å€</p></blockquote><h3 id="1-3-ç°è±¡åˆ†æ"><a href="#1-3-ç°è±¡åˆ†æ" class="headerlink" title="1.3 ç°è±¡åˆ†æ"></a>1.3 ç°è±¡åˆ†æ</h3><p>ç²˜åŒ…</p><ul><li>ç°è±¡ï¼Œå‘é€ abc defï¼Œæ¥æ”¶ abcdef</li><li>åŸå› <ul><li>åº”ç”¨å±‚ï¼šæ¥æ”¶æ–¹ ByteBuf è®¾ç½®å¤ªå¤§ï¼ˆNetty é»˜è®¤ 1024å­—èŠ‚ï¼‰</li><li>æ»‘åŠ¨çª—å£ï¼ˆ<strong>TCPåŸå› \æ¥æ”¶æ–¹åŸå› </strong>ï¼‰ï¼šå‡è®¾å‘é€æ–¹ 256 bytes è¡¨ç¤ºä¸€ä¸ªå®Œæ•´æŠ¥æ–‡ï¼Œä½†ç”±äºæ¥æ”¶æ–¹å¤„ç†ä¸åŠæ—¶ä¸”çª—å£å¤§å°è¶³å¤Ÿå¤§ï¼Œè¿™ 256 bytes å­—èŠ‚å°±ä¼šç¼“å†²åœ¨æ¥æ”¶æ–¹çš„æ»‘åŠ¨çª—å£ä¸­ï¼Œå½“æ»‘åŠ¨çª—å£ä¸­ç¼“å†²äº†å¤šä¸ªæŠ¥æ–‡å°±ä¼šç²˜åŒ…</li><li>Nagle ç®—æ³•ï¼ˆ<strong>TCPåŸå› \å‘é€æ–¹åŸå› </strong>ï¼‰ï¼šä¼šé€ æˆç²˜åŒ…</li></ul></li></ul><p>åŠåŒ…</p><ul><li>ç°è±¡ï¼Œå‘é€ abcdefï¼Œæ¥æ”¶ abc def</li><li>åŸå› <ul><li>åº”ç”¨å±‚ï¼šæ¥æ”¶æ–¹ ByteBuf å°äºå®é™…å‘é€æ•°æ®é‡</li><li>æ»‘åŠ¨çª—å£ï¼ˆ<strong>TCPåŸå› \æ¥æ”¶æ–¹åŸå› </strong>ï¼‰ï¼šå‡è®¾æ¥æ”¶æ–¹çš„çª—å£åªå‰©äº† 128 bytesï¼Œå‘é€æ–¹çš„æŠ¥æ–‡å¤§å°æ˜¯ 256 bytesï¼Œè¿™æ—¶æ”¾ä¸ä¸‹äº†ï¼Œåªèƒ½å…ˆå‘é€å‰ 128 bytesï¼Œç­‰å¾… ack åæ‰èƒ½å‘é€å‰©ä½™éƒ¨åˆ†ï¼Œè¿™å°±é€ æˆäº†åŠåŒ…</li><li>MSS é™åˆ¶ï¼ˆ<strong>æ•°æ®é“¾è·¯å±‚MTUåŸå› \å‘é€æ–¹åŸå› </strong>ï¼‰ï¼šå½“å‘é€çš„æ•°æ®è¶…è¿‡ MSS é™åˆ¶åï¼Œä¼šå°†æ•°æ®åˆ‡åˆ†å‘é€ï¼Œå°±ä¼šé€ æˆåŠåŒ…ã€‚MSSï¼ˆMaximum Segment Sizeï¼‰æ˜¯ä¼ è¾“å±‚åˆ†æ®µçš„å•ä½ï¼Œä¸€èˆ¬æ˜¯1460å­—èŠ‚ï¼Œæ˜¯æ ¹æ®æ•°æ®é“¾è·¯å±‚çš„MTUï¼šMaximum Transmission Unitï¼Œæœ€å¤§ä¼ è¾“å•å…ƒ  è®¡ç®—è€Œæ¥</li></ul></li></ul><p>æœ¬è´¨æ˜¯å› ä¸º TCP æ˜¯æµå¼åè®®ï¼Œæ¶ˆæ¯æ— è¾¹ç•Œ</p><blockquote><p>æ»‘åŠ¨çª—å£</p><ul><li><p>TCP ä»¥ä¸€ä¸ªæ®µï¼ˆsegmentï¼‰ä¸ºå•ä½ï¼Œæ¯å‘é€ä¸€ä¸ªæ®µå°±éœ€è¦è¿›è¡Œä¸€æ¬¡ç¡®è®¤åº”ç­”ï¼ˆackï¼‰å¤„ç†ï¼Œä½†å¦‚æœè¿™ä¹ˆåšï¼Œç¼ºç‚¹æ˜¯åŒ…çš„å¾€è¿”æ—¶é—´è¶Šé•¿æ€§èƒ½å°±è¶Šå·®</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20230503203949390.png"></p></li></ul><ul><li><p>ä¸ºäº†è§£å†³æ­¤é—®é¢˜ï¼Œå¼•å…¥äº†çª—å£æ¦‚å¿µï¼Œçª—å£å¤§å°å³å†³å®šäº†æ— éœ€ç­‰å¾…åº”ç­”è€Œå¯ä»¥ç»§ç»­å‘é€çš„æ•°æ®æœ€å¤§å€¼</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20230503204003160.png"></p></li><li><p>çª—å£å®é™…å°±èµ·åˆ°ä¸€ä¸ªç¼“å†²åŒºçš„ä½œç”¨ï¼ŒåŒæ—¶ä¹Ÿèƒ½èµ·åˆ°æµé‡æ§åˆ¶çš„ä½œç”¨</p><ul><li>å›¾ä¸­æ·±è‰²çš„éƒ¨åˆ†å³è¦å‘é€çš„æ•°æ®ï¼Œé«˜äº®çš„éƒ¨åˆ†å³çª—å£</li><li>çª—å£å†…çš„æ•°æ®æ‰å…è®¸è¢«å‘é€ï¼Œå½“åº”ç­”æœªåˆ°è¾¾å‰ï¼Œçª—å£å¿…é¡»åœæ­¢æ»‘åŠ¨</li><li>å¦‚æœ 1001~2000 è¿™ä¸ªæ®µçš„æ•°æ® ack å›æ¥äº†ï¼Œçª—å£å°±å¯ä»¥å‘å‰æ»‘åŠ¨</li><li>æ¥æ”¶æ–¹ä¹Ÿä¼šç»´æŠ¤ä¸€ä¸ªçª—å£ï¼Œåªæœ‰è½åœ¨çª—å£å†…çš„æ•°æ®æ‰èƒ½å…è®¸æ¥æ”¶</li><li>æ»‘åŠ¨çª—å£å¤§å°æ˜¯åœ¨TCPé€šä¿¡è¿‡ç¨‹ä¸­ï¼Œåè®®è‡ªåŠ¨è°ƒæ•´å¤§å°çš„</li></ul></li></ul></blockquote><blockquote><p> MSS é™åˆ¶</p><ul><li><p>é“¾è·¯å±‚å¯¹ä¸€æ¬¡èƒ½å¤Ÿå‘é€çš„æœ€å¤§æ•°æ®æœ‰é™åˆ¶ï¼Œè¿™ä¸ªé™åˆ¶ç§°ä¹‹ä¸º MTUï¼ˆmaximum transmission unitï¼‰ï¼Œä¸åŒçš„é“¾è·¯è®¾å¤‡çš„ MTU å€¼ä¹Ÿæœ‰æ‰€ä¸åŒï¼Œä¾‹å¦‚</p></li><li><p>ä»¥å¤ªç½‘çš„ MTU æ˜¯ 1500</p></li><li><p>FDDIï¼ˆå…‰çº¤åˆ†å¸ƒå¼æ•°æ®æ¥å£ï¼‰çš„ MTU æ˜¯ 4352</p></li><li><p>æœ¬åœ°å›ç¯åœ°å€çš„ MTU æ˜¯ 65535 - æœ¬åœ°æµ‹è¯•ä¸èµ°ç½‘å¡</p></li><li><p>MSS æ˜¯æœ€å¤§æ®µé•¿åº¦ï¼ˆmaximum segment sizeï¼‰ï¼Œå®ƒæ˜¯ MTU åˆ¨å» tcp å¤´å’Œ ip å¤´åå‰©ä½™èƒ½å¤Ÿä½œä¸ºæ•°æ®ä¼ è¾“çš„å­—èŠ‚æ•°</p></li><li><p>ipv4 tcp å¤´å ç”¨ 20 bytesï¼Œip å¤´å ç”¨ 20 bytesï¼Œå› æ­¤ä»¥å¤ªç½‘ MSS çš„å€¼ä¸º 1500 - 40 = 1460</p></li><li><p>TCP åœ¨ä¼ é€’å¤§é‡æ•°æ®æ—¶ï¼Œä¼šæŒ‰ç…§ MSS å¤§å°å°†æ•°æ®è¿›è¡Œåˆ†å‰²å‘é€</p></li><li><p>MSS çš„å€¼åœ¨ä¸‰æ¬¡æ¡æ‰‹æ—¶é€šçŸ¥å¯¹æ–¹è‡ªå·± MSS çš„å€¼ï¼Œç„¶ååœ¨ä¸¤è€…ä¹‹é—´é€‰æ‹©ä¸€ä¸ªå°å€¼ä½œä¸º MSS</p></li></ul><p>  <img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20230503204023132.png"></p></blockquote><blockquote><p>Nagle ç®—æ³•</p><ul><li>å³ä½¿å‘é€ä¸€ä¸ªå­—èŠ‚ï¼Œä¹Ÿéœ€è¦åŠ å…¥ tcp å¤´å’Œ ip å¤´ï¼Œä¹Ÿå°±æ˜¯æ€»å­—èŠ‚æ•°ä¼šä½¿ç”¨ 41 bytesï¼Œéå¸¸ä¸ç»æµã€‚å› æ­¤ä¸ºäº†æé«˜ç½‘ç»œåˆ©ç”¨ç‡ï¼Œtcp å¸Œæœ›å°½å¯èƒ½å‘é€è¶³å¤Ÿå¤§çš„æ•°æ®ï¼Œè¿™å°±æ˜¯ Nagle ç®—æ³•äº§ç”Ÿçš„ç¼˜ç”±</li><li>è¯¥ç®—æ³•æ˜¯æŒ‡å‘é€ç«¯å³ä½¿è¿˜æœ‰åº”è¯¥å‘é€çš„æ•°æ®ï¼Œä½†å¦‚æœè¿™éƒ¨åˆ†æ•°æ®å¾ˆå°‘çš„è¯ï¼Œåˆ™è¿›è¡Œå»¶è¿Ÿå‘é€<ul><li>å¦‚æœ SO_SNDBUF çš„æ•°æ®è¾¾åˆ° MSSï¼Œåˆ™éœ€è¦å‘é€</li><li>å¦‚æœ SO_SNDBUF ä¸­å«æœ‰ FINï¼ˆè¡¨ç¤ºéœ€è¦è¿æ¥å…³é—­ï¼‰è¿™æ—¶å°†å‰©ä½™æ•°æ®å‘é€ï¼Œå†å…³é—­</li><li>å¦‚æœ TCP_NODELAY = trueï¼Œåˆ™éœ€è¦å‘é€</li><li>å·²å‘é€çš„æ•°æ®éƒ½æ”¶åˆ° ack æ—¶ï¼Œåˆ™éœ€è¦å‘é€</li><li>ä¸Šè¿°æ¡ä»¶ä¸æ»¡è¶³ï¼Œä½†å‘ç”Ÿè¶…æ—¶ï¼ˆä¸€èˆ¬ä¸º 200msï¼‰åˆ™éœ€è¦å‘é€</li><li>é™¤ä¸Šè¿°æƒ…å†µï¼Œå»¶è¿Ÿå‘é€</li></ul></li></ul></blockquote><h3 id="1-4-è§£å†³æ–¹æ¡ˆ"><a href="#1-4-è§£å†³æ–¹æ¡ˆ" class="headerlink" title="1.4 è§£å†³æ–¹æ¡ˆ"></a>1.4 è§£å†³æ–¹æ¡ˆ</h3><ol><li>çŸ­é“¾æ¥ï¼Œå‘ä¸€ä¸ªåŒ…å»ºç«‹ä¸€æ¬¡è¿æ¥ï¼Œè¿™æ ·è¿æ¥å»ºç«‹åˆ°è¿æ¥æ–­å¼€ä¹‹é—´å°±æ˜¯æ¶ˆæ¯çš„è¾¹ç•Œï¼Œç¼ºç‚¹æ•ˆç‡å¤ªä½</li><li>æ¯ä¸€æ¡æ¶ˆæ¯é‡‡ç”¨å›ºå®šé•¿åº¦ï¼Œç¼ºç‚¹æµªè´¹ç©ºé—´</li><li>æ¯ä¸€æ¡æ¶ˆæ¯é‡‡ç”¨åˆ†éš”ç¬¦ï¼Œä¾‹å¦‚ \nï¼Œç¼ºç‚¹éœ€è¦è½¬ä¹‰</li><li>æ¯ä¸€æ¡æ¶ˆæ¯åˆ†ä¸º head å’Œ bodyï¼Œhead ä¸­åŒ…å« body çš„é•¿åº¦</li></ol><h4 id="æ–¹æ³•1ï¼ŒçŸ­é“¾æ¥"><a href="#æ–¹æ³•1ï¼ŒçŸ­é“¾æ¥" class="headerlink" title="æ–¹æ³•1ï¼ŒçŸ­é“¾æ¥"></a>æ–¹æ³•1ï¼ŒçŸ­é“¾æ¥</h4><p>ä»¥è§£å†³ç²˜åŒ…ä¸ºä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloWorldClient</span> </span>&#123;<br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Logger log = LoggerFactory.getLogger(HelloWorldClient.class);<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        <span class="hljs-comment">// åˆ† 10 æ¬¡å‘é€</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;<br>            send();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">send</span><span class="hljs-params">()</span> </span>&#123;<br>        NioEventLoopGroup worker = <span class="hljs-keyword">new</span> NioEventLoopGroup();<br>        <span class="hljs-keyword">try</span> &#123;<br>            Bootstrap bootstrap = <span class="hljs-keyword">new</span> Bootstrap();<br>            bootstrap.channel(NioSocketChannel.class);<br>            bootstrap.group(worker);<br>            bootstrap.handler(<span class="hljs-keyword">new</span> ChannelInitializer&lt;SocketChannel&gt;() &#123;<br>                <span class="hljs-meta">@Override</span><br>                <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initChannel</span><span class="hljs-params">(SocketChannel ch)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>                    log.debug(<span class="hljs-string">&quot;conneted...&quot;</span>);<br>                    ch.pipeline().addLast(<span class="hljs-keyword">new</span> LoggingHandler(LogLevel.DEBUG));<br>                    ch.pipeline().addLast(<span class="hljs-keyword">new</span> ChannelInboundHandlerAdapter() &#123;<br>                        <span class="hljs-meta">@Override</span><br>                        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">channelActive</span><span class="hljs-params">(ChannelHandlerContext ctx)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>                            log.debug(<span class="hljs-string">&quot;sending...&quot;</span>);<br>                            ByteBuf buffer = ctx.alloc().buffer();<br>                            buffer.writeBytes(<span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[]&#123;<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">10</span>, <span class="hljs-number">11</span>, <span class="hljs-number">12</span>, <span class="hljs-number">13</span>, <span class="hljs-number">14</span>, <span class="hljs-number">15</span>&#125;);<br>                            ctx.writeAndFlush(buffer);<br>                            <span class="hljs-comment">// å‘å®Œå³å…³</span><br>                            ctx.close();<br>                        &#125;<br>                    &#125;);<br>                &#125;<br>            &#125;);<br>            ChannelFuture channelFuture = bootstrap.connect(<span class="hljs-string">&quot;localhost&quot;</span>, <span class="hljs-number">8080</span>).sync();<br>            channelFuture.channel().closeFuture().sync();<br><br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>            log.error(<span class="hljs-string">&quot;client error&quot;</span>, e);<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            worker.shutdownGracefully();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¾“å‡ºï¼Œç•¥</p><blockquote><p>åŠåŒ…ç”¨è¿™ç§åŠæ³•è¿˜æ˜¯ä¸å¥½è§£å†³ï¼Œå› ä¸ºæ¥æ”¶æ–¹çš„ç¼“å†²åŒºå¤§å°æ˜¯æœ‰é™çš„</p></blockquote><h4 id="æ–¹æ³•2ï¼Œå›ºå®šé•¿åº¦"><a href="#æ–¹æ³•2ï¼Œå›ºå®šé•¿åº¦" class="headerlink" title="æ–¹æ³•2ï¼Œå›ºå®šé•¿åº¦"></a>æ–¹æ³•2ï¼Œå›ºå®šé•¿åº¦</h4><p>è®©æ‰€æœ‰æ•°æ®åŒ…é•¿åº¦å›ºå®šï¼ˆå‡è®¾é•¿åº¦ä¸º 8 å­—èŠ‚ï¼‰ï¼ŒæœåŠ¡å™¨ç«¯åŠ å…¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">ch.pipeline().addLast(<span class="hljs-keyword">new</span> FixedLengthFrameDecoder(<span class="hljs-number">8</span>));<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20230410211505218.png"></p><p>å®¢æˆ·ç«¯æµ‹è¯•ä»£ç ï¼Œæ³¨æ„, é‡‡ç”¨è¿™ç§æ–¹æ³•åï¼Œå®¢æˆ·ç«¯ä»€ä¹ˆæ—¶å€™ flush éƒ½å¯ä»¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloWorldClient</span> </span>&#123;<br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Logger log = LoggerFactory.getLogger(HelloWorldClient.class);<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        NioEventLoopGroup worker = <span class="hljs-keyword">new</span> NioEventLoopGroup();<br>        <span class="hljs-keyword">try</span> &#123;<br>            Bootstrap bootstrap = <span class="hljs-keyword">new</span> Bootstrap();<br>            bootstrap.channel(NioSocketChannel.class);<br>            bootstrap.group(worker);<br>            bootstrap.handler(<span class="hljs-keyword">new</span> ChannelInitializer&lt;SocketChannel&gt;() &#123;<br>                <span class="hljs-meta">@Override</span><br>                <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initChannel</span><span class="hljs-params">(SocketChannel ch)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>                    log.debug(<span class="hljs-string">&quot;connetted...&quot;</span>);<br>                    ch.pipeline().addLast(<span class="hljs-keyword">new</span> LoggingHandler(LogLevel.DEBUG));<br>                    ch.pipeline().addLast(<span class="hljs-keyword">new</span> ChannelInboundHandlerAdapter() &#123;<br>                        <span class="hljs-meta">@Override</span><br>                        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">channelActive</span><span class="hljs-params">(ChannelHandlerContext ctx)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>                            log.debug(<span class="hljs-string">&quot;sending...&quot;</span>);<br>                            <span class="hljs-comment">// å‘é€å†…å®¹éšæœºçš„æ•°æ®åŒ…</span><br>                            Random r = <span class="hljs-keyword">new</span> Random();<br>                            <span class="hljs-keyword">char</span> c = <span class="hljs-string">&#x27;a&#x27;</span>;<br>                            ByteBuf buffer = ctx.alloc().buffer();<br>                            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;<br>                                <span class="hljs-keyword">byte</span>[] bytes = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[<span class="hljs-number">8</span>];<br>                                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; r.nextInt(<span class="hljs-number">8</span>); j++) &#123;<br>                                    bytes[j] = (<span class="hljs-keyword">byte</span>) c;<br>                                &#125;<br>                                c++;<br>                                buffer.writeBytes(bytes);<br>                            &#125;<br>                            ctx.writeAndFlush(buffer);<br>                        &#125;<br>                    &#125;);<br>                &#125;<br>            &#125;);<br>            ChannelFuture channelFuture = bootstrap.connect(<span class="hljs-string">&quot;192.168.0.103&quot;</span>, <span class="hljs-number">9090</span>).sync();<br>            channelFuture.channel().closeFuture().sync();<br><br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>            log.error(<span class="hljs-string">&quot;client error&quot;</span>, e);<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            worker.shutdownGracefully();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯è¾“å‡º</p><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs tap">12:07:00 [DEBUG] [nioEventLoopGroup-2-1] c.i.n.HelloWorldClient - connetted...<br>12:07:00 [DEBUG] [nioEventLoopGroup-2-1] i.n.h.l.LoggingHandler - [id: 0x3c2ef3c2] REGISTERED<br>12:07:00 [DEBUG] [nioEventLoopGroup-2-1] i.n.h.l.LoggingHandler - [id: 0x3c2ef3c2] CONNECT: /192.168.0.103:9090<br>12:07:00 [DEBUG] [nioEventLoopGroup-2-1] i.n.h.l.LoggingHandler - [id: 0x3c2ef3c2, L:/192.168.0.103:53155 - R:/192.168.0.103:9090] ACTIVE<br>12:07:00 [DEBUG] [nioEventLoopGroup-2-1] c.i.n.HelloWorldClient - sending...<br>12:07:00 [DEBUG] [nioEventLoopGroup-2-1] i.n.h.l.LoggingHandler - [id: 0x3c2ef3c2, L:/192.168.0.103:53155 - R:/192.168.0.103:9090] WRITE: 80B<br>         +-------------------------------------------------+<br>         | <span class="hljs-number"> 0 </span><span class="hljs-number"> 1 </span><span class="hljs-number"> 2 </span><span class="hljs-number"> 3 </span><span class="hljs-number"> 4 </span><span class="hljs-number"> 5 </span><span class="hljs-number"> 6 </span><span class="hljs-number"> 7 </span><span class="hljs-number"> 8 </span><span class="hljs-number"> 9 </span> a  b  c  d  e  f |<br>+--------+-------------------------------------------------+----------------+<br>|00000000|<span class="hljs-number"> 61 </span>61<span class="hljs-number"> 61 </span>61<span class="hljs-number"> 00 </span>00<span class="hljs-number"> 00 </span>00<span class="hljs-number"> 62 </span>00<span class="hljs-number"> 00 </span>00<span class="hljs-number"> 00 </span>00<span class="hljs-number"> 00 </span>00 |aaaa....b.......|<br>|00000010|<span class="hljs-number"> 63 </span>63<span class="hljs-number"> 00 </span>00<span class="hljs-number"> 00 </span>00<span class="hljs-number"> 00 </span>00<span class="hljs-number"> 64 </span>00<span class="hljs-number"> 00 </span>00<span class="hljs-number"> 00 </span>00<span class="hljs-number"> 00 </span>00 |cc......d.......|<br>|00000020|<span class="hljs-number"> 00 </span>00<span class="hljs-number"> 00 </span>00<span class="hljs-number"> 00 </span>00<span class="hljs-number"> 00 </span>00<span class="hljs-number"> 66 </span>66<span class="hljs-number"> 66 </span>66<span class="hljs-number"> 00 </span>00<span class="hljs-number"> 00 </span>00 |........ffff....|<br>|00000030|<span class="hljs-number"> 67 </span>67<span class="hljs-number"> 67 </span>00<span class="hljs-number"> 00 </span>00<span class="hljs-number"> 00 </span>00<span class="hljs-number"> 68 </span>00<span class="hljs-number"> 00 </span>00<span class="hljs-number"> 00 </span>00<span class="hljs-number"> 00 </span>00 |ggg.....h.......|<br>|00000040|<span class="hljs-number"> 69 </span>69<span class="hljs-number"> 69 </span>69<span class="hljs-number"> 69 </span>00<span class="hljs-number"> 00 </span>00 6a 6a 6a 6a<span class="hljs-number"> 00 </span>00<span class="hljs-number"> 00 </span>00 |iiiii...jjjj....|<br>+--------+-------------------------------------------------+----------------+<br>12:07:00 [DEBUG] [nioEventLoopGroup-2-1] i.n.h.l.LoggingHandler - [id: 0x3c2ef3c2, L:/192.168.0.103:53155 - R:/192.168.0.103:9090] FLUSH<br></code></pre></td></tr></table></figure><p>æœåŠ¡ç«¯è¾“å‡º</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">12:06:51 [DEBUG] [main] c.i.n.HelloWorldServer - [id: 0xe3d9713f] binding...<br>12:06:51 [DEBUG] [main] c.i.n.HelloWorldServer - [id: 0xe3d9713f, L:/192.168.0.103:9090] bound...<br>12:07:00 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0xd739f137, L:/192.168.0.103:9090 - R:/192.168.0.103:53155] REGISTERED<br>12:07:00 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0xd739f137, L:/192.168.0.103:9090 - R:/192.168.0.103:53155] ACTIVE<br>12:07:00 [DEBUG] [nioEventLoopGroup-3-1] c.i.n.HelloWorldServer - connected [id: 0xd739f137, L:/192.168.0.103:9090 - R:/192.168.0.103:53155]<br>12:07:00 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0xd739f137, L:/192.168.0.103:9090 - R:/192.168.0.103:53155] READ: 8B<br><span class="hljs-code">         +-------------------------------------------------+</span><br><span class="hljs-section">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br><span class="hljs-section">|00000000| 61 61 61 61 00 00 00 00                         |aaaa....        |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br>12:07:00 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0xd739f137, L:/192.168.0.103:9090 - R:/192.168.0.103:53155] READ: 8B<br><span class="hljs-code">         +-------------------------------------------------+</span><br><span class="hljs-section">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br><span class="hljs-section">|00000000| 62 00 00 00 00 00 00 00                         |b.......        |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br>12:07:00 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0xd739f137, L:/192.168.0.103:9090 - R:/192.168.0.103:53155] READ: 8B<br><span class="hljs-code">         +-------------------------------------------------+</span><br><span class="hljs-section">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br><span class="hljs-section">|00000000| 63 63 00 00 00 00 00 00                         |cc......        |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br>12:07:00 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0xd739f137, L:/192.168.0.103:9090 - R:/192.168.0.103:53155] READ: 8B<br><span class="hljs-code">         +-------------------------------------------------+</span><br><span class="hljs-section">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br><span class="hljs-section">|00000000| 64 00 00 00 00 00 00 00                         |d.......        |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br>12:07:00 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0xd739f137, L:/192.168.0.103:9090 - R:/192.168.0.103:53155] READ: 8B<br><span class="hljs-code">         +-------------------------------------------------+</span><br><span class="hljs-section">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br><span class="hljs-section">|00000000| 00 00 00 00 00 00 00 00                         |........        |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br>12:07:00 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0xd739f137, L:/192.168.0.103:9090 - R:/192.168.0.103:53155] READ: 8B<br><span class="hljs-code">         +-------------------------------------------------+</span><br><span class="hljs-section">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br><span class="hljs-section">|00000000| 66 66 66 66 00 00 00 00                         |ffff....        |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br>12:07:00 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0xd739f137, L:/192.168.0.103:9090 - R:/192.168.0.103:53155] READ: 8B<br><span class="hljs-code">         +-------------------------------------------------+</span><br><span class="hljs-section">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br><span class="hljs-section">|00000000| 67 67 67 00 00 00 00 00                         |ggg.....        |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br>12:07:00 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0xd739f137, L:/192.168.0.103:9090 - R:/192.168.0.103:53155] READ: 8B<br><span class="hljs-code">         +-------------------------------------------------+</span><br><span class="hljs-section">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br><span class="hljs-section">|00000000| 68 00 00 00 00 00 00 00                         |h.......        |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br>12:07:00 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0xd739f137, L:/192.168.0.103:9090 - R:/192.168.0.103:53155] READ: 8B<br><span class="hljs-code">         +-------------------------------------------------+</span><br><span class="hljs-section">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br><span class="hljs-section">|00000000| 69 69 69 69 69 00 00 00                         |iiiii...        |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br>12:07:00 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0xd739f137, L:/192.168.0.103:9090 - R:/192.168.0.103:53155] READ: 8B<br><span class="hljs-code">         +-------------------------------------------------+</span><br><span class="hljs-section">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br><span class="hljs-section">|00000000| 6a 6a 6a 6a 00 00 00 00                         |jjjj....        |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br>12:07:00 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0xd739f137, L:/192.168.0.103:9090 - R:/192.168.0.103:53155] READ COMPLETE<br></code></pre></td></tr></table></figure><p>ç¼ºç‚¹æ˜¯ï¼Œæ•°æ®åŒ…çš„å¤§å°ä¸å¥½æŠŠæ¡</p><ul><li>é•¿åº¦å®šçš„å¤ªå¤§ï¼Œæµªè´¹</li><li>é•¿åº¦å®šçš„å¤ªå°ï¼Œå¯¹æŸäº›æ•°æ®åŒ…åˆæ˜¾å¾—ä¸å¤Ÿ</li></ul><h4 id="æ–¹æ³•3ï¼Œå›ºå®šåˆ†éš”ç¬¦"><a href="#æ–¹æ³•3ï¼Œå›ºå®šåˆ†éš”ç¬¦" class="headerlink" title="æ–¹æ³•3ï¼Œå›ºå®šåˆ†éš”ç¬¦"></a>æ–¹æ³•3ï¼Œå›ºå®šåˆ†éš”ç¬¦</h4><p>æœåŠ¡ç«¯åŠ å…¥ï¼Œé»˜è®¤ä»¥ \n æˆ– \r\n ä½œä¸ºåˆ†éš”ç¬¦ï¼Œå¦‚æœè¶…å‡ºæŒ‡å®šé•¿åº¦ä»æœªå‡ºç°åˆ†éš”ç¬¦ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">ch.pipeline().addLast(<span class="hljs-keyword">new</span> LineBasedFrameDecoder(<span class="hljs-number">1024</span>));<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20230410211631691.png"></p><p>æˆ–è€…æœåŠ¡ç«¯ä½¿ç”¨è‡ªå®šä¹‰åˆ†éš”ç¬¦Decoderæ¶ˆæ¯ã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20230410211832559.png"></p><p>å®¢æˆ·ç«¯åœ¨æ¯æ¡æ¶ˆæ¯ä¹‹åï¼ŒåŠ å…¥ \n åˆ†éš”ç¬¦</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloWorldClient</span> </span>&#123;<br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Logger log = LoggerFactory.getLogger(HelloWorldClient.class);<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        NioEventLoopGroup worker = <span class="hljs-keyword">new</span> NioEventLoopGroup();<br>        <span class="hljs-keyword">try</span> &#123;<br>            Bootstrap bootstrap = <span class="hljs-keyword">new</span> Bootstrap();<br>            bootstrap.channel(NioSocketChannel.class);<br>            bootstrap.group(worker);<br>            bootstrap.handler(<span class="hljs-keyword">new</span> ChannelInitializer&lt;SocketChannel&gt;() &#123;<br>                <span class="hljs-meta">@Override</span><br>                <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initChannel</span><span class="hljs-params">(SocketChannel ch)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>                    log.debug(<span class="hljs-string">&quot;connetted...&quot;</span>);<br>                    ch.pipeline().addLast(<span class="hljs-keyword">new</span> LoggingHandler(LogLevel.DEBUG));<br>                    ch.pipeline().addLast(<span class="hljs-keyword">new</span> ChannelInboundHandlerAdapter() &#123;<br>                        <span class="hljs-meta">@Override</span><br>                        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">channelActive</span><span class="hljs-params">(ChannelHandlerContext ctx)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>                            log.debug(<span class="hljs-string">&quot;sending...&quot;</span>);<br>                            Random r = <span class="hljs-keyword">new</span> Random();<br>                            <span class="hljs-keyword">char</span> c = <span class="hljs-string">&#x27;a&#x27;</span>;<br>                            ByteBuf buffer = ctx.alloc().buffer();<br>                            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;<br>                                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">1</span>; j &lt;= r.nextInt(<span class="hljs-number">16</span>)+<span class="hljs-number">1</span>; j++) &#123;<br>                                    buffer.writeByte((<span class="hljs-keyword">byte</span>) c);<br>                                &#125;<br>                                buffer.writeByte(<span class="hljs-number">10</span>);<br>                                c++;<br>                            &#125;<br>                            ctx.writeAndFlush(buffer);<br>                        &#125;<br>                    &#125;);<br>                &#125;<br>            &#125;);<br>            ChannelFuture channelFuture = bootstrap.connect(<span class="hljs-string">&quot;192.168.0.103&quot;</span>, <span class="hljs-number">9090</span>).sync();<br>            channelFuture.channel().closeFuture().sync();<br><br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>            log.error(<span class="hljs-string">&quot;client error&quot;</span>, e);<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            worker.shutdownGracefully();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯è¾“å‡º</p><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs tap">14:08:18 [DEBUG] [nioEventLoopGroup-2-1] c.i.n.HelloWorldClient - connetted...<br>14:08:18 [DEBUG] [nioEventLoopGroup-2-1] i.n.h.l.LoggingHandler - [id: 0x1282d755] REGISTERED<br>14:08:18 [DEBUG] [nioEventLoopGroup-2-1] i.n.h.l.LoggingHandler - [id: 0x1282d755] CONNECT: /192.168.0.103:9090<br>14:08:18 [DEBUG] [nioEventLoopGroup-2-1] i.n.h.l.LoggingHandler - [id: 0x1282d755, L:/192.168.0.103:63641 - R:/192.168.0.103:9090] ACTIVE<br>14:08:18 [DEBUG] [nioEventLoopGroup-2-1] c.i.n.HelloWorldClient - sending...<br>14:08:18 [DEBUG] [nioEventLoopGroup-2-1] i.n.h.l.LoggingHandler - [id: 0x1282d755, L:/192.168.0.103:63641 - R:/192.168.0.103:9090] WRITE: 60B<br>         +-------------------------------------------------+<br>         | <span class="hljs-number"> 0 </span><span class="hljs-number"> 1 </span><span class="hljs-number"> 2 </span><span class="hljs-number"> 3 </span><span class="hljs-number"> 4 </span><span class="hljs-number"> 5 </span><span class="hljs-number"> 6 </span><span class="hljs-number"> 7 </span><span class="hljs-number"> 8 </span><span class="hljs-number"> 9 </span> a  b  c  d  e  f |<br>+--------+-------------------------------------------------+----------------+<br>|00000000|<span class="hljs-number"> 61 </span>0a<span class="hljs-number"> 62 </span>62<span class="hljs-number"> 62 </span>0a<span class="hljs-number"> 63 </span>63<span class="hljs-number"> 63 </span>0a<span class="hljs-number"> 64 </span>64 0a<span class="hljs-number"> 65 </span>65<span class="hljs-number"> 65 </span>|a.bbb.ccc.dd.eee|<br>|00000010|<span class="hljs-number"> 65 </span>65<span class="hljs-number"> 65 </span>65<span class="hljs-number"> 65 </span>65<span class="hljs-number"> 65 </span>0a<span class="hljs-number"> 66 </span>66 0a<span class="hljs-number"> 67 </span>67<span class="hljs-number"> 67 </span>67<span class="hljs-number"> 67 </span>|eeeeeee.ff.ggggg|<br>|00000020|<span class="hljs-number"> 67 </span>67 0a<span class="hljs-number"> 68 </span>68<span class="hljs-number"> 68 </span>68 0a<span class="hljs-number"> 69 </span>69<span class="hljs-number"> 69 </span>69<span class="hljs-number"> 69 </span>69<span class="hljs-number"> 69 </span>0a |gg.hhhh.iiiiiii.|<br>|00000030| 6a 6a 6a 6a 6a 6a 6a 6a 6a 6a 6a 0a             |jjjjjjjjjjj.    |<br>+--------+-------------------------------------------------+----------------+<br>14:08:18 [DEBUG] [nioEventLoopGroup-2-1] i.n.h.l.LoggingHandler - [id: 0x1282d755, L:/192.168.0.103:63641 - R:/192.168.0.103:9090] FLUSH<br></code></pre></td></tr></table></figure><p>æœåŠ¡ç«¯è¾“å‡º</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">14:08:18 [DEBUG] [nioEventLoopGroup-3-5] c.i.n.HelloWorldServer - connected [id: 0xa4b3be43, L:/192.168.0.103:9090 - R:/192.168.0.103:63641]<br>14:08:18 [DEBUG] [nioEventLoopGroup-3-5] i.n.h.l.LoggingHandler - [id: 0xa4b3be43, L:/192.168.0.103:9090 - R:/192.168.0.103:63641] READ: 1B<br><span class="hljs-code">         +-------------------------------------------------+</span><br><span class="hljs-section">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br><span class="hljs-section">|00000000| 61                                              |a               |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br>14:08:18 [DEBUG] [nioEventLoopGroup-3-5] i.n.h.l.LoggingHandler - [id: 0xa4b3be43, L:/192.168.0.103:9090 - R:/192.168.0.103:63641] READ: 3B<br><span class="hljs-code">         +-------------------------------------------------+</span><br><span class="hljs-section">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br><span class="hljs-section">|00000000| 62 62 62                                        |bbb             |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br>14:08:18 [DEBUG] [nioEventLoopGroup-3-5] i.n.h.l.LoggingHandler - [id: 0xa4b3be43, L:/192.168.0.103:9090 - R:/192.168.0.103:63641] READ: 3B<br><span class="hljs-code">         +-------------------------------------------------+</span><br><span class="hljs-section">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br><span class="hljs-section">|00000000| 63 63 63                                        |ccc             |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br>14:08:18 [DEBUG] [nioEventLoopGroup-3-5] i.n.h.l.LoggingHandler - [id: 0xa4b3be43, L:/192.168.0.103:9090 - R:/192.168.0.103:63641] READ: 2B<br><span class="hljs-code">         +-------------------------------------------------+</span><br><span class="hljs-section">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br><span class="hljs-section">|00000000| 64 64                                           |dd              |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br>14:08:18 [DEBUG] [nioEventLoopGroup-3-5] i.n.h.l.LoggingHandler - [id: 0xa4b3be43, L:/192.168.0.103:9090 - R:/192.168.0.103:63641] READ: 10B<br><span class="hljs-code">         +-------------------------------------------------+</span><br><span class="hljs-section">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br><span class="hljs-section">|00000000| 65 65 65 65 65 65 65 65 65 65                   |eeeeeeeeee      |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br>14:08:18 [DEBUG] [nioEventLoopGroup-3-5] i.n.h.l.LoggingHandler - [id: 0xa4b3be43, L:/192.168.0.103:9090 - R:/192.168.0.103:63641] READ: 2B<br><span class="hljs-code">         +-------------------------------------------------+</span><br><span class="hljs-section">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br><span class="hljs-section">|00000000| 66 66                                           |ff              |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br>14:08:18 [DEBUG] [nioEventLoopGroup-3-5] i.n.h.l.LoggingHandler - [id: 0xa4b3be43, L:/192.168.0.103:9090 - R:/192.168.0.103:63641] READ: 7B<br><span class="hljs-code">         +-------------------------------------------------+</span><br><span class="hljs-section">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br><span class="hljs-section">|00000000| 67 67 67 67 67 67 67                            |ggggggg         |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br>14:08:18 [DEBUG] [nioEventLoopGroup-3-5] i.n.h.l.LoggingHandler - [id: 0xa4b3be43, L:/192.168.0.103:9090 - R:/192.168.0.103:63641] READ: 4B<br><span class="hljs-code">         +-------------------------------------------------+</span><br><span class="hljs-section">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br><span class="hljs-section">|00000000| 68 68 68 68                                     |hhhh            |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br>14:08:18 [DEBUG] [nioEventLoopGroup-3-5] i.n.h.l.LoggingHandler - [id: 0xa4b3be43, L:/192.168.0.103:9090 - R:/192.168.0.103:63641] READ: 7B<br><span class="hljs-code">         +-------------------------------------------------+</span><br><span class="hljs-section">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br><span class="hljs-section">|00000000| 69 69 69 69 69 69 69                            |iiiiiii         |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br>14:08:18 [DEBUG] [nioEventLoopGroup-3-5] i.n.h.l.LoggingHandler - [id: 0xa4b3be43, L:/192.168.0.103:9090 - R:/192.168.0.103:63641] READ: 11B<br><span class="hljs-code">         +-------------------------------------------------+</span><br><span class="hljs-section">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br><span class="hljs-section">|00000000| 6a 6a 6a 6a 6a 6a 6a 6a 6a 6a 6a                |jjjjjjjjjjj     |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br>14:08:18 [DEBUG] [nioEventLoopGroup-3-5] i.n.h.l.LoggingHandler - [id: 0xa4b3be43, L:/192.168.0.103:9090 - R:/192.168.0.103:63641] READ COMPLETE<br></code></pre></td></tr></table></figure><p>ç¼ºç‚¹ï¼Œå¤„ç†å­—ç¬¦æ•°æ®æ¯”è¾ƒåˆé€‚ï¼Œä½†å¦‚æœå†…å®¹æœ¬èº«åŒ…å«äº†åˆ†éš”ç¬¦ï¼ˆå­—èŠ‚æ•°æ®å¸¸å¸¸ä¼šæœ‰æ­¤æƒ…å†µï¼‰ï¼Œé‚£ä¹ˆå°±ä¼šè§£æé”™è¯¯</p><h4 id="æ–¹æ³•4ï¼Œé¢„è®¾é•¿åº¦"><a href="#æ–¹æ³•4ï¼Œé¢„è®¾é•¿åº¦" class="headerlink" title="æ–¹æ³•4ï¼Œé¢„è®¾é•¿åº¦"></a>æ–¹æ³•4ï¼Œé¢„è®¾é•¿åº¦</h4><h5 id="å¸§è§£ç å™¨LengthFieldBasedFrameDecoder"><a href="#å¸§è§£ç å™¨LengthFieldBasedFrameDecoder" class="headerlink" title="å¸§è§£ç å™¨LengthFieldBasedFrameDecoder"></a>å¸§è§£ç å™¨<code>LengthFieldBasedFrameDecoder</code></h5><p>åœ¨å‘é€æ¶ˆæ¯å‰ï¼Œå…ˆçº¦å®šç”¨å®šé•¿å­—èŠ‚è¡¨ç¤ºæ¥ä¸‹æ¥æ•°æ®çš„é•¿åº¦</p><p>ä½¿ç”¨<code>Netty</code>é‡Œçš„**å¸§è§£ç å™¨<code>LengthFieldBasedFrameDecoder</code>**æ¥å¤„ç†é»åŒ…åŠåŒ…é—®é¢˜ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// æœ€å¤§é•¿åº¦ï¼Œé•¿åº¦å­—æ®µåç§»ï¼Œé•¿åº¦å­—æ®µå ç”¨å­—èŠ‚ï¼Œé•¿åº¦å­—æ®µä¸ºåŸºå‡†è¿˜æœ‰å‡ ä¸ªå­—èŠ‚ä¹‹åæ˜¯å†…å®¹å­—èŠ‚ï¼Œä»å¤´å‰¥ç¦»å­—èŠ‚æ•°</span><br><span class="hljs-comment">// maxFrameLength, lengthFieldOffset, lengthFieldLength, lengthAdjustment, initialBytesToStrip</span><br>ch.pipeline().addLast(<span class="hljs-keyword">new</span> LengthFieldBasedFrameDecoder(<span class="hljs-number">1024</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>));<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20230410220029654.png"></p><p>å®¢æˆ·ç«¯ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloWorldClient</span> </span>&#123;<br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Logger log = LoggerFactory.getLogger(HelloWorldClient.class);<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        NioEventLoopGroup worker = <span class="hljs-keyword">new</span> NioEventLoopGroup();<br>        <span class="hljs-keyword">try</span> &#123;<br>            Bootstrap bootstrap = <span class="hljs-keyword">new</span> Bootstrap();<br>            bootstrap.channel(NioSocketChannel.class);<br>            bootstrap.group(worker);<br>            bootstrap.handler(<span class="hljs-keyword">new</span> ChannelInitializer&lt;SocketChannel&gt;() &#123;<br>                <span class="hljs-meta">@Override</span><br>                <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initChannel</span><span class="hljs-params">(SocketChannel ch)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>                    log.debug(<span class="hljs-string">&quot;connetted...&quot;</span>);<br>                    ch.pipeline().addLast(<span class="hljs-keyword">new</span> LoggingHandler(LogLevel.DEBUG));<br>                    ch.pipeline().addLast(<span class="hljs-keyword">new</span> ChannelInboundHandlerAdapter() &#123;<br>                        <span class="hljs-meta">@Override</span><br>                        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">channelActive</span><span class="hljs-params">(ChannelHandlerContext ctx)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>                            log.debug(<span class="hljs-string">&quot;sending...&quot;</span>);<br>                            Random r = <span class="hljs-keyword">new</span> Random();<br>                            <span class="hljs-keyword">char</span> c = <span class="hljs-string">&#x27;a&#x27;</span>;<br>                            ByteBuf buffer = ctx.alloc().buffer();<br>                            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;<br>                                <span class="hljs-keyword">byte</span> length = (<span class="hljs-keyword">byte</span>) (r.nextInt(<span class="hljs-number">16</span>) + <span class="hljs-number">1</span>);<br>                                <span class="hljs-comment">// å…ˆå†™å…¥é•¿åº¦</span><br>                                buffer.writeByte(length);<br>                                <span class="hljs-comment">// å†</span><br>                                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">1</span>; j &lt;= length; j++) &#123;<br>                                    buffer.writeByte((<span class="hljs-keyword">byte</span>) c);<br>                                &#125;<br>                                c++;<br>                            &#125;<br>                            ctx.writeAndFlush(buffer);<br>                        &#125;<br>                    &#125;);<br>                &#125;<br>            &#125;);<br>            ChannelFuture channelFuture = bootstrap.connect(<span class="hljs-string">&quot;192.168.0.103&quot;</span>, <span class="hljs-number">9090</span>).sync();<br>            channelFuture.channel().closeFuture().sync();<br><br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>            log.error(<span class="hljs-string">&quot;client error&quot;</span>, e);<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            worker.shutdownGracefully();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯è¾“å‡º</p><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs tap">14:37:10 [DEBUG] [nioEventLoopGroup-2-1] c.i.n.HelloWorldClient - connetted...<br>14:37:10 [DEBUG] [nioEventLoopGroup-2-1] i.n.h.l.LoggingHandler - [id: 0xf0f347b8] REGISTERED<br>14:37:10 [DEBUG] [nioEventLoopGroup-2-1] i.n.h.l.LoggingHandler - [id: 0xf0f347b8] CONNECT: /192.168.0.103:9090<br>14:37:10 [DEBUG] [nioEventLoopGroup-2-1] i.n.h.l.LoggingHandler - [id: 0xf0f347b8, L:/192.168.0.103:49979 - R:/192.168.0.103:9090] ACTIVE<br>14:37:10 [DEBUG] [nioEventLoopGroup-2-1] c.i.n.HelloWorldClient - sending...<br>14:37:10 [DEBUG] [nioEventLoopGroup-2-1] i.n.h.l.LoggingHandler - [id: 0xf0f347b8, L:/192.168.0.103:49979 - R:/192.168.0.103:9090] WRITE: 97B<br>         +-------------------------------------------------+<br>         | <span class="hljs-number"> 0 </span><span class="hljs-number"> 1 </span><span class="hljs-number"> 2 </span><span class="hljs-number"> 3 </span><span class="hljs-number"> 4 </span><span class="hljs-number"> 5 </span><span class="hljs-number"> 6 </span><span class="hljs-number"> 7 </span><span class="hljs-number"> 8 </span><span class="hljs-number"> 9 </span> a  b  c  d  e  f |<br>+--------+-------------------------------------------------+----------------+<br>|00000000|<span class="hljs-number"> 09 </span>61<span class="hljs-number"> 61 </span>61<span class="hljs-number"> 61 </span>61<span class="hljs-number"> 61 </span>61<span class="hljs-number"> 61 </span>61<span class="hljs-number"> 09 </span>62<span class="hljs-number"> 62 </span>62<span class="hljs-number"> 62 </span>62 |.aaaaaaaaa.bbbbb|<br>|00000010|<span class="hljs-number"> 62 </span>62<span class="hljs-number"> 62 </span>62<span class="hljs-number"> 06 </span>63<span class="hljs-number"> 63 </span>63<span class="hljs-number"> 63 </span>63<span class="hljs-number"> 63 </span>08<span class="hljs-number"> 64 </span>64<span class="hljs-number"> 64 </span>64 |bbbb.cccccc.dddd|<br>|00000020|<span class="hljs-number"> 64 </span>64<span class="hljs-number"> 64 </span>64 0f<span class="hljs-number"> 65 </span>65<span class="hljs-number"> 65 </span>65<span class="hljs-number"> 65 </span>65<span class="hljs-number"> 65 </span>65<span class="hljs-number"> 65 </span>65<span class="hljs-number"> 65 </span>|dddd.eeeeeeeeeee|<br>|00000030|<span class="hljs-number"> 65 </span>65<span class="hljs-number"> 65 </span>65 0d<span class="hljs-number"> 66 </span>66<span class="hljs-number"> 66 </span>66<span class="hljs-number"> 66 </span>66<span class="hljs-number"> 66 </span>66<span class="hljs-number"> 66 </span>66<span class="hljs-number"> 66 </span>|eeee.fffffffffff|<br>|00000040|<span class="hljs-number"> 66 </span>66<span class="hljs-number"> 02 </span>67<span class="hljs-number"> 67 </span>02<span class="hljs-number"> 68 </span>68 0e<span class="hljs-number"> 69 </span>69<span class="hljs-number"> 69 </span>69<span class="hljs-number"> 69 </span>69<span class="hljs-number"> 69 </span>|ff.gg.hh.iiiiiii|<br>|00000050|<span class="hljs-number"> 69 </span>69<span class="hljs-number"> 69 </span>69<span class="hljs-number"> 69 </span>69<span class="hljs-number"> 69 </span>09 6a 6a 6a 6a 6a 6a 6a 6a |iiiiiii.jjjjjjjj|<br>|00000060| 6a                                              |j               |<br>+--------+-------------------------------------------------+----------------+<br>14:37:10 [DEBUG] [nioEventLoopGroup-2-1] i.n.h.l.LoggingHandler - [id: 0xf0f347b8, L:/192.168.0.103:49979 - R:/192.168.0.103:9090] FLUSH<br></code></pre></td></tr></table></figure><p>æœåŠ¡ç«¯è¾“å‡º</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">14:36:50 [DEBUG] [main] c.i.n.HelloWorldServer - [id: 0xdff439d3] binding...<br>14:36:51 [DEBUG] [main] c.i.n.HelloWorldServer - [id: 0xdff439d3, L:/192.168.0.103:9090] bound...<br>14:37:10 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x744f2b47, L:/192.168.0.103:9090 - R:/192.168.0.103:49979] REGISTERED<br>14:37:10 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x744f2b47, L:/192.168.0.103:9090 - R:/192.168.0.103:49979] ACTIVE<br>14:37:10 [DEBUG] [nioEventLoopGroup-3-1] c.i.n.HelloWorldServer - connected [id: 0x744f2b47, L:/192.168.0.103:9090 - R:/192.168.0.103:49979]<br>14:37:10 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x744f2b47, L:/192.168.0.103:9090 - R:/192.168.0.103:49979] READ: 9B<br><span class="hljs-code">         +-------------------------------------------------+</span><br><span class="hljs-section">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br><span class="hljs-section">|00000000| 61 61 61 61 61 61 61 61 61                      |aaaaaaaaa       |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br>14:37:10 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x744f2b47, L:/192.168.0.103:9090 - R:/192.168.0.103:49979] READ: 9B<br><span class="hljs-code">         +-------------------------------------------------+</span><br><span class="hljs-section">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br><span class="hljs-section">|00000000| 62 62 62 62 62 62 62 62 62                      |bbbbbbbbb       |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br>14:37:10 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x744f2b47, L:/192.168.0.103:9090 - R:/192.168.0.103:49979] READ: 6B<br><span class="hljs-code">         +-------------------------------------------------+</span><br><span class="hljs-section">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br><span class="hljs-section">|00000000| 63 63 63 63 63 63                               |cccccc          |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br>14:37:10 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x744f2b47, L:/192.168.0.103:9090 - R:/192.168.0.103:49979] READ: 8B<br><span class="hljs-code">         +-------------------------------------------------+</span><br><span class="hljs-section">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br><span class="hljs-section">|00000000| 64 64 64 64 64 64 64 64                         |dddddddd        |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br>14:37:10 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x744f2b47, L:/192.168.0.103:9090 - R:/192.168.0.103:49979] READ: 15B<br><span class="hljs-code">         +-------------------------------------------------+</span><br><span class="hljs-section">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br><span class="hljs-section">|00000000| 65 65 65 65 65 65 65 65 65 65 65 65 65 65 65    |eeeeeeeeeeeeeee |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br>14:37:10 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x744f2b47, L:/192.168.0.103:9090 - R:/192.168.0.103:49979] READ: 13B<br><span class="hljs-code">         +-------------------------------------------------+</span><br><span class="hljs-section">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br><span class="hljs-section">|00000000| 66 66 66 66 66 66 66 66 66 66 66 66 66          |fffffffffffff   |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br>14:37:10 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x744f2b47, L:/192.168.0.103:9090 - R:/192.168.0.103:49979] READ: 2B<br><span class="hljs-code">         +-------------------------------------------------+</span><br><span class="hljs-section">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br><span class="hljs-section">|00000000| 67 67                                           |gg              |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br>14:37:10 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x744f2b47, L:/192.168.0.103:9090 - R:/192.168.0.103:49979] READ: 2B<br><span class="hljs-code">         +-------------------------------------------------+</span><br><span class="hljs-section">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br><span class="hljs-section">|00000000| 68 68                                           |hh              |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br>14:37:10 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x744f2b47, L:/192.168.0.103:9090 - R:/192.168.0.103:49979] READ: 14B<br><span class="hljs-code">         +-------------------------------------------------+</span><br><span class="hljs-section">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br><span class="hljs-section">|00000000| 69 69 69 69 69 69 69 69 69 69 69 69 69 69       |iiiiiiiiiiiiii  |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br>14:37:10 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x744f2b47, L:/192.168.0.103:9090 - R:/192.168.0.103:49979] READ: 9B<br><span class="hljs-code">         +-------------------------------------------------+</span><br><span class="hljs-section">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br><span class="hljs-section">|00000000| 6a 6a 6a 6a 6a 6a 6a 6a 6a                      |jjjjjjjjj       |</span><br><span class="hljs-section">+--------+-------------------------------------------------+----------------+</span><br>14:37:10 [DEBUG] [nioEventLoopGroup-3-1] i.n.h.l.LoggingHandler - [id: 0x744f2b47, L:/192.168.0.103:9090 - R:/192.168.0.103:49979] READ COMPLETE<br><br></code></pre></td></tr></table></figure><h2 id="2-åè®®è®¾è®¡ä¸è§£æ"><a href="#2-åè®®è®¾è®¡ä¸è§£æ" class="headerlink" title="2. åè®®è®¾è®¡ä¸è§£æ"></a>2. åè®®è®¾è®¡ä¸è§£æ</h2><h3 id="2-1-ä¸ºä»€ä¹ˆéœ€è¦åè®®ï¼Ÿ"><a href="#2-1-ä¸ºä»€ä¹ˆéœ€è¦åè®®ï¼Ÿ" class="headerlink" title="2.1 ä¸ºä»€ä¹ˆéœ€è¦åè®®ï¼Ÿ"></a>2.1 ä¸ºä»€ä¹ˆéœ€è¦åè®®ï¼Ÿ</h3><p>TCP/IP ä¸­æ¶ˆæ¯ä¼ è¾“åŸºäºæµçš„æ–¹å¼ï¼Œæ²¡æœ‰è¾¹ç•Œã€‚</p><p>åè®®çš„ç›®çš„å°±æ˜¯åˆ’å®šæ¶ˆæ¯çš„è¾¹ç•Œï¼Œåˆ¶å®šé€šä¿¡åŒæ–¹è¦å…±åŒéµå®ˆçš„é€šä¿¡è§„åˆ™</p><p>ä¾‹å¦‚ï¼šåœ¨ç½‘ç»œä¸Šä¼ è¾“</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">ä¸‹é›¨å¤©ç•™å®¢å¤©ç•™æˆ‘ä¸ç•™<br></code></pre></td></tr></table></figure><p>æ˜¯ä¸­æ–‡ä¸€å¥è‘—åçš„æ— æ ‡ç‚¹ç¬¦å·å¥å­ï¼Œåœ¨æ²¡æœ‰æ ‡ç‚¹ç¬¦å·æƒ…å†µä¸‹ï¼Œè¿™å¥è¯æœ‰æ•°ç§æ‹†è§£æ–¹å¼ï¼Œè€Œæ„æ€å´æ˜¯å®Œå…¨ä¸åŒï¼Œæ‰€ä»¥å¸¸è¢«ç”¨ä½œè®²è¿°æ ‡ç‚¹ç¬¦å·çš„é‡è¦æ€§</p><p>ä¸€ç§è§£è¯»</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">ä¸‹é›¨å¤©ç•™å®¢ï¼Œå¤©ç•™ï¼Œæˆ‘ä¸ç•™<br></code></pre></td></tr></table></figure><p>å¦ä¸€ç§è§£è¯»</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">ä¸‹é›¨å¤©ï¼Œç•™å®¢å¤©ï¼Œç•™æˆ‘ä¸ï¼Ÿç•™<br></code></pre></td></tr></table></figure><p>å¦‚ä½•è®¾è®¡åè®®å‘¢ï¼Ÿå…¶å®å°±æ˜¯ç»™ç½‘ç»œä¼ è¾“çš„ä¿¡æ¯åŠ ä¸Šâ€œæ ‡ç‚¹ç¬¦å·â€ã€‚ä½†é€šè¿‡åˆ†éš”ç¬¦æ¥æ–­å¥ä¸æ˜¯å¾ˆå¥½ï¼Œå› ä¸ºåˆ†éš”ç¬¦æœ¬èº«å¦‚æœç”¨äºä¼ è¾“ï¼Œé‚£ä¹ˆå¿…é¡»åŠ ä»¥åŒºåˆ†ã€‚å› æ­¤ï¼Œä¸‹é¢ä¸€ç§åè®®è¾ƒä¸ºå¸¸ç”¨</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">å®šé•¿å­—èŠ‚è¡¨ç¤ºå†…å®¹é•¿åº¦ + å®é™…å†…å®¹<br></code></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼Œå‡è®¾ä¸€ä¸ªä¸­æ–‡å­—ç¬¦é•¿åº¦ä¸º 3ï¼ŒæŒ‰ç…§ä¸Šè¿°åè®®çš„è§„åˆ™ï¼Œå‘é€ä¿¡æ¯æ–¹å¼å¦‚ä¸‹ï¼Œå°±ä¸ä¼šè¢«æ¥æ”¶æ–¹å¼„é”™æ„æ€äº†</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">0f</span>ä¸‹é›¨å¤©ç•™å®¢<span class="hljs-number">06</span>å¤©ç•™<span class="hljs-number">09</span>æˆ‘ä¸ç•™<br></code></pre></td></tr></table></figure><blockquote><p>å°æ•…äº‹</p><p>å¾ˆä¹…å¾ˆä¹…ä»¥å‰ï¼Œä¸€ä½ç§å¡¾å…ˆç”Ÿåˆ°ä¸€å®¶ä»»æ•™ã€‚åŒæ–¹ç­¾è®¢äº†ä¸€çº¸åè®®ï¼šâ€œæ— é¸¡é¸­äº¦å¯æ— é±¼è‚‰äº¦å¯ç™½èœè±†è…ä¸å¯å°‘ä¸å¾—æŸä¿®é‡‘â€ã€‚æ­¤åï¼Œç§å¡¾å…ˆç”Ÿè™½ç„¶è®¤çœŸæ•™è¯¾ï¼Œä½†ä¸»äººå®¶åˆ™æ€»æ˜¯ç»™ç§å¡¾å…ˆç”Ÿä»¥ç™½èœè±†è…ä¸ºèœï¼Œä¸æ¯«æœªè§é¸¡é¸­é±¼è‚‰çš„æ¬¾å¾…ã€‚ç§å¡¾å…ˆç”Ÿå…ˆæ˜¯å¾ˆä¸è§£ï¼Œå¯æ˜¯åæ¥ä¹Ÿå°±æƒ³é€šäº†ï¼šä¸»äººæŠŠé¸¡é¸­é±¼è‚‰çš„é’±éƒ½ä¼šæ¢ä¸ºæŸä¿®é‡‘çš„ï¼Œä¹Ÿç½¢ã€‚è‡³æ­¤åŒæ–¹ç›¸å®‰æ— äº‹ã€‚</p><p>å¹´å…³å°†è‡³ï¼Œä¸€ä¸ªå­¦å¹´æ®µäº¦å‘Šç»“æŸã€‚ç§å¡¾å…ˆç”Ÿä¸´è¡Œæ—¶ï¼Œä¹Ÿä¸è§ä¸»äººå®¶ä¸ºä»–äº¤ä»˜æŸä¿®é‡‘ï¼Œé‚ä¸ä¸»å®¶ç†è®ºã€‚ç„¶ä¸»å®¶äº¦æŒ¯æŒ¯æœ‰è¯ï¼šâ€œæœ‰åè®®ä¸ºè¯â€”â€”æ— é¸¡é¸­äº¦å¯ï¼Œæ— é±¼è‚‰äº¦å¯ï¼Œç™½èœè±†è…ä¸å¯å°‘ï¼Œä¸å¾—æŸä¿®é‡‘ã€‚è¿™ç™½çº¸é»‘å­—æ˜æ‘†ç€çš„ï¼Œä½ æœ‰ä»€ä¹ˆè¦è¯´çš„å‘¢ï¼Ÿâ€</p><p>ç§å¡¾å…ˆç”Ÿæ®ç†åŠ›äº‰ï¼šâ€œåè®®æ˜¯è¿™æ ·çš„â€”â€”æ— é¸¡ï¼Œé¸­äº¦å¯ï¼›æ— é±¼ï¼Œè‚‰äº¦å¯ï¼›ç™½èœè±†è…ä¸å¯ï¼Œå°‘ä¸å¾—æŸä¿®é‡‘ã€‚â€</p><p>åŒæ–¹å”‡æªèˆŒæˆ˜ï¼Œä½ æ¥æˆ‘å¾€ï¼ŒçœŸä¸ªæ˜¯ä¸äº¦ä¹ä¹ï¼</p><p>è¿™é‡Œçš„æŸä¿®é‡‘ï¼Œä¹Ÿä½œâ€œæŸè„©â€ï¼Œåº”å½“æ˜¯æ³›æŒ‡æ•™å¸ˆåº”å½“å¾—åˆ°çš„æŠ¥é…¬</p></blockquote><h3 id="2-2-redis-åè®®ä¸¾ä¾‹"><a href="#2-2-redis-åè®®ä¸¾ä¾‹" class="headerlink" title="2.2 redis åè®®ä¸¾ä¾‹"></a>2.2 redis åè®®ä¸¾ä¾‹</h3><p>å…ˆå‘é€<code>*N</code>ï¼Œä»£è¡¨è¯¥æŒ‡ä»¤Nä¸ªå‚æ•°ï¼›ç„¶åä¾æ¬¡å‘é€æ¯ä¸ªå‚æ•°ï¼Œ<code>$M</code>ï¼Œä»£è¡¨è¯¥å‚æ•°Mä¸ªå­—ç¬¦ï¼Œä»¥ä¸Šæ¯ä¸ªå­—ç¬¦é•¿åº¦ä»¥åŠå‚æ•°ä¹‹é—´éƒ½ä½¿ç”¨å›è½¦æ¢è¡Œè¿›è¡Œéš”å¼€ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs java">NioEventLoopGroup worker = <span class="hljs-keyword">new</span> NioEventLoopGroup();<br><span class="hljs-keyword">byte</span>[] LINE = &#123;<span class="hljs-number">13</span>, <span class="hljs-number">10</span>&#125;;<br><span class="hljs-keyword">try</span> &#123;<br>    Bootstrap bootstrap = <span class="hljs-keyword">new</span> Bootstrap();<br>    bootstrap.channel(NioSocketChannel.class);<br>    bootstrap.group(worker);<br>    bootstrap.handler(<span class="hljs-keyword">new</span> ChannelInitializer&lt;SocketChannel&gt;() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initChannel</span><span class="hljs-params">(SocketChannel ch)</span> </span>&#123;<br>            ch.pipeline().addLast(<span class="hljs-keyword">new</span> LoggingHandler());<br>            ch.pipeline().addLast(<span class="hljs-keyword">new</span> ChannelInboundHandlerAdapter() &#123;<br>                <span class="hljs-comment">// ä¼šåœ¨è¿æ¥ channel å»ºç«‹æˆåŠŸåï¼Œä¼šè§¦å‘ active äº‹ä»¶</span><br>                <span class="hljs-meta">@Override</span><br>                <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">channelActive</span><span class="hljs-params">(ChannelHandlerContext ctx)</span> </span>&#123;<br>                    set(ctx);<br>                    get(ctx);<br>                &#125;<br>                <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">get</span><span class="hljs-params">(ChannelHandlerContext ctx)</span> </span>&#123;<br>                    ByteBuf buf = ctx.alloc().buffer();<br>                    buf.writeBytes(<span class="hljs-string">&quot;*2&quot;</span>.getBytes());<br>                    buf.writeBytes(LINE);<br>                    buf.writeBytes(<span class="hljs-string">&quot;$3&quot;</span>.getBytes());<br>                    buf.writeBytes(LINE);<br>                    buf.writeBytes(<span class="hljs-string">&quot;get&quot;</span>.getBytes());<br>                    buf.writeBytes(LINE);<br>                    buf.writeBytes(<span class="hljs-string">&quot;$3&quot;</span>.getBytes());<br>                    buf.writeBytes(LINE);<br>                    buf.writeBytes(<span class="hljs-string">&quot;aaa&quot;</span>.getBytes());<br>                    buf.writeBytes(LINE);<br>                    ctx.writeAndFlush(buf);<br>                &#125;<br>                <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">set</span><span class="hljs-params">(ChannelHandlerContext ctx)</span> </span>&#123;<br>                    ByteBuf buf = ctx.alloc().buffer();<br>                    buf.writeBytes(<span class="hljs-string">&quot;*3&quot;</span>.getBytes());<br>                    buf.writeBytes(LINE);<br>                    buf.writeBytes(<span class="hljs-string">&quot;$3&quot;</span>.getBytes());<br>                    buf.writeBytes(LINE);<br>                    buf.writeBytes(<span class="hljs-string">&quot;set&quot;</span>.getBytes());<br>                    buf.writeBytes(LINE);<br>                    buf.writeBytes(<span class="hljs-string">&quot;$3&quot;</span>.getBytes());<br>                    buf.writeBytes(LINE);<br>                    buf.writeBytes(<span class="hljs-string">&quot;aaa&quot;</span>.getBytes());<br>                    buf.writeBytes(LINE);<br>                    buf.writeBytes(<span class="hljs-string">&quot;$3&quot;</span>.getBytes());<br>                    buf.writeBytes(LINE);<br>                    buf.writeBytes(<span class="hljs-string">&quot;bbb&quot;</span>.getBytes());<br>                    buf.writeBytes(LINE);<br>                    ctx.writeAndFlush(buf);<br>                &#125;<br><br>                <span class="hljs-meta">@Override</span><br>                <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">channelRead</span><span class="hljs-params">(ChannelHandlerContext ctx, Object msg)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>                    ByteBuf buf = (ByteBuf) msg;<br>                    System.out.println(buf.toString(Charset.defaultCharset()));<br>                &#125;<br>            &#125;);<br>        &#125;<br>    &#125;);<br>    ChannelFuture channelFuture = bootstrap.connect(<span class="hljs-string">&quot;localhost&quot;</span>, <span class="hljs-number">6379</span>).sync(); <span class="hljs-comment">// è¿æ¥Rediså®¢æˆ·ç«¯</span><br>    channelFuture.channel().closeFuture().sync();<br>&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>    log.error(<span class="hljs-string">&quot;client error&quot;</span>, e);<br>&#125; <span class="hljs-keyword">finally</span> &#123;<br>    worker.shutdownGracefully();<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2-3-http-åè®®ä¸¾ä¾‹"><a href="#2-3-http-åè®®ä¸¾ä¾‹" class="headerlink" title="2.3 http åè®®ä¸¾ä¾‹"></a>2.3 http åè®®ä¸¾ä¾‹</h3><p>Nettyå·²ç»å®ç°å¥½äº†<code>Redis</code>ã€<code>HTTP</code>ç­‰ç­‰åè®®ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs java">NioEventLoopGroup boss = <span class="hljs-keyword">new</span> NioEventLoopGroup();<br>NioEventLoopGroup worker = <span class="hljs-keyword">new</span> NioEventLoopGroup();<br><span class="hljs-keyword">try</span> &#123;<br>    ServerBootstrap serverBootstrap = <span class="hljs-keyword">new</span> ServerBootstrap();<br>    serverBootstrap.channel(NioServerSocketChannel.class);<br>    serverBootstrap.group(boss, worker);<br>    serverBootstrap.childHandler(<span class="hljs-keyword">new</span> ChannelInitializer&lt;SocketChannel&gt;() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initChannel</span><span class="hljs-params">(SocketChannel ch)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>            ch.pipeline().addLast(<span class="hljs-keyword">new</span> LoggingHandler(LogLevel.DEBUG));<br>            ch.pipeline().addLast(<span class="hljs-keyword">new</span> HttpServerCodec()); <span class="hljs-comment">// å¯¹HTTPæŠ¥æ–‡è¿›è¡Œç¼–è§£ç ï¼ŒCodecå°±æ˜¯æ—¢åŒ…å«è§£ç åˆåŒ…å«ç¼–ç </span><br>            ch.pipeline().addLast(<span class="hljs-keyword">new</span> SimpleChannelInboundHandler&lt;HttpRequest&gt;() &#123; <span class="hljs-comment">// è¯¥Handleråªå¤„ç†æ³›å‹ç±»å‹æ¶ˆæ¯</span><br>                <span class="hljs-meta">@Override</span><br>                <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">channelRead0</span><span class="hljs-params">(ChannelHandlerContext ctx, HttpRequest msg)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>                    <span class="hljs-comment">// è·å–è¯·æ±‚è¡Œ</span><br>                    log.debug(msg.uri());<br>                    <span class="hljs-comment">// è·å–è¯·æ±‚å¤´</span><br>                    log.debug(msg.headers);<br><br>                    <span class="hljs-comment">// è¿”å›å“åº”</span><br>                    DefaultFullHttpResponse response =<br>                            <span class="hljs-keyword">new</span> DefaultFullHttpResponse(msg.protocolVersion(), HttpResponseStatus.OK);<br><br>                    <span class="hljs-keyword">byte</span>[] bytes = <span class="hljs-string">&quot;&lt;h1&gt;Hello, world!&lt;/h1&gt;&quot;</span>.getBytes();<br><br>                    response.headers().setInt(CONTENT_LENGTH, bytes.length); <span class="hljs-comment">//è®¾ç½®é•¿åº¦ï¼ŒHTTP1.1åŠå…¶ä¹‹åéƒ½æ˜¯é•¿è¿æ¥ï¼Œå¦‚æœæ˜¯çŸ­é“¾æ¥ï¼Œå‘é€å®Œå°±å…³é—­äº†ï¼Œæµè§ˆå™¨è®¤ä¸ºæ•°æ®æ¥æ”¶å®Œäº†ï¼Œä½†æ˜¯é•¿è¿æ¥ä¸‹ä¸ç»™é•¿åº¦æ ‡è¯†æ˜¯æµè§ˆå™¨æ— æ³•æ„ŸçŸ¥åˆ°åº•æ•°æ®æ¥æ”¶å®Œæ²¡æœ‰ã€‚</span><br>                    response.content().writeBytes(bytes);<br><br>                    <span class="hljs-comment">// å†™å›å“åº”</span><br>                    ctx.writeAndFlush(response);<br>                &#125;<br>            &#125;);<br>            <span class="hljs-comment">/*ch.pipeline().addLast(new ChannelInboundHandlerAdapter() &#123;</span><br><span class="hljs-comment">                @Override</span><br><span class="hljs-comment">                public void channelRead(ChannelHandlerContext ctx, Object msg) throws Exception &#123;</span><br><span class="hljs-comment">                    log.debug(&quot;&#123;&#125;&quot;, msg.getClass());</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">                    if (msg instanceof HttpRequest) &#123; // è¯·æ±‚è¡Œï¼Œè¯·æ±‚å¤´</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">                    &#125; else if (msg instanceof HttpContent) &#123; //è¯·æ±‚ä½“</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">                    &#125;</span><br><span class="hljs-comment">                &#125;</span><br><span class="hljs-comment">            &#125;);*/</span><br>        &#125;<br>    &#125;);<br>    ChannelFuture channelFuture = serverBootstrap.bind(<span class="hljs-number">8080</span>).sync();<br>    channelFuture.channel().closeFuture().sync();<br>&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>    log.error(<span class="hljs-string">&quot;server error&quot;</span>, e);<br>&#125; <span class="hljs-keyword">finally</span> &#123;<br>    boss.shutdownGracefully();<br>    worker.shutdownGracefully();<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2-4-è‡ªå®šä¹‰åè®®è¦ç´ "><a href="#2-4-è‡ªå®šä¹‰åè®®è¦ç´ " class="headerlink" title="2.4 è‡ªå®šä¹‰åè®®è¦ç´ "></a>2.4 è‡ªå®šä¹‰åè®®è¦ç´ </h3><ul><li>é­”æ•°ï¼Œç”¨æ¥åœ¨ç¬¬ä¸€æ—¶é—´åˆ¤å®šæ˜¯å¦æ˜¯æ— æ•ˆæ•°æ®åŒ…</li><li>ç‰ˆæœ¬å·ï¼Œå¯ä»¥æ”¯æŒåè®®çš„å‡çº§</li><li>åºåˆ—åŒ–ç®—æ³•ï¼Œæ¶ˆæ¯æ­£æ–‡åˆ°åº•é‡‡ç”¨å“ªç§åºåˆ—åŒ–ååºåˆ—åŒ–æ–¹å¼ï¼Œå¯ä»¥ç”±æ­¤æ‰©å±•ï¼Œä¾‹å¦‚ï¼šjsonã€protobufã€hessianã€jdk</li><li>æŒ‡ä»¤ç±»å‹ï¼Œæ˜¯ç™»å½•ã€æ³¨å†Œã€å•èŠã€ç¾¤èŠâ€¦ è·Ÿä¸šåŠ¡ç›¸å…³</li><li>è¯·æ±‚åºå·ï¼Œä¸ºäº†åŒå·¥é€šä¿¡ï¼Œæä¾›å¼‚æ­¥èƒ½åŠ›</li><li>æ­£æ–‡é•¿åº¦</li><li>æ¶ˆæ¯æ­£æ–‡</li></ul><h4 id="ç¼–è§£ç å™¨"><a href="#ç¼–è§£ç å™¨" class="headerlink" title="ç¼–è§£ç å™¨"></a>ç¼–è§£ç å™¨</h4><p>æ ¹æ®ä¸Šé¢çš„è¦ç´ ï¼Œè®¾è®¡ä¸€ä¸ªç™»å½•è¯·æ±‚æ¶ˆæ¯å’Œç™»å½•å“åº”æ¶ˆæ¯ï¼Œå¹¶ä½¿ç”¨ Netty å®Œæˆæ”¶å‘</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MessageCodec</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ByteToMessageCodec</span>&lt;<span class="hljs-title">Message</span>&gt; </span>&#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">encode</span><span class="hljs-params">(ChannelHandlerContext ctx, Message msg, ByteBuf out)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        <span class="hljs-comment">// 1. 4 å­—èŠ‚çš„é­”æ•°</span><br>        out.writeBytes(<span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[]&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>&#125;);<br>        <span class="hljs-comment">// 2. 1 å­—èŠ‚çš„ç‰ˆæœ¬,</span><br>        out.writeByte(<span class="hljs-number">1</span>);<br>        <span class="hljs-comment">// 3. 1 å­—èŠ‚çš„åºåˆ—åŒ–æ–¹å¼ jdk 0 , json 1</span><br>        out.writeByte(<span class="hljs-number">0</span>);<br>        <span class="hljs-comment">// 4. 1 å­—èŠ‚çš„æŒ‡ä»¤ç±»å‹(è™½ç„¶å‚æ•°æ˜¯intç±»å‹ï¼Œä½†æ˜¯ByteBuf.writeByte()æŠŠJavaå››ä¸ªå­—èŠ‚çš„æœ‰æ•ˆä½å†™è¿›å»ï¼Œä¸€ä¸ªå­—èŠ‚)</span><br>        out.writeByte(msg.getMessageType());<br>        <span class="hljs-comment">// 5. 4 ä¸ªå­—èŠ‚</span><br>        out.writeInt(msg.getSequenceId());<br>        <span class="hljs-comment">// æ— æ„ä¹‰ï¼Œå¯¹é½å¡«å……ï¼Œè®©è¯¥åè®®å¤´çš„å­—èŠ‚é•¿åº¦æ˜¯2çš„næ¬¡æ–¹å€</span><br>        out.writeByte(<span class="hljs-number">0xff</span>);<br>        <span class="hljs-comment">// 6. è·å–å†…å®¹çš„å­—èŠ‚æ•°ç»„</span><br>        ByteArrayOutputStream bos = <span class="hljs-keyword">new</span> ByteArrayOutputStream();<br>        ObjectOutputStream oos = <span class="hljs-keyword">new</span> ObjectOutputStream(bos);<br>        oos.writeObject(msg);<br>        <span class="hljs-keyword">byte</span>[] bytes = bos.toByteArray();<br>        <span class="hljs-comment">// 7. é•¿åº¦ï¼Œ4 å­—èŠ‚</span><br>        out.writeInt(bytes.length);<br>        <span class="hljs-comment">// 8. å†™å…¥å†…å®¹</span><br>        out.writeBytes(bytes);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">decode</span><span class="hljs-params">(ChannelHandlerContext ctx, ByteBuf in, List&lt;Object&gt; out)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        <span class="hljs-keyword">int</span> magicNum = in.readInt();<br>        <span class="hljs-keyword">byte</span> version = in.readByte();<br>        <span class="hljs-keyword">byte</span> serializerType = in.readByte();<br>        <span class="hljs-keyword">byte</span> messageType = in.readByte();<br>        <span class="hljs-keyword">int</span> sequenceId = in.readInt();<br>        in.readByte();<br>        <span class="hljs-keyword">int</span> length = in.readInt();<br>        <span class="hljs-keyword">byte</span>[] bytes = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[length];<br>        in.readBytes(bytes, <span class="hljs-number">0</span>, length);<br>        ObjectInputStream ois = <span class="hljs-keyword">new</span> ObjectInputStream(<span class="hljs-keyword">new</span> ByteArrayInputStream(bytes));<br>        Message message = (Message) ois.readObject();<br>        log.debug(<span class="hljs-string">&quot;&#123;&#125;, &#123;&#125;, &#123;&#125;, &#123;&#125;, &#123;&#125;, &#123;&#125;&quot;</span>, magicNum, version, serializerType, messageType, sequenceId, length);<br>        log.debug(<span class="hljs-string">&quot;&#123;&#125;&quot;</span>, message);<br>        out.add(message);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æµ‹è¯•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java">EmbeddedChannel channel = <span class="hljs-keyword">new</span> EmbeddedChannel(<br>    <span class="hljs-keyword">new</span> LoggingHandler(),<br>    <span class="hljs-keyword">new</span> LengthFieldBasedFrameDecoder(<span class="hljs-number">1024</span>, <span class="hljs-number">12</span>, <span class="hljs-number">4</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>), <span class="hljs-comment">//é˜²æ­¢decoderæ—¶å‘ç”ŸåŠåŒ…é—®é¢˜</span><br>    <span class="hljs-keyword">new</span> MessageCodec()<br>);<br><span class="hljs-comment">// encode</span><br>LoginRequestMessage message = <span class="hljs-keyword">new</span> LoginRequestMessage(<span class="hljs-string">&quot;zhangsan&quot;</span>, <span class="hljs-string">&quot;123&quot;</span>, <span class="hljs-string">&quot;å¼ ä¸‰&quot;</span>);<br>channel.writeOutbound(message);<br><br><span class="hljs-comment">// decode</span><br>ByteBuf buf = ByteBufAllocator.DEFAULT.buffer();<br><span class="hljs-keyword">new</span> MessageCodec().encode(<span class="hljs-keyword">null</span>, message, buf);<br><br><br><span class="hljs-comment">// ä¸‹é¢æ¼”ç¤ºåŠåŒ…ç°è±¡ã€‚</span><br>ByteBuf s1 = buf.slice(<span class="hljs-number">0</span>, <span class="hljs-number">100</span>);<br>ByteBuf s2 = buf.slice(<span class="hljs-number">100</span>, buf.readableBytes() - <span class="hljs-number">100</span>);<br>s1.retain(); <span class="hljs-comment">// å¼•ç”¨è®¡æ•°++</span><br>channel.writeInbound(s1); <span class="hljs-comment">// release å¼•ç”¨è®¡æ•°--</span><br>channel.writeInbound(s2); <span class="hljs-comment">// release å¼•ç”¨è®¡æ•°--</span><br></code></pre></td></tr></table></figure><p>è§£è¯»</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20230503204057998.png"></p><h4 id="ğŸ’¡-ä»€ä¹ˆæ—¶å€™å¯ä»¥åŠ -Sharable"><a href="#ğŸ’¡-ä»€ä¹ˆæ—¶å€™å¯ä»¥åŠ -Sharable" class="headerlink" title="ğŸ’¡ ä»€ä¹ˆæ—¶å€™å¯ä»¥åŠ  @Sharable"></a>ğŸ’¡ ä»€ä¹ˆæ—¶å€™å¯ä»¥åŠ  @Sharable</h4><p>å¯ä¸å¯ä»¥åˆ›å»ºä¸€ä¸ªHandlerï¼Œå°†æ¥æ·»åŠ åˆ°å¤šä¸ªChannelé‡Œé¢ï¼Œè¢«å¤šä¸ªChannelå…±äº«ã€‚</p><p>å¯¹äºNettyä¸­çš„Handlerï¼Œèƒ½ä¸èƒ½è¢«å¤šä¸ªChannelå…±äº«ï¼Œä¸»è¦çœ‹è¯¥ç±»æœ‰æ²¡æœ‰åŠ @Sharableæ³¨è§£ï¼Œå¦‚æœåŠ äº†@Sharableæ³¨è§£è¯´æ˜ï¼Œå¯ä»¥è¢«å¤šä¸ªChannelå…±äº«ï¼Œæ¯”å¦‚Nettyä¸­çš„<code>LoggingHandler</code>ç±»ã€‚</p><ul><li>å½“ handler ä¸ä¿å­˜çŠ¶æ€æ—¶ï¼Œå°±å¯ä»¥å®‰å…¨åœ°åœ¨å¤šçº¿ç¨‹ä¸‹è¢«å…±äº«</li><li>ä½†è¦æ³¨æ„å¯¹äºç¼–è§£ç å™¨ç±»ï¼Œä¸èƒ½ç»§æ‰¿ ByteToMessageCodec æˆ– CombinedChannelDuplexHandler çˆ¶ç±»ï¼Œä»–ä»¬çš„æ„é€ æ–¹æ³•å¯¹ @Sharable æœ‰é™åˆ¶ã€‚å› ä¸º<code>ByteToMessageCodec</code>è®¾è®¡ä¹‹åˆï¼Œè€ƒè™‘åˆ°å®ƒçš„å­ç±»è¦ä¿å­˜ä¸Šä¸€æ¬¡è§¦å‘çš„çŠ¶æ€ï¼Œæ‰€ä»¥å¼ºåˆ¶è§„å®šï¼Œå®ƒçš„å­ç±»ä¸å¯ä»¥åŠ <code>@Sharable</code>æ³¨è§£ï¼ˆ**<code>ByteToMessageCodec</code>æŠ½è±¡ç±»çš„æ„é€ å™¨ï¼Œåˆ©ç”¨åå°„æ£€æŸ¥ï¼Œå½“å‰å¯¹è±¡çš„è¿è¡Œç±»å‹æ˜¯å¦åŠ ä¸Šäº†<code>@Sharable</code>æ³¨è§£ï¼Œå¦‚æœåŠ ä¸Šäº†ï¼Œé‚£ä¹ˆæŠ›å‡ºå¼‚å¸¸*<em>ï¼Œåœ¨</em>æŠ½è±¡ç±»<em>ä¸­</em>å¯ä»¥æœ‰æ„é€ æ–¹æ³•<em>ï¼Œåªæ˜¯ä¸èƒ½ç›´æ¥åˆ›å»º</em>æŠ½è±¡ç±»<em>çš„å®ä¾‹å¯¹è±¡ï¼Œä½†å®ä¾‹åŒ–å­ç±»çš„æ—¶å€™ï¼Œå°±ä¼šåˆå§‹åŒ–çˆ¶ç±»ï¼Œä¸ç®¡çˆ¶ç±»æ˜¯ä¸æ˜¯</em>æŠ½è±¡ç±»*éƒ½ä¼šè°ƒç”¨çˆ¶ç±»çš„æ„é€ æ–¹æ³•ï¼‰ã€‚</li><li>å¦‚æœèƒ½ç¡®ä¿ç¼–è§£ç å™¨ä¸ä¼šä¿å­˜çŠ¶æ€ï¼Œå¯ä»¥ç»§æ‰¿ MessageToMessageCodecç±»</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@ChannelHandler</span>.Sharable<br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å¿…é¡»å’Œ LengthFieldBasedFrameDecoder ä¸€èµ·ä½¿ç”¨ï¼Œç¡®ä¿æ¥åˆ°çš„ ByteBuf æ¶ˆæ¯æ˜¯å®Œæ•´çš„</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MessageCodecSharable</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">MessageToMessageCodec</span>&lt;<span class="hljs-title">ByteBuf</span>, <span class="hljs-title">Message</span>&gt; </span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">encode</span><span class="hljs-params">(ChannelHandlerContext ctx, Message msg, List&lt;Object&gt; outList)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        ByteBuf out = ctx.alloc().buffer();<br>        <span class="hljs-comment">// 1. 4 å­—èŠ‚çš„é­”æ•°</span><br>        out.writeBytes(<span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[]&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>&#125;);<br>        <span class="hljs-comment">// 2. 1 å­—èŠ‚çš„ç‰ˆæœ¬,</span><br>        out.writeByte(<span class="hljs-number">1</span>);<br>        <span class="hljs-comment">// 3. 1 å­—èŠ‚çš„åºåˆ—åŒ–æ–¹å¼ jdk 0 , json 1</span><br>        out.writeByte(<span class="hljs-number">0</span>);<br>        <span class="hljs-comment">// 4. 1 å­—èŠ‚çš„æŒ‡ä»¤ç±»å‹</span><br>        out.writeByte(msg.getMessageType());<br>        <span class="hljs-comment">// 5. 4 ä¸ªå­—èŠ‚</span><br>        out.writeInt(msg.getSequenceId());<br>        <span class="hljs-comment">// æ— æ„ä¹‰ï¼Œå¯¹é½å¡«å……</span><br>        out.writeByte(<span class="hljs-number">0xff</span>);<br>        <span class="hljs-comment">// 6. è·å–å†…å®¹çš„å­—èŠ‚æ•°ç»„</span><br>        ByteArrayOutputStream bos = <span class="hljs-keyword">new</span> ByteArrayOutputStream();<br>        ObjectOutputStream oos = <span class="hljs-keyword">new</span> ObjectOutputStream(bos);<br>        oos.writeObject(msg);<br>        <span class="hljs-keyword">byte</span>[] bytes = bos.toByteArray();<br>        <span class="hljs-comment">// 7. é•¿åº¦</span><br>        out.writeInt(bytes.length);<br>        <span class="hljs-comment">// 8. å†™å…¥å†…å®¹</span><br>        out.writeBytes(bytes);<br>        outList.add(out);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">decode</span><span class="hljs-params">(ChannelHandlerContext ctx, ByteBuf in, List&lt;Object&gt; out)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        <span class="hljs-keyword">int</span> magicNum = in.readInt();<br>        <span class="hljs-keyword">byte</span> version = in.readByte();<br>        <span class="hljs-keyword">byte</span> serializerType = in.readByte();<br>        <span class="hljs-keyword">byte</span> messageType = in.readByte();<br>        <span class="hljs-keyword">int</span> sequenceId = in.readInt();<br>        in.readByte();<br>        <span class="hljs-keyword">int</span> length = in.readInt();<br>        <span class="hljs-keyword">byte</span>[] bytes = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[length];<br>        in.readBytes(bytes, <span class="hljs-number">0</span>, length);<br>        ObjectInputStream ois = <span class="hljs-keyword">new</span> ObjectInputStream(<span class="hljs-keyword">new</span> ByteArrayInputStream(bytes));<br>        Message message = (Message) ois.readObject();<br>        log.debug(<span class="hljs-string">&quot;&#123;&#125;, &#123;&#125;, &#123;&#125;, &#123;&#125;, &#123;&#125;, &#123;&#125;&quot;</span>, magicNum, version, serializerType, messageType, sequenceId, length);<br>        log.debug(<span class="hljs-string">&quot;&#123;&#125;&quot;</span>, message);<br>        out.add(message);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="3-èŠå¤©å®¤æ¡ˆä¾‹"><a href="#3-èŠå¤©å®¤æ¡ˆä¾‹" class="headerlink" title="3. èŠå¤©å®¤æ¡ˆä¾‹"></a>3. èŠå¤©å®¤æ¡ˆä¾‹</h2><h3 id="3-1-èŠå¤©å®¤ä¸šåŠ¡ä»‹ç»"><a href="#3-1-èŠå¤©å®¤ä¸šåŠ¡ä»‹ç»" class="headerlink" title="3.1 èŠå¤©å®¤ä¸šåŠ¡ä»‹ç»"></a>3.1 èŠå¤©å®¤ä¸šåŠ¡ä»‹ç»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ç”¨æˆ·ç®¡ç†æ¥å£</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserService</span> </span>&#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ç™»å½•</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> username ç”¨æˆ·å</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> password å¯†ç </span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> ç™»å½•æˆåŠŸè¿”å› true, å¦åˆ™è¿”å› false</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">login</span><span class="hljs-params">(String username, String password)</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ä¼šè¯ç®¡ç†æ¥å£</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Session</span> </span>&#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ç»‘å®šä¼šè¯</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> channel å“ªä¸ª channel è¦ç»‘å®šä¼šè¯</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> username ä¼šè¯ç»‘å®šç”¨æˆ·</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">bind</span><span class="hljs-params">(Channel channel, String username)</span></span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è§£ç»‘ä¼šè¯</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> channel å“ªä¸ª channel è¦è§£ç»‘ä¼šè¯</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">unbind</span><span class="hljs-params">(Channel channel)</span></span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è·å–å±æ€§</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> channel å“ªä¸ª channel</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> name å±æ€§å</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> å±æ€§å€¼</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function">Object <span class="hljs-title">getAttribute</span><span class="hljs-params">(Channel channel, String name)</span></span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è®¾ç½®å±æ€§</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> channel å“ªä¸ª channel</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> name å±æ€§å</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> value å±æ€§å€¼</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setAttribute</span><span class="hljs-params">(Channel channel, String name, Object value)</span></span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ ¹æ®ç”¨æˆ·åè·å– channel</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> username ç”¨æˆ·å</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> channel</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function">Channel <span class="hljs-title">getChannel</span><span class="hljs-params">(String username)</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * èŠå¤©ç»„ä¼šè¯ç®¡ç†æ¥å£</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">GroupSession</span> </span>&#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * åˆ›å»ºä¸€ä¸ªèŠå¤©ç»„, å¦‚æœä¸å­˜åœ¨æ‰èƒ½åˆ›å»ºæˆåŠŸ, å¦åˆ™è¿”å› null</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> name ç»„å</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> members æˆå‘˜</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> æˆåŠŸæ—¶è¿”å›ç»„å¯¹è±¡, å¤±è´¥è¿”å› null</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function">Group <span class="hljs-title">createGroup</span><span class="hljs-params">(String name, Set&lt;String&gt; members)</span></span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * åŠ å…¥èŠå¤©ç»„</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> name ç»„å</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> member æˆå‘˜å</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> å¦‚æœç»„ä¸å­˜åœ¨è¿”å› null, å¦åˆ™è¿”å›ç»„å¯¹è±¡</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function">Group <span class="hljs-title">joinMember</span><span class="hljs-params">(String name, String member)</span></span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ç§»é™¤ç»„æˆå‘˜</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> name ç»„å</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> member æˆå‘˜å</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> å¦‚æœç»„ä¸å­˜åœ¨è¿”å› null, å¦åˆ™è¿”å›ç»„å¯¹è±¡</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function">Group <span class="hljs-title">removeMember</span><span class="hljs-params">(String name, String member)</span></span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ç§»é™¤èŠå¤©ç»„</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> name ç»„å</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> å¦‚æœç»„ä¸å­˜åœ¨è¿”å› null, å¦åˆ™è¿”å›ç»„å¯¹è±¡</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function">Group <span class="hljs-title">removeGroup</span><span class="hljs-params">(String name)</span></span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è·å–ç»„æˆå‘˜</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> name ç»„å</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> æˆå‘˜é›†åˆ, æ²¡æœ‰æˆå‘˜ä¼šè¿”å› empty set</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function">Set&lt;String&gt; <span class="hljs-title">getMembers</span><span class="hljs-params">(String name)</span></span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è·å–ç»„æˆå‘˜çš„ channel é›†åˆ, åªæœ‰åœ¨çº¿çš„ channel æ‰ä¼šè¿”å›</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> name ç»„å</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> æˆå‘˜ channel é›†åˆ</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function">List&lt;Channel&gt; <span class="hljs-title">getMembersChannel</span><span class="hljs-params">(String name)</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="3-2-èŠå¤©å®¤ä¸šåŠ¡-ç™»å½•"><a href="#3-2-èŠå¤©å®¤ä¸šåŠ¡-ç™»å½•" class="headerlink" title="3.2 èŠå¤©å®¤ä¸šåŠ¡-ç™»å½•"></a>3.2 èŠå¤©å®¤ä¸šåŠ¡-ç™»å½•</h3><h4 id="SimpleChannelInboundHandler-lt-LoginRequestMessage-gt"><a href="#SimpleChannelInboundHandler-lt-LoginRequestMessage-gt" class="headerlink" title="SimpleChannelInboundHandler&lt;LoginRequestMessage&gt;"></a><code>SimpleChannelInboundHandler&lt;LoginRequestMessage&gt;</code></h4><p><code>SimpleChannelInboundHandler&lt;LoginRequestMessage&gt;</code>æ„æ€æ˜¯åªæœ‰æ³›å‹ç±»å‹LoginRequestMessageæ¶ˆæ¯ç±»å‹æ‰ä¼šè§¦å‘è¯¥Handlerã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ChatServer</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        NioEventLoopGroup boss = <span class="hljs-keyword">new</span> NioEventLoopGroup();<br>        NioEventLoopGroup worker = <span class="hljs-keyword">new</span> NioEventLoopGroup();<br>        LoggingHandler LOGGING_HANDLER = <span class="hljs-keyword">new</span> LoggingHandler(LogLevel.DEBUG);<br>        MessageCodecSharable MESSAGE_CODEC = <span class="hljs-keyword">new</span> MessageCodecSharable();<br>        <span class="hljs-keyword">try</span> &#123;<br>            ServerBootstrap serverBootstrap = <span class="hljs-keyword">new</span> ServerBootstrap();<br>            serverBootstrap.channel(NioServerSocketChannel.class);<br>            serverBootstrap.group(boss, worker);<br>            serverBootstrap.childHandler(<span class="hljs-keyword">new</span> ChannelInitializer&lt;SocketChannel&gt;() &#123;<br>                <span class="hljs-meta">@Override</span><br>                <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initChannel</span><span class="hljs-params">(SocketChannel ch)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>                    ch.pipeline().addLast(<span class="hljs-keyword">new</span> ProcotolFrameDecoder());<br>                    ch.pipeline().addLast(LOGGING_HANDLER);<br>                    ch.pipeline().addLast(MESSAGE_CODEC);<br>                    ch.pipeline().addLast(<span class="hljs-keyword">new</span> SimpleChannelInboundHandler&lt;LoginRequestMessage&gt;() &#123;<br>          <br>                        <span class="hljs-meta">@Override</span><br>                        <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">channelRead0</span><span class="hljs-params">(ChannelHandlerContext ctx, LoginRequestMessage msg)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>                            String username = msg.getUsername();<br>                            String password = msg.getPassword();<br>                            <span class="hljs-keyword">boolean</span> login = UserServiceFactory.getUserService().login(username, password);<br>                            LoginResponseMessage message;<br>                            <span class="hljs-keyword">if</span>(login) &#123;<br>                                message = <span class="hljs-keyword">new</span> LoginResponseMessage(<span class="hljs-keyword">true</span>, <span class="hljs-string">&quot;ç™»å½•æˆåŠŸ&quot;</span>);<br>                            &#125; <span class="hljs-keyword">else</span> &#123;<br>                                message = <span class="hljs-keyword">new</span> LoginResponseMessage(<span class="hljs-keyword">false</span>, <span class="hljs-string">&quot;ç”¨æˆ·åæˆ–å¯†ç ä¸æ­£ç¡®&quot;</span>);<br>                            &#125;<br>                            ctx.writeAndFlush(message); <span class="hljs-comment">//ctx.writeAndFlushæ˜¯ä»å½“å‰ä½ç½®å¾€å‰; ch.writeAndFlushæ˜¯ä»tailå¾€å‰</span><br>                        &#125;<br>                    &#125;);<br>                &#125;<br>            &#125;);<br>            Channel channel = serverBootstrap.bind(<span class="hljs-number">8080</span>).sync().channel();<br>            channel.closeFuture().sync();<br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>            log.error(<span class="hljs-string">&quot;server error&quot;</span>, e);<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            boss.shutdownGracefully();<br>            worker.shutdownGracefully();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ChatClient</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        NioEventLoopGroup group = <span class="hljs-keyword">new</span> NioEventLoopGroup();<br>        LoggingHandler LOGGING_HANDLER = <span class="hljs-keyword">new</span> LoggingHandler(LogLevel.DEBUG);<br>        MessageCodecSharable MESSAGE_CODEC = <span class="hljs-keyword">new</span> MessageCodecSharable();<br>        CountDownLatch WAIT_FOR_LOGIN = <span class="hljs-keyword">new</span> CountDownLatch(<span class="hljs-number">1</span>);<br>        AtomicBoolean LOGIN = <span class="hljs-keyword">new</span> AtomicBoolean(<span class="hljs-keyword">false</span>);<br>        <span class="hljs-keyword">try</span> &#123;<br>            Bootstrap bootstrap = <span class="hljs-keyword">new</span> Bootstrap();<br>            bootstrap.channel(NioSocketChannel.class);<br>            bootstrap.group(group);<br>            bootstrap.handler(<span class="hljs-keyword">new</span> ChannelInitializer&lt;SocketChannel&gt;() &#123;<br>                <span class="hljs-meta">@Override</span><br>                <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initChannel</span><span class="hljs-params">(SocketChannel ch)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>                    ch.pipeline().addLast(<span class="hljs-keyword">new</span> ProcotolFrameDecoder());<br><span class="hljs-comment">//                    ch.pipeline().addLast(LOGGING_HANDLER);</span><br>                    ch.pipeline().addLast(MESSAGE_CODEC);<br>                    ch.pipeline().addLast(<span class="hljs-string">&quot;client handler&quot;</span>, <span class="hljs-keyword">new</span> ChannelInboundHandlerAdapter() &#123;<br>                        <span class="hljs-comment">// æ¥æ”¶å“åº”æ¶ˆæ¯</span><br>                        <span class="hljs-meta">@Override</span><br>                        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">channelRead</span><span class="hljs-params">(ChannelHandlerContext ctx, Object msg)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>                            log.debug(<span class="hljs-string">&quot;msg: &#123;&#125;&quot;</span>, msg);<br>                            <span class="hljs-keyword">if</span> ((msg <span class="hljs-keyword">instanceof</span> LoginResponseMessage)) &#123;<br>                                LoginResponseMessage response = (LoginResponseMessage) msg;<br>                                <span class="hljs-keyword">if</span> (response.isSuccess()) &#123;<br>                                    <span class="hljs-comment">// å¦‚æœç™»å½•æˆåŠŸ</span><br>                                    LOGIN.set(<span class="hljs-keyword">true</span>);<br>                                &#125;<br>                                <span class="hljs-comment">// å”¤é†’ system in çº¿ç¨‹</span><br>                                WAIT_FOR_LOGIN.countDown();<br>                            &#125;<br>                        &#125;<br><br>                        <span class="hljs-comment">// åœ¨è¿æ¥å»ºç«‹åè§¦å‘ active äº‹ä»¶</span><br>                        <span class="hljs-meta">@Override</span><br>                        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">channelActive</span><span class="hljs-params">(ChannelHandlerContext ctx)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>                            <span class="hljs-comment">// è´Ÿè´£æ¥æ”¶ç”¨æˆ·åœ¨æ§åˆ¶å°çš„è¾“å…¥ï¼Œè´Ÿè´£å‘æœåŠ¡å™¨å‘é€å„ç§æ¶ˆæ¯</span><br>                            <span class="hljs-keyword">new</span> Thread(() -&gt; &#123;<br>                                Scanner scanner = <span class="hljs-keyword">new</span> Scanner(System.in);<br>                                System.out.println(<span class="hljs-string">&quot;è¯·è¾“å…¥ç”¨æˆ·å:&quot;</span>);<br>                                String username = scanner.nextLine();<br>                                System.out.println(<span class="hljs-string">&quot;è¯·è¾“å…¥å¯†ç :&quot;</span>);<br>                                String password = scanner.nextLine();<br>                                <span class="hljs-comment">// æ„é€ æ¶ˆæ¯å¯¹è±¡</span><br>                                LoginRequestMessage message = <span class="hljs-keyword">new</span> LoginRequestMessage(username, password);<br>                                <span class="hljs-comment">// å‘é€æ¶ˆæ¯</span><br>                                ctx.writeAndFlush(message);<br>                                System.out.println(<span class="hljs-string">&quot;ç­‰å¾…åç»­æ“ä½œ...&quot;</span>);<br>                                <span class="hljs-keyword">try</span> &#123;<br>                                    WAIT_FOR_LOGIN.await();<br>                                &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                                    e.printStackTrace();<br>                                &#125;<br>                                <span class="hljs-comment">// å¦‚æœç™»å½•å¤±è´¥</span><br>                                <span class="hljs-keyword">if</span> (!LOGIN.get()) &#123;<br>                                    ctx.channel().close();<br>                                    <span class="hljs-keyword">return</span>;<br>                                &#125;<br>                                <span class="hljs-keyword">while</span> (<span class="hljs-keyword">true</span>) &#123;<br>                                    System.out.println(<span class="hljs-string">&quot;==================================&quot;</span>);<br>                                    System.out.println(<span class="hljs-string">&quot;send [username] [content]&quot;</span>);<br>                                    System.out.println(<span class="hljs-string">&quot;gsend [group name] [content]&quot;</span>);<br>                                    System.out.println(<span class="hljs-string">&quot;gcreate [group name] [m1,m2,m3...]&quot;</span>);<br>                                    System.out.println(<span class="hljs-string">&quot;gmembers [group name]&quot;</span>);<br>                                    System.out.println(<span class="hljs-string">&quot;gjoin [group name]&quot;</span>);<br>                                    System.out.println(<span class="hljs-string">&quot;gquit [group name]&quot;</span>);<br>                                    System.out.println(<span class="hljs-string">&quot;quit&quot;</span>);<br>                                    System.out.println(<span class="hljs-string">&quot;==================================&quot;</span>);<br>                                    String command = scanner.nextLine();<br>                                    String[] s = command.split(<span class="hljs-string">&quot; &quot;</span>);<br>                                    <span class="hljs-keyword">switch</span> (s[<span class="hljs-number">0</span>])&#123;<br>                                        <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;send&quot;</span>:<br>                                            ctx.writeAndFlush(<span class="hljs-keyword">new</span> ChatRequestMessage(username, s[<span class="hljs-number">1</span>], s[<span class="hljs-number">2</span>]));<br>                                            <span class="hljs-keyword">break</span>;<br>                                        <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;gsend&quot;</span>:<br>                                            ctx.writeAndFlush(<span class="hljs-keyword">new</span> GroupChatRequestMessage(username, s[<span class="hljs-number">1</span>], s[<span class="hljs-number">2</span>]));<br>                                            <span class="hljs-keyword">break</span>;<br>                                        <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;gcreate&quot;</span>:<br>                                            Set&lt;String&gt; set = <span class="hljs-keyword">new</span> HashSet&lt;&gt;(Arrays.asList(s[<span class="hljs-number">2</span>].split(<span class="hljs-string">&quot;,&quot;</span>)));<br>                                            set.add(username); <span class="hljs-comment">// åŠ å…¥è‡ªå·±</span><br>                                            ctx.writeAndFlush(<span class="hljs-keyword">new</span> GroupCreateRequestMessage(s[<span class="hljs-number">1</span>], set));<br>                                            <span class="hljs-keyword">break</span>;<br>                                        <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;gmembers&quot;</span>:<br>                                            ctx.writeAndFlush(<span class="hljs-keyword">new</span> GroupMembersRequestMessage(s[<span class="hljs-number">1</span>]));<br>                                            <span class="hljs-keyword">break</span>;<br>                                        <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;gjoin&quot;</span>:<br>                                            ctx.writeAndFlush(<span class="hljs-keyword">new</span> GroupJoinRequestMessage(username, s[<span class="hljs-number">1</span>]));<br>                                            <span class="hljs-keyword">break</span>;<br>                                        <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;gquit&quot;</span>:<br>                                            ctx.writeAndFlush(<span class="hljs-keyword">new</span> GroupQuitRequestMessage(username, s[<span class="hljs-number">1</span>]));<br>                                            <span class="hljs-keyword">break</span>;<br>                                        <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;quit&quot;</span>:<br>                                            ctx.channel().close();<br>                                            <span class="hljs-keyword">return</span>;<br>                                    &#125;<br>                                &#125;<br>                            &#125;, <span class="hljs-string">&quot;system in&quot;</span>).start();<br>                        &#125;<br>                    &#125;);<br>                &#125;<br>            &#125;);<br>            Channel channel = bootstrap.connect(<span class="hljs-string">&quot;localhost&quot;</span>, <span class="hljs-number">8080</span>).sync().channel();<br>            channel.closeFuture().sync();<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            log.error(<span class="hljs-string">&quot;client error&quot;</span>, e);<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            group.shutdownGracefully();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="3-3-èŠå¤©å®¤ä¸šåŠ¡-å•èŠ"><a href="#3-3-èŠå¤©å®¤ä¸šåŠ¡-å•èŠ" class="headerlink" title="3.3 èŠå¤©å®¤ä¸šåŠ¡-å•èŠ"></a>3.3 èŠå¤©å®¤ä¸šåŠ¡-å•èŠ</h3><p>æœåŠ¡å™¨ç«¯å°† handler ç‹¬ç«‹å‡ºæ¥</p><p>ç™»å½• handler</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@ChannelHandler</span>.Sharable<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LoginRequestMessageHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">SimpleChannelInboundHandler</span>&lt;<span class="hljs-title">LoginRequestMessage</span>&gt; </span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">channelRead0</span><span class="hljs-params">(ChannelHandlerContext ctx, LoginRequestMessage msg)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        String username = msg.getUsername();<br>        String password = msg.getPassword();<br>        <span class="hljs-keyword">boolean</span> login = UserServiceFactory.getUserService().login(username, password);<br>        LoginResponseMessage message;<br>        <span class="hljs-keyword">if</span>(login) &#123;<br>            SessionFactory.getSession().bind(ctx.channel(), username);<br>            message = <span class="hljs-keyword">new</span> LoginResponseMessage(<span class="hljs-keyword">true</span>, <span class="hljs-string">&quot;ç™»å½•æˆåŠŸ&quot;</span>);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            message = <span class="hljs-keyword">new</span> LoginResponseMessage(<span class="hljs-keyword">false</span>, <span class="hljs-string">&quot;ç”¨æˆ·åæˆ–å¯†ç ä¸æ­£ç¡®&quot;</span>);<br>        &#125;<br>        ctx.writeAndFlush(message);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å•èŠ handler</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@ChannelHandler</span>.Sharable<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ChatRequestMessageHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">SimpleChannelInboundHandler</span>&lt;<span class="hljs-title">ChatRequestMessage</span>&gt; </span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">channelRead0</span><span class="hljs-params">(ChannelHandlerContext ctx, ChatRequestMessage msg)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        String to = msg.getTo();<br>        Channel channel = SessionFactory.getSession().getChannel(to);<br>        <span class="hljs-comment">// åœ¨çº¿</span><br>        <span class="hljs-keyword">if</span>(channel != <span class="hljs-keyword">null</span>) &#123;<br>            channel.writeAndFlush(<span class="hljs-keyword">new</span> ChatResponseMessage(msg.getFrom(), msg.getContent()));<br>        &#125;<br>        <span class="hljs-comment">// ä¸åœ¨çº¿</span><br>        <span class="hljs-keyword">else</span> &#123;<br>            ctx.writeAndFlush(<span class="hljs-keyword">new</span> ChatResponseMessage(<span class="hljs-keyword">false</span>, <span class="hljs-string">&quot;å¯¹æ–¹ç”¨æˆ·ä¸å­˜åœ¨æˆ–è€…ä¸åœ¨çº¿&quot;</span>));<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="3-4-èŠå¤©å®¤ä¸šåŠ¡-ç¾¤èŠ"><a href="#3-4-èŠå¤©å®¤ä¸šåŠ¡-ç¾¤èŠ" class="headerlink" title="3.4 èŠå¤©å®¤ä¸šåŠ¡-ç¾¤èŠ"></a>3.4 èŠå¤©å®¤ä¸šåŠ¡-ç¾¤èŠ</h3><p>åˆ›å»ºç¾¤èŠ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@ChannelHandler</span>.Sharable<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GroupCreateRequestMessageHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">SimpleChannelInboundHandler</span>&lt;<span class="hljs-title">GroupCreateRequestMessage</span>&gt; </span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">channelRead0</span><span class="hljs-params">(ChannelHandlerContext ctx, GroupCreateRequestMessage msg)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        String groupName = msg.getGroupName();<br>        Set&lt;String&gt; members = msg.getMembers();<br>        <span class="hljs-comment">// ç¾¤ç®¡ç†å™¨</span><br>        GroupSession groupSession = GroupSessionFactory.getGroupSession();<br>        Group group = groupSession.createGroup(groupName, members);<br>        <span class="hljs-keyword">if</span> (group == <span class="hljs-keyword">null</span>) &#123;<br>            <span class="hljs-comment">// å‘ç”ŸæˆåŠŸæ¶ˆæ¯</span><br>            ctx.writeAndFlush(<span class="hljs-keyword">new</span> GroupCreateResponseMessage(<span class="hljs-keyword">true</span>, groupName + <span class="hljs-string">&quot;åˆ›å»ºæˆåŠŸ&quot;</span>));<br>            <span class="hljs-comment">// å‘é€æ‹‰ç¾¤æ¶ˆæ¯</span><br>            List&lt;Channel&gt; channels = groupSession.getMembersChannel(groupName);<br>            <span class="hljs-keyword">for</span> (Channel channel : channels) &#123;<br>                channel.writeAndFlush(<span class="hljs-keyword">new</span> GroupCreateResponseMessage(<span class="hljs-keyword">true</span>, <span class="hljs-string">&quot;æ‚¨å·²è¢«æ‹‰å…¥&quot;</span> + groupName));<br>            &#125;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            ctx.writeAndFlush(<span class="hljs-keyword">new</span> GroupCreateResponseMessage(<span class="hljs-keyword">false</span>, groupName + <span class="hljs-string">&quot;å·²ç»å­˜åœ¨&quot;</span>));<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç¾¤èŠ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@ChannelHandler</span>.Sharable<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GroupChatRequestMessageHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">SimpleChannelInboundHandler</span>&lt;<span class="hljs-title">GroupChatRequestMessage</span>&gt; </span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">channelRead0</span><span class="hljs-params">(ChannelHandlerContext ctx, GroupChatRequestMessage msg)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        List&lt;Channel&gt; channels = GroupSessionFactory.getGroupSession()<br>                .getMembersChannel(msg.getGroupName());<br><br>        <span class="hljs-keyword">for</span> (Channel channel : channels) &#123;<br>            channel.writeAndFlush(<span class="hljs-keyword">new</span> GroupChatResponseMessage(msg.getFrom(), msg.getContent()));<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åŠ å…¥ç¾¤èŠ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@ChannelHandler</span>.Sharable<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GroupJoinRequestMessageHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">SimpleChannelInboundHandler</span>&lt;<span class="hljs-title">GroupJoinRequestMessage</span>&gt; </span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">channelRead0</span><span class="hljs-params">(ChannelHandlerContext ctx, GroupJoinRequestMessage msg)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        Group group = GroupSessionFactory.getGroupSession().joinMember(msg.getGroupName(), msg.getUsername());<br>        <span class="hljs-keyword">if</span> (group != <span class="hljs-keyword">null</span>) &#123;<br>            ctx.writeAndFlush(<span class="hljs-keyword">new</span> GroupJoinResponseMessage(<span class="hljs-keyword">true</span>, msg.getGroupName() + <span class="hljs-string">&quot;ç¾¤åŠ å…¥æˆåŠŸ&quot;</span>));<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            ctx.writeAndFlush(<span class="hljs-keyword">new</span> GroupJoinResponseMessage(<span class="hljs-keyword">true</span>, msg.getGroupName() + <span class="hljs-string">&quot;ç¾¤ä¸å­˜åœ¨&quot;</span>));<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>é€€å‡ºç¾¤èŠ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@ChannelHandler</span>.Sharable<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GroupQuitRequestMessageHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">SimpleChannelInboundHandler</span>&lt;<span class="hljs-title">GroupQuitRequestMessage</span>&gt; </span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">channelRead0</span><span class="hljs-params">(ChannelHandlerContext ctx, GroupQuitRequestMessage msg)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        Group group = GroupSessionFactory.getGroupSession().removeMember(msg.getGroupName(), msg.getUsername());<br>        <span class="hljs-keyword">if</span> (group != <span class="hljs-keyword">null</span>) &#123;<br>            ctx.writeAndFlush(<span class="hljs-keyword">new</span> GroupJoinResponseMessage(<span class="hljs-keyword">true</span>, <span class="hljs-string">&quot;å·²é€€å‡ºç¾¤&quot;</span> + msg.getGroupName()));<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            ctx.writeAndFlush(<span class="hljs-keyword">new</span> GroupJoinResponseMessage(<span class="hljs-keyword">true</span>, msg.getGroupName() + <span class="hljs-string">&quot;ç¾¤ä¸å­˜åœ¨&quot;</span>));<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æŸ¥çœ‹æˆå‘˜</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@ChannelHandler</span>.Sharable<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GroupMembersRequestMessageHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">SimpleChannelInboundHandler</span>&lt;<span class="hljs-title">GroupMembersRequestMessage</span>&gt; </span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">channelRead0</span><span class="hljs-params">(ChannelHandlerContext ctx, GroupMembersRequestMessage msg)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        Set&lt;String&gt; members = GroupSessionFactory.getGroupSession()<br>                .getMembers(msg.getGroupName());<br>        ctx.writeAndFlush(<span class="hljs-keyword">new</span> GroupMembersResponseMessage(members));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="3-5-èŠå¤©å®¤ä¸šåŠ¡-é€€å‡º"><a href="#3-5-èŠå¤©å®¤ä¸šåŠ¡-é€€å‡º" class="headerlink" title="3.5 èŠå¤©å®¤ä¸šåŠ¡-é€€å‡º"></a>3.5 èŠå¤©å®¤ä¸šåŠ¡-é€€å‡º</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@ChannelHandler</span>.Sharable<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">QuitHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ChannelInboundHandlerAdapter</span> </span>&#123;<br><br>    <span class="hljs-comment">// å½“è¿æ¥æ–­å¼€æ—¶è§¦å‘ inactive äº‹ä»¶</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">channelInactive</span><span class="hljs-params">(ChannelHandlerContext ctx)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        SessionFactory.getSession().unbind(ctx.channel());<br>        log.debug(<span class="hljs-string">&quot;&#123;&#125; å·²ç»æ–­å¼€&quot;</span>, ctx.channel());<br>    &#125;<br><br><span class="hljs-comment">// å½“å‡ºç°å¼‚å¸¸æ—¶è§¦å‘</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">exceptionCaught</span><span class="hljs-params">(ChannelHandlerContext ctx, Throwable cause)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        SessionFactory.getSession().unbind(ctx.channel());<br>        log.debug(<span class="hljs-string">&quot;&#123;&#125; å·²ç»å¼‚å¸¸æ–­å¼€ å¼‚å¸¸æ˜¯&#123;&#125;&quot;</span>, ctx.channel(), cause.getMessage());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="3-6-èŠå¤©å®¤ä¸šåŠ¡-ç©ºé—²æ£€æµ‹"><a href="#3-6-èŠå¤©å®¤ä¸šåŠ¡-ç©ºé—²æ£€æµ‹" class="headerlink" title="3.6 èŠå¤©å®¤ä¸šåŠ¡-ç©ºé—²æ£€æµ‹"></a>3.6 èŠå¤©å®¤ä¸šåŠ¡-ç©ºé—²æ£€æµ‹</h3><h4 id="è¿æ¥å‡æ­»"><a href="#è¿æ¥å‡æ­»" class="headerlink" title="è¿æ¥å‡æ­»"></a>è¿æ¥å‡æ­»</h4><p>åŸå› </p><ul><li>ç½‘ç»œè®¾å¤‡å‡ºç°æ•…éšœï¼Œä¾‹å¦‚ç½‘å¡ï¼Œæœºæˆ¿ç­‰ï¼Œåº•å±‚çš„ TCP è¿æ¥å·²ç»æ–­å¼€äº†ï¼Œä½†åº”ç”¨ç¨‹åºæ²¡æœ‰æ„ŸçŸ¥åˆ°ï¼Œä»ç„¶å ç”¨ç€èµ„æºã€‚</li><li>å…¬ç½‘ç½‘ç»œä¸ç¨³å®šï¼Œå‡ºç°ä¸¢åŒ…ã€‚å¦‚æœè¿ç»­å‡ºç°ä¸¢åŒ…ï¼Œè¿™æ—¶ç°è±¡å°±æ˜¯å®¢æˆ·ç«¯æ•°æ®å‘ä¸å‡ºå»ï¼ŒæœåŠ¡ç«¯ä¹Ÿä¸€ç›´æ”¶ä¸åˆ°æ•°æ®ï¼Œå°±è¿™ä¹ˆä¸€ç›´è€—ç€</li><li>åº”ç”¨ç¨‹åºçº¿ç¨‹é˜»å¡ï¼Œæ— æ³•è¿›è¡Œæ•°æ®è¯»å†™</li></ul><p>é—®é¢˜</p><ul><li>å‡æ­»çš„è¿æ¥å ç”¨çš„èµ„æºä¸èƒ½è‡ªåŠ¨é‡Šæ”¾</li><li>å‘å‡æ­»çš„è¿æ¥å‘é€æ•°æ®ï¼Œå¾—åˆ°çš„åé¦ˆæ˜¯å‘é€è¶…æ—¶</li></ul><p>æœåŠ¡å™¨ç«¯è§£å†³</p><ul><li>æ€ä¹ˆåˆ¤æ–­å®¢æˆ·ç«¯è¿æ¥æ˜¯å¦å‡æ­»å‘¢ï¼Ÿå¦‚æœèƒ½æ”¶åˆ°å®¢æˆ·ç«¯æ•°æ®ï¼Œè¯´æ˜æ²¡æœ‰å‡æ­»ã€‚å› æ­¤ç­–ç•¥å°±å¯ä»¥å®šä¸ºï¼Œæ¯éš”ä¸€æ®µæ—¶é—´å°±æ£€æŸ¥è¿™æ®µæ—¶é—´å†…æ˜¯å¦æ¥æ”¶åˆ°å®¢æˆ·ç«¯æ•°æ®ï¼Œæ²¡æœ‰å°±å¯ä»¥åˆ¤å®šä¸ºè¿æ¥å‡æ­»</li></ul><h5 id="IdleStateHandlerç©ºé—²çŠ¶æ€å¤„ç†å™¨"><a href="#IdleStateHandlerç©ºé—²çŠ¶æ€å¤„ç†å™¨" class="headerlink" title="IdleStateHandlerç©ºé—²çŠ¶æ€å¤„ç†å™¨"></a><code>IdleStateHandler</code>ç©ºé—²çŠ¶æ€å¤„ç†å™¨</h5><p>ç”¨æ¥åˆ¤æ–­æ˜¯ä¸æ˜¯ è¯»ç©ºé—²æ—¶é—´è¿‡é•¿ï¼Œæˆ– å†™ç©ºé—²æ—¶é—´è¿‡é•¿ã€‚æ ¹æ®<code>IdleStateHandler</code>çš„æ„é€ å™¨æ¥æŒ‡å®šæ£€æµ‹è¯»æˆ–è€…å†™äº‹ä»¶æ˜¯å¦ç©ºé—²æ—¶é—´è¿‡é•¿ã€‚</p><p><code>IdleStateHandler</code>æ„é€ å™¨çš„ä¸‰ä¸ªå‚æ•°å¦‚ä¸‹ï¼š</p><table><thead><tr><th>Property</th><th><strong>Meaning</strong></th></tr></thead><tbody><tr><td>readerIdleTime</td><td>an [<code>IdleStateEvent</code>](dfile:///Users/jiayonggang/Library/Application Support/Dash/User Contributed/Netty/Netty5.docset/Contents/Resources/Documents/io/netty/handler/timeout/IdleStateEvent.html) whose state is [<code>IdleState.READER_IDLE</code>](dfile:///Users/jiayonggang/Library/Application Support/Dash/User Contributed/Netty/Netty5.docset/Contents/Resources/Documents/io/netty/handler/timeout/IdleState.html#READER_IDLE) will be triggered when no read was performed for the specified period of time. Specify <code>0</code> to disable.</td></tr><tr><td>writerIdleTime</td><td>an [<code>IdleStateEvent</code>](dfile:///Users/jiayonggang/Library/Application Support/Dash/User Contributed/Netty/Netty5.docset/Contents/Resources/Documents/io/netty/handler/timeout/IdleStateEvent.html) whose state is [<code>IdleState.WRITER_IDLE</code>](dfile:///Users/jiayonggang/Library/Application Support/Dash/User Contributed/Netty/Netty5.docset/Contents/Resources/Documents/io/netty/handler/timeout/IdleState.html#WRITER_IDLE) will be triggered when no write was performed for the specified period of time. Specify <code>0</code> to disable.</td></tr><tr><td>allIdleTime</td><td>an [<code>IdleStateEvent</code>](dfile:///Users/jiayonggang/Library/Application Support/Dash/User Contributed/Netty/Netty5.docset/Contents/Resources/Documents/io/netty/handler/timeout/IdleStateEvent.html) whose state is [<code>IdleState.ALL_IDLE</code>](dfile:///Users/jiayonggang/Library/Application Support/Dash/User Contributed/Netty/Netty5.docset/Contents/Resources/Documents/io/netty/handler/timeout/IdleState.html#ALL_IDLE) will be triggered when neither read nor write was performed for the specified period of time. Specify <code>0</code> to disable.</td></tr></tbody></table><h5 id="ChannelDuplexHandleråŒå·¥å¤„ç†å™¨"><a href="#ChannelDuplexHandleråŒå·¥å¤„ç†å™¨" class="headerlink" title="ChannelDuplexHandleråŒå·¥å¤„ç†å™¨"></a><code>ChannelDuplexHandler</code>åŒå·¥å¤„ç†å™¨</h5><p><code>ChannelDuplexHandler</code>åŒå·¥å¤„ç†å™¨å¯ä»¥åŒæ—¶ä½œä¸ºå…¥ç«™å’Œå‡ºç«™å¤„ç†å™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// ç”¨æ¥åˆ¤æ–­æ˜¯ä¸æ˜¯ è¯»ç©ºé—²æ—¶é—´è¿‡é•¿ï¼Œæˆ– å†™ç©ºé—²æ—¶é—´è¿‡é•¿</span><br><span class="hljs-comment">// 5s å†…å¦‚æœæ²¡æœ‰æ”¶åˆ° channel çš„æ•°æ®ï¼Œä¼šè§¦å‘ä¸€ä¸ª IdleState#READER_IDLE äº‹ä»¶</span><br>ch.pipeline().addLast(<span class="hljs-keyword">new</span> IdleStateHandler(<span class="hljs-number">5</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>));<br><span class="hljs-comment">// ChannelDuplexHandler å¯ä»¥åŒæ—¶ä½œä¸ºå…¥ç«™å’Œå‡ºç«™å¤„ç†å™¨</span><br>ch.pipeline().addLast(<span class="hljs-keyword">new</span> ChannelDuplexHandler() &#123;<br>    <span class="hljs-comment">// ç”¨æ¥è§¦å‘ç‰¹æ®Šäº‹ä»¶</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">userEventTriggered</span><span class="hljs-params">(ChannelHandlerContext ctx, Object evt)</span> <span class="hljs-keyword">throws</span> Exception</span>&#123;<br>        IdleStateEvent event = (IdleStateEvent) evt;<br>        <span class="hljs-comment">// è§¦å‘äº†è¯»ç©ºé—²äº‹ä»¶</span><br>        <span class="hljs-keyword">if</span> (event.state() == IdleState.READER_IDLE) &#123;<br>            log.debug(<span class="hljs-string">&quot;å·²ç» 5s æ²¡æœ‰è¯»åˆ°æ•°æ®äº†&quot;</span>);<br>            ctx.channel().close();<br>        &#125;<br>    &#125;<br>&#125;);<br></code></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯å®šæ—¶å¿ƒè·³</p><ul><li>å®¢æˆ·ç«¯å¯ä»¥å®šæ—¶å‘æœåŠ¡å™¨ç«¯å‘é€æ•°æ®ï¼Œåªè¦è¿™ä¸ªæ—¶é—´é—´éš”å°äºæœåŠ¡å™¨å®šä¹‰çš„ç©ºé—²æ£€æµ‹çš„æ—¶é—´é—´éš”ï¼Œé‚£ä¹ˆå°±èƒ½é˜²æ­¢å‰é¢æåˆ°çš„è¯¯åˆ¤ï¼Œå®¢æˆ·ç«¯å¯ä»¥å®šä¹‰å¦‚ä¸‹å¿ƒè·³å¤„ç†å™¨</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// ç”¨æ¥åˆ¤æ–­æ˜¯ä¸æ˜¯ è¯»ç©ºé—²æ—¶é—´è¿‡é•¿ï¼Œæˆ– å†™ç©ºé—²æ—¶é—´è¿‡é•¿</span><br><span class="hljs-comment">// 3s å†…å¦‚æœæ²¡æœ‰å‘æœåŠ¡å™¨å†™æ•°æ®ï¼Œä¼šè§¦å‘ä¸€ä¸ª IdleState#WRITER_IDLE äº‹ä»¶</span><br>ch.pipeline().addLast(<span class="hljs-keyword">new</span> IdleStateHandler(<span class="hljs-number">0</span>, <span class="hljs-number">3</span>, <span class="hljs-number">0</span>));<br><span class="hljs-comment">// ChannelDuplexHandler å¯ä»¥åŒæ—¶ä½œä¸ºå…¥ç«™å’Œå‡ºç«™å¤„ç†å™¨</span><br>ch.pipeline().addLast(<span class="hljs-keyword">new</span> ChannelDuplexHandler() &#123;<br>    <span class="hljs-comment">// ç”¨æ¥è§¦å‘ç‰¹æ®Šäº‹ä»¶</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">userEventTriggered</span><span class="hljs-params">(ChannelHandlerContext ctx, Object evt)</span> <span class="hljs-keyword">throws</span> Exception</span>&#123;<br>        IdleStateEvent event = (IdleStateEvent) evt;<br>        <span class="hljs-comment">// è§¦å‘äº†å†™ç©ºé—²äº‹ä»¶</span><br>        <span class="hljs-keyword">if</span> (event.state() == IdleState.WRITER_IDLE) &#123;<br>            <span class="hljs-comment">//log.debug(&quot;3s æ²¡æœ‰å†™æ•°æ®äº†ï¼Œå‘é€ä¸€ä¸ªå¿ƒè·³åŒ…&quot;);</span><br>            ctx.writeAndFlush(<span class="hljs-keyword">new</span> PingMessage());<br>        &#125;<br>    &#125;<br>&#125;);<br></code></pre></td></tr></table></figure><h1 id="å››-ä¼˜åŒ–ä¸æºç "><a href="#å››-ä¼˜åŒ–ä¸æºç " class="headerlink" title="å››. ä¼˜åŒ–ä¸æºç "></a>å››. ä¼˜åŒ–ä¸æºç </h1><h2 id="1-ä¼˜åŒ–"><a href="#1-ä¼˜åŒ–" class="headerlink" title="1. ä¼˜åŒ–"></a>1. ä¼˜åŒ–</h2><h3 id="1-1-æ‰©å±•åºåˆ—åŒ–ç®—æ³•"><a href="#1-1-æ‰©å±•åºåˆ—åŒ–ç®—æ³•" class="headerlink" title="1.1 æ‰©å±•åºåˆ—åŒ–ç®—æ³•"></a>1.1 æ‰©å±•åºåˆ—åŒ–ç®—æ³•</h3><p>åºåˆ—åŒ–ï¼Œååºåˆ—åŒ–ä¸»è¦ç”¨åœ¨æ¶ˆæ¯æ­£æ–‡çš„è½¬æ¢ä¸Š</p><ul><li>åºåˆ—åŒ–æ—¶ï¼Œéœ€è¦å°† Java å¯¹è±¡å˜ä¸ºè¦ä¼ è¾“çš„æ•°æ®ï¼ˆå¯ä»¥æ˜¯ byte[]ï¼Œæˆ– json ç­‰ï¼Œæœ€ç»ˆéƒ½éœ€è¦å˜æˆ byte[]ï¼‰</li><li>ååºåˆ—åŒ–æ—¶ï¼Œéœ€è¦å°†ä¼ å…¥çš„æ­£æ–‡æ•°æ®è¿˜åŸæˆ Java å¯¹è±¡ï¼Œä¾¿äºå¤„ç†</li></ul><p>ç›®å‰çš„ä»£ç ä»…æ”¯æŒ Java è‡ªå¸¦çš„åºåˆ—åŒ–ï¼Œååºåˆ—åŒ–æœºåˆ¶ï¼Œæ ¸å¿ƒä»£ç å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// ååºåˆ—åŒ–</span><br><span class="hljs-keyword">byte</span>[] body = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[bodyLength];<br>byteByf.readBytes(body);<br>ObjectInputStream in = <span class="hljs-keyword">new</span> ObjectInputStream(<span class="hljs-keyword">new</span> ByteArrayInputStream(body));<br>Message message = (Message) in.readObject();<br>message.setSequenceId(sequenceId);<br><br><span class="hljs-comment">// åºåˆ—åŒ–</span><br>ByteArrayOutputStream out = <span class="hljs-keyword">new</span> ByteArrayOutputStream();<br><span class="hljs-keyword">new</span> ObjectOutputStream(out).writeObject(message);<br><span class="hljs-keyword">byte</span>[] bytes = out.toByteArray();<br></code></pre></td></tr></table></figure><p>ä¸ºäº†æ”¯æŒæ›´å¤šåºåˆ—åŒ–ç®—æ³•ï¼ŒæŠ½è±¡ä¸€ä¸ª Serializer æ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Serializer</span> </span>&#123;<br><br>    <span class="hljs-comment">// ååºåˆ—åŒ–æ–¹æ³•</span><br>    &lt;T&gt; <span class="hljs-function">T <span class="hljs-title">deserialize</span><span class="hljs-params">(Class&lt;T&gt; clazz, <span class="hljs-keyword">byte</span>[] bytes)</span></span>;<br><br>    <span class="hljs-comment">// åºåˆ—åŒ–æ–¹æ³•</span><br>    &lt;T&gt; <span class="hljs-keyword">byte</span>[] serialize(T object);<br><br>&#125;<br></code></pre></td></tr></table></figure><p>æä¾›ä¸¤ä¸ªå®ç°ï¼Œæˆ‘è¿™é‡Œç›´æ¥å°†å®ç°åŠ å…¥äº†æšä¸¾ç±» Serializer.Algorithm ä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">SerializerAlgorithm</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Serializer</span> </span>&#123;<br><span class="hljs-comment">// Java å®ç°</span><br>    Java &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> &lt;T&gt; <span class="hljs-function">T <span class="hljs-title">deserialize</span><span class="hljs-params">(Class&lt;T&gt; clazz, <span class="hljs-keyword">byte</span>[] bytes)</span> </span>&#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                ObjectInputStream in = <br>                    <span class="hljs-keyword">new</span> ObjectInputStream(<span class="hljs-keyword">new</span> ByteArrayInputStream(bytes));<br>                Object object = in.readObject();<br>                <span class="hljs-keyword">return</span> (T) object;<br>            &#125; <span class="hljs-keyword">catch</span> (IOException | ClassNotFoundException e) &#123;<br>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">&quot;SerializerAlgorithm.Java ååºåˆ—åŒ–é”™è¯¯&quot;</span>, e);<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> &lt;T&gt; <span class="hljs-keyword">byte</span>[] serialize(T object) &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                ByteArrayOutputStream out = <span class="hljs-keyword">new</span> ByteArrayOutputStream();<br>                <span class="hljs-keyword">new</span> ObjectOutputStream(out).writeObject(object);<br>                <span class="hljs-keyword">return</span> out.toByteArray();<br>            &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">&quot;SerializerAlgorithm.Java åºåˆ—åŒ–é”™è¯¯&quot;</span>, e);<br>            &#125;<br>        &#125;<br>    &#125;, <br>    <span class="hljs-comment">// Json å®ç°(å¼•å…¥äº† Gson ä¾èµ–)</span><br>    Json &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> &lt;T&gt; <span class="hljs-function">T <span class="hljs-title">deserialize</span><span class="hljs-params">(Class&lt;T&gt; clazz, <span class="hljs-keyword">byte</span>[] bytes)</span> </span>&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Gson().fromJson(<span class="hljs-keyword">new</span> String(bytes, StandardCharsets.UTF_8), clazz);<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> &lt;T&gt; <span class="hljs-keyword">byte</span>[] serialize(T object) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Gson().toJson(object).getBytes(StandardCharsets.UTF_8);<br>        &#125;<br>    &#125;;<br><br>    <span class="hljs-comment">// éœ€è¦ä»åè®®çš„å­—èŠ‚ä¸­å¾—åˆ°æ˜¯å“ªç§åºåˆ—åŒ–ç®—æ³•</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SerializerAlgorithm <span class="hljs-title">getByInt</span><span class="hljs-params">(<span class="hljs-keyword">int</span> type)</span> </span>&#123;<br>        SerializerAlgorithm[] array = SerializerAlgorithm.values();<br>        <span class="hljs-keyword">if</span> (type &lt; <span class="hljs-number">0</span> || type &gt; array.length - <span class="hljs-number">1</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalArgumentException(<span class="hljs-string">&quot;è¶…è¿‡ SerializerAlgorithm èŒƒå›´&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">return</span> array[type];<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¢åŠ é…ç½®ç±»å’Œé…ç½®æ–‡ä»¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Config</span> </span>&#123;<br>    <span class="hljs-keyword">static</span> Properties properties;<br>    <span class="hljs-keyword">static</span> &#123;<br>        <span class="hljs-keyword">try</span> (InputStream in = Config.class.getResourceAsStream(<span class="hljs-string">&quot;/application.properties&quot;</span>)) &#123;<br>            properties = <span class="hljs-keyword">new</span> Properties();<br>            properties.load(in);<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ExceptionInInitializerError(e);<br>        &#125;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getServerPort</span><span class="hljs-params">()</span> </span>&#123;<br>        String value = properties.getProperty(<span class="hljs-string">&quot;server.port&quot;</span>);<br>        <span class="hljs-keyword">if</span>(value == <span class="hljs-keyword">null</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">8080</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">return</span> Integer.parseInt(value);<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Serializer.<span class="hljs-function">Algorithm <span class="hljs-title">getSerializerAlgorithm</span><span class="hljs-params">()</span> </span>&#123;<br>        String value = properties.getProperty(<span class="hljs-string">&quot;serializer.algorithm&quot;</span>);<br>        <span class="hljs-keyword">if</span>(value == <span class="hljs-keyword">null</span>) &#123;<br>            <span class="hljs-keyword">return</span> Serializer.Algorithm.Java;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">return</span> Serializer.Algorithm.valueOf(value);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>é…ç½®æ–‡ä»¶</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-meta">serializer.algorithm</span>=<span class="hljs-string">Json</span><br></code></pre></td></tr></table></figure><p>ä¿®æ”¹ç¼–è§£ç å™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å¿…é¡»å’Œ LengthFieldBasedFrameDecoder ä¸€èµ·ä½¿ç”¨ï¼Œç¡®ä¿æ¥åˆ°çš„ ByteBuf æ¶ˆæ¯æ˜¯å®Œæ•´çš„</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MessageCodecSharable</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">MessageToMessageCodec</span>&lt;<span class="hljs-title">ByteBuf</span>, <span class="hljs-title">Message</span>&gt; </span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">encode</span><span class="hljs-params">(ChannelHandlerContext ctx, Message msg, List&lt;Object&gt; outList)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        ByteBuf out = ctx.alloc().buffer();<br>        <span class="hljs-comment">// 1. 4 å­—èŠ‚çš„é­”æ•°</span><br>        out.writeBytes(<span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[]&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>&#125;);<br>        <span class="hljs-comment">// 2. 1 å­—èŠ‚çš„ç‰ˆæœ¬,</span><br>        out.writeByte(<span class="hljs-number">1</span>);<br>        <span class="hljs-comment">// 3. 1 å­—èŠ‚çš„åºåˆ—åŒ–æ–¹å¼ jdk 0 , json 1</span><br>        out.writeByte(Config.getSerializerAlgorithm().ordinal());<br>        <span class="hljs-comment">// 4. 1 å­—èŠ‚çš„æŒ‡ä»¤ç±»å‹</span><br>        out.writeByte(msg.getMessageType());<br>        <span class="hljs-comment">// 5. 4 ä¸ªå­—èŠ‚</span><br>        out.writeInt(msg.getSequenceId());<br>        <span class="hljs-comment">// æ— æ„ä¹‰ï¼Œå¯¹é½å¡«å……</span><br>        out.writeByte(<span class="hljs-number">0xff</span>);<br>        <span class="hljs-comment">// 6. è·å–å†…å®¹çš„å­—èŠ‚æ•°ç»„</span><br>        <span class="hljs-keyword">byte</span>[] bytes = Config.getSerializerAlgorithm().serialize(msg);<br>        <span class="hljs-comment">// 7. é•¿åº¦</span><br>        out.writeInt(bytes.length);<br>        <span class="hljs-comment">// 8. å†™å…¥å†…å®¹</span><br>        out.writeBytes(bytes);<br>        outList.add(out);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">decode</span><span class="hljs-params">(ChannelHandlerContext ctx, ByteBuf in, List&lt;Object&gt; out)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        <span class="hljs-keyword">int</span> magicNum = in.readInt();<br>        <span class="hljs-keyword">byte</span> version = in.readByte();<br>        <span class="hljs-keyword">byte</span> serializerAlgorithm = in.readByte(); <span class="hljs-comment">// 0 æˆ– 1</span><br>        <span class="hljs-keyword">byte</span> messageType = in.readByte(); <span class="hljs-comment">// 0,1,2...</span><br>        <span class="hljs-keyword">int</span> sequenceId = in.readInt();<br>        in.readByte();<br>        <span class="hljs-keyword">int</span> length = in.readInt();<br>        <span class="hljs-keyword">byte</span>[] bytes = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[length];<br>        in.readBytes(bytes, <span class="hljs-number">0</span>, length);<br><br>        <span class="hljs-comment">// æ‰¾åˆ°ååºåˆ—åŒ–ç®—æ³•</span><br>        Serializer.Algorithm algorithm = Serializer.Algorithm.values()[serializerAlgorithm];<br>        <span class="hljs-comment">// ç¡®å®šå…·ä½“æ¶ˆæ¯ç±»å‹</span><br>        Class&lt;? extends Message&gt; messageClass = Message.getMessageClass(messageType);<br>        Message message = algorithm.deserialize(messageClass, bytes);<br><span class="hljs-comment">//        log.debug(&quot;&#123;&#125;, &#123;&#125;, &#123;&#125;, &#123;&#125;, &#123;&#125;, &#123;&#125;&quot;, magicNum, version, serializerType, messageType, sequenceId, length);</span><br><span class="hljs-comment">//        log.debug(&quot;&#123;&#125;&quot;, message);</span><br>        out.add(message);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å…¶ä¸­ç¡®å®šå…·ä½“æ¶ˆæ¯ç±»å‹ï¼Œå¯ä»¥æ ¹æ® <code>æ¶ˆæ¯ç±»å‹å­—èŠ‚</code> è·å–åˆ°å¯¹åº”çš„ <code>æ¶ˆæ¯ class</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Message</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Serializable</span> </span>&#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ ¹æ®æ¶ˆæ¯ç±»å‹å­—èŠ‚ï¼Œè·å¾—å¯¹åº”çš„æ¶ˆæ¯ class</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> messageType æ¶ˆæ¯ç±»å‹å­—èŠ‚</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> æ¶ˆæ¯ class</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Class&lt;? extends Message&gt; getMessageClass(<span class="hljs-keyword">int</span> messageType) &#123;<br>        <span class="hljs-keyword">return</span> messageClasses.get(messageType);<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> sequenceId;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> messageType;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getMessageType</span><span class="hljs-params">()</span></span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> LoginRequestMessage = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> LoginResponseMessage = <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> ChatRequestMessage = <span class="hljs-number">2</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> ChatResponseMessage = <span class="hljs-number">3</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> GroupCreateRequestMessage = <span class="hljs-number">4</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> GroupCreateResponseMessage = <span class="hljs-number">5</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> GroupJoinRequestMessage = <span class="hljs-number">6</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> GroupJoinResponseMessage = <span class="hljs-number">7</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> GroupQuitRequestMessage = <span class="hljs-number">8</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> GroupQuitResponseMessage = <span class="hljs-number">9</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> GroupChatRequestMessage = <span class="hljs-number">10</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> GroupChatResponseMessage = <span class="hljs-number">11</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> GroupMembersRequestMessage = <span class="hljs-number">12</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> GroupMembersResponseMessage = <span class="hljs-number">13</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> PingMessage = <span class="hljs-number">14</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> PongMessage = <span class="hljs-number">15</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Map&lt;Integer, Class&lt;? extends Message&gt;&gt; messageClasses = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();<br><br>    <span class="hljs-keyword">static</span> &#123;<br>        messageClasses.put(LoginRequestMessage, LoginRequestMessage.class);<br>        messageClasses.put(LoginResponseMessage, LoginResponseMessage.class);<br>        messageClasses.put(ChatRequestMessage, ChatRequestMessage.class);<br>        messageClasses.put(ChatResponseMessage, ChatResponseMessage.class);<br>        messageClasses.put(GroupCreateRequestMessage, GroupCreateRequestMessage.class);<br>        messageClasses.put(GroupCreateResponseMessage, GroupCreateResponseMessage.class);<br>        messageClasses.put(GroupJoinRequestMessage, GroupJoinRequestMessage.class);<br>        messageClasses.put(GroupJoinResponseMessage, GroupJoinResponseMessage.class);<br>        messageClasses.put(GroupQuitRequestMessage, GroupQuitRequestMessage.class);<br>        messageClasses.put(GroupQuitResponseMessage, GroupQuitResponseMessage.class);<br>        messageClasses.put(GroupChatRequestMessage, GroupChatRequestMessage.class);<br>        messageClasses.put(GroupChatResponseMessage, GroupChatResponseMessage.class);<br>        messageClasses.put(GroupMembersRequestMessage, GroupMembersRequestMessage.class);<br>        messageClasses.put(GroupMembersResponseMessage, GroupMembersResponseMessage.class);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="1-2-å‚æ•°è°ƒä¼˜"><a href="#1-2-å‚æ•°è°ƒä¼˜" class="headerlink" title="1.2 å‚æ•°è°ƒä¼˜"></a>1.2 å‚æ•°è°ƒä¼˜</h3><ul><li>æœåŠ¡ç«¯</li></ul><p><code>new ServerBootstrap().option()</code> //æ˜¯ç»™ ServerSocketChannel é…ç½®å‚æ•° </p><p><code>new ServerBootstrap().childOption())</code> //ç»™ SocketChanneté…ç½®å‚æ•°</p><ul><li>å®¢æˆ·ç«¯</li></ul><p><code>new Bootstrap().option()</code>æ–¹æ³•ç»™SocketChannelé…ç½®å‚æ•°</p><h4 id="1ï¼‰CONNECT-TIMEOUT-MILLIS"><a href="#1ï¼‰CONNECT-TIMEOUT-MILLIS" class="headerlink" title="1ï¼‰CONNECT_TIMEOUT_MILLIS"></a>1ï¼‰CONNECT_TIMEOUT_MILLIS</h4><ul><li><p>å±äº SocketChannal å‚æ•°</p></li><li><p>ç”¨åœ¨å®¢æˆ·ç«¯å»ºç«‹è¿æ¥æ—¶ï¼Œå¦‚æœåœ¨æŒ‡å®šæ¯«ç§’å†…æ— æ³•è¿æ¥ï¼Œä¼šæŠ›å‡º timeout å¼‚å¸¸</p></li><li><p>SO_TIMEOUT ä¸»è¦ç”¨åœ¨é˜»å¡ IOï¼Œé˜»å¡ IO ä¸­ acceptï¼Œread ç­‰éƒ½æ˜¯æ— é™ç­‰å¾…çš„ï¼Œå¦‚æœä¸å¸Œæœ›æ°¸è¿œé˜»å¡ï¼Œä½¿ç”¨å®ƒè°ƒæ•´è¶…æ—¶æ—¶é—´</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestConnectionTimeout</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        NioEventLoopGroup group = <span class="hljs-keyword">new</span> NioEventLoopGroup();<br>        <span class="hljs-keyword">try</span> &#123;<br>            Bootstrap bootstrap = <span class="hljs-keyword">new</span> Bootstrap()<br>                    .group(group)<br>                    .option(ChannelOption.CONNECT_TIMEOUT_MILLIS, <span class="hljs-number">300</span>)<br>                    .channel(NioSocketChannel.class)<br>                    .handler(<span class="hljs-keyword">new</span> LoggingHandler());<br>            ChannelFuture future = bootstrap.connect(<span class="hljs-string">&quot;127.0.0.1&quot;</span>, <span class="hljs-number">8080</span>);<br>            future.sync().channel().closeFuture().sync(); <span class="hljs-comment">// æ–­ç‚¹1</span><br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            log.debug(<span class="hljs-string">&quot;timeout&quot;</span>);<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            group.shutdownGracefully();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥æ•…æ„ä¸å¼€æœåŠ¡å™¨ï¼Œä½¿å¾—å®¢æˆ·ç«¯è¿æ¥è¶…æ—¶ã€‚</p><p>å¦å¤–æºç éƒ¨åˆ† <code>io.netty.channel.nio.AbstractNioChannel.AbstractNioUnsafe#connect</code>ã€‚åœ¨NioEventLoopçº¿ç¨‹é‡Œé¢è®¾ç½®å®šæ—¶ä»»åŠ¡ï¼Œå¦‚æœè¿æ¥è¶…æ—¶ï¼Œè¯¥å®šæ—¶ä»»åŠ¡å‘Promiseæäº¤è¿æ¥è¶…æ—¶å¼‚å¸¸ï¼Œä¸»çº¿ç¨‹é€šè¿‡Promiseå¯¹è±¡å¼‚æ­¥æ”¶åˆ°å¼‚å¸¸å¯¹è±¡ï¼Œcatchä½è¯¥å¼‚å¸¸å¯¹è±¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title">connect</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">        <span class="hljs-keyword">final</span> SocketAddress remoteAddress, <span class="hljs-keyword">final</span> SocketAddress localAddress, <span class="hljs-keyword">final</span> ChannelPromise promise)</span> </span>&#123;<br>    <span class="hljs-comment">// ...</span><br>    <span class="hljs-comment">// Schedule connect timeout.</span><br>    <span class="hljs-keyword">int</span> connectTimeoutMillis = config().getConnectTimeoutMillis();<br>    <span class="hljs-keyword">if</span> (connectTimeoutMillis &gt; <span class="hljs-number">0</span>) &#123;<br>        connectTimeoutFuture = eventLoop().schedule(<span class="hljs-keyword">new</span> Runnable() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;                <br>                ChannelPromise connectPromise = AbstractNioChannel.<span class="hljs-keyword">this</span>.connectPromise;<br>                ConnectTimeoutException cause =<br>                    <span class="hljs-keyword">new</span> ConnectTimeoutException(<span class="hljs-string">&quot;connection timed out: &quot;</span> + remoteAddress); <span class="hljs-comment">// æ–­ç‚¹2</span><br>                <span class="hljs-keyword">if</span> (connectPromise != <span class="hljs-keyword">null</span> &amp;&amp; connectPromise.tryFailure(cause)) &#123;<br>                    close(voidPromise());<br>                &#125;<br>            &#125;<br>        &#125;, connectTimeoutMillis, TimeUnit.MILLISECONDS);<br>    &#125;<br><span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure><h4 id="2ï¼‰SO-BACKLOG"><a href="#2ï¼‰SO-BACKLOG" class="headerlink" title="2ï¼‰SO_BACKLOG"></a>2ï¼‰SO_BACKLOG</h4><ul><li>å±äº ServerSocketChannal å‚æ•°</li></ul><pre><code class=" mermaid">sequenceDiagramparticipant c as clientparticipant s as serverparticipant sq as syns queueparticipant aq as accept queues -&gt;&gt; s : bind()s -&gt;&gt; s : listen()c -&gt;&gt; c : connect()c -&gt;&gt; s : 1. SYNNote left of c : SYN_SENDs -&gt;&gt; sq : putNote right of s : SYN_RCVDs -&gt;&gt; c : 2. SYN + ACKNote left of c : ESTABLISHEDc -&gt;&gt; s : 3. ACKsq -&gt;&gt; aq : putNote right of s : ESTABLISHEDaq --&gt;&gt; s : s -&gt;&gt; s : accept()</code></pre><ol><li>ç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼Œclient å‘é€ SYN åˆ° serverï¼ŒçŠ¶æ€ä¿®æ”¹ä¸º SYN_SENDï¼Œserver æ”¶åˆ°ï¼ŒçŠ¶æ€æ”¹å˜ä¸º SYN_REVDï¼Œå¹¶å°†è¯¥è¯·æ±‚æ”¾å…¥ sync queue é˜Ÿåˆ—</li><li>ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼Œserver å›å¤ SYN + ACK ç»™ clientï¼Œclient æ”¶åˆ°ï¼ŒçŠ¶æ€æ”¹å˜ä¸º ESTABLISHEDï¼Œå¹¶å‘é€ ACK ç»™ server</li><li>ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼Œserver æ”¶åˆ° ACKï¼ŒçŠ¶æ€æ”¹å˜ä¸º ESTABLISHEDï¼Œå°†è¯¥è¯·æ±‚ä» sync queue æ”¾å…¥ accept queue</li></ol><p>å…¶ä¸­</p><ul><li><p>åœ¨ linux 2.2 ä¹‹å‰ï¼Œbacklog å¤§å°åŒ…æ‹¬äº†ä¸¤ä¸ªé˜Ÿåˆ—çš„å¤§å°ï¼Œåœ¨ 2.2 ä¹‹åï¼Œåˆ†åˆ«ç”¨ä¸‹é¢ä¸¤ä¸ªå‚æ•°æ¥æ§åˆ¶</p></li><li><p>sync queue - åŠè¿æ¥é˜Ÿåˆ—</p><ul><li>å¤§å°é€šè¿‡ /proc/sys/net/ipv4/tcp_max_syn_backlog æŒ‡å®šï¼Œåœ¨ <code>syncookies</code> å¯ç”¨çš„æƒ…å†µä¸‹ï¼Œé€»è¾‘ä¸Šæ²¡æœ‰æœ€å¤§å€¼é™åˆ¶ï¼Œè¿™ä¸ªè®¾ç½®ä¾¿è¢«å¿½ç•¥</li></ul></li><li><p>accept queue - å…¨è¿æ¥é˜Ÿåˆ—</p><ul><li>å…¶å¤§å°é€šè¿‡ /proc/sys/net/core/somaxconn æŒ‡å®šï¼Œåœ¨ä½¿ç”¨ listen å‡½æ•°æ—¶ï¼Œå†…æ ¸ä¼šæ ¹æ®ä¼ å…¥çš„ backlog å‚æ•°ä¸ç³»ç»Ÿå‚æ•°ï¼Œå–äºŒè€…çš„è¾ƒå°å€¼</li><li>å¦‚æœ accpet queue é˜Ÿåˆ—æ»¡äº†ï¼Œserver å°†å‘é€ä¸€ä¸ªæ‹’ç»è¿æ¥çš„é”™è¯¯ä¿¡æ¯åˆ° client</li></ul></li></ul><ul><li>JDKçš„NIOä¸­</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.nio.channels.ServerSocketChannel;<br><br>ServerSocketChannel open = ServerSocketChannel.open();<br>open.bind(ç«¯å£, backlog);<br></code></pre></td></tr></table></figure><ul><li>netty ä¸­</li></ul><p>å¯ä»¥é€šè¿‡  option(ChannelOption.SO_BACKLOG, å€¼) æ¥è®¾ç½®å¤§å°ï¼Œç”±äºNettyçš„NioEventLoopå¤„ç†è¿æ¥è¯·æ±‚çš„èƒ½åŠ›å¾ˆå¼ºï¼Œaccepté˜Ÿåˆ—ä¸€æœ‰è¯·æ±‚å°±è¢«å¤„ç†äº†ï¼Œæ‰€ä»¥éœ€è¦å°†æ–­ç‚¹è®¾ç½®åˆ°accepté˜Ÿåˆ—å‡ºé˜Ÿé‚£ä¸ªå‡½æ•°ä¸Šï¼Œè®©å…¶é˜»å¡ï¼Œä½¿å¾—accepté˜Ÿåˆ—ä¸€ç›´åªè¿›ä¸å‡ºã€‚</p><p>è¯¾å ‚è°ƒè¯•å…³é”®æ–­ç‚¹ä¸ºï¼š<code>io.netty.channel.nio.NioEventLoop#processSelectedKey</code></p><p>å¯ä»¥é€šè¿‡ä¸‹é¢æºç æŸ¥çœ‹é»˜è®¤å¤§å°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DefaultServerSocketChannelConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">DefaultChannelConfig</span></span><br><span class="hljs-class">                                              <span class="hljs-keyword">implements</span> <span class="hljs-title">ServerSocketChannelConfig</span> </span>&#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-keyword">int</span> backlog = NetUtil.SOMAXCONN;<br>    <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure><p>bio ä¸­æ›´å®¹æ˜“è¯´æ˜ï¼Œä¸ç”¨ debug æ¨¡å¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Server</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>        ServerSocket ss = <span class="hljs-keyword">new</span> ServerSocket(<span class="hljs-number">8888</span>, <span class="hljs-number">2</span>);<br>        Socket accept = ss.accept();<br>        System.out.println(accept);<br>        System.in.read();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯å¯åŠ¨ 4 ä¸ª</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Client</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            Socket s = <span class="hljs-keyword">new</span> Socket();<br>            System.out.println(<span class="hljs-keyword">new</span> Date()+<span class="hljs-string">&quot; connecting...&quot;</span>);<br>            s.connect(<span class="hljs-keyword">new</span> InetSocketAddress(<span class="hljs-string">&quot;localhost&quot;</span>, <span class="hljs-number">8888</span>),<span class="hljs-number">1000</span>);<br>            System.out.println(<span class="hljs-keyword">new</span> Date()+<span class="hljs-string">&quot; connected...&quot;</span>);<br>            s.getOutputStream().write(<span class="hljs-number">1</span>);<br>            System.in.read();<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            System.out.println(<span class="hljs-keyword">new</span> Date()+<span class="hljs-string">&quot; connecting timeout...&quot;</span>);<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç¬¬ 1ï¼Œ2ï¼Œ3 ä¸ªå®¢æˆ·ç«¯éƒ½æ‰“å°ï¼Œä½†é™¤äº†ç¬¬ä¸€ä¸ªå¤„äº accpet å¤–ï¼Œå…¶å®ƒä¸¤ä¸ªéƒ½å¤„äº accept queue ä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">Tue Apr <span class="hljs-number">21</span> <span class="hljs-number">20</span>:<span class="hljs-number">30</span>:<span class="hljs-number">28</span> CST <span class="hljs-number">2020</span> connecting...<br>Tue Apr <span class="hljs-number">21</span> <span class="hljs-number">20</span>:<span class="hljs-number">30</span>:<span class="hljs-number">28</span> CST <span class="hljs-number">2020</span> connected...<br></code></pre></td></tr></table></figure><p>ç¬¬ 4 ä¸ªå®¢æˆ·ç«¯è¿æ¥æ—¶</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">Tue</span> Apr <span class="hljs-number">21</span> <span class="hljs-number">20</span>:<span class="hljs-number">53</span>:<span class="hljs-number">58</span> CST <span class="hljs-number">2020</span> connecting...<br><span class="hljs-attribute">Tue</span> Apr <span class="hljs-number">21</span> <span class="hljs-number">20</span>:<span class="hljs-number">53</span>:<span class="hljs-number">59</span> CST <span class="hljs-number">2020</span> connecting timeout...<br><span class="hljs-attribute">java</span>.net.SocketTimeoutException: connect timed out<br></code></pre></td></tr></table></figure><h4 id="3ï¼‰ulimit-n-Linuxå‘½ä»¤"><a href="#3ï¼‰ulimit-n-Linuxå‘½ä»¤" class="headerlink" title="3ï¼‰ulimit -n    Linuxå‘½ä»¤"></a>3ï¼‰ulimit -n    Linuxå‘½ä»¤</h4><ul><li>å±äºæ“ä½œç³»ç»Ÿå‚æ•°ï¼Œåœ¨LInuxä¸­é™åˆ¶æ¯ä¸ªè¿›ç¨‹æ‰“å¼€çš„æœ€å¤§æ–‡ä»¶æè¿°ç¬¦ï¼ˆFDï¼‰</li></ul><h4 id="4ï¼‰TCP-NODELAY"><a href="#4ï¼‰TCP-NODELAY" class="headerlink" title="4ï¼‰TCP_NODELAY"></a>4ï¼‰TCP_NODELAY</h4><ul><li>å±äº SocketChannal å‚æ•°ï¼ŒNettyé»˜è®¤TCP_NODELAY = falseï¼Œé»˜è®¤æ˜¯å¼€å§‹TCPçš„nagleç®—æ³•çš„ã€‚ä½†æ˜¯è¿™é‡Œå»ºè®®æŠŠTCP_NODELAY  = trueï¼Œå› ä¸ºå¯èƒ½æœ‰ä¸€äº›å°æ•°æ®åŒ…ï¼Œä¸å»ºè®®æ‰“å¼€TCPçš„nagleç®—æ³•ã€‚</li></ul><h4 id="5ï¼‰SO-SNDBUF-amp-SO-RCVBUF"><a href="#5ï¼‰SO-SNDBUF-amp-SO-RCVBUF" class="headerlink" title="5ï¼‰SO_SNDBUF &amp; SO_RCVBUF"></a>5ï¼‰SO_SNDBUF &amp; SO_RCVBUF</h4><ul><li>SO_SNDBUF å±äº SocketChannal å‚æ•°ï¼Œå‘é€ç¼“å†²åŒºã€‚</li><li>SO_RCVBUF æ—¢å¯ç”¨äº SocketChannal å‚æ•°ï¼Œä¹Ÿå¯ä»¥ç”¨äº ServerSocketChannal å‚æ•°ï¼ˆå»ºè®®è®¾ç½®åˆ° ServerSocketChannal ä¸Šï¼‰ï¼Œæ¥æ”¶ç¼“å†²åŒºã€‚</li></ul><p><strong>æ“ä½œç³»ç»Ÿå®ç°çš„TCPæµé‡æ§åˆ¶å’Œæ‹¥å¡æ§åˆ¶æœºåˆ¶ä¼šè‡ªåŠ¨æ§åˆ¶è¿™ä¸¤ä¸ªå‚æ•°ï¼Œæ•…è€Œä¸å»ºè®®ç¨‹åºå‘˜æ‰‹åŠ¨è®¾ç½®è¿™ä¸¤ä¸ªå‚æ•°ã€‚</strong></p><h4 id="6ï¼‰ALLOCATOR"><a href="#6ï¼‰ALLOCATOR" class="headerlink" title="6ï¼‰ALLOCATOR"></a>6ï¼‰ALLOCATOR</h4><ul><li>å±äº SocketChannal å‚æ•°</li><li>ç”¨æ¥åˆ†é… ByteBufï¼Œ ctx.alloc()æ–¹æ³•è¿”å›ALLOCATORåˆ†é…å™¨å¯¹è±¡ï¼Œè¯¥å¯¹è±¡åœ¨è°ƒç”¨buffer()æ–¹æ³•å³å¯åˆ†é…ByteBufå¯¹è±¡ï¼Œåœ¨MacOSä¸‹ï¼Œé»˜è®¤åˆ†é…ç›´æ¥å†…å­˜çš„æ± åŒ–ByteBufå¯¹è±¡ã€‚é€šè¿‡é˜…è¯»æºç å‘ç°åœ¨<code>ByteBufUtil.java</code>ä¸­ä½¿ç”¨ç³»ç»Ÿå˜é‡<code>io.netty.allocator.type</code>å†³å®šåˆ†é…æ± åŒ–è¿˜æ˜¯éæ± åŒ–ByteBufå¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡åœ¨IDEAä¸­å¯¹<code>ByteBufUtil.java</code>çš„è™šæ‹Ÿæœºå‚æ•°å¢åŠ <code>-Dio.netty.allocator.type=unpooled</code>æ¥æŒ‡å®šåˆ†é…æ± åŒ–è¿˜æ˜¯éæ± åŒ–ByteBufå¯¹è±¡ã€‚é€šè¿‡é˜…è¯»æºç å‘ç°åœ¨<code>PlatformDependent.java</code>ä¸­ä½¿ç”¨ç³»ç»Ÿå˜é‡<code>io.netty.noPerferDirect</code>å†³å®šåˆ†é…ç›´æ¥å†…å­˜è¿˜æ˜¯å †å†…å­˜ByteBufå¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡åœ¨IDEAä¸­å¯¹<code>PlatformDependent.java</code>çš„è™šæ‹Ÿæœºå‚æ•°å¢åŠ <code>-Dio.netty.noPerferDirect=true</code>æ¥æŒ‡å®šåˆ†é…ç›´æ¥å†…å­˜è¿˜æ˜¯å †å†…å­˜ByteBufå¯¹è±¡ã€‚</li></ul><h4 id="7ï¼‰RCVBUF-ALLOCATOR"><a href="#7ï¼‰RCVBUF-ALLOCATOR" class="headerlink" title="7ï¼‰RCVBUF_ALLOCATOR"></a>7ï¼‰RCVBUF_ALLOCATOR</h4><ul><li><p>å±äº SocketChannal å‚æ•°</p></li><li><p>æ§åˆ¶ netty æ¥æ”¶ç¼“å†²åŒºå¤§å°</p></li><li><p>è´Ÿè´£å…¥ç«™æ•°æ®çš„åˆ†é…ï¼Œå†³å®šå…¥ç«™ç¼“å†²åŒºçš„å¤§å°ï¼ˆå¹¶å¯åŠ¨æ€è°ƒæ•´ï¼‰ï¼Œç»Ÿä¸€é‡‡ç”¨ direct ç›´æ¥å†…å­˜ï¼ˆ<strong>å› ä¸ºå¯¹äºIOæ“ä½œï¼Œä½¿ç”¨ç›´æ¥å†…å­˜ByteBufå¯ä»¥å‡å°‘æ•°æ®çš„å¤åˆ¶æ¬¡æ•°å·²ç»å†…æ ¸æ€å’Œç”¨æˆ·æ€çš„åˆ‡æ¢æ¬¡æ•°ï¼Œæ‰€ä»¥nettyå¼ºåˆ¶å¯¹äºIOæ“ä½œæ¥æ”¶ç¼“å†²åŒºä½¿ç”¨ç›´æ¥å†…å­˜ByteBuf</strong>ï¼‰ï¼Œå…·ä½“æ± åŒ–è¿˜æ˜¯éæ± åŒ–ç”± ALLOCATOR å†³å®šï¼Œå³é€šè¿‡é˜…è¯»æºç å‘ç°åœ¨<code>ByteBufUtil.java</code>ä¸­ä½¿ç”¨ç³»ç»Ÿå˜é‡<code>io.netty.allocator.type</code>å†³å®šåˆ†é…æ± åŒ–è¿˜æ˜¯éæ± åŒ–ByteBufå¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡åœ¨IDEAä¸­å¯¹<code>ByteBufUtil.java</code>çš„è™šæ‹Ÿæœºå‚æ•°å¢åŠ <code>-Dio.netty.allocator.type=unpooled</code>æ¥æŒ‡å®šåˆ†é…æ± åŒ–è¿˜æ˜¯éæ± åŒ–ByteBufå¯¹è±¡ã€‚</p><p><code>AbstractNioByteChannel.java</code>æºç å¦‚ä¸‹ï¼š</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20230417155338037.png"></p></li></ul><h3 id="1-3-RPC-æ¡†æ¶"><a href="#1-3-RPC-æ¡†æ¶" class="headerlink" title="1.3 RPC æ¡†æ¶"></a>1.3 RPC æ¡†æ¶</h3><h4 id="1ï¼‰å‡†å¤‡å·¥ä½œ"><a href="#1ï¼‰å‡†å¤‡å·¥ä½œ" class="headerlink" title="1ï¼‰å‡†å¤‡å·¥ä½œ"></a>1ï¼‰å‡†å¤‡å·¥ä½œ</h4><p>è¿™äº›ä»£ç å¯ä»¥è®¤ä¸ºæ˜¯ç°æˆçš„ï¼Œæ— éœ€ä»å¤´ç¼–å†™ç»ƒä¹ </p><p>ä¸ºäº†ç®€åŒ–èµ·è§ï¼Œåœ¨åŸæ¥èŠå¤©é¡¹ç›®çš„åŸºç¡€ä¸Šæ–°å¢ Rpc è¯·æ±‚å’Œå“åº”æ¶ˆæ¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Message</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Serializable</span> </span>&#123;<br><br>    <span class="hljs-comment">// çœç•¥æ—§çš„ä»£ç </span><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> RPC_MESSAGE_TYPE_REQUEST = <span class="hljs-number">101</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span>  RPC_MESSAGE_TYPE_RESPONSE = <span class="hljs-number">102</span>;<br><br>    <span class="hljs-keyword">static</span> &#123;<br>        <span class="hljs-comment">// ...</span><br>        messageClasses.put(RPC_MESSAGE_TYPE_REQUEST, RpcRequestMessage.class);<br>        messageClasses.put(RPC_MESSAGE_TYPE_RESPONSE, RpcResponseMessage.class);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>è¯·æ±‚æ¶ˆæ¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Getter</span><br><span class="hljs-meta">@ToString(callSuper = true)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RpcRequestMessage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Message</span> </span>&#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è°ƒç”¨çš„æ¥å£å…¨é™å®šåï¼ŒæœåŠ¡ç«¯æ ¹æ®å®ƒæ‰¾åˆ°å®ç°</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> String interfaceName;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è°ƒç”¨æ¥å£ä¸­çš„æ–¹æ³•å</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> String methodName;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ–¹æ³•è¿”å›ç±»å‹</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> Class&lt;?&gt; returnType;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ–¹æ³•å‚æ•°ç±»å‹æ•°ç»„</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> Class[] parameterTypes;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ–¹æ³•å‚æ•°å€¼æ•°ç»„</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> Object[] parameterValue;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">RpcRequestMessage</span><span class="hljs-params">(<span class="hljs-keyword">int</span> sequenceId, String interfaceName, String methodName, Class&lt;?&gt; returnType, Class[] parameterTypes, Object[] parameterValue)</span> </span>&#123;<br>        <span class="hljs-keyword">super</span>.setSequenceId(sequenceId);<br>        <span class="hljs-keyword">this</span>.interfaceName = interfaceName;<br>        <span class="hljs-keyword">this</span>.methodName = methodName;<br>        <span class="hljs-keyword">this</span>.returnType = returnType;<br>        <span class="hljs-keyword">this</span>.parameterTypes = parameterTypes;<br>        <span class="hljs-keyword">this</span>.parameterValue = parameterValue;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getMessageType</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> RPC_MESSAGE_TYPE_REQUEST;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å“åº”æ¶ˆæ¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@ToString(callSuper = true)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RpcResponseMessage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Message</span> </span>&#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è¿”å›å€¼</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> Object returnValue;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å¼‚å¸¸å€¼</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> Exception exceptionValue;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getMessageType</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> RPC_MESSAGE_TYPE_RESPONSE;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æœåŠ¡å™¨æ¶å­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RpcServer</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        NioEventLoopGroup boss = <span class="hljs-keyword">new</span> NioEventLoopGroup();<br>        NioEventLoopGroup worker = <span class="hljs-keyword">new</span> NioEventLoopGroup();<br>        LoggingHandler LOGGING_HANDLER = <span class="hljs-keyword">new</span> LoggingHandler(LogLevel.DEBUG);<br>        MessageCodecSharable MESSAGE_CODEC = <span class="hljs-keyword">new</span> MessageCodecSharable();<br>        <br>        <span class="hljs-comment">// rpc è¯·æ±‚æ¶ˆæ¯å¤„ç†å™¨ï¼Œå¾…å®ç°</span><br>        RpcRequestMessageHandler RPC_HANDLER = <span class="hljs-keyword">new</span> RpcRequestMessageHandler();<br>        <span class="hljs-keyword">try</span> &#123;<br>            ServerBootstrap serverBootstrap = <span class="hljs-keyword">new</span> ServerBootstrap();<br>            serverBootstrap.channel(NioServerSocketChannel.class);<br>            serverBootstrap.group(boss, worker);<br>            serverBootstrap.childHandler(<span class="hljs-keyword">new</span> ChannelInitializer&lt;SocketChannel&gt;() &#123;<br>                <span class="hljs-meta">@Override</span><br>                <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initChannel</span><span class="hljs-params">(SocketChannel ch)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>                    ch.pipeline().addLast(<span class="hljs-keyword">new</span> ProcotolFrameDecoder());<br>                    ch.pipeline().addLast(LOGGING_HANDLER);<br>                    ch.pipeline().addLast(MESSAGE_CODEC);<br>                    ch.pipeline().addLast(RPC_HANDLER);<br>                &#125;<br>            &#125;);<br>            Channel channel = serverBootstrap.bind(<span class="hljs-number">8080</span>).sync().channel();<br>            channel.closeFuture().sync();<br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>            log.error(<span class="hljs-string">&quot;server error&quot;</span>, e);<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            boss.shutdownGracefully();<br>            worker.shutdownGracefully();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯æ¶å­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RpcClient</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        NioEventLoopGroup group = <span class="hljs-keyword">new</span> NioEventLoopGroup();<br>        LoggingHandler LOGGING_HANDLER = <span class="hljs-keyword">new</span> LoggingHandler(LogLevel.DEBUG);<br>        MessageCodecSharable MESSAGE_CODEC = <span class="hljs-keyword">new</span> MessageCodecSharable();<br>        <br>        <span class="hljs-comment">// rpc å“åº”æ¶ˆæ¯å¤„ç†å™¨ï¼Œå¾…å®ç°</span><br>        RpcResponseMessageHandler RPC_HANDLER = <span class="hljs-keyword">new</span> RpcResponseMessageHandler();<br>        <span class="hljs-keyword">try</span> &#123;<br>            Bootstrap bootstrap = <span class="hljs-keyword">new</span> Bootstrap();<br>            bootstrap.channel(NioSocketChannel.class);<br>            bootstrap.group(group);<br>            bootstrap.handler(<span class="hljs-keyword">new</span> ChannelInitializer&lt;SocketChannel&gt;() &#123;<br>                <span class="hljs-meta">@Override</span><br>                <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initChannel</span><span class="hljs-params">(SocketChannel ch)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>                    ch.pipeline().addLast(<span class="hljs-keyword">new</span> ProcotolFrameDecoder());<br>                    ch.pipeline().addLast(LOGGING_HANDLER);<br>                    ch.pipeline().addLast(MESSAGE_CODEC);<br>                    ch.pipeline().addLast(RPC_HANDLER);<br>                &#125;<br>            &#125;);<br>            Channel channel = bootstrap.connect(<span class="hljs-string">&quot;localhost&quot;</span>, <span class="hljs-number">8080</span>).sync().channel();<br>            channel.closeFuture().sync();<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            log.error(<span class="hljs-string">&quot;client error&quot;</span>, e);<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            group.shutdownGracefully();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æœåŠ¡å™¨ç«¯çš„ service è·å–</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ServicesFactory</span> </span>&#123;<br><br>    <span class="hljs-keyword">static</span> Properties properties;<br>    <span class="hljs-keyword">static</span> Map&lt;Class&lt;?&gt;, Object&gt; map = <span class="hljs-keyword">new</span> ConcurrentHashMap&lt;&gt;();<br><br>    <span class="hljs-keyword">static</span> &#123;<br>        <span class="hljs-keyword">try</span> (InputStream in = Config.class.getResourceAsStream(<span class="hljs-string">&quot;/application.properties&quot;</span>)) &#123;<br>            properties = <span class="hljs-keyword">new</span> Properties();<br>            properties.load(in);<br>            Set&lt;String&gt; names = properties.stringPropertyNames();<br>            <span class="hljs-keyword">for</span> (String name : names) &#123;<br>                <span class="hljs-keyword">if</span> (name.endsWith(<span class="hljs-string">&quot;Service&quot;</span>)) &#123;<br>                    Class&lt;?&gt; interfaceClass = Class.forName(name);<br>                    Class&lt;?&gt; instanceClass = Class.forName(properties.getProperty(name));<br>                    map.put(interfaceClass, instanceClass.newInstance());<br>                &#125;<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (IOException | ClassNotFoundException | InstantiationException | IllegalAccessException e) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ExceptionInInitializerError(e);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; <span class="hljs-function">T <span class="hljs-title">getService</span><span class="hljs-params">(Class&lt;T&gt; interfaceClass)</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> (T) map.get(interfaceClass);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç›¸å…³é…ç½® application.properties</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus">serializer.algorithm=Json<br>cn<span class="hljs-selector-class">.itcast</span><span class="hljs-selector-class">.server</span><span class="hljs-selector-class">.service</span>.HelloService=cn<span class="hljs-selector-class">.itcast</span><span class="hljs-selector-class">.server</span><span class="hljs-selector-class">.service</span>.HelloServiceImpl<br></code></pre></td></tr></table></figure><h4 id="2ï¼‰æœåŠ¡å™¨-handler"><a href="#2ï¼‰æœåŠ¡å™¨-handler" class="headerlink" title="2ï¼‰æœåŠ¡å™¨ handler"></a>2ï¼‰æœåŠ¡å™¨ handler</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@ChannelHandler</span>.Sharable<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RpcRequestMessageHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">SimpleChannelInboundHandler</span>&lt;<span class="hljs-title">RpcRequestMessage</span>&gt; </span>&#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">channelRead0</span><span class="hljs-params">(ChannelHandlerContext ctx, RpcRequestMessage message)</span> </span>&#123;<br>        RpcResponseMessage response = <span class="hljs-keyword">new</span> RpcResponseMessage();<br>        response.setSequenceId(message.getSequenceId());<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// è·å–çœŸæ­£çš„å®ç°å¯¹è±¡</span><br>            HelloService service = (HelloService)<br>                    ServicesFactory.getService(Class.forName(message.getInterfaceName()));<br>            <br>            <span class="hljs-comment">// è·å–è¦è°ƒç”¨çš„æ–¹æ³•</span><br>            Method method = service.getClass().getMethod(message.getMethodName(), message.getParameterTypes());<br>            <br>            <span class="hljs-comment">// è°ƒç”¨æ–¹æ³•</span><br>            Object invoke = method.invoke(service, message.getParameterValue());<br>            <span class="hljs-comment">// è°ƒç”¨æˆåŠŸ</span><br>            response.setReturnValue(invoke);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-comment">// è°ƒç”¨å¼‚å¸¸</span><br>            response.setExceptionValue(e);<br>        &#125;<br>        <span class="hljs-comment">// è¿”å›ç»“æœ</span><br>        ctx.writeAndFlush(response);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="3ï¼‰å®¢æˆ·ç«¯ä»£ç ç¬¬ä¸€ç‰ˆ"><a href="#3ï¼‰å®¢æˆ·ç«¯ä»£ç ç¬¬ä¸€ç‰ˆ" class="headerlink" title="3ï¼‰å®¢æˆ·ç«¯ä»£ç ç¬¬ä¸€ç‰ˆ"></a>3ï¼‰å®¢æˆ·ç«¯ä»£ç ç¬¬ä¸€ç‰ˆ</h4><p>åªå‘æ¶ˆæ¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RpcClient</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        NioEventLoopGroup group = <span class="hljs-keyword">new</span> NioEventLoopGroup();<br>        LoggingHandler LOGGING_HANDLER = <span class="hljs-keyword">new</span> LoggingHandler(LogLevel.DEBUG);<br>        MessageCodecSharable MESSAGE_CODEC = <span class="hljs-keyword">new</span> MessageCodecSharable();<br>        RpcResponseMessageHandler RPC_HANDLER = <span class="hljs-keyword">new</span> RpcResponseMessageHandler();<br>        <span class="hljs-keyword">try</span> &#123;<br>            Bootstrap bootstrap = <span class="hljs-keyword">new</span> Bootstrap();<br>            bootstrap.channel(NioSocketChannel.class);<br>            bootstrap.group(group);<br>            bootstrap.handler(<span class="hljs-keyword">new</span> ChannelInitializer&lt;SocketChannel&gt;() &#123;<br>                <span class="hljs-meta">@Override</span><br>                <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initChannel</span><span class="hljs-params">(SocketChannel ch)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>                    ch.pipeline().addLast(<span class="hljs-keyword">new</span> ProcotolFrameDecoder());<br>                    ch.pipeline().addLast(LOGGING_HANDLER);<br>                    ch.pipeline().addLast(MESSAGE_CODEC);<br>                    ch.pipeline().addLast(RPC_HANDLER);<br>                &#125;<br>            &#125;);<br>            Channel channel = bootstrap.connect(<span class="hljs-string">&quot;localhost&quot;</span>, <span class="hljs-number">8080</span>).sync().channel();<br><br>            ChannelFuture future = channel.writeAndFlush(<span class="hljs-keyword">new</span> RpcRequestMessage(<br>                    <span class="hljs-number">1</span>,<br>                    <span class="hljs-string">&quot;cn.itcast.server.service.HelloService&quot;</span>,<br>                    <span class="hljs-string">&quot;sayHello&quot;</span>,<br>                    String.class,<br>                    <span class="hljs-keyword">new</span> Class[]&#123;String.class&#125;,<br>                    <span class="hljs-keyword">new</span> Object[]&#123;<span class="hljs-string">&quot;å¼ ä¸‰&quot;</span>&#125;<br>            )).addListener(promise -&gt; &#123;<br>                <span class="hljs-keyword">if</span> (!promise.isSuccess()) &#123;<br>                    Throwable cause = promise.cause();<br>                    log.error(<span class="hljs-string">&quot;error&quot;</span>, cause);<br>                &#125;<br>            &#125;);<br><br>            channel.closeFuture().sync();<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            log.error(<span class="hljs-string">&quot;client error&quot;</span>, e);<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            group.shutdownGracefully();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="gsonä¸èƒ½å¤„ç†Classå¯¹è±¡"><a href="#gsonä¸èƒ½å¤„ç†Classå¯¹è±¡" class="headerlink" title="gsonä¸èƒ½å¤„ç†Classå¯¹è±¡"></a>gsonä¸èƒ½å¤„ç†Classå¯¹è±¡</h5><p>è§£å†³æ–¹å¼å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> cn.jyg.protocol;<br><br><span class="hljs-keyword">import</span> com.google.gson.*;<br><br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.lang.reflect.Type;<br><span class="hljs-keyword">import</span> java.nio.charset.StandardCharsets;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ç”¨äºæ‰©å±•åºåˆ—åŒ–ã€ååºåˆ—åŒ–ç®—æ³•</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Serializer</span> </span>&#123;<br><br>    <span class="hljs-comment">// ååºåˆ—åŒ–æ–¹æ³•</span><br>    &lt;T&gt; <span class="hljs-function">T <span class="hljs-title">deserialize</span><span class="hljs-params">(Class&lt;T&gt; clazz, <span class="hljs-keyword">byte</span>[] bytes)</span></span>;<br><br>    <span class="hljs-comment">// åºåˆ—åŒ–æ–¹æ³•</span><br>    &lt;T&gt; <span class="hljs-keyword">byte</span>[] serialize(T object);<br><br>    <span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">Algorithm</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Serializer</span> </span>&#123;<br><br>        Java &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> &lt;T&gt; <span class="hljs-function">T <span class="hljs-title">deserialize</span><span class="hljs-params">(Class&lt;T&gt; clazz, <span class="hljs-keyword">byte</span>[] bytes)</span> </span>&#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    ObjectInputStream ois = <span class="hljs-keyword">new</span> ObjectInputStream(<span class="hljs-keyword">new</span> ByteArrayInputStream(bytes));<br>                    <span class="hljs-keyword">return</span> (T) ois.readObject();<br>                &#125; <span class="hljs-keyword">catch</span> (IOException | ClassNotFoundException e) &#123;<br>                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">&quot;ååºåˆ—åŒ–å¤±è´¥&quot;</span>, e);<br>                &#125;<br>            &#125;<br><br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> &lt;T&gt; <span class="hljs-keyword">byte</span>[] serialize(T object) &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    ByteArrayOutputStream bos = <span class="hljs-keyword">new</span> ByteArrayOutputStream();<br>                    ObjectOutputStream oos = <span class="hljs-keyword">new</span> ObjectOutputStream(bos);<br>                    oos.writeObject(object);<br>                    <span class="hljs-keyword">return</span> bos.toByteArray();<br>                &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">&quot;åºåˆ—åŒ–å¤±è´¥&quot;</span>, e);<br>                &#125;<br>            &#125;<br>        &#125;,<br><br>        Json &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> &lt;T&gt; <span class="hljs-function">T <span class="hljs-title">deserialize</span><span class="hljs-params">(Class&lt;T&gt; clazz, <span class="hljs-keyword">byte</span>[] bytes)</span> </span>&#123;<br>                Gson gson = <span class="hljs-keyword">new</span> GsonBuilder().registerTypeAdapter(Class.class, <span class="hljs-keyword">new</span> Serializer.ClassCodec()).create();<br>                String json = <span class="hljs-keyword">new</span> String(bytes, StandardCharsets.UTF_8);<br>                <span class="hljs-keyword">return</span> gson.fromJson(json, clazz);<br>            &#125;<br><br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> &lt;T&gt; <span class="hljs-keyword">byte</span>[] serialize(T object) &#123;<br>                Gson gson = <span class="hljs-keyword">new</span> GsonBuilder().registerTypeAdapter(Class.class, <span class="hljs-keyword">new</span> Serializer.ClassCodec()).create();<br>                String json = gson.toJson(object);<br>                <span class="hljs-keyword">return</span> json.getBytes(StandardCharsets.UTF_8);<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ClassCodec</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">JsonSerializer</span>&lt;<span class="hljs-title">Class</span>&lt;?&gt;&gt;, <span class="hljs-title">JsonDeserializer</span>&lt;<span class="hljs-title">Class</span>&lt;?&gt;&gt; </span>&#123;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> Class&lt;?&gt; deserialize(JsonElement json, Type typeOfT, JsonDeserializationContext context) <span class="hljs-keyword">throws</span> JsonParseException &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                String str = json.getAsString();<br>                <span class="hljs-keyword">return</span> Class.forName(str);<br>            &#125; <span class="hljs-keyword">catch</span> (ClassNotFoundException e) &#123;<br>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> JsonParseException(e);<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span>             <span class="hljs-comment">//   String.class</span><br>        <span class="hljs-function"><span class="hljs-keyword">public</span> JsonElement <span class="hljs-title">serialize</span><span class="hljs-params">(Class&lt;?&gt; src, Type typeOfSrc, JsonSerializationContext context)</span> </span>&#123;<br>            <span class="hljs-comment">// class -&gt; json</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> JsonPrimitive(src.getName());<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="4ï¼‰å®¢æˆ·ç«¯-handler-ç¬¬ä¸€ç‰ˆ"><a href="#4ï¼‰å®¢æˆ·ç«¯-handler-ç¬¬ä¸€ç‰ˆ" class="headerlink" title="4ï¼‰å®¢æˆ·ç«¯ handler ç¬¬ä¸€ç‰ˆ"></a>4ï¼‰å®¢æˆ·ç«¯ handler ç¬¬ä¸€ç‰ˆ</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@ChannelHandler</span>.Sharable<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RpcResponseMessageHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">SimpleChannelInboundHandler</span>&lt;<span class="hljs-title">RpcResponseMessage</span>&gt; </span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">channelRead0</span><span class="hljs-params">(ChannelHandlerContext ctx, RpcResponseMessage msg)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        log.debug(<span class="hljs-string">&quot;&#123;&#125;&quot;</span>, msg);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="5ï¼‰å®¢æˆ·ç«¯ä»£ç -ç¬¬äºŒç‰ˆ"><a href="#5ï¼‰å®¢æˆ·ç«¯ä»£ç -ç¬¬äºŒç‰ˆ" class="headerlink" title="5ï¼‰å®¢æˆ·ç«¯ä»£ç  ç¬¬äºŒç‰ˆ"></a>5ï¼‰å®¢æˆ·ç«¯ä»£ç  ç¬¬äºŒç‰ˆ</h4><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20230423212427037.png"></p><p>åŒ…æ‹¬ channel ç®¡ç†ï¼Œä»£ç†ï¼Œæ¥æ”¶ç»“æœ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RpcClientManager</span> </span>&#123;<br><br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        HelloService service = getProxyService(HelloService.class);<br>        System.out.println(service.sayHello(<span class="hljs-string">&quot;zhangsan&quot;</span>));<br><span class="hljs-comment">//        System.out.println(service.sayHello(&quot;lisi&quot;));</span><br><span class="hljs-comment">//        System.out.println(service.sayHello(&quot;wangwu&quot;));</span><br>    &#125;<br><br>    <span class="hljs-comment">// åˆ›å»ºä»£ç†ç±»</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; <span class="hljs-function">T <span class="hljs-title">getProxyService</span><span class="hljs-params">(Class&lt;T&gt; serviceClass)</span> </span>&#123;<br>        ClassLoader loader = serviceClass.getClassLoader();<br>        Class&lt;?&gt;[] interfaces = <span class="hljs-keyword">new</span> Class[]&#123;serviceClass&#125;;<br>        <span class="hljs-comment">//                                                            sayHello  &quot;å¼ ä¸‰&quot;</span><br>        Object o = Proxy.newProxyInstance(loader, interfaces, (proxy, method, args) -&gt; &#123;<br>            <span class="hljs-comment">// 1. å°†æ–¹æ³•è°ƒç”¨è½¬æ¢ä¸º æ¶ˆæ¯å¯¹è±¡</span><br>            <span class="hljs-keyword">int</span> sequenceId = SequenceIdGenerator.nextId();<br>            RpcRequestMessage msg = <span class="hljs-keyword">new</span> RpcRequestMessage(<br>                    sequenceId,<br>                    serviceClass.getName(),<br>                    method.getName(),<br>                    method.getReturnType(),<br>                    method.getParameterTypes(),<br>                    args<br>            );<br>            <span class="hljs-comment">// 2. å°†æ¶ˆæ¯å¯¹è±¡å‘é€å‡ºå»</span><br>            getChannel().writeAndFlush(msg);<br><br>            <span class="hljs-comment">// 3. å‡†å¤‡ä¸€ä¸ªç©º Promise å¯¹è±¡ï¼Œæ¥æ¥æ”¶ç»“æœ             æŒ‡å®š promise å¯¹è±¡å¼‚æ­¥æ¥æ”¶ç»“æœçº¿ç¨‹</span><br>            DefaultPromise&lt;Object&gt; promise = <span class="hljs-keyword">new</span> DefaultPromise&lt;&gt;(getChannel().eventLoop());<br>            RpcResponseMessageHandler.PROMISES.put(sequenceId, promise);<br><br><span class="hljs-comment">//            promise.addListener(future -&gt; &#123;</span><br><span class="hljs-comment">//                // çº¿ç¨‹</span><br><span class="hljs-comment">//            &#125;);</span><br><br>            <span class="hljs-comment">// 4. ç­‰å¾… promise ç»“æœ</span><br>            promise.await();<br>            <span class="hljs-keyword">if</span>(promise.isSuccess()) &#123;<br>                <span class="hljs-comment">// è°ƒç”¨æ­£å¸¸</span><br>                <span class="hljs-keyword">return</span> promise.getNow();<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-comment">// è°ƒç”¨å¤±è´¥</span><br>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(promise.cause());<br>            &#125;<br>        &#125;);<br>        <span class="hljs-keyword">return</span> (T) o;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">volatile</span> Channel channel = <span class="hljs-keyword">null</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Object LOCK = <span class="hljs-keyword">new</span> Object();<br><br>    <span class="hljs-comment">// è·å–å”¯ä¸€çš„ channel å¯¹è±¡</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Channel <span class="hljs-title">getChannel</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (channel != <span class="hljs-keyword">null</span>) &#123;<br>            <span class="hljs-keyword">return</span> channel;<br>        &#125;<br>        <span class="hljs-keyword">synchronized</span> (LOCK) &#123; <span class="hljs-comment">//  t2</span><br>            <span class="hljs-keyword">if</span> (channel != <span class="hljs-keyword">null</span>) &#123; <span class="hljs-comment">// t1</span><br>                <span class="hljs-keyword">return</span> channel;<br>            &#125;<br>            initChannel();<br>            <span class="hljs-keyword">return</span> channel;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// åˆå§‹åŒ– channel æ–¹æ³•</span><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initChannel</span><span class="hljs-params">()</span> </span>&#123;<br>        NioEventLoopGroup group = <span class="hljs-keyword">new</span> NioEventLoopGroup();<br>        LoggingHandler LOGGING_HANDLER = <span class="hljs-keyword">new</span> LoggingHandler(LogLevel.DEBUG);<br>        MessageCodecSharable MESSAGE_CODEC = <span class="hljs-keyword">new</span> MessageCodecSharable();<br>        RpcResponseMessageHandler RPC_HANDLER = <span class="hljs-keyword">new</span> RpcResponseMessageHandler();<br>        Bootstrap bootstrap = <span class="hljs-keyword">new</span> Bootstrap();<br>        bootstrap.channel(NioSocketChannel.class);<br>        bootstrap.group(group);<br>        bootstrap.handler(<span class="hljs-keyword">new</span> ChannelInitializer&lt;SocketChannel&gt;() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initChannel</span><span class="hljs-params">(SocketChannel ch)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>                ch.pipeline().addLast(<span class="hljs-keyword">new</span> ProcotolFrameDecoder());<br>                ch.pipeline().addLast(LOGGING_HANDLER);<br>                ch.pipeline().addLast(MESSAGE_CODEC);<br>                ch.pipeline().addLast(RPC_HANDLER);<br>            &#125;<br>        &#125;);<br>        <span class="hljs-keyword">try</span> &#123;<br>            channel = bootstrap.connect(<span class="hljs-string">&quot;localhost&quot;</span>, <span class="hljs-number">8080</span>).sync().channel();<br>            channel.closeFuture().addListener(future -&gt; &#123;<br>                group.shutdownGracefully();<br>            &#125;);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            log.error(<span class="hljs-string">&quot;client error&quot;</span>, e);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="6ï¼‰å®¢æˆ·ç«¯-handler-ç¬¬äºŒç‰ˆ"><a href="#6ï¼‰å®¢æˆ·ç«¯-handler-ç¬¬äºŒç‰ˆ" class="headerlink" title="6ï¼‰å®¢æˆ·ç«¯ handler ç¬¬äºŒç‰ˆ"></a>6ï¼‰å®¢æˆ·ç«¯ handler ç¬¬äºŒç‰ˆ</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@ChannelHandler</span>.Sharable<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RpcResponseMessageHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">SimpleChannelInboundHandler</span>&lt;<span class="hljs-title">RpcResponseMessage</span>&gt; </span>&#123;<br><br>    <span class="hljs-comment">//                       åºå·      ç”¨æ¥æ¥æ”¶ç»“æœçš„ promise å¯¹è±¡</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Map&lt;Integer, Promise&lt;Object&gt;&gt; PROMISES = <span class="hljs-keyword">new</span> ConcurrentHashMap&lt;&gt;();<br><br>    <span class="hljs-meta">@Override</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">channelRead0</span><span class="hljs-params">(ChannelHandlerContext ctx, RpcResponseMessage msg)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        log.debug(<span class="hljs-string">&quot;&#123;&#125;&quot;</span>, msg);<br>        <span class="hljs-comment">// æ‹¿åˆ°ç©ºçš„ promise</span><br>        Promise&lt;Object&gt; promise = PROMISES.remove(msg.getSequenceId());<br>        <span class="hljs-keyword">if</span> (promise != <span class="hljs-keyword">null</span>) &#123;<br>            Object returnValue = msg.getReturnValue();<br>            Exception exceptionValue = msg.getExceptionValue();<br>            <span class="hljs-keyword">if</span>(exceptionValue != <span class="hljs-keyword">null</span>) &#123;<br>                promise.setFailure(exceptionValue);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                promise.setSuccess(returnValue);<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="2-æºç åˆ†æ"><a href="#2-æºç åˆ†æ" class="headerlink" title="2. æºç åˆ†æ"></a>2. æºç åˆ†æ</h2><h3 id="2-1-å¯åŠ¨å‰–æ"><a href="#2-1-å¯åŠ¨å‰–æ" class="headerlink" title="2.1 å¯åŠ¨å‰–æ"></a>2.1 å¯åŠ¨å‰–æ</h3><p>æˆ‘ä»¬å°±æ¥çœ‹çœ‹ netty ä¸­å¯¹ä¸‹é¢çš„ä»£ç æ˜¯æ€æ ·è¿›è¡Œå¤„ç†çš„ï¼Œç†è®ºä¸Šåº”è¯¥æœ‰ä»¥ä¸‹7æ­¥æ¥å»ºç«‹è¿æ¥ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//1 netty ä¸­ä½¿ç”¨ NioEventLoopGroup ï¼ˆç®€ç§° nio boss çº¿ç¨‹ï¼‰æ¥å°è£… çº¿ç¨‹ å’Œ selector</span><br>Selector selector = Selector.open(); <br><br><span class="hljs-comment">//2 åˆ›å»º NioServerSocketChannelï¼ŒåŒæ—¶ä¼šåˆå§‹åŒ–å®ƒå…³è”çš„ handlerï¼Œä»¥åŠä¸ºåŸç”Ÿ ssc å­˜å‚¨ config</span><br>NioServerSocketChannel attachment = <span class="hljs-keyword">new</span> NioServerSocketChannel();<br><br><span class="hljs-comment">//3 åˆ›å»º NioServerSocketChannel æ—¶ï¼Œåˆ›å»ºäº† java åŸç”Ÿçš„ ServerSocketChannel</span><br>ServerSocketChannel serverSocketChannel = ServerSocketChannel.open(); <br>serverSocketChannel.configureBlocking(<span class="hljs-keyword">false</span>);<br><br><span class="hljs-comment">//4 å¯åŠ¨ nio boss çº¿ç¨‹æ‰§è¡Œæ¥ä¸‹æ¥çš„æ“ä½œ</span><br><br><span class="hljs-comment">//5 æ³¨å†Œï¼ˆä»…å…³è” selector å’Œ NioServerSocketChannelï¼‰ï¼Œæœªå…³æ³¨äº‹ä»¶ã€‚ä½¿ç”¨é™„ä»¶ï¼Œå°†javaåŸç”Ÿçš„ServerSocketChannelå’ŒNettyçš„NioServerSocketChannelå…³è”èµ·æ¥</span><br>SelectionKey selectionKey = serverSocketChannel.register(selector, <span class="hljs-number">0</span>, attachment);<br><br><span class="hljs-comment">//6 head -&gt; åˆå§‹åŒ–å™¨ -&gt; ServerBootstrapAcceptor -&gt; tailï¼Œåˆå§‹åŒ–å™¨æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œåªä¸ºæ·»åŠ  acceptor</span><br><br><span class="hljs-comment">//7 ç»‘å®šç«¯å£</span><br>serverSocketChannel.bind(<span class="hljs-keyword">new</span> InetSocketAddress(<span class="hljs-number">8080</span>));<br><br><span class="hljs-comment">//8 è§¦å‘ channel active äº‹ä»¶ï¼Œåœ¨ head ä¸­å…³æ³¨ op_accept äº‹ä»¶</span><br>selectionKey.interestOps(SelectionKey.OP_ACCEPT);<br></code></pre></td></tr></table></figure><p>å®é™…ä¸Šï¼ŒNettyçš„æµç¨‹å›¾å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20230424140507532.png"></p><p>å…¥å£ <code>io.netty.bootstrap.ServerBootstrap#bind</code></p><p>å…³é”®ä»£ç  <code>io.netty.bootstrap.AbstractBootstrap#doBind</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> ChannelFuture <span class="hljs-title">doBind</span><span class="hljs-params">(<span class="hljs-keyword">final</span> SocketAddress localAddress)</span> </span>&#123;<br><span class="hljs-comment">// 1. æ‰§è¡Œåˆå§‹åŒ–å’Œæ³¨å†Œ regFuture ä¼šç”± initAndRegister è®¾ç½®å…¶æ˜¯å¦å®Œæˆï¼Œä»è€Œå›è°ƒ 3.2 å¤„ä»£ç </span><br>    <span class="hljs-keyword">final</span> ChannelFuture regFuture = initAndRegister();<br>    <span class="hljs-keyword">final</span> Channel channel = regFuture.channel();<br>    <span class="hljs-keyword">if</span> (regFuture.cause() != <span class="hljs-keyword">null</span>) &#123;<br>        <span class="hljs-keyword">return</span> regFuture;<br>    &#125;<br><br>    <span class="hljs-comment">// 2. å› ä¸ºæ˜¯ initAndRegister å¼‚æ­¥æ‰§è¡Œï¼Œéœ€è¦åˆ†ä¸¤ç§æƒ…å†µæ¥çœ‹ï¼Œè°ƒè¯•æ—¶ä¹Ÿéœ€è¦é€šè¿‡ suspend æ–­ç‚¹ç±»å‹åŠ ä»¥åŒºåˆ†</span><br>    <span class="hljs-comment">// 2.1 å¦‚æœå·²ç»å®Œæˆ</span><br>    <span class="hljs-keyword">if</span> (regFuture.isDone()) &#123;<br>        ChannelPromise promise = channel.newPromise();<br>        <span class="hljs-comment">// 3.1 ç«‹åˆ»è°ƒç”¨ doBind0ï¼Œåœ¨mainçº¿ç¨‹ä¸­æ‰§è¡Œ</span><br>        doBind0(regFuture, channel, localAddress, promise);<br>        <span class="hljs-keyword">return</span> promise;<br>    &#125; <br>    <span class="hljs-comment">// 2.2 è¿˜æ²¡æœ‰å®Œæˆ</span><br>    <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">final</span> PendingRegistrationPromise promise = <span class="hljs-keyword">new</span> PendingRegistrationPromise(channel);<br>        <span class="hljs-comment">// 3.2 å›è°ƒ doBind0ï¼Œåœ¨nio-threadçº¿ç¨‹å›è°ƒæ‰§è¡Œã€‚</span><br>        regFuture.addListener(<span class="hljs-keyword">new</span> ChannelFutureListener() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">operationComplete</span><span class="hljs-params">(ChannelFuture future)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>                Throwable cause = future.cause();<br>                <span class="hljs-keyword">if</span> (cause != <span class="hljs-keyword">null</span>) &#123;<br>                    <span class="hljs-comment">// å¤„ç†å¼‚å¸¸...</span><br>                    promise.setFailure(cause);<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    promise.registered();<br><span class="hljs-comment">// 3. ç”±æ³¨å†Œçº¿ç¨‹å»æ‰§è¡Œ doBind0</span><br>                    doBind0(regFuture, channel, localAddress, promise);<br>                &#125;<br>            &#125;<br>        &#125;);<br>        <span class="hljs-keyword">return</span> promise;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å…³é”®ä»£ç  <code>io.netty.bootstrap.AbstractBootstrap#initAndRegister</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">final</span> ChannelFuture <span class="hljs-title">initAndRegister</span><span class="hljs-params">()</span> </span>&#123;<br>    Channel channel = <span class="hljs-keyword">null</span>;<br>    <span class="hljs-keyword">try</span> &#123;<br>        channel = channelFactory.newChannel(); <span class="hljs-comment">// åˆ›å»ºJDKçš„ServerSocketChannel</span><br>        <span class="hljs-comment">// 1.1 åˆå§‹åŒ– - åšçš„äº‹å°±æ˜¯æ·»åŠ ä¸€ä¸ªåˆå§‹åŒ–å™¨ ChannelInitializer</span><br>        init(channel);<br>    &#125; <span class="hljs-keyword">catch</span> (Throwable t) &#123;<br>        <span class="hljs-comment">// å¤„ç†å¼‚å¸¸...</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> DefaultChannelPromise(<span class="hljs-keyword">new</span> FailedChannel(), GlobalEventExecutor.INSTANCE).setFailure(t);<br>    &#125;<br><br>    <span class="hljs-comment">// 1.2 æ³¨å†Œ - åšçš„äº‹å°±æ˜¯å°†åŸç”Ÿ channel æ³¨å†Œåˆ° selector ä¸Š</span><br>    ChannelFuture regFuture = config().group().register(channel);<br>    <span class="hljs-keyword">if</span> (regFuture.cause() != <span class="hljs-keyword">null</span>) &#123;<br>        <span class="hljs-comment">// å¤„ç†å¼‚å¸¸...</span><br>    &#125;<br>    <span class="hljs-keyword">return</span> regFuture;<br>&#125;<br></code></pre></td></tr></table></figure><p>å…³é”®ä»£ç  <code>io.netty.bootstrap.ServerBootstrap#init</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// è¿™é‡Œ channel å®é™…ä¸Šæ˜¯ NioServerSocketChannel</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">(Channel channel)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>    <span class="hljs-keyword">final</span> Map&lt;ChannelOption&lt;?&gt;, Object&gt; options = options0();<br>    <span class="hljs-keyword">synchronized</span> (options) &#123;<br>        setChannelOptions(channel, options, logger);<br>    &#125;<br><br>    <span class="hljs-keyword">final</span> Map&lt;AttributeKey&lt;?&gt;, Object&gt; attrs = attrs0();<br>    <span class="hljs-keyword">synchronized</span> (attrs) &#123;<br>        <span class="hljs-keyword">for</span> (Entry&lt;AttributeKey&lt;?&gt;, Object&gt; e: attrs.entrySet()) &#123;<br>            <span class="hljs-meta">@SuppressWarnings(&quot;unchecked&quot;)</span><br>            AttributeKey&lt;Object&gt; key = (AttributeKey&lt;Object&gt;) e.getKey();<br>            channel.attr(key).set(e.getValue());<br>        &#125;<br>    &#125;<br><br>    ChannelPipeline p = channel.pipeline();<br><br>    <span class="hljs-keyword">final</span> EventLoopGroup currentChildGroup = childGroup;<br>    <span class="hljs-keyword">final</span> ChannelHandler currentChildHandler = childHandler;<br>    <span class="hljs-keyword">final</span> Entry&lt;ChannelOption&lt;?&gt;, Object&gt;[] currentChildOptions;<br>    <span class="hljs-keyword">final</span> Entry&lt;AttributeKey&lt;?&gt;, Object&gt;[] currentChildAttrs;<br>    <span class="hljs-keyword">synchronized</span> (childOptions) &#123;<br>        currentChildOptions = childOptions.entrySet().toArray(newOptionArray(<span class="hljs-number">0</span>));<br>    &#125;<br>    <span class="hljs-keyword">synchronized</span> (childAttrs) &#123;<br>        currentChildAttrs = childAttrs.entrySet().toArray(newAttrArray(<span class="hljs-number">0</span>));<br>    &#125;<br><br>    <span class="hljs-comment">// 1.1 ä¸º NioServerSocketChannel æ·»åŠ åˆå§‹åŒ–å™¨ï¼Œç­‰å¾…è°ƒç”¨</span><br>    p.addLast(<span class="hljs-keyword">new</span> ChannelInitializer&lt;Channel&gt;() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initChannel</span><span class="hljs-params">(<span class="hljs-keyword">final</span> Channel ch)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>            <span class="hljs-keyword">final</span> ChannelPipeline pipeline = ch.pipeline();<br>            ChannelHandler handler = config.handler();<br>            <span class="hljs-keyword">if</span> (handler != <span class="hljs-keyword">null</span>) &#123;<br>                pipeline.addLast(handler);<br>            &#125;<br><br>            <span class="hljs-comment">// åˆå§‹åŒ–å™¨çš„èŒè´£æ˜¯å°† ServerBootstrapAcceptor åŠ å…¥è‡³ NioServerSocketChannel</span><br>            ch.eventLoop().execute(<span class="hljs-keyword">new</span> Runnable() &#123;<br>                <span class="hljs-meta">@Override</span><br>                <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;<br>                    pipeline.addLast(<span class="hljs-keyword">new</span> ServerBootstrapAcceptor(<br>                            ch, currentChildGroup, currentChildHandler, currentChildOptions, currentChildAttrs)); <span class="hljs-comment">// ServerBootstrapAcceptorçš„ä½œç”¨æ˜¯acceptäº‹ä»¶å‘ç”Ÿåå»ºç«‹è¿æ¥</span><br>                &#125;<br>            &#125;);<br>        &#125;<br>    &#125;);<br>&#125;<br></code></pre></td></tr></table></figure><p>å…³é”®ä»£ç  <code>io.netty.channel.AbstractChannel.AbstractUnsafe#register</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title">register</span><span class="hljs-params">(EventLoop eventLoop, <span class="hljs-keyword">final</span> ChannelPromise promise)</span> </span>&#123;<br>    <span class="hljs-comment">// ä¸€äº›æ£€æŸ¥ï¼Œç•¥...</span><br><br>    AbstractChannel.<span class="hljs-keyword">this</span>.eventLoop = eventLoop;<br><br>    <span class="hljs-keyword">if</span> (eventLoop.inEventLoop()) &#123; <span class="hljs-comment">// inEventLoop()æ£€æŸ¥å½“å‰çº¿ç¨‹æ˜¯å¦ç­‰äºNioçº¿ç¨‹ï¼Œç¬¬ä¸€æ¬¡æ‰§è¡Œæ˜¯mainçº¿ç¨‹åœ¨æ‰§è¡Œï¼Œæ‰€ä»¥æ˜¯false</span><br>        register0(promise);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// é¦–æ¬¡æ‰§è¡Œ execute æ–¹æ³•æ—¶ï¼Œä¼šå¯åŠ¨ nio çº¿ç¨‹ï¼Œä¹‹åæ³¨å†Œç­‰æ“ä½œåœ¨ nio çº¿ç¨‹ä¸Šæ‰§è¡Œ</span><br>            <span class="hljs-comment">// å› ä¸ºåªæœ‰ä¸€ä¸ª NioServerSocketChannel å› æ­¤ï¼Œä¹Ÿåªä¼šæœ‰ä¸€ä¸ª boss nio çº¿ç¨‹</span><br>            <span class="hljs-comment">// è¿™è¡Œä»£ç å®Œæˆçš„äº‹å®æ˜¯ main -&gt; nio boss çº¿ç¨‹çš„åˆ‡æ¢</span><br>            eventLoop.execute(<span class="hljs-keyword">new</span> Runnable() &#123;<br>                <span class="hljs-meta">@Override</span><br>                <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;<br>                    register0(promise);<br>                &#125;<br>            &#125;);<br>        &#125; <span class="hljs-keyword">catch</span> (Throwable t) &#123;<br>            <span class="hljs-comment">// æ—¥å¿—è®°å½•...</span><br>            closeForcibly();<br>            closeFuture.setClosed();<br>            safeSetFailure(promise, t);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>io.netty.channel.AbstractChannel.AbstractUnsafe#register0</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">register0</span><span class="hljs-params">(ChannelPromise promise)</span> </span>&#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-keyword">if</span> (!promise.setUncancellable() || !ensureOpen(promise)) &#123;<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        <span class="hljs-keyword">boolean</span> firstRegistration = neverRegistered;<br>        doRegister();<span class="hljs-comment">// 1.2.1 åŸç”Ÿçš„ nio channel ç»‘å®šåˆ° selector ä¸Šï¼Œæ³¨æ„æ­¤æ—¶æ²¡æœ‰æ³¨å†Œ selector å…³æ³¨äº‹ä»¶ï¼Œé™„ä»¶ä¸º NioServerSocketChannel</span><br>        neverRegistered = <span class="hljs-keyword">false</span>;<br>        registered = <span class="hljs-keyword">true</span>;<br><br>        <span class="hljs-comment">// 1.2.2 æ‰§è¡Œ1.1å¤„çš„ NioServerSocketChannel åˆå§‹åŒ–å™¨çš„ initChannel</span><br>        pipeline.invokeHandlerAddedIfNeeded();<br><br>        <span class="hljs-comment">// å›è°ƒ 3.2 io.netty.bootstrap.AbstractBootstrap#doBind0</span><br>        safeSetSuccess(promise);<br>        pipeline.fireChannelRegistered();<br>        <br>        <span class="hljs-comment">// å¯¹åº” server socket channel è¿˜æœªç»‘å®šï¼ŒisActive ä¸º false</span><br>        <span class="hljs-keyword">if</span> (isActive()) &#123;<br>            <span class="hljs-keyword">if</span> (firstRegistration) &#123;<br>                pipeline.fireChannelActive();<br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (config().isAutoRead()) &#123;<br>                beginRead();<br>            &#125;<br>        &#125;<br>    &#125; <span class="hljs-keyword">catch</span> (Throwable t) &#123;<br>        <span class="hljs-comment">// Close the channel directly to avoid FD leak.</span><br>        closeForcibly();<br>        closeFuture.setClosed();<br>        safeSetFailure(promise, t);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å…³é”®ä»£ç  <code>io.netty.channel.ChannelInitializer#initChannel</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">initChannel</span><span class="hljs-params">(ChannelHandlerContext ctx)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>    <span class="hljs-keyword">if</span> (initMap.add(ctx)) &#123; <span class="hljs-comment">// Guard against re-entrance.</span><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// 1.2.2.1 æ‰§è¡Œåˆå§‹åŒ– æ‰§è¡Œ1.1å¤„çš„NioServerSocketChannel åˆå§‹åŒ–å™¨çš„ initChannel</span><br>            initChannel((C) ctx.channel());<br>        &#125; <span class="hljs-keyword">catch</span> (Throwable cause) &#123;<br>            exceptionCaught(ctx, cause);<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-comment">// 1.2.2.2 ç§»é™¤åˆå§‹åŒ–å™¨</span><br>            ChannelPipeline pipeline = ctx.pipeline();<br>            <span class="hljs-keyword">if</span> (pipeline.context(<span class="hljs-keyword">this</span>) != <span class="hljs-keyword">null</span>) &#123;<br>                pipeline.remove(<span class="hljs-keyword">this</span>);<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>å…³é”®ä»£ç  <code>io.netty.bootstrap.AbstractBootstrap#doBind0</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 3.1 æˆ– 3.2 æ‰§è¡Œ doBind0</span><br><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doBind0</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">        <span class="hljs-keyword">final</span> ChannelFuture regFuture, <span class="hljs-keyword">final</span> Channel channel,</span></span><br><span class="hljs-params"><span class="hljs-function">        <span class="hljs-keyword">final</span> SocketAddress localAddress, <span class="hljs-keyword">final</span> ChannelPromise promise)</span> </span>&#123;<br><br>    channel.eventLoop().execute(<span class="hljs-keyword">new</span> Runnable() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;<br>            <span class="hljs-keyword">if</span> (regFuture.isSuccess()) &#123;<br>                channel.bind(localAddress, promise).addListener(ChannelFutureListener.CLOSE_ON_FAILURE);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                promise.setFailure(regFuture.cause());<br>            &#125;<br>        &#125;<br>    &#125;);<br>&#125;<br></code></pre></td></tr></table></figure><p>å…³é”®ä»£ç  <code>io.netty.channel.AbstractChannel.AbstractUnsafe#bind</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title">bind</span><span class="hljs-params">(<span class="hljs-keyword">final</span> SocketAddress localAddress, <span class="hljs-keyword">final</span> ChannelPromise promise)</span> </span>&#123;<br>    assertEventLoop();<br><br>    <span class="hljs-keyword">if</span> (!promise.setUncancellable() || !ensureOpen(promise)) &#123;<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (Boolean.TRUE.equals(config().getOption(ChannelOption.SO_BROADCAST)) &amp;&amp;<br>        localAddress <span class="hljs-keyword">instanceof</span> InetSocketAddress &amp;&amp;<br>        !((InetSocketAddress) localAddress).getAddress().isAnyLocalAddress() &amp;&amp;<br>        !PlatformDependent.isWindows() &amp;&amp; !PlatformDependent.maybeSuperUser()) &#123;<br>        <span class="hljs-comment">// è®°å½•æ—¥å¿—...</span><br>    &#125;<br><br>    <span class="hljs-keyword">boolean</span> wasActive = isActive();<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-comment">// 3.3 æ‰§è¡Œç«¯å£ç»‘å®š</span><br>        doBind(localAddress);<br>    &#125; <span class="hljs-keyword">catch</span> (Throwable t) &#123;<br>        safeSetFailure(promise, t);<br>        closeIfClosed();<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (!wasActive &amp;&amp; isActive()) &#123; <span class="hljs-comment">// åˆ¤æ–­å½“å‰ServerSocketChannelæ˜¯å¦å¯ç”¨</span><br>        invokeLater(<span class="hljs-keyword">new</span> Runnable() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;<br>                <span class="hljs-comment">// 3.4 è§¦å‘ active äº‹ä»¶ï¼Œæ­¤æ—¶ServerSocketChannelä¸Šåªæœ‰ä¸‰ä¸ªhandlerï¼Œåˆ†åˆ«æ˜¯head -&gt; accpetor -&gt; tail</span><br>                <span class="hljs-comment">// ä½†æ˜¯åªæœ‰head handleråšäº†å·¥ä½œï¼Œå…¶ä½™ä¸¤ä¸ªæ²¡æœ‰åšå·¥ä½œï¼Œæ‰€ä»¥è¿™é‡Œåªçœ‹head handler</span><br>                pipeline.fireChannelActive();<br>            &#125;<br>        &#125;);<br>    &#125;<br><br>    safeSetSuccess(promise);<br>&#125;<br></code></pre></td></tr></table></figure><p>3.3 å…³é”®ä»£ç  <code>io.netty.channel.socket.nio.NioServerSocketChannel#doBind</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doBind</span><span class="hljs-params">(SocketAddress localAddress)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>    <span class="hljs-keyword">if</span> (PlatformDependent.javaVersion() &gt;= <span class="hljs-number">7</span>) &#123; <span class="hljs-comment">//JDK7åŠä»¥ä¸Š</span><br>        javaChannel().bind(localAddress, config.getBacklog()); <span class="hljs-comment">//ServerSocketChannelç»‘å®šç«¯å£ï¼Œæ‰“å°æ—¥å¿—</span><br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        javaChannel().socket().bind(localAddress, config.getBacklog());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>3.4 å…³é”®ä»£ç  <code>io.netty.channel.DefaultChannelPipeline.HeadContext#channelActive</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">channelActive</span><span class="hljs-params">(ChannelHandlerContext ctx)</span> </span>&#123;<br>    ctx.fireChannelActive();<br><span class="hljs-comment">// è§¦å‘ read (NioServerSocketChannel ä¸Šçš„ read ä¸æ˜¯è¯»å–æ•°æ®ï¼Œåªæ˜¯ä¸ºäº†è§¦å‘ channel çš„äº‹ä»¶æ³¨å†Œ)</span><br>    readIfIsAutoRead(); <span class="hljs-comment">// ServerSocketChannelä¸Šç»‘å®šOP_ACCPETäº‹ä»¶ï¼Œå³ä¸‹é¢çš„doBeginReadæ–¹æ³•</span><br>&#125;<br></code></pre></td></tr></table></figure><p>å…³é”®ä»£ç  <code>io.netty.channel.nio.AbstractNioChannel#doBeginRead</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doBeginRead</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>    <span class="hljs-comment">// Channel.read() or ChannelHandlerContext.read() was called</span><br>    <span class="hljs-keyword">final</span> SelectionKey selectionKey = <span class="hljs-keyword">this</span>.selectionKey;<br>    <span class="hljs-keyword">if</span> (!selectionKey.isValid()) &#123;<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br><br>    readPending = <span class="hljs-keyword">true</span>;<br><br>    <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> interestOps = selectionKey.interestOps();<br>    <span class="hljs-comment">// readInterestOp å–å€¼æ˜¯ 16ï¼Œåœ¨ NioServerSocketChannel åˆ›å»ºæ—¶åˆå§‹åŒ–å¥½ï¼Œä»£è¡¨å…³æ³¨ accept äº‹ä»¶</span><br>    <span class="hljs-keyword">if</span> ((interestOps &amp; readInterestOp) == <span class="hljs-number">0</span>) &#123;<br>        selectionKey.interestOps(interestOps | readInterestOp);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2-2-NioEventLoop-å‰–æ"><a href="#2-2-NioEventLoop-å‰–æ" class="headerlink" title="2.2 NioEventLoop å‰–æ"></a>2.2 NioEventLoop å‰–æ</h3><p>å†å¼ºè°ƒä¸€éï¼š </p><ul><li><p>NioEventLoopçš„é‡è¦ç»„æˆï¼š selectorï¼Œ çº¿ç¨‹ï¼Œä»»åŠ¡é˜Ÿåˆ—ï¼Œå®šæ—¶ä»»åŠ¡é˜Ÿåˆ—</p></li><li><p>NioEventLoopæ—¢ä¼šå¤„ç†ioäº‹ä»¶ï¼Œä¹Ÿä¼šå¤„ç†æ™®é€šä»»åŠ¡å’Œå®šæ—¶ä»»åŠ¡ </p></li></ul><ol><li><p>selector ä½•æ—¶åˆ›å»º  åœ¨NioEventLoopçš„æ„é€ å™¨ä¸­åˆ›å»ºSelectorå¯¹è±¡</p><p>1.1 NioEventLoopç±»ä¸­ ä¸ºä½•æœ‰ä¸¤ä¸ª selector æˆå‘˜ï¼Ÿ ç¬¬ä¸€ä¸ªselectoræ˜¯æˆå‘˜å˜é‡unwrappedSelectorï¼ŒåŸæœ¬JDKä¸­çš„selectedKeysçš„åº•å±‚æ˜¯å“ˆå¸Œè¡¨HashSetï¼Œå“ˆå¸Œè¡¨çš„éå†æ—¶é—´å¤æ‚åº¦é«˜ã€‚æ‰€ä»¥Nettyè¿›è¡Œæ”¹è¿›äº†ï¼Œç¬¬äºŒselectoræ˜¯æˆå‘˜å˜é‡selectorï¼Œåº•å±‚çš„selectedKeysæ˜¯æ•°ç»„ï¼Œéå†æ€§èƒ½å¥½ã€‚</p></li><li><p>nio çº¿ç¨‹åœ¨ä½•æ—¶å¯åŠ¨ </p><ul><li>é¦–æ¬¡è°ƒç”¨EventLoopå¯¹è±¡çš„executeæ–¹æ³•æ—¶å¯åŠ¨nioçº¿ç¨‹ï¼Œé€šè¿‡NioEventLoopçˆ¶ç±»ä¸­çš„æˆå‘˜å˜é‡stateçŠ¶æ€ä½æ§åˆ¶nioçº¿ç¨‹åªä¼šå¯åŠ¨ä¸€æ¬¡ã€‚</li></ul></li><li><p>æäº¤æ™®é€šä»»åŠ¡ä¼šä¸ä¼šç»“æŸ select é˜»å¡ï¼Ÿ </p><p>å›ç­”ï¼šä¼šï¼Œå¦‚æœæäº¤æ™®é€šä»»åŠ¡ï¼Œä¼šä½¿ç”¨NioEventLoopçš„wakeupæ–¹æ³•å”¤é†’è¢«selectoræ–¹æ³•é˜»å¡çš„Nioçº¿ç¨‹ã€‚</p></li></ol><ul><li><p>3.1 wakeupæ–¹æ³•ä¸­çš„ä»£ç å¦‚ä½•ç†è§£ </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">wakeup</span><span class="hljs-params">(<span class="hljs-keyword">boolean</span> inEventLoop)</span> </span>&#123;<br>    <span class="hljs-comment">// inEventLoopæŒ‡çš„æ˜¯ï¼Œå½“å‰æäº¤ä»»åŠ¡ï¼ˆä¹Ÿå°±æ˜¯æ‰§è¡Œexecuteæ–¹æ³•ï¼‰çš„çº¿ç¨‹æ˜¯å¦æ˜¯Nioçº¿ç¨‹ï¼Œåªæœ‰ä¸æ˜¯Nioçº¿ç¨‹æ‰æœ‰å¯èƒ½è¿›å…¥ifå—</span><br>    <span class="hljs-keyword">if</span> (!inEventLoop &amp;&amp; wakenUp.compareAndSet(<span class="hljs-keyword">false</span>, <span class="hljs-keyword">true</span>)) &#123;<br>        selector.wakeup(); <span class="hljs-comment">// æ‰€ä»¥æäº¤æ™®é€šä»»åŠ¡ä¹Ÿä¼šå”¤é†’Nioçº¿ç¨‹</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>inEventLoopæŒ‡çš„æ˜¯ï¼Œå½“å‰æäº¤ä»»åŠ¡ï¼ˆä¹Ÿå°±æ˜¯æ‰§è¡Œexecuteæ–¹æ³•ï¼‰çš„çº¿ç¨‹æ˜¯å¦æ˜¯Nioçº¿ç¨‹ï¼Œåªæœ‰ä¸æ˜¯Nioçº¿ç¨‹æ‰æœ‰å¯èƒ½è¿›å…¥ifå—</p></li><li><p>3.2 wakenUpå˜é‡çš„ä½œç”¨æ˜¯ä»€ä¹ˆ </p><p>å› ä¸ºå¤šä¸ª IO çº¿ç¨‹æˆ–è€…æäº¤ä»»åŠ¡çº¿ç¨‹éƒ½æœ‰å¯èƒ½æ‰§è¡Œ wakeupï¼Œè€Œ Nioçº¿ç¨‹çš„wakeupæ–¹æ³• å±äºæ¯”è¾ƒæ˜‚è´µçš„æ“ä½œï¼Œä¸ºäº†é¿å…Nioçº¿ç¨‹çš„wakeupæ–¹æ³•é¢‘ç¹è¢«è°ƒç”¨ï¼Œæ‰€ä»¥ä½¿ç”¨äº†ä¸€ä¸ªåŸå­å¸ƒå°”å¯¹è±¡ wakenUpï¼Œå®ƒå–å€¼ä¸º true æ—¶ï¼Œè¡¨ç¤ºè¯¥ç”±å½“å‰çº¿ç¨‹å”¤é†’ã€‚ç”±äºCASæ“ä½œï¼ŒåŒä¸€æ—¶é—´åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è®¾ç½®æˆåŠŸï¼Œè¿™æ ·å°±é¿å…äº†åŒæ—¶åˆå¤šä¸ªå¤šä¸ªçº¿ç¨‹åŒæ—¶æäº¤ä»»åŠ¡ï¼Œå¤šæ¬¡æ‰§è¡ŒNioçº¿ç¨‹çš„wakeupæ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">wakeup</span><span class="hljs-params">(<span class="hljs-keyword">boolean</span> inEventLoop)</span> </span>&#123;<br>    <span class="hljs-comment">// inEventLoopæŒ‡çš„æ˜¯ï¼Œå½“å‰æäº¤ä»»åŠ¡ï¼ˆä¹Ÿå°±æ˜¯æ‰§è¡Œexecuteæ–¹æ³•ï¼‰çš„çº¿ç¨‹æ˜¯å¦æ˜¯Nioçº¿ç¨‹ï¼Œåªæœ‰ä¸æ˜¯Nioçº¿ç¨‹æ‰æœ‰å¯èƒ½è¿›å…¥ifå—</span><br>    <span class="hljs-comment">// å› ä¸ºå¤šä¸ª IO çº¿ç¨‹æˆ–è€…æäº¤ä»»åŠ¡çº¿ç¨‹éƒ½æœ‰å¯èƒ½æ‰§è¡Œ wakeupï¼Œè€Œ Nioçº¿ç¨‹çš„wakeupæ–¹æ³• å±äºæ¯”è¾ƒæ˜‚è´µçš„æ“ä½œï¼Œä¸ºäº†é¿å…Nioçº¿ç¨‹çš„wakeupæ–¹æ³•é¢‘ç¹è¢«è°ƒç”¨ï¼Œæ‰€ä»¥ä½¿ç”¨äº†ä¸€ä¸ªåŸå­å¸ƒå°”å¯¹è±¡ wakenUpï¼Œå®ƒå–å€¼ä¸º true æ—¶ï¼Œè¡¨ç¤ºè¯¥ç”±å½“å‰çº¿ç¨‹å”¤é†’ã€‚ç”±äºCASæ“ä½œï¼ŒåŒä¸€æ—¶é—´åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è®¾ç½®æˆåŠŸï¼Œè¿™æ ·å°±é¿å…äº†åŒæ—¶åˆå¤šä¸ªå¤šä¸ªçº¿ç¨‹åŒæ—¶æäº¤ä»»åŠ¡ï¼Œå¤šæ¬¡æ‰§è¡ŒNioçº¿ç¨‹çš„wakeupæ–¹æ³•ã€‚</span><br>    <span class="hljs-keyword">if</span> (!inEventLoop &amp;&amp; wakenUp.compareAndSet(<span class="hljs-keyword">false</span>, <span class="hljs-keyword">true</span>)) &#123;<br>        selector.wakeup(); <span class="hljs-comment">// æ‰€ä»¥æäº¤æ™®é€šä»»åŠ¡ä¹Ÿä¼šå”¤é†’Nioçº¿ç¨‹</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><ol start="4"><li><p>æ¯æ¬¡å¾ªç¯æ—¶ï¼Œä»€ä¹ˆæ—¶å€™ä¼šè¿›å…¥SelectStrategy.SELECT åˆ†æ”¯ </p><p>åªæœ‰æ²¡æœ‰ä»»åŠ¡æ—¶,æ‰ä¼šè¿›å…¥ SelectStrategy.SELECTã€‚å³ä¸‹å›¾ä¸­çš„<code>hasTasks()</code>æ–¹æ³•è·å–æ˜¯å¦æœ‰ä»»åŠ¡ï¼Œ å½“æ²¡æœ‰ä»»åŠ¡æ—¶ï¼Œè¿”å›SelectStrategy.SELECTï¼Œè¿›å…¥è¯¥åˆ†æ”¯ã€‚</p><p>å½“æœ‰ä»»åŠ¡æ—¶,ä¼šè°ƒç”¨ selectNowæ–¹æ³•,é¡ºä¾¿æ‹¿åˆ°ioäº‹ä»¶ã€‚å³ä¸‹å›¾ä¸­çš„selectNowSupplierè°ƒç”¨get()æ–¹æ³•ä¸­è°ƒç”¨äº†selector.selectNow()æ–¹æ³•è·å–ioäº‹ä»¶ã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20230424154634148.png"></p><p>4.1ä½•æ—¶ä¼š select é˜»å¡ï¼Œé˜»å¡å¤šä¹…?</p><p>å¦‚æœæ²¡æœ‰scheduleTaskï¼Œé‚£ä¹ˆåªä¼šæœ€å¤§é˜»å¡æ—¶é—´å°±æ˜¯ 1s + 0.5msï¼Œæœ‰ scheduledTaskï¼Œé‚£ä¹ˆæœ€å¤§é˜»å¡æ—¶é—´å°±æ˜¯ä¸º <code>ä¸‹ä¸€ä¸ªå®šæ—¶ä»»åŠ¡æ‰§è¡Œæ—¶é—´ - å½“å‰æ—¶é—´</code> + 0.5ms</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">select</span><span class="hljs-params">(<span class="hljs-keyword">boolean</span> oldWakenUp)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>    Selector selector = <span class="hljs-keyword">this</span>.selector;<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-keyword">int</span> selectCnt = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">long</span> currentTimeNanos = System.nanoTime();<br>        <span class="hljs-comment">// è®¡ç®—ç­‰å¾…æ—¶é—´</span><br>        <span class="hljs-comment">// * æ²¡æœ‰ scheduledTaskï¼Œè¶…æ—¶æ—¶é—´ä¸º 1s</span><br>        <span class="hljs-comment">// * æœ‰ scheduledTaskï¼Œè¶…æ—¶æ—¶é—´ä¸º `ä¸‹ä¸€ä¸ªå®šæ—¶ä»»åŠ¡æ‰§è¡Œæ—¶é—´ - å½“å‰æ—¶é—´`</span><br>        <span class="hljs-keyword">long</span> selectDeadLineNanos = currentTimeNanos + delayNanos(currentTimeNanos);<br><br>        <span class="hljs-keyword">for</span> (;;) &#123;<br>            <span class="hljs-keyword">long</span> timeoutMillis = (selectDeadLineNanos - currentTimeNanos + <span class="hljs-number">500000L</span>) / <span class="hljs-number">1000000L</span>; <br>            <span class="hljs-comment">// å¦‚æœæ²¡æœ‰scheduleTaské‚£ä¹ˆåªä¼šæœ€å¤§é˜»å¡æ—¶é—´å°±æ˜¯ 1s + 0.5ms</span><br>            <span class="hljs-comment">// å¦‚æœè¶…æ—¶ï¼Œé€€å‡ºå¾ªç¯</span><br>            <span class="hljs-keyword">if</span> (timeoutMillis &lt;= <span class="hljs-number">0</span>) &#123;<br>                <span class="hljs-keyword">if</span> (selectCnt == <span class="hljs-number">0</span>) &#123;<br>                    selector.selectNow();<br>                    selectCnt = <span class="hljs-number">1</span>;<br>                &#125;<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br><br>            <span class="hljs-comment">// å¦‚æœæœŸé—´åˆæœ‰ task é€€å‡ºå¾ªç¯ï¼Œå¦‚æœæ²¡è¿™ä¸ªåˆ¤æ–­ï¼Œé‚£ä¹ˆä»»åŠ¡å°±ä¼šç­‰åˆ°ä¸‹æ¬¡ select è¶…æ—¶æ—¶æ‰èƒ½è¢«æ‰§è¡Œ</span><br>            <span class="hljs-comment">// wakenUp.compareAndSet(false, true) æ˜¯è®©é NioEventLoop ä¸å¿…å†æ‰§è¡Œ wakeup</span><br>            <span class="hljs-keyword">if</span> (hasTasks() &amp;&amp; wakenUp.compareAndSet(<span class="hljs-keyword">false</span>, <span class="hljs-keyword">true</span>)) &#123;<br>                selector.selectNow();<br>                selectCnt = <span class="hljs-number">1</span>;<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br><br>            <span class="hljs-comment">// select æœ‰é™æ—¶é˜»å¡</span><br>            <span class="hljs-comment">// æ³¨æ„ nio æœ‰ bugï¼Œå½“ bug å‡ºç°æ—¶ï¼Œselect æ–¹æ³•å³ä½¿æ²¡æœ‰äº‹ä»¶å‘ç”Ÿï¼Œä¹Ÿä¸ä¼šé˜»å¡ä½ï¼Œå¯¼è‡´ä¸æ–­ç©ºè½®è¯¢ï¼Œcpu å ç”¨ 100%</span><br>            <span class="hljs-keyword">int</span> selectedKeys = selector.select(timeoutMillis);<br>            <span class="hljs-comment">// è®¡æ•°åŠ  1</span><br>            selectCnt ++;<br><br>            <span class="hljs-comment">// é†’æ¥åï¼Œå¦‚æœæœ‰ IO äº‹ä»¶ã€æˆ–æ˜¯ç”±é EventLoop çº¿ç¨‹å”¤é†’ï¼Œæˆ–è€…æœ‰ä»»åŠ¡ï¼Œé€€å‡ºå¾ªç¯</span><br>            <span class="hljs-keyword">if</span> (selectedKeys != <span class="hljs-number">0</span> || oldWakenUp || wakenUp.get() || hasTasks() || hasScheduledTasks()) &#123;<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>            <span class="hljs-keyword">if</span> (Thread.interrupted()) &#123;<br>               <span class="hljs-comment">// çº¿ç¨‹è¢«æ‰“æ–­ï¼Œé€€å‡ºå¾ªç¯</span><br>                <span class="hljs-comment">// è®°å½•æ—¥å¿—</span><br>                selectCnt = <span class="hljs-number">1</span>;<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br><br>            <span class="hljs-keyword">long</span> time = System.nanoTime();<br>            <span class="hljs-keyword">if</span> (time - TimeUnit.MILLISECONDS.toNanos(timeoutMillis) &gt;= currentTimeNanos) &#123;<br>                <span class="hljs-comment">// å¦‚æœè¶…æ—¶ï¼Œè®¡æ•°é‡ç½®ä¸º 1ï¼Œä¸‹æ¬¡å¾ªç¯å°±ä¼š break</span><br>                selectCnt = <span class="hljs-number">1</span>;<br>            &#125; <br>            <span class="hljs-comment">// è®¡æ•°è¶…è¿‡é˜ˆå€¼ï¼Œç”± io.netty.selectorAutoRebuildThreshold æŒ‡å®šï¼Œé»˜è®¤ 512</span><br>            <span class="hljs-comment">// è¿™æ˜¯ä¸ºäº†è§£å†³ nio ç©ºè½®è¯¢ bug</span><br>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (SELECTOR_AUTO_REBUILD_THRESHOLD &gt; <span class="hljs-number">0</span> &amp;&amp;<br>                    selectCnt &gt;= SELECTOR_AUTO_REBUILD_THRESHOLD) &#123;<br>                selector = selectRebuildSelector(selectCnt);  <span class="hljs-comment">// é‡å»º selectorå¯¹è±¡ï¼Œ</span><br>                selectCnt = <span class="hljs-number">1</span>;<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br><br>            currentTimeNanos = time;<br>        &#125;<br><br>        <span class="hljs-keyword">if</span> (selectCnt &gt; MIN_PREMATURE_SELECTOR_RETURNS) &#123;<br>            <span class="hljs-comment">// è®°å½•æ—¥å¿—</span><br>        &#125;<br>    &#125; <span class="hljs-keyword">catch</span> (CancelledKeyException e) &#123;<br>        <span class="hljs-comment">// è®°å½•æ—¥å¿—</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœæœ‰å®šæ—¶ä»»åŠ¡æ—¶é—´åˆ°äº†ã€æœŸé—´æœ‰æ–°ä»»åŠ¡è¢«æäº¤äº†ã€æˆ–è€…æœ‰IOäº‹ä»¶äº†ç­‰ç­‰ï¼Œéƒ½ä¼šé€€å‡ºæ­»å¾ªç¯ã€‚</p></li><li><p>nioç©ºè½®è¯¢ bug åœ¨å“ªé‡Œä½“ç°ï¼Œå¦‚ä½•è§£å†³ </p><p>æ³¨æ„ nio æœ‰ bugï¼Œå½“ bug å‡ºç°ï¼ˆbugå‘ç”Ÿæ¦‚ç‡è¾ƒå°ï¼‰æ—¶ï¼Œselect æ–¹æ³•å³ä½¿æ²¡æœ‰äº‹ä»¶å‘ç”Ÿï¼Œä¹Ÿä¸ä¼šé˜»å¡ä½ï¼Œå¯¼è‡´ä¸æ–­ç©ºè½®è¯¢ï¼Œcpu å ç”¨ 100%ã€‚ä½¿ç”¨selectCntå˜é‡è®¡ç®—ï¼Œå¦‚æœselectCntå¤§äºè®¾ç½®çš„é˜ˆå€¼ï¼Œé‚£ä¹ˆé€€å‡ºæ­»å¾ªç¯ï¼Œä¸è¦ç»§ç»­ç©ºè½®è¯¢äº†ã€‚</p><p>ç”±äºJDKï¼ˆlinuxç‰ˆæœ¬ï¼‰ä¸­çš„Nioä¸­çš„Selectorä¸Šæœ‰bugï¼Œæ‰€ä»¥é‡æ–°åˆ›å»ºäº†ä¸€ä¸ªSelectorå¯¹è±¡ï¼ŒæŠŠåŸæ¥æ—§çš„Selectorå¯¹è±¡ä¸Šç»‘å®šçš„SelectionKeyså’Œé™„ä»¶ç§»åˆ°æ–°çš„Selectorå¯¹è±¡ä¸Šã€‚</p><p><strong>å½“ç„¶ï¼ŒNettyè¿˜æœ‰ä¸€ä¸ªè§£å†³æ–¹æ³•ï¼Œå°±æ˜¯Nettyé‡å†™äº†Selectorç±»ï¼Œä¸ä½¿ç”¨JDKçš„Selectorç±»ã€‚</strong></p></li><li><p>ioRatio æ§åˆ¶ä»€ä¹ˆï¼Œè®¾ç½®ä¸º 100 æœ‰ä½•ä½œç”¨ï¼Ÿ </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">for</span> (;;) &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-comment">// calculateStrategy çš„é€»è¾‘å¦‚ä¸‹ï¼š</span><br>                <span class="hljs-comment">// æœ‰ä»»åŠ¡ï¼Œä¼šæ‰§è¡Œä¸€æ¬¡ selectNowï¼Œæ¸…é™¤ä¸Šä¸€æ¬¡çš„ wakeup ç»“æœï¼Œæ— è®ºæœ‰æ²¡æœ‰ IO äº‹ä»¶ï¼Œéƒ½ä¼šè·³è¿‡ switch</span><br>                <span class="hljs-comment">// æ²¡æœ‰ä»»åŠ¡ï¼Œä¼šåŒ¹é… SelectStrategy.SELECTï¼Œçœ‹æ˜¯å¦åº”å½“é˜»å¡</span><br>                <span class="hljs-keyword">switch</span> (selectStrategy.calculateStrategy(selectNowSupplier, hasTasks())) &#123;<br>                    <span class="hljs-keyword">case</span> SelectStrategy.CONTINUE:<br>                        <span class="hljs-keyword">continue</span>;<br><br>                    <span class="hljs-keyword">case</span> SelectStrategy.BUSY_WAIT:<br><br>                    <span class="hljs-keyword">case</span> SelectStrategy.SELECT:<br>                        <span class="hljs-comment">// å› ä¸º IO çº¿ç¨‹å’Œæäº¤ä»»åŠ¡çº¿ç¨‹éƒ½æœ‰å¯èƒ½æ‰§è¡Œ wakeupï¼Œè€Œ wakeup å±äºæ¯”è¾ƒæ˜‚è´µçš„æ“ä½œï¼Œå› æ­¤ä½¿ç”¨äº†ä¸€ä¸ªåŸå­å¸ƒå°”å¯¹è±¡ wakenUpï¼Œå®ƒå–å€¼ä¸º true æ—¶ï¼Œè¡¨ç¤ºè¯¥ç”±å½“å‰çº¿ç¨‹å”¤é†’</span><br>                        <span class="hljs-comment">// è¿›è¡Œ select é˜»å¡ï¼Œå¹¶è®¾ç½®å”¤é†’çŠ¶æ€ä¸º false</span><br>                        <span class="hljs-keyword">boolean</span> oldWakenUp = wakenUp.getAndSet(<span class="hljs-keyword">false</span>);<br>                        <br>                        <span class="hljs-comment">// å¦‚æœåœ¨è¿™ä¸ªä½ç½®ï¼Œé EventLoop çº¿ç¨‹æŠ¢å…ˆå°† wakenUp ç½®ä¸º trueï¼Œå¹¶ wakeup</span><br>                        <span class="hljs-comment">// ä¸‹é¢çš„ select æ–¹æ³•ä¸ä¼šé˜»å¡</span><br>                        <span class="hljs-comment">// ç­‰ runAllTasks å¤„ç†å®Œæˆåï¼Œåˆ°å†å¾ªç¯è¿›æ¥è¿™ä¸ªé˜¶æ®µæ–°å¢çš„ä»»åŠ¡ä¼šä¸ä¼šåŠæ—¶æ‰§è¡Œå‘¢?</span><br>                        <span class="hljs-comment">// å› ä¸º oldWakenUp ä¸º trueï¼Œå› æ­¤ä¸‹é¢çš„ select æ–¹æ³•å°±ä¼šé˜»å¡ï¼Œç›´åˆ°è¶…æ—¶</span><br>                        <span class="hljs-comment">// æ‰èƒ½æ‰§è¡Œï¼Œè®© select æ–¹æ³•æ— è°“é˜»å¡</span><br>                        select(oldWakenUp);<br><br>                        <span class="hljs-keyword">if</span> (wakenUp.get()) &#123;<br>                            selector.wakeup();<br>                        &#125;<br>                    <span class="hljs-keyword">default</span>:<br>                &#125;<br>            &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>                rebuildSelector0();<br>                handleLoopException(e);<br>                <span class="hljs-keyword">continue</span>;<br>            &#125;<br><br>            cancelledKeys = <span class="hljs-number">0</span>;<br>            needsToSelectAgain = <span class="hljs-keyword">false</span>;<br>            <span class="hljs-comment">// ioRatio é»˜è®¤æ˜¯ 50</span><br>            <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> ioRatio = <span class="hljs-keyword">this</span>.ioRatio;<br>            <span class="hljs-keyword">if</span> (ioRatio == <span class="hljs-number">100</span>) &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    processSelectedKeys();<br>                &#125; <span class="hljs-keyword">finally</span> &#123;<br>                    <span class="hljs-comment">// ioRatio ä¸º 100 æ—¶ï¼Œæ€»æ˜¯è¿è¡Œå®Œæ‰€æœ‰é IO ä»»åŠ¡</span><br>                    runAllTasks();<br>                &#125;<br>            &#125; <span class="hljs-keyword">else</span> &#123;                <br>                <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> ioStartTime = System.nanoTime();<br>                <span class="hljs-keyword">try</span> &#123;<br>                    processSelectedKeys(); <span class="hljs-comment">// å¤„ç†æ‰€æœ‰IOäº‹ä»¶</span><br>                &#125; <span class="hljs-keyword">finally</span> &#123;<br>                    <span class="hljs-comment">// è®°å½• io äº‹ä»¶å¤„ç†è€—æ—¶</span><br>                    <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> ioTime = System.nanoTime() - ioStartTime;<br>                    <span class="hljs-comment">// è¿è¡Œé IO ä»»åŠ¡ï¼Œä¸€æ—¦è¶…æ—¶ä¼šé€€å‡º runAllTasks</span><br>                    runAllTasks(ioTime * (<span class="hljs-number">100</span> - ioRatio) / ioRatio); <span class="hljs-comment">// å¤„ç†æ™®é€šä»»åŠ¡</span><br>                &#125;<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (Throwable t) &#123;<br>            handleLoopException(t);<br>        &#125;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">if</span> (isShuttingDown()) &#123;<br>                closeAll();<br>                <span class="hljs-keyword">if</span> (confirmShutdown()) &#123;<br>                    <span class="hljs-keyword">return</span>;<br>                &#125;<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (Throwable t) &#123;<br>            handleLoopException(t);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœæœ‰ä»»åŠ¡ï¼Œé‚£ä¹ˆä¼šè·³å‡ºswitch-caseå—ï¼Œä½†æ˜¯ä¸ºäº†é˜²æ­¢éIOä»»åŠ¡å ç”¨å¤§é‡æ—¶é—´ï¼Œæ‰€ä»¥è®¾è®¡äº†ioratioå˜é‡ï¼ŒioRatio æ§åˆ¶å¤„ç†ioäº‹ä»¶æ‰€å ç”¨çš„æ—¶é—´æ¯”ä¾‹ï¼Œé»˜è®¤æ˜¯50ã€‚</p><p>å¦‚æœioRatioè®¾ç½®ä¸º100ï¼Œé‚£ä¹ˆå°±æ˜¯æ€»æ˜¯è¿è¡Œå®Œæ‰€æœ‰é IO ä»»åŠ¡ã€‚</p></li><li><p>selectedKeys ä¼˜åŒ–æ˜¯æ€ä¹ˆå›äº‹ï¼Ÿ </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">processSelectedKeys</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">if</span> (selectedKeys != <span class="hljs-keyword">null</span>) &#123;<br>        <span class="hljs-comment">// é€šè¿‡åå°„å°† Selector å®ç°ç±»ä¸­çš„å°±ç»ªäº‹ä»¶é›†åˆæ›¿æ¢ä¸º SelectedSelectionKeySet </span><br>        <span class="hljs-comment">// SelectedSelectionKeySet åº•å±‚ä¸ºæ•°ç»„å®ç°ï¼Œå¯ä»¥æé«˜éå†æ€§èƒ½ï¼ˆåŸæœ¬ä¸º HashSetï¼‰</span><br>        processSelectedKeysOptimized();<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        processSelectedKeysPlain(selector.selectedKeys());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç¬¬ä¸€ä¸ªselectoræ˜¯æˆå‘˜å˜é‡unwrappedSelectorï¼ŒåŸæœ¬JDKä¸­çš„selectedKeysçš„åº•å±‚æ˜¯å“ˆå¸Œè¡¨HashSetï¼Œå“ˆå¸Œè¡¨çš„éå†æ—¶é—´å¤æ‚åº¦é«˜ã€‚æ‰€ä»¥Nettyè¿›è¡Œæ”¹è¿›äº†ï¼Œç¬¬äºŒselectoræ˜¯æˆå‘˜å˜é‡selectorï¼Œåº•å±‚çš„selectedKeysæ˜¯æ•°ç»„ï¼Œéå†æ€§èƒ½å¥½ã€‚</p></li><li><p>åœ¨å“ªé‡ŒåŒºåˆ†ä¸åŒäº‹ä»¶ç±»å‹</p><p>åœ¨processSelectedKey()æ–¹æ³•ä¸­åŒºåˆ†ä¸åŒäº‹ä»¶ç±»å‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">processSelectedKey</span><span class="hljs-params">(SelectionKey k, AbstractNioChannel ch)</span> </span>&#123;<br>    <span class="hljs-keyword">final</span> AbstractNioChannel.NioUnsafe unsafe = ch.unsafe();<br>    <span class="hljs-comment">// å½“ key å–æ¶ˆæˆ–å…³é—­æ—¶ä¼šå¯¼è‡´è¿™ä¸ª key æ— æ•ˆ</span><br>    <span class="hljs-keyword">if</span> (!k.isValid()) &#123;<br>        <span class="hljs-comment">// æ— æ•ˆæ—¶å¤„ç†...</span><br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-keyword">int</span> readyOps = k.readyOps();<br>        <span class="hljs-comment">// è¿æ¥äº‹ä»¶</span><br>        <span class="hljs-keyword">if</span> ((readyOps &amp; SelectionKey.OP_CONNECT) != <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">int</span> ops = k.interestOps();<br>            ops &amp;= ~SelectionKey.OP_CONNECT;<br>            k.interestOps(ops);<br><br>            unsafe.finishConnect();<br>        &#125;<br><br>        <span class="hljs-comment">// å¯å†™äº‹ä»¶</span><br>        <span class="hljs-keyword">if</span> ((readyOps &amp; SelectionKey.OP_WRITE) != <span class="hljs-number">0</span>) &#123;<br>            ch.unsafe().forceFlush();<br>        &#125;<br><br>        <span class="hljs-comment">// å¯è¯»æˆ–å¯æ¥å…¥äº‹ä»¶</span><br>        <span class="hljs-keyword">if</span> ((readyOps &amp; (SelectionKey.OP_READ | SelectionKey.OP_ACCEPT)) != <span class="hljs-number">0</span> || readyOps == <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-comment">// å¦‚æœæ˜¯å¯æ¥å…¥ io.netty.channel.nio.AbstractNioMessageChannel.NioMessageUnsafe#read</span><br>            <span class="hljs-comment">// å¦‚æœæ˜¯å¯è¯» io.netty.channel.nio.AbstractNioByteChannel.NioByteUnsafe#read</span><br>            unsafe.read();<br>        &#125;<br>    &#125; <span class="hljs-keyword">catch</span> (CancelledKeyException ignored) &#123;<br>        unsafe.close(unsafe.voidPromise());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li></ol><p>NioEventLoop çº¿ç¨‹ä¸ä»…è¦å¤„ç† IO äº‹ä»¶ï¼Œè¿˜è¦å¤„ç† Taskï¼ˆåŒ…æ‹¬æ™®é€šä»»åŠ¡å’Œå®šæ—¶ä»»åŠ¡ï¼‰ï¼Œ</p><p>æäº¤ä»»åŠ¡ä»£ç  <code>io.netty.util.concurrent.SingleThreadEventExecutor#execute</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">execute</span><span class="hljs-params">(Runnable task)</span> </span>&#123;<br>    <span class="hljs-keyword">if</span> (task == <span class="hljs-keyword">null</span>) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NullPointerException(<span class="hljs-string">&quot;task&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">boolean</span> inEventLoop = inEventLoop();<br>    <span class="hljs-comment">// æ·»åŠ ä»»åŠ¡ï¼Œå…¶ä¸­é˜Ÿåˆ—ä½¿ç”¨äº† jctools æä¾›çš„ mpsc æ— é”é˜Ÿåˆ—</span><br>    addTask(task);<br>    <span class="hljs-keyword">if</span> (!inEventLoop) &#123;<br>        <span class="hljs-comment">// inEventLoop å¦‚æœä¸º false è¡¨ç¤ºç”±å…¶å®ƒçº¿ç¨‹æ¥è°ƒç”¨ executeï¼Œå³é¦–æ¬¡è°ƒç”¨ï¼Œè¿™æ—¶éœ€è¦å‘ eventLoop æäº¤é¦–ä¸ªä»»åŠ¡ï¼Œå¯åŠ¨æ­»å¾ªç¯ï¼Œä¼šæ‰§è¡Œåˆ°ä¸‹é¢çš„ doStartThread</span><br>        startThread();<br>        <span class="hljs-keyword">if</span> (isShutdown()) &#123;<br>            <span class="hljs-comment">// å¦‚æœå·²ç» shutdownï¼Œåšæ‹’ç»é€»è¾‘ï¼Œä»£ç ç•¥...</span><br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (!addTaskWakesUp &amp;&amp; wakesUpForTask(task)) &#123;<br>        <span class="hljs-comment">// å¦‚æœçº¿ç¨‹ç”±äº IO select é˜»å¡äº†ï¼Œæ·»åŠ çš„ä»»åŠ¡çš„çº¿ç¨‹éœ€è¦è´Ÿè´£å”¤é†’ NioEventLoop çº¿ç¨‹</span><br>        wakeup(inEventLoop);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å”¤é†’ select é˜»å¡çº¿ç¨‹<code>io.netty.channel.nio.NioEventLoop#wakeup</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">wakeup</span><span class="hljs-params">(<span class="hljs-keyword">boolean</span> inEventLoop)</span> </span>&#123;<br>    <span class="hljs-comment">// inEventLoopæŒ‡çš„æ˜¯ï¼Œå½“å‰æäº¤ä»»åŠ¡ï¼ˆä¹Ÿå°±æ˜¯æ‰§è¡Œexecuteæ–¹æ³•ï¼‰çš„çº¿ç¨‹æ˜¯å¦æ˜¯Nioçº¿ç¨‹ï¼Œåªæœ‰ä¸æ˜¯Nioçº¿ç¨‹æ‰æœ‰å¯èƒ½è¿›å…¥ifå—</span><br>    <span class="hljs-keyword">if</span> (!inEventLoop &amp;&amp; wakenUp.compareAndSet(<span class="hljs-keyword">false</span>, <span class="hljs-keyword">true</span>)) &#123;<br>        selector.wakeup(); <span class="hljs-comment">// æ‰€ä»¥æäº¤æ™®é€šä»»åŠ¡ä¹Ÿä¼šå”¤é†’Nioçº¿ç¨‹</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯åŠ¨ EventLoop ä¸»å¾ªç¯ <code>io.netty.util.concurrent.SingleThreadEventExecutor#doStartThread</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doStartThread</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">assert</span> thread == <span class="hljs-keyword">null</span>;<br>    executor.execute(<span class="hljs-keyword">new</span> Runnable() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;<br>            <span class="hljs-comment">// å°†çº¿ç¨‹æ± çš„å½“å‰çº¿ç¨‹ï¼ˆå…¶å®å°±æ˜¯NioEventLoopçº¿ç¨‹ï¼‰ä¿å­˜åœ¨æˆå‘˜å˜é‡ä¸­ï¼Œä»¥ä¾¿åç»­ä½¿ç”¨</span><br>            thread = Thread.currentThread();<br>            <span class="hljs-keyword">if</span> (interrupted) &#123;<br>                thread.interrupt();<br>            &#125;<br><br>            <span class="hljs-keyword">boolean</span> success = <span class="hljs-keyword">false</span>;<br>            updateLastExecutionTime();<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-comment">// è°ƒç”¨å¤–éƒ¨ç±» SingleThreadEventExecutor çš„ run æ–¹æ³•ï¼Œè¿›å…¥æ­»å¾ªç¯ï¼Œrun æ–¹æ³•è§ä¸‹</span><br>                SingleThreadEventExecutor.<span class="hljs-keyword">this</span>.run();<br>                success = <span class="hljs-keyword">true</span>;<br>            &#125; <span class="hljs-keyword">catch</span> (Throwable t) &#123;<br>                logger.warn(<span class="hljs-string">&quot;Unexpected exception from an event executor: &quot;</span>, t);<br>            &#125; <span class="hljs-keyword">finally</span> &#123;<br><span class="hljs-comment">// æ¸…ç†å·¥ä½œï¼Œä»£ç ç•¥...</span><br>            &#125;<br>        &#125;<br>    &#125;);<br>&#125;<br></code></pre></td></tr></table></figure><p><code>io.netty.channel.nio.NioEventLoop#run</code> ä¸»è¦ä»»åŠ¡æ˜¯æ‰§è¡Œæ­»å¾ªç¯ï¼Œä¸æ–­çœ‹æœ‰æ²¡æœ‰æ–°ä»»åŠ¡ï¼Œæœ‰æ²¡æœ‰ IO äº‹ä»¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">for</span> (;;) &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-comment">// calculateStrategy çš„é€»è¾‘å¦‚ä¸‹ï¼š</span><br>                <span class="hljs-comment">// æœ‰ä»»åŠ¡ï¼Œä¼šæ‰§è¡Œä¸€æ¬¡ selectNowï¼Œæ¸…é™¤ä¸Šä¸€æ¬¡çš„ wakeup ç»“æœï¼Œæ— è®ºæœ‰æ²¡æœ‰ IO äº‹ä»¶ï¼Œéƒ½ä¼šè·³è¿‡ switch</span><br>                <span class="hljs-comment">// æ²¡æœ‰ä»»åŠ¡ï¼Œä¼šåŒ¹é… SelectStrategy.SELECTï¼Œçœ‹æ˜¯å¦åº”å½“é˜»å¡</span><br>                <span class="hljs-keyword">switch</span> (selectStrategy.calculateStrategy(selectNowSupplier, hasTasks())) &#123;<br>                    <span class="hljs-keyword">case</span> SelectStrategy.CONTINUE:<br>                        <span class="hljs-keyword">continue</span>;<br><br>                    <span class="hljs-keyword">case</span> SelectStrategy.BUSY_WAIT:<br><br>                    <span class="hljs-keyword">case</span> SelectStrategy.SELECT:<br>                        <span class="hljs-comment">// å› ä¸º IO çº¿ç¨‹å’Œæäº¤ä»»åŠ¡çº¿ç¨‹éƒ½æœ‰å¯èƒ½æ‰§è¡Œ wakeupï¼Œè€Œ wakeup å±äºæ¯”è¾ƒæ˜‚è´µçš„æ“ä½œï¼Œå› æ­¤ä½¿ç”¨äº†ä¸€ä¸ªåŸå­å¸ƒå°”å¯¹è±¡ wakenUpï¼Œå®ƒå–å€¼ä¸º true æ—¶ï¼Œè¡¨ç¤ºè¯¥ç”±å½“å‰çº¿ç¨‹å”¤é†’</span><br>                        <span class="hljs-comment">// è¿›è¡Œ select é˜»å¡ï¼Œå¹¶è®¾ç½®å”¤é†’çŠ¶æ€ä¸º false</span><br>                        <span class="hljs-keyword">boolean</span> oldWakenUp = wakenUp.getAndSet(<span class="hljs-keyword">false</span>);<br>                        <br>                        <span class="hljs-comment">// å¦‚æœåœ¨è¿™ä¸ªä½ç½®ï¼Œé EventLoop çº¿ç¨‹æŠ¢å…ˆå°† wakenUp ç½®ä¸º trueï¼Œå¹¶ wakeup</span><br>                        <span class="hljs-comment">// ä¸‹é¢çš„ select æ–¹æ³•ä¸ä¼šé˜»å¡</span><br>                        <span class="hljs-comment">// ç­‰ runAllTasks å¤„ç†å®Œæˆåï¼Œåˆ°å†å¾ªç¯è¿›æ¥è¿™ä¸ªé˜¶æ®µæ–°å¢çš„ä»»åŠ¡ä¼šä¸ä¼šåŠæ—¶æ‰§è¡Œå‘¢?</span><br>                        <span class="hljs-comment">// å› ä¸º oldWakenUp ä¸º trueï¼Œå› æ­¤ä¸‹é¢çš„ select æ–¹æ³•å°±ä¼šé˜»å¡ï¼Œç›´åˆ°è¶…æ—¶</span><br>                        <span class="hljs-comment">// æ‰èƒ½æ‰§è¡Œï¼Œè®© select æ–¹æ³•æ— è°“é˜»å¡</span><br>                        select(oldWakenUp);<br><br>                        <span class="hljs-keyword">if</span> (wakenUp.get()) &#123;<br>                            selector.wakeup();<br>                        &#125;<br>                    <span class="hljs-keyword">default</span>:<br>                &#125;<br>            &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>                rebuildSelector0();<br>                handleLoopException(e);<br>                <span class="hljs-keyword">continue</span>;<br>            &#125;<br><br>            cancelledKeys = <span class="hljs-number">0</span>;<br>            needsToSelectAgain = <span class="hljs-keyword">false</span>;<br>            <span class="hljs-comment">// ioRatio é»˜è®¤æ˜¯ 50</span><br>            <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> ioRatio = <span class="hljs-keyword">this</span>.ioRatio;<br>            <span class="hljs-keyword">if</span> (ioRatio == <span class="hljs-number">100</span>) &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    processSelectedKeys();<br>                &#125; <span class="hljs-keyword">finally</span> &#123;<br>                    <span class="hljs-comment">// ioRatio ä¸º 100 æ—¶ï¼Œæ€»æ˜¯è¿è¡Œå®Œæ‰€æœ‰é IO ä»»åŠ¡</span><br>                    runAllTasks();<br>                &#125;<br>            &#125; <span class="hljs-keyword">else</span> &#123;                <br>                <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> ioStartTime = System.nanoTime();<br>                <span class="hljs-keyword">try</span> &#123;<br>                    processSelectedKeys(); <span class="hljs-comment">// å¤„ç†æ‰€æœ‰IOäº‹ä»¶</span><br>                &#125; <span class="hljs-keyword">finally</span> &#123;<br>                    <span class="hljs-comment">// è®°å½• io äº‹ä»¶å¤„ç†è€—æ—¶</span><br>                    <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> ioTime = System.nanoTime() - ioStartTime;<br>                    <span class="hljs-comment">// è¿è¡Œé IO ä»»åŠ¡ï¼Œä¸€æ—¦è¶…æ—¶ä¼šé€€å‡º runAllTasks</span><br>                    runAllTasks(ioTime * (<span class="hljs-number">100</span> - ioRatio) / ioRatio); <span class="hljs-comment">// å¤„ç†æ™®é€šä»»åŠ¡</span><br>                &#125;<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (Throwable t) &#123;<br>            handleLoopException(t);<br>        &#125;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">if</span> (isShuttingDown()) &#123;<br>                closeAll();<br>                <span class="hljs-keyword">if</span> (confirmShutdown()) &#123;<br>                    <span class="hljs-keyword">return</span>;<br>                &#125;<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (Throwable t) &#123;<br>            handleLoopException(t);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="âš ï¸-æ³¨æ„"><a href="#âš ï¸-æ³¨æ„" class="headerlink" title="âš ï¸ æ³¨æ„"></a>âš ï¸ æ³¨æ„</h4><blockquote><p>è¿™é‡Œæœ‰ä¸ªè´¹è§£çš„åœ°æ–¹å°±æ˜¯ wakeupï¼Œå®ƒæ—¢å¯ä»¥ç”±æäº¤ä»»åŠ¡çš„çº¿ç¨‹æ¥è°ƒç”¨ï¼ˆæ¯”è¾ƒå¥½ç†è§£ï¼‰ï¼Œä¹Ÿå¯ä»¥ç”± EventLoop çº¿ç¨‹æ¥è°ƒç”¨ï¼ˆæ¯”è¾ƒè´¹è§£ï¼‰ï¼Œè¿™é‡Œè¦çŸ¥é“ wakeup æ–¹æ³•çš„æ•ˆæœï¼š</p><ul><li>ç”±é EventLoop çº¿ç¨‹è°ƒç”¨ï¼Œä¼šå”¤é†’å½“å‰åœ¨æ‰§è¡Œ select é˜»å¡çš„ EventLoop çº¿ç¨‹</li><li>ç”± EventLoop è‡ªå·±è°ƒç”¨ï¼Œæœ¬æ¬¡çš„ wakeup ä¼šå–æ¶ˆä¸‹ä¸€æ¬¡çš„ select æ“ä½œ</li></ul></blockquote><p>å‚è€ƒä¸‹å›¾</p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/0032.png"  /><p><code>io.netty.channel.nio.NioEventLoop#select</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">select</span><span class="hljs-params">(<span class="hljs-keyword">boolean</span> oldWakenUp)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>    Selector selector = <span class="hljs-keyword">this</span>.selector;<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-keyword">int</span> selectCnt = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">long</span> currentTimeNanos = System.nanoTime();<br>        <span class="hljs-comment">// è®¡ç®—ç­‰å¾…æ—¶é—´</span><br>        <span class="hljs-comment">// * æ²¡æœ‰ scheduledTaskï¼Œè¶…æ—¶æ—¶é—´ä¸º 1s</span><br>        <span class="hljs-comment">// * æœ‰ scheduledTaskï¼Œè¶…æ—¶æ—¶é—´ä¸º `ä¸‹ä¸€ä¸ªå®šæ—¶ä»»åŠ¡æ‰§è¡Œæ—¶é—´ - å½“å‰æ—¶é—´`</span><br>        <span class="hljs-keyword">long</span> selectDeadLineNanos = currentTimeNanos + delayNanos(currentTimeNanos);<br><br>        <span class="hljs-keyword">for</span> (;;) &#123;<br>            <span class="hljs-keyword">long</span> timeoutMillis = (selectDeadLineNanos - currentTimeNanos + <span class="hljs-number">500000L</span>) / <span class="hljs-number">1000000L</span>; <br>            <span class="hljs-comment">// å¦‚æœæ²¡æœ‰scheduleTaské‚£ä¹ˆåªä¼šæœ€å¤§é˜»å¡æ—¶é—´å°±æ˜¯ 1s + 0.5ms</span><br>            <span class="hljs-comment">// å¦‚æœè¶…æ—¶ï¼Œé€€å‡ºå¾ªç¯</span><br>            <span class="hljs-keyword">if</span> (timeoutMillis &lt;= <span class="hljs-number">0</span>) &#123;<br>                <span class="hljs-keyword">if</span> (selectCnt == <span class="hljs-number">0</span>) &#123;<br>                    selector.selectNow();<br>                    selectCnt = <span class="hljs-number">1</span>;<br>                &#125;<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br><br>            <span class="hljs-comment">// å¦‚æœæœŸé—´åˆæœ‰ task é€€å‡ºå¾ªç¯ï¼Œå¦‚æœæ²¡è¿™ä¸ªåˆ¤æ–­ï¼Œé‚£ä¹ˆä»»åŠ¡å°±ä¼šç­‰åˆ°ä¸‹æ¬¡ select è¶…æ—¶æ—¶æ‰èƒ½è¢«æ‰§è¡Œ</span><br>            <span class="hljs-comment">// wakenUp.compareAndSet(false, true) æ˜¯è®©é NioEventLoop ä¸å¿…å†æ‰§è¡Œ wakeup</span><br>            <span class="hljs-keyword">if</span> (hasTasks() &amp;&amp; wakenUp.compareAndSet(<span class="hljs-keyword">false</span>, <span class="hljs-keyword">true</span>)) &#123;<br>                selector.selectNow();<br>                selectCnt = <span class="hljs-number">1</span>;<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br><br>            <span class="hljs-comment">// select æœ‰é™æ—¶é˜»å¡</span><br>            <span class="hljs-comment">// æ³¨æ„ nio æœ‰ bugï¼Œå½“ bug å‡ºç°æ—¶ï¼Œselect æ–¹æ³•å³ä½¿æ²¡æœ‰æ—¶é—´å‘ç”Ÿï¼Œä¹Ÿä¸ä¼šé˜»å¡ä½ï¼Œå¯¼è‡´ä¸æ–­ç©ºè½®è¯¢ï¼Œcpu å ç”¨ 100%</span><br>            <span class="hljs-keyword">int</span> selectedKeys = selector.select(timeoutMillis);<br>            <span class="hljs-comment">// è®¡æ•°åŠ  1</span><br>            selectCnt ++;<br><br>            <span class="hljs-comment">// é†’æ¥åï¼Œå¦‚æœæœ‰ IO äº‹ä»¶ã€æˆ–æ˜¯ç”±é EventLoop çº¿ç¨‹å”¤é†’ï¼Œæˆ–è€…æœ‰ä»»åŠ¡ï¼Œé€€å‡ºå¾ªç¯</span><br>            <span class="hljs-keyword">if</span> (selectedKeys != <span class="hljs-number">0</span> || oldWakenUp || wakenUp.get() || hasTasks() || hasScheduledTasks()) &#123;<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>            <span class="hljs-keyword">if</span> (Thread.interrupted()) &#123;<br>               <span class="hljs-comment">// çº¿ç¨‹è¢«æ‰“æ–­ï¼Œé€€å‡ºå¾ªç¯</span><br>                <span class="hljs-comment">// è®°å½•æ—¥å¿—</span><br>                selectCnt = <span class="hljs-number">1</span>;<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br><br>            <span class="hljs-keyword">long</span> time = System.nanoTime();<br>            <span class="hljs-keyword">if</span> (time - TimeUnit.MILLISECONDS.toNanos(timeoutMillis) &gt;= currentTimeNanos) &#123;<br>                <span class="hljs-comment">// å¦‚æœè¶…æ—¶ï¼Œè®¡æ•°é‡ç½®ä¸º 1ï¼Œä¸‹æ¬¡å¾ªç¯å°±ä¼š break</span><br>                selectCnt = <span class="hljs-number">1</span>;<br>            &#125; <br>            <span class="hljs-comment">// è®¡æ•°è¶…è¿‡é˜ˆå€¼ï¼Œç”± io.netty.selectorAutoRebuildThreshold æŒ‡å®šï¼Œé»˜è®¤ 512</span><br>            <span class="hljs-comment">// è¿™æ˜¯ä¸ºäº†è§£å†³ nio ç©ºè½®è¯¢ bug</span><br>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (SELECTOR_AUTO_REBUILD_THRESHOLD &gt; <span class="hljs-number">0</span> &amp;&amp;<br>                    selectCnt &gt;= SELECTOR_AUTO_REBUILD_THRESHOLD) &#123;<br>                <span class="hljs-comment">// é‡å»º selector</span><br>                selector = selectRebuildSelector(selectCnt);<br>                selectCnt = <span class="hljs-number">1</span>;<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br><br>            currentTimeNanos = time;<br>        &#125;<br><br>        <span class="hljs-keyword">if</span> (selectCnt &gt; MIN_PREMATURE_SELECTOR_RETURNS) &#123;<br>            <span class="hljs-comment">// è®°å½•æ—¥å¿—</span><br>        &#125;<br>    &#125; <span class="hljs-keyword">catch</span> (CancelledKeyException e) &#123;<br>        <span class="hljs-comment">// è®°å½•æ—¥å¿—</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¤„ç† keys <code>io.netty.channel.nio.NioEventLoop#processSelectedKeys</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">processSelectedKeys</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">if</span> (selectedKeys != <span class="hljs-keyword">null</span>) &#123;<br>        <span class="hljs-comment">// é€šè¿‡åå°„å°† Selector å®ç°ç±»ä¸­çš„å°±ç»ªäº‹ä»¶é›†åˆæ›¿æ¢ä¸º SelectedSelectionKeySet </span><br>        <span class="hljs-comment">// SelectedSelectionKeySet åº•å±‚ä¸ºæ•°ç»„å®ç°ï¼Œå¯ä»¥æé«˜éå†æ€§èƒ½ï¼ˆåŸæœ¬ä¸º HashSetï¼‰</span><br>        processSelectedKeysOptimized();<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        processSelectedKeysPlain(selector.selectedKeys());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>io.netty.channel.nio.NioEventLoop#processSelectedKey</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">processSelectedKey</span><span class="hljs-params">(SelectionKey k, AbstractNioChannel ch)</span> </span>&#123;<br>    <span class="hljs-keyword">final</span> AbstractNioChannel.NioUnsafe unsafe = ch.unsafe();<br>    <span class="hljs-comment">// å½“ key å–æ¶ˆæˆ–å…³é—­æ—¶ä¼šå¯¼è‡´è¿™ä¸ª key æ— æ•ˆ</span><br>    <span class="hljs-keyword">if</span> (!k.isValid()) &#123;<br>        <span class="hljs-comment">// æ— æ•ˆæ—¶å¤„ç†...</span><br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-keyword">int</span> readyOps = k.readyOps();<br>        <span class="hljs-comment">// è¿æ¥äº‹ä»¶</span><br>        <span class="hljs-keyword">if</span> ((readyOps &amp; SelectionKey.OP_CONNECT) != <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">int</span> ops = k.interestOps();<br>            ops &amp;= ~SelectionKey.OP_CONNECT;<br>            k.interestOps(ops);<br><br>            unsafe.finishConnect();<br>        &#125;<br><br>        <span class="hljs-comment">// å¯å†™äº‹ä»¶</span><br>        <span class="hljs-keyword">if</span> ((readyOps &amp; SelectionKey.OP_WRITE) != <span class="hljs-number">0</span>) &#123;<br>            ch.unsafe().forceFlush();<br>        &#125;<br><br>        <span class="hljs-comment">// å¯è¯»æˆ–å¯æ¥å…¥äº‹ä»¶</span><br>        <span class="hljs-keyword">if</span> ((readyOps &amp; (SelectionKey.OP_READ | SelectionKey.OP_ACCEPT)) != <span class="hljs-number">0</span> || readyOps == <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-comment">// å¦‚æœæ˜¯å¯æ¥å…¥ io.netty.channel.nio.AbstractNioMessageChannel.NioMessageUnsafe#read</span><br>            <span class="hljs-comment">// å¦‚æœæ˜¯å¯è¯» io.netty.channel.nio.AbstractNioByteChannel.NioByteUnsafe#read</span><br>            unsafe.read();<br>        &#125;<br>    &#125; <span class="hljs-keyword">catch</span> (CancelledKeyException ignored) &#123;<br>        unsafe.close(unsafe.voidPromise());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2-3-accept-å‰–æ"><a href="#2-3-accept-å‰–æ" class="headerlink" title="2.3 accept å‰–æ"></a>2.3 accept å‰–æ</h3><p>accept æµç¨‹ï¼š</p><ul><li><p>Step1: selector.select()é˜»å¡ç›´åˆ°äº‹ä»¶å‘ç”Ÿ </p></li><li><p>Step2: éå†å¤„ç† selectedKeys </p></li><li><p>Step3: æ‹¿åˆ°ä¸€ä¸ª keyï¼Œåˆ¤æ–­äº‹ä»¶ç±»å‹æ˜¯å¦ä¸ºaccept </p></li><li><p>Step4: åˆ›å»º SocketChannelï¼Œ è®¾ç½®éé˜»å¡ ï¼Œå³åˆ›å»ºNioSocketChannel</p></li><li><p>Step5: å°†SocketChannel æ³¨å†Œè‡³ selector </p><p>sc.register(eventLoopçš„é€‰æ‹©å™¨,0, NioSocketChannelï¼‰</p><p>è°ƒç”¨NioSocketChannel ä¸Šçš„åˆå§‹åŒ–å™¨ï¼Œå³ç»™SocketChannelåŠ ä¸Šä¸€äº›handler</p></li><li><p>Step6: å…³æ³¨ selection Key çš„ readäº‹ä»¶</p></li></ul><p>nio ä¸­å¦‚ä¸‹ä»£ç ï¼Œåœ¨ netty ä¸­çš„æµç¨‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//1 é˜»å¡ç›´åˆ°äº‹ä»¶å‘ç”Ÿ</span><br>selector.select();<br><br>Iterator&lt;SelectionKey&gt; iter = selector.selectedKeys().iterator();<br><span class="hljs-keyword">while</span> (iter.hasNext()) &#123;    <br>    <span class="hljs-comment">//2 æ‹¿åˆ°ä¸€ä¸ªäº‹ä»¶</span><br>    SelectionKey key = iter.next();<br>    <br>    <span class="hljs-comment">//3 å¦‚æœæ˜¯ accept äº‹ä»¶</span><br>    <span class="hljs-keyword">if</span> (key.isAcceptable()) &#123;<br>        <br>        <span class="hljs-comment">//4 æ‰§è¡Œ accept</span><br>        SocketChannel channel = serverSocketChannel.accept();<br>        channel.configureBlocking(<span class="hljs-keyword">false</span>);<br>        <br>        <span class="hljs-comment">//5 å…³æ³¨ read äº‹ä»¶</span><br>        channel.register(selector, SelectionKey.OP_READ);<br>    &#125;<br>    <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure><p>Step1 - 3,åœ¨NioEventLoopé‡Œé¢å·²ç»è®²æ˜ï¼Œæ¥ä¸‹æ¥ä»Step4å¼€å§‹è®²èµ·ï¼Œå³NioEventLoopä¸­çš„processSelectedKey()ä¸­çš„unsafe.read()æ–¹æ³•è®²èµ·ã€‚</p><p>å…ˆæ¥çœ‹å¯æ¥å…¥äº‹ä»¶å¤„ç†ï¼ˆacceptï¼‰</p><p><code>io.netty.channel.nio.AbstractNioMessageChannel.NioMessageUnsafe#read</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">read</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">assert</span> <span class="hljs-title">eventLoop</span><span class="hljs-params">()</span>.<span class="hljs-title">inEventLoop</span><span class="hljs-params">()</span></span>;<br>    <span class="hljs-keyword">final</span> ChannelConfig config = config();<br>    <span class="hljs-keyword">final</span> ChannelPipeline pipeline = pipeline();    <br>    <span class="hljs-keyword">final</span> RecvByteBufAllocator.Handle allocHandle = unsafe().recvBufAllocHandle();<br>    allocHandle.reset(config);<br><br>    <span class="hljs-keyword">boolean</span> closed = <span class="hljs-keyword">false</span>;<br>    Throwable exception = <span class="hljs-keyword">null</span>;<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">do</span> &#123;<br><span class="hljs-comment">// doReadMessages ä¸­æ‰§è¡Œäº† accept å¹¶åˆ›å»º NioSocketChannel ä½œä¸ºæ¶ˆæ¯æ”¾å…¥ readBufï¼Œå®ŒæˆStep4</span><br>                <span class="hljs-comment">// readBuf æ˜¯ä¸€ä¸ª ArrayList ç”¨æ¥ç¼“å­˜æ¶ˆæ¯</span><br>                <span class="hljs-keyword">int</span> localRead = doReadMessages(readBuf);<br>                <span class="hljs-keyword">if</span> (localRead == <span class="hljs-number">0</span>) &#123;<br>                    <span class="hljs-keyword">break</span>;<br>                &#125;<br>                <span class="hljs-keyword">if</span> (localRead &lt; <span class="hljs-number">0</span>) &#123;<br>                    closed = <span class="hljs-keyword">true</span>;<br>                    <span class="hljs-keyword">break</span>;<br>                &#125;<br><span class="hljs-comment">// localRead ä¸º 1ï¼Œå°±ä¸€æ¡æ¶ˆæ¯ï¼Œå³æ¥æ”¶ä¸€ä¸ªå®¢æˆ·ç«¯è¿æ¥</span><br>                allocHandle.incMessagesRead(localRead);<br>            &#125; <span class="hljs-keyword">while</span> (allocHandle.continueReading());<br>        &#125; <span class="hljs-keyword">catch</span> (Throwable t) &#123;<br>            exception = t;<br>        &#125;<br><br>        <span class="hljs-keyword">int</span> size = readBuf.size();<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; size; i ++) &#123;<br>            readPending = <span class="hljs-keyword">false</span>;<br>            <span class="hljs-comment">// è§¦å‘ read äº‹ä»¶ï¼Œè®© pipeline ä¸Šçš„ handler å¤„ç†ï¼Œä»head handlerå¼€å§‹ï¼Œåˆ°tail handlerç»“æŸï¼Œä¸­é—´æœ‰ä¸€ä¸ªaccept handleræ¥å¤„ç†acceptäº‹ä»¶ï¼Œè¿™ä¸ªaccept handleræ˜¯åœ¨å¯åŠ¨æµç¨‹ä¸­åŠ å…¥åˆ°ServerSocketChannelçš„pipelineä¸Šçš„ã€‚å³io.netty.bootstrap.ServerBootstrap.ServerBootstrapAcceptor#channelRead</span><br>            pipeline.fireChannelRead(readBuf.get(i));<br>        &#125;<br>        readBuf.clear();<br>        allocHandle.readComplete();<br>        pipeline.fireChannelReadComplete();<br><br>        <span class="hljs-keyword">if</span> (exception != <span class="hljs-keyword">null</span>) &#123;<br>            closed = closeOnReadError(exception);<br><br>            pipeline.fireExceptionCaught(exception);<br>        &#125;<br><br>        <span class="hljs-keyword">if</span> (closed) &#123;<br>            inputShutdown = <span class="hljs-keyword">true</span>;<br>            <span class="hljs-keyword">if</span> (isOpen()) &#123;<br>                close(voidPromise());<br>            &#125;<br>        &#125;<br>    &#125; <span class="hljs-keyword">finally</span> &#123;<br>        <span class="hljs-keyword">if</span> (!readPending &amp;&amp; !config.isAutoRead()) &#123;<br>            removeReadOp();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å…³é”®ä»£ç  <code>io.netty.bootstrap.ServerBootstrap.ServerBootstrapAcceptor#channelRead</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">channelRead</span><span class="hljs-params">(ChannelHandlerContext ctx, Object msg)</span> </span>&#123;<br>    <span class="hljs-comment">// è¿™æ—¶çš„ msg æ˜¯ NioSocketChannel</span><br>    <span class="hljs-keyword">final</span> Channel child = (Channel) msg;<br><br>    <span class="hljs-comment">// NioSocketChannel æ·»åŠ   childHandler å³åˆå§‹åŒ–å™¨</span><br>    child.pipeline().addLast(childHandler);<br><br>    <span class="hljs-comment">// è®¾ç½®é€‰é¡¹</span><br>    setChannelOptions(child, childOptions, logger);<br><br>    <span class="hljs-keyword">for</span> (Entry&lt;AttributeKey&lt;?&gt;, Object&gt; e: childAttrs) &#123;<br>        child.attr((AttributeKey&lt;Object&gt;) e.getKey()).set(e.getValue());<br>    &#125;<br><br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-comment">// æ³¨å†Œ NioSocketChannel åˆ° nio worker çº¿ç¨‹ï¼ˆè¿™é‡Œé¢ä¹ŸåŒ…æ‹¬å°†NioSocketChannelæ³¨å†Œåˆ°selectorä¸Šï¼‰ï¼Œæ¥ä¸‹æ¥çš„å¤„ç†ä¹Ÿç§»äº¤è‡³ nio worker çº¿ç¨‹ï¼Œå®ŒæˆStep5</span><br>        childGroup.register(child).addListener(<span class="hljs-keyword">new</span> ChannelFutureListener() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">operationComplete</span><span class="hljs-params">(ChannelFuture future)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>                <span class="hljs-keyword">if</span> (!future.isSuccess()) &#123;<br>                    forceClose(child, future.cause());<br>                &#125;<br>            &#125;<br>        &#125;);<br>    &#125; <span class="hljs-keyword">catch</span> (Throwable t) &#123;<br>        forceClose(child, t);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åˆå›åˆ°äº†ç†Ÿæ‚‰çš„ <code>io.netty.channel.AbstractChannel.AbstractUnsafe#register</code>  æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title">register</span><span class="hljs-params">(EventLoop eventLoop, <span class="hljs-keyword">final</span> ChannelPromise promise)</span> </span>&#123;<br>    <span class="hljs-comment">// ä¸€äº›æ£€æŸ¥ï¼Œç•¥...</span><br><br>    AbstractChannel.<span class="hljs-keyword">this</span>.eventLoop = eventLoop;<br><br>    <span class="hljs-keyword">if</span> (eventLoop.inEventLoop()) &#123;<br>        register0(promise);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// è¿™è¡Œä»£ç å®Œæˆçš„äº‹æƒ…æ˜¯ nio boss -&gt; nio worker çº¿ç¨‹çš„åˆ‡æ¢</span><br>            eventLoop.execute(<span class="hljs-keyword">new</span> Runnable() &#123;<br>                <span class="hljs-meta">@Override</span><br>                <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;<br>                    register0(promise);<br>                &#125;<br>            &#125;);<br>        &#125; <span class="hljs-keyword">catch</span> (Throwable t) &#123;<br>            <span class="hljs-comment">// æ—¥å¿—è®°å½•...</span><br>            closeForcibly();<br>            closeFuture.setClosed();<br>            safeSetFailure(promise, t);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>io.netty.channel.AbstractChannel.AbstractUnsafe#register0</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">register0</span><span class="hljs-params">(ChannelPromise promise)</span> </span>&#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-keyword">if</span> (!promise.setUncancellable() || !ensureOpen(promise)) &#123;<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        <span class="hljs-keyword">boolean</span> firstRegistration = neverRegistered;<br>        doRegister();<br>        neverRegistered = <span class="hljs-keyword">false</span>;<br>        registered = <span class="hljs-keyword">true</span>;<br><br>        <span class="hljs-comment">// æ‰§è¡Œåˆå§‹åŒ–å™¨ï¼Œæ‰§è¡Œå‰ pipeline ä¸­åªæœ‰ head -&gt; åˆå§‹åŒ–å™¨ -&gt; tail</span><br>        pipeline.invokeHandlerAddedIfNeeded(); <span class="hljs-comment">// è§¦å‘SocketChannelä¸Šçš„åˆå§‹åŒ–æ“ä½œã€‚</span><br>        <span class="hljs-comment">// æ‰§è¡Œåå°±æ˜¯ head -&gt; logging handler -&gt; my handler -&gt; tail</span><br><br>        safeSetSuccess(promise);<br>        pipeline.fireChannelRegistered();<br>        <br>        <span class="hljs-keyword">if</span> (isActive()) &#123;<br>            <span class="hljs-keyword">if</span> (firstRegistration) &#123;<br>                <span class="hljs-comment">// è§¦å‘ pipeline ä¸Š active äº‹ä»¶</span><br>                pipeline.fireChannelActive(); <span class="hljs-comment">// å…³æ³¨ selection Key çš„ readäº‹ä»¶ä¸Šï¼Œå®ŒæˆStep6</span><br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (config().isAutoRead()) &#123;<br>                beginRead();<br>            &#125;<br>        &#125;<br>    &#125; <span class="hljs-keyword">catch</span> (Throwable t) &#123;<br>        closeForcibly();<br>        closeFuture.setClosed();<br>        safeSetFailure(promise, t);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å›åˆ°äº†ç†Ÿæ‚‰çš„ä»£ç  <code>io.netty.channel.DefaultChannelPipeline.HeadContext#channelActive</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">channelActive</span><span class="hljs-params">(ChannelHandlerContext ctx)</span> </span>&#123;<br>    ctx.fireChannelActive();<br><span class="hljs-comment">// è§¦å‘ read (NioSocketChannel è¿™é‡Œ readï¼Œåªæ˜¯ä¸ºäº†è§¦å‘ channel çš„äº‹ä»¶æ³¨å†Œï¼Œè¿˜æœªæ¶‰åŠæ•°æ®è¯»å–)</span><br>    readIfIsAutoRead();<br>&#125;<br></code></pre></td></tr></table></figure><p><code>io.netty.channel.nio.AbstractNioChannel#doBeginRead</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doBeginRead</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>    <span class="hljs-comment">// Channel.read() or ChannelHandlerContext.read() was called</span><br>    <span class="hljs-keyword">final</span> SelectionKey selectionKey = <span class="hljs-keyword">this</span>.selectionKey;<br>    <span class="hljs-keyword">if</span> (!selectionKey.isValid()) &#123;<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br><br>    readPending = <span class="hljs-keyword">true</span>;<br><span class="hljs-comment">// è¿™æ—¶å€™ interestOps æ˜¯ 0</span><br>    <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> interestOps = selectionKey.interestOps();<br>    <span class="hljs-keyword">if</span> ((interestOps &amp; readInterestOp) == <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-comment">// å…³æ³¨ read äº‹ä»¶</span><br>        selectionKey.interestOps(interestOps | readInterestOp);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2-4-read-å‰–æ"><a href="#2-4-read-å‰–æ" class="headerlink" title="2.4 read å‰–æ"></a>2.4 read å‰–æ</h3><p>read æµç¨‹ </p><ul><li>selector.select()é˜»å¡ç›´åˆ°äº‹ä»¶å‘ç”Ÿ </li><li>éå†å¤„ç† selectedKeys </li><li>æ‹¿åˆ°ä¸€ä¸ªkeyï¼Œåˆ¤æ–­äº‹ä»¶ç±»å‹æ˜¯å¦ä¸ºread </li><li>è¯»å–æ“ä½œ</li></ul><p>å†æ¥çœ‹å¯è¯»äº‹ä»¶ <code>io.netty.channel.nio.AbstractNioByteChannel.NioByteUnsafe#read</code>ï¼Œæ³¨æ„å‘é€çš„æ•°æ®æœªå¿…èƒ½å¤Ÿä¸€æ¬¡è¯»å®Œï¼Œå› æ­¤ä¼šè§¦å‘å¤šæ¬¡ nio read äº‹ä»¶ï¼Œä¸€æ¬¡äº‹ä»¶å†…ä¼šè§¦å‘å¤šæ¬¡ pipeline readï¼Œä¸€æ¬¡äº‹ä»¶ä¼šè§¦å‘ä¸€æ¬¡ pipeline read complete</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title">read</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">final</span> ChannelConfig config = config();<br>    <span class="hljs-keyword">if</span> (shouldBreakReadReady(config)) &#123;<br>        clearReadPending();<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-keyword">final</span> ChannelPipeline pipeline = pipeline();<br>    <span class="hljs-comment">// io.netty.allocator.type å†³å®š allocator çš„å®ç°</span><br>    <span class="hljs-keyword">final</span> ByteBufAllocator allocator = config.getAllocator();<br>    <span class="hljs-comment">// ç”¨æ¥åˆ†é… byteBufï¼Œç¡®å®šå•æ¬¡è¯»å–å¤§å°</span><br>    <span class="hljs-keyword">final</span> RecvByteBufAllocator.Handle allocHandle = recvBufAllocHandle();<br>    allocHandle.reset(config);<br><br>    ByteBuf byteBuf = <span class="hljs-keyword">null</span>;<br>    <span class="hljs-keyword">boolean</span> close = <span class="hljs-keyword">false</span>;<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-keyword">do</span> &#123;<br>            byteBuf = allocHandle.allocate(allocator);<br>            <span class="hljs-comment">// è¯»å–</span><br>            allocHandle.lastBytesRead(doReadBytes(byteBuf));<br>            <span class="hljs-keyword">if</span> (allocHandle.lastBytesRead() &lt;= <span class="hljs-number">0</span>) &#123;<br>                byteBuf.release();<br>                byteBuf = <span class="hljs-keyword">null</span>;<br>                close = allocHandle.lastBytesRead() &lt; <span class="hljs-number">0</span>;<br>                <span class="hljs-keyword">if</span> (close) &#123;<br>                    readPending = <span class="hljs-keyword">false</span>;<br>                &#125;<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br><br>            allocHandle.incMessagesRead(<span class="hljs-number">1</span>);<br>            readPending = <span class="hljs-keyword">false</span>;<br>            <span class="hljs-comment">// è§¦å‘ read äº‹ä»¶ï¼Œè®© pipeline ä¸Šçš„ handler å¤„ç†ï¼Œè¿™æ—¶æ˜¯å¤„ç† NioSocketChannel ä¸Šçš„ handler</span><br>            pipeline.fireChannelRead(byteBuf);<br>            byteBuf = <span class="hljs-keyword">null</span>;<br>        &#125; <br>        <span class="hljs-comment">// æ˜¯å¦è¦ç»§ç»­å¾ªç¯</span><br>        <span class="hljs-keyword">while</span> (allocHandle.continueReading());<br><br>        allocHandle.readComplete();<br>        <span class="hljs-comment">// è§¦å‘ read complete äº‹ä»¶</span><br>        pipeline.fireChannelReadComplete();<br><br>        <span class="hljs-keyword">if</span> (close) &#123;<br>            closeOnRead(pipeline);<br>        &#125;<br>    &#125; <span class="hljs-keyword">catch</span> (Throwable t) &#123;<br>        handleReadException(pipeline, byteBuf, t, close, allocHandle);<br>    &#125; <span class="hljs-keyword">finally</span> &#123;<br>        <span class="hljs-keyword">if</span> (!readPending &amp;&amp; !config.isAutoRead()) &#123;<br>            removeReadOp();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>io.netty.channel.DefaultMaxMessagesRecvByteBufAllocator.MaxMessageHandle#continueReading(io.netty.util.UncheckedBooleanSupplier)</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">continueReading</span><span class="hljs-params">(UncheckedBooleanSupplier maybeMoreDataSupplier)</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> <br>           <span class="hljs-comment">// ä¸€èˆ¬ä¸º true</span><br>           config.isAutoRead() &amp;&amp;<br>           <span class="hljs-comment">// respectMaybeMoreData é»˜è®¤ä¸º true</span><br>           <span class="hljs-comment">// maybeMoreDataSupplier çš„é€»è¾‘æ˜¯å¦‚æœé¢„æœŸè¯»å–å­—èŠ‚ä¸å®é™…è¯»å–å­—èŠ‚ç›¸ç­‰ï¼Œè¿”å› true</span><br>           (!respectMaybeMoreData || maybeMoreDataSupplier.get()) &amp;&amp;<br>           <span class="hljs-comment">// å°äºæœ€å¤§æ¬¡æ•°ï¼ŒmaxMessagePerRead é»˜è®¤ 16</span><br>           totalMessages &lt; maxMessagePerRead &amp;&amp;<br>           <span class="hljs-comment">// å®é™…è¯»åˆ°äº†æ•°æ®</span><br>           totalBytesRead &gt; <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Netty</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Netty</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MySQLåŸºç¡€</title>
    <link href="/2022/03/25/MySQL%E5%9F%BA%E7%A1%80/"/>
    <url>/2022/03/25/MySQL%E5%9F%BA%E7%A1%80/</url>
    
    <content type="html"><![CDATA[<h1 id="ç¬¬01ç« -æ•°æ®åº“æ¦‚è¿°"><a href="#ç¬¬01ç« -æ•°æ®åº“æ¦‚è¿°" class="headerlink" title="ç¬¬01ç« _æ•°æ®åº“æ¦‚è¿°"></a>ç¬¬01ç« _æ•°æ®åº“æ¦‚è¿°</h1><h2 id="1-ä¸ºä»€ä¹ˆè¦ä½¿ç”¨æ•°æ®åº“"><a href="#1-ä¸ºä»€ä¹ˆè¦ä½¿ç”¨æ•°æ®åº“" class="headerlink" title="1. ä¸ºä»€ä¹ˆè¦ä½¿ç”¨æ•°æ®åº“"></a>1. ä¸ºä»€ä¹ˆè¦ä½¿ç”¨æ•°æ®åº“</h2><ul><li>æŒä¹…åŒ–(persistence)ï¼š<strong>æŠŠæ•°æ®ä¿å­˜åˆ°å¯æ‰ç”µå¼å­˜å‚¨è®¾å¤‡ä¸­ä»¥ä¾›ä¹‹åä½¿ç”¨</strong>ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œç‰¹åˆ«æ˜¯ä¼ä¸šçº§åº”ç”¨ï¼Œ<strong>æ•°æ®æŒä¹…åŒ–æ„å‘³ç€å°†å†…å­˜ä¸­çš„æ•°æ®ä¿å­˜åˆ°ç¡¬ç›˜ä¸ŠåŠ ä»¥â€å›ºåŒ–â€</strong>ï¼Œè€ŒæŒä¹…åŒ–çš„å®ç°è¿‡ç¨‹å¤§å¤šé€šè¿‡å„ç§å…³ç³»æ•°æ®åº“æ¥å®Œæˆã€‚</li><li>æŒä¹…åŒ–çš„ä¸»è¦ä½œç”¨æ˜¯<strong>å°†å†…å­˜ä¸­çš„æ•°æ®å­˜å‚¨åœ¨å…³ç³»å‹æ•°æ®åº“ä¸­</strong>ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥å­˜å‚¨åœ¨ç£ç›˜æ–‡ä»¶ã€XMLæ•°æ®æ–‡ä»¶ä¸­ã€‚</li></ul><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211020202152071.png" alt="" style="zoom:50%;" /><p>ç”Ÿæ´»ä¸­çš„ä¾‹å­ï¼š</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image_20211020132711.jpg"></p><h2 id="2-æ•°æ®åº“ä¸æ•°æ®åº“ç®¡ç†ç³»ç»Ÿ"><a href="#2-æ•°æ®åº“ä¸æ•°æ®åº“ç®¡ç†ç³»ç»Ÿ" class="headerlink" title="2. æ•°æ®åº“ä¸æ•°æ®åº“ç®¡ç†ç³»ç»Ÿ"></a>2. æ•°æ®åº“ä¸æ•°æ®åº“ç®¡ç†ç³»ç»Ÿ</h2><h3 id="2-1-æ•°æ®åº“çš„ç›¸å…³æ¦‚å¿µ"><a href="#2-1-æ•°æ®åº“çš„ç›¸å…³æ¦‚å¿µ" class="headerlink" title="2.1 æ•°æ®åº“çš„ç›¸å…³æ¦‚å¿µ"></a>2.1 æ•°æ®åº“çš„ç›¸å…³æ¦‚å¿µ</h3><table><thead><tr><th><strong>DBï¼šæ•°æ®åº“ï¼ˆDatabaseï¼‰</strong></th></tr></thead><tbody><tr><td>å³å­˜å‚¨æ•°æ®çš„â€œä»“åº“â€ï¼Œå…¶æœ¬è´¨æ˜¯ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿã€‚å®ƒä¿å­˜äº†ä¸€ç³»åˆ—æœ‰ç»„ç»‡çš„æ•°æ®ã€‚</td></tr><tr><td><strong>DBMSï¼šæ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼ˆDatabase Management Systemï¼‰</strong></td></tr><tr><td>æ˜¯ä¸€ç§æ“çºµå’Œç®¡ç†æ•°æ®åº“çš„å¤§å‹è½¯ä»¶ï¼Œç”¨äºå»ºç«‹ã€ä½¿ç”¨å’Œç»´æŠ¤æ•°æ®åº“ï¼Œå¯¹æ•°æ®åº“è¿›è¡Œç»Ÿä¸€ç®¡ç†å’Œæ§åˆ¶ã€‚ç”¨æˆ·é€šè¿‡æ•°æ®åº“ç®¡ç†ç³»ç»Ÿè®¿é—®æ•°æ®åº“ä¸­è¡¨å†…çš„æ•°æ®ã€‚</td></tr><tr><td><strong>SQLï¼šç»“æ„åŒ–æŸ¥è¯¢è¯­è¨€ï¼ˆStructured Query Languageï¼‰</strong></td></tr><tr><td>ä¸“é—¨ç”¨æ¥ä¸æ•°æ®åº“é€šä¿¡çš„è¯­è¨€ã€‚</td></tr></tbody></table><h3 id="2-2-æ•°æ®åº“ä¸æ•°æ®åº“ç®¡ç†ç³»ç»Ÿçš„å…³ç³»"><a href="#2-2-æ•°æ®åº“ä¸æ•°æ®åº“ç®¡ç†ç³»ç»Ÿçš„å…³ç³»" class="headerlink" title="2.2 æ•°æ®åº“ä¸æ•°æ®åº“ç®¡ç†ç³»ç»Ÿçš„å…³ç³»"></a>2.2 æ•°æ®åº“ä¸æ•°æ®åº“ç®¡ç†ç³»ç»Ÿçš„å…³ç³»</h3><p>æ•°æ®åº“ç®¡ç†ç³»ç»Ÿ(DBMS)å¯ä»¥ç®¡ç†å¤šä¸ªæ•°æ®åº“ï¼Œä¸€èˆ¬å¼€å‘äººå‘˜ä¼šé’ˆå¯¹æ¯ä¸€ä¸ªåº”ç”¨åˆ›å»ºä¸€ä¸ªæ•°æ®åº“ã€‚ä¸ºä¿å­˜åº”ç”¨ä¸­å®ä½“çš„æ•°æ®ï¼Œä¸€èˆ¬ä¼šåœ¨æ•°æ®åº“åˆ›å»ºå¤šä¸ªè¡¨ï¼Œä»¥ä¿å­˜ç¨‹åºä¸­å®ä½“ç”¨æˆ·çš„æ•°æ®ã€‚ </p><p>æ•°æ®åº“ç®¡ç†ç³»ç»Ÿã€æ•°æ®åº“å’Œè¡¨çš„å…³ç³»å¦‚å›¾æ‰€ç¤ºï¼š</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211013202511233.png"></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20210915112546261.png"></p><h3 id="2-3-å¸¸è§çš„æ•°æ®åº“ç®¡ç†ç³»ç»Ÿæ’å-DBMS"><a href="#2-3-å¸¸è§çš„æ•°æ®åº“ç®¡ç†ç³»ç»Ÿæ’å-DBMS" class="headerlink" title="2.3 å¸¸è§çš„æ•°æ®åº“ç®¡ç†ç³»ç»Ÿæ’å(DBMS)"></a>2.3 å¸¸è§çš„æ•°æ®åº“ç®¡ç†ç³»ç»Ÿæ’å(DBMS)</h3><p>ç›®å‰äº’è”ç½‘ä¸Šå¸¸è§çš„æ•°æ®åº“ç®¡ç†è½¯ä»¶æœ‰Oracleã€MySQLã€MS SQL Serverã€DB2ã€PostgreSQLã€Accessã€Sybaseã€Informixè¿™å‡ ç§ã€‚ä»¥ä¸‹æ˜¯2021å¹´<strong>DB-Engines Ranking</strong> å¯¹å„æ•°æ®åº“å—æ¬¢è¿ç¨‹åº¦è¿›è¡Œè°ƒæŸ¥åçš„ç»Ÿè®¡ç»“æœï¼šï¼ˆæŸ¥çœ‹æ•°æ®åº“æœ€æ–°æ’å:<a href="https://db-engines.com/en/ranking%EF%BC%89">https://db-engines.com/en/rankingï¼‰</a></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211013202815851.png"></p><p>â€¦ â€¦</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211013202940798.png"></p><p>å¯¹åº”çš„èµ°åŠ¿å›¾ï¼šï¼ˆ<a href="https://db-engines.com/en/ranking_trend%EF%BC%89">https://db-engines.com/en/ranking_trendï¼‰</a></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211013203029492.png"></p><h3 id="2-4-å¸¸è§çš„æ•°æ®åº“ä»‹ç»"><a href="#2-4-å¸¸è§çš„æ•°æ®åº“ä»‹ç»" class="headerlink" title="2.4 å¸¸è§çš„æ•°æ®åº“ä»‹ç»"></a>2.4 å¸¸è§çš„æ•°æ®åº“ä»‹ç»</h3><p><strong>Oracle</strong></p><p>1979 å¹´ï¼ŒOracle 2 è¯ç”Ÿï¼Œå®ƒæ˜¯ç¬¬ä¸€ä¸ªå•†ç”¨çš„ RDBMSï¼ˆå…³ç³»å‹æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼‰ã€‚éšç€ Oracle è½¯ä»¶çš„åæ°”è¶Šæ¥è¶Šå¤§ï¼Œå…¬å¸ä¹Ÿæ”¹åå« Oracle å…¬å¸ã€‚</p><p>2007å¹´ï¼Œæ€»è®¡85äº¿ç¾é‡‘æ”¶è´­BEA Systemsã€‚</p><p>2009å¹´ï¼Œæ€»è®¡74äº¿ç¾é‡‘æ”¶è´­SUNã€‚æ­¤å‰çš„2008å¹´ï¼ŒSUNä»¥10äº¿ç¾é‡‘æ”¶è´­MySQLã€‚æ„å‘³ç€Oracle åŒæ—¶æ‹¥æœ‰äº† MySQL çš„ç®¡ç†æƒï¼Œè‡³æ­¤ Oracle åœ¨æ•°æ®åº“é¢†åŸŸä¸­æˆä¸ºç»å¯¹çš„é¢†å¯¼è€…ã€‚</p><p>2013å¹´ï¼Œç”²éª¨æ–‡è¶…è¶ŠIBMï¼Œæˆä¸ºç»§Microsoftåå…¨çƒç¬¬äºŒå¤§è½¯ä»¶å…¬å¸ã€‚</p><p>å¦‚ä»Š Oracle çš„å¹´æ”¶å…¥è¾¾åˆ°äº† 400 äº¿ç¾é‡‘ï¼Œè¶³ä»¥è¯æ˜å•†ç”¨ï¼ˆæ”¶è´¹ï¼‰æ•°æ®åº“è½¯ä»¶çš„ä»·å€¼ã€‚</p><p><strong>SQL Server</strong></p><p>SQL Server æ˜¯å¾®è½¯å¼€å‘çš„å¤§å‹å•†ä¸šæ•°æ®åº“ï¼Œè¯ç”Ÿäº 1989 å¹´ã€‚C#ã€.netç­‰è¯­è¨€å¸¸ä½¿ç”¨ï¼Œä¸WinNTå®Œå…¨é›†æˆï¼Œä¹Ÿå¯ä»¥å¾ˆå¥½åœ°ä¸Microsoft BackOfficeäº§å“é›†æˆã€‚</p><p><strong>DB2</strong></p><p>IBMå…¬å¸çš„æ•°æ®åº“äº§å“,æ”¶è´¹çš„ã€‚å¸¸åº”ç”¨åœ¨é“¶è¡Œç³»ç»Ÿä¸­ã€‚</p><p><strong>PostgreSQL</strong></p><p>PostgreSQL çš„ç¨³å®šæ€§æå¼ºï¼Œ<strong>æœ€ç¬¦åˆSQLæ ‡å‡†</strong>ï¼Œå¼€æ”¾æºç ï¼Œå…·å¤‡å•†ä¸šçº§DBMSè´¨é‡ã€‚PGå¯¹æ•°æ®é‡å¤§çš„æ–‡æœ¬ä»¥åŠSQLå¤„ç†è¾ƒå¿«ã€‚</p><p><strong>SyBase</strong></p><p>å·²ç»æ·¡å‡ºå†å²èˆå°ã€‚æä¾›äº†ä¸€ä¸ªéå¸¸ä¸“ä¸šæ•°æ®å»ºæ¨¡çš„å·¥å…·PowerDesignerã€‚ </p><p><strong>SQLite</strong></p><p>åµŒå…¥å¼çš„å°å‹æ•°æ®åº“ï¼Œåº”ç”¨åœ¨æ‰‹æœºç«¯ã€‚ é›¶é…ç½®ï¼ŒSQlite3ä¸ç”¨å®‰è£…ï¼Œä¸ç”¨é…ç½®ï¼Œä¸ç”¨å¯åŠ¨ï¼Œå…³é—­æˆ–è€…é…ç½®æ•°æ®åº“å®ä¾‹ã€‚å½“ç³»ç»Ÿå´©æºƒåä¸ç”¨åšä»»ä½•æ¢å¤æ“ä½œï¼Œå†ä¸‹æ¬¡ä½¿ç”¨æ•°æ®åº“çš„æ—¶å€™è‡ªåŠ¨æ¢å¤ã€‚</p><p><strong>informix</strong></p><p>IBMå…¬å¸å‡ºå“ï¼Œå–è‡ªInformation å’ŒUnixçš„ç»“åˆï¼Œå®ƒæ˜¯ç¬¬ä¸€ä¸ªè¢«ç§»æ¤åˆ°Linuxä¸Šçš„å•†ä¸šæ•°æ®åº“äº§å“ã€‚ä»…è¿è¡Œäºunix/linuxå¹³å°ï¼Œå‘½ä»¤è¡Œæ“ä½œã€‚ æ€§èƒ½è¾ƒé«˜ï¼Œæ”¯æŒé›†ç¾¤ï¼Œé€‚åº”äºå®‰å…¨æ€§è¦æ±‚æé«˜çš„ç³»ç»Ÿï¼Œå°¤å…¶æ˜¯é“¶è¡Œï¼Œè¯åˆ¸ç³»ç»Ÿçš„åº”ç”¨ã€‚  </p><h2 id="3-MySQLä»‹ç»"><a href="#3-MySQLä»‹ç»" class="headerlink" title="3. MySQLä»‹ç»"></a>3. MySQLä»‹ç»</h2><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20210829230656830.png"></p><h3 id="3-1-æ¦‚è¿°"><a href="#3-1-æ¦‚è¿°" class="headerlink" title="3.1 æ¦‚è¿°"></a>3.1 æ¦‚è¿°</h3><ul><li>MySQLæ˜¯ä¸€ä¸ª<code>å¼€æ”¾æºä»£ç çš„å…³ç³»å‹æ•°æ®åº“ç®¡ç†ç³»ç»Ÿ</code>ï¼Œç”±ç‘å…¸MySQL ABï¼ˆåˆ›å§‹äººMichael Wideniusï¼‰å…¬å¸1995å¹´å¼€å‘ï¼Œè¿…é€Ÿæˆä¸ºå¼€æºæ•°æ®åº“çš„ No.1ã€‚</li><li>2008è¢«<code>Sun</code>æ”¶è´­ï¼ˆ10äº¿ç¾é‡‘ï¼‰ï¼Œ2009å¹´Sunè¢«<code>Oracle</code>æ”¶è´­ã€‚<code>MariaDB</code>åº”è¿è€Œç”Ÿã€‚ï¼ˆMySQL çš„åˆ›é€ è€…æ‹…å¿ƒ MySQL æœ‰é—­æºçš„é£é™©ï¼Œå› æ­¤åˆ›å»ºäº† MySQL çš„åˆ†æ”¯é¡¹ç›® MariaDBï¼‰</li><li>MySQL6.x ç‰ˆæœ¬ä¹‹ååˆ†ä¸º<code>ç¤¾åŒºç‰ˆ</code>å’Œ<code>å•†ä¸šç‰ˆ</code>ã€‚</li><li>MySQLæ˜¯ä¸€ç§å…³è”æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼Œå°†æ•°æ®ä¿å­˜åœ¨ä¸åŒçš„è¡¨ä¸­ï¼Œè€Œä¸æ˜¯å°†æ‰€æœ‰æ•°æ®æ”¾åœ¨ä¸€ä¸ªå¤§ä»“åº“å†…ï¼Œè¿™æ ·å°±å¢åŠ äº†é€Ÿåº¦å¹¶æé«˜äº†çµæ´»æ€§ï¼ˆåˆ†åº“åˆ†è¡¨ï¼‰ã€‚</li><li>MySQLæ˜¯å¼€æºçš„ï¼Œæ‰€ä»¥ä½ ä¸éœ€è¦æ”¯ä»˜é¢å¤–çš„è´¹ç”¨ã€‚</li><li>MySQLæ˜¯å¯ä»¥å®šåˆ¶çš„ï¼Œé‡‡ç”¨äº†<code>GPLï¼ˆGNU General Public Licenseï¼‰</code>åè®®ï¼Œä½ å¯ä»¥ä¿®æ”¹æºç æ¥å¼€å‘è‡ªå·±çš„MySQLç³»ç»Ÿã€‚</li><li>MySQLæ”¯æŒå¤§å‹çš„æ•°æ®åº“ã€‚å¯ä»¥å¤„ç†æ‹¥æœ‰ä¸Šåƒä¸‡æ¡è®°å½•çš„å¤§å‹æ•°æ®åº“ã€‚</li><li>MySQLæ”¯æŒå¤§å‹æ•°æ®åº“ï¼Œæ”¯æŒ5000ä¸‡æ¡è®°å½•çš„æ•°æ®ä»“åº“ï¼Œ32ä½ç³»ç»Ÿè¡¨æ–‡ä»¶æœ€å¤§å¯æ”¯æŒ<code>4GB</code>ï¼Œ64ä½ç³»ç»Ÿæ”¯æŒæœ€å¤§çš„è¡¨æ–‡ä»¶ä¸º<code>8TB</code>ã€‚</li><li>MySQLä½¿ç”¨<code>æ ‡å‡†çš„SQLæ•°æ®è¯­è¨€</code>å½¢å¼ã€‚</li><li>MySQLå¯ä»¥å…è®¸è¿è¡Œäºå¤šä¸ªç³»ç»Ÿä¸Šï¼Œå¹¶ä¸”æ”¯æŒå¤šç§è¯­è¨€ã€‚è¿™äº›ç¼–ç¨‹è¯­è¨€åŒ…æ‹¬Cã€C++ã€Pythonã€Javaã€Perlã€PHPå’ŒRubyç­‰ã€‚</li></ul><h3 id="3-2-MySQLå‘å±•å²é‡å¤§äº‹ä»¶"><a href="#3-2-MySQLå‘å±•å²é‡å¤§äº‹ä»¶" class="headerlink" title="3.2 MySQLå‘å±•å²é‡å¤§äº‹ä»¶"></a>3.2 MySQLå‘å±•å²é‡å¤§äº‹ä»¶</h3><p>MySQLçš„å†å²å°±æ˜¯æ•´ä¸ªäº’è”ç½‘çš„å‘å±•å²ã€‚äº’è”ç½‘ä¸šåŠ¡ä»ç¤¾äº¤é¢†åŸŸã€ç”µå•†é¢†åŸŸåˆ°é‡‘èé¢†åŸŸçš„å‘å±•ï¼Œæ¨åŠ¨ç€åº”ç”¨å¯¹æ•°æ®åº“çš„éœ€æ±‚æå‡ï¼Œå¯¹ä¼ ç»Ÿçš„æ•°æ®åº“æœåŠ¡èƒ½åŠ›æå‡ºäº†æŒ‘æˆ˜ã€‚é«˜å¹¶å‘ã€é«˜æ€§èƒ½ã€é«˜å¯ç”¨ã€è½»èµ„æºã€æ˜“ç»´æŠ¤ã€æ˜“æ‰©å±•çš„éœ€æ±‚ï¼Œä¿ƒè¿›äº†MySQLçš„é•¿è¶³å‘å±•ã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20210730161043856.png"></p><h3 id="1-4-å…³äºMySQL-8-0"><a href="#1-4-å…³äºMySQL-8-0" class="headerlink" title="1.4 å…³äºMySQL 8.0"></a>1.4 å…³äºMySQL 8.0</h3><p><code>MySQLä»5.7ç‰ˆæœ¬ç›´æ¥è·³è·ƒå‘å¸ƒäº†8.0ç‰ˆæœ¬</code>ï¼Œå¯è§è¿™æ˜¯ä¸€ä¸ªä»¤äººå…´å¥‹çš„é‡Œç¨‹ç¢‘ç‰ˆæœ¬ã€‚MySQL 8ç‰ˆæœ¬åœ¨åŠŸèƒ½ä¸Šåšäº†æ˜¾è‘—çš„æ”¹è¿›ä¸å¢å¼ºï¼Œå¼€å‘è€…å¯¹MySQLçš„æºä»£ç è¿›è¡Œäº†é‡æ„ï¼Œæœ€çªå‡ºçš„ä¸€ç‚¹æ˜¯å¤šMySQL Optimizerä¼˜åŒ–å™¨è¿›è¡Œäº†æ”¹è¿›ã€‚ä¸ä»…åœ¨é€Ÿåº¦ä¸Šå¾—åˆ°äº†æ”¹å–„ï¼Œè¿˜ä¸ºç”¨æˆ·å¸¦æ¥äº†æ›´å¥½çš„æ€§èƒ½å’Œæ›´æ£’çš„ä½“éªŒã€‚</p><h3 id="1-5-Why-choose-MySQL"><a href="#1-5-Why-choose-MySQL" class="headerlink" title="1.5 Why choose MySQL?"></a>1.5 Why choose MySQL?</h3><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211013210429011.png"></p><p>ä¸ºä»€ä¹ˆå¦‚æ­¤å¤šçš„å‚å•†è¦é€‰ç”¨MySQLï¼Ÿå¤§æ¦‚æ€»ç»“çš„åŸå› ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š    </p><ol><li><p>   å¼€æ”¾æºä»£ç ï¼Œä½¿ç”¨æˆæœ¬ä½ã€‚</p></li><li><p>   æ€§èƒ½å“è¶Šï¼ŒæœåŠ¡ç¨³å®šã€‚</p></li><li><p>   è½¯ä»¶ä½“ç§¯å°ï¼Œä½¿ç”¨ç®€å•ï¼Œå¹¶ä¸”æ˜“äºç»´æŠ¤ã€‚</p></li><li><p>   å†å²æ‚ ä¹…ï¼Œç¤¾åŒºç”¨æˆ·éå¸¸æ´»è·ƒï¼Œé‡åˆ°é—®é¢˜å¯ä»¥å¯»æ±‚å¸®åŠ©ã€‚</p></li><li><p>   è®¸å¤šäº’è”ç½‘å…¬å¸åœ¨ç”¨ï¼Œç»è¿‡äº†æ—¶é—´çš„éªŒè¯ã€‚</p></li></ol><h3 id="1-6-Oracle-vs-MySQL"><a href="#1-6-Oracle-vs-MySQL" class="headerlink" title="1.6 Oracle vs MySQL"></a>1.6 Oracle vs MySQL</h3><p>Oracle æ›´é€‚åˆå¤§å‹è·¨å›½ä¼ä¸šçš„ä½¿ç”¨ï¼Œå› ä¸ºä»–ä»¬å¯¹è´¹ç”¨ä¸æ•æ„Ÿï¼Œä½†æ˜¯å¯¹æ€§èƒ½è¦æ±‚ä»¥åŠå®‰å…¨æ€§æœ‰æ›´é«˜çš„è¦æ±‚ã€‚</p><p>MySQL ç”±äºå…¶<strong>ä½“ç§¯å°ã€é€Ÿåº¦å¿«ã€æ€»ä½“æ‹¥æœ‰æˆæœ¬ä½ï¼Œå¯å¤„ç†ä¸Šåƒä¸‡æ¡è®°å½•çš„å¤§å‹æ•°æ®åº“ï¼Œå°¤å…¶æ˜¯å¼€æ”¾æºç è¿™ä¸€ç‰¹ç‚¹ï¼Œä½¿å¾—å¾ˆå¤šäº’è”ç½‘å…¬å¸ã€ä¸­å°å‹ç½‘ç«™é€‰æ‹©äº†MySQLä½œä¸ºç½‘ç«™æ•°æ®åº“</strong>ï¼ˆFacebookï¼ŒTwitterï¼ŒYouTubeï¼Œé˜¿é‡Œå·´å·´/èš‚èšé‡‘æœï¼Œå»å“ªå„¿ï¼Œç¾å›¢å¤–å–ï¼Œè…¾è®¯ï¼‰ã€‚</p><h2 id="4-RDBMS-ä¸-éRDBMS"><a href="#4-RDBMS-ä¸-éRDBMS" class="headerlink" title="4. RDBMS ä¸ éRDBMS"></a>4. RDBMS ä¸ éRDBMS</h2><p>ä»æ’åä¸­æˆ‘ä»¬èƒ½çœ‹å‡ºæ¥ï¼Œå…³ç³»å‹æ•°æ®åº“ç»å¯¹æ˜¯ DBMS çš„ä¸»æµï¼Œå…¶ä¸­ä½¿ç”¨æœ€å¤šçš„ DBMS åˆ†åˆ«æ˜¯ Oracleã€MySQL å’Œ SQL Serverã€‚è¿™äº›éƒ½æ˜¯å…³ç³»å‹æ•°æ®åº“ï¼ˆRDBMSï¼‰ã€‚</p><h3 id="4-1-å…³ç³»å‹æ•°æ®åº“-RDBMS"><a href="#4-1-å…³ç³»å‹æ•°æ®åº“-RDBMS" class="headerlink" title="4.1 å…³ç³»å‹æ•°æ®åº“(RDBMS)"></a>4.1 å…³ç³»å‹æ•°æ®åº“(RDBMS)</h3><h4 id="4-1-1-å®è´¨"><a href="#4-1-1-å®è´¨" class="headerlink" title="4.1.1 å®è´¨"></a>4.1.1 å®è´¨</h4><ul><li><p>è¿™ç§ç±»å‹çš„æ•°æ®åº“æ˜¯<code>æœ€å¤è€</code>çš„æ•°æ®åº“ç±»å‹ï¼Œå…³ç³»å‹æ•°æ®åº“æ¨¡å‹æ˜¯æŠŠå¤æ‚çš„æ•°æ®ç»“æ„å½’ç»“ä¸ºç®€å•çš„<code>äºŒå…ƒå…³ç³»</code>ï¼ˆå³äºŒç»´è¡¨æ ¼å½¢å¼ï¼‰ã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211020145811031.png"></p></li><li><p>å…³ç³»å‹æ•°æ®åº“ä»¥<code>è¡Œ(row)</code>å’Œ<code>åˆ—(column)</code>çš„å½¢å¼å­˜å‚¨æ•°æ®ï¼Œä»¥ä¾¿äºç”¨æˆ·ç†è§£ã€‚è¿™ä¸€ç³»åˆ—çš„è¡Œå’Œåˆ—è¢«ç§°ä¸º<code>è¡¨(table)</code>ï¼Œä¸€ç»„è¡¨ç»„æˆäº†ä¸€ä¸ªåº“(database)ã€‚</p></li><li><p>è¡¨ä¸è¡¨ä¹‹é—´çš„æ•°æ®è®°å½•æœ‰å…³ç³»(relationship)ã€‚ç°å®ä¸–ç•Œä¸­çš„å„ç§å®ä½“ä»¥åŠå®ä½“ä¹‹é—´çš„å„ç§è”ç³»å‡ç”¨<code>å…³ç³»æ¨¡å‹</code>æ¥è¡¨ç¤ºã€‚å…³ç³»å‹æ•°æ®åº“ï¼Œå°±æ˜¯å»ºç«‹åœ¨<code>å…³ç³»æ¨¡å‹</code>åŸºç¡€ä¸Šçš„æ•°æ®åº“ã€‚</p></li><li><p>SQL å°±æ˜¯å…³ç³»å‹æ•°æ®åº“çš„æŸ¥è¯¢è¯­è¨€ã€‚</p></li></ul><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20210914235413708.png"></p><h4 id="4-1-2-ä¼˜åŠ¿"><a href="#4-1-2-ä¼˜åŠ¿" class="headerlink" title="4.1.2 ä¼˜åŠ¿"></a>4.1.2 ä¼˜åŠ¿</h4><ul><li><strong>å¤æ‚æŸ¥è¯¢</strong><br>å¯ä»¥ç”¨SQLè¯­å¥æ–¹ä¾¿çš„åœ¨ä¸€ä¸ªè¡¨ä»¥åŠå¤šä¸ªè¡¨ä¹‹é—´åšéå¸¸å¤æ‚çš„æ•°æ®æŸ¥è¯¢ã€‚</li><li><strong>äº‹åŠ¡æ”¯æŒ</strong><br>ä½¿å¾—å¯¹äºå®‰å…¨æ€§èƒ½å¾ˆé«˜çš„æ•°æ®è®¿é—®è¦æ±‚å¾—ä»¥å®ç°ã€‚</li></ul><h3 id="4-2-éå…³ç³»å‹æ•°æ®åº“-éRDBMS"><a href="#4-2-éå…³ç³»å‹æ•°æ®åº“-éRDBMS" class="headerlink" title="4.2 éå…³ç³»å‹æ•°æ®åº“(éRDBMS)"></a>4.2 éå…³ç³»å‹æ•°æ®åº“(éRDBMS)</h3><h4 id="4-2-1-ä»‹ç»"><a href="#4-2-1-ä»‹ç»" class="headerlink" title="4.2.1 ä»‹ç»"></a>4.2.1 ä»‹ç»</h4><p><strong>éå…³ç³»å‹æ•°æ®åº“</strong>ï¼Œå¯çœ‹æˆä¼ ç»Ÿå…³ç³»å‹æ•°æ®åº“çš„åŠŸèƒ½<code>é˜‰å‰²ç‰ˆæœ¬</code>ï¼ŒåŸºäºé”®å€¼å¯¹å­˜å‚¨æ•°æ®ï¼Œä¸éœ€è¦ç»è¿‡SQLå±‚çš„è§£æï¼Œ<code>æ€§èƒ½éå¸¸é«˜</code>ã€‚åŒæ—¶ï¼Œé€šè¿‡å‡å°‘ä¸å¸¸ç”¨çš„åŠŸèƒ½ï¼Œè¿›ä¸€æ­¥æé«˜æ€§èƒ½ã€‚</p><p>ç›®å‰åŸºæœ¬ä¸Šå¤§éƒ¨åˆ†ä¸»æµçš„éå…³ç³»å‹æ•°æ®åº“éƒ½æ˜¯å…è´¹çš„ã€‚</p><h4 id="4-2-2-æœ‰å“ªäº›éå…³ç³»å‹æ•°æ®åº“"><a href="#4-2-2-æœ‰å“ªäº›éå…³ç³»å‹æ•°æ®åº“" class="headerlink" title="4.2.2 æœ‰å“ªäº›éå…³ç³»å‹æ•°æ®åº“"></a>4.2.2 æœ‰å“ªäº›éå…³ç³»å‹æ•°æ®åº“</h4><p>ç›¸æ¯”äº SQLï¼ŒNoSQL æ³›æŒ‡éå…³ç³»å‹æ•°æ®åº“ï¼ŒåŒ…æ‹¬äº†æ¦œå•ä¸Šçš„é”®å€¼å‹æ•°æ®åº“ã€æ–‡æ¡£å‹æ•°æ®åº“ã€æœç´¢å¼•æ“å’Œåˆ—å­˜å‚¨ç­‰ï¼Œé™¤æ­¤ä»¥å¤–è¿˜åŒ…æ‹¬å›¾å½¢æ•°æ®åº“ã€‚ä¹Ÿåªæœ‰ç”¨ NoSQL ä¸€è¯æ‰èƒ½å°†è¿™äº›æŠ€æœ¯å›Šæ‹¬è¿›æ¥ã€‚</p><p><strong>é”®å€¼å‹æ•°æ®åº“</strong></p><p>é”®å€¼å‹æ•°æ®åº“é€šè¿‡ Key-Value é”®å€¼çš„æ–¹å¼æ¥å­˜å‚¨æ•°æ®ï¼Œå…¶ä¸­ Key å’Œ Value å¯ä»¥æ˜¯ç®€å•çš„å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥æ˜¯å¤æ‚çš„å¯¹è±¡ã€‚Key ä½œä¸ºå”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼Œä¼˜ç‚¹æ˜¯æŸ¥æ‰¾é€Ÿåº¦å¿«ï¼Œåœ¨è¿™æ–¹é¢æ˜æ˜¾ä¼˜äºå…³ç³»å‹æ•°æ®åº“ï¼Œç¼ºç‚¹æ˜¯æ— æ³•åƒå…³ç³»å‹æ•°æ®åº“ä¸€æ ·ä½¿ç”¨æ¡ä»¶è¿‡æ»¤ï¼ˆæ¯”å¦‚ WHEREï¼‰ï¼Œå¦‚æœä½ ä¸çŸ¥é“å»å“ªé‡Œæ‰¾æ•°æ®ï¼Œå°±è¦éå†æ‰€æœ‰çš„é”®ï¼Œè¿™å°±ä¼šæ¶ˆè€—å¤§é‡çš„è®¡ç®—ã€‚</p><p>é”®å€¼å‹æ•°æ®åº“å…¸å‹çš„ä½¿ç”¨åœºæ™¯æ˜¯ä½œä¸º<code>å†…å­˜ç¼“å­˜</code>ã€‚<code>Redis </code>æ˜¯æœ€æµè¡Œçš„é”®å€¼å‹æ•°æ®åº“ã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211020172958427.png"></p><p><strong>æ–‡æ¡£å‹æ•°æ®åº“</strong></p><p>æ­¤ç±»æ•°æ®åº“å¯å­˜æ”¾å¹¶è·å–æ–‡æ¡£ï¼Œå¯ä»¥æ˜¯XMLã€JSONç­‰æ ¼å¼ã€‚åœ¨æ•°æ®åº“ä¸­æ–‡æ¡£ä½œä¸ºå¤„ç†ä¿¡æ¯çš„åŸºæœ¬å•ä½ï¼Œä¸€ä¸ªæ–‡æ¡£å°±ç›¸å½“äºä¸€æ¡è®°å½•ã€‚æ–‡æ¡£æ•°æ®åº“æ‰€å­˜æ”¾çš„æ–‡æ¡£ï¼Œå°±ç›¸å½“äºé”®å€¼æ•°æ®åº“æ‰€å­˜æ”¾çš„â€œå€¼â€ã€‚<code>MongoDB</code> æ˜¯æœ€æµè¡Œçš„æ–‡æ¡£å‹æ•°æ®åº“ã€‚æ­¤å¤–ï¼Œè¿˜æœ‰CouchDBç­‰ã€‚</p><p><strong>æœç´¢å¼•æ“æ•°æ®åº“</strong></p><p>è™½ç„¶å…³ç³»å‹æ•°æ®åº“é‡‡ç”¨äº†ç´¢å¼•æå‡æ£€ç´¢æ•ˆç‡ï¼Œä½†æ˜¯é’ˆå¯¹å…¨æ–‡ç´¢å¼•æ•ˆç‡å´è¾ƒä½ã€‚æœç´¢å¼•æ“æ•°æ®åº“æ˜¯åº”ç”¨åœ¨æœç´¢å¼•æ“é¢†åŸŸçš„æ•°æ®å­˜å‚¨å½¢å¼ï¼Œç”±äºæœç´¢å¼•æ“ä¼šçˆ¬å–å¤§é‡çš„æ•°æ®ï¼Œå¹¶ä»¥ç‰¹å®šçš„æ ¼å¼è¿›è¡Œå­˜å‚¨ï¼Œè¿™æ ·åœ¨æ£€ç´¢çš„æ—¶å€™æ‰èƒ½ä¿è¯æ€§èƒ½æœ€ä¼˜ã€‚æ ¸å¿ƒåŸç†æ˜¯â€œå€’æ’ç´¢å¼•â€ã€‚</p><p>å…¸å‹äº§å“ï¼šSolrã€<code>Elasticsearch</code>ã€Splunk ç­‰ã€‚</p><p><strong>åˆ—å¼æ•°æ®åº“</strong></p><p>åˆ—å¼æ•°æ®åº“æ˜¯ç›¸å¯¹äºè¡Œå¼å­˜å‚¨çš„æ•°æ®åº“ï¼ŒOracleã€MySQLã€SQL Server ç­‰æ•°æ®åº“éƒ½æ˜¯é‡‡ç”¨çš„è¡Œå¼å­˜å‚¨ï¼ˆRow-basedï¼‰ï¼Œè€Œåˆ—å¼æ•°æ®åº“æ˜¯å°†æ•°æ®æŒ‰ç…§åˆ—å­˜å‚¨åˆ°æ•°æ®åº“ä¸­ï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯å¯ä»¥<strong>å¤§é‡é™ä½ç³»ç»Ÿçš„ I/O</strong>ï¼Œé€‚åˆäºåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼Œä¸è¶³åœ¨äºåŠŸèƒ½ç›¸å¯¹æœ‰é™ã€‚å…¸å‹äº§å“ï¼šHBaseç­‰ã€‚</p><p>å…³äºåˆ—å¼æ•°æ®åº“ä¸ºä»€ä¹ˆå¯ä»¥å¤§é‡é™ä½ç³»ç»Ÿçš„I/Oï¼Ÿè¿™æ˜¯å› ä¸ºåœ¨æŸ¥è¯¢æ—¶ï¼Œå¾€å¾€åªå…³å¿ƒæŸå‡ ä¸ªå­—æ®µçš„å€¼ï¼Œä½†æ˜¯è¡Œå¼å­˜å‚¨ä¼šè¯»å–å…¨éƒ¨å­—æ®µçš„å€¼ï¼ˆå› ä¸ºå…¶æ˜¯æŒ‰è¡Œå­˜å‚¨çš„ï¼‰ï¼Œä½†æ˜¯åˆ—å¼å­˜å‚¨å¯ä»¥åªè¯»å–ç‰¹å®šå­—æ®µçš„å€¼ï¼Œå¤§å¤§é™ä½äº†æ•°æ®çš„å†—ä½™ã€‚æ‰€ä»¥åˆ—å¼æ•°æ®åº“å¯ä»¥å¤§é‡é™ä½ç³»ç»Ÿçš„I/Oï¼Œå¤§å¹…åº¦åœ°æé«˜æ€§èƒ½ã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211020173921726.png"></p><p><strong>å›¾å½¢æ•°æ®åº“</strong></p><p>å›¾å½¢æ•°æ®åº“ï¼Œåˆ©ç”¨äº†å›¾è¿™ç§æ•°æ®ç»“æ„å­˜å‚¨äº†å®ä½“ï¼ˆå¯¹è±¡ï¼‰ä¹‹é—´çš„å…³ç³»ã€‚å›¾å½¢æ•°æ®åº“æœ€å…¸å‹çš„ä¾‹å­å°±æ˜¯ç¤¾äº¤ç½‘ç»œä¸­äººä¸äººçš„å…³ç³»ï¼Œæ•°æ®æ¨¡å‹ä¸»è¦æ˜¯ä»¥èŠ‚ç‚¹å’Œè¾¹ï¼ˆå…³ç³»ï¼‰æ¥å®ç°ï¼Œç‰¹ç‚¹åœ¨äºèƒ½é«˜æ•ˆåœ°è§£å†³å¤æ‚çš„å…³ç³»é—®é¢˜ã€‚</p><p>å›¾å½¢æ•°æ®åº“é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯ä¸€ç§å­˜å‚¨å›¾å½¢å…³ç³»çš„æ•°æ®åº“ã€‚å®ƒåˆ©ç”¨äº†å›¾è¿™ç§æ•°æ®ç»“æ„å­˜å‚¨äº†å®ä½“ï¼ˆå¯¹è±¡ï¼‰ä¹‹é—´çš„å…³ç³»ã€‚å…³ç³»å‹æ•°æ®ç”¨äºå­˜å‚¨æ˜ç¡®å…³ç³»çš„æ•°æ®ï¼Œä½†å¯¹äºå¤æ‚å…³ç³»çš„æ•°æ®å­˜å‚¨å´æœ‰äº›åŠ›ä¸ä»å¿ƒã€‚å¦‚ç¤¾äº¤ç½‘ç»œä¸­äººç‰©ä¹‹é—´çš„å…³ç³»ï¼Œå¦‚æœç”¨å…³ç³»å‹æ•°æ®åº“åˆ™éå¸¸å¤æ‚ï¼Œç”¨å›¾å½¢æ•°æ®åº“å°†éå¸¸ç®€å•ã€‚å…¸å‹äº§å“ï¼šNeo4Jã€InfoGridç­‰ã€‚</p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211020180934455.png" alt="" style="zoom:80%;" /><h4 id="4-2-3-NoSQLçš„æ¼”å˜"><a href="#4-2-3-NoSQLçš„æ¼”å˜" class="headerlink" title="4.2.3 NoSQLçš„æ¼”å˜"></a>4.2.3 NoSQLçš„æ¼”å˜</h4><p>ç”±äº SQL ä¸€ç›´ç§°éœ¸ DBMSï¼Œå› æ­¤è®¸å¤šäººåœ¨æ€è€ƒæ˜¯å¦æœ‰ä¸€ç§æ•°æ®åº“æŠ€æœ¯èƒ½è¿œç¦» SQLï¼Œäºæ˜¯ NoSQL è¯ç”Ÿäº†ï¼Œä½†æ˜¯éšç€å‘å±•å´å‘ç°è¶Šæ¥è¶Šç¦»ä¸å¼€ SQLã€‚åˆ°ç›®å‰ä¸ºæ­¢ NoSQL é˜µè¥ä¸­çš„ DBMS éƒ½ä¼šæœ‰å®ç°ç±»ä¼¼ SQL çš„åŠŸèƒ½ã€‚ä¸‹é¢æ˜¯â€œNoSQLâ€è¿™ä¸ªåè¯åœ¨ä¸åŒæ—¶æœŸçš„è¯ é‡Šï¼Œä»è¿™äº›é‡Šä¹‰çš„å˜åŒ–ä¸­å¯ä»¥çœ‹å‡º <code>NoSQL åŠŸèƒ½çš„æ¼”å˜</code>ï¼š</p><p>1970ï¼šNoSQL = We have no SQL</p><p>1980ï¼šNoSQL = Know SQL</p><p>2000ï¼šNoSQL = No SQL!</p><p>2005ï¼šNoSQL = Not only SQL</p><p>2013ï¼šNoSQL = No, SQL!</p><p>NoSQL å¯¹ SQL åšå‡ºäº†å¾ˆå¥½çš„è¡¥å……ï¼Œæ¯”å¦‚å®é™…å¼€å‘ä¸­ï¼Œæœ‰å¾ˆå¤šä¸šåŠ¡éœ€æ±‚ï¼Œå…¶å®å¹¶ä¸éœ€è¦å®Œæ•´çš„å…³ç³»å‹æ•°æ®åº“åŠŸèƒ½ï¼Œéå…³ç³»å‹æ•°æ®åº“çš„åŠŸèƒ½å°±è¶³å¤Ÿä½¿ç”¨äº†ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œä½¿ç”¨<code>æ€§èƒ½æ›´é«˜</code>ã€<code>æˆæœ¬æ›´ä½</code>çš„éå…³ç³»å‹æ•°æ®åº“å½“ç„¶æ˜¯æ›´æ˜æ™ºçš„é€‰æ‹©ã€‚æ¯”å¦‚ï¼šæ—¥å¿—æ”¶é›†ã€æ’è¡Œæ¦œã€å®šæ—¶å™¨ç­‰ã€‚</p><h3 id="4-3-å°ç»“"><a href="#4-3-å°ç»“" class="headerlink" title="4.3 å°ç»“"></a>4.3 å°ç»“</h3><p>NoSQL çš„åˆ†ç±»å¾ˆå¤šï¼Œå³ä¾¿å¦‚æ­¤ï¼Œåœ¨ DBMS æ’åä¸­ï¼Œè¿˜æ˜¯ SQL é˜µè¥çš„æ¯”é‡æ›´å¤§ï¼Œå½±å“åŠ›å‰ 5 çš„ DBMS ä¸­æœ‰ 4 ä¸ªæ˜¯å…³ç³»å‹æ•°æ®åº“ï¼Œè€Œæ’åå‰ 20 çš„ DBMS ä¸­ä¹Ÿæœ‰ 12 ä¸ªæ˜¯å…³ç³»å‹æ•°æ®åº“ã€‚æ‰€ä»¥è¯´ï¼ŒæŒæ¡ SQL æ˜¯éå¸¸æœ‰å¿…è¦çš„ã€‚æ•´å¥—è¯¾ç¨‹å°†å›´ç»• SQL å±•å¼€ã€‚</p><h2 id="5-å…³ç³»å‹æ•°æ®åº“è®¾è®¡è§„åˆ™"><a href="#5-å…³ç³»å‹æ•°æ®åº“è®¾è®¡è§„åˆ™" class="headerlink" title="5. å…³ç³»å‹æ•°æ®åº“è®¾è®¡è§„åˆ™"></a>5. å…³ç³»å‹æ•°æ®åº“è®¾è®¡è§„åˆ™</h2><ul><li><p>å…³ç³»å‹æ•°æ®åº“çš„å…¸å‹æ•°æ®ç»“æ„å°±æ˜¯<code>æ•°æ®è¡¨</code>ï¼Œè¿™äº›æ•°æ®è¡¨çš„ç»„æˆéƒ½æ˜¯ç»“æ„åŒ–çš„ï¼ˆStructuredï¼‰ã€‚</p></li><li><p>å°†æ•°æ®æ”¾åˆ°è¡¨ä¸­ï¼Œè¡¨å†æ”¾åˆ°åº“ä¸­ã€‚</p></li><li><p>ä¸€ä¸ªæ•°æ®åº“ä¸­å¯ä»¥æœ‰å¤šä¸ªè¡¨ï¼Œæ¯ä¸ªè¡¨éƒ½æœ‰ä¸€ä¸ªåå­—ï¼Œç”¨æ¥æ ‡è¯†è‡ªå·±ã€‚è¡¨åå…·æœ‰å”¯ä¸€æ€§ã€‚</p></li><li><p>è¡¨å…·æœ‰ä¸€äº›ç‰¹æ€§ï¼Œè¿™äº›ç‰¹æ€§å®šä¹‰äº†æ•°æ®åœ¨è¡¨ä¸­å¦‚ä½•å­˜å‚¨ï¼Œç±»ä¼¼Javaå’ŒPythonä¸­ â€œç±»â€çš„è®¾è®¡ã€‚</p></li></ul><h3 id="5-1-è¡¨ã€è®°å½•ã€å­—æ®µ"><a href="#5-1-è¡¨ã€è®°å½•ã€å­—æ®µ" class="headerlink" title="5.1 è¡¨ã€è®°å½•ã€å­—æ®µ"></a>5.1 è¡¨ã€è®°å½•ã€å­—æ®µ</h3><ul><li><p>E-Rï¼ˆentity-relationshipï¼Œå®ä½“-è”ç³»ï¼‰æ¨¡å‹ä¸­æœ‰ä¸‰ä¸ªä¸»è¦æ¦‚å¿µæ˜¯ï¼š<code>å®ä½“é›†</code>ã€<code>å±æ€§</code>ã€<code>è”ç³»é›†</code>ã€‚</p></li><li><p>ä¸€ä¸ªå®ä½“é›†ï¼ˆclassï¼‰å¯¹åº”äºæ•°æ®åº“ä¸­çš„ä¸€ä¸ªè¡¨ï¼ˆtableï¼‰ï¼Œä¸€ä¸ªå®ä½“ï¼ˆinstanceï¼‰åˆ™å¯¹åº”äºæ•°æ®åº“è¡¨ä¸­çš„ä¸€è¡Œï¼ˆrowï¼‰ï¼Œä¹Ÿç§°ä¸ºä¸€æ¡è®°å½•ï¼ˆrecordï¼‰ã€‚ä¸€ä¸ªå±æ€§ï¼ˆattributeï¼‰å¯¹åº”äºæ•°æ®åº“è¡¨ä¸­çš„ä¸€åˆ—ï¼ˆcolumnï¼‰ï¼Œä¹Ÿç§°ä¸ºä¸€ä¸ªå­—æ®µï¼ˆfieldï¼‰ã€‚</p></li></ul><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20210914235450032-1634141235163.png"></p><figure class="highlight clean"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><pre><code class="hljs clean">ORMæ€æƒ³ (Object Relational Mapping / å¯¹è±¡å…³ç³»æ˜ å°„)ä½“ç°ï¼š<br>æ•°æ®åº“ä¸­çš„ä¸€ä¸ªè¡¨  &lt;---&gt; Javaæˆ–Pythonä¸­çš„ä¸€ä¸ªç±»<br>è¡¨ä¸­çš„ä¸€æ¡æ•°æ®  &lt;---&gt; ç±»ä¸­çš„ä¸€ä¸ªå¯¹è±¡ï¼ˆæˆ–å®ä½“ï¼‰<br>è¡¨ä¸­çš„ä¸€ä¸ªåˆ—  &lt;---&gt; ç±»ä¸­çš„ä¸€ä¸ªå­—æ®µã€å±æ€§(field)<br></code></pre></td></tr></table></figure><h3 id="5-2-è¡¨çš„å…³è”å…³ç³»"><a href="#5-2-è¡¨çš„å…³è”å…³ç³»" class="headerlink" title="5.2 è¡¨çš„å…³è”å…³ç³»"></a>5.2 è¡¨çš„å…³è”å…³ç³»</h3><ul><li><p>è¡¨ä¸è¡¨ä¹‹é—´çš„æ•°æ®è®°å½•æœ‰å…³ç³»(relationship)ã€‚ç°å®ä¸–ç•Œä¸­çš„å„ç§å®ä½“ä»¥åŠå®ä½“ä¹‹é—´çš„å„ç§è”ç³»å‡ç”¨å…³ç³»æ¨¡å‹æ¥è¡¨ç¤ºã€‚</p></li><li><p>å››ç§ï¼šä¸€å¯¹ä¸€å…³è”ã€ä¸€å¯¹å¤šå…³è”ã€å¤šå¯¹å¤šå…³è”ã€è‡ªæˆ‘å¼•ç”¨</p></li></ul><h4 id="5-2-1-ä¸€å¯¹ä¸€å…³è”ï¼ˆone-to-oneï¼‰"><a href="#5-2-1-ä¸€å¯¹ä¸€å…³è”ï¼ˆone-to-oneï¼‰" class="headerlink" title="5.2.1 ä¸€å¯¹ä¸€å…³è”ï¼ˆone-to-oneï¼‰"></a>5.2.1 ä¸€å¯¹ä¸€å…³è”ï¼ˆone-to-oneï¼‰</h4><ul><li><p>åœ¨å®é™…çš„å¼€å‘ä¸­åº”ç”¨ä¸å¤šï¼Œå› ä¸ºä¸€å¯¹ä¸€å¯ä»¥åˆ›å»ºæˆä¸€å¼ è¡¨ã€‚</p></li><li><p>ä¸¾ä¾‹ï¼šè®¾è®¡<code>å­¦ç”Ÿè¡¨</code>ï¼šå­¦å·ã€å§“åã€æ‰‹æœºå·ç ã€ç­çº§ã€ç³»åˆ«ã€èº«ä»½è¯å·ç ã€å®¶åº­ä½å€ã€ç±è´¯ã€ç´§æ€¥è”ç³»äººã€â€¦</p><ul><li><p>æ‹†ä¸ºä¸¤ä¸ªè¡¨ï¼šä¸¤ä¸ªè¡¨çš„è®°å½•æ˜¯ä¸€ä¸€å¯¹åº”å…³ç³»ã€‚</p></li><li><p><code>åŸºç¡€ä¿¡æ¯è¡¨</code>ï¼ˆå¸¸ç”¨ä¿¡æ¯ï¼‰ï¼šå­¦å·ã€å§“åã€æ‰‹æœºå·ç ã€ç­çº§ã€ç³»åˆ«</p></li><li><p><code>æ¡£æ¡ˆä¿¡æ¯è¡¨</code>ï¼ˆä¸å¸¸ç”¨ä¿¡æ¯ï¼‰ï¼šå­¦å·ã€èº«ä»½è¯å·ç ã€å®¶åº­ä½å€ã€ç±è´¯ã€ç´§æ€¥è”ç³»äººã€â€¦</p></li></ul></li><li><p>ä¸¤ç§å»ºè¡¨åŸåˆ™ï¼š </p><ul><li>å¤–é”®å”¯ä¸€ï¼šä¸»è¡¨çš„ä¸»é”®å’Œä»è¡¨çš„å¤–é”®ï¼ˆå”¯ä¸€ï¼‰ï¼Œå½¢æˆä¸»å¤–é”®å…³ç³»ï¼Œå¤–é”®å”¯ä¸€ã€‚ </li><li>å¤–é”®æ˜¯ä¸»é”®ï¼šä¸»è¡¨çš„ä¸»é”®å’Œä»è¡¨çš„ä¸»é”®ï¼Œå½¢æˆä¸»å¤–é”®å…³ç³»ã€‚</li></ul></li></ul><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20210914235534452.png"></p><h4 id="5-2-2-ä¸€å¯¹å¤šå…³ç³»ï¼ˆone-to-manyï¼‰"><a href="#5-2-2-ä¸€å¯¹å¤šå…³ç³»ï¼ˆone-to-manyï¼‰" class="headerlink" title="5.2.2 ä¸€å¯¹å¤šå…³ç³»ï¼ˆone-to-manyï¼‰"></a>5.2.2 ä¸€å¯¹å¤šå…³ç³»ï¼ˆone-to-manyï¼‰</h4><ul><li><p>å¸¸è§å®ä¾‹åœºæ™¯ï¼š<code>å®¢æˆ·è¡¨å’Œè®¢å•è¡¨</code>ï¼Œ<code>åˆ†ç±»è¡¨å’Œå•†å“è¡¨</code>ï¼Œ<code>éƒ¨é—¨è¡¨å’Œå‘˜å·¥è¡¨</code>ã€‚</p></li><li><p>ä¸¾ä¾‹ï¼š</p><ul><li><p>å‘˜å·¥è¡¨ï¼šç¼–å·ã€å§“åã€â€¦ã€æ‰€å±éƒ¨é—¨</p></li><li><p>éƒ¨é—¨è¡¨ï¼šç¼–å·ã€åç§°ã€ç®€ä»‹</p></li></ul></li><li><p>ä¸€å¯¹å¤šå»ºè¡¨åŸåˆ™ï¼šåœ¨ä»è¡¨(å¤šæ–¹)åˆ›å»ºä¸€ä¸ªå­—æ®µï¼Œå­—æ®µä½œä¸ºå¤–é”®æŒ‡å‘ä¸»è¡¨(ä¸€æ–¹)çš„ä¸»é”®</p></li></ul><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20210915001013524.png"></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20210914235610597.png"></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20210915084623432.png"></p><h4 id="5-2-3-å¤šå¯¹å¤šï¼ˆmany-to-manyï¼‰"><a href="#5-2-3-å¤šå¯¹å¤šï¼ˆmany-to-manyï¼‰" class="headerlink" title="5.2.3 å¤šå¯¹å¤šï¼ˆmany-to-manyï¼‰"></a>5.2.3 å¤šå¯¹å¤šï¼ˆmany-to-manyï¼‰</h4><p>è¦è¡¨ç¤ºå¤šå¯¹å¤šå…³ç³»ï¼Œå¿…é¡»åˆ›å»ºç¬¬ä¸‰ä¸ªè¡¨ï¼Œè¯¥è¡¨é€šå¸¸ç§°ä¸º<code>è”æ¥è¡¨</code>ï¼Œå®ƒå°†å¤šå¯¹å¤šå…³ç³»åˆ’åˆ†ä¸ºä¸¤ä¸ªä¸€å¯¹å¤šå…³ç³»ã€‚å°†è¿™ä¸¤ä¸ªè¡¨çš„ä¸»é”®éƒ½æ’å…¥åˆ°ç¬¬ä¸‰ä¸ªè¡¨ä¸­ã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20210915001048215.png"></p><ul><li><p><strong>ä¸¾ä¾‹1ï¼šå­¦ç”Ÿ-è¯¾ç¨‹</strong></p><ul><li><p><code>å­¦ç”Ÿä¿¡æ¯è¡¨</code>ï¼šä¸€è¡Œä»£è¡¨ä¸€ä¸ªå­¦ç”Ÿçš„ä¿¡æ¯ï¼ˆå­¦å·ã€å§“åã€æ‰‹æœºå·ç ã€ç­çº§ã€ç³»åˆ«â€¦ï¼‰</p></li><li><p><code>è¯¾ç¨‹ä¿¡æ¯è¡¨</code>ï¼šä¸€è¡Œä»£è¡¨ä¸€ä¸ªè¯¾ç¨‹çš„ä¿¡æ¯ï¼ˆè¯¾ç¨‹ç¼–å·ã€æˆè¯¾è€å¸ˆã€ç®€ä»‹â€¦ï¼‰</p></li><li><p><code>é€‰è¯¾ä¿¡æ¯è¡¨</code>ï¼šä¸€ä¸ªå­¦ç”Ÿå¯ä»¥é€‰å¤šé—¨è¯¾ï¼Œä¸€é—¨è¯¾å¯ä»¥è¢«å¤šä¸ªå­¦ç”Ÿé€‰æ‹©</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">å­¦å·</span>     <span class="hljs-string">è¯¾ç¨‹ç¼–å·</span>  <br><span class="hljs-number">1</span>        <span class="hljs-number">1001</span><br><span class="hljs-number">2</span>        <span class="hljs-number">1001</span><br><span class="hljs-number">1</span>        <span class="hljs-number">1002</span><br></code></pre></td></tr></table></figure></li></ul></li><li><p><strong>ä¸¾ä¾‹2ï¼šäº§å“-è®¢å•</strong></p><p>â€œè®¢å•â€è¡¨å’Œâ€œäº§å“â€è¡¨æœ‰ä¸€ç§å¤šå¯¹å¤šçš„å…³ç³»ï¼Œè¿™ç§å…³ç³»æ˜¯é€šè¿‡ä¸â€œè®¢å•æ˜ç»†â€è¡¨å»ºç«‹ä¸¤ä¸ªä¸€å¯¹å¤šå…³ç³»æ¥å®šä¹‰çš„ã€‚ä¸€ä¸ªè®¢å•å¯ä»¥æœ‰å¤šä¸ªäº§å“ï¼Œæ¯ä¸ªäº§å“å¯ä»¥å‡ºç°åœ¨å¤šä¸ªè®¢å•ä¸­ã€‚</p><ul><li><code>äº§å“è¡¨</code>ï¼šâ€œäº§å“â€è¡¨ä¸­çš„æ¯æ¡è®°å½•è¡¨ç¤ºä¸€ä¸ªäº§å“ã€‚</li><li><code>è®¢å•è¡¨</code>ï¼šâ€œè®¢å•â€è¡¨ä¸­çš„æ¯æ¡è®°å½•è¡¨ç¤ºä¸€ä¸ªè®¢å•ã€‚</li><li><code>è®¢å•æ˜ç»†è¡¨</code>ï¼šæ¯ä¸ªäº§å“å¯ä»¥ä¸â€œè®¢å•â€è¡¨ä¸­çš„å¤šæ¡è®°å½•å¯¹åº”ï¼Œå³å‡ºç°åœ¨å¤šä¸ªè®¢å•ä¸­ã€‚ä¸€ä¸ªè®¢å•å¯ä»¥ä¸â€œäº§å“â€è¡¨ä¸­çš„å¤šæ¡è®°å½•å¯¹åº”ï¼Œå³åŒ…å«å¤šä¸ªäº§å“ã€‚</li></ul></li></ul><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20210914235637068.png"></p><ul><li><strong>ä¸¾ä¾‹3ï¼šç”¨æˆ·-è§’è‰²</strong></li><li>å¤šå¯¹å¤šå…³ç³»å»ºè¡¨åŸåˆ™ï¼šéœ€è¦åˆ›å»ºç¬¬ä¸‰å¼ è¡¨ï¼Œä¸­é—´è¡¨ä¸­è‡³å°‘ä¸¤ä¸ªå­—æ®µï¼Œè¿™ä¸¤ä¸ªå­—æ®µåˆ†åˆ«ä½œä¸ºå¤–é”®æŒ‡å‘å„è‡ªä¸€æ–¹çš„ä¸»é”®ã€‚</li></ul><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20210915084707586.png"></p><h4 id="5-3-4-è‡ªæˆ‘å¼•ç”¨-Self-reference"><a href="#5-3-4-è‡ªæˆ‘å¼•ç”¨-Self-reference" class="headerlink" title="5.3.4 è‡ªæˆ‘å¼•ç”¨(Self reference)"></a>5.3.4 è‡ªæˆ‘å¼•ç”¨(Self reference)</h4><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20210914235651997.png"></p><h1 id="ç¬¬02ç« -MySQLç¯å¢ƒæ­å»º"><a href="#ç¬¬02ç« -MySQLç¯å¢ƒæ­å»º" class="headerlink" title="ç¬¬02ç« _MySQLç¯å¢ƒæ­å»º"></a>ç¬¬02ç« _MySQLç¯å¢ƒæ­å»º</h1><h2 id="1-MySQLçš„å¸è½½"><a href="#1-MySQLçš„å¸è½½" class="headerlink" title="1. MySQLçš„å¸è½½"></a>1. MySQLçš„å¸è½½</h2><h3 id="æ­¥éª¤1ï¼šåœæ­¢MySQLæœåŠ¡"><a href="#æ­¥éª¤1ï¼šåœæ­¢MySQLæœåŠ¡" class="headerlink" title="æ­¥éª¤1ï¼šåœæ­¢MySQLæœåŠ¡"></a>æ­¥éª¤1ï¼šåœæ­¢MySQLæœåŠ¡</h3><p>åœ¨å¸è½½ä¹‹å‰ï¼Œå…ˆåœæ­¢MySQL8.0çš„æœåŠ¡ã€‚æŒ‰é”®ç›˜ä¸Šçš„â€œCtrl + Alt + Deleteâ€ç»„åˆé”®ï¼Œæ‰“å¼€â€œä»»åŠ¡ç®¡ç†å™¨â€å¯¹è¯æ¡†ï¼Œå¯ä»¥åœ¨â€œæœåŠ¡â€åˆ—è¡¨æ‰¾åˆ°â€œMySQL8.0â€çš„æœåŠ¡ï¼Œå¦‚æœç°åœ¨â€œæ­£åœ¨è¿è¡Œâ€çŠ¶æ€ï¼Œå¯ä»¥å³é”®å•å‡»æœåŠ¡ï¼Œé€‰æ‹©â€œåœæ­¢â€é€‰é¡¹åœæ­¢MySQL8.0çš„æœåŠ¡ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211014153604802.png"></p><h3 id="æ­¥éª¤2ï¼šè½¯ä»¶çš„å¸è½½"><a href="#æ­¥éª¤2ï¼šè½¯ä»¶çš„å¸è½½" class="headerlink" title="æ­¥éª¤2ï¼šè½¯ä»¶çš„å¸è½½"></a>æ­¥éª¤2ï¼šè½¯ä»¶çš„å¸è½½</h3><p><strong>æ–¹å¼1ï¼šé€šè¿‡æ§åˆ¶é¢æ¿æ–¹å¼</strong></p><p>å¸è½½MySQL8.0çš„ç¨‹åºå¯ä»¥å’Œå…¶ä»–æ¡Œé¢åº”ç”¨ç¨‹åºä¸€æ ·ç›´æ¥åœ¨â€œæ§åˆ¶é¢æ¿â€é€‰æ‹©â€œå¸è½½ç¨‹åºâ€ï¼Œå¹¶åœ¨ç¨‹åºåˆ—è¡¨ä¸­æ‰¾åˆ°MySQL8.0æœåŠ¡å™¨ç¨‹åºï¼Œç›´æ¥åŒå‡»å¸è½½å³å¯ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚è¿™ç§æ–¹å¼åˆ é™¤ï¼Œæ•°æ®ç›®å½•ä¸‹çš„æ•°æ®ä¸ä¼šè·Ÿç€åˆ é™¤ã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211014153657668.png"></p><p><strong>æ–¹å¼2ï¼šé€šè¿‡360æˆ–ç”µè„‘ç®¡å®¶ç­‰è½¯ä»¶å¸è½½</strong></p><p>ç•¥</p><p><strong>æ–¹å¼3ï¼šé€šè¿‡å®‰è£…åŒ…æä¾›çš„å¸è½½åŠŸèƒ½å¸è½½</strong></p><p>ä½ ä¹Ÿå¯ä»¥é€šè¿‡å®‰è£…å‘å¯¼ç¨‹åºè¿›è¡ŒMySQL8.0æœåŠ¡å™¨ç¨‹åºçš„å¸è½½ã€‚</p><p>â‘  å†æ¬¡åŒå‡»ä¸‹è½½çš„mysql-installer-community-8.0.26.0.msiæ–‡ä»¶ï¼Œæ‰“å¼€å®‰è£…å‘å¯¼ã€‚å®‰è£…å‘å¯¼ä¼šè‡ªåŠ¨æ£€æµ‹å·²å®‰è£…çš„MySQLæœåŠ¡å™¨ç¨‹åºã€‚</p><p>â‘¡ é€‰æ‹©è¦å¸è½½çš„MySQLæœåŠ¡å™¨ç¨‹åºï¼Œå•å‡»â€œRemoveâ€ï¼ˆç§»é™¤ï¼‰ï¼Œå³å¯è¿›è¡Œå¸è½½ã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211014153722683.png"></p><p>â‘¢ å•å‡»â€œNextâ€ï¼ˆä¸‹ä¸€æ­¥ï¼‰æŒ‰é’®ï¼Œç¡®è®¤å¸è½½ã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211014153747283.png"></p><p>â‘£ å¼¹å‡ºæ˜¯å¦åŒæ—¶ç§»é™¤æ•°æ®ç›®å½•é€‰æ‹©çª—å£ã€‚å¦‚æœæƒ³è¦åŒæ—¶åˆ é™¤MySQLæœåŠ¡å™¨ä¸­çš„æ•°æ®ï¼Œåˆ™å‹¾é€‰â€œRemove the data directoryâ€ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚</p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211014154112574.png" alt="" style="zoom:80%;" /><p>â‘¤ æ‰§è¡Œå¸è½½ã€‚å•å‡»â€œExecuteâ€ï¼ˆæ‰§è¡Œï¼‰æŒ‰é’®è¿›è¡Œå¸è½½ã€‚</p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211014154006530.png" alt="" style="zoom:90%;" /><p>â‘¥ å®Œæˆå¸è½½ã€‚å•å‡»â€œFinishâ€ï¼ˆå®Œæˆï¼‰æŒ‰é’®å³å¯ã€‚å¦‚æœæƒ³è¦åŒæ—¶å¸è½½MySQL8.0çš„å®‰è£…å‘å¯¼ç¨‹åºï¼Œå‹¾é€‰â€œYesï¼ŒUninstall MySQL Installerâ€å³å¯ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚</p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211014154046268.png" alt="" style="zoom:80%;" /><h3 id="æ­¥éª¤3ï¼šæ®‹ä½™æ–‡ä»¶çš„æ¸…ç†"><a href="#æ­¥éª¤3ï¼šæ®‹ä½™æ–‡ä»¶çš„æ¸…ç†" class="headerlink" title="æ­¥éª¤3ï¼šæ®‹ä½™æ–‡ä»¶çš„æ¸…ç†"></a>æ­¥éª¤3ï¼šæ®‹ä½™æ–‡ä»¶çš„æ¸…ç†</h3><p>å¦‚æœå†æ¬¡å®‰è£…ä¸æˆåŠŸï¼Œå¯ä»¥å¸è½½åå¯¹æ®‹ä½™æ–‡ä»¶è¿›è¡Œæ¸…ç†åå†å®‰è£…ã€‚</p><p>ï¼ˆ1ï¼‰æœåŠ¡ç›®å½•ï¼šmysqlæœåŠ¡çš„å®‰è£…ç›®å½•</p><p>ï¼ˆ2ï¼‰æ•°æ®ç›®å½•ï¼šé»˜è®¤åœ¨C:\ProgramData\MySQL</p><p>å¦‚æœè‡ªå·±å•ç‹¬æŒ‡å®šè¿‡æ•°æ®ç›®å½•ï¼Œå°±æ‰¾åˆ°è‡ªå·±çš„æ•°æ®ç›®å½•è¿›è¡Œåˆ é™¤å³å¯ã€‚</p><blockquote><p>æ³¨æ„ï¼šè¯·åœ¨å¸è½½å‰åšå¥½æ•°æ®å¤‡ä»½</p><p>åœ¨æ“ä½œå®Œä»¥åï¼Œéœ€è¦é‡å¯è®¡ç®—æœºï¼Œç„¶åè¿›è¡Œå®‰è£…å³å¯ã€‚<strong>å¦‚æœä»ç„¶å®‰è£…å¤±è´¥ï¼Œéœ€è¦ç»§ç»­æ“ä½œå¦‚ä¸‹æ­¥éª¤4ã€‚</strong></p></blockquote><h3 id="æ­¥éª¤4ï¼šæ¸…ç†æ³¨å†Œè¡¨ï¼ˆé€‰åšï¼‰"><a href="#æ­¥éª¤4ï¼šæ¸…ç†æ³¨å†Œè¡¨ï¼ˆé€‰åšï¼‰" class="headerlink" title="æ­¥éª¤4ï¼šæ¸…ç†æ³¨å†Œè¡¨ï¼ˆé€‰åšï¼‰"></a>æ­¥éª¤4ï¼šæ¸…ç†æ³¨å†Œè¡¨ï¼ˆé€‰åšï¼‰</h3><p>å¦‚æœå‰å‡ æ­¥åšäº†ï¼Œå†æ¬¡å®‰è£…è¿˜æ˜¯å¤±è´¥ï¼Œé‚£ä¹ˆå¯ä»¥æ¸…ç†æ³¨å†Œè¡¨ã€‚</p><p>å¦‚ä½•æ‰“å¼€æ³¨å†Œè¡¨ç¼–è¾‘å™¨ï¼šåœ¨ç³»ç»Ÿçš„æœç´¢æ¡†ä¸­è¾“å…¥<code>regedit</code></p><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs taggerscript">HKEY_LOCAL_MACHINE<span class="hljs-symbol">\S</span>YSTEM<span class="hljs-symbol">\C</span>ontrolSet001<span class="hljs-symbol">\S</span>ervices<span class="hljs-symbol">\E</span>ventlog<span class="hljs-symbol">\A</span>pplication<span class="hljs-symbol">\M</span>ySQLæœåŠ¡ ç›®å½•åˆ é™¤<br><br>HKEY_LOCAL_MACHINE<span class="hljs-symbol">\S</span>YSTEM<span class="hljs-symbol">\C</span>ontrolSet001<span class="hljs-symbol">\S</span>ervices<span class="hljs-symbol">\M</span>ySQLæœåŠ¡ ç›®å½•åˆ é™¤<br><br>HKEY_LOCAL_MACHINE<span class="hljs-symbol">\S</span>YSTEM<span class="hljs-symbol">\C</span>ontrolSet002<span class="hljs-symbol">\S</span>ervices<span class="hljs-symbol">\E</span>ventlog<span class="hljs-symbol">\A</span>pplication<span class="hljs-symbol">\M</span>ySQLæœåŠ¡ ç›®å½•åˆ é™¤<br><br>HKEY_LOCAL_MACHINE<span class="hljs-symbol">\S</span>YSTEM<span class="hljs-symbol">\C</span>ontrolSet002<span class="hljs-symbol">\S</span>ervices<span class="hljs-symbol">\M</span>ySQLæœåŠ¡ ç›®å½•åˆ é™¤<br><br>HKEY_LOCAL_MACHINE<span class="hljs-symbol">\S</span>YSTEM<span class="hljs-symbol">\C</span>urrentControlSet<span class="hljs-symbol">\S</span>ervices<span class="hljs-symbol">\E</span>ventlog<span class="hljs-symbol">\A</span>pplication<span class="hljs-symbol">\M</span>ySQLæœåŠ¡ç›®å½•åˆ é™¤<br><br>HKEY_LOCAL_MACHINE<span class="hljs-symbol">\S</span>YSTEM<span class="hljs-symbol">\C</span>urrentControlSet<span class="hljs-symbol">\S</span>ervices<span class="hljs-symbol">\M</span>ySQLæœåŠ¡åˆ é™¤<br></code></pre></td></tr></table></figure><blockquote><p>æ³¨å†Œè¡¨ä¸­çš„ControlSet001,ControlSet002,ä¸ä¸€å®šæ˜¯001å’Œ002,å¯èƒ½æ˜¯ControlSet005ã€006ä¹‹ç±»</p></blockquote><h3 id="æ­¥éª¤5ï¼šåˆ é™¤ç¯å¢ƒå˜é‡é…ç½®"><a href="#æ­¥éª¤5ï¼šåˆ é™¤ç¯å¢ƒå˜é‡é…ç½®" class="headerlink" title="æ­¥éª¤5ï¼šåˆ é™¤ç¯å¢ƒå˜é‡é…ç½®"></a>æ­¥éª¤5ï¼šåˆ é™¤ç¯å¢ƒå˜é‡é…ç½®</h3><p>æ‰¾åˆ°pathç¯å¢ƒå˜é‡ï¼Œå°†å…¶ä¸­å…³äºmysqlçš„ç¯å¢ƒå˜é‡åˆ é™¤ï¼Œ<strong>åˆ‡è®°ä¸è¦å…¨éƒ¨åˆ é™¤ã€‚</strong></p><p>ä¾‹å¦‚ï¼šåˆ é™¤  D:\develop_tools\mysql\MySQLServer8.0.26\bin;  è¿™ä¸ªéƒ¨åˆ†</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1575694476072.png"></p><h2 id="2-MySQLçš„ä¸‹è½½ã€å®‰è£…ã€é…ç½®"><a href="#2-MySQLçš„ä¸‹è½½ã€å®‰è£…ã€é…ç½®" class="headerlink" title="2. MySQLçš„ä¸‹è½½ã€å®‰è£…ã€é…ç½®"></a>2. MySQLçš„ä¸‹è½½ã€å®‰è£…ã€é…ç½®</h2><h3 id="2-1-MySQLçš„4å¤§ç‰ˆæœ¬"><a href="#2-1-MySQLçš„4å¤§ç‰ˆæœ¬" class="headerlink" title="2.1 MySQLçš„4å¤§ç‰ˆæœ¬"></a>2.1 MySQLçš„4å¤§ç‰ˆæœ¬</h3><blockquote><ul><li><p><strong>MySQL Community Server ç¤¾åŒºç‰ˆæœ¬</strong>ï¼Œå¼€æºå…è´¹ï¼Œè‡ªç”±ä¸‹è½½ï¼Œä½†ä¸æä¾›å®˜æ–¹æŠ€æœ¯æ”¯æŒï¼Œé€‚ç”¨äºå¤§å¤šæ•°æ™®é€šç”¨æˆ·ã€‚</p></li><li><p><strong>MySQL Enterprise Edition ä¼ä¸šç‰ˆæœ¬</strong>ï¼Œéœ€ä»˜è´¹ï¼Œä¸èƒ½åœ¨çº¿ä¸‹è½½ï¼Œå¯ä»¥è¯•ç”¨30å¤©ã€‚æä¾›äº†æ›´å¤šçš„åŠŸèƒ½å’Œæ›´å®Œå¤‡çš„æŠ€æœ¯æ”¯æŒï¼Œæ›´é€‚åˆäºå¯¹æ•°æ®åº“çš„åŠŸèƒ½å’Œå¯é æ€§è¦æ±‚è¾ƒé«˜çš„ä¼ä¸šå®¢æˆ·ã€‚</p></li><li><p><strong>MySQL Cluster é›†ç¾¤ç‰ˆ</strong>ï¼Œå¼€æºå…è´¹ã€‚ç”¨äºæ¶è®¾é›†ç¾¤æœåŠ¡å™¨ï¼Œå¯å°†å‡ ä¸ªMySQL Serverå°è£…æˆä¸€ä¸ªServerã€‚éœ€è¦åœ¨ç¤¾åŒºç‰ˆæˆ–ä¼ä¸šç‰ˆçš„åŸºç¡€ä¸Šä½¿ç”¨ã€‚</p></li><li><p><strong>MySQL Cluster CGE é«˜çº§é›†ç¾¤ç‰ˆ</strong>ï¼Œéœ€ä»˜è´¹ã€‚</p></li></ul></blockquote><ul><li>ç›®å‰æœ€æ–°ç‰ˆæœ¬ä¸º<code>8.0.27</code>ï¼Œå‘å¸ƒæ—¶é—´<code>2021å¹´10æœˆ</code>ã€‚æ­¤å‰ï¼Œ8.0.0 åœ¨ 2016.9.12æ—¥å°±å‘å¸ƒäº†ã€‚</li></ul><ul><li>æœ¬è¯¾ç¨‹ä¸­ä½¿ç”¨<code>8.0.26ç‰ˆæœ¬</code>ã€‚</li></ul><p>æ­¤å¤–ï¼Œå®˜æ–¹è¿˜æä¾›äº†<code>MySQL Workbench</code>ï¼ˆGUITOOLï¼‰ä¸€æ¬¾ä¸“ä¸ºMySQLè®¾è®¡çš„<code>å›¾å½¢ç•Œé¢ç®¡ç†å·¥å…·</code>ã€‚MySQLWorkbenchåˆåˆ†ä¸ºä¸¤ä¸ªç‰ˆæœ¬ï¼Œåˆ†åˆ«æ˜¯<code>ç¤¾åŒºç‰ˆ</code>ï¼ˆMySQL Workbench OSSï¼‰ã€<code>å•†ç”¨ç‰ˆ</code>ï¼ˆMySQL WorkbenchSEï¼‰ã€‚</p><h3 id="2-2-è½¯ä»¶çš„ä¸‹è½½"><a href="#2-2-è½¯ä»¶çš„ä¸‹è½½" class="headerlink" title="2.2 è½¯ä»¶çš„ä¸‹è½½"></a>2.2 è½¯ä»¶çš„ä¸‹è½½</h3><p><strong>1. ä¸‹è½½åœ°å€</strong></p><p>å®˜ç½‘ï¼š<a href="https://www.mysql.com/">https://www.mysql.com</a></p><p><strong>2. æ‰“å¼€å®˜ç½‘ï¼Œç‚¹å‡»DOWNLOADS</strong></p><p>ç„¶åï¼Œç‚¹å‡»<code>MySQL Community(GPL) Downloads</code></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20210817185920150.png"></p><p><strong>3. ç‚¹å‡» MySQL Community Server</strong></p> <img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20210817185955123.png" alt="" style="zoom:80%;" /><p><strong>4. åœ¨General Availability(GA) Releasesä¸­é€‰æ‹©é€‚åˆçš„ç‰ˆæœ¬</strong></p><p>Windowså¹³å°ä¸‹æä¾›ä¸¤ç§å®‰è£…æ–‡ä»¶ï¼šMySQLäºŒè¿›åˆ¶åˆ†å‘ç‰ˆï¼ˆ.msiå®‰è£…æ–‡ä»¶ï¼‰å’Œå…å®‰è£…ç‰ˆï¼ˆ.zipå‹ç¼©æ–‡ä»¶ï¼‰ã€‚ä¸€èˆ¬æ¥è®²ï¼Œåº”å½“ä½¿ç”¨äºŒè¿›åˆ¶åˆ†å‘ç‰ˆï¼Œå› ä¸ºè¯¥ç‰ˆæœ¬æä¾›äº†å›¾å½¢åŒ–çš„å®‰è£…å‘å¯¼è¿‡ç¨‹ï¼Œæ¯”å…¶ä»–çš„åˆ†å‘ç‰ˆä½¿ç”¨èµ·æ¥è¦ç®€å•ï¼Œä¸å†éœ€è¦å…¶ä»–å·¥å…·å¯åŠ¨å°±å¯ä»¥è¿è¡ŒMySQLã€‚</p><ul><li>è¿™é‡Œåœ¨Windows ç³»ç»Ÿä¸‹æ¨èä¸‹è½½<code>MSIå®‰è£…ç¨‹åº</code>ï¼›ç‚¹å‡»<code>Go to Download Page</code>è¿›è¡Œä¸‹è½½å³å¯</li></ul> <img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20210727192819147.png" alt="" style="zoom:67%;" /><p> <img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211014163001964.png"></p><ul><li>Windowsä¸‹çš„MySQL8.0å®‰è£…æœ‰ä¸¤ç§å®‰è£…ç¨‹åº<ul><li><code>mysql-installer-web-community-8.0.26.0.msi</code> ä¸‹è½½ç¨‹åºå¤§å°ï¼š2.4Mï¼›å®‰è£…æ—¶éœ€è¦è”ç½‘å®‰è£…ç»„ä»¶ã€‚</li><li><code>mysql-installer-community-8.0.26.0.msi</code> ä¸‹è½½ç¨‹åºå¤§å°ï¼š450.7Mï¼›å®‰è£…æ—¶ç¦»çº¿å®‰è£…å³å¯ã€‚<strong>æ¨èã€‚</strong></li></ul></li><li>å¦‚æœå®‰è£…MySQL5.7ç‰ˆæœ¬çš„è¯ï¼Œé€‰æ‹©<code>Archives</code>ï¼Œæ¥ç€é€‰æ‹©MySQL5.7çš„ç›¸åº”ç‰ˆæœ¬å³å¯ã€‚è¿™é‡Œä¸‹è½½æœ€è¿‘æœŸçš„MySQL5.7.34ç‰ˆæœ¬ã€‚</li></ul><p> <img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211014163228051.png"></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211014163353156.png"></p><h3 id="2-3-MySQL8-0-ç‰ˆæœ¬çš„å®‰è£…"><a href="#2-3-MySQL8-0-ç‰ˆæœ¬çš„å®‰è£…" class="headerlink" title="2.3 MySQL8.0 ç‰ˆæœ¬çš„å®‰è£…"></a>2.3 MySQL8.0 ç‰ˆæœ¬çš„å®‰è£…</h3><p>MySQLä¸‹è½½å®Œæˆåï¼Œæ‰¾åˆ°ä¸‹è½½æ–‡ä»¶ï¼ŒåŒå‡»è¿›è¡Œå®‰è£…ï¼Œå…·ä½“æ“ä½œæ­¥éª¤å¦‚ä¸‹ã€‚</p><p>æ­¥éª¤1ï¼šåŒå‡»ä¸‹è½½çš„mysql-installer-community-8.0.26.0.msiæ–‡ä»¶ï¼Œæ‰“å¼€å®‰è£…å‘å¯¼ã€‚</p><p>æ­¥éª¤2ï¼šæ‰“å¼€â€œChoosing a Setup Typeâ€ï¼ˆé€‰æ‹©å®‰è£…ç±»å‹ï¼‰çª—å£ï¼Œåœ¨å…¶ä¸­åˆ—å‡ºäº†5ç§å®‰è£…ç±»å‹ï¼Œåˆ†åˆ«æ˜¯Developer Defaultï¼ˆé»˜è®¤å®‰è£…ç±»å‹ï¼‰ã€Server onlyï¼ˆä»…ä½œä¸ºæœåŠ¡å™¨ï¼‰ã€Client onlyï¼ˆä»…ä½œä¸ºå®¢æˆ·ç«¯ï¼‰ã€Fullï¼ˆå®Œå…¨å®‰è£…ï¼‰ã€Customï¼ˆè‡ªå®šä¹‰å®‰è£…ï¼‰ã€‚è¿™é‡Œé€‰æ‹©â€œCustomï¼ˆè‡ªå®šä¹‰å®‰è£…ï¼‰â€ç±»å‹æŒ‰é’®ï¼Œå•å‡»â€œNext(ä¸‹ä¸€æ­¥)â€æŒ‰é’®ã€‚</p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211014170553535.png" alt="" style="zoom:90%;" /><p>æ­¥éª¤3ï¼šæ‰“å¼€â€œSelect Productsâ€ ï¼ˆé€‰æ‹©äº§å“ï¼‰çª—å£ï¼Œå¯ä»¥å®šåˆ¶éœ€è¦å®‰è£…çš„äº§å“æ¸…å•ã€‚ä¾‹å¦‚ï¼Œé€‰æ‹©â€œMySQL Server 8.0.26-X64â€åï¼Œå•å‡»â€œâ†’â€æ·»åŠ æŒ‰é’®ï¼Œå³å¯é€‰æ‹©å®‰è£…MySQLæœåŠ¡å™¨ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚é‡‡ç”¨é€šç”¨çš„æ–¹æ³•ï¼Œå¯ä»¥æ·»åŠ å…¶ä»–ä½ éœ€è¦å®‰è£…çš„äº§å“ã€‚</p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211014170638699.png" alt="" style="zoom:80%;" /><p>æ­¤æ—¶å¦‚æœç›´æ¥â€œNextâ€ï¼ˆä¸‹ä¸€æ­¥ï¼‰ï¼Œåˆ™äº§å“çš„å®‰è£…è·¯å¾„æ˜¯é»˜è®¤çš„ã€‚å¦‚æœæƒ³è¦è‡ªå®šä¹‰å®‰è£…ç›®å½•ï¼Œåˆ™å¯ä»¥é€‰ä¸­å¯¹åº”çš„äº§å“ï¼Œç„¶ååœ¨ä¸‹é¢ä¼šå‡ºç°â€œAdvanced Optionsâ€ï¼ˆé«˜çº§é€‰é¡¹ï¼‰çš„è¶…é“¾æ¥ã€‚</p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211014170814386.png" alt="" style="zoom:80%;" /><p>å•å‡»â€œAdvanced Optionsâ€ï¼ˆé«˜çº§é€‰é¡¹ï¼‰åˆ™ä¼šå¼¹å‡ºå®‰è£…ç›®å½•çš„é€‰æ‹©çª—å£ï¼Œå¦‚å›¾æ‰€ç¤ºï¼Œæ­¤æ—¶ä½ å¯ä»¥åˆ†åˆ«è®¾ç½®MySQLçš„æœåŠ¡ç¨‹åºå®‰è£…ç›®å½•å’Œæ•°æ®å­˜å‚¨ç›®å½•ã€‚å¦‚æœä¸è®¾ç½®ï¼Œé»˜è®¤åˆ†åˆ«åœ¨Cç›˜çš„Program Filesç›®å½•å’ŒProgramDataç›®å½•ï¼ˆè¿™æ˜¯ä¸€ä¸ªéšè—ç›®å½•ï¼‰ã€‚å¦‚æœè‡ªå®šä¹‰å®‰è£…ç›®å½•ï¼Œè¯·é¿å…â€œä¸­æ–‡â€ç›®å½•ã€‚å¦å¤–ï¼Œå»ºè®®æœåŠ¡ç›®å½•å’Œæ•°æ®ç›®å½•åˆ†å¼€å­˜æ”¾ã€‚</p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211014170857263.png" alt="" style="zoom:80%;" /><p>æ­¥éª¤4ï¼šåœ¨ä¸Šä¸€æ­¥é€‰æ‹©å¥½è¦å®‰è£…çš„äº§å“ä¹‹åï¼Œå•å‡»â€œNextâ€ï¼ˆä¸‹ä¸€æ­¥ï¼‰è¿›å…¥ç¡®è®¤çª—å£ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚å•å‡»â€œExecuteâ€ï¼ˆæ‰§è¡Œï¼‰æŒ‰é’®å¼€å§‹å®‰è£…ã€‚</p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211014170934889.png" alt="" style="zoom:90%;" /><p>æ­¥éª¤5ï¼šå®‰è£…å®Œæˆååœ¨â€œStatusâ€ï¼ˆçŠ¶æ€ï¼‰åˆ—è¡¨ä¸‹å°†æ˜¾ç¤ºâ€œCompleteâ€ï¼ˆå®‰è£…å®Œæˆï¼‰ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚</p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211014171002259.png" alt="" style="zoom:90%;" /><h3 id="2-4-é…ç½®MySQL8-0"><a href="#2-4-é…ç½®MySQL8-0" class="headerlink" title="2.4 é…ç½®MySQL8.0"></a>2.4 é…ç½®MySQL8.0</h3><p>MySQLå®‰è£…ä¹‹åï¼Œéœ€è¦å¯¹æœåŠ¡å™¨è¿›è¡Œé…ç½®ã€‚å…·ä½“çš„é…ç½®æ­¥éª¤å¦‚ä¸‹ã€‚</p><p>æ­¥éª¤1ï¼šåœ¨ä¸Šä¸€ä¸ªå°èŠ‚çš„æœ€åä¸€æ­¥ï¼Œå•å‡»â€œNextâ€ï¼ˆä¸‹ä¸€æ­¥ï¼‰æŒ‰é’®ï¼Œå°±å¯ä»¥è¿›å…¥äº§å“é…ç½®çª—å£ã€‚</p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/clip_image002-1634203188594.jpg" alt="" style="zoom:80%;" /><p>æ­¥éª¤2ï¼šå•å‡»â€œNextâ€ï¼ˆä¸‹ä¸€æ­¥ï¼‰æŒ‰é’®ï¼Œè¿›å…¥MySQLæœåŠ¡å™¨ç±»å‹é…ç½®çª—å£ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚ç«¯å£å·ä¸€èˆ¬é€‰æ‹©é»˜è®¤ç«¯å£å·3306ã€‚</p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/clip_image004-1634203188595.jpg" alt="" style="zoom:80%;" /><p>å…¶ä¸­ï¼Œâ€œConfig Typeâ€é€‰é¡¹ç”¨äºè®¾ç½®æœåŠ¡å™¨çš„ç±»å‹ã€‚å•å‡»è¯¥é€‰é¡¹å³ä¾§çš„ä¸‹ä¸‰è§’æŒ‰é’®ï¼Œå³å¯æŸ¥çœ‹3ä¸ªé€‰é¡¹ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚</p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/clip_image006-1634203188595.jpg" alt="" style="zoom:80%;" /><ul><li><p><code>Development Machineï¼ˆå¼€å‘æœºå™¨ï¼‰</code>ï¼šè¯¥é€‰é¡¹ä»£è¡¨å…¸å‹ä¸ªäººç”¨æ¡Œé¢å·¥ä½œç«™ã€‚æ­¤æ—¶æœºå™¨ä¸Šéœ€è¦è¿è¡Œå¤šä¸ªåº”ç”¨ç¨‹åºï¼Œé‚£ä¹ˆMySQLæœåŠ¡å™¨å°†å ç”¨æœ€å°‘çš„ç³»ç»Ÿèµ„æºã€‚</p></li><li><p><code>Server Machineï¼ˆæœåŠ¡å™¨ï¼‰</code>ï¼šè¯¥é€‰é¡¹ä»£è¡¨æœåŠ¡å™¨ï¼ŒMySQLæœåŠ¡å™¨å¯ä»¥åŒå…¶ä»–æœåŠ¡å™¨åº”ç”¨ç¨‹åºä¸€èµ·è¿è¡Œï¼Œä¾‹å¦‚WebæœåŠ¡å™¨ç­‰ã€‚MySQLæœåŠ¡å™¨é…ç½®æˆé€‚å½“æ¯”ä¾‹çš„ç³»ç»Ÿèµ„æºã€‚</p></li><li><p><code>Dedicated Machineï¼ˆä¸“ç”¨æœåŠ¡å™¨ï¼‰</code>ï¼šè¯¥é€‰é¡¹ä»£è¡¨åªè¿è¡ŒMySQLæœåŠ¡çš„æœåŠ¡å™¨ã€‚MySQLæœåŠ¡å™¨é…ç½®æˆä½¿ç”¨æ‰€æœ‰å¯ç”¨ç³»ç»Ÿèµ„æºã€‚</p></li></ul><p>æ­¥éª¤3ï¼šå•å‡»â€œNextâ€ï¼ˆä¸‹ä¸€æ­¥ï¼‰æŒ‰é’®ï¼Œæ‰“å¼€è®¾ç½®æˆæƒæ–¹å¼çª—å£ã€‚å…¶ä¸­ï¼Œä¸Šé¢çš„é€‰é¡¹æ˜¯MySQL8.0æä¾›çš„æ–°çš„æˆæƒæ–¹å¼ï¼Œé‡‡ç”¨SHA256åŸºç¡€çš„å¯†ç åŠ å¯†æ–¹æ³•ï¼›ä¸‹é¢çš„é€‰é¡¹æ˜¯ä¼ ç»Ÿæˆæƒæ–¹æ³•ï¼ˆä¿ç•™5.xç‰ˆæœ¬å…¼å®¹æ€§ï¼‰ã€‚</p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/clip_image008-1634203188595.jpg" alt="" style="zoom:80%;" /><p>æ­¥éª¤4ï¼šå•å‡»â€œNextâ€ï¼ˆä¸‹ä¸€æ­¥ï¼‰æŒ‰é’®ï¼Œæ‰“å¼€è®¾ç½®æœåŠ¡å™¨rootè¶…çº§ç®¡ç†å‘˜çš„å¯†ç çª—å£ï¼Œå¦‚å›¾æ‰€ç¤ºï¼Œéœ€è¦è¾“å…¥ä¸¤æ¬¡åŒæ ·çš„ç™»å½•å¯†ç ã€‚ä¹Ÿå¯ä»¥é€šè¿‡â€œAdd Userâ€æ·»åŠ å…¶ä»–ç”¨æˆ·ï¼Œæ·»åŠ å…¶ä»–ç”¨æˆ·æ—¶ï¼Œéœ€è¦æŒ‡å®šç”¨æˆ·åã€å…è®¸è¯¥ç”¨æˆ·ååœ¨å“ªå°/å“ªäº›ä¸»æœºä¸Šç™»å½•ï¼Œè¿˜å¯ä»¥æŒ‡å®šç”¨æˆ·è§’è‰²ç­‰ã€‚æ­¤å¤„æš‚ä¸æ·»åŠ ç”¨æˆ·ï¼Œç”¨æˆ·ç®¡ç†åœ¨MySQLé«˜çº§ç‰¹æ€§ç¯‡ä¸­è®²è§£ã€‚</p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/clip_image010-1634203188595.jpg" alt="" style="zoom:80%;" /><p>æ­¥éª¤5ï¼šå•å‡»â€œNextâ€ï¼ˆä¸‹ä¸€æ­¥ï¼‰æŒ‰é’®ï¼Œæ‰“å¼€è®¾ç½®æœåŠ¡å™¨åç§°çª—å£ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚è¯¥æœåŠ¡åä¼šå‡ºç°åœ¨WindowsæœåŠ¡åˆ—è¡¨ä¸­ï¼Œä¹Ÿå¯ä»¥åœ¨å‘½ä»¤è¡Œçª—å£ä¸­ä½¿ç”¨è¯¥æœåŠ¡åè¿›è¡Œå¯åŠ¨å’Œåœæ­¢æœåŠ¡ã€‚æœ¬ä¹¦å°†æœåŠ¡åè®¾ç½®ä¸ºâ€œMySQL80â€ã€‚å¦‚æœå¸Œæœ›å¼€æœºè‡ªå¯åŠ¨æœåŠ¡ï¼Œä¹Ÿå¯ä»¥å‹¾é€‰â€œStart the MySQL Server at System Startupâ€é€‰é¡¹ï¼ˆæ¨èï¼‰ã€‚</p><p>ä¸‹é¢æ˜¯é€‰æ‹©ä»¥ä»€ä¹ˆæ–¹å¼è¿è¡ŒæœåŠ¡ï¼Ÿå¯ä»¥é€‰æ‹©â€œStandard System Accountâ€(æ ‡å‡†ç³»ç»Ÿç”¨æˆ·)æˆ–è€…â€œCustom Userâ€(è‡ªå®šä¹‰ç”¨æˆ·)ä¸­çš„ä¸€ä¸ªã€‚è¿™é‡Œæ¨èå‰è€…ã€‚</p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/clip_image012-1634203188596.jpg" alt="" style="zoom:80%;" /><p>æ­¥éª¤6ï¼šå•å‡»â€œNextâ€ï¼ˆä¸‹ä¸€æ­¥ï¼‰æŒ‰é’®ï¼Œæ‰“å¼€ç¡®è®¤è®¾ç½®æœåŠ¡å™¨çª—å£ï¼Œå•å‡»â€œExecuteâ€ï¼ˆæ‰§è¡Œï¼‰æŒ‰é’®ã€‚</p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/clip_image014-1634203188596.jpg" alt="" style="zoom:80%;" /><p>æ­¥éª¤7ï¼šå®Œæˆé…ç½®ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚å•å‡»â€œFinishâ€ï¼ˆå®Œæˆï¼‰æŒ‰é’®ï¼Œå³å¯å®ŒæˆæœåŠ¡å™¨çš„é…ç½®ã€‚</p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/clip_image016.jpg" alt="" style="zoom:80%;" /><p>æ­¥éª¤8ï¼šå¦‚æœè¿˜æœ‰å…¶ä»–äº§å“éœ€è¦é…ç½®ï¼Œå¯ä»¥é€‰æ‹©å…¶ä»–äº§å“ï¼Œç„¶åç»§ç»­é…ç½®ã€‚å¦‚æœæ²¡æœ‰ï¼Œç›´æ¥é€‰æ‹©â€œNextâ€ï¼ˆä¸‹ä¸€æ­¥ï¼‰ï¼Œç›´æ¥å®Œæˆæ•´ä¸ªå®‰è£…å’Œé…ç½®è¿‡ç¨‹ã€‚</p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/clip_image018.jpg" alt="" style="zoom:80%;" /><p>æ­¥éª¤9ï¼šç»“æŸå®‰è£…å’Œé…ç½®ã€‚</p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/clip_image020.jpg" alt="" style="zoom:80%;" /><h3 id="2-5-é…ç½®MySQL8-0-ç¯å¢ƒå˜é‡"><a href="#2-5-é…ç½®MySQL8-0-ç¯å¢ƒå˜é‡" class="headerlink" title="2.5 é…ç½®MySQL8.0 ç¯å¢ƒå˜é‡"></a>2.5 é…ç½®MySQL8.0 ç¯å¢ƒå˜é‡</h3><p>å¦‚æœä¸é…ç½®MySQLç¯å¢ƒå˜é‡ï¼Œå°±ä¸èƒ½åœ¨å‘½ä»¤è¡Œç›´æ¥è¾“å…¥MySQLç™»å½•å‘½ä»¤ã€‚ä¸‹é¢è¯´å¦‚ä½•é…ç½®MySQLçš„ç¯å¢ƒå˜é‡ï¼š</p><p>æ­¥éª¤1ï¼šåœ¨æ¡Œé¢ä¸Šå³å‡»ã€æ­¤ç”µè„‘ã€‘å›¾æ ‡ï¼Œåœ¨å¼¹å‡ºçš„å¿«æ·èœå•ä¸­é€‰æ‹©ã€å±æ€§ã€‘èœå•å‘½ä»¤ã€‚<br>æ­¥éª¤2ï¼šæ‰“å¼€ã€ç³»ç»Ÿã€‘çª—å£ï¼Œå•å‡»ã€é«˜çº§ç³»ç»Ÿè®¾ç½®ã€‘é“¾æ¥ã€‚<br>æ­¥éª¤3ï¼šæ‰“å¼€ã€ç³»ç»Ÿå±æ€§ã€‘å¯¹è¯æ¡†ï¼Œé€‰æ‹©ã€é«˜çº§ã€‘é€‰é¡¹å¡ï¼Œç„¶åå•å‡»ã€ç¯å¢ƒå˜é‡ã€‘æŒ‰é’®ã€‚<br>æ­¥éª¤4ï¼šæ‰“å¼€ã€ç¯å¢ƒå˜é‡ã€‘å¯¹è¯æ¡†ï¼Œåœ¨ç³»ç»Ÿå˜é‡åˆ—è¡¨ä¸­é€‰æ‹©pathå˜é‡ã€‚<br>æ­¥éª¤5ï¼šå•å‡»ã€ç¼–è¾‘ã€‘æŒ‰é’®ï¼Œåœ¨ã€ç¼–è¾‘ç¯å¢ƒå˜é‡ã€‘å¯¹è¯æ¡†ä¸­ï¼Œå°†MySQLåº”ç”¨ç¨‹åºçš„binç›®å½•ï¼ˆC:\Program Files\MySQL\MySQL Server 8.0\binï¼‰æ·»åŠ åˆ°å˜é‡å€¼ä¸­ï¼Œç”¨åˆ†å·å°†å…¶ä¸å…¶ä»–è·¯å¾„åˆ†éš”å¼€ã€‚<br>æ­¥éª¤6ï¼šæ·»åŠ å®Œæˆä¹‹åï¼Œå•å‡»ã€ç¡®å®šã€‘æŒ‰é’®ï¼Œè¿™æ ·å°±å®Œæˆäº†é…ç½®pathå˜é‡çš„æ“ä½œï¼Œç„¶åå°±å¯ä»¥ç›´æ¥è¾“å…¥MySQLå‘½ä»¤æ¥ç™»å½•æ•°æ®åº“äº†ã€‚</p><h3 id="2-6-MySQL5-7-ç‰ˆæœ¬çš„å®‰è£…ã€é…ç½®"><a href="#2-6-MySQL5-7-ç‰ˆæœ¬çš„å®‰è£…ã€é…ç½®" class="headerlink" title="2.6 MySQL5.7 ç‰ˆæœ¬çš„å®‰è£…ã€é…ç½®"></a>2.6 MySQL5.7 ç‰ˆæœ¬çš„å®‰è£…ã€é…ç½®</h3><ul><li><strong>å®‰è£…</strong></li></ul><p>æ­¤ç‰ˆæœ¬çš„å®‰è£…è¿‡ç¨‹ä¸ä¸Šè¿°è¿‡ç¨‹é™¤äº†ç‰ˆæœ¬å·ä¸åŒä¹‹å¤–ï¼Œå…¶å®ƒç¯èŠ‚éƒ½æ˜¯ç›¸åŒçš„ã€‚æ‰€ä»¥è¿™é‡Œçœç•¥äº†MySQL5.7.34ç‰ˆæœ¬çš„å®‰è£…æˆªå›¾ã€‚</p><ul><li><strong>é…ç½®</strong></li></ul><p>é…ç½®ç¯èŠ‚ä¸MySQL8.0ç‰ˆæœ¬ç¡®æœ‰ç»†å¾®ä¸åŒã€‚å¤§éƒ¨åˆ†æƒ…å†µä¸‹ç›´æ¥é€‰æ‹©â€œNextâ€å³å¯ï¼Œä¸å½±å“æ•´ç†ä½¿ç”¨ã€‚</p><p>è¿™é‡Œé…ç½®MySQL5.7æ—¶ï¼Œé‡ç‚¹å¼ºè°ƒï¼š<strong>ä¸å‰é¢å®‰è£…å¥½çš„MySQL8.0ä¸èƒ½ä½¿ç”¨ç›¸åŒçš„ç«¯å£å·ã€‚</strong></p><h3 id="2-7-å®‰è£…å¤±è´¥é—®é¢˜"><a href="#2-7-å®‰è£…å¤±è´¥é—®é¢˜" class="headerlink" title="2.7 å®‰è£…å¤±è´¥é—®é¢˜"></a>2.7 å®‰è£…å¤±è´¥é—®é¢˜</h3><p>MySQLçš„å®‰è£…å’Œé…ç½®æ˜¯ä¸€ä»¶éå¸¸ç®€å•çš„äº‹ï¼Œä½†æ˜¯åœ¨æ“ä½œè¿‡ç¨‹ä¸­ä¹Ÿå¯èƒ½å‡ºç°é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯åˆå­¦è€…ã€‚</p><p><strong>é—®é¢˜1ï¼šæ— æ³•æ‰“å¼€MySQL8.0è½¯ä»¶å®‰è£…åŒ…æˆ–è€…å®‰è£…è¿‡ç¨‹ä¸­å¤±è´¥ï¼Œå¦‚ä½•è§£å†³ï¼Ÿ</strong></p><p>åœ¨è¿è¡ŒMySQL8.0è½¯ä»¶å®‰è£…åŒ…ä¹‹å‰ï¼Œç”¨æˆ·éœ€è¦ç¡®ä¿ç³»ç»Ÿä¸­å·²ç»å®‰è£…äº†.Net Frameworkç›¸å…³è½¯ä»¶ï¼Œå¦‚æœç¼ºå°‘æ­¤è½¯ä»¶ï¼Œå°†ä¸èƒ½æ­£å¸¸åœ°å®‰è£…MySQL8.0è½¯ä»¶ã€‚</p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/clip_image002.gif" alt="" style="zoom:80%;" /><p>è§£å†³æ–¹æ¡ˆï¼šåˆ°è¿™ä¸ªåœ°å€<a href="https://www.microsoft.com/en-us/download/details.aspx?id=42642%E4%B8%8B%E8%BD%BDMicrosoft">https://www.microsoft.com/en-us/download/details.aspx?id=42642ä¸‹è½½Microsoft</a> .NET Framework 4.5å¹¶å®‰è£…åï¼Œå†å»å®‰è£…MySQLã€‚</p><p>å¦å¤–ï¼Œè¿˜è¦ç¡®ä¿Windows Installeræ­£å¸¸å®‰è£…ã€‚windowsä¸Šå®‰è£…mysql8.0éœ€è¦æ“ä½œç³»ç»Ÿæå‰å·²å®‰è£…å¥½Microsoft Visual C++ 2015-2019ã€‚</p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/clip_image004.gif" alt="" style="zoom:75%;" /><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/clip_image006.gif" alt="" style="zoom:75%;" /><p>è§£å†³æ–¹æ¡ˆåŒæ ·æ˜¯ï¼Œæå‰åˆ°å¾®è½¯å®˜ç½‘<a href="https://support.microsoft.com/en-us/topic/the-latest-supported-visual-c-downloads-2647da03-1eea-4433-9aff-95f26a218cc0%EF%BC%8C%E4%B8%8B%E8%BD%BD%E7%9B%B8%E5%BA%94%E7%9A%84%E7%8E%AF%E5%A2%83%E3%80%82">https://support.microsoft.com/en-us/topic/the-latest-supported-visual-c-downloads-2647da03-1eea-4433-9aff-95f26a218cc0ï¼Œä¸‹è½½ç›¸åº”çš„ç¯å¢ƒã€‚</a></p><p><strong>é—®é¢˜2ï¼šå¸è½½é‡è£…MySQLå¤±è´¥ï¼Ÿ</strong></p><p>è¯¥é—®é¢˜é€šå¸¸æ˜¯å› ä¸ºMySQLå¸è½½æ—¶ï¼Œæ²¡æœ‰å®Œå…¨æ¸…é™¤ç›¸å…³ä¿¡æ¯å¯¼è‡´çš„ã€‚</p><p>è§£å†³åŠæ³•æ˜¯ï¼ŒæŠŠä»¥å‰çš„å®‰è£…ç›®å½•åˆ é™¤ã€‚å¦‚æœä¹‹å‰å®‰è£…å¹¶æœªå•ç‹¬æŒ‡å®šè¿‡æœåŠ¡å®‰è£…ç›®å½•ï¼Œåˆ™é»˜è®¤å®‰è£…ç›®å½•æ˜¯â€œC:\Program Files\MySQLâ€ï¼Œå½»åº•åˆ é™¤è¯¥ç›®å½•ã€‚åŒæ—¶åˆ é™¤MySQLçš„Dataç›®å½•ï¼Œå¦‚æœä¹‹å‰å®‰è£…å¹¶æœªå•ç‹¬æŒ‡å®šè¿‡æ•°æ®ç›®å½•ï¼Œåˆ™é»˜è®¤å®‰è£…ç›®å½•æ˜¯â€œC:\ProgramData\MySQLâ€ï¼Œè¯¥ç›®å½•ä¸€èˆ¬ä¸ºéšè—ç›®å½•ã€‚åˆ é™¤åï¼Œé‡æ–°å®‰è£…å³å¯ã€‚</p><p><strong>é—®é¢˜3ï¼šå¦‚ä½•åœ¨Windowsç³»ç»Ÿåˆ é™¤ä¹‹å‰çš„æœªå¸è½½å¹²å‡€çš„MySQLæœåŠ¡åˆ—è¡¨ï¼Ÿ</strong></p><p>æ“ä½œæ–¹æ³•å¦‚ä¸‹ï¼Œåœ¨ç³»ç»Ÿâ€œæœç´¢æ¡†â€ä¸­è¾“å…¥â€œcmdâ€ï¼ŒæŒ‰â€œEnterâ€ï¼ˆå›è½¦ï¼‰é”®ç¡®è®¤ï¼Œå¼¹å‡ºå‘½ä»¤æç¤ºç¬¦ç•Œé¢ã€‚ç„¶åè¾“å…¥â€œsc delete MySQLæœåŠ¡åâ€,æŒ‰â€œEnterâ€ï¼ˆå›è½¦ï¼‰é”®ï¼Œå°±èƒ½å½»åº•åˆ é™¤æ®‹ä½™çš„MySQLæœåŠ¡äº†ã€‚</p><h2 id="3-MySQLçš„ç™»å½•"><a href="#3-MySQLçš„ç™»å½•" class="headerlink" title="3. MySQLçš„ç™»å½•"></a>3. MySQLçš„ç™»å½•</h2><h3 id="3-1-æœåŠ¡çš„å¯åŠ¨ä¸åœæ­¢"><a href="#3-1-æœåŠ¡çš„å¯åŠ¨ä¸åœæ­¢" class="headerlink" title="3.1 æœåŠ¡çš„å¯åŠ¨ä¸åœæ­¢"></a>3.1 æœåŠ¡çš„å¯åŠ¨ä¸åœæ­¢</h3><p>MySQLå®‰è£…å®Œæ¯•ä¹‹åï¼Œéœ€è¦å¯åŠ¨æœåŠ¡å™¨è¿›ç¨‹ï¼Œä¸ç„¶å®¢æˆ·ç«¯æ— æ³•è¿æ¥æ•°æ®åº“ã€‚</p><p>åœ¨å‰é¢çš„é…ç½®è¿‡ç¨‹ä¸­ï¼Œå·²ç»å°†MySQLå®‰è£…ä¸ºWindowsæœåŠ¡ï¼Œå¹¶ä¸”å‹¾é€‰å½“Windowså¯åŠ¨ã€åœæ­¢æ—¶ï¼ŒMySQLä¹Ÿè‡ªåŠ¨å¯åŠ¨ã€åœæ­¢ã€‚</p><h4 id="æ–¹å¼1ï¼šä½¿ç”¨å›¾å½¢ç•Œé¢å·¥å…·"><a href="#æ–¹å¼1ï¼šä½¿ç”¨å›¾å½¢ç•Œé¢å·¥å…·" class="headerlink" title="æ–¹å¼1ï¼šä½¿ç”¨å›¾å½¢ç•Œé¢å·¥å…·"></a>æ–¹å¼1ï¼šä½¿ç”¨å›¾å½¢ç•Œé¢å·¥å…·</h4><ul><li><p>æ­¥éª¤1ï¼šæ‰“å¼€windowsæœåŠ¡</p><ul><li>æ–¹å¼1ï¼šè®¡ç®—æœºï¼ˆç‚¹å‡»é¼ æ ‡å³é”®ï¼‰â†’ ç®¡ç†ï¼ˆç‚¹å‡»ï¼‰â†’ æœåŠ¡å’Œåº”ç”¨ç¨‹åºï¼ˆç‚¹å‡»ï¼‰â†’ æœåŠ¡ï¼ˆç‚¹å‡»ï¼‰</li><li>æ–¹å¼2ï¼šæ§åˆ¶é¢æ¿ï¼ˆç‚¹å‡»ï¼‰â†’ ç³»ç»Ÿå’Œå®‰å…¨ï¼ˆç‚¹å‡»ï¼‰â†’ ç®¡ç†å·¥å…·ï¼ˆç‚¹å‡»ï¼‰â†’ æœåŠ¡ï¼ˆç‚¹å‡»ï¼‰</li><li>æ–¹å¼3ï¼šä»»åŠ¡æ ï¼ˆç‚¹å‡»é¼ æ ‡å³é”®ï¼‰â†’ å¯åŠ¨ä»»åŠ¡ç®¡ç†å™¨ï¼ˆç‚¹å‡»ï¼‰â†’ æœåŠ¡ï¼ˆç‚¹å‡»ï¼‰</li><li>æ–¹å¼4ï¼šå•å‡»ã€å¼€å§‹ã€‘èœå•ï¼Œåœ¨æœç´¢æ¡†ä¸­è¾“å…¥â€œservices.mscâ€ï¼ŒæŒ‰Enteré”®ç¡®è®¤ </li></ul></li><li><p>æ­¥éª¤2ï¼šæ‰¾åˆ°MySQL80ï¼ˆç‚¹å‡»é¼ æ ‡å³é”®ï¼‰â†’ å¯åŠ¨æˆ–åœæ­¢ï¼ˆç‚¹å‡»ï¼‰</p></li></ul><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211014183908375.png"></p><h4 id="æ–¹å¼2ï¼šä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·"><a href="#æ–¹å¼2ï¼šä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·" class="headerlink" title="æ–¹å¼2ï¼šä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·"></a>æ–¹å¼2ï¼šä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql"># å¯åŠ¨ MySQL æœåŠ¡å‘½ä»¤ï¼š<br>net start MySQLæœåŠ¡å<br><br># åœæ­¢ MySQL æœåŠ¡å‘½ä»¤ï¼š<br>net stop MySQLæœåŠ¡å<br></code></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211014184037414.png" alt="" style="zoom:80%;" /><p>è¯´æ˜ï¼š</p><ol><li><p>startå’Œstopåé¢çš„æœåŠ¡ååº”ä¸ä¹‹å‰é…ç½®æ—¶æŒ‡å®šçš„æœåŠ¡åä¸€è‡´ã€‚</p></li><li><p>å¦‚æœå½“ä½ è¾“å…¥å‘½ä»¤åï¼Œæç¤ºâ€œæ‹’ç»æœåŠ¡â€ï¼Œè¯·ä»¥<code>ç³»ç»Ÿç®¡ç†å‘˜èº«ä»½</code>æ‰“å¼€å‘½ä»¤æç¤ºç¬¦ç•Œé¢é‡æ–°å°è¯•ã€‚</p></li></ol><h3 id="3-2-è‡ªå¸¦å®¢æˆ·ç«¯çš„ç™»å½•ä¸é€€å‡º"><a href="#3-2-è‡ªå¸¦å®¢æˆ·ç«¯çš„ç™»å½•ä¸é€€å‡º" class="headerlink" title="3.2 è‡ªå¸¦å®¢æˆ·ç«¯çš„ç™»å½•ä¸é€€å‡º"></a>3.2 è‡ªå¸¦å®¢æˆ·ç«¯çš„ç™»å½•ä¸é€€å‡º</h3><p>å½“MySQLæœåŠ¡å¯åŠ¨å®Œæˆåï¼Œä¾¿å¯ä»¥é€šè¿‡å®¢æˆ·ç«¯æ¥ç™»å½•MySQLæ•°æ®åº“ã€‚æ³¨æ„ï¼šç¡®è®¤æœåŠ¡æ˜¯å¼€å¯çš„ã€‚</p><h4 id="ç™»å½•æ–¹å¼1ï¼šMySQLè‡ªå¸¦å®¢æˆ·ç«¯"><a href="#ç™»å½•æ–¹å¼1ï¼šMySQLè‡ªå¸¦å®¢æˆ·ç«¯" class="headerlink" title="ç™»å½•æ–¹å¼1ï¼šMySQLè‡ªå¸¦å®¢æˆ·ç«¯"></a>ç™»å½•æ–¹å¼1ï¼šMySQLè‡ªå¸¦å®¢æˆ·ç«¯</h4><p>å¼€å§‹èœå• â†’ æ‰€æœ‰ç¨‹åº â†’ MySQL â†’ MySQL 8.0 Command Line Client</p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211014184425147.png" alt="" style="zoom:80%;" /><blockquote><p>è¯´æ˜ï¼šä»…é™äºrootç”¨æˆ·</p></blockquote><h4 id="ç™»å½•æ–¹å¼2ï¼šwindowså‘½ä»¤è¡Œ"><a href="#ç™»å½•æ–¹å¼2ï¼šwindowså‘½ä»¤è¡Œ" class="headerlink" title="ç™»å½•æ–¹å¼2ï¼šwindowså‘½ä»¤è¡Œ"></a>ç™»å½•æ–¹å¼2ï¼šwindowså‘½ä»¤è¡Œ</h4><ul><li>æ ¼å¼ï¼š</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">mysql -h ä¸»æœºå -<span class="hljs-selector-tag">P</span> ç«¯å£å· -u ç”¨æˆ·å -<span class="hljs-selector-tag">p</span>å¯†ç <br></code></pre></td></tr></table></figure><ul><li>ä¸¾ä¾‹ï¼š</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql -h localhost -P 3306 -u root -pabc123  # è¿™é‡Œæˆ‘è®¾ç½®çš„rootç”¨æˆ·çš„å¯†ç æ˜¯abc123<br></code></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211014185035137.png" alt="" style="zoom:80%;" /><p>æ³¨æ„ï¼š</p><p>ï¼ˆ1ï¼‰-pä¸å¯†ç ä¹‹é—´ä¸èƒ½æœ‰ç©ºæ ¼ï¼Œå…¶ä»–å‚æ•°åä¸å‚æ•°å€¼ä¹‹é—´å¯ä»¥æœ‰ç©ºæ ¼ä¹Ÿå¯ä»¥æ²¡æœ‰ç©ºæ ¼ã€‚å¦‚ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql <span class="hljs-operator">-</span>hlocalhost <span class="hljs-operator">-</span>P3306 <span class="hljs-operator">-</span>uroot <span class="hljs-operator">-</span>pabc123<br></code></pre></td></tr></table></figure><p>ï¼ˆ2ï¼‰å¯†ç å»ºè®®åœ¨ä¸‹ä¸€è¡Œè¾“å…¥ï¼Œä¿è¯å®‰å…¨</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql <span class="hljs-operator">-</span>h localhost <span class="hljs-operator">-</span>P <span class="hljs-number">3306</span> <span class="hljs-operator">-</span>u root <span class="hljs-operator">-</span>p<br>Enter password:<span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><br></code></pre></td></tr></table></figure><p>ï¼ˆ3ï¼‰å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨åœ¨åŒä¸€å°æœºå™¨ä¸Šï¼Œæ‰€ä»¥è¾“å…¥localhostæˆ–è€…IPåœ°å€127.0.0.1ã€‚åŒæ—¶ï¼Œå› ä¸ºæ˜¯è¿æ¥æœ¬æœºï¼š<br>-hlocalhostå°±å¯ä»¥çœç•¥ï¼Œå¦‚æœç«¯å£å·æ²¡æœ‰ä¿®æ”¹ï¼š-P3306ä¹Ÿå¯ä»¥çœç•¥</p><p>  ç®€å†™æˆï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql <span class="hljs-operator">-</span>u root <span class="hljs-operator">-</span>p<br>Enter password:<span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><br></code></pre></td></tr></table></figure><p>è¿æ¥æˆåŠŸåï¼Œæœ‰å…³äºMySQL ServeræœåŠ¡ç‰ˆæœ¬çš„ä¿¡æ¯ï¼Œè¿˜æœ‰ç¬¬å‡ æ¬¡è¿æ¥çš„idæ ‡è¯†ã€‚</p><p>ä¹Ÿå¯ä»¥åœ¨å‘½ä»¤è¡Œé€šè¿‡ä»¥ä¸‹æ–¹å¼è·å–MySQL ServeræœåŠ¡ç‰ˆæœ¬çš„ä¿¡æ¯ï¼š</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-symbol">c:</span>\&gt; mysql -V<br></code></pre></td></tr></table></figure><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">c:\&gt; mysql <span class="hljs-comment">--version</span><br></code></pre></td></tr></table></figure><p>æˆ–<strong>ç™»å½•</strong>åï¼Œé€šè¿‡ä»¥ä¸‹æ–¹å¼æŸ¥çœ‹å½“å‰ç‰ˆæœ¬ä¿¡æ¯ï¼š</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs csharp">mysql&gt; <span class="hljs-function"><span class="hljs-keyword">select</span> <span class="hljs-title">version</span>(<span class="hljs-params"></span>)</span>;<br></code></pre></td></tr></table></figure><h4 id="é€€å‡ºç™»å½•"><a href="#é€€å‡ºç™»å½•" class="headerlink" title="é€€å‡ºç™»å½•"></a>é€€å‡ºç™»å½•</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-keyword">exit</span><br>æˆ–<br>quit<br></code></pre></td></tr></table></figure><h2 id="4-MySQLæ¼”ç¤ºä½¿ç”¨"><a href="#4-MySQLæ¼”ç¤ºä½¿ç”¨" class="headerlink" title="4. MySQLæ¼”ç¤ºä½¿ç”¨"></a>4. MySQLæ¼”ç¤ºä½¿ç”¨</h2><h3 id="4-1-MySQLçš„ä½¿ç”¨æ¼”ç¤º"><a href="#4-1-MySQLçš„ä½¿ç”¨æ¼”ç¤º" class="headerlink" title="4.1 MySQLçš„ä½¿ç”¨æ¼”ç¤º"></a>4.1 MySQLçš„ä½¿ç”¨æ¼”ç¤º</h3><p>1ã€æŸ¥çœ‹æ‰€æœ‰çš„æ•°æ®åº“</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">show databases;<br></code></pre></td></tr></table></figure><blockquote><p>â€œinformation_schemaâ€æ˜¯ MySQL ç³»ç»Ÿè‡ªå¸¦çš„æ•°æ®åº“ï¼Œä¸»è¦ä¿å­˜ MySQL æ•°æ®åº“æœåŠ¡å™¨çš„ç³»ç»Ÿä¿¡æ¯ï¼Œæ¯”å¦‚æ•°æ®åº“çš„åç§°ã€æ•°æ®è¡¨çš„åç§°ã€å­—æ®µåç§°ã€å­˜å–æƒé™ã€æ•°æ®æ–‡ä»¶ æ‰€åœ¨çš„æ–‡ä»¶å¤¹å’Œç³»ç»Ÿä½¿ç”¨çš„æ–‡ä»¶å¤¹ï¼Œç­‰ç­‰</p><p>â€œperformance_schemaâ€æ˜¯ MySQL ç³»ç»Ÿè‡ªå¸¦çš„æ•°æ®åº“ï¼Œå¯ä»¥ç”¨æ¥ç›‘æ§ MySQL çš„å„ç±»æ€§èƒ½æŒ‡æ ‡ã€‚ </p><p>â€œsysâ€æ•°æ®åº“æ˜¯ MySQL ç³»ç»Ÿè‡ªå¸¦çš„æ•°æ®åº“ï¼Œä¸»è¦ä½œç”¨æ˜¯ä»¥ä¸€ç§æ›´å®¹æ˜“è¢«ç†è§£çš„æ–¹å¼å±•ç¤º MySQL æ•°æ®åº“æœåŠ¡å™¨çš„å„ç±»æ€§èƒ½æŒ‡æ ‡ï¼Œå¸®åŠ©ç³»ç»Ÿç®¡ç†å‘˜å’Œå¼€å‘äººå‘˜ç›‘æ§ MySQL çš„æŠ€æœ¯æ€§èƒ½ã€‚ </p><p>â€œmysqlâ€æ•°æ®åº“ä¿å­˜äº† MySQL æ•°æ®åº“æœåŠ¡å™¨è¿è¡Œæ—¶éœ€è¦çš„ç³»ç»Ÿä¿¡æ¯ï¼Œæ¯”å¦‚æ•°æ®æ–‡ä»¶å¤¹ã€å½“å‰ä½¿ç”¨çš„å­—ç¬¦é›†ã€çº¦æŸæ£€æŸ¥ä¿¡æ¯ï¼Œç­‰ç­‰</p></blockquote><p>ä¸ºä»€ä¹ˆ Workbench é‡Œé¢æˆ‘ä»¬åªèƒ½çœ‹åˆ°â€œdemoâ€å’Œâ€œsysâ€è¿™ 2 ä¸ªæ•°æ®åº“å‘¢ï¼Ÿ </p><p>è¿™æ˜¯å› ä¸ºï¼ŒWorkbench æ˜¯å›¾å½¢åŒ–çš„ç®¡ç†å·¥å…·ï¼Œä¸»è¦é¢å‘å¼€å‘äºº å‘˜ï¼Œâ€œdemoâ€å’Œâ€œsysâ€è¿™ 2 ä¸ªæ•°æ®åº“å·²ç»å¤Ÿç”¨äº†ã€‚å¦‚æœæœ‰ç‰¹æ®Šéœ€æ±‚ï¼Œæ¯”å¦‚ï¼Œéœ€è¦ç›‘æ§ MySQL æ•°æ®åº“å„é¡¹æ€§èƒ½æŒ‡æ ‡ã€ç›´æ¥æ“ä½œ MySQL æ•°æ®åº“ç³»ç»Ÿæ–‡ä»¶ç­‰ï¼Œå¯ä»¥ç”± DBA é€šè¿‡ SQL è¯­å¥ï¼ŒæŸ¥çœ‹å…¶å®ƒçš„ç³»ç»Ÿæ•°æ®åº“ã€‚</p><p>2ã€åˆ›å»ºè‡ªå·±çš„æ•°æ®åº“</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">create database æ•°æ®åº“å;<br><br>#åˆ›å»ºatguigudbæ•°æ®åº“ï¼Œè¯¥åç§°ä¸èƒ½ä¸å·²ç»å­˜åœ¨çš„æ•°æ®åº“é‡åã€‚<br>create database atguigudb;<br></code></pre></td></tr></table></figure><p>3ã€ä½¿ç”¨è‡ªå·±çš„æ•°æ®åº“</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">use æ•°æ®åº“å;<br><br>#ä½¿ç”¨atguigudbæ•°æ®åº“<br>use atguigudb;<br></code></pre></td></tr></table></figure><p>è¯´æ˜ï¼šå¦‚æœæ²¡æœ‰ä½¿ç”¨useè¯­å¥ï¼Œåé¢é’ˆå¯¹æ•°æ®åº“çš„æ“ä½œä¹Ÿæ²¡æœ‰åŠ â€œæ•°æ®åâ€çš„é™å®šï¼Œé‚£ä¹ˆä¼šæŠ¥â€œERROR 1046 (3D000): No database selectedâ€ï¼ˆæ²¡æœ‰é€‰æ‹©æ•°æ®åº“ï¼‰</p><p>ä½¿ç”¨å®Œuseè¯­å¥ä¹‹åï¼Œå¦‚æœæ¥ä¸‹æ¥çš„SQLéƒ½æ˜¯é’ˆå¯¹ä¸€ä¸ªæ•°æ®åº“æ“ä½œçš„ï¼Œé‚£å°±ä¸ç”¨é‡å¤useäº†ï¼Œå¦‚æœè¦é’ˆå¯¹å¦ä¸€ä¸ªæ•°æ®åº“æ“ä½œï¼Œé‚£ä¹ˆè¦é‡æ–°useã€‚</p><p>4ã€æŸ¥çœ‹æŸä¸ªåº“çš„æ‰€æœ‰è¡¨æ ¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">show tables;  #è¦æ±‚å‰é¢æœ‰useè¯­å¥<br><br>show tables from æ•°æ®åº“å;<br></code></pre></td></tr></table></figure><p>5ã€åˆ›å»ºæ–°çš„è¡¨æ ¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">create table è¡¨åç§°(<br>å­—æ®µå  æ•°æ®ç±»å‹,<br>å­—æ®µå æ•°æ®ç±»å‹<br>);<br></code></pre></td></tr></table></figure><p>è¯´æ˜ï¼šå¦‚æœæ˜¯æœ€åä¸€ä¸ªå­—æ®µï¼Œåé¢å°±ç”¨åŠ é€—å·ï¼Œå› ä¸ºé€—å·çš„ä½œç”¨æ˜¯åˆ†å‰²æ¯ä¸ªå­—æ®µã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#åˆ›å»ºå­¦ç”Ÿè¡¨<br>create table student(<br>id int,<br>    name varchar(20)  #è¯´åå­—æœ€é•¿ä¸è¶…è¿‡20ä¸ªå­—ç¬¦<br>);<br></code></pre></td></tr></table></figure><p>6ã€æŸ¥çœ‹ä¸€ä¸ªè¡¨çš„æ•°æ®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">select * from æ•°æ®åº“è¡¨åç§°;<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#æŸ¥çœ‹å­¦ç”Ÿè¡¨çš„æ•°æ®<br>select * from student;<br></code></pre></td></tr></table></figure><p>7ã€æ·»åŠ ä¸€æ¡è®°å½•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">insert into è¡¨åç§° values(å€¼åˆ—è¡¨);<br><br>#æ·»åŠ ä¸¤æ¡è®°å½•åˆ°studentè¡¨ä¸­<br>insert into student values(1,&#x27;å¼ ä¸‰&#x27;);<br>insert into student values(2,&#x27;æå››&#x27;);<br></code></pre></td></tr></table></figure><p>æŠ¥é”™ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; insert into student values(1,&#x27;å¼ ä¸‰&#x27;);<br>ERROR 1366 (HY000): Incorrect string value: &#x27;\xD5\xC5\xC8\xFD&#x27; for column &#x27;name&#x27; at row 1<br>mysql&gt; insert into student values(2,&#x27;æå››&#x27;);<br>ERROR 1366 (HY000): Incorrect string value: &#x27;\xC0\xEE\xCB\xC4&#x27; for column &#x27;name&#x27; at row 1<br>mysql&gt; show create table student;<br></code></pre></td></tr></table></figure><p>å­—ç¬¦é›†çš„é—®é¢˜ã€‚</p><p>8ã€æŸ¥çœ‹è¡¨çš„åˆ›å»ºä¿¡æ¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">show create table è¡¨åç§°;<br><br><br>#æŸ¥çœ‹studentè¡¨çš„è¯¦ç»†åˆ›å»ºä¿¡æ¯<br>show create table student;<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#ç»“æœå¦‚ä¸‹<br>*************************** 1. row ***************************<br>       Table: student<br>Create Table: CREATE TABLE `student` (<br>  `id` int(11) DEFAULT NULL,<br>  `name` varchar(20) DEFAULT NULL<br>) ENGINE=InnoDB DEFAULT CHARSET=latin1<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>ä¸Šé¢çš„ç»“æœæ˜¾ç¤ºstudentçš„è¡¨æ ¼çš„é»˜è®¤å­—ç¬¦é›†æ˜¯â€œlatin1â€ä¸æ”¯æŒä¸­æ–‡ã€‚</p><p>9ã€æŸ¥çœ‹æ•°æ®åº“çš„åˆ›å»ºä¿¡æ¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">show create database æ•°æ®åº“å;<br><br>#æŸ¥çœ‹atguigudbæ•°æ®åº“çš„è¯¦ç»†åˆ›å»ºä¿¡æ¯<br>show create database atguigudb;<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#ç»“æœå¦‚ä¸‹<br>*************************** 1. row ***************************<br>       Database: atguigudb<br>Create Database: CREATE DATABASE `atguigudb` /*!40100 DEFAULT CHARACTER SET latin1 */<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>ä¸Šé¢çš„ç»“æœæ˜¾ç¤ºatguigudbæ•°æ®åº“ä¹Ÿä¸æ”¯æŒä¸­æ–‡ï¼Œå­—ç¬¦é›†é»˜è®¤æ˜¯latin1ã€‚</p><p>10ã€åˆ é™¤è¡¨æ ¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">drop table è¡¨åç§°;<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#åˆ é™¤å­¦ç”Ÿè¡¨<br>drop table student;<br></code></pre></td></tr></table></figure><p>11ã€åˆ é™¤æ•°æ®åº“</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">drop database æ•°æ®åº“å;<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#åˆ é™¤atguigudbæ•°æ®åº“<br>drop database atguigudb;<br></code></pre></td></tr></table></figure><h3 id="4-2-MySQLçš„ç¼–ç è®¾ç½®"><a href="#4-2-MySQLçš„ç¼–ç è®¾ç½®" class="headerlink" title="4.2 MySQLçš„ç¼–ç è®¾ç½®"></a>4.2 MySQLçš„ç¼–ç è®¾ç½®</h3><h4 id="MySQL5-7ä¸­"><a href="#MySQL5-7ä¸­" class="headerlink" title="MySQL5.7ä¸­"></a>MySQL5.7ä¸­</h4><p><strong>é—®é¢˜å†ç°ï¼šå‘½ä»¤è¡Œæ“ä½œsqlä¹±ç é—®é¢˜</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; INSERT INTO t_stu VALUES(1,&#x27;å¼ ä¸‰&#x27;,&#x27;ç”·&#x27;);<br>ERROR 1366 (HY000): Incorrect string value: &#x27;\xD5\xC5\xC8\xFD&#x27; for column &#x27;sname&#x27; at row 1<br></code></pre></td></tr></table></figure><p><strong>é—®é¢˜è§£å†³</strong></p><p>æ­¥éª¤1ï¼šæŸ¥çœ‹ç¼–ç å‘½ä»¤</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs gams">show <span class="hljs-keyword">variables</span> like <span class="hljs-comment">&#x27;character_%&#x27;</span>;<br>show <span class="hljs-keyword">variables</span> like <span class="hljs-comment">&#x27;collation_%&#x27;</span>;<br></code></pre></td></tr></table></figure><p>æ­¥éª¤2ï¼šä¿®æ”¹mysqlçš„æ•°æ®ç›®å½•ä¸‹çš„my.inié…ç½®æ–‡ä»¶</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[mysql]</span>  <span class="hljs-comment">#å¤§æ¦‚åœ¨63è¡Œå·¦å³ï¼Œåœ¨å…¶ä¸‹æ·»åŠ </span><br>... <br><span class="hljs-attr">default-character-set</span>=utf8  <span class="hljs-comment">#é»˜è®¤å­—ç¬¦é›†</span><br><br><span class="hljs-section">[mysqld]</span>  <span class="hljs-comment"># å¤§æ¦‚åœ¨76è¡Œå·¦å³ï¼Œåœ¨å…¶ä¸‹æ·»åŠ </span><br>...<br><span class="hljs-attr">character-set-server</span>=utf8<br><span class="hljs-attr">collation-server</span>=utf8_general_ci<br></code></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼šå»ºè®®ä¿®æ”¹é…ç½®æ–‡ä»¶ä½¿ç”¨notepad++ç­‰é«˜çº§æ–‡æœ¬ç¼–è¾‘å™¨ï¼Œä½¿ç”¨è®°äº‹æœ¬ç­‰è½¯ä»¶æ‰“å¼€ä¿®æ”¹åå¯èƒ½ä¼šå¯¼è‡´æ–‡ä»¶ç¼–ç ä¿®æ”¹ä¸ºâ€œå«BOMå¤´â€çš„ç¼–ç ï¼Œä»è€ŒæœåŠ¡é‡å¯å¤±è´¥ã€‚</p></blockquote><p>æ­¥éª¤3ï¼šé‡å¯æœåŠ¡</p><p>æ­¥éª¤4ï¼šæŸ¥çœ‹ç¼–ç å‘½ä»¤</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">show</span> variables <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;character_%&#x27;</span>;<br><span class="hljs-keyword">show</span> variables <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;collation_%&#x27;</span>;<br></code></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/MySQL%E7%BC%96%E7%A0%811.jpg" style="zoom:90%;" /><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/MySQL%E7%BC%96%E7%A0%812.jpg" style="zoom:90%;" /><ul><li>å¦‚æœæ˜¯ä»¥ä¸Šé…ç½®å°±è¯´æ˜å¯¹äº†ã€‚æ¥ç€æˆ‘ä»¬å°±å¯ä»¥æ–°åˆ›å»ºæ•°æ®åº“ã€æ–°åˆ›å»ºæ•°æ®è¡¨ï¼Œæ¥ç€æ·»åŠ åŒ…å«ä¸­æ–‡çš„æ•°æ®äº†ã€‚</li></ul><h4 id="MySQL8-0ä¸­"><a href="#MySQL8-0ä¸­" class="headerlink" title="MySQL8.0ä¸­"></a>MySQL8.0ä¸­</h4><p>åœ¨MySQL 8.0ç‰ˆæœ¬ä¹‹å‰ï¼Œé»˜è®¤å­—ç¬¦é›†ä¸ºlatin1ï¼Œutf8å­—ç¬¦é›†æŒ‡å‘çš„æ˜¯utf8mb3(æ¯ä¸‰ä¸ªå­—èŠ‚å¯¹åº”ä¸€ä¸ªå­—ç¬¦ï¼‰ã€‚ç½‘ç«™å¼€å‘äººå‘˜åœ¨æ•°æ®åº“è®¾è®¡çš„æ—¶å€™å¾€å¾€ä¼šå°†ç¼–ç ä¿®æ”¹ä¸ºutf8å­—ç¬¦é›†ã€‚å¦‚æœé—å¿˜ä¿®æ”¹é»˜è®¤çš„ç¼–ç ï¼Œå°±ä¼šå‡ºç°ä¹±ç çš„é—®é¢˜ã€‚ä»MySQL 8.0å¼€å§‹ï¼Œæ•°æ®åº“çš„é»˜è®¤ç¼–ç æ”¹ä¸º<code>utf8mb4</code>ï¼ˆæ¯å››ä¸ªå­—èŠ‚å¯¹åº”ä¸€ä¸ªå­—ç¬¦ï¼‰ï¼Œä»è€Œé¿å…äº†ä¸Šè¿°çš„ä¹±ç é—®é¢˜ã€‚</p><h2 id="5-MySQLå›¾å½¢åŒ–ç®¡ç†å·¥å…·"><a href="#5-MySQLå›¾å½¢åŒ–ç®¡ç†å·¥å…·" class="headerlink" title="5. MySQLå›¾å½¢åŒ–ç®¡ç†å·¥å…·"></a>5. MySQLå›¾å½¢åŒ–ç®¡ç†å·¥å…·</h2><p>MySQLå›¾å½¢åŒ–ç®¡ç†å·¥å…·æå¤§åœ°æ–¹ä¾¿äº†æ•°æ®åº“çš„æ“ä½œä¸ç®¡ç†ï¼Œå¸¸ç”¨çš„å›¾å½¢åŒ–ç®¡ç†å·¥å…·æœ‰ï¼šMySQL Workbenchã€phpMyAdminã€Navicat Preminumã€MySQLDumperã€SQLyogã€dbeaverã€MySQL ODBC Connectorã€‚</p><h3 id="å·¥å…·1-MySQL-Workbench"><a href="#å·¥å…·1-MySQL-Workbench" class="headerlink" title="å·¥å…·1. MySQL Workbench"></a>å·¥å…·1. MySQL Workbench</h3><p>MySQLå®˜æ–¹æä¾›çš„å›¾å½¢åŒ–ç®¡ç†å·¥å…·MySQL Workbenchå®Œå…¨æ”¯æŒMySQL 5.0ä»¥ä¸Šçš„ç‰ˆæœ¬ã€‚MySQL Workbenchåˆ†ä¸ºç¤¾åŒºç‰ˆå’Œå•†ä¸šç‰ˆï¼Œç¤¾åŒºç‰ˆå®Œå…¨å…è´¹ï¼Œè€Œå•†ä¸šç‰ˆåˆ™æ˜¯æŒ‰å¹´æ”¶è´¹ã€‚</p><p>MySQL Workbench ä¸ºæ•°æ®åº“ç®¡ç†å‘˜ã€ç¨‹åºå¼€å‘è€…å’Œç³»ç»Ÿè§„åˆ’å¸ˆæä¾›å¯è§†åŒ–è®¾è®¡ã€æ¨¡å‹å»ºç«‹ã€ä»¥åŠæ•°æ®åº“ç®¡ç†åŠŸèƒ½ã€‚å®ƒåŒ…å«äº†ç”¨äºåˆ›å»ºå¤æ‚çš„æ•°æ®å»ºæ¨¡ERæ¨¡å‹ï¼Œæ­£å‘å’Œé€†å‘æ•°æ®åº“å·¥ç¨‹ï¼Œä¹Ÿå¯ä»¥ç”¨äºæ‰§è¡Œé€šå¸¸éœ€è¦èŠ±è´¹å¤§é‡æ—¶é—´çš„ã€éš¾ä»¥å˜æ›´å’Œç®¡ç†çš„æ–‡æ¡£ä»»åŠ¡ã€‚</p><p>ä¸‹è½½åœ°å€ï¼š<a href="http://dev.mysql.com/downloads/workbench/%E3%80%82">http://dev.mysql.com/downloads/workbench/ã€‚</a></p><p>ä½¿ç”¨ï¼š</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬ç‚¹å‡» Windows å·¦ä¸‹è§’çš„â€œå¼€å§‹â€æŒ‰é’®ï¼Œå¦‚æœä½ æ˜¯ Win10 ç³»ç»Ÿï¼Œå¯ä»¥ç›´æ¥çœ‹åˆ°æ‰€æœ‰ç¨‹åºã€‚æ¥ç€ï¼Œæ‰¾åˆ°â€œMySQLâ€ï¼Œç‚¹å¼€ï¼Œæ‰¾åˆ°â€œMySQL Workbench 8.0 CEâ€ã€‚ç‚¹å‡»æ‰“å¼€ Workbenchï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211007153522427.png"></p><p>å·¦ä¸‹è§’æœ‰ä¸ªæœ¬åœ°è¿æ¥ï¼Œç‚¹å‡»ï¼Œå½•å…¥ Root çš„å¯†ç ï¼Œç™»å½•æœ¬åœ° MySQL æ•°æ®åº“æœåŠ¡å™¨ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211014195108502.png" alt="" style="zoom:80%;" /><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211014195129219.png" alt="" style="zoom:80%;" /><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211014195142849.png" alt="" style="zoom:80%;" /><p>è¿™æ˜¯ä¸€ä¸ªå›¾å½¢åŒ–çš„ç•Œé¢ï¼Œæˆ‘æ¥ç»™ä½ ä»‹ç»ä¸‹è¿™ä¸ªç•Œé¢ã€‚ </p><ul><li><p>ä¸Šæ–¹æ˜¯èœå•ã€‚å·¦ä¸Šæ–¹æ˜¯å¯¼èˆªæ ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° MySQL æ•°æ®åº“æœåŠ¡å™¨é‡Œé¢çš„æ•°æ® åº“ï¼ŒåŒ…æ‹¬æ•°æ®è¡¨ã€è§†å›¾ã€å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°ï¼›å·¦ä¸‹æ–¹æ˜¯ä¿¡æ¯æ ï¼Œå¯ä»¥æ˜¾ç¤ºä¸Šæ–¹é€‰ä¸­çš„æ•°æ® åº“ã€æ•°æ®è¡¨ç­‰å¯¹è±¡çš„ä¿¡æ¯ã€‚ </p></li><li><p>ä¸­é—´ä¸Šæ–¹æ˜¯å·¥ä½œåŒºï¼Œä½ å¯ä»¥åœ¨è¿™é‡Œå†™ SQL è¯­å¥ï¼Œç‚¹å‡»ä¸Šæ–¹èœå•æ å·¦è¾¹çš„ç¬¬ä¸‰ä¸ªè¿è¡ŒæŒ‰ é’®ï¼Œå°±å¯ä»¥æ‰§è¡Œå·¥ä½œåŒºçš„ SQL è¯­å¥äº†ã€‚ </p></li><li><p>ä¸­é—´ä¸‹æ–¹æ˜¯è¾“å‡ºåŒºï¼Œç”¨æ¥æ˜¾ç¤º SQL è¯­å¥çš„è¿è¡Œæƒ…å†µï¼ŒåŒ…æ‹¬ä»€ä¹ˆæ—¶é—´å¼€å§‹è¿è¡Œçš„ã€è¿è¡Œçš„ å†…å®¹ã€è¿è¡Œçš„è¾“å‡ºï¼Œä»¥åŠæ‰€èŠ±è´¹çš„æ—¶é•¿ç­‰ä¿¡æ¯ã€‚</p></li></ul><p>å¥½äº†ï¼Œä¸‹é¢æˆ‘ä»¬å°±ç”¨ Workbench å®é™…åˆ›å»ºä¸€ä¸ªæ•°æ®åº“ï¼Œå¹¶ä¸”å¯¼å…¥ä¸€ä¸ª Excel æ•°æ®æ–‡ä»¶ï¼Œ æ¥ç”Ÿæˆä¸€ä¸ªæ•°æ®è¡¨ã€‚æ•°æ®è¡¨æ˜¯å­˜å‚¨æ•°æ®çš„è½½ä½“ï¼Œæœ‰äº†æ•°æ®è¡¨ä»¥åï¼Œæˆ‘ä»¬å°±èƒ½å¯¹æ•°æ®è¿›è¡Œæ“ä½œäº†ã€‚ </p><h3 id="å·¥å…·2-Navicat"><a href="#å·¥å…·2-Navicat" class="headerlink" title="å·¥å…·2. Navicat"></a>å·¥å…·2. Navicat</h3><p>Navicat MySQLæ˜¯ä¸€ä¸ªå¼ºå¤§çš„MySQLæ•°æ®åº“æœåŠ¡å™¨ç®¡ç†å’Œå¼€å‘å·¥å…·ã€‚å®ƒå¯ä»¥ä¸ä»»ä½•3.21æˆ–ä»¥ä¸Šç‰ˆæœ¬çš„MySQLä¸€èµ·å·¥ä½œï¼Œæ”¯æŒè§¦å‘å™¨ã€å­˜å‚¨è¿‡ç¨‹ã€å‡½æ•°ã€äº‹ä»¶ã€è§†å›¾ã€ç®¡ç†ç”¨æˆ·ç­‰ï¼Œå¯¹äºæ–°æ‰‹æ¥è¯´æ˜“å­¦æ˜“ç”¨ã€‚å…¶ç²¾å¿ƒè®¾è®¡çš„å›¾å½¢ç”¨æˆ·ç•Œé¢ï¼ˆGUIï¼‰å¯ä»¥è®©ç”¨æˆ·ç”¨ä¸€ç§å®‰å…¨ç®€ä¾¿çš„æ–¹å¼æ¥å¿«é€Ÿæ–¹ä¾¿åœ°åˆ›å»ºã€ç»„ç»‡ã€è®¿é—®å’Œå…±äº«ä¿¡æ¯ã€‚Navicatæ”¯æŒä¸­æ–‡ï¼Œæœ‰å…è´¹ç‰ˆæœ¬æä¾›ã€‚<br>ä¸‹è½½åœ°å€ï¼š<a href="http://www.navicat.com/%E3%80%82">http://www.navicat.com/ã€‚</a></p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1557378069584.png" style="zoom:80%;" /><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20210913180359685.png" alt="" style="zoom:80%;" /><h3 id="å·¥å…·3-SQLyog"><a href="#å·¥å…·3-SQLyog" class="headerlink" title="å·¥å…·3. SQLyog"></a>å·¥å…·3. SQLyog</h3><p>SQLyog æ˜¯ä¸šç•Œè‘—åçš„ Webyog å…¬å¸å‡ºå“çš„ä¸€æ¬¾ç®€æ´é«˜æ•ˆã€åŠŸèƒ½å¼ºå¤§çš„å›¾å½¢åŒ– MySQL æ•°æ®åº“ç®¡ç†å·¥å…·ã€‚è¿™æ¬¾å·¥å…·æ˜¯ä½¿ç”¨C++è¯­è¨€å¼€å‘çš„ã€‚è¯¥å·¥å…·å¯ä»¥æ–¹ä¾¿åœ°åˆ›å»ºæ•°æ®åº“ã€è¡¨ã€è§†å›¾å’Œç´¢å¼•ç­‰ï¼Œè¿˜å¯ä»¥æ–¹ä¾¿åœ°è¿›è¡Œæ’å…¥ã€æ›´æ–°å’Œåˆ é™¤ç­‰æ“ä½œï¼ŒåŒæ—¶å¯ä»¥æ–¹ä¾¿åœ°è¿›è¡Œæ•°æ®åº“ã€æ•°æ®è¡¨çš„å¤‡ä»½å’Œè¿˜åŸã€‚è¯¥å·¥å…·ä¸ä»…å¯ä»¥é€šè¿‡SQLæ–‡ä»¶è¿›è¡Œå¤§é‡æ–‡ä»¶çš„å¯¼å…¥å’Œå¯¼å‡ºï¼Œè¿˜å¯ä»¥å¯¼å…¥å’Œå¯¼å‡ºXMLã€HTMLå’ŒCSVç­‰å¤šç§æ ¼å¼çš„æ•°æ®ã€‚<br>ä¸‹è½½åœ°å€ï¼š<a href="http://www.webyog.com/%EF%BC%8C%E8%AF%BB%E8%80%85%E4%B9%9F%E5%8F%AF%E4%BB%A5%E6%90%9C%E7%B4%A2%E4%B8%AD%E6%96%87%E7%89%88%E7%9A%84%E4%B8%8B%E8%BD%BD%E5%9C%B0%E5%9D%80%E3%80%82">http://www.webyog.com/ï¼Œè¯»è€…ä¹Ÿå¯ä»¥æœç´¢ä¸­æ–‡ç‰ˆçš„ä¸‹è½½åœ°å€ã€‚</a></p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211014213018979.png" alt="" style="zoom:80%;" /><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211014213036470.png" alt="" style="zoom:80%;" /><h3 id="å·¥å…·4ï¼šdbeaver"><a href="#å·¥å…·4ï¼šdbeaver" class="headerlink" title="å·¥å…·4ï¼šdbeaver"></a>å·¥å…·4ï¼šdbeaver</h3><p>DBeaveræ˜¯ä¸€ä¸ªé€šç”¨çš„æ•°æ®åº“ç®¡ç†å·¥å…·å’Œ SQL å®¢æˆ·ç«¯ï¼Œæ”¯æŒæ‰€æœ‰æµè¡Œçš„æ•°æ®åº“ï¼šMySQLã€PostgreSQLã€SQLiteã€Oracleã€DB2ã€SQL Serverã€ Sybaseã€MS Accessã€Teradataã€ Firebirdã€Apache Hiveã€Phoenixã€Prestoç­‰ã€‚DBeaveræ¯”å¤§å¤šæ•°çš„SQLç®¡ç†å·¥å…·è¦è½»é‡ï¼Œè€Œä¸”æ”¯æŒä¸­æ–‡ç•Œé¢ã€‚DBeaverç¤¾åŒºç‰ˆä½œä¸ºä¸€ä¸ªå…è´¹å¼€æºçš„äº§å“ï¼Œå’Œå…¶ä»–ç±»ä¼¼çš„è½¯ä»¶ç›¸æ¯”ï¼Œåœ¨åŠŸèƒ½å’Œæ˜“ç”¨æ€§ä¸Šéƒ½æ¯«ä¸é€Šè‰²ã€‚</p><p>å”¯ä¸€éœ€è¦æ³¨æ„æ˜¯ DBeaver æ˜¯ç”¨Javaç¼–ç¨‹è¯­è¨€å¼€å‘çš„ï¼Œæ‰€ä»¥éœ€è¦æ‹¥æœ‰ JDKï¼ˆJava Development ToolKitï¼‰ç¯å¢ƒã€‚å¦‚æœç”µè„‘ä¸Šæ²¡æœ‰JDKï¼Œåœ¨é€‰æ‹©å®‰è£…DBeaverç»„ä»¶æ—¶ï¼Œå‹¾é€‰â€œInclude Javaâ€å³å¯ã€‚</p><p>ä¸‹è½½åœ°å€ï¼š<a href="https://dbeaver.io/download/">https://dbeaver.io/download/</a></p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211014195237457.png" alt="" style="zoom:80%;" /><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211014195251371.png" alt="" style="zoom:75%;" /><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211014195300510.png" alt="" style="zoom:80%;" /><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211014195309805.png" alt="" style="zoom:70%;" /><h3 id="å¯èƒ½å‡ºç°è¿æ¥é—®é¢˜ï¼š"><a href="#å¯èƒ½å‡ºç°è¿æ¥é—®é¢˜ï¼š" class="headerlink" title="å¯èƒ½å‡ºç°è¿æ¥é—®é¢˜ï¼š"></a>å¯èƒ½å‡ºç°è¿æ¥é—®é¢˜ï¼š</h3><p>æœ‰äº›å›¾å½¢ç•Œé¢å·¥å…·ï¼Œç‰¹åˆ«æ˜¯æ—§ç‰ˆæœ¬çš„å›¾å½¢ç•Œé¢å·¥å…·ï¼Œåœ¨è¿æ¥MySQL8æ—¶å‡ºç°â€œAuthentication plugin â€˜caching_sha2_passwordâ€™ cannot be loadedâ€é”™è¯¯ã€‚</p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211019215249254.png" alt="" style="zoom:80%;" /><p>å‡ºç°è¿™ä¸ªåŸå› æ˜¯MySQL8ä¹‹å‰çš„ç‰ˆæœ¬ä¸­åŠ å¯†è§„åˆ™æ˜¯mysql_native_passwordï¼Œè€Œåœ¨MySQL8ä¹‹åï¼ŒåŠ å¯†è§„åˆ™æ˜¯caching_sha2_passwordã€‚è§£å†³é—®é¢˜æ–¹æ³•æœ‰ä¸¤ç§ï¼Œç¬¬ä¸€ç§æ˜¯å‡çº§å›¾å½¢ç•Œé¢å·¥å…·ç‰ˆæœ¬ï¼Œç¬¬äºŒç§æ˜¯æŠŠMySQL8ç”¨æˆ·ç™»å½•å¯†ç åŠ å¯†è§„åˆ™è¿˜åŸæˆmysql_native_passwordã€‚</p><p>ç¬¬äºŒç§è§£å†³æ–¹æ¡ˆå¦‚ä¸‹ï¼Œç”¨å‘½ä»¤è¡Œç™»å½•MySQLæ•°æ®åº“ä¹‹åï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ä¿®æ”¹ç”¨æˆ·å¯†ç åŠ å¯†è§„åˆ™å¹¶æ›´æ–°ç”¨æˆ·å¯†ç ï¼Œè¿™é‡Œä¿®æ”¹ç”¨æˆ·åä¸ºâ€œroot@localhostâ€çš„ç”¨æˆ·å¯†ç è§„åˆ™ä¸ºâ€œmysql_native_passwordâ€ï¼Œå¯†ç å€¼ä¸ºâ€œ123456â€ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#ä½¿ç”¨mysqlæ•°æ®åº“<br>USE mysql; <br><br>#ä¿®æ”¹&#x27;root&#x27;@&#x27;localhost&#x27;ç”¨æˆ·çš„å¯†ç è§„åˆ™å’Œå¯†ç <br>ALTER USER &#x27;root&#x27;@&#x27;localhost&#x27; IDENTIFIED WITH mysql_native_password BY &#x27;abc123&#x27;; <br><br>#åˆ·æ–°æƒé™<br>FLUSH PRIVILEGES;<br></code></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211019215408965.png" alt="" style="zoom:80%;" /><h2 id="6-MySQLç›®å½•ç»“æ„ä¸æºç "><a href="#6-MySQLç›®å½•ç»“æ„ä¸æºç " class="headerlink" title="6. MySQLç›®å½•ç»“æ„ä¸æºç "></a>6. MySQLç›®å½•ç»“æ„ä¸æºç </h2><h3 id="6-1-ä¸»è¦ç›®å½•ç»“æ„"><a href="#6-1-ä¸»è¦ç›®å½•ç»“æ„" class="headerlink" title="6.1 ä¸»è¦ç›®å½•ç»“æ„"></a>6.1 ä¸»è¦ç›®å½•ç»“æ„</h3><table><thead><tr><th>MySQLçš„ç›®å½•ç»“æ„</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>binç›®å½•</td><td>æ‰€æœ‰MySQLçš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚å¦‚ï¼šmysql.exe</td></tr><tr><td>MySQLInstanceConfig.exe</td><td>æ•°æ®åº“çš„é…ç½®å‘å¯¼ï¼Œåœ¨å®‰è£…æ—¶å‡ºç°çš„å†…å®¹</td></tr><tr><td>dataç›®å½•</td><td>ç³»ç»Ÿæ•°æ®åº“æ‰€åœ¨çš„ç›®å½•</td></tr><tr><td>my.iniæ–‡ä»¶</td><td>MySQLçš„ä¸»è¦é…ç½®æ–‡ä»¶</td></tr><tr><td>c:\ProgramData\MySQL\MySQL Server 8.0\data\</td><td>ç”¨æˆ·åˆ›å»ºçš„æ•°æ®åº“æ‰€åœ¨çš„ç›®å½•</td></tr></tbody></table><h3 id="6-2-MySQL-æºä»£ç è·å–"><a href="#6-2-MySQL-æºä»£ç è·å–" class="headerlink" title="6.2 MySQL æºä»£ç è·å–"></a>6.2 MySQL æºä»£ç è·å–</h3><p>é¦–å…ˆï¼Œä½ è¦è¿›å…¥ MySQLä¸‹è½½ç•Œé¢ã€‚ è¿™é‡Œä½ ä¸è¦é€‰æ‹©ç”¨é»˜è®¤çš„â€œMicrosoft Windowsâ€ï¼Œè€Œæ˜¯è¦é€šè¿‡ä¸‹æ‹‰æ ï¼Œæ‰¾åˆ°â€œSource Codeâ€ï¼Œåœ¨ä¸‹é¢çš„æ“ä½œç³»ç»Ÿç‰ˆæœ¬é‡Œé¢ï¼Œ é€‰æ‹© Windowsï¼ˆArchitecture Independentï¼‰ï¼Œç„¶åç‚¹å‡»ä¸‹è½½ã€‚ </p><p>æ¥ä¸‹æ¥ï¼ŒæŠŠä¸‹è½½ä¸‹æ¥çš„å‹ç¼©æ–‡ä»¶è§£å‹ï¼Œæˆ‘ä»¬å°±å¾—åˆ°äº† MySQL çš„æºä»£ç ã€‚</p><p>MySQL æ˜¯ç”¨ C++ å¼€å‘è€Œæˆçš„ï¼Œæˆ‘ç®€å•ä»‹ç»ä¸€ä¸‹æºä»£ç çš„ç»„æˆã€‚ </p><p>mysql-8.0.22 ç›®å½•ä¸‹çš„å„ä¸ªå­ç›®å½•ï¼ŒåŒ…å«äº† MySQL å„éƒ¨åˆ†ç»„ä»¶çš„æºä»£ç ï¼š </p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211007154113052.png"></p><ul><li><p>sql å­ç›®å½•æ˜¯ MySQL æ ¸å¿ƒä»£ç ï¼›</p></li><li><p>libmysql å­ç›®å½•æ˜¯å®¢æˆ·ç«¯ç¨‹åº APIï¼›</p></li><li><p>mysql-test å­ç›®å½•æ˜¯æµ‹è¯•å·¥å…·ï¼›</p></li><li><p>mysys å­ç›®å½•æ˜¯æ“ä½œç³»ç»Ÿç›¸å…³å‡½æ•°å’Œè¾…åŠ©å‡½æ•°ï¼›</p></li></ul><p>æºä»£ç å¯ä»¥ç”¨è®°äº‹æœ¬æ‰“å¼€æŸ¥çœ‹ï¼Œå¦‚æœä½ æœ‰ C++ çš„å¼€å‘ç¯å¢ƒï¼Œä¹Ÿå¯ä»¥åœ¨å¼€å‘ç¯å¢ƒä¸­æ‰“å¼€æŸ¥çœ‹ã€‚ </p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211007154213156.png"></p><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæºä»£ç å¹¶ä¸ç¥ç§˜ï¼Œå°±æ˜¯æ™®é€šçš„ C++ ä»£ç ï¼Œè·Ÿä½ ç†Ÿæ‚‰çš„ä¸€æ ·ï¼Œè€Œä¸”æœ‰å¾ˆå¤šæ³¨é‡Šï¼Œå¯ä»¥å¸®åŠ©ä½ ç†è§£ã€‚é˜…è¯»æºä»£ç å°±åƒåœ¨è·Ÿ MySQL çš„å¼€å‘äººå‘˜å¯¹è¯ä¸€æ ·ï¼Œååˆ†æœ‰è¶£ã€‚</p><h2 id="7-å¸¸è§é—®é¢˜çš„è§£å†³-è¯¾å¤–å†…å®¹"><a href="#7-å¸¸è§é—®é¢˜çš„è§£å†³-è¯¾å¤–å†…å®¹" class="headerlink" title="7. å¸¸è§é—®é¢˜çš„è§£å†³(è¯¾å¤–å†…å®¹)"></a>7. å¸¸è§é—®é¢˜çš„è§£å†³(è¯¾å¤–å†…å®¹)</h2><h3 id="é—®é¢˜1ï¼šrootç”¨æˆ·å¯†ç å¿˜è®°ï¼Œé‡ç½®çš„æ“ä½œ"><a href="#é—®é¢˜1ï¼šrootç”¨æˆ·å¯†ç å¿˜è®°ï¼Œé‡ç½®çš„æ“ä½œ" class="headerlink" title="é—®é¢˜1ï¼šrootç”¨æˆ·å¯†ç å¿˜è®°ï¼Œé‡ç½®çš„æ“ä½œ"></a>é—®é¢˜1ï¼šrootç”¨æˆ·å¯†ç å¿˜è®°ï¼Œé‡ç½®çš„æ“ä½œ</h3><p>1: é€šè¿‡ä»»åŠ¡ç®¡ç†å™¨æˆ–è€…æœåŠ¡ç®¡ç†ï¼Œå…³æ‰mysqld(æœåŠ¡è¿›ç¨‹)<br>2: é€šè¿‡å‘½ä»¤è¡Œ+ç‰¹æ®Šå‚æ•°å¼€å¯mysqld<br>mysqld â€“defaults-file=â€D:\ProgramFiles\mysql\MySQLServer5.7Data\my.iniâ€ â€“skip-grant-tables</p><p>3: æ­¤æ—¶ï¼ŒmysqldæœåŠ¡è¿›ç¨‹å·²ç»æ‰“å¼€ã€‚å¹¶ä¸”ä¸éœ€è¦æƒé™æ£€æŸ¥<br>4: mysql -uroot æ— å¯†ç ç™»é™†æœåŠ¡å™¨ã€‚å¦å¯åŠ¨ä¸€ä¸ªå®¢æˆ·ç«¯è¿›è¡Œ<br>5: ä¿®æ”¹æƒé™è¡¨<br>ï¼ˆ1ï¼‰ use mysql;<br>ï¼ˆ2ï¼‰update user set authentication_string=password(â€˜æ–°å¯†ç â€™) where user=â€™rootâ€™ and Host=â€™localhostâ€™;<br>ï¼ˆ3ï¼‰flush privileges;<br>6: é€šè¿‡ä»»åŠ¡ç®¡ç†å™¨ï¼Œå…³æ‰mysqldæœåŠ¡è¿›ç¨‹ã€‚<br>7: å†æ¬¡é€šè¿‡æœåŠ¡ç®¡ç†ï¼Œæ‰“å¼€mysqlæœåŠ¡ã€‚<br>8: å³å¯ç”¨ä¿®æ”¹åçš„æ–°å¯†ç ç™»é™†ã€‚</p><h3 id="é—®é¢˜2ï¼šmysqlå‘½ä»¤æŠ¥â€œä¸æ˜¯å†…éƒ¨æˆ–å¤–éƒ¨å‘½ä»¤â€"><a href="#é—®é¢˜2ï¼šmysqlå‘½ä»¤æŠ¥â€œä¸æ˜¯å†…éƒ¨æˆ–å¤–éƒ¨å‘½ä»¤â€" class="headerlink" title="é—®é¢˜2ï¼šmysqlå‘½ä»¤æŠ¥â€œä¸æ˜¯å†…éƒ¨æˆ–å¤–éƒ¨å‘½ä»¤â€"></a>é—®é¢˜2ï¼šmysqlå‘½ä»¤æŠ¥â€œä¸æ˜¯å†…éƒ¨æˆ–å¤–éƒ¨å‘½ä»¤â€</h3><p>å¦‚æœè¾“å…¥mysqlå‘½ä»¤æŠ¥â€œä¸æ˜¯å†…éƒ¨æˆ–å¤–éƒ¨å‘½ä»¤â€ï¼ŒæŠŠmysqlå®‰è£…ç›®å½•çš„binç›®å½•é…ç½®åˆ°ç¯å¢ƒå˜é‡pathä¸­ã€‚å¦‚ä¸‹ï¼š</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20210914093150145.png"></p><h3 id="é—®é¢˜3ï¼šé”™è¯¯ERROR-ï¼šæ²¡æœ‰é€‰æ‹©æ•°æ®åº“å°±æ“ä½œè¡¨æ ¼å’Œæ•°æ®"><a href="#é—®é¢˜3ï¼šé”™è¯¯ERROR-ï¼šæ²¡æœ‰é€‰æ‹©æ•°æ®åº“å°±æ“ä½œè¡¨æ ¼å’Œæ•°æ®" class="headerlink" title="é—®é¢˜3ï¼šé”™è¯¯ERROR ï¼šæ²¡æœ‰é€‰æ‹©æ•°æ®åº“å°±æ“ä½œè¡¨æ ¼å’Œæ•°æ®"></a>é—®é¢˜3ï¼šé”™è¯¯ERROR ï¼šæ²¡æœ‰é€‰æ‹©æ•°æ®åº“å°±æ“ä½œè¡¨æ ¼å’Œæ•°æ®</h3><table><thead><tr><th>ERROR 1046 (3D000): No database selected</th></tr></thead><tbody><tr><td>è§£å†³æ–¹æ¡ˆä¸€ï¼šå°±æ˜¯ä½¿ç”¨â€œUSE æ•°æ®åº“å;â€è¯­å¥ï¼Œè¿™æ ·æ¥ä¸‹æ¥çš„è¯­å¥å°±é»˜è®¤é’ˆå¯¹è¿™ä¸ªæ•°æ®åº“è¿›è¡Œæ“ä½œ</td></tr><tr><td>è§£å†³æ–¹æ¡ˆäºŒï¼šå°±æ˜¯æ‰€æœ‰çš„è¡¨å¯¹è±¡å‰é¢éƒ½åŠ ä¸Šâ€œæ•°æ®åº“.â€</td></tr></tbody></table><h3 id="é—®é¢˜4ï¼šå‘½ä»¤è¡Œå®¢æˆ·ç«¯çš„å­—ç¬¦é›†é—®é¢˜"><a href="#é—®é¢˜4ï¼šå‘½ä»¤è¡Œå®¢æˆ·ç«¯çš„å­—ç¬¦é›†é—®é¢˜" class="headerlink" title="é—®é¢˜4ï¼šå‘½ä»¤è¡Œå®¢æˆ·ç«¯çš„å­—ç¬¦é›†é—®é¢˜"></a>é—®é¢˜4ï¼šå‘½ä»¤è¡Œå®¢æˆ·ç«¯çš„å­—ç¬¦é›†é—®é¢˜</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; INSERT INTO t_stu VALUES(1,&#x27;å¼ ä¸‰&#x27;,&#x27;ç”·&#x27;);<br>ERROR 1366 (HY000): Incorrect string value: &#x27;\xD5\xC5\xC8\xFD&#x27; for column &#x27;sname&#x27; at row 1<br></code></pre></td></tr></table></figure><p>åŸå› ï¼šæœåŠ¡å™¨ç«¯è®¤ä¸ºä½ çš„å®¢æˆ·ç«¯çš„å­—ç¬¦é›†æ˜¯utf-8ï¼Œè€Œå®é™…ä¸Šä½ çš„å®¢æˆ·ç«¯çš„å­—ç¬¦é›†æ˜¯GBKã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554912924219.png"></p><p>æŸ¥çœ‹æ‰€æœ‰å­—ç¬¦é›†ï¼š<strong>SHOW VARIABLES LIKE â€˜character_set_%â€™;</strong></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554912943186.png"></p><p>è§£å†³æ–¹æ¡ˆï¼Œè®¾ç½®å½“å‰è¿æ¥çš„å®¢æˆ·ç«¯å­—ç¬¦é›† <strong>â€œSET NAMES GBK;â€</strong></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554912957353.png"></p><h3 id="é—®é¢˜5ï¼šä¿®æ”¹æ•°æ®åº“å’Œè¡¨çš„å­—ç¬¦ç¼–ç "><a href="#é—®é¢˜5ï¼šä¿®æ”¹æ•°æ®åº“å’Œè¡¨çš„å­—ç¬¦ç¼–ç " class="headerlink" title="é—®é¢˜5ï¼šä¿®æ”¹æ•°æ®åº“å’Œè¡¨çš„å­—ç¬¦ç¼–ç "></a>é—®é¢˜5ï¼šä¿®æ”¹æ•°æ®åº“å’Œè¡¨çš„å­—ç¬¦ç¼–ç </h3><p>ä¿®æ”¹ç¼–ç ï¼š</p><p>ï¼ˆ1)å…ˆåœæ­¢æœåŠ¡ï¼Œï¼ˆ2ï¼‰ä¿®æ”¹my.iniæ–‡ä»¶ï¼ˆ3ï¼‰é‡æ–°å¯åŠ¨æœåŠ¡</p><p>è¯´æ˜ï¼š</p><p>å¦‚æœæ˜¯åœ¨ä¿®æ”¹my.iniä¹‹å‰å»ºçš„åº“å’Œè¡¨ï¼Œé‚£ä¹ˆåº“å’Œè¡¨çš„ç¼–ç è¿˜æ˜¯åŸæ¥çš„Latin1ï¼Œè¦ä¹ˆåˆ äº†é‡å»ºï¼Œè¦ä¹ˆä½¿ç”¨alterè¯­å¥ä¿®æ”¹ç¼–ç ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; create database 0728db charset Latin1;<br>Query OK, 1 row affected (0.00 sec)<br></code></pre></td></tr></table></figure><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs abnf">mysql&gt; use <span class="hljs-number">0728</span>db<span class="hljs-comment">;</span><br>Database changed<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; create table student (id int , name varchar(20)) charset Latin1;<br>Query OK, 0 rows affected (0.02 sec)<br><br><br>mysql&gt; show create table student\G<br>*************************** 1. row ***************************<br>       Table: student<br>Create Table: CREATE TABLE `student` (<br>  `id` int(11) NOT NULL,<br>  `name` varchar(20) DEFAULT NULL,<br>  PRIMARY KEY (`id`)<br>) ENGINE=InnoDB DEFAULT CHARSET=latin1<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; alter table student charset utf8; #ä¿®æ”¹è¡¨å­—ç¬¦ç¼–ç ä¸ºUTF8<br>Query OK, 0 rows affected (0.01 sec)<br>Records: 0  Duplicates: 0  Warnings: 0<br><br><br>mysql&gt; show create table student\G<br>*************************** 1. row ***************************<br>       Table: student<br>Create Table: CREATE TABLE `student` (<br>  `id` int(11) NOT NULL,<br>  `name` varchar(20) CHARACTER SET latin1 DEFAULT NULL,  #å­—æ®µä»ç„¶æ˜¯latin1ç¼–ç <br>  PRIMARY KEY (`id`)<br>) ENGINE=InnoDB DEFAULT CHARSET=utf8<br>1 row in set (0.00 sec)<br><br><br>mysql&gt; alter table student modify name varchar(20) charset utf8; #ä¿®æ”¹å­—æ®µå­—ç¬¦ç¼–ç ä¸ºUTF8<br>Query OK, 0 rows affected (0.05 sec)<br>Records: 0  Duplicates: 0  Warnings: 0<br><br><br>mysql&gt; show create table student\G<br>*************************** 1. row ***************************<br>       Table: student<br>Create Table: CREATE TABLE `student` (<br>  `id` int(11) NOT NULL,<br>  `name` varchar(20) DEFAULT NULL,<br>  PRIMARY KEY (`id`)<br>) ENGINE=InnoDB DEFAULT CHARSET=utf8<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; show create database 0728db;;<br>+--------+-----------------------------------------------------------------+<br>|Database| Create Database                                                 |<br>+------+-------------------------------------------------------------------+<br>|0728db| CREATE DATABASE `0728db` /*!40100 DEFAULT CHARACTER SET latin1 */ |<br>+------+-------------------------------------------------------------------+<br>1 row in set (0.00 sec)<br><br><br>mysql&gt; alter database 0728db charset utf8; #ä¿®æ”¹æ•°æ®åº“çš„å­—ç¬¦ç¼–ç ä¸ºutf8<br>Query OK, 1 row affected (0.00 sec)<br><br><br>mysql&gt; show create database 0728db;<br>+--------+-----------------------------------------------------------------+<br>|Database| Create Database                                                 |<br>+--------+-----------------------------------------------------------------+<br>| 0728db | CREATE DATABASE `0728db` /*!40100 DEFAULT CHARACTER SET utf8 */ |<br>+--------+-----------------------------------------------------------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><h1 id="ç¬¬03ç« -åŸºæœ¬çš„SELECTè¯­å¥"><a href="#ç¬¬03ç« -åŸºæœ¬çš„SELECTè¯­å¥" class="headerlink" title="ç¬¬03ç« _åŸºæœ¬çš„SELECTè¯­å¥"></a>ç¬¬03ç« _åŸºæœ¬çš„SELECTè¯­å¥</h1><h2 id="1-SQLæ¦‚è¿°"><a href="#1-SQLæ¦‚è¿°" class="headerlink" title="1. SQLæ¦‚è¿°"></a>1. SQLæ¦‚è¿°</h2><h3 id="1-1-SQLèƒŒæ™¯çŸ¥è¯†"><a href="#1-1-SQLèƒŒæ™¯çŸ¥è¯†" class="headerlink" title="1.1 SQLèƒŒæ™¯çŸ¥è¯†"></a>1.1 SQLèƒŒæ™¯çŸ¥è¯†</h3><ul><li><p>1946 å¹´ï¼Œä¸–ç•Œä¸Šç¬¬ä¸€å°ç”µè„‘è¯ç”Ÿï¼Œå¦‚ä»Šï¼Œå€Ÿç”±è¿™å°ç”µè„‘å‘å±•èµ·æ¥çš„äº’è”ç½‘å·²ç»è‡ªæˆæ±Ÿæ¹–ã€‚åœ¨è¿™å‡ åå¹´é‡Œï¼Œæ— æ•°çš„æŠ€æœ¯ã€äº§ä¸šåœ¨è¿™ç‰‡æ±Ÿæ¹–é‡Œæ²‰æµ®ï¼Œæœ‰çš„æ–¹å…´æœªè‰¾ï¼Œæœ‰çš„å·²ç»å‡ å¹•å…´è¡°ã€‚ä½†åœ¨è¿™ç‰‡æµ©è¡çš„æ³¢åŠ¨é‡Œï¼Œæœ‰ä¸€é—¨æŠ€æœ¯ä»æœªæ¶ˆå¤±ï¼Œç”šè‡³â€œè€å½“ç›Šå£®â€ï¼Œé‚£å°±æ˜¯ SQLã€‚</p><ul><li>45 å¹´å‰ï¼Œä¹Ÿå°±æ˜¯ 1974 å¹´ï¼ŒIBM ç ”ç©¶å‘˜å‘å¸ƒäº†ä¸€ç¯‡æ­å¼€æ•°æ®åº“æŠ€æœ¯çš„è®ºæ–‡ã€ŠSEQUELï¼šä¸€é—¨ç»“æ„åŒ–çš„è‹±è¯­æŸ¥è¯¢è¯­è¨€ã€‹ï¼Œç›´åˆ°ä»Šå¤©è¿™é—¨ç»“æ„åŒ–çš„æŸ¥è¯¢è¯­è¨€å¹¶æ²¡æœ‰å¤ªå¤§çš„å˜åŒ–ï¼Œç›¸æ¯”äºå…¶ä»–è¯­è¨€ï¼Œ<code>SQL çš„åŠè¡°æœŸå¯ä»¥è¯´æ˜¯éå¸¸é•¿</code>äº†ã€‚</li></ul></li><li><p>ä¸è®ºæ˜¯å‰ç«¯å·¥ç¨‹å¸ˆï¼Œè¿˜æ˜¯åç«¯ç®—æ³•å·¥ç¨‹å¸ˆï¼Œéƒ½ä¸€å®šä¼šå’Œæ•°æ®æ‰“äº¤é“ï¼Œéƒ½éœ€è¦äº†è§£å¦‚ä½•åˆå¿«åˆå‡†ç¡®åœ°æå–è‡ªå·±æƒ³è¦çš„æ•°æ®ã€‚æ›´åˆ«ææ•°æ®åˆ†æå¸ˆäº†ï¼Œä»–ä»¬çš„å·¥ä½œå°±æ˜¯å’Œæ•°æ®æ‰“äº¤é“ï¼Œæ•´ç†ä¸åŒçš„æŠ¥å‘Šï¼Œä»¥ä¾¿æŒ‡å¯¼ä¸šåŠ¡å†³ç­–ã€‚</p></li><li><p>SQLï¼ˆStructured Query Languageï¼Œç»“æ„åŒ–æŸ¥è¯¢è¯­è¨€ï¼‰æ˜¯ä½¿ç”¨å…³ç³»æ¨¡å‹çš„æ•°æ®åº“åº”ç”¨è¯­è¨€ï¼Œ<code>ä¸æ•°æ®ç›´æ¥æ‰“äº¤é“</code>ï¼Œç”±<code>IBM</code>ä¸Šä¸–çºª70å¹´ä»£å¼€å‘å‡ºæ¥ã€‚åç”±ç¾å›½å›½å®¶æ ‡å‡†å±€ï¼ˆANSIï¼‰å¼€å§‹ç€æ‰‹åˆ¶å®šSQLæ ‡å‡†ï¼Œå…ˆåæœ‰<code>SQL-86</code>ï¼Œ<code>SQL-89</code>ï¼Œ<code>SQL-92</code>ï¼Œ<code>SQL-99</code>ç­‰æ ‡å‡†ã€‚</p><ul><li>SQL æœ‰ä¸¤ä¸ªé‡è¦çš„æ ‡å‡†ï¼Œåˆ†åˆ«æ˜¯ SQL92 å’Œ SQL99ï¼Œå®ƒä»¬åˆ†åˆ«ä»£è¡¨äº† 92 å¹´å’Œ 99 å¹´é¢å¸ƒçš„ SQL æ ‡å‡†ï¼Œæˆ‘ä»¬ä»Šå¤©ä½¿ç”¨çš„ SQL è¯­è¨€ä¾ç„¶éµå¾ªè¿™äº›æ ‡å‡†ã€‚</li></ul></li><li><p>ä¸åŒçš„æ•°æ®åº“ç”Ÿäº§å‚å•†éƒ½æ”¯æŒSQLè¯­å¥ï¼Œä½†éƒ½æœ‰ç‰¹æœ‰å†…å®¹ã€‚</p></li></ul><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/SQLisputonghua.jpg" alt="" style="zoom:67%;" /><h3 id="1-2-SQLè¯­è¨€æ’è¡Œæ¦œ"><a href="#1-2-SQLè¯­è¨€æ’è¡Œæ¦œ" class="headerlink" title="1.2 SQLè¯­è¨€æ’è¡Œæ¦œ"></a>1.2 SQLè¯­è¨€æ’è¡Œæ¦œ</h3><p>è‡ªä» SQL åŠ å…¥äº† TIOBE ç¼–ç¨‹è¯­è¨€æ’è¡Œæ¦œï¼Œå°±ä¸€ç›´ä¿æŒåœ¨ Top 10ã€‚</p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211014230114639.png" alt="" style="zoom:80%;" /><h3 id="1-3-SQL-åˆ†ç±»"><a href="#1-3-SQL-åˆ†ç±»" class="headerlink" title="1.3 SQL åˆ†ç±»"></a>1.3 SQL åˆ†ç±»</h3><p>SQLè¯­è¨€åœ¨åŠŸèƒ½ä¸Šä¸»è¦åˆ†ä¸ºå¦‚ä¸‹3å¤§ç±»ï¼š</p><ul><li><p><strong>DDLï¼ˆData Definition Languagesã€æ•°æ®å®šä¹‰è¯­è¨€ï¼‰</strong>ï¼Œè¿™äº›è¯­å¥å®šä¹‰äº†ä¸åŒçš„æ•°æ®åº“ã€è¡¨ã€è§†å›¾ã€ç´¢å¼•ç­‰æ•°æ®åº“å¯¹è±¡ï¼Œè¿˜å¯ä»¥ç”¨æ¥åˆ›å»ºã€åˆ é™¤ã€ä¿®æ”¹æ•°æ®åº“å’Œæ•°æ®è¡¨çš„ç»“æ„ã€‚</p><ul><li>ä¸»è¦çš„è¯­å¥å…³é”®å­—åŒ…æ‹¬<code>CREATE</code>ã€<code>DROP</code>ã€<code>ALTER</code>ã€<code>RENAME</code>ã€<code>TRUNCATE(æ¸…ç©ºè¡¨ï¼Œä½†æ˜¯è¡¨ç»“æ„è¿˜åœ¨)</code>ç­‰ã€‚</li></ul></li><li><p><strong>DMLï¼ˆData Manipulation Languageã€æ•°æ®æ“ä½œè¯­è¨€ï¼‰</strong>ï¼Œç”¨äºæ·»åŠ ã€åˆ é™¤ã€æ›´æ–°å’ŒæŸ¥è¯¢æ•°æ®åº“è®°å½•ï¼Œå¹¶æ£€æŸ¥æ•°æ®å®Œæ•´æ€§ã€‚</p><ul><li>ä¸»è¦çš„è¯­å¥å…³é”®å­—åŒ…æ‹¬<code>INSERT</code>ã€<code>DELETE</code>ã€<code>UPDATE</code>ã€<code>SELECT</code>ç­‰ã€‚</li><li><strong>SELECTæ˜¯SQLè¯­è¨€çš„åŸºç¡€ï¼Œæœ€ä¸ºé‡è¦ã€‚</strong></li></ul></li><li><p><strong>DCLï¼ˆData Control Languageã€æ•°æ®æ§åˆ¶è¯­è¨€ï¼‰</strong>ï¼Œç”¨äºå®šä¹‰æ•°æ®åº“ã€è¡¨ã€å­—æ®µã€ç”¨æˆ·çš„è®¿é—®æƒé™å’Œå®‰å…¨çº§åˆ«ã€‚</p><ul><li>ä¸»è¦çš„è¯­å¥å…³é”®å­—åŒ…æ‹¬<code>GRANT</code>ã€<code>REVOKE</code>ã€<code>COMMIT</code>ã€<code>ROLLBACK</code>ã€<code>SAVE POINT</code>ç­‰ã€‚</li></ul></li></ul><blockquote><p>å› ä¸ºæŸ¥è¯¢è¯­å¥ä½¿ç”¨çš„éå¸¸çš„é¢‘ç¹ï¼Œæ‰€ä»¥å¾ˆå¤šäººæŠŠæŸ¥è¯¢è¯­å¥å•æ‹å‡ºæ¥ä¸€ç±»ï¼šDQLï¼ˆæ•°æ®æŸ¥è¯¢è¯­è¨€ï¼‰ã€‚</p><p>è¿˜æœ‰å•ç‹¬å°†<code>COMMIT</code>ã€<code>ROLLBACK</code> å–å‡ºæ¥ç§°ä¸ºTCL ï¼ˆTransaction Control Languageï¼Œäº‹åŠ¡æ§åˆ¶è¯­è¨€ï¼‰ã€‚</p></blockquote><h2 id="2-SQLè¯­è¨€çš„è§„åˆ™ä¸è§„èŒƒ"><a href="#2-SQLè¯­è¨€çš„è§„åˆ™ä¸è§„èŒƒ" class="headerlink" title="2. SQLè¯­è¨€çš„è§„åˆ™ä¸è§„èŒƒ"></a>2. SQLè¯­è¨€çš„è§„åˆ™ä¸è§„èŒƒ</h2><h3 id="2-1-åŸºæœ¬è§„åˆ™"><a href="#2-1-åŸºæœ¬è§„åˆ™" class="headerlink" title="2.1 åŸºæœ¬è§„åˆ™"></a>2.1 åŸºæœ¬è§„åˆ™</h3><ul><li>SQL å¯ä»¥å†™åœ¨ä¸€è¡Œæˆ–è€…å¤šè¡Œã€‚ä¸ºäº†æé«˜å¯è¯»æ€§ï¼Œå„å­å¥åˆ†è¡Œå†™ï¼Œå¿…è¦æ—¶ä½¿ç”¨ç¼©è¿›</li><li>æ¯æ¡å‘½ä»¤ä»¥ ; æˆ– \g æˆ– \G ç»“æŸï¼ˆ<strong>\g çš„ä½œç”¨æ˜¯åˆ†å·å’Œåœ¨sqlè¯­å¥ä¸­å†™â€™;â€™æ˜¯ç­‰æ•ˆçš„ï¼›\G çš„ä½œç”¨æ˜¯å°†æŸ¥åˆ°çš„ç»“æ„æ—‹è½¬90åº¦å˜æˆçºµå‘</strong>ï¼‰</li><li>å…³é”®å­—ä¸èƒ½è¢«ç¼©å†™ä¹Ÿä¸èƒ½åˆ†è¡Œ</li><li>å…³äºæ ‡ç‚¹ç¬¦å·<ul><li>å¿…é¡»ä¿è¯æ‰€æœ‰çš„()ã€å•å¼•å·ã€åŒå¼•å·æ˜¯æˆå¯¹ç»“æŸçš„</li><li>å¿…é¡»ä½¿ç”¨è‹±æ–‡çŠ¶æ€ä¸‹çš„åŠè§’è¾“å…¥æ–¹å¼</li><li>å­—ç¬¦ä¸²å‹å’Œæ—¥æœŸæ—¶é—´ç±»å‹çš„æ•°æ®å¯ä»¥ä½¿ç”¨å•å¼•å·ï¼ˆâ€™ â€˜ï¼‰è¡¨ç¤º</li><li>åˆ—çš„åˆ«åï¼Œå°½é‡ä¸è¦ä½¿ç”¨åŒå¼•å·ï¼ˆâ€ â€œï¼‰ï¼ˆå› ä¸ºä½¿ç”¨åŒå¼•å·çš„åˆ«ååœ¨mysqlçš„orderbyä¸­ä¼šå‡ºé”™ï¼‰ï¼Œè€Œä¸”ä¸å»ºè®®çœç•¥as</li></ul></li></ul><h3 id="2-2-SQLå¤§å°å†™è§„èŒƒ-ï¼ˆå»ºè®®éµå®ˆï¼‰"><a href="#2-2-SQLå¤§å°å†™è§„èŒƒ-ï¼ˆå»ºè®®éµå®ˆï¼‰" class="headerlink" title="2.2 SQLå¤§å°å†™è§„èŒƒ ï¼ˆå»ºè®®éµå®ˆï¼‰"></a>2.2 SQLå¤§å°å†™è§„èŒƒ ï¼ˆå»ºè®®éµå®ˆï¼‰</h3><ul><li><strong>MySQL åœ¨ Windows ç¯å¢ƒä¸‹æ˜¯å¤§å°å†™ä¸æ•æ„Ÿçš„</strong></li><li><strong>MySQL åœ¨ Linux ç¯å¢ƒä¸‹æ˜¯å¤§å°å†™æ•æ„Ÿçš„</strong><ul><li>æ•°æ®åº“åã€è¡¨åã€è¡¨çš„åˆ«åã€å˜é‡åæ˜¯ä¸¥æ ¼åŒºåˆ†å¤§å°å†™çš„</li><li>å…³é”®å­—ã€å‡½æ•°åã€åˆ—å(æˆ–å­—æ®µå)ã€åˆ—çš„åˆ«å(å­—æ®µçš„åˆ«å) æ˜¯å¿½ç•¥å¤§å°å†™çš„ã€‚</li></ul></li><li><strong>æ¨èé‡‡ç”¨ç»Ÿä¸€çš„ä¹¦å†™è§„èŒƒï¼š</strong><ul><li>æ•°æ®åº“åã€è¡¨åã€è¡¨åˆ«åã€å­—æ®µåã€å­—æ®µåˆ«åç­‰éƒ½å°å†™</li><li>SQL å…³é”®å­—ã€å‡½æ•°åã€ç»‘å®šå˜é‡ç­‰éƒ½å¤§å†™</li></ul></li></ul><h3 id="2-3-æ³¨-é‡Š"><a href="#2-3-æ³¨-é‡Š" class="headerlink" title="2.3 æ³¨ é‡Š"></a>2.3 æ³¨ é‡Š</h3><p>å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ ¼å¼çš„æ³¨é‡Šç»“æ„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">å•è¡Œæ³¨é‡Šï¼š#æ³¨é‡Šæ–‡å­—(MySQLç‰¹æœ‰çš„æ–¹å¼)<br>å•è¡Œæ³¨é‡Šï¼š-- æ³¨é‡Šæ–‡å­—(--åé¢å¿…é¡»åŒ…å«ä¸€ä¸ªç©ºæ ¼ã€‚)<br>å¤šè¡Œæ³¨é‡Šï¼š/* æ³¨é‡Šæ–‡å­—  */<br></code></pre></td></tr></table></figure><h3 id="2-4-å‘½åè§„åˆ™ï¼ˆæš‚æ—¶äº†è§£ï¼‰"><a href="#2-4-å‘½åè§„åˆ™ï¼ˆæš‚æ—¶äº†è§£ï¼‰" class="headerlink" title="2.4 å‘½åè§„åˆ™ï¼ˆæš‚æ—¶äº†è§£ï¼‰"></a>2.4 å‘½åè§„åˆ™ï¼ˆæš‚æ—¶äº†è§£ï¼‰</h3><ul><li>æ•°æ®åº“ã€è¡¨åä¸å¾—è¶…è¿‡30ä¸ªå­—ç¬¦ï¼Œå˜é‡åé™åˆ¶ä¸º29ä¸ª</li><li>å¿…é¡»åªèƒ½åŒ…å« Aâ€“Z, aâ€“z, 0â€“9, _å…±63ä¸ªå­—ç¬¦</li><li>æ•°æ®åº“åã€è¡¨åã€å­—æ®µåç­‰å¯¹è±¡åä¸­é—´ä¸è¦åŒ…å«ç©ºæ ¼</li><li>åŒä¸€ä¸ªMySQLè½¯ä»¶ä¸­ï¼Œæ•°æ®åº“ä¸èƒ½åŒåï¼›åŒä¸€ä¸ªåº“ä¸­ï¼Œè¡¨ä¸èƒ½é‡åï¼›åŒä¸€ä¸ªè¡¨ä¸­ï¼Œå­—æ®µä¸èƒ½é‡å</li><li>å¿…é¡»ä¿è¯ä½ çš„å­—æ®µæ²¡æœ‰å’Œä¿ç•™å­—ã€æ•°æ®åº“ç³»ç»Ÿæˆ–å¸¸ç”¨æ–¹æ³•å†²çªã€‚å¦‚æœåšæŒä½¿ç”¨ï¼Œè¯·åœ¨SQLè¯­å¥ä¸­ä½¿ç”¨`ï¼ˆç€é‡å·ï¼‰å¼•èµ·æ¥</li><li>ä¿æŒå­—æ®µåå’Œç±»å‹çš„ä¸€è‡´æ€§ï¼Œåœ¨å‘½åå­—æ®µå¹¶ä¸ºå…¶æŒ‡å®šæ•°æ®ç±»å‹çš„æ—¶å€™ä¸€å®šè¦ä¿è¯ä¸€è‡´æ€§ã€‚å‡å¦‚æ•°æ®ç±»å‹åœ¨ä¸€ä¸ªè¡¨é‡Œæ˜¯æ•´æ•°ï¼Œé‚£åœ¨å¦ä¸€ä¸ªè¡¨é‡Œå¯å°±åˆ«å˜æˆå­—ç¬¦å‹äº†</li></ul><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#ä»¥ä¸‹ä¸¤å¥æ˜¯ä¸€æ ·çš„ï¼Œä¸åŒºåˆ†å¤§å°å†™<br>show databases;<br>SHOW DATABASES;<br><br>#åˆ›å»ºè¡¨æ ¼<br>#create table student info(...); #è¡¨åé”™è¯¯ï¼Œå› ä¸ºè¡¨åæœ‰ç©ºæ ¼<br>create table student_info(...); <br><br>#å…¶ä¸­orderä½¿ç”¨``é£˜å·ï¼Œå› ä¸ºorderå’Œç³»ç»Ÿå…³é”®å­—æˆ–ç³»ç»Ÿå‡½æ•°åç­‰é¢„å®šä¹‰æ ‡è¯†ç¬¦é‡åäº†<br>CREATE TABLE `order`(<br>    id INT,<br>    lname VARCHAR(20)<br>);<br><br>select id as &quot;ç¼–å·&quot;, `name` as &quot;å§“å&quot; from t_stu; #èµ·åˆ«åæ—¶ï¼Œaséƒ½å¯ä»¥çœç•¥<br>select id as ç¼–å·, `name` as å§“å from t_stu; #å¦‚æœå­—æ®µåˆ«åä¸­æ²¡æœ‰ç©ºæ ¼ï¼Œé‚£ä¹ˆå¯ä»¥çœç•¥&quot;&quot;<br>select id as ç¼– å·, `name` as å§“ å from t_stu; #é”™è¯¯ï¼Œå¦‚æœå­—æ®µåˆ«åä¸­æœ‰ç©ºæ ¼ï¼Œé‚£ä¹ˆä¸èƒ½çœç•¥&quot;&quot;<br></code></pre></td></tr></table></figure><h3 id="2-5-æ•°æ®å¯¼å…¥æŒ‡ä»¤"><a href="#2-5-æ•°æ®å¯¼å…¥æŒ‡ä»¤" class="headerlink" title="2.5 æ•°æ®å¯¼å…¥æŒ‡ä»¤"></a>2.5 æ•°æ®å¯¼å…¥æŒ‡ä»¤</h3><p>åœ¨å‘½ä»¤è¡Œå®¢æˆ·ç«¯ç™»å½•mysqlï¼Œä½¿ç”¨sourceæŒ‡ä»¤å¯¼å…¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; source d:\mysqldb.sql<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; desc employees;<br>+----------------+-------------+------+-----+---------+-------+<br>| Field          | Type        | Null | Key | Default | Extra |<br>+----------------+-------------+------+-----+---------+-------+<br>| employee_id    | int(6)      | NO   | PRI | 0       |       |<br>| first_name     | varchar(20) | YES  |     | NULL    |       |<br>| last_name      | varchar(25) | NO   |     | NULL    |       |<br>| email          | varchar(25) | NO   | UNI | NULL    |       |<br>| phone_number   | varchar(20) | YES  |     | NULL    |       |<br>| hire_date      | date        | NO   |     | NULL    |       |<br>| job_id         | varchar(10) | NO   | MUL | NULL    |       |<br>| salary         | double(8,2) | YES  |     | NULL    |       |<br>| commission_pct | double(2,2) | YES  |     | NULL    |       |<br>| manager_id     | int(6)      | YES  | MUL | NULL    |       |<br>| department_id  | int(4)      | YES  | MUL | NULL    |       |<br>+----------------+-------------+------+-----+---------+-------+<br>11 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><h2 id="3-åŸºæœ¬çš„SELECTè¯­å¥"><a href="#3-åŸºæœ¬çš„SELECTè¯­å¥" class="headerlink" title="3. åŸºæœ¬çš„SELECTè¯­å¥"></a>3. åŸºæœ¬çš„SELECTè¯­å¥</h2><h3 id="3-0-SELECTâ€¦"><a href="#3-0-SELECTâ€¦" class="headerlink" title="3.0 SELECTâ€¦"></a>3.0 SELECTâ€¦</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT 1; #æ²¡æœ‰ä»»ä½•å­å¥<br>SELECT 9/2; #æ²¡æœ‰ä»»ä½•å­å¥<br>SELECCT 1 + 1 FROM DUAL;  #dualä¼ªè¡¨<br></code></pre></td></tr></table></figure><h3 id="3-1-SELECT-â€¦-FROM"><a href="#3-1-SELECT-â€¦-FROM" class="headerlink" title="3.1 SELECT â€¦ FROM"></a>3.1 SELECT â€¦ FROM</h3><ul><li>è¯­æ³•ï¼š</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span>   æ ‡è¯†é€‰æ‹©å“ªäº›åˆ—<br><span class="hljs-keyword">FROM</span>     æ ‡è¯†ä»å“ªä¸ªè¡¨ä¸­é€‰æ‹©<br></code></pre></td></tr></table></figure><ul><li>é€‰æ‹©å…¨éƒ¨åˆ—ï¼š</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span><br><span class="hljs-keyword">FROM</span>   departments;<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554950890895.png"></p><blockquote><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œé™¤ééœ€è¦ä½¿ç”¨è¡¨ä¸­æ‰€æœ‰çš„å­—æ®µæ•°æ®ï¼Œæœ€å¥½ä¸è¦ä½¿ç”¨é€šé…ç¬¦â€˜*â€™ã€‚ä½¿ç”¨é€šé…ç¬¦è™½ç„¶å¯ä»¥èŠ‚çœè¾“å…¥æŸ¥è¯¢è¯­å¥çš„æ—¶é—´ï¼Œä½†æ˜¯è·å–ä¸éœ€è¦çš„åˆ—æ•°æ®é€šå¸¸ä¼šé™ä½æŸ¥è¯¢å’Œæ‰€ä½¿ç”¨çš„åº”ç”¨ç¨‹åºçš„æ•ˆç‡ã€‚é€šé…ç¬¦çš„ä¼˜åŠ¿æ˜¯ï¼Œå½“ä¸çŸ¥é“æ‰€éœ€è¦çš„åˆ—çš„åç§°æ—¶ï¼Œå¯ä»¥é€šè¿‡å®ƒè·å–å®ƒä»¬ã€‚</p><p>åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ï¼Œä¸æ¨èä½ ç›´æ¥ä½¿ç”¨<code>SELECT *</code>è¿›è¡ŒæŸ¥è¯¢ã€‚</p></blockquote><ul><li>é€‰æ‹©ç‰¹å®šçš„åˆ—ï¼š</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> department_id, location_id<br><span class="hljs-keyword">FROM</span>   departments;<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554950947969.png"></p><blockquote><p>MySQLä¸­çš„SQLè¯­å¥æ˜¯ä¸åŒºåˆ†å¤§å°å†™çš„ï¼Œå› æ­¤SELECTå’Œselectçš„ä½œç”¨æ˜¯ç›¸åŒçš„ï¼Œä½†æ˜¯ï¼Œè®¸å¤šå¼€å‘äººå‘˜ä¹ æƒ¯å°†å…³é”®å­—å¤§å†™ã€æ•°æ®åˆ—å’Œè¡¨åå°å†™ï¼Œè¯»è€…ä¹Ÿåº”è¯¥å…»æˆä¸€ä¸ªè‰¯å¥½çš„ç¼–ç¨‹ä¹ æƒ¯ï¼Œè¿™æ ·å†™å‡ºæ¥çš„ä»£ç æ›´å®¹æ˜“é˜…è¯»å’Œç»´æŠ¤ã€‚</p></blockquote><h3 id="3-2-åˆ—çš„åˆ«å-as-alias"><a href="#3-2-åˆ—çš„åˆ«å-as-alias" class="headerlink" title="3.2 åˆ—çš„åˆ«å(as:alias)"></a>3.2 åˆ—çš„åˆ«å(as:alias)</h3><ul><li><p>é‡å‘½åä¸€ä¸ªåˆ—</p></li><li><p>ä¾¿äºè®¡ç®—</p></li><li><p>ç´§è·Ÿåˆ—åï¼Œä¹Ÿå¯ä»¥<strong>åœ¨åˆ—åå’Œåˆ«åä¹‹é—´åŠ å…¥å…³é”®å­—ASï¼Œåˆ«åä½¿ç”¨åŒå¼•å·(ä¸è¦ä½¿ç”¨å•å¼•å·ï¼Œsqlè§„èŒƒæ˜¯å•å¼•å·ï¼‰</strong>ï¼Œä»¥ä¾¿åœ¨åˆ«åä¸­åŒ…å«ç©ºæ ¼æˆ–ç‰¹æ®Šçš„å­—ç¬¦å¹¶åŒºåˆ†å¤§å°å†™ã€‚</p></li><li><p>AS å¯ä»¥çœç•¥ã€‘</p></li><li><p><strong>ååˆ†éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒMySQLå¯¹äºâ€œâ€çš„å¤„ç†ä¼šä½¿å¾—ä½¿ç”¨åˆ—çš„åˆ«åçš„æ’åºå¤±æ•ˆï¼Œæ‰€ä»¥èµ·åˆ«åæ—¶å°½é‡ä¸è¦ä½¿ç”¨å•å¼•å·æˆ–è€…åŒå¼•å·ã€‚è¿™ç§æƒ…å†µçš„å‘ç”Ÿåº”è¯¥æ˜¯MySQLå¯¹â€œâ€çš„å¤„ç†é—®é¢˜ï¼Œå¤„ç†æ–¹æ³•æ˜¯å¯ä»¥ä¿®æ”¹åˆ«åï¼Œå°½é‡é€‰æ‹©ä¸ä½¿ç”¨â€œâ€æ¥å‘½åï¼Œä¹Ÿå°±æ˜¯å°½é‡åœ¨åˆ«åä¸­ä¸è¦åŒ…å«ç©ºæ ¼ï¼Œä½¿ç”¨ä¸‹åˆ’çº¿_æ¥è¿æ¥å•è¯ï¼Œè¿™æ ·å¯ä»¥ä¸ç”¨å¼•å·ä¿®é¥°åˆ«åï¼Œä»è€Œé¿å…æ‰MySQLå¯¹â€œâ€çš„è§£æå‡ºé”™é—®é¢˜ã€‚</strong></p></li><li><p>å»ºè®®åˆ«åç®€çŸ­ï¼Œè§åçŸ¥æ„</p></li><li><p>ä¸¾ä¾‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT last_name AS name, commission_pct comm<br>FROM   employees;<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554951616598.png"></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554951622467.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT last_name &quot;Name&quot;, salary*12 &quot;Annual Salary&quot;<br>FROM   employees;<br></code></pre></td></tr></table></figure></li></ul><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554951648377.png"></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554951622467-20220325172722675.png"></p><h3 id="3-3-å»é™¤é‡å¤è¡Œ"><a href="#3-3-å»é™¤é‡å¤è¡Œ" class="headerlink" title="3.3 å»é™¤é‡å¤è¡Œ"></a>3.3 å»é™¤é‡å¤è¡Œ</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒæŸ¥è¯¢ä¼šè¿”å›å…¨éƒ¨è¡Œï¼ŒåŒ…æ‹¬é‡å¤è¡Œã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> department_id<br><span class="hljs-keyword">FROM</span>   employees;<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554951711115.png"></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554951622467-20220325172815528.png"></p><p><strong>åœ¨SELECTè¯­å¥ä¸­ä½¿ç”¨å…³é”®å­—DISTINCTå»é™¤é‡å¤è¡Œ</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> department_id<br><span class="hljs-keyword">FROM</span>   employees;<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554951796570.png"></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554951801044.png"></p><p>é’ˆå¯¹äºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT DISTINCT department_id,salary <br>FROM employees;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰ä¸¤ç‚¹éœ€è¦æ³¨æ„ï¼š</p><ol><li>DISTINCT éœ€è¦æ”¾åˆ°æ‰€æœ‰åˆ—åçš„å‰é¢ï¼Œå¦‚æœå†™æˆ<code>SELECT salary, DISTINCT department_id FROM employees</code>ä¼šæŠ¥é”™ã€‚</li><li>DISTINCT å…¶å®æ˜¯å¯¹åé¢æ‰€æœ‰åˆ—åçš„ç»„åˆè¿›è¡Œå»é‡ï¼Œä½ èƒ½çœ‹åˆ°æœ€åçš„ç»“æœæ˜¯ 74 æ¡ï¼Œå› ä¸ºè¿™ 74 ä¸ªéƒ¨é—¨idä¸åŒï¼Œéƒ½æœ‰ salary è¿™ä¸ªå±æ€§å€¼ã€‚å¦‚æœä½ æƒ³è¦çœ‹éƒ½æœ‰å“ªäº›ä¸åŒçš„éƒ¨é—¨ï¼ˆdepartment_idï¼‰ï¼Œåªéœ€è¦å†™<code>DISTINCT department_id</code>å³å¯ï¼Œåé¢ä¸éœ€è¦å†åŠ å…¶ä»–çš„åˆ—åäº†ã€‚</li></ol><h3 id="3-4-ç©ºå€¼å‚ä¸è¿ç®—"><a href="#3-4-ç©ºå€¼å‚ä¸è¿ç®—" class="headerlink" title="3.4 ç©ºå€¼å‚ä¸è¿ç®—"></a>3.4 ç©ºå€¼å‚ä¸è¿ç®—</h3><ul><li>æ‰€æœ‰è¿ç®—ç¬¦æˆ–åˆ—å€¼é‡åˆ°nullå€¼ï¼Œè¿ç®—çš„ç»“æœéƒ½ä¸ºnull</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> employee_id,salary,commission_pct,<br><span class="hljs-number">12</span> <span class="hljs-operator">*</span> salary <span class="hljs-operator">*</span> (<span class="hljs-number">1</span> <span class="hljs-operator">+</span> commission_pct) &quot;annual_sal&quot;<br><span class="hljs-keyword">FROM</span> employees;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œä½ ä¸€å®šè¦æ³¨æ„ï¼Œåœ¨ MySQL é‡Œé¢ï¼Œ ç©ºå€¼ä¸ç­‰äºç©ºå­—ç¬¦ä¸²ï¼ŒåŒæ ·ä¹Ÿä¸ç­‰åŒäº0ï¼ˆç©ºå€¼æ˜¯æœªçŸ¥çš„æ„æ€ï¼‰ã€‚ä¸€ä¸ªç©ºå­—ç¬¦ä¸²çš„é•¿åº¦æ˜¯ 0ï¼Œè€Œä¸€ä¸ªç©ºå€¼çš„é•¿åº¦æ˜¯ç©ºã€‚è€Œä¸”ï¼Œåœ¨ MySQL é‡Œé¢ï¼Œç©ºå€¼æ˜¯å ç”¨ç©ºé—´çš„ã€‚</p><h3 id="3-5-ç€é‡å·"><a href="#3-5-ç€é‡å·" class="headerlink" title="3.5 ç€é‡å·"></a>3.5 ç€é‡å·</h3><ul><li>é”™è¯¯çš„</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT * FROM ORDER;<br>ERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;ORDER&#x27; at line 1<br></code></pre></td></tr></table></figure><ul><li>æ­£ç¡®çš„</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT * FROM `ORDER`;<br>+----------+------------+<br>| order_id | order_name |<br>+----------+------------+<br>|        1 | shkstart   |<br>|        2 | tomcat     |<br>|        3 | dubbo      |<br>+----------+------------+<br>3 rows in set (0.00 sec)<br><br>mysql&gt; SELECT * FROM `order`;<br>+----------+------------+<br>| order_id | order_name |<br>+----------+------------+<br>|        1 | shkstart   |<br>|        2 | tomcat     |<br>|        3 | dubbo      |<br>+----------+------------+<br>3 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><ul><li>ç»“è®º</li></ul><p>æˆ‘ä»¬éœ€è¦ä¿è¯è¡¨ä¸­çš„å­—æ®µã€è¡¨åç­‰æ²¡æœ‰å’Œä¿ç•™å­—ã€æ•°æ®åº“ç³»ç»Ÿæˆ–å¸¸ç”¨æ–¹æ³•å†²çªã€‚å¦‚æœçœŸçš„ç›¸åŒï¼Œè¯·åœ¨SQLè¯­å¥ä¸­ä½¿ç”¨ä¸€å¯¹``ï¼ˆç€é‡å·ï¼‰å¼•èµ·æ¥ã€‚</p><h3 id="3-6-5ã€æŸ¥è¯¢å¸¸æ•°"><a href="#3-6-5ã€æŸ¥è¯¢å¸¸æ•°" class="headerlink" title="3.6 5ã€æŸ¥è¯¢å¸¸æ•°"></a>3.6 5ã€æŸ¥è¯¢å¸¸æ•°</h3><p>SELECT æŸ¥è¯¢è¿˜å¯ä»¥å¯¹å¸¸æ•°è¿›è¡ŒæŸ¥è¯¢ã€‚å¯¹çš„ï¼Œå°±æ˜¯åœ¨ SELECT æŸ¥è¯¢ç»“æœä¸­å¢åŠ ä¸€åˆ—å›ºå®šçš„å¸¸æ•°åˆ—ã€‚è¿™åˆ—çš„å–å€¼æ˜¯æˆ‘ä»¬æŒ‡å®šçš„ï¼Œè€Œä¸æ˜¯ä»æ•°æ®è¡¨ä¸­åŠ¨æ€å–å‡ºçš„ã€‚</p><p>ä½ å¯èƒ½ä¼šé—®ä¸ºä»€ä¹ˆæˆ‘ä»¬è¿˜è¦å¯¹å¸¸æ•°è¿›è¡ŒæŸ¥è¯¢å‘¢ï¼Ÿ</p><p>SQL ä¸­çš„ SELECT è¯­æ³•çš„ç¡®æä¾›äº†è¿™ä¸ªåŠŸèƒ½ï¼Œä¸€èˆ¬æ¥è¯´æˆ‘ä»¬åªä»ä¸€ä¸ªè¡¨ä¸­æŸ¥è¯¢æ•°æ®ï¼Œé€šå¸¸ä¸éœ€è¦å¢åŠ ä¸€ä¸ªå›ºå®šçš„å¸¸æ•°åˆ—ï¼Œä½†å¦‚æœæˆ‘ä»¬æƒ³æ•´åˆä¸åŒçš„æ•°æ®æºï¼Œç”¨å¸¸æ•°åˆ—ä½œä¸ºè¿™ä¸ªè¡¨çš„æ ‡è®°ï¼Œå°±éœ€è¦æŸ¥è¯¢å¸¸æ•°ã€‚</p><p>æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬æƒ³å¯¹ employees æ•°æ®è¡¨ä¸­çš„å‘˜å·¥å§“åè¿›è¡ŒæŸ¥è¯¢ï¼ŒåŒæ—¶å¢åŠ ä¸€åˆ—å­—æ®µ<code>corporation</code>ï¼Œè¿™ä¸ªå­—æ®µå›ºå®šå€¼ä¸ºâ€œå°šç¡…è°·â€ï¼Œå¯ä»¥è¿™æ ·å†™ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT &#x27;å°šç¡…è°·&#x27; as corporation, last_name FROM employees;<br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œå¸¸é‡éœ€è¦ä½¿ç”¨å•å¼•å·å¼•èµ·æ¥ï¼Œå¦åˆ™æœ‰è¯­æ³•é”™è¯¯ã€‚</p><h2 id="4-æ˜¾ç¤ºè¡¨ç»“æ„"><a href="#4-æ˜¾ç¤ºè¡¨ç»“æ„" class="headerlink" title="4. æ˜¾ç¤ºè¡¨ç»“æ„"></a>4. æ˜¾ç¤ºè¡¨ç»“æ„</h2><p>ä½¿ç”¨DESCRIBE æˆ– DESC å‘½ä»¤ï¼Œè¡¨ç¤ºè¡¨ç»“æ„ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DESCRIBE employees;<br>æˆ–<br>DESC employees;<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; desc employees;<br>+----------------+-------------+------+-----+---------+-------+<br>| Field          | Type        | Null | Key | Default | Extra |<br>+----------------+-------------+------+-----+---------+-------+<br>| employee_id    | int(6)      | NO   | PRI | 0       |       |<br>| first_name     | varchar(20) | YES  |     | NULL    |       |<br>| last_name      | varchar(25) | NO   |     | NULL    |       |<br>| email          | varchar(25) | NO   | UNI | NULL    |       |<br>| phone_number   | varchar(20) | YES  |     | NULL    |       |<br>| hire_date      | date        | NO   |     | NULL    |       |<br>| job_id         | varchar(10) | NO   | MUL | NULL    |       |<br>| salary         | double(8,2) | YES  |     | NULL    |       |<br>| commission_pct | double(2,2) | YES  |     | NULL    |       |<br>| manager_id     | int(6)      | YES  | MUL | NULL    |       |<br>| department_id  | int(4)      | YES  | MUL | NULL    |       |<br>+----------------+-------------+------+-----+---------+-------+<br>11 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œå„ä¸ªå­—æ®µçš„å«ä¹‰åˆ†åˆ«è§£é‡Šå¦‚ä¸‹ï¼š</p><ul><li>Fieldï¼šè¡¨ç¤ºå­—æ®µåç§°ã€‚ </li><li>Typeï¼šè¡¨ç¤ºå­—æ®µç±»å‹ï¼Œè¿™é‡Œ barcodeã€goodsname æ˜¯æ–‡æœ¬å‹çš„ï¼Œprice æ˜¯æ•´æ•°ç±»å‹çš„ã€‚</li><li>Nullï¼šè¡¨ç¤ºè¯¥åˆ—æ˜¯å¦å¯ä»¥å­˜å‚¨NULLå€¼ã€‚</li><li>Keyï¼šè¡¨ç¤ºè¯¥åˆ—æ˜¯å¦å·²ç¼–åˆ¶ç´¢å¼•ã€‚PRIè¡¨ç¤ºè¯¥åˆ—æ˜¯è¡¨ä¸»é”®çš„ä¸€éƒ¨åˆ†ï¼›UNIè¡¨ç¤ºè¯¥åˆ—æ˜¯UNIQUEç´¢å¼•çš„ä¸€éƒ¨åˆ†ï¼›MULè¡¨ç¤ºåœ¨åˆ—ä¸­æŸä¸ªç»™å®šå€¼å…è®¸å‡ºç°å¤šæ¬¡ã€‚</li><li>Defaultï¼šè¡¨ç¤ºè¯¥åˆ—æ˜¯å¦æœ‰é»˜è®¤å€¼ï¼Œå¦‚æœæœ‰ï¼Œé‚£ä¹ˆå€¼æ˜¯å¤šå°‘ã€‚</li><li>Extraï¼šè¡¨ç¤ºå¯ä»¥è·å–çš„ä¸ç»™å®šåˆ—æœ‰å…³çš„é™„åŠ ä¿¡æ¯ï¼Œä¾‹å¦‚AUTO_INCREMENTç­‰ã€‚</li></ul><h2 id="5-è¿‡æ»¤æ•°æ®"><a href="#5-è¿‡æ»¤æ•°æ®" class="headerlink" title="5. è¿‡æ»¤æ•°æ®"></a>5. è¿‡æ»¤æ•°æ®</h2><ul><li>èƒŒæ™¯ï¼š</li></ul><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554952199742.png"></p><ul><li><p>è¯­æ³•ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT å­—æ®µ1,å­—æ®µ2<br>FROM è¡¨å<br>WHERE è¿‡æ»¤æ¡ä»¶<br></code></pre></td></tr></table></figure><ul><li>ä½¿ç”¨WHERE å­å¥ï¼Œå°†ä¸æ»¡è¶³æ¡ä»¶çš„è¡Œè¿‡æ»¤æ‰</li><li><strong>WHEREå­å¥ç´§éš FROMå­å¥</strong></li><li>MySQLå¯¹å­—æ®µå€¼å¤§å°å†™ä¸æ•æ„Ÿï¼Œä½†æ˜¯SQLè§„èŒƒè¦æ±‚æ•æ„Ÿï¼Œæ‰€ä»¥å»ºè®®æŸ¥è¯¢æ—¶åŒºåˆ†å¤§å°å†™</li><li>WHEREä¸­ä¸å¯ä»¥ä½¿ç”¨åˆ—çš„åˆ«å</li></ul></li><li><p>ä¸¾ä¾‹</p></li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> employee_id, last_name, job_id, department_id<br><span class="hljs-keyword">FROM</span>   employees<br><span class="hljs-keyword">WHERE</span>  department_id <span class="hljs-operator">=</span> <span class="hljs-number">90</span> ;<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554952277028.png"></p><h3 id="6-SELECTè¯­å¥æ‰§è¡Œé¡ºåº"><a href="#6-SELECTè¯­å¥æ‰§è¡Œé¡ºåº" class="headerlink" title="6.SELECTè¯­å¥æ‰§è¡Œé¡ºåº"></a>6.SELECTè¯­å¥æ‰§è¡Œé¡ºåº</h3><ol><li>FROM</li><li>WHERE</li><li>SELECT</li><li>ORDER BY</li></ol><p>æ‰€ä»¥ï¼ŒWHEREä¸­ä¸å¯ä»¥ä½¿ç”¨åˆ—çš„åˆ«å</p><p>SELECTè¯­å¥æ ¼å¼ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> employee_id, salary<br><span class="hljs-keyword">FROM</span> employees<br><span class="hljs-keyword">WHERE</span> department_id <span class="hljs-keyword">IN</span> (<span class="hljs-number">50</span>, <span class="hljs-number">60</span>, <span class="hljs-number">70</span>)<br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> department_id <span class="hljs-keyword">DESC</span>;<br>LIMIT <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><h1 id="ç¬¬04ç« -è¿ç®—ç¬¦"><a href="#ç¬¬04ç« -è¿ç®—ç¬¦" class="headerlink" title="ç¬¬04ç« _è¿ç®—ç¬¦"></a>ç¬¬04ç« _è¿ç®—ç¬¦</h1><h2 id="1-ç®—æœ¯è¿ç®—ç¬¦"><a href="#1-ç®—æœ¯è¿ç®—ç¬¦" class="headerlink" title="1. ç®—æœ¯è¿ç®—ç¬¦"></a>1. ç®—æœ¯è¿ç®—ç¬¦</h2><p>ç®—æœ¯è¿ç®—ç¬¦ä¸»è¦ç”¨äºæ•°å­¦è¿ç®—ï¼Œå…¶å¯ä»¥è¿æ¥è¿ç®—ç¬¦å‰åçš„ä¸¤ä¸ªæ•°å€¼æˆ–è¡¨è¾¾å¼ï¼Œå¯¹æ•°å€¼æˆ–è¡¨è¾¾å¼è¿›è¡ŒåŠ ï¼ˆ+ï¼‰ã€å‡ï¼ˆ-ï¼‰ã€ä¹˜ï¼ˆ*ï¼‰ã€é™¤ï¼ˆ/ï¼‰å’Œå–æ¨¡ï¼ˆ%ï¼‰è¿ç®—ã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211012100749193.png"></p><p><strong>1ï¼åŠ æ³•ä¸å‡æ³•è¿ç®—ç¬¦</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT 100, 100 + 0, 100 - 0, 100 + 50, 100 + 50 -30, 100 + 35.5, 100 - 35.5 FROM dual;<br>+-----+---------+---------+----------+--------------+------------+------------+<br>| 100 | 100 + 0 | 100 - 0 | 100 + 50 | 100 + 50 -30 | 100 + 35.5 | 100 - 35.5 |<br>+-----+---------+---------+----------+--------------+------------+------------+<br>| 100 |     100 |     100 |      150 |          120 |      135.5 |       64.5 |<br>+-----+---------+---------+----------+--------------+------------+------------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; select 100 + &#x27;1&#x27;<br>     -&gt; from dual;<br>+-----------+<br>| 100 + &#x27;1&#x27; |<br>+-----------+<br>|       101 |<br>+-----------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; select 100 + &#x27;a&#x27;    <br> -&gt; from dual;<br>+-----------+<br>| 100 + &#x27;a&#x27; |<br>+-----------+<br>|       100 |<br>+-----------+<br>1 row in set, 1 warning (0.00 sec)<br><br>mysql&gt; select 100 + null<br>    -&gt; from dual;<br>+------------+<br>| 100 + null |<br>+------------+<br>|       NULL |<br>+------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>ç”±è¿ç®—ç»“æœå¯ä»¥å¾—å‡ºå¦‚ä¸‹ç»“è®ºï¼š</p><blockquote><ul><li>ä¸€ä¸ªæ•´æ•°ç±»å‹çš„å€¼å¯¹æ•´æ•°è¿›è¡ŒåŠ æ³•å’Œå‡æ³•æ“ä½œï¼Œç»“æœè¿˜æ˜¯ä¸€ä¸ªæ•´æ•°ï¼›</li><li>ä¸€ä¸ªæ•´æ•°ç±»å‹çš„å€¼å¯¹æµ®ç‚¹æ•°è¿›è¡ŒåŠ æ³•å’Œå‡æ³•æ“ä½œï¼Œç»“æœæ˜¯ä¸€ä¸ªæµ®ç‚¹æ•°ï¼›</li><li>åŠ æ³•å’Œå‡æ³•çš„ä¼˜å…ˆçº§ç›¸åŒï¼Œè¿›è¡Œå…ˆåŠ åå‡æ“ä½œä¸è¿›è¡Œå…ˆå‡ååŠ æ“ä½œçš„ç»“æœæ˜¯ä¸€æ ·çš„ï¼›</li><li>åœ¨Javaä¸­ï¼Œ+çš„å·¦å³ä¸¤è¾¹å¦‚æœæœ‰å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆè¡¨ç¤ºå­—ç¬¦ä¸²çš„æ‹¼æ¥ã€‚ä½†æ˜¯åœ¨MySQLä¸­+åªè¡¨ç¤ºæ•°å€¼ç›¸åŠ ã€‚å¦‚æœé‡åˆ°éæ•°å€¼ç±»å‹ï¼Œå…ˆå°è¯•è½¬æˆæ•°å€¼ï¼Œå¦‚æœè½¬å¤±è´¥ï¼Œå°±æŒ‰0è®¡ç®—ã€‚ï¼ˆè¡¥å……ï¼šMySQLä¸­å­—ç¬¦ä¸²æ‹¼æ¥è¦ä½¿ç”¨å­—ç¬¦ä¸²å‡½æ•°CONCAT()å®ç°ï¼‰</li></ul></blockquote><p><strong>2ï¼ä¹˜æ³•ä¸é™¤æ³•è¿ç®—ç¬¦</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT 100, 100 * 1, 100 * 1.0, 100 / 1.0, 100 / 2,100 + 2 * 5 / 2,100 /3, 100 DIV 0 FROM dual;<br>+-----+---------+-----------+-----------+---------+-----------------+---------+-----------+<br>| 100 | 100 * 1 | 100 * 1.0 | 100 / 1.0 | 100 / 2 | 100 + 2 * 5 / 2 | 100 /3  | 100 DIV 0 |<br>+-----+---------+-----------+-----------+---------+-----------------+---------+-----------+<br>| 100 |     100 |     100.0 |  100.0000 | 50.0000 |        105.0000 | 33.3333 |      NULL |<br>+-----+---------+-----------+-----------+---------+-----------------+---------+-----------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; SELECT 100 / 3;<br>+---------+<br>| 100 / 3 |<br>+---------+<br>| 33.3333 |<br>+---------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; SELECT 100 DIV 3;<br>+-----------+<br>| 100 DIV 3 |<br>+-----------+<br>|        33 |<br>+-----------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#è®¡ç®—å‡ºå‘˜å·¥çš„å¹´åŸºæœ¬å·¥èµ„<br>SELECT employee_id,salary,salary * 12 annual_sal <br>FROM employees;<br></code></pre></td></tr></table></figure><p>ç”±è¿ç®—ç»“æœå¯ä»¥å¾—å‡ºå¦‚ä¸‹ç»“è®ºï¼š</p><blockquote><ul><li>ä¸€ä¸ªæ•°ä¹˜ä»¥æ•´æ•°1å’Œé™¤ä»¥æ•´æ•°1åä»å¾—åŸæ•°ï¼›</li><li>ä¸€ä¸ªæ•°ä¹˜ä»¥æµ®ç‚¹æ•°1å’Œé™¤ä»¥æµ®ç‚¹æ•°1åå˜æˆæµ®ç‚¹æ•°ï¼Œæ•°å€¼ä¸åŸæ•°ç›¸ç­‰ï¼›</li><li>ä¸€ä¸ªæ•°é™¤ä»¥æ•´æ•°åï¼Œä¸ç®¡æ˜¯å¦èƒ½é™¤å°½ï¼Œç»“æœéƒ½ä¸ºä¸€ä¸ªæµ®ç‚¹æ•°ï¼›</li><li>ä¸€ä¸ªæ•°é™¤ä»¥å¦ä¸€ä¸ªæ•°ï¼Œé™¤ä¸å°½æ—¶ï¼Œç»“æœä¸ºä¸€ä¸ªæµ®ç‚¹æ•°ï¼Œå¹¶ä¿ç•™åˆ°å°æ•°ç‚¹å4ä½ï¼›</li><li>ä¹˜æ³•å’Œé™¤æ³•çš„ä¼˜å…ˆçº§ç›¸åŒï¼Œè¿›è¡Œå…ˆä¹˜åé™¤æ“ä½œä¸å…ˆé™¤åä¹˜æ“ä½œï¼Œå¾—å‡ºçš„ç»“æœç›¸åŒã€‚</li><li>åœ¨æ•°å­¦è¿ç®—ä¸­ï¼Œ0ä¸èƒ½ç”¨ä½œé™¤æ•°ï¼Œåœ¨MySQLä¸­ï¼Œä¸€ä¸ªæ•°é™¤ä»¥0ä¸ºNULLã€‚</li><li>DIVæ˜¯å‘ä¸Šå–æ•´ï¼Œ/æ˜¯ä¿ç•™å°æ•°ç‚¹åå››ä½ã€‚</li></ul></blockquote><p><strong>3ï¼æ±‚æ¨¡ï¼ˆæ±‚ä½™ï¼‰è¿ç®—ç¬¦</strong><br>å°†t22è¡¨ä¸­çš„å­—æ®µiå¯¹3å’Œ5è¿›è¡Œæ±‚æ¨¡ï¼ˆæ±‚ä½™ï¼‰è¿ç®—ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT 12 % 3, 12 MOD 5 FROM dual;<br>+--------+----------+<br>| 12 % 3 | 12 MOD 5 |<br>+--------+----------+<br>|      0 |        2 |<br>+--------+----------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; SELECT 12 % 3, 12 % 5, 12 MOD -5, -12 % 5, -12 % -5;<br>+--------+--------+-----------+---------+----------+<br>| 12 % 3 | 12 % 5 | 12 MOD -5 | -12 % 5 | -12 % -5 |<br>+--------+--------+-----------+---------+----------+<br>|      0 |      2 |         2 |      -2 |       -2 |<br>+--------+--------+-----------+---------+----------+<br>1 row in set (0.00 sec)<br>#å–æ¨¡ç»“æœä¸è¢«æ¨¡æ•°ç¬¦å·ç›¸åŒ<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#ç­›é€‰å‡ºemployee_idæ˜¯å¶æ•°çš„å‘˜å·¥<br>SELECT * <br>FROM employees<br>WHERE employee_id MOD 2 = 0;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œ100å¯¹3æ±‚æ¨¡åçš„ç»“æœä¸º3ï¼Œå¯¹5æ±‚æ¨¡åçš„ç»“æœä¸º0ã€‚</p><h2 id="2-æ¯”è¾ƒè¿ç®—ç¬¦"><a href="#2-æ¯”è¾ƒè¿ç®—ç¬¦" class="headerlink" title="2. æ¯”è¾ƒè¿ç®—ç¬¦"></a>2. æ¯”è¾ƒè¿ç®—ç¬¦</h2><p>æ¯”è¾ƒè¿ç®—ç¬¦ç”¨æ¥å¯¹è¡¨è¾¾å¼å·¦è¾¹çš„æ“ä½œæ•°å’Œå³è¾¹çš„æ“ä½œæ•°è¿›è¡Œæ¯”è¾ƒï¼Œæ¯”è¾ƒçš„ç»“æœä¸ºçœŸåˆ™è¿”å›1ï¼Œæ¯”è¾ƒçš„ç»“æœä¸ºå‡åˆ™è¿”å›0ï¼Œå…¶ä»–æƒ…å†µåˆ™è¿”å›NULLã€‚è¿‡æ»¤åªæ˜¾ç¤ºç»“æœä¸º1çš„ï¼Œç»“æœä¸º0æˆ–è€…NULLï¼ŒWHEREè¿‡æ»¤åä¸æ˜¾ç¤ºã€‚</p><p>æ¯”è¾ƒè¿ç®—ç¬¦ç»å¸¸è¢«ç”¨æ¥ä½œä¸ºSELECTæŸ¥è¯¢è¯­å¥çš„æ¡ä»¶æ¥ä½¿ç”¨ï¼Œè¿”å›ç¬¦åˆæ¡ä»¶çš„ç»“æœè®°å½•ã€‚</p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211012101110021.png" alt="" /><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211012104955094.png"></p><p><strong>1ï¼ç­‰å·è¿ç®—ç¬¦</strong></p><ul><li><p>ç­‰å·è¿ç®—ç¬¦ï¼ˆ=ï¼‰åˆ¤æ–­ç­‰å·ä¸¤è¾¹çš„å€¼ã€å­—ç¬¦ä¸²æˆ–è¡¨è¾¾å¼æ˜¯å¦ç›¸ç­‰ï¼Œå¦‚æœç›¸ç­‰åˆ™è¿”å›1ï¼Œä¸ç›¸ç­‰åˆ™è¿”å›0ã€‚</p></li><li><p>åœ¨ä½¿ç”¨ç­‰å·è¿ç®—ç¬¦æ—¶ï¼Œéµå¾ªå¦‚ä¸‹è§„åˆ™ï¼š</p><ul><li>å¦‚æœç­‰å·ä¸¤è¾¹çš„å€¼ã€å­—ç¬¦ä¸²æˆ–è¡¨è¾¾å¼éƒ½ä¸ºå­—ç¬¦ä¸²ï¼Œåˆ™MySQLä¼šæŒ‰ç…§å­—ç¬¦ä¸²è¿›è¡Œæ¯”è¾ƒï¼Œå…¶æ¯”è¾ƒçš„æ˜¯æ¯ä¸ªå­—ç¬¦ä¸²ä¸­å­—ç¬¦çš„ANSIç¼–ç æ˜¯å¦ç›¸ç­‰ã€‚</li><li>å¦‚æœç­‰å·ä¸¤è¾¹çš„å€¼éƒ½æ˜¯æ•´æ•°ï¼Œåˆ™MySQLä¼šæŒ‰ç…§æ•´æ•°æ¥æ¯”è¾ƒä¸¤ä¸ªå€¼çš„å¤§å°ã€‚</li><li>å¦‚æœç­‰å·ä¸¤è¾¹çš„å€¼ä¸€ä¸ªæ˜¯æ•´æ•°ï¼Œå¦ä¸€ä¸ªæ˜¯å­—ç¬¦ä¸²ï¼Œåˆ™MySQLä¼šå°†å­—ç¬¦ä¸²è½¬åŒ–ä¸ºæ•°å­—è¿›è¡Œæ¯”è¾ƒï¼ˆå¦‚æœå­—ç¬¦ä¸²ä¸èƒ½è½¬åŒ–ä¸ºæ•°å­—ï¼Œé‚£ä¹ˆå°±è½¬åŒ–æˆ0ï¼‰ã€‚</li><li>å¦‚æœç­‰å·ä¸¤è¾¹çš„å€¼ã€å­—ç¬¦ä¸²æˆ–è¡¨è¾¾å¼ä¸­æœ‰ä¸€ä¸ªä¸ºNULLï¼Œåˆ™æ¯”è¾ƒç»“æœä¸ºNULLã€‚</li></ul></li><li><p>å¯¹æ¯”ï¼šSQLä¸­èµ‹å€¼ç¬¦å·ä½¿ç”¨ := </p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT 1 = 1, 1 = &#x27;1&#x27;, 1 = 0, &#x27;a&#x27; = &#x27;a&#x27;, (5 + 3) = (2 + 6), &#x27;&#x27; = NULL , NULL = NULL; <br>+-------+---------+-------+-----------+-------------------+-----------+-------------+<br>| 1 = 1 | 1 = &#x27;1&#x27; | 1 = 0 | &#x27;a&#x27; = &#x27;a&#x27; | (5 + 3) = (2 + 6) | &#x27;&#x27; = NULL | NULL = NULL |<br>+-------+---------+-------+-----------+-------------------+-----------+-------------+<br>|    1  |     1   |   0   |      1    |             1     |    NULL   |        NULL  |<br>+-------+---------+-------+-----------+-------------------+-----------+-------------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; SELECT &#x27;a&#x27; = 1, &#x27;a&#x27; = 0, &#x27;a&#x27; = &#x27;b&#x27;;<br>+---------+---------+-----------+<br>| &#x27;a&#x27; = 1 | &#x27;a&#x27; = 0 | &#x27;a&#x27; = &#x27;b&#x27; |<br>+---------+---------+-----------+<br>|       0 |       1 |         0 |<br>+---------+---------+-----------+<br>1 row in set, 2 warnings (0.00 sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT 1 = 2, 0 = &#x27;abc&#x27;, 1 = &#x27;abc&#x27; FROM dual;<br>+-------+-----------+-----------+<br>| 1 = 2 | 0 = &#x27;abc&#x27; | 1 = &#x27;abc&#x27; |<br>+-------+-----------+-----------+<br>|     0 |         1 |         0 |<br>+-------+-----------+-----------+<br>1 row in set, 2 warnings (0.00 sec)<br><br>mysql&gt; SELECT &#x27;A&#x27; = &#x27;A      &#x27;;<br>+-----------------+<br>| &#x27;A&#x27; = &#x27;A      &#x27; |<br>+-----------------+<br>|               1 |<br>+-----------------+<br>1 row in set (0.00 sec)<br>#å¿½ç•¥å­—ç¬¦ä¸²æœ€åçš„ç©ºæ ¼<br><br>mysql&gt; SELECT &#x27;       A&#x27; = &#x27;A&#x27;;<br>+------------------+<br>| &#x27;       A&#x27; = &#x27;A&#x27; |<br>+------------------+<br>|                0 |<br>+------------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#æŸ¥è¯¢salary=10000ï¼Œæ³¨æ„åœ¨Javaä¸­æ¯”è¾ƒæ˜¯==<br>SELECT employee_id,salary <br>FROM employees <br>WHERE salary = 10000;<br></code></pre></td></tr></table></figure><p><strong>2ï¼å®‰å…¨ç­‰äºè¿ç®—ç¬¦ï¼ˆä¸ºNULLè€Œç”Ÿï¼‰</strong><br>å®‰å…¨ç­‰äºè¿ç®—ç¬¦ï¼ˆ&lt;=&gt;ï¼‰ä¸ç­‰äºè¿ç®—ç¬¦ï¼ˆ=ï¼‰çš„ä½œç”¨æ˜¯ç›¸ä¼¼çš„ï¼Œ<code>å”¯ä¸€çš„åŒºåˆ«</code>æ˜¯â€˜&lt;=&gt;â€™å¯ä»¥ç”¨æ¥å¯¹NULLè¿›è¡Œåˆ¤æ–­ã€‚åœ¨ä¸¤ä¸ªæ“ä½œæ•°å‡ä¸ºNULLæ—¶ï¼Œå…¶è¿”å›å€¼ä¸º1ï¼Œè€Œä¸ä¸ºNULLï¼›å½“ä¸€ä¸ªæ“ä½œæ•°ä¸ºNULLæ—¶ï¼Œå…¶è¿”å›å€¼ä¸º0ï¼Œè€Œä¸ä¸ºNULLã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT 1 &lt;=&gt; &#x27;1&#x27;, 1 &lt;=&gt; 0, &#x27;a&#x27; &lt;=&gt; &#x27;a&#x27;, (5 + 3) &lt;=&gt; (2 + 6), &#x27;&#x27; &lt;=&gt; NULL,NULL &lt;=&gt; NULL FROM dual;<br>+-----------+---------+-------------+---------------------+-------------+---------------+<br>| 1 &lt;=&gt; &#x27;1&#x27; | 1 &lt;=&gt; 0 | &#x27;a&#x27; &lt;=&gt; &#x27;a&#x27; | (5 + 3) &lt;=&gt; (2 + 6) | &#x27;&#x27; &lt;=&gt; NULL | NULL &lt;=&gt; NULL |<br>+-----------+---------+-------------+---------------------+-------------+---------------+<br>|         1 |       0 |           1 |                   1 |           0 |             1 |<br>+-----------+---------+-------------+---------------------+-------------+---------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#æŸ¥è¯¢commission_pctç­‰äº0.40<br>SELECT employee_id,commission_pct <br>FROM employees <br>WHERE commission_pct = 0.40;<br><br>SELECT employee_id,commission_pct <br>FROM employees <br>WHERE commission_pct &lt;=&gt; 0.40;<br><br>#å¦‚æœæŠŠ0.40æ”¹æˆ NULL å‘¢ï¼Ÿ<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œä½¿ç”¨å®‰å…¨ç­‰äºè¿ç®—ç¬¦æ—¶ï¼Œä¸¤è¾¹çš„æ“ä½œæ•°çš„å€¼éƒ½ä¸ºNULLæ—¶ï¼Œè¿”å›çš„ç»“æœä¸º1è€Œä¸æ˜¯NULLï¼Œå…¶ä»–è¿”å›ç»“æœä¸ç­‰äºè¿ç®—ç¬¦ç›¸åŒã€‚</p><p><strong>3ï¼ä¸ç­‰äºè¿ç®—ç¬¦</strong><br>ä¸ç­‰äºè¿ç®—ç¬¦ï¼ˆ&lt;&gt;å’Œ!=ï¼‰ç”¨äºåˆ¤æ–­ä¸¤è¾¹çš„æ•°å­—ã€å­—ç¬¦ä¸²æˆ–è€…è¡¨è¾¾å¼çš„å€¼æ˜¯å¦ä¸ç›¸ç­‰ï¼Œå¦‚æœä¸ç›¸ç­‰åˆ™è¿”å›1ï¼Œç›¸ç­‰åˆ™è¿”å›0ã€‚ä¸ç­‰äºè¿ç®—ç¬¦ä¸èƒ½åˆ¤æ–­NULLå€¼ã€‚å¦‚æœä¸¤è¾¹çš„å€¼æœ‰ä»»æ„ä¸€ä¸ªä¸ºNULLï¼Œæˆ–ä¸¤è¾¹éƒ½ä¸ºNULLï¼Œåˆ™ç»“æœä¸ºNULLã€‚<br>SQLè¯­å¥ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT 1 &lt;&gt; 1, 1 != 2, &#x27;a&#x27; != &#x27;b&#x27;, (3+4) &lt;&gt; (2+6), &#x27;a&#x27; != NULL, NULL &lt;&gt; NULL; <br>+--------+--------+------------+----------------+-------------+--------------+<br>| 1 &lt;&gt; 1 | 1 != 2 | &#x27;a&#x27; != &#x27;b&#x27; | (3+4) &lt;&gt; (2+6) | &#x27;a&#x27; != NULL | NULL &lt;&gt; NULL |<br>+--------+--------+------------+----------------+-------------+--------------+<br>|      0 |   1    |       1    |            1   |     NULL    |         NULL |<br>+--------+--------+------------+----------------+-------------+--------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>æ­¤å¤–ï¼Œè¿˜æœ‰éç¬¦å·  ç±»å‹çš„è¿ç®—ç¬¦ï¼š</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211012105303219.png"></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211012105030527.png"></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211012105052456.png"></p><p><strong>4. ç©ºè¿ç®—ç¬¦</strong><br>ç©ºè¿ç®—ç¬¦ï¼ˆIS NULLæˆ–è€…ISNULLï¼‰åˆ¤æ–­ä¸€ä¸ªå€¼æ˜¯å¦ä¸ºNULLï¼Œå¦‚æœä¸ºNULLåˆ™è¿”å›1ï¼Œå¦åˆ™è¿”å›0ã€‚ISNULLæ›´ç›¸å½“äºä¸€ä¸ªå‡½æ•°ï¼Œéœ€è¦æŠŠå€¼ç”¨ï¼ˆï¼‰åŒ…èµ·æ¥ã€‚<br>SQLè¯­å¥ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT NULL IS NULL, ISNULL(NULL), ISNULL(&#x27;a&#x27;), 1 IS NULL;<br>+--------------+--------------+-------------+-----------+<br>| NULL IS NULL | ISNULL(NULL) | ISNULL(&#x27;a&#x27;) | 1 IS NULL |<br>+--------------+--------------+-------------+-----------+<br>|            1 |            1 |           0 |         0 |<br>+--------------+--------------+-------------+-----------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#æŸ¥è¯¢commission_pctç­‰äºNULLã€‚æ¯”è¾ƒå¦‚ä¸‹çš„ä¸‰ç§å†™æ³•<br>SELECT employee_id,commission_pct FROM employees WHERE commission_pct IS NULL;<br>SELECT employee_id,commission_pct FROM employees WHERE commission_pct &lt;=&gt; NULL;<br>SELECT employee_id,commission_pct FROM employees WHERE ISNULL(commission_pct);<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT last_name, manager_id<br>FROM   employees<br>WHERE  manager_id IS NULL;<br></code></pre></td></tr></table></figure><p><strong>5. éç©ºè¿ç®—ç¬¦</strong><br>éç©ºè¿ç®—ç¬¦ï¼ˆIS NOT NULLï¼‰åˆ¤æ–­ä¸€ä¸ªå€¼æ˜¯å¦ä¸ä¸ºNULLï¼Œå¦‚æœä¸ä¸ºNULLåˆ™è¿”å›1ï¼Œå¦åˆ™è¿”å›0ã€‚<br>SQLè¯­å¥ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT NULL IS NOT NULL, &#x27;a&#x27; IS NOT NULL,  1 IS NOT NULL; <br>+------------------+-----------------+---------------+<br>| NULL IS NOT NULL | &#x27;a&#x27; IS NOT NULL | 1 IS NOT NULL |<br>+------------------+-----------------+---------------+<br>|                0 |               1 |             1 |<br>+------------------+-----------------+---------------+<br>1 row in set (0.01 sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#æŸ¥è¯¢commission_pctä¸ç­‰äºNULL<br>SELECT employee_id,commission_pct FROM employees WHERE commission_pct IS NOT NULL;<br>SELECT employee_id,commission_pct FROM employees WHERE NOT commission_pct &lt;=&gt; NULL;<br>SELECT employee_id,commission_pct FROM employees WHERE NOT ISNULL(commission_pct);<br></code></pre></td></tr></table></figure><p><strong>6. æœ€å°å€¼è¿ç®—ç¬¦</strong><br>è¯­æ³•æ ¼å¼ä¸ºï¼šLEAST(å€¼1ï¼Œå€¼2ï¼Œâ€¦ï¼Œå€¼n)ã€‚å…¶ä¸­ï¼Œâ€œå€¼nâ€è¡¨ç¤ºå‚æ•°åˆ—è¡¨ä¸­æœ‰nä¸ªå€¼ã€‚åœ¨æœ‰ä¸¤ä¸ªæˆ–å¤šä¸ªå‚æ•°çš„æƒ…å†µä¸‹ï¼Œè¿”å›æœ€å°å€¼ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT LEAST (1,0,2), LEAST(&#x27;b&#x27;,&#x27;a&#x27;,&#x27;c&#x27;), LEAST(1,NULL,2);<br>+---------------+--------------------+-----------------+<br>| LEAST (1,0,2) | LEAST(&#x27;b&#x27;,&#x27;a&#x27;,&#x27;c&#x27;) | LEAST(1,NULL,2) |<br>+---------------+--------------------+-----------------+<br>|       0       |        a           |      NULL       |<br>+---------------+--------------------+-----------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>ç”±ç»“æœå¯ä»¥çœ‹åˆ°ï¼Œå½“å‚æ•°æ˜¯æ•´æ•°æˆ–è€…æµ®ç‚¹æ•°æ—¶ï¼ŒLEASTå°†è¿”å›å…¶ä¸­æœ€å°çš„å€¼ï¼›å½“å‚æ•°ä¸ºå­—ç¬¦ä¸²æ—¶ï¼Œè¿”å›å­—æ¯è¡¨ä¸­é¡ºåºæœ€é å‰çš„å­—ç¬¦ï¼›å½“æ¯”è¾ƒå€¼åˆ—è¡¨ä¸­æœ‰NULLæ—¶ï¼Œä¸èƒ½åˆ¤æ–­å¤§å°ï¼Œè¿”å›å€¼ä¸ºNULLã€‚</p><p><strong>7. æœ€å¤§å€¼è¿ç®—ç¬¦</strong><br>è¯­æ³•æ ¼å¼ä¸ºï¼šGREATEST(å€¼1ï¼Œå€¼2ï¼Œâ€¦ï¼Œå€¼n)ã€‚å…¶ä¸­ï¼Œnè¡¨ç¤ºå‚æ•°åˆ—è¡¨ä¸­æœ‰nä¸ªå€¼ã€‚å½“æœ‰ä¸¤ä¸ªæˆ–å¤šä¸ªå‚æ•°æ—¶ï¼Œè¿”å›å€¼ä¸ºæœ€å¤§å€¼ã€‚å‡å¦‚ä»»æ„ä¸€ä¸ªè‡ªå˜é‡ä¸ºNULLï¼Œåˆ™GREATEST()çš„è¿”å›å€¼ä¸ºNULLã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT GREATEST(1,0,2), GREATEST(&#x27;b&#x27;,&#x27;a&#x27;,&#x27;c&#x27;), GREATEST(1,NULL,2);<br>+-----------------+-----------------------+--------------------+<br>| GREATEST(1,0,2) | GREATEST(&#x27;b&#x27;,&#x27;a&#x27;,&#x27;c&#x27;) | GREATEST(1,NULL,2) |<br>+-----------------+-----------------------+--------------------+<br>|               2 | c                     |               NULL |<br>+-----------------+-----------------------+--------------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>ç”±ç»“æœå¯ä»¥çœ‹åˆ°ï¼Œå½“å‚æ•°ä¸­æ˜¯æ•´æ•°æˆ–è€…æµ®ç‚¹æ•°æ—¶ï¼ŒGREATESTå°†è¿”å›å…¶ä¸­æœ€å¤§çš„å€¼ï¼›å½“å‚æ•°ä¸ºå­—ç¬¦ä¸²æ—¶ï¼Œè¿”å›å­—æ¯è¡¨ä¸­é¡ºåºæœ€é åçš„å­—ç¬¦ï¼›å½“æ¯”è¾ƒå€¼åˆ—è¡¨ä¸­æœ‰NULLæ—¶ï¼Œä¸èƒ½åˆ¤æ–­å¤§å°ï¼Œè¿”å›å€¼ä¸ºNULLã€‚</p><p><strong>8. BETWEEN ANDè¿ç®—ç¬¦</strong><br>BETWEENè¿ç®—ç¬¦ä½¿ç”¨çš„æ ¼å¼é€šå¸¸ä¸ºSELECT D FROM TABLE WHERE C BETWEEN A AND Bï¼Œæ­¤æ—¶ï¼Œå½“Cå¤§äºæˆ–ç­‰äºAï¼Œå¹¶ä¸”Cå°äºæˆ–ç­‰äºBæ—¶ï¼Œç»“æœä¸º1ï¼Œå¦åˆ™ç»“æœä¸º0ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT 1 BETWEEN 0 AND 1, 10 BETWEEN 11 AND 12, &#x27;b&#x27; BETWEEN &#x27;a&#x27; AND &#x27;c&#x27;;<br>+-------------------+----------------------+-------------------------+<br>| 1 BETWEEN 0 AND 1 | 10 BETWEEN 11 AND 12 | &#x27;b&#x27; BETWEEN &#x27;a&#x27; AND &#x27;c&#x27; |<br>+-------------------+----------------------+-------------------------+<br>|                 1 |                    0 |                       1 |<br>+-------------------+----------------------+-------------------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT last_name, salary<br>FROM   employees<br>WHERE  salary BETWEEN 2500 AND 3500;<br></code></pre></td></tr></table></figure><p><strong>9. INè¿ç®—ç¬¦</strong><br>INè¿ç®—ç¬¦ç”¨äºåˆ¤æ–­ç»™å®šçš„å€¼æ˜¯å¦æ˜¯INåˆ—è¡¨ä¸­çš„ä¸€ä¸ªå€¼ï¼Œå¦‚æœæ˜¯åˆ™è¿”å›1ï¼Œå¦åˆ™è¿”å›0ã€‚å¦‚æœç»™å®šçš„å€¼ä¸ºNULLï¼Œæˆ–è€…INåˆ—è¡¨ä¸­å­˜åœ¨NULLï¼Œåˆ™ç»“æœä¸ºNULLã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT &#x27;a&#x27; IN (&#x27;a&#x27;,&#x27;b&#x27;,&#x27;c&#x27;), 1 IN (2,3), NULL IN (&#x27;a&#x27;,&#x27;b&#x27;), &#x27;a&#x27; IN (&#x27;a&#x27;, NULL);<br>+----------------------+------------+-------------------+--------------------+<br>| &#x27;a&#x27; IN (&#x27;a&#x27;,&#x27;b&#x27;,&#x27;c&#x27;) | 1 IN (2,3) | NULL IN (&#x27;a&#x27;,&#x27;b&#x27;) | &#x27;a&#x27; IN (&#x27;a&#x27;, NULL) |<br>+----------------------+------------+-------------------+--------------------+<br>|            1         |        0   |         NULL      |         1          |<br>+----------------------+------------+-------------------+--------------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT employee_id, last_name, salary, manager_id<br>FROM   employees<br>WHERE  manager_id IN (100, 101, 201);<br></code></pre></td></tr></table></figure><p><strong>ä¸»è¦æ³¨æ„çš„æ˜¯ï¼Œå€¼éœ€è¦æ”¾åœ¨ä¸€ä¸ªï¼ˆï¼‰ä¸­ï¼Œå¦åˆ™è¯­æ³•é”™è¯¯</strong></p><p><strong>10. NOT INè¿ç®—ç¬¦</strong><br>NOT INè¿ç®—ç¬¦ç”¨äºåˆ¤æ–­ç»™å®šçš„å€¼æ˜¯å¦ä¸æ˜¯INåˆ—è¡¨ä¸­çš„ä¸€ä¸ªå€¼ï¼Œå¦‚æœä¸æ˜¯INåˆ—è¡¨ä¸­çš„ä¸€ä¸ªå€¼ï¼Œåˆ™è¿”å›1ï¼Œå¦åˆ™è¿”å›0ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT &#x27;a&#x27; NOT IN (&#x27;a&#x27;,&#x27;b&#x27;,&#x27;c&#x27;), 1 NOT IN (2,3);<br>+--------------------------+----------------+<br>| &#x27;a&#x27; NOT IN (&#x27;a&#x27;,&#x27;b&#x27;,&#x27;c&#x27;) | 1 NOT IN (2,3) |<br>+--------------------------+----------------+<br>|                 0        |            1   |<br>+--------------------------+----------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><p><strong>11. LIKEè¿ç®—ç¬¦</strong><br>LIKEè¿ç®—ç¬¦ä¸»è¦ç”¨æ¥åŒ¹é…å­—ç¬¦ä¸²ï¼Œé€šå¸¸ç”¨äºæ¨¡ç³ŠåŒ¹é…ï¼Œå¦‚æœæ»¡è¶³æ¡ä»¶åˆ™è¿”å›1ï¼Œå¦åˆ™è¿”å›0ã€‚å¦‚æœç»™å®šçš„å€¼æˆ–è€…åŒ¹é…æ¡ä»¶ä¸ºNULLï¼Œåˆ™è¿”å›ç»“æœä¸ºNULLã€‚</p><p>LIKEè¿ç®—ç¬¦é€šå¸¸ä½¿ç”¨å¦‚ä¸‹é€šé…ç¬¦ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">â€œ%â€ï¼šåŒ¹é…0ä¸ªæˆ–å¤šä¸ªå­—ç¬¦ã€‚<br>â€œ_â€ï¼šåªèƒ½åŒ¹é…ä¸€ä¸ªå­—ç¬¦ã€‚<br></code></pre></td></tr></table></figure><p>SQLè¯­å¥ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT NULL LIKE &#x27;abc&#x27;, &#x27;abc&#x27; LIKE NULL;  <br>+-----------------+-----------------+<br>| NULL LIKE &#x27;abc&#x27; | &#x27;abc&#x27; LIKE NULL |<br>+-----------------+-----------------+<br>|          NULL   |          NULL   |<br>+-----------------+-----------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECTfirst_name<br>FROM employees<br>WHEREfirst_name LIKE &#x27;S%&#x27;;<br>#ä»¥Sã€sæ‰“å¤´ï¼ŒMySQLä¸åŒºåˆ†å­—æ®µå€¼çš„å¤§å°å†™ï¼Œä½†æ˜¯SQLè§„èŒƒè¦å»åŒºåˆ†<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT last_name<br>FROM   employees<br>WHERE  last_name LIKE &#x27;_o%&#x27;;<br>#ç¬¬äºŒä¸ªå­—ç¬¦ä¸ºoã€Oçš„å­—æ®µå€¼<br></code></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql">#last_nameåŒ…å«<span class="hljs-string">&#x27;a&#x27;</span>å¹¶ä¸”åŒ…å«<span class="hljs-string">&#x27;e&#x27;</span>çš„last_name<br><span class="hljs-keyword">SELECT</span> last_name<br><span class="hljs-keyword">FROM</span> employees<br><span class="hljs-keyword">WHERE</span> last_name <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;%a%&#x27;</span> <span class="hljs-keyword">AND</span> last_name <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;%e%&#x27;</span>;<br><br><span class="hljs-keyword">SELECT</span> last_name<br><span class="hljs-keyword">FROM</span> employees<br><span class="hljs-keyword">WHERE</span> last_name <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;%a%e%&#x27;</span> <span class="hljs-keyword">OR</span> last_name <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;%a%e%&#x27;</span>;<br></code></pre></td></tr></table></figure><p><strong>ESCAPE</strong></p><ul><li>å›é¿ç‰¹æ®Šç¬¦å·çš„ï¼š**ä½¿ç”¨è½¬ä¹‰ç¬¦\**ã€‚ä¾‹å¦‚ï¼šå°†[%]è½¬ä¸º[$%]ã€[]è½¬ä¸º[$]ï¼Œç„¶åå†åŠ ä¸Š[ESCAPEâ€˜$â€™]å³å¯ã€‚</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT job_id<br>FROM   jobs<br>WHERE  job_id LIKE â€˜IT\_%â€˜;<br></code></pre></td></tr></table></figure><ul><li>å¦‚æœä½¿ç”¨\è¡¨ç¤ºè½¬ä¹‰ï¼Œè¦çœç•¥ESCAPEã€‚å¦‚æœä¸æ˜¯\ï¼Œåˆ™è¦åŠ ä¸ŠESCAPEã€‚</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT job_id<br>FROM   jobs<br>WHERE  job_id LIKE â€˜IT$_%â€˜ escape â€˜$â€˜;<br></code></pre></td></tr></table></figure><p><strong>12. REGEXP \ RLIKEè¿ç®—ç¬¦</strong></p><p>REGEXPè¿ç®—ç¬¦ç”¨æ¥åŒ¹é…å­—ç¬¦ä¸²ï¼Œè¯­æ³•æ ¼å¼ä¸ºï¼š<code>expr REGEXP åŒ¹é…æ¡ä»¶</code>ã€‚å¦‚æœexpræ»¡è¶³åŒ¹é…æ¡ä»¶ï¼Œè¿”å›1ï¼›å¦‚æœä¸æ»¡è¶³ï¼Œåˆ™è¿”å›0ã€‚è‹¥expræˆ–åŒ¹é…æ¡ä»¶ä»»æ„ä¸€ä¸ªä¸ºNULLï¼Œåˆ™ç»“æœä¸ºNULLã€‚</p><p>REGEXPè¿ç®—ç¬¦åœ¨è¿›è¡ŒåŒ¹é…æ—¶ï¼Œå¸¸ç”¨çš„æœ‰ä¸‹é¢å‡ ç§é€šé…ç¬¦ï¼š</p><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs inform7">ï¼ˆ1ï¼‰â€˜^â€™åŒ¹é…ä»¥è¯¥å­—ç¬¦åé¢çš„å­—ç¬¦å¼€å¤´çš„å­—ç¬¦ä¸²ã€‚<br>ï¼ˆ2ï¼‰â€˜$â€™åŒ¹é…ä»¥è¯¥å­—ç¬¦å‰é¢çš„å­—ç¬¦ç»“å°¾çš„å­—ç¬¦ä¸²ã€‚<br>ï¼ˆ3ï¼‰â€˜.â€™åŒ¹é…ä»»ä½•ä¸€ä¸ªå•å­—ç¬¦ã€‚<br>ï¼ˆ4ï¼‰â€œ<span class="hljs-comment">[...]</span>â€åŒ¹é…åœ¨æ–¹æ‹¬å·å†…çš„ä»»ä½•å­—ç¬¦ã€‚ä¾‹å¦‚ï¼Œâ€œ<span class="hljs-comment">[abc]</span>â€åŒ¹é…â€œaâ€æˆ–â€œbâ€æˆ–â€œcâ€ã€‚ä¸ºäº†å‘½åå­—ç¬¦çš„èŒƒå›´ï¼Œä½¿ç”¨ä¸€ä¸ªâ€˜-â€™ã€‚â€œ<span class="hljs-comment">[a-z]</span>â€åŒ¹é…ä»»ä½•å­—æ¯ï¼Œè€Œâ€œ<span class="hljs-comment">[0-9]</span>â€åŒ¹é…ä»»ä½•æ•°å­—ã€‚<br>ï¼ˆ5ï¼‰â€˜*â€™åŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªåœ¨å®ƒå‰é¢çš„å­—ç¬¦ã€‚ä¾‹å¦‚ï¼Œâ€œx*â€åŒ¹é…ä»»ä½•æ•°é‡çš„â€˜xâ€™å­—ç¬¦ï¼Œâ€œ<span class="hljs-comment">[0-9]</span>*â€åŒ¹é…ä»»ä½•æ•°é‡çš„æ•°å­—ï¼Œè€Œâ€œ*â€åŒ¹é…ä»»ä½•æ•°é‡çš„ä»»ä½•å­—ç¬¦ã€‚<br></code></pre></td></tr></table></figure><p>SQLè¯­å¥ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT &#x27;shkstart&#x27; REGEXP &#x27;^s&#x27;, &#x27;shkstart&#x27; REGEXP &#x27;t$&#x27;, &#x27;shkstart&#x27; REGEXP &#x27;hk&#x27;;<br>+------------------------+------------------------+-------------------------+<br>| &#x27;shkstart&#x27; REGEXP &#x27;^s&#x27; | &#x27;shkstart&#x27; REGEXP &#x27;t$&#x27; | &#x27;shkstart&#x27; REGEXP &#x27;hk&#x27;  |<br>+------------------------+------------------------+-------------------------+<br>|                      1 |                      1 |                       1 |<br>+------------------------+------------------------+-------------------------+<br>1 row in set (0.01 sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT &#x27;atguigu&#x27; REGEXP &#x27;gu.gu&#x27;, &#x27;atguigu&#x27; REGEXP &#x27;[ab]&#x27;;<br>+--------------------------+-------------------------+<br>| &#x27;atguigu&#x27; REGEXP &#x27;gu.gu&#x27; | &#x27;atguigu&#x27; REGEXP &#x27;[ab]&#x27; |<br>+--------------------------+-------------------------+<br>|                        1 |                       1 |<br>+--------------------------+-------------------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><h2 id="3-é€»è¾‘è¿ç®—ç¬¦"><a href="#3-é€»è¾‘è¿ç®—ç¬¦" class="headerlink" title="3. é€»è¾‘è¿ç®—ç¬¦"></a>3. é€»è¾‘è¿ç®—ç¬¦</h2><p>é€»è¾‘è¿ç®—ç¬¦ä¸»è¦ç”¨æ¥åˆ¤æ–­è¡¨è¾¾å¼çš„çœŸå‡ï¼Œåœ¨MySQLä¸­ï¼Œé€»è¾‘è¿ç®—ç¬¦çš„è¿”å›ç»“æœä¸º1ã€0æˆ–è€…NULLã€‚</p><p>MySQLä¸­æ”¯æŒ4ç§é€»è¾‘è¿ç®—ç¬¦å¦‚ä¸‹ï¼š</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211012110241418.png"></p><p>éœ€è¦æ³¨æ„çš„æ˜¯é€»è¾‘ä¸ã€æˆ–è¿æ¥çš„è¡¨è¾¾å¼éƒ½å¿…é¡»æ˜¯å®Œæ•´çš„</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> last_name, salary<br><span class="hljs-keyword">FROM</span> employees<br><span class="hljs-keyword">WHERE</span> department_id <span class="hljs-operator">=</span> <span class="hljs-number">10</span> <span class="hljs-keyword">OR</span> <span class="hljs-number">20</span> <span class="hljs-keyword">OR</span> <span class="hljs-number">30</span><br>#æ˜¯é”™è¯¯çš„ï¼Œæ­£ç¡®å¦‚ä¸‹ï¼š<br><span class="hljs-keyword">SELECT</span> last_name, salary<br><span class="hljs-keyword">FROM</span> employees<br><span class="hljs-keyword">WHERE</span> department_id <span class="hljs-operator">=</span> <span class="hljs-number">10</span> <span class="hljs-keyword">OR</span> department_id <span class="hljs-operator">=</span> <span class="hljs-number">20</span> <span class="hljs-keyword">OR</span> department_id <span class="hljs-operator">=</span> <span class="hljs-number">30</span><br></code></pre></td></tr></table></figure><p><strong>1ï¼é€»è¾‘éè¿ç®—ç¬¦</strong><br>é€»è¾‘éï¼ˆNOTæˆ–!ï¼‰è¿ç®—ç¬¦è¡¨ç¤ºå½“ç»™å®šçš„å€¼ä¸º0æ—¶è¿”å›1ï¼›å½“ç»™å®šçš„å€¼ä¸ºé0å€¼æ—¶è¿”å›0ï¼›å½“ç»™å®šçš„å€¼ä¸ºNULLæ—¶ï¼Œè¿”å›NULLã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT NOT 1, NOT 0, NOT(1+1), NOT !1, NOT NULL;    <br>+-------+-------+----------+--------+----------+<br>| NOT 1 | NOT 0 | NOT(1+1) | NOT !1 | NOT NULL |<br>+-------+-------+----------+--------+----------+<br>|     0 |     1 |        0 |      1 |     NULL |<br>+-------+-------+----------+--------+----------+<br>1 row in set, 1 warning (0.00 sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT last_name, job_id<br>FROM   employees<br>WHERE  job_id NOT IN (&#x27;IT_PROG&#x27;, &#x27;ST_CLERK&#x27;, &#x27;SA_REP&#x27;);<br></code></pre></td></tr></table></figure><p><strong>2ï¼é€»è¾‘ä¸è¿ç®—ç¬¦</strong><br>é€»è¾‘ä¸ï¼ˆANDæˆ–&amp;&amp;ï¼‰è¿ç®—ç¬¦æ˜¯å½“ç»™å®šçš„æ‰€æœ‰å€¼å‡ä¸ºé0å€¼ï¼Œå¹¶ä¸”éƒ½ä¸ä¸ºNULLæ—¶ï¼Œè¿”å›1ï¼›å½“ç»™å®šçš„ä¸€ä¸ªå€¼æˆ–è€…å¤šä¸ªå€¼ä¸º0æ—¶åˆ™è¿”å›0ï¼›å¦åˆ™è¿”å›NULLã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT 1 AND -1, 0 AND 1, 0 AND NULL, 1 AND NULL;<br>+----------+---------+------------+------------+<br>| 1 AND -1 | 0 AND 1 | 0 AND NULL | 1 AND NULL |<br>+----------+---------+------------+------------+<br>|        1 |       0 |          0 |       NULL |<br>+----------+---------+------------+------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT employee_id, last_name, job_id, salary<br>FROM   employees<br>WHERE  salary &gt;=10000<br>AND    job_id LIKE &#x27;%MAN%&#x27;;<br></code></pre></td></tr></table></figure><p><strong>3ï¼é€»è¾‘æˆ–è¿ç®—ç¬¦</strong><br>é€»è¾‘æˆ–ï¼ˆORæˆ–||ï¼‰è¿ç®—ç¬¦æ˜¯å½“ç»™å®šçš„å€¼éƒ½ä¸ä¸ºNULLï¼Œå¹¶ä¸”ä»»ä½•ä¸€ä¸ªå€¼ä¸ºé0å€¼æ—¶ï¼Œåˆ™è¿”å›1ï¼Œå¦åˆ™è¿”å›0ï¼›å½“ä¸€ä¸ªå€¼ä¸ºNULLï¼Œå¹¶ä¸”å¦ä¸€ä¸ªå€¼ä¸ºé0å€¼æ—¶ï¼Œè¿”å›1ï¼Œå¦åˆ™è¿”å›NULLï¼›å½“ä¸¤ä¸ªå€¼éƒ½ä¸ºNULLæ—¶ï¼Œè¿”å›NULLã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT 1 OR -1, 1 OR 0, 1 OR NULL, 0 || NULL, NULL || NULL;     <br>+---------+--------+-----------+-----------+--------------+<br>| 1 OR -1 | 1 OR 0 | 1 OR NULL | 0 || NULL | NULL || NULL |<br>+---------+--------+-----------+-----------+--------------+<br>|       1 |      1 |         1 |    NULL   |       NULL   |<br>+---------+--------+-----------+-----------+--------------+<br>1 row in set, 2 warnings (0.00 sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#æŸ¥è¯¢åŸºæœ¬è–ªèµ„ä¸åœ¨9000-12000ä¹‹é—´çš„å‘˜å·¥ç¼–å·å’ŒåŸºæœ¬è–ªèµ„<br>SELECT employee_id,salary FROM employees <br>WHERE NOT (salary &gt;= 9000 AND salary &lt;= 12000);<br><br>SELECT employee_id,salary FROM employees <br>WHERE salary &lt;9000 OR salary &gt; 12000;<br><br>SELECT employee_id,salary FROM employees <br>WHERE salary NOT BETWEEN 9000 AND 12000;<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT employee_id, last_name, job_id, salary<br>FROM   employees<br>WHERE  salary &gt;= 10000<br>OR     job_id LIKE &#x27;%MAN%&#x27;;<br></code></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼š</p><p>ORå¯ä»¥å’ŒANDä¸€èµ·ä½¿ç”¨ï¼Œä½†æ˜¯åœ¨ä½¿ç”¨æ—¶è¦æ³¨æ„ä¸¤è€…çš„ä¼˜å…ˆçº§ï¼Œç”±äºANDçš„ä¼˜å…ˆçº§é«˜äºORï¼Œå› æ­¤å…ˆå¯¹ANDä¸¤è¾¹çš„æ“ä½œæ•°è¿›è¡Œæ“ä½œï¼Œå†ä¸ORä¸­çš„æ“ä½œæ•°ç»“åˆã€‚</p></blockquote><p><strong>4ï¼é€»è¾‘å¼‚æˆ–è¿ç®—ç¬¦</strong><br>é€»è¾‘å¼‚æˆ–ï¼ˆXORï¼‰è¿ç®—ç¬¦æ˜¯å½“ç»™å®šçš„å€¼ä¸­ä»»æ„ä¸€ä¸ªå€¼ä¸ºNULLæ—¶ï¼Œåˆ™è¿”å›NULLï¼›å¦‚æœä¸¤ä¸ªéNULLçš„å€¼éƒ½æ˜¯0æˆ–è€…éƒ½ä¸ç­‰äº0æ—¶ï¼Œåˆ™è¿”å›0ï¼›å¦‚æœä¸€ä¸ªå€¼ä¸º0ï¼Œå¦ä¸€ä¸ªå€¼ä¸ä¸º0æ—¶ï¼Œåˆ™è¿”å›1ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT 1 XOR -1, 1 XOR 0, 0 XOR 0, 1 XOR NULL, 1 XOR 1 XOR 1, 0 XOR 0 XOR 0;<br>+----------+---------+---------+------------+---------------+---------------+<br>| 1 XOR -1 | 1 XOR 0 | 0 XOR 0 | 1 XOR NULL | 1 XOR 1 XOR 1 | 0 XOR 0 XOR 0 |<br>+----------+---------+---------+------------+---------------+---------------+<br>|        0 |       1 |       0 |       NULL |             1 |             0 |<br>+----------+---------+---------+------------+---------------+---------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">select last_name,department_id,salary <br>from employees<br>where department_id in (10,20) XOR salary &gt; 8000;<br></code></pre></td></tr></table></figure><h2 id="4-ä½è¿ç®—ç¬¦"><a href="#4-ä½è¿ç®—ç¬¦" class="headerlink" title="4. ä½è¿ç®—ç¬¦"></a>4. ä½è¿ç®—ç¬¦</h2><p>ä½è¿ç®—ç¬¦æ˜¯åœ¨äºŒè¿›åˆ¶æ•°ä¸Šè¿›è¡Œè®¡ç®—çš„è¿ç®—ç¬¦ã€‚ä½è¿ç®—ç¬¦ä¼šå…ˆå°†æ“ä½œæ•°å˜æˆäºŒè¿›åˆ¶æ•°ï¼Œç„¶åè¿›è¡Œä½è¿ç®—ï¼Œæœ€åå°†è®¡ç®—ç»“æœä»äºŒè¿›åˆ¶å˜å›åè¿›åˆ¶æ•°ã€‚</p><p>MySQLæ”¯æŒçš„ä½è¿ç®—ç¬¦å¦‚ä¸‹ï¼š</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211012110511223.png"></p><p><strong>1ï¼æŒ‰ä½ä¸è¿ç®—ç¬¦</strong><br>æŒ‰ä½ä¸ï¼ˆ&amp;ï¼‰è¿ç®—ç¬¦å°†ç»™å®šå€¼å¯¹åº”çš„äºŒè¿›åˆ¶æ•°é€ä½è¿›è¡Œé€»è¾‘ä¸è¿ç®—ã€‚å½“ç»™å®šå€¼å¯¹åº”çš„äºŒè¿›åˆ¶ä½çš„æ•°å€¼éƒ½ä¸º1æ—¶ï¼Œåˆ™è¯¥ä½è¿”å›1ï¼Œå¦åˆ™è¿”å›0ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT 1 &amp; 10, 20 &amp; 30;<br>+--------+---------+<br>| 1 &amp; 10 | 20 &amp; 30 |<br>+--------+---------+<br>|      0 |      20 |<br>+--------+---------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>1çš„äºŒè¿›åˆ¶æ•°ä¸º0001ï¼Œ10çš„äºŒè¿›åˆ¶æ•°ä¸º1010ï¼Œæ‰€ä»¥1 &amp; 10çš„ç»“æœä¸º0000ï¼Œå¯¹åº”çš„åè¿›åˆ¶æ•°ä¸º0ã€‚20çš„äºŒè¿›åˆ¶æ•°ä¸º10100ï¼Œ30çš„äºŒè¿›åˆ¶æ•°ä¸º11110ï¼Œæ‰€ä»¥20 &amp; 30çš„ç»“æœä¸º10100ï¼Œå¯¹åº”çš„åè¿›åˆ¶æ•°ä¸º20ã€‚</p><p><strong>2. æŒ‰ä½æˆ–è¿ç®—ç¬¦</strong><br>æŒ‰ä½æˆ–ï¼ˆ|ï¼‰è¿ç®—ç¬¦å°†ç»™å®šçš„å€¼å¯¹åº”çš„äºŒè¿›åˆ¶æ•°é€ä½è¿›è¡Œé€»è¾‘æˆ–è¿ç®—ã€‚å½“ç»™å®šå€¼å¯¹åº”çš„äºŒè¿›åˆ¶ä½çš„æ•°å€¼æœ‰ä¸€ä¸ªæˆ–ä¸¤ä¸ªä¸º1æ—¶ï¼Œåˆ™è¯¥ä½è¿”å›1ï¼Œå¦åˆ™è¿”å›0ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT 1 | 10, 20 | 30; <br>+--------+---------+<br>| 1 | 10 | 20 | 30 |<br>+--------+---------+<br>|     11 |      30 |<br>+--------+---------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>1çš„äºŒè¿›åˆ¶æ•°ä¸º0001ï¼Œ10çš„äºŒè¿›åˆ¶æ•°ä¸º1010ï¼Œæ‰€ä»¥1 | 10çš„ç»“æœä¸º1011ï¼Œå¯¹åº”çš„åè¿›åˆ¶æ•°ä¸º11ã€‚20çš„äºŒè¿›åˆ¶æ•°ä¸º10100ï¼Œ30çš„äºŒè¿›åˆ¶æ•°ä¸º11110ï¼Œæ‰€ä»¥20 | 30çš„ç»“æœä¸º11110ï¼Œå¯¹åº”çš„åè¿›åˆ¶æ•°ä¸º30ã€‚</p><p><strong>3. æŒ‰ä½å¼‚æˆ–è¿ç®—ç¬¦</strong><br>æŒ‰ä½å¼‚æˆ–ï¼ˆ^ï¼‰è¿ç®—ç¬¦å°†ç»™å®šçš„å€¼å¯¹åº”çš„äºŒè¿›åˆ¶æ•°é€ä½è¿›è¡Œé€»è¾‘å¼‚æˆ–è¿ç®—ã€‚å½“ç»™å®šå€¼å¯¹åº”çš„äºŒè¿›åˆ¶ä½çš„æ•°å€¼ä¸åŒæ—¶ï¼Œåˆ™è¯¥ä½è¿”å›1ï¼Œå¦åˆ™è¿”å›0ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT 1 ^ 10, 20 ^ 30; <br>+--------+---------+<br>| 1 ^ 10 | 20 ^ 30 |<br>+--------+---------+<br>|     11 |      10 |<br>+--------+---------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>1çš„äºŒè¿›åˆ¶æ•°ä¸º0001ï¼Œ10çš„äºŒè¿›åˆ¶æ•°ä¸º1010ï¼Œæ‰€ä»¥1 ^ 10çš„ç»“æœä¸º1011ï¼Œå¯¹åº”çš„åè¿›åˆ¶æ•°ä¸º11ã€‚20çš„äºŒè¿›åˆ¶æ•°ä¸º10100ï¼Œ30çš„äºŒè¿›åˆ¶æ•°ä¸º11110ï¼Œæ‰€ä»¥20 ^ 30çš„ç»“æœä¸º01010ï¼Œå¯¹åº”çš„åè¿›åˆ¶æ•°ä¸º10ã€‚</p><p>å†ä¸¾ä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT 12 &amp; 5, 12 | 5,12 ^ 5 FROM DUAL;<br>+--------+--------+--------+<br>| 12 &amp; 5 | 12 | 5 | 12 ^ 5 |<br>+--------+--------+--------+<br>|      4 |     13 |      9 |<br>+--------+--------+--------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211023115738415.png" alt="" style="zoom:80%;" /><p><strong>4. æŒ‰ä½å–åè¿ç®—ç¬¦</strong><br>æŒ‰ä½å–åï¼ˆ~ï¼‰è¿ç®—ç¬¦å°†ç»™å®šçš„å€¼çš„äºŒè¿›åˆ¶æ•°é€ä½è¿›è¡Œå–åæ“ä½œï¼Œå³å°†1å˜ä¸º0ï¼Œå°†0å˜ä¸º1ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT 10 &amp; ~1;<br>+---------+<br>| 10 &amp; ~1 |<br>+---------+<br>|      10 |<br>+---------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>ç”±äºæŒ‰ä½å–åï¼ˆ~ï¼‰è¿ç®—ç¬¦çš„ä¼˜å…ˆçº§é«˜äºæŒ‰ä½ä¸ï¼ˆ&amp;ï¼‰è¿ç®—ç¬¦çš„ä¼˜å…ˆçº§ï¼Œæ‰€ä»¥10 &amp; ~1ï¼Œé¦–å…ˆï¼Œå¯¹æ•°å­—1è¿›è¡ŒæŒ‰ä½å–åæ“ä½œï¼Œç»“æœé™¤äº†æœ€ä½ä½ä¸º0ï¼Œå…¶ä»–ä½éƒ½ä¸º1ï¼Œç„¶åä¸10è¿›è¡ŒæŒ‰ä½ä¸æ“ä½œï¼Œç»“æœä¸º10ã€‚</p><p><strong>5. æŒ‰ä½å³ç§»è¿ç®—ç¬¦</strong><br>æŒ‰ä½å³ç§»ï¼ˆ&gt;&gt;ï¼‰è¿ç®—ç¬¦å°†ç»™å®šçš„å€¼çš„äºŒè¿›åˆ¶æ•°çš„æ‰€æœ‰ä½å³ç§»æŒ‡å®šçš„ä½æ•°ã€‚å³ç§»æŒ‡å®šçš„ä½æ•°åï¼Œå³è¾¹ä½ä½çš„æ•°å€¼è¢«ç§»å‡ºå¹¶ä¸¢å¼ƒï¼Œå·¦è¾¹é«˜ä½ç©ºå‡ºçš„ä½ç½®ç”¨0è¡¥é½ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT 1 &gt;&gt; 2, 4 &gt;&gt; 2;<br>+--------+--------+<br>| 1 &gt;&gt; 2 | 4 &gt;&gt; 2 |<br>+--------+--------+<br>|      0 |      1 |<br>+--------+--------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>1çš„äºŒè¿›åˆ¶æ•°ä¸º0000 0001ï¼Œå³ç§»2ä½ä¸º0000 0000ï¼Œå¯¹åº”çš„åè¿›åˆ¶æ•°ä¸º0ã€‚4çš„äºŒè¿›åˆ¶æ•°ä¸º0000 0100ï¼Œå³ç§»2ä½ä¸º0000 0001ï¼Œå¯¹åº”çš„åè¿›åˆ¶æ•°ä¸º1ã€‚</p><p><strong>6. æŒ‰ä½å·¦ç§»è¿ç®—ç¬¦</strong><br>æŒ‰ä½å·¦ç§»ï¼ˆ&lt;&lt;ï¼‰è¿ç®—ç¬¦å°†ç»™å®šçš„å€¼çš„äºŒè¿›åˆ¶æ•°çš„æ‰€æœ‰ä½å·¦ç§»æŒ‡å®šçš„ä½æ•°ã€‚å·¦ç§»æŒ‡å®šçš„ä½æ•°åï¼Œå·¦è¾¹é«˜ä½çš„æ•°å€¼è¢«ç§»å‡ºå¹¶ä¸¢å¼ƒï¼Œå³è¾¹ä½ä½ç©ºå‡ºçš„ä½ç½®ç”¨0è¡¥é½ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT 1 &lt;&lt; 2, 4 &lt;&lt; 2;  <br>+--------+--------+<br>| 1 &lt;&lt; 2 | 4 &lt;&lt; 2 |<br>+--------+--------+<br>|      4 |     16 |<br>+--------+--------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>1çš„äºŒè¿›åˆ¶æ•°ä¸º0000 0001ï¼Œå·¦ç§»ä¸¤ä½ä¸º0000 0100ï¼Œå¯¹åº”çš„åè¿›åˆ¶æ•°ä¸º4ã€‚4çš„äºŒè¿›åˆ¶æ•°ä¸º0000 0100ï¼Œå·¦ç§»ä¸¤ä½ä¸º0001 0000ï¼Œå¯¹åº”çš„åè¿›åˆ¶æ•°ä¸º16ã€‚</p><h2 id="5-è¿ç®—ç¬¦çš„ä¼˜å…ˆçº§"><a href="#5-è¿ç®—ç¬¦çš„ä¼˜å…ˆçº§" class="headerlink" title="5. è¿ç®—ç¬¦çš„ä¼˜å…ˆçº§"></a>5. è¿ç®—ç¬¦çš„ä¼˜å…ˆçº§</h2><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211012111042395.png"></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211012110731059.png"></p><p>æ•°å­—ç¼–å·è¶Šå¤§ï¼Œä¼˜å…ˆçº§è¶Šé«˜ï¼Œä¼˜å…ˆçº§é«˜çš„è¿ç®—ç¬¦å…ˆè¿›è¡Œè®¡ç®—ã€‚å¯ä»¥çœ‹åˆ°ï¼Œèµ‹å€¼è¿ç®—ç¬¦çš„ä¼˜å…ˆçº§æœ€ä½ï¼Œä½¿ç”¨â€œ()â€æ‹¬èµ·æ¥çš„è¡¨è¾¾å¼çš„ä¼˜å…ˆçº§æœ€é«˜ã€‚</p><h2 id="æ‹“å±•ï¼šä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æŸ¥è¯¢"><a href="#æ‹“å±•ï¼šä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æŸ¥è¯¢" class="headerlink" title="æ‹“å±•ï¼šä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æŸ¥è¯¢"></a>æ‹“å±•ï¼šä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æŸ¥è¯¢</h2><p>æ­£åˆ™è¡¨è¾¾å¼é€šå¸¸è¢«ç”¨æ¥æ£€ç´¢æˆ–æ›¿æ¢é‚£äº›ç¬¦åˆæŸä¸ªæ¨¡å¼çš„æ–‡æœ¬å†…å®¹ï¼Œæ ¹æ®æŒ‡å®šçš„åŒ¹é…æ¨¡å¼åŒ¹é…æ–‡æœ¬ä¸­ç¬¦åˆè¦æ±‚çš„ç‰¹æ®Šå­—ç¬¦ä¸²ã€‚ä¾‹å¦‚ï¼Œä»ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ä¸­æå–ç”µè¯å·ç ï¼ŒæŸ¥æ‰¾ä¸€ç¯‡æ–‡ç« ä¸­é‡å¤çš„å•è¯æˆ–è€…æ›¿æ¢ç”¨æˆ·è¾“å…¥çš„æŸäº›æ•æ„Ÿè¯è¯­ç­‰ï¼Œè¿™äº›åœ°æ–¹éƒ½å¯ä»¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ã€‚æ­£åˆ™è¡¨è¾¾å¼å¼ºå¤§è€Œä¸”çµæ´»ï¼Œå¯ä»¥åº”ç”¨äºéå¸¸å¤æ‚çš„æŸ¥è¯¢ã€‚</p><p>MySQLä¸­ä½¿ç”¨REGEXPå…³é”®å­—æŒ‡å®šæ­£åˆ™è¡¨è¾¾å¼çš„å­—ç¬¦åŒ¹é…æ¨¡å¼ã€‚ä¸‹è¡¨åˆ—å‡ºäº†REGEXPæ“ä½œç¬¦ä¸­å¸¸ç”¨å­—ç¬¦åŒ¹é…åˆ—è¡¨ã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20210926151249943.png"></p><p><strong>1. æŸ¥è¯¢ä»¥ç‰¹å®šå­—ç¬¦æˆ–å­—ç¬¦ä¸²å¼€å¤´çš„è®°å½•</strong><br>å­—ç¬¦â€˜^â€™åŒ¹é…ä»¥ç‰¹å®šå­—ç¬¦æˆ–è€…å­—ç¬¦ä¸²å¼€å¤´çš„æ–‡æœ¬ã€‚</p><p>åœ¨fruitsè¡¨ä¸­ï¼ŒæŸ¥è¯¢f_nameå­—æ®µä»¥å­—æ¯â€˜bâ€™å¼€å¤´çš„è®°å½•ï¼ŒSQLè¯­å¥å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT * FROM fruits WHERE f_name REGEXP &#x27;^b&#x27;;<br></code></pre></td></tr></table></figure><p><strong>2. æŸ¥è¯¢ä»¥ç‰¹å®šå­—ç¬¦æˆ–å­—ç¬¦ä¸²ç»“å°¾çš„è®°å½•</strong><br>å­—ç¬¦â€˜$â€™åŒ¹é…ä»¥ç‰¹å®šå­—ç¬¦æˆ–è€…å­—ç¬¦ä¸²ç»“å°¾çš„æ–‡æœ¬ã€‚</p><p>åœ¨fruitsè¡¨ä¸­ï¼ŒæŸ¥è¯¢f_nameå­—æ®µä»¥å­—æ¯â€˜yâ€™ç»“å°¾çš„è®°å½•ï¼ŒSQLè¯­å¥å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT * FROM fruits WHERE f_name REGEXP &#x27;y$&#x27;;<br></code></pre></td></tr></table></figure><p><strong>3. ç”¨ç¬¦å·â€.â€æ¥æ›¿ä»£å­—ç¬¦ä¸²ä¸­çš„ä»»æ„ä¸€ä¸ªå­—ç¬¦</strong><br>å­—ç¬¦â€˜.â€™åŒ¹é…ä»»æ„ä¸€ä¸ªå­—ç¬¦ã€‚<br>åœ¨fruitsè¡¨ä¸­ï¼ŒæŸ¥è¯¢f_nameå­—æ®µå€¼åŒ…å«å­—æ¯â€˜aâ€™ä¸â€˜gâ€™ä¸”ä¸¤ä¸ªå­—æ¯ä¹‹é—´åªæœ‰ä¸€ä¸ªå­—æ¯çš„è®°å½•ï¼ŒSQLè¯­å¥å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT * FROM fruits WHERE f_name REGEXP &#x27;a.g&#x27;;<br></code></pre></td></tr></table></figure><p><strong>4. ä½¿ç”¨â€*â€å’Œâ€+â€æ¥åŒ¹é…å¤šä¸ªå­—ç¬¦</strong><br>æ˜Ÿå·â€˜*â€™åŒ¹é…å‰é¢çš„å­—ç¬¦ä»»æ„å¤šæ¬¡ï¼ŒåŒ…æ‹¬0æ¬¡ã€‚åŠ å·â€˜+â€™åŒ¹é…å‰é¢çš„å­—ç¬¦è‡³å°‘ä¸€æ¬¡ã€‚</p><p>åœ¨fruitsè¡¨ä¸­ï¼ŒæŸ¥è¯¢f_nameå­—æ®µå€¼ä»¥å­—æ¯â€˜bâ€™å¼€å¤´ä¸”â€˜bâ€™åé¢å‡ºç°å­—æ¯â€˜aâ€™çš„è®°å½•ï¼ŒSQLè¯­å¥å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT * FROM fruits WHERE f_name REGEXP &#x27;^ba*&#x27;;<br></code></pre></td></tr></table></figure><p>åœ¨fruitsè¡¨ä¸­ï¼ŒæŸ¥è¯¢f_nameå­—æ®µå€¼ä»¥å­—æ¯â€˜bâ€™å¼€å¤´ä¸”â€˜bâ€™åé¢å‡ºç°å­—æ¯â€˜aâ€™è‡³å°‘ä¸€æ¬¡çš„è®°å½•ï¼ŒSQLè¯­å¥å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT * FROM fruits WHERE f_name REGEXP &#x27;^ba+&#x27;;<br></code></pre></td></tr></table></figure><p><strong>5. åŒ¹é…æŒ‡å®šå­—ç¬¦ä¸²</strong><br>æ­£åˆ™è¡¨è¾¾å¼å¯ä»¥åŒ¹é…æŒ‡å®šå­—ç¬¦ä¸²ï¼Œåªè¦è¿™ä¸ªå­—ç¬¦ä¸²åœ¨æŸ¥è¯¢æ–‡æœ¬ä¸­å³å¯ï¼Œå¦‚è¦åŒ¹é…å¤šä¸ªå­—ç¬¦ä¸²ï¼Œå¤šä¸ªå­—ç¬¦ä¸²ä¹‹é—´ä½¿ç”¨åˆ†éš”ç¬¦â€˜|â€™éš”å¼€ã€‚</p><p>åœ¨fruitsè¡¨ä¸­ï¼ŒæŸ¥è¯¢f_nameå­—æ®µå€¼åŒ…å«å­—ç¬¦ä¸²â€œonâ€çš„è®°å½•ï¼ŒSQLè¯­å¥å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT * FROM fruits WHERE f_name REGEXP &#x27;on&#x27;;<br></code></pre></td></tr></table></figure><p>åœ¨fruitsè¡¨ä¸­ï¼ŒæŸ¥è¯¢f_nameå­—æ®µå€¼åŒ…å«å­—ç¬¦ä¸²â€œonâ€æˆ–è€…â€œapâ€çš„è®°å½•ï¼ŒSQLè¯­å¥å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT * FROM fruits WHERE f_name REGEXP &#x27;on|ap&#x27;;<br></code></pre></td></tr></table></figure><p>ä¹‹å‰ä»‹ç»è¿‡ï¼ŒLIKEè¿ç®—ç¬¦ä¹Ÿå¯ä»¥åŒ¹é…æŒ‡å®šçš„å­—ç¬¦ä¸²ï¼Œä½†ä¸REGEXPä¸åŒï¼ŒLIKEåŒ¹é…çš„å­—ç¬¦ä¸²å¦‚æœåœ¨æ–‡æœ¬ä¸­é—´å‡ºç°ï¼Œåˆ™æ‰¾ä¸åˆ°å®ƒï¼Œç›¸åº”çš„è¡Œä¹Ÿä¸ä¼šè¿”å›ã€‚REGEXPåœ¨æ–‡æœ¬å†…è¿›è¡ŒåŒ¹é…ï¼Œå¦‚æœè¢«åŒ¹é…çš„å­—ç¬¦ä¸²åœ¨æ–‡æœ¬ä¸­å‡ºç°ï¼ŒREGEXPå°†ä¼šæ‰¾åˆ°å®ƒï¼Œç›¸åº”çš„è¡Œä¹Ÿä¼šè¢«è¿”å›ã€‚å¯¹æ¯”ç»“æœå¦‚ä¸‹æ‰€ç¤ºã€‚</p><p>åœ¨fruitsè¡¨ä¸­ï¼Œä½¿ç”¨LIKEè¿ç®—ç¬¦æŸ¥è¯¢f_nameå­—æ®µå€¼ä¸ºâ€œonâ€çš„è®°å½•ï¼ŒSQLè¯­å¥å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT * FROM fruits WHERE f_name like &#x27;on&#x27;;<br>Empty set(0.00 sec)<br></code></pre></td></tr></table></figure><p><strong>6. åŒ¹é…æŒ‡å®šå­—ç¬¦ä¸­çš„ä»»æ„ä¸€ä¸ª</strong><br>æ–¹æ‹¬å·â€œ[]â€æŒ‡å®šä¸€ä¸ªå­—ç¬¦é›†åˆï¼ŒåªåŒ¹é…å…¶ä¸­ä»»ä½•ä¸€ä¸ªå­—ç¬¦ï¼Œå³ä¸ºæ‰€æŸ¥æ‰¾çš„æ–‡æœ¬ã€‚</p><p>åœ¨fruitsè¡¨ä¸­ï¼ŒæŸ¥æ‰¾f_nameå­—æ®µä¸­åŒ…å«å­—æ¯â€˜oâ€™æˆ–è€…â€˜tâ€™çš„è®°å½•ï¼ŒSQLè¯­å¥å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT * FROM fruits WHERE f_name REGEXP &#x27;[ot]&#x27;;<br></code></pre></td></tr></table></figure><p>åœ¨fruitsè¡¨ä¸­ï¼ŒæŸ¥è¯¢s_idå­—æ®µä¸­åŒ…å«4ã€5æˆ–è€…6çš„è®°å½•ï¼ŒSQLè¯­å¥å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT * FROM fruits WHERE s_id REGEXP &#x27;[456]&#x27;;<br></code></pre></td></tr></table></figure><p><strong>7. åŒ¹é…æŒ‡å®šå­—ç¬¦ä»¥å¤–çš„å­—ç¬¦</strong><br><code>â€œ[^å­—ç¬¦é›†åˆ]â€</code>åŒ¹é…ä¸åœ¨æŒ‡å®šé›†åˆä¸­çš„ä»»ä½•å­—ç¬¦ã€‚</p><p>åœ¨fruitsè¡¨ä¸­ï¼ŒæŸ¥è¯¢f_idå­—æ®µä¸­åŒ…å«å­—æ¯a<del>eå’Œæ•°å­—1</del>2ä»¥å¤–å­—ç¬¦çš„è®°å½•ï¼ŒSQLè¯­å¥å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT * FROM fruits WHERE f_id REGEXP &#x27;[^a-e1-2]&#x27;;<br></code></pre></td></tr></table></figure><p><strong>8. ä½¿ç”¨{n,}æˆ–è€…{n,m}æ¥æŒ‡å®šå­—ç¬¦ä¸²è¿ç»­å‡ºç°çš„æ¬¡æ•°</strong><br>â€œå­—ç¬¦ä¸²{n,}â€è¡¨ç¤ºè‡³å°‘åŒ¹é…næ¬¡å‰é¢çš„å­—ç¬¦ï¼›â€œå­—ç¬¦ä¸²{n,m}â€è¡¨ç¤ºåŒ¹é…å‰é¢çš„å­—ç¬¦ä¸²ä¸å°‘äºnæ¬¡ï¼Œä¸å¤šäºmæ¬¡ã€‚ä¾‹å¦‚ï¼Œa{2,}è¡¨ç¤ºå­—æ¯aè¿ç»­å‡ºç°è‡³å°‘2æ¬¡ï¼Œä¹Ÿå¯ä»¥å¤§äº2æ¬¡ï¼›a{2,4}è¡¨ç¤ºå­—æ¯aè¿ç»­å‡ºç°æœ€å°‘2æ¬¡ï¼Œæœ€å¤šä¸èƒ½è¶…è¿‡4æ¬¡ã€‚</p><p>åœ¨fruitsè¡¨ä¸­ï¼ŒæŸ¥è¯¢f_nameå­—æ®µå€¼å‡ºç°å­—æ¯â€˜xâ€™è‡³å°‘2æ¬¡çš„è®°å½•ï¼ŒSQLè¯­å¥å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT * FROM fruits WHERE f_name REGEXP &#x27;x&#123;2,&#125;&#x27;;<br></code></pre></td></tr></table></figure><p>åœ¨fruitsè¡¨ä¸­ï¼ŒæŸ¥è¯¢f_nameå­—æ®µå€¼å‡ºç°å­—ç¬¦ä¸²â€œbaâ€æœ€å°‘1æ¬¡ã€æœ€å¤š3æ¬¡çš„è®°å½•ï¼ŒSQLè¯­å¥å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT * FROM fruits WHERE f_name REGEXP &#x27;ba&#123;1,3&#125;&#x27;;<br></code></pre></td></tr></table></figure><h1 id="ç¬¬05ç« -æ’åºä¸åˆ†é¡µ"><a href="#ç¬¬05ç« -æ’åºä¸åˆ†é¡µ" class="headerlink" title="ç¬¬05ç« _æ’åºä¸åˆ†é¡µ"></a>ç¬¬05ç« _æ’åºä¸åˆ†é¡µ</h1><h2 id="1-æ’åºæ•°æ®"><a href="#1-æ’åºæ•°æ®" class="headerlink" title="1. æ’åºæ•°æ®"></a>1. æ’åºæ•°æ®</h2><h3 id="1-1-æ’åºè§„åˆ™"><a href="#1-1-æ’åºè§„åˆ™" class="headerlink" title="1.1 æ’åºè§„åˆ™"></a>1.1 æ’åºè§„åˆ™</h3><ul><li>ä½¿ç”¨ ORDER BY å­å¥æ’åº<ul><li><strong>ASCï¼ˆascendï¼‰: å‡åº</strong>(é»˜è®¤å°±æ˜¯å‡åº)</li><li><strong>DESCï¼ˆdescendï¼‰:é™åº</strong></li></ul></li><li><strong>ORDER BY å­å¥åœ¨SELECTè¯­å¥çš„ç»“å°¾ã€‚</strong></li><li>å¦‚æœæ²¡æœ‰ä½¿ç”¨æ’åºæ“ä½œï¼Œé»˜è®¤æƒ…å†µæ˜¯æŒ‰ç…§æ·»åŠ çš„é¡ºåºæ˜¾ç¤ºã€‚</li><li>é»˜è®¤å°±æ˜¯å‡åºã€‚</li><li>ä¹Ÿå¯ä»¥ä½¿ç”¨åˆ—çš„åˆ«åè¿›è¡Œæ’åºï¼Œ<strong>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“ä½¿ç”¨åˆ«åæ’åºæ—¶ï¼Œä¸è¦ä½¿ç”¨â€œâ€å¼•èµ·åˆ«åï¼Œè¿™æ ·ä¼šä½¿æ¶ˆï¼Œå…·ä½“åŸå› æœªçŸ¥</strong>ã€‚</li><li>ä¹Ÿå¯ä»¥ä½¿ç”¨æ²¡æœ‰è¡¨ä¸­è¢«SELECTçš„å­—æ®µè¿›è¡Œæ’åº</li></ul><h3 id="1-2-å•åˆ—æ’åº"><a href="#1-2-å•åˆ—æ’åº" class="headerlink" title="1.2 å•åˆ—æ’åº"></a>1.2 å•åˆ—æ’åº</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT   last_name, job_id, department_id, hire_date<br>FROM     employees<br>ORDER BY hire_date ;<br></code></pre></td></tr></table></figure><p> <img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554974255957.png"></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554974827522.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT   last_name, job_id, department_id, hire_date<br>FROM     employees<br>ORDER BY hire_date DESC ;<br></code></pre></td></tr></table></figure><p> <img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554974822229.png"></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554974827522-20220325171314947.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT employee_id, last_name, salary*12 annsal<br>FROM   employees<br>ORDER BY annsal;<br></code></pre></td></tr></table></figure><p> <img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554974853194.png"></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554974827522-20220325171319229.png"></p><h3 id="1-3-å¤šåˆ—æ’åº"><a href="#1-3-å¤šåˆ—æ’åº" class="headerlink" title="1.3 å¤šåˆ—æ’åº"></a>1.3 å¤šåˆ—æ’åº</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT last_name, department_id, salary<br>FROM   employees<br>ORDER BY department_id, salary DESC;<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554974901572.png"></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554974827522-20220325171322924.png"></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql">#å…ˆæŒ‰ç…§department_idé™åºï¼Œåsalaryå‡åº<br><span class="hljs-keyword">SELECT</span> last_name, department_id, salary<br><span class="hljs-keyword">FROM</span>   employees<br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> department_id <span class="hljs-keyword">DESC</span>, salary <span class="hljs-keyword">ASC</span>;<br><br>#å…ˆæŒ‰ç…§salaryå‡åºï¼Œå†æŒ‰ç…§department_idé™åº<br><span class="hljs-keyword">SELECT</span> last_name, department_id, salary<br><span class="hljs-keyword">FROM</span>   employees<br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> salary <span class="hljs-keyword">ASC</span>, department_id <span class="hljs-keyword">DESC</span>;<br></code></pre></td></tr></table></figure><ul><li>å¯ä»¥ä½¿ç”¨ä¸åœ¨SELECTåˆ—è¡¨ä¸­çš„åˆ—æ’åºã€‚</li><li>åœ¨å¯¹å¤šåˆ—è¿›è¡Œæ’åºçš„æ—¶å€™ï¼Œé¦–å…ˆæ’åºçš„ç¬¬ä¸€åˆ—å¿…é¡»æœ‰ç›¸åŒçš„åˆ—å€¼ï¼Œæ‰ä¼šå¯¹ç¬¬äºŒåˆ—è¿›è¡Œæ’åºã€‚å¦‚æœç¬¬ä¸€åˆ—æ•°æ®ä¸­æ‰€æœ‰å€¼éƒ½æ˜¯å”¯ä¸€çš„ï¼Œå°†ä¸å†å¯¹ç¬¬äºŒåˆ—è¿›è¡Œæ’åºã€‚</li></ul><p>å³ä½¿ç”¨WHEREåˆä½¿ç”¨ORDER BYï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> employee_id, salary<br><span class="hljs-keyword">FROM</span> employees<br><span class="hljs-keyword">WHERE</span> department_id <span class="hljs-keyword">IN</span> (<span class="hljs-number">50</span>, <span class="hljs-number">60</span>, <span class="hljs-number">70</span>)<br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> department_id <span class="hljs-keyword">DESC</span>;<br></code></pre></td></tr></table></figure><h2 id="2-åˆ†é¡µ"><a href="#2-åˆ†é¡µ" class="headerlink" title="2. åˆ†é¡µ"></a>2. åˆ†é¡µ</h2><h3 id="2-1-èƒŒæ™¯"><a href="#2-1-èƒŒæ™¯" class="headerlink" title="2.1 èƒŒæ™¯"></a>2.1 èƒŒæ™¯</h3><p>èƒŒæ™¯1ï¼šæŸ¥è¯¢è¿”å›çš„è®°å½•å¤ªå¤šäº†ï¼ŒæŸ¥çœ‹èµ·æ¥å¾ˆä¸æ–¹ä¾¿ï¼Œæ€ä¹ˆæ ·èƒ½å¤Ÿå®ç°åˆ†é¡µæŸ¥è¯¢å‘¢ï¼Ÿ</p><p>èƒŒæ™¯2ï¼šè¡¨é‡Œæœ‰ 4 æ¡æ•°æ®ï¼Œæˆ‘ä»¬åªæƒ³è¦æ˜¾ç¤ºç¬¬ 2ã€3 æ¡æ•°æ®æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><h3 id="2-2-å®ç°è§„åˆ™"><a href="#2-2-å®ç°è§„åˆ™" class="headerlink" title="2.2 å®ç°è§„åˆ™"></a>2.2 å®ç°è§„åˆ™</h3><ul><li><p>åˆ†é¡µåŸç†</p><p>æ‰€è°“åˆ†é¡µæ˜¾ç¤ºï¼Œå°±æ˜¯å°†æ•°æ®åº“ä¸­çš„ç»“æœé›†ï¼Œä¸€æ®µä¸€æ®µæ˜¾ç¤ºå‡ºæ¥éœ€è¦çš„æ¡ä»¶ã€‚</p></li><li><p><strong>MySQLä¸­ä½¿ç”¨ LIMIT å®ç°åˆ†é¡µ</strong></p></li><li><p>æ ¼å¼ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">LIMIT [ä½ç½®åç§»é‡,] è¡Œæ•° #å¦‚æœä½ç½®åç§»é‡æ˜¯0ï¼Œå¯ä»¥çœç•¥ï¼Œå…¶ä»–å€¼ä¸å¯çœç•¥<br></code></pre></td></tr></table></figure><p>ç¬¬ä¸€ä¸ªâ€œä½ç½®åç§»é‡â€å‚æ•°æŒ‡ç¤ºMySQLä»å“ªä¸€è¡Œå¼€å§‹æ˜¾ç¤ºï¼Œæ˜¯ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œå¦‚æœä¸æŒ‡å®šâ€œä½ç½®åç§»é‡â€ï¼Œå°†ä¼šä»è¡¨ä¸­çš„ç¬¬ä¸€æ¡è®°å½•å¼€å§‹ï¼ˆç¬¬ä¸€æ¡è®°å½•çš„ä½ç½®åç§»é‡æ˜¯0ï¼Œç¬¬äºŒæ¡è®°å½•çš„ä½ç½®åç§»é‡æ˜¯1ï¼Œä»¥æ­¤ç±»æ¨ï¼‰ï¼›ç¬¬äºŒä¸ªå‚æ•°â€œè¡Œæ•°â€æŒ‡ç¤ºè¿”å›çš„è®°å½•æ¡æ•°ã€‚</p></li><li><p>ä¸¾ä¾‹</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs mysql">--å‰10æ¡è®°å½•ï¼š<br>SELECT * FROM è¡¨å LIMIT 0,10;<br>æˆ–è€…<br>SELECT * FROM è¡¨å LIMIT 10;<br><br>--ç¬¬11è‡³20æ¡è®°å½•ï¼š<br>SELECT * FROM è¡¨å LIMIT 10,10;<br><br>--ç¬¬21è‡³30æ¡è®°å½•ï¼š <br>SELECT * FROM è¡¨å LIMIT 20,10;<br></code></pre></td></tr></table></figure><blockquote><p>MySQL 8.0ä¸­å¯ä»¥ä½¿ç”¨â€œLIMIT 3 OFFSET 4â€ï¼Œæ„æ€æ˜¯è·å–ä»ç¬¬5æ¡è®°å½•å¼€å§‹åé¢çš„3æ¡è®°å½•ï¼Œå’Œâ€œLIMIT 4,3;â€è¿”å›çš„ç»“æœç›¸åŒã€‚</p></blockquote><ul><li>åˆ†é¡µæ˜¾å¼å…¬å¼<strong>ï¼šï¼ˆå½“å‰é¡µæ•°-1ï¼‰*æ¯é¡µæ¡æ•°ï¼Œæ¯é¡µæ¡æ•°</strong></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT * <br>FROM table <br>LIMIT (PageNo - 1) * PageSize, PageSize;<br></code></pre></td></tr></table></figure><ul><li><strong>æ³¨æ„ï¼šLIMIT å­å¥å¿…é¡»æ”¾åœ¨æ•´ä¸ªSELECTè¯­å¥çš„æœ€åï¼</strong></li><li>ä½¿ç”¨ LIMIT çš„å¥½å¤„</li></ul><p>çº¦æŸè¿”å›ç»“æœçš„æ•°é‡å¯ä»¥<code>å‡å°‘æ•°æ®è¡¨çš„ç½‘ç»œä¼ è¾“é‡</code>ï¼Œä¹Ÿå¯ä»¥<code>æå‡æŸ¥è¯¢æ•ˆç‡</code>ã€‚å¦‚æœæˆ‘ä»¬çŸ¥é“è¿”å›ç»“æœåªæœ‰ 1 æ¡ï¼Œå°±å¯ä»¥ä½¿ç”¨<code>LIMIT 1</code>ï¼Œå‘Šè¯‰ SELECT è¯­å¥åªéœ€è¦è¿”å›ä¸€æ¡è®°å½•å³å¯ã€‚è¿™æ ·çš„å¥½å¤„å°±æ˜¯ SELECT ä¸éœ€è¦æ‰«æå®Œæ•´çš„è¡¨ï¼Œåªéœ€è¦æ£€ç´¢åˆ°ä¸€æ¡ç¬¦åˆæ¡ä»¶çš„è®°å½•å³å¯è¿”å›ã€‚</p><h3 id="2-3-æ‹“å±•"><a href="#2-3-æ‹“å±•" class="headerlink" title="2.3 æ‹“å±•"></a>2.3 æ‹“å±•</h3><p>åœ¨ä¸åŒçš„ DBMS ä¸­ä½¿ç”¨çš„å…³é”®å­—å¯èƒ½ä¸åŒã€‚åœ¨ MySQLã€PostgreSQLã€MariaDB å’Œ SQLite ä¸­ä½¿ç”¨ LIMIT å…³é”®å­—ï¼Œè€Œä¸”éœ€è¦æ”¾åˆ° SELECT è¯­å¥çš„æœ€åé¢ã€‚</p><ul><li>å¦‚æœæ˜¯ SQL Server å’Œ Accessï¼Œéœ€è¦ä½¿ç”¨ <code>TOP</code> å…³é”®å­—ï¼Œæ¯”å¦‚ï¼š</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT TOP 5 name, hp_max FROM heros ORDER BY hp_max DESC<br></code></pre></td></tr></table></figure><ul><li>å¦‚æœæ˜¯ DB2ï¼Œä½¿ç”¨<code>FETCH FIRST 5 ROWS ONLY</code>è¿™æ ·çš„å…³é”®å­—ï¼š</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> name, hp_max <span class="hljs-keyword">FROM</span> heros <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> hp_max <span class="hljs-keyword">DESC</span> <span class="hljs-keyword">FETCH</span> <span class="hljs-keyword">FIRST</span> <span class="hljs-number">5</span> <span class="hljs-keyword">ROWS</span> <span class="hljs-keyword">ONLY</span><br></code></pre></td></tr></table></figure><ul><li>å¦‚æœæ˜¯ Oracleï¼Œä½ éœ€è¦åŸºäº <code>ROWNUM</code> (ä¼ªåˆ—)æ¥ç»Ÿè®¡è¡Œæ•°ï¼š</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT rownum,last_name,salary FROM employees WHERE rownum &lt; 5 ORDER BY salary DESC;<br></code></pre></td></tr></table></figure><p>éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œè¿™æ¡è¯­å¥æ˜¯å…ˆå–å‡ºæ¥å‰ 5 æ¡æ•°æ®è¡Œï¼Œç„¶åå†æŒ‰ç…§ hp_max ä»é«˜åˆ°ä½çš„é¡ºåºè¿›è¡Œæ’åºã€‚ä½†è¿™æ ·äº§ç”Ÿçš„ç»“æœå’Œä¸Šè¿°æ–¹æ³•çš„å¹¶ä¸ä¸€æ ·ã€‚æˆ‘ä¼šåœ¨åé¢è®²åˆ°å­æŸ¥è¯¢ï¼Œä½ å¯ä»¥ä½¿ç”¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT rownum, last_name,salary<br>FROM (<br>    SELECT last_name,salary<br>    FROM employees<br>    ORDER BY salary DESC)<br>WHERE rownum &lt; 10;<br></code></pre></td></tr></table></figure><p>å¾—åˆ°ä¸ä¸Šè¿°æ–¹æ³•ä¸€è‡´çš„ç»“æœã€‚</p><h1 id="ç¬¬06ç« -å¤šè¡¨æŸ¥è¯¢"><a href="#ç¬¬06ç« -å¤šè¡¨æŸ¥è¯¢" class="headerlink" title="ç¬¬06ç« _å¤šè¡¨æŸ¥è¯¢"></a>ç¬¬06ç« _å¤šè¡¨æŸ¥è¯¢</h1><p>å¤šè¡¨æŸ¥è¯¢ï¼Œä¹Ÿç§°ä¸ºå…³è”æŸ¥è¯¢ï¼ŒæŒ‡ä¸¤ä¸ªæˆ–æ›´å¤šä¸ªè¡¨ä¸€èµ·å®ŒæˆæŸ¥è¯¢æ“ä½œã€‚</p><p>å‰ææ¡ä»¶ï¼šè¿™äº›ä¸€èµ·æŸ¥è¯¢çš„è¡¨ä¹‹é—´æ˜¯æœ‰å…³ç³»çš„ï¼ˆä¸€å¯¹ä¸€ã€ä¸€å¯¹å¤šï¼‰ï¼Œå®ƒä»¬ä¹‹é—´ä¸€å®šæ˜¯æœ‰å…³è”å­—æ®µï¼Œè¿™ä¸ªå…³è”å­—æ®µå¯èƒ½å»ºç«‹äº†å¤–é”®ï¼Œä¹Ÿå¯èƒ½æ²¡æœ‰å»ºç«‹å¤–é”®ã€‚æ¯”å¦‚ï¼šå‘˜å·¥è¡¨å’Œéƒ¨é—¨è¡¨ï¼Œè¿™ä¸¤ä¸ªè¡¨ä¾é â€œéƒ¨é—¨ç¼–å·â€è¿›è¡Œå…³è”ã€‚</p><h2 id="1-ä¸€ä¸ªæ¡ˆä¾‹å¼•å‘çš„å¤šè¡¨è¿æ¥"><a href="#1-ä¸€ä¸ªæ¡ˆä¾‹å¼•å‘çš„å¤šè¡¨è¿æ¥" class="headerlink" title="1. ä¸€ä¸ªæ¡ˆä¾‹å¼•å‘çš„å¤šè¡¨è¿æ¥"></a>1. ä¸€ä¸ªæ¡ˆä¾‹å¼•å‘çš„å¤šè¡¨è¿æ¥</h2><h3 id="1-1-æ¡ˆä¾‹è¯´æ˜"><a href="#1-1-æ¡ˆä¾‹è¯´æ˜" class="headerlink" title="1.1 æ¡ˆä¾‹è¯´æ˜"></a>1.1 æ¡ˆä¾‹è¯´æ˜</h3><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554974984600.png"></p><p>å…³äºä¸ºä»€ä¹ˆè¦æ‹†åˆ†æˆå¤šä¸ªè¡¨ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå¤§è¡¨ï¼Ÿ</p><ol><li>å‡å°‘æ•°æ®å†—ä½™</li><li>å‡å°‘ioæ¬¡æ•°ï¼Œä¸€ä¸ªè¡¨å­—æ®µè¶Šå¤šï¼Œä¸€æ¬¡ioåŠ è½½çš„æ¡æ•°è¶Šå°‘ï¼Œioé€Ÿåº¦æ…¢ï¼Œå¾ˆå½±å“æ•ˆç‡ã€‚</li><li>è®¾è®¡æˆå¤šä¸ªè¡¨ï¼Œå¯ä»¥å¤šä¸ªäº‹åŠ¡åŒæ—¶è¯»å†™ï¼Œè‹¥æ˜¯ä¸€ä¸ªè¡¨ç”±äºé”çš„å­˜åœ¨åªèƒ½æ¯æ¬¡åªèƒ½ä¸€ä¸ªäº‹åŠ¡è¯»å†™</li><li>å¤§è¡¨ç»´æŠ¤çš„æ—¶å€™ä¹Ÿå¾ˆå¤æ‚</li></ol><p>ä»å¤šä¸ªè¡¨ä¸­è·å–æ•°æ®ï¼š</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554975020388.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#æ¡ˆä¾‹ï¼šæŸ¥è¯¢å‘˜å·¥çš„å§“ååŠå…¶éƒ¨é—¨åç§°<br>SELECT last_name, department_name<br>FROM employees, departments;<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554975097631.png"></p><p>æŸ¥è¯¢ç»“æœï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs mysql">+-----------+----------------------+<br>| last_name | department_name      |<br>+-----------+----------------------+<br>| King      | Administration       |<br>| King      | Marketing            |<br>| King      | Purchasing           |<br>| King      | Human Resources      |<br>| King      | Shipping             |<br>| King      | IT                   |<br>| King      | Public Relations     |<br>| King      | Sales                |<br>| King      | Executive            |<br>| King      | Finance              |<br>| King      | Accounting           |<br>| King      | Treasury             |<br>...<br>| Gietz     | IT Support           |<br>| Gietz     | NOC                  |<br>| Gietz     | IT Helpdesk          |<br>| Gietz     | Government Sales     |<br>| Gietz     | Retail Sales         |<br>| Gietz     | Recruiting           |<br>| Gietz     | Payroll              |<br>+-----------+----------------------+<br>2889 rows in set (0.01 sec)<br></code></pre></td></tr></table></figure><p><strong>åˆ†æé”™è¯¯æƒ…å†µï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT COUNT(employee_id) FROM employees;<br>#è¾“å‡º107è¡Œ<br><br>SELECT COUNT(department_id)FROM departments;<br>#è¾“å‡º27è¡Œ<br><br>SELECT 107*27 FROM dual;<br>#æ¯ä¸ªå‘˜å·¥å’Œæ¯ä¸ªå…¬å¸éƒ½åŒ¹é…äº†ä¸€æ¬¡<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬æŠŠä¸Šè¿°å¤šè¡¨æŸ¥è¯¢ä¸­å‡ºç°çš„é—®é¢˜ç§°ä¸ºï¼šç¬›å¡å°”ç§¯çš„é”™è¯¯ã€‚</p><h3 id="1-2-ç¬›å¡å°”ç§¯ï¼ˆæˆ–äº¤å‰è¿æ¥ï¼‰çš„ç†è§£"><a href="#1-2-ç¬›å¡å°”ç§¯ï¼ˆæˆ–äº¤å‰è¿æ¥ï¼‰çš„ç†è§£" class="headerlink" title="1.2 ç¬›å¡å°”ç§¯ï¼ˆæˆ–äº¤å‰è¿æ¥ï¼‰çš„ç†è§£"></a>1.2 ç¬›å¡å°”ç§¯ï¼ˆæˆ–äº¤å‰è¿æ¥ï¼‰çš„ç†è§£</h3><p>ç¬›å¡å°”ä¹˜ç§¯æ˜¯ä¸€ä¸ªæ•°å­¦è¿ç®—ã€‚å‡è®¾æˆ‘æœ‰ä¸¤ä¸ªé›†åˆ X å’Œ Yï¼Œé‚£ä¹ˆ X å’Œ Y çš„ç¬›å¡å°”ç§¯å°±æ˜¯ X å’Œ Y çš„æ‰€æœ‰å¯èƒ½ç»„åˆï¼Œä¹Ÿå°±æ˜¯ç¬¬ä¸€ä¸ªå¯¹è±¡æ¥è‡ªäº Xï¼Œç¬¬äºŒä¸ªå¯¹è±¡æ¥è‡ªäº Y çš„æ‰€æœ‰å¯èƒ½ã€‚ç»„åˆçš„ä¸ªæ•°å³ä¸ºä¸¤ä¸ªé›†åˆä¸­å…ƒç´ ä¸ªæ•°çš„ä¹˜ç§¯æ•°ã€‚</p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/302046364841977.jpg" alt="" style="zoom:80%;" /><p>SQL92ä¸­ï¼Œç¬›å¡å°”ç§¯ä¹Ÿç§°ä¸º<code>äº¤å‰è¿æ¥</code>ï¼Œè‹±æ–‡æ˜¯ <code>CROSS JOIN</code>ã€‚åœ¨ SQL99 ä¸­ä¹Ÿæ˜¯ä½¿ç”¨ CROSS JOINè¡¨ç¤ºäº¤å‰è¿æ¥ã€‚å®ƒçš„ä½œç”¨å°±æ˜¯å¯ä»¥æŠŠä»»æ„è¡¨è¿›è¡Œè¿æ¥ï¼Œå³ä½¿è¿™ä¸¤å¼ è¡¨ä¸ç›¸å…³ã€‚åœ¨MySQLä¸­å¦‚ä¸‹æƒ…å†µä¼šå‡ºç°ç¬›å¡å°”ç§¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#æŸ¥è¯¢å‘˜å·¥å§“åå’Œæ‰€åœ¨éƒ¨é—¨åç§°<br>SELECT last_name,department_name FROM employees,departments;<br>SELECT last_name,department_name FROM employees CROSS JOIN departments;<br>SELECT last_name,department_name FROM employees INNER JOIN departments;<br>SELECT last_name,department_name FROM employees JOIN departments;<br></code></pre></td></tr></table></figure><h3 id="1-3-æ¡ˆä¾‹åˆ†æä¸é—®é¢˜è§£å†³"><a href="#1-3-æ¡ˆä¾‹åˆ†æä¸é—®é¢˜è§£å†³" class="headerlink" title="1.3 æ¡ˆä¾‹åˆ†æä¸é—®é¢˜è§£å†³"></a>1.3 æ¡ˆä¾‹åˆ†æä¸é—®é¢˜è§£å†³</h3><ul><li><p><strong>ç¬›å¡å°”ç§¯çš„é”™è¯¯ä¼šåœ¨ä¸‹é¢æ¡ä»¶ä¸‹äº§ç”Ÿ</strong>ï¼š</p><ul><li>çœç•¥å¤šä¸ªè¡¨çš„è¿æ¥æ¡ä»¶ï¼ˆæˆ–å…³è”æ¡ä»¶ï¼‰</li><li>è¿æ¥æ¡ä»¶ï¼ˆæˆ–å…³è”æ¡ä»¶ï¼‰æ— æ•ˆ</li><li>æ‰€æœ‰è¡¨ä¸­çš„æ‰€æœ‰è¡Œäº’ç›¸è¿æ¥</li></ul></li><li><p>ä¸ºäº†é¿å…ç¬›å¡å°”ç§¯ï¼Œ å¯ä»¥<strong>åœ¨ WHERE åŠ å…¥æœ‰æ•ˆçš„è¿æ¥æ¡ä»¶ã€‚</strong></p></li><li><p>åŠ å…¥è¿æ¥æ¡ä»¶åï¼ŒæŸ¥è¯¢è¯­æ³•ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECTtable1.column, table2.column<br>FROMtable1, table2<br>WHEREtable1.column1 = table2.column2;  #è¿æ¥æ¡ä»¶<br></code></pre></td></tr></table></figure><ul><li><strong>åœ¨ WHEREå­å¥ä¸­å†™å…¥è¿æ¥æ¡ä»¶ã€‚</strong></li></ul></li><li><p>æ­£ç¡®å†™æ³•ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#æ¡ˆä¾‹ï¼šæŸ¥è¯¢å‘˜å·¥çš„å§“ååŠå…¶éƒ¨é—¨åç§°<br>SELECT last_name, department_name<br>FROM employees, departments<br>WHERE employees.department_id = departments.department_id;<br></code></pre></td></tr></table></figure></li><li><p><strong>åœ¨è¡¨ä¸­æœ‰ç›¸åŒåˆ—æ—¶ï¼Œåœ¨åˆ—åä¹‹å‰åŠ ä¸Šè¡¨åå‰ç¼€ã€‚</strong>å¹¶ä¸”ï¼Œä»sqlä¼˜åŒ–çš„è§’åº¦ï¼Œå»ºè®®å¤šè¡¨æŸ¥è¯¢æ—¶ï¼Œæ¯ä¸ªå­—æ®µå‰éƒ½æŒ‡æ˜å…¶æ‰€åœ¨çš„è¡¨ï¼ˆå‡å»æŸ¥æ‰¾çš„æ—¶é—´ï¼‰ã€‚</p></li></ul><h2 id="2-å¤šè¡¨æŸ¥è¯¢åˆ†ç±»è®²è§£"><a href="#2-å¤šè¡¨æŸ¥è¯¢åˆ†ç±»è®²è§£" class="headerlink" title="2. å¤šè¡¨æŸ¥è¯¢åˆ†ç±»è®²è§£"></a>2. å¤šè¡¨æŸ¥è¯¢åˆ†ç±»è®²è§£</h2><h3 id="åˆ†ç±»1ï¼šç­‰å€¼è¿æ¥-vs-éç­‰å€¼è¿æ¥"><a href="#åˆ†ç±»1ï¼šç­‰å€¼è¿æ¥-vs-éç­‰å€¼è¿æ¥" class="headerlink" title="åˆ†ç±»1ï¼šç­‰å€¼è¿æ¥ vs éç­‰å€¼è¿æ¥"></a>åˆ†ç±»1ï¼šç­‰å€¼è¿æ¥ vs éç­‰å€¼è¿æ¥</h3><h4 id="ç­‰å€¼è¿æ¥"><a href="#ç­‰å€¼è¿æ¥" class="headerlink" title="ç­‰å€¼è¿æ¥"></a>ç­‰å€¼è¿æ¥</h4><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554975496900.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT employees.employee_id, employees.last_name, <br>       employees.department_id, departments.department_id,<br>       departments.location_id<br>FROM   employees, departments<br>WHERE  employees.department_id = departments.department_id;<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554975522600.png"></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554975526339.png"></p><p><strong>æ‹“å±•1ï¼šå¤šä¸ªè¿æ¥æ¡ä»¶ä¸ AND æ“ä½œç¬¦</strong> </p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554975606231.png"></p><p><strong>æ‹“å±•2ï¼šåŒºåˆ†é‡å¤çš„åˆ—å</strong></p><ul><li><strong>å¤šä¸ªè¡¨ä¸­æœ‰ç›¸åŒåˆ—æ—¶ï¼Œå¿…é¡»åœ¨åˆ—åä¹‹å‰åŠ ä¸Šè¡¨åå‰ç¼€ã€‚</strong>å¹¶ä¸”ï¼Œä»sqlä¼˜åŒ–çš„è§’åº¦ï¼Œå»ºè®®å¤šè¡¨æŸ¥è¯¢æ—¶ï¼Œæ¯ä¸ªå­—æ®µå‰éƒ½æŒ‡æ˜å…¶æ‰€åœ¨çš„è¡¨ï¼ˆå‡å»æŸ¥æ‰¾çš„æ—¶é—´ï¼‰ã€‚</li><li>åœ¨ä¸åŒè¡¨ä¸­å…·æœ‰ç›¸åŒåˆ—åçš„åˆ—å¯ä»¥ç”¨<code>è¡¨å</code>åŠ ä»¥åŒºåˆ†ã€‚</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT employees.last_name, departments.department_name,employees.department_id<br>FROM employees, departments<br>WHERE employees.department_id = departments.department_id;<br></code></pre></td></tr></table></figure><p><strong>æ‹“å±•3ï¼šè¡¨çš„åˆ«å</strong></p><ul><li><p>ä½¿ç”¨åˆ«åå¯ä»¥ç®€åŒ–æŸ¥è¯¢ã€‚</p></li><li><p>åˆ—åå‰ä½¿ç”¨è¡¨åå‰ç¼€å¯ä»¥æé«˜æŸ¥è¯¢æ•ˆç‡ã€‚</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT e.employee_id, e.last_name, e.department_id,<br>       d.department_id, d.location_id<br>FROM   employees e , departments d<br>WHERE  e.department_id = d.department_id;<br></code></pre></td></tr></table></figure><blockquote><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨äº†è¡¨çš„åˆ«åï¼Œåœ¨æŸ¥è¯¢å­—æ®µä¸­ã€è¿‡æ»¤æ¡ä»¶ä¸­å°±åªèƒ½ä½¿ç”¨åˆ«åè¿›è¡Œä»£æ›¿ï¼Œä¸èƒ½ä½¿ç”¨åŸæœ‰çš„è¡¨åï¼Œå¦åˆ™å°±ä¼šæŠ¥é”™ã€‚</p></blockquote><blockquote><p><code>é˜¿é‡Œå¼€å‘è§„èŒƒ</code>ï¼š</p><p>ã€<code>å¼ºåˆ¶</code>ã€‘å¯¹äºæ•°æ®åº“ä¸­è¡¨è®°å½•çš„æŸ¥è¯¢å’Œå˜æ›´ï¼Œåªè¦æ¶‰åŠå¤šä¸ªè¡¨ï¼Œéƒ½éœ€è¦åœ¨åˆ—åå‰åŠ è¡¨çš„åˆ«åï¼ˆæˆ– è¡¨åï¼‰è¿›è¡Œé™å®šã€‚ </p><p><code>è¯´æ˜</code>ï¼šå¯¹å¤šè¡¨è¿›è¡ŒæŸ¥è¯¢è®°å½•ã€æ›´æ–°è®°å½•ã€åˆ é™¤è®°å½•æ—¶ï¼Œå¦‚æœå¯¹æ“ä½œåˆ—æ²¡æœ‰é™å®šè¡¨çš„åˆ«åï¼ˆæˆ–è¡¨åï¼‰ï¼Œå¹¶ä¸”æ“ä½œåˆ—åœ¨å¤šä¸ªè¡¨ä¸­å­˜åœ¨æ—¶ï¼Œå°±ä¼šæŠ›å¼‚å¸¸ã€‚ </p><p><code>æ­£ä¾‹</code>ï¼šselect t1.name from table_first as t1 , table_second as t2 where t1.id=t2.id; </p><p><code>åä¾‹</code>ï¼šåœ¨æŸä¸šåŠ¡ä¸­ï¼Œç”±äºå¤šè¡¨å…³è”æŸ¥è¯¢è¯­å¥æ²¡æœ‰åŠ è¡¨çš„åˆ«åï¼ˆæˆ–è¡¨åï¼‰çš„é™åˆ¶ï¼Œæ­£å¸¸è¿è¡Œä¸¤å¹´åï¼Œæœ€è¿‘åœ¨ æŸä¸ªè¡¨ä¸­å¢åŠ ä¸€ä¸ªåŒåå­—æ®µï¼Œåœ¨é¢„å‘å¸ƒç¯å¢ƒåšæ•°æ®åº“å˜æ›´åï¼Œçº¿ä¸ŠæŸ¥è¯¢è¯­å¥å‡ºç°å‡º 1052 å¼‚å¸¸ï¼šColumn  â€˜nameâ€™ in field list is ambiguousã€‚</p></blockquote><p><strong>æ‹“å±•4ï¼šè¿æ¥å¤šä¸ªè¡¨</strong></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554978354431.png"></p><p><strong>æ€»ç»“ï¼šè¿æ¥ nä¸ªè¡¨,è‡³å°‘éœ€è¦n-1ä¸ªè¿æ¥æ¡ä»¶ã€‚</strong>æ¯”å¦‚ï¼Œè¿æ¥ä¸‰ä¸ªè¡¨ï¼Œè‡³å°‘éœ€è¦ä¸¤ä¸ªè¿æ¥æ¡ä»¶ã€‚</p><p>ç»ƒä¹ ï¼šæŸ¥è¯¢å‡ºå…¬å¸å‘˜å·¥çš„ last_name,department_name, city</p><h4 id="éç­‰å€¼è¿æ¥"><a href="#éç­‰å€¼è¿æ¥" class="headerlink" title="éç­‰å€¼è¿æ¥"></a>éç­‰å€¼è¿æ¥</h4><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554978442447.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT e.last_name, e.salary, j.grade_level<br>FROM   employees e, job_grades j<br>WHERE  e.salary BETWEEN j.lowest_sal AND j.highest_sal;<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554978477013.png"></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554978482652.png"></p><h3 id="åˆ†ç±»2ï¼šè‡ªè¿æ¥-vs-éè‡ªè¿æ¥"><a href="#åˆ†ç±»2ï¼šè‡ªè¿æ¥-vs-éè‡ªè¿æ¥" class="headerlink" title="åˆ†ç±»2ï¼šè‡ªè¿æ¥ vs éè‡ªè¿æ¥"></a>åˆ†ç±»2ï¼šè‡ªè¿æ¥ vs éè‡ªè¿æ¥</h3><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554978514321.png"></p><ul><li>å½“table1å’Œtable2æœ¬è´¨ä¸Šæ˜¯åŒä¸€å¼ è¡¨ï¼Œåªæ˜¯ç”¨å–åˆ«åçš„æ–¹å¼è™šæ‹Ÿæˆä¸¤å¼ è¡¨ä»¥ä»£è¡¨ä¸åŒçš„æ„ä¹‰ã€‚ç„¶åä¸¤ä¸ªè¡¨å†è¿›è¡Œå†…è¿æ¥ï¼Œå¤–è¿æ¥ç­‰æŸ¥è¯¢ã€‚</li></ul><p><strong>é¢˜ç›®ï¼šæŸ¥è¯¢employeesè¡¨ï¼Œè¿”å›â€œXxx  works for Xxxâ€</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT CONCAT(worker.last_name ,&#x27; works for &#x27; <br>       , manager.last_name)<br>FROM   employees worker, employees manager<br>WHERE  worker.manager_id = manager.employee_id ;<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554978684947.png"></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554978690764.png">ç»ƒä¹ ï¼šæŸ¥è¯¢å‡ºlast_nameä¸º â€˜Chenâ€™ çš„å‘˜å·¥çš„ manager çš„ä¿¡æ¯ã€‚</p><h3 id="åˆ†ç±»3ï¼šå†…è¿æ¥-vs-å¤–è¿æ¥"><a href="#åˆ†ç±»3ï¼šå†…è¿æ¥-vs-å¤–è¿æ¥" class="headerlink" title="åˆ†ç±»3ï¼šå†…è¿æ¥ vs å¤–è¿æ¥"></a>åˆ†ç±»3ï¼šå†…è¿æ¥ vs å¤–è¿æ¥</h3><p>é™¤äº†æŸ¥è¯¢æ»¡è¶³æ¡ä»¶çš„è®°å½•ä»¥å¤–ï¼Œå¤–è¿æ¥è¿˜å¯ä»¥æŸ¥è¯¢æŸä¸€æ–¹ä¸æ»¡è¶³æ¡ä»¶çš„è®°å½•ã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554978955659.png"></p><ul><li><p>å†…è¿æ¥: åˆå¹¶å…·æœ‰åŒä¸€åˆ—çš„ä¸¤ä¸ªä»¥ä¸Šçš„è¡¨çš„è¡Œ, <strong>ç»“æœé›†ä¸­ä¸åŒ…å«ä¸€ä¸ªè¡¨ä¸å¦ä¸€ä¸ªè¡¨ä¸åŒ¹é…çš„è¡Œ</strong></p></li><li><p>å¤–è¿æ¥: ä¸¤ä¸ªè¡¨åœ¨è¿æ¥è¿‡ç¨‹ä¸­é™¤äº†è¿”å›æ»¡è¶³è¿æ¥æ¡ä»¶çš„è¡Œä»¥å¤–<strong>è¿˜è¿”å›å·¦ï¼ˆæˆ–å³ï¼‰è¡¨ä¸­ä¸æ»¡è¶³æ¡ä»¶çš„è¡Œ</strong> <strong>ï¼Œè¿™ç§è¿æ¥ç§°ä¸ºå·¦ï¼ˆæˆ–å³ï¼‰ å¤–è¿æ¥</strong>ã€‚æ²¡æœ‰åŒ¹é…çš„è¡Œæ—¶, ç»“æœè¡¨ä¸­ç›¸åº”çš„åˆ—ä¸ºç©º(NULL)ã€‚è‹¥æ˜¯é™¤äº†è¿”å›æ»¡è¶³è¿æ¥æ¡ä»¶çš„è¡Œä»¥å¤–ï¼Œå³è¿”å›äº†å·¦è¡¨ä¸­ä¸æ»¡è¶³æ¡ä»¶çš„è¡ŒåŒæ—¶ä¹Ÿè¿”å›äº†å³è¡¨ä¸­ä¸æ»¡è¶³æ¡ä»¶çš„è¡Œï¼Œç§°ä¸ºæ»¡å¤–è¿æ¥ã€‚</p></li><li><p>å¦‚æœæ˜¯å·¦å¤–è¿æ¥ï¼Œåˆ™è¿æ¥æ¡ä»¶ä¸­å·¦è¾¹çš„è¡¨ä¹Ÿç§°ä¸º<code>ä¸»è¡¨</code>ï¼Œå³è¾¹çš„è¡¨ç§°ä¸º<code>ä»è¡¨</code>ã€‚</p><p>å¦‚æœæ˜¯å³å¤–è¿æ¥ï¼Œåˆ™è¿æ¥æ¡ä»¶ä¸­å³è¾¹çš„è¡¨ä¹Ÿç§°ä¸º<code>ä¸»è¡¨</code>ï¼Œå·¦è¾¹çš„è¡¨ç§°ä¸º<code>ä»è¡¨</code>ã€‚</p></li></ul><h4 id="SQL92ï¼šä½¿ç”¨-åˆ›å»ºè¿æ¥"><a href="#SQL92ï¼šä½¿ç”¨-åˆ›å»ºè¿æ¥" class="headerlink" title="SQL92ï¼šä½¿ç”¨(+)åˆ›å»ºè¿æ¥"></a>SQL92ï¼šä½¿ç”¨(+)åˆ›å»ºè¿æ¥</h4><ul><li><p>åœ¨ SQL92 ä¸­é‡‡ç”¨ï¼ˆ+ï¼‰ä»£è¡¨ä»è¡¨æ‰€åœ¨çš„ä½ç½®ã€‚å³å·¦æˆ–å³å¤–è¿æ¥ä¸­ï¼Œ(+) è¡¨ç¤ºå“ªä¸ªæ˜¯ä»è¡¨ã€‚ï¼ˆå› ä¸ºä»è¡¨åœ¨é€»è¾‘ä¸Šç›¸å½“äºåŠ ä¸Šäº†ä¸€äº›NULLå€¼ï¼‰</p></li><li><p>Oracle å¯¹ SQL92 æ”¯æŒè¾ƒå¥½ï¼Œè€Œ <strong>MySQL åˆ™ä¸æ”¯æŒ SQL92 çš„å¤–è¿æ¥</strong>ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs mysql">æŸ¥è¯¢æ‰€æœ‰å‘˜å·¥çš„å§“åä»¥åŠä»–çš„éƒ¨é—¨<br>#å·¦å¤–è¿æ¥<br>SELECT last_name,department_name<br>FROM employees ,departments<br>WHERE employees.department_id = departments.department_id(+);<br><br>æŸ¥è¯¢æ‰€æœ‰éƒ¨é—¨çš„å‘˜å·¥å§“åä»¥åŠéƒ¨é—¨åç§°<br>#å³å¤–è¿æ¥<br>SELECT last_name,department_name<br>FROM employees ,departments<br>WHERE employees.department_id(+) = departments.department_id;<br></code></pre></td></tr></table></figure></li><li><p>è€Œä¸”åœ¨ SQL92 ä¸­ï¼Œåªæœ‰å·¦å¤–è¿æ¥å’Œå³å¤–è¿æ¥ï¼Œæ²¡æœ‰æ»¡ï¼ˆæˆ–å…¨ï¼‰å¤–è¿æ¥ã€‚</p></li></ul><h2 id="3-SQL99è¯­æ³•å®ç°å¤šè¡¨æŸ¥è¯¢"><a href="#3-SQL99è¯­æ³•å®ç°å¤šè¡¨æŸ¥è¯¢" class="headerlink" title="3. SQL99è¯­æ³•å®ç°å¤šè¡¨æŸ¥è¯¢"></a>3. SQL99è¯­æ³•å®ç°å¤šè¡¨æŸ¥è¯¢</h2><h3 id="3-1-åŸºæœ¬è¯­æ³•"><a href="#3-1-åŸºæœ¬è¯­æ³•" class="headerlink" title="3.1 åŸºæœ¬è¯­æ³•"></a>3.1 åŸºæœ¬è¯­æ³•</h3><ul><li><p>ä½¿ç”¨JOINâ€¦ONå­å¥åˆ›å»ºè¿æ¥çš„è¯­æ³•ç»“æ„ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT table1.column, table2.column,table3.column<br>FROM table1<br>    JOIN table2 ON table1 å’Œ table2 çš„è¿æ¥æ¡ä»¶<br>        JOIN table3 ON table2 å’Œ table3 çš„è¿æ¥æ¡ä»¶<br></code></pre></td></tr></table></figure><p>å®ƒçš„åµŒå¥—é€»è¾‘ç±»ä¼¼æˆ‘ä»¬ä½¿ç”¨çš„ FOR å¾ªç¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs mysql">for t1 in table1:<br>    for t2 in table2:<br>       if condition1:<br>           for t3 in table3:<br>              if condition2:<br>                  output t1 + t2 + t3<br></code></pre></td></tr></table></figure><p>SQL99 é‡‡ç”¨çš„è¿™ç§åµŒå¥—ç»“æ„éå¸¸æ¸…çˆ½ã€å±‚æ¬¡æ€§æ›´å¼ºã€å¯è¯»æ€§æ›´å¼ºï¼Œå³ä½¿å†å¤šçš„è¡¨è¿›è¡Œè¿æ¥ä¹Ÿéƒ½æ¸…æ™°å¯è§ã€‚å¦‚æœä½ é‡‡ç”¨ SQL92ï¼Œå¯è¯»æ€§å°±ä¼šå¤§æ‰“æŠ˜æ‰£ã€‚</p></li><li><p>è¯­æ³•è¯´æ˜ï¼š</p><ul><li><strong>å¯ä»¥ä½¿ç”¨</strong> <strong>ON</strong> <strong>å­å¥æŒ‡å®šé¢å¤–çš„è¿æ¥æ¡ä»¶</strong>ã€‚</li><li>è¿™ä¸ªè¿æ¥æ¡ä»¶æ˜¯ä¸å…¶å®ƒæ¡ä»¶åˆ†å¼€çš„ã€‚</li><li><strong>ON</strong> <strong>å­å¥ä½¿è¯­å¥å…·æœ‰æ›´é«˜çš„æ˜“è¯»æ€§</strong>ã€‚</li><li>å…³é”®å­— JOINã€INNER JOINã€CROSS JOIN çš„å«ä¹‰æ˜¯ä¸€æ ·çš„ï¼Œéƒ½è¡¨ç¤ºå†…è¿æ¥</li></ul></li></ul><h3 id="3-2-å†…è¿æ¥-INNER-JOIN-çš„å®ç°"><a href="#3-2-å†…è¿æ¥-INNER-JOIN-çš„å®ç°" class="headerlink" title="3.2 å†…è¿æ¥(INNER JOIN)çš„å®ç°"></a>3.2 å†…è¿æ¥(INNER JOIN)çš„å®ç°</h3><ul><li>è¯­æ³•ï¼š</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT å­—æ®µåˆ—è¡¨<br>FROM Aè¡¨ INNER JOIN Bè¡¨ #INNERå¯ä»¥çœç•¥<br>ON å…³è”æ¡ä»¶<br>WHERE ç­‰å…¶ä»–å­å¥;<br></code></pre></td></tr></table></figure><p>é¢˜ç›®1ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT e.employee_id, e.last_name, e.department_id, <br>       d.department_id, d.location_id<br>FROM   employees e JOIN departments d<br>ON     (e.department_id = d.department_id);<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554979073996.png"></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554978690764-20220325171607085.png"></p><p>é¢˜ç›®2ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT employee_id, city, department_name<br>FROM   employees e <br>JOIN   departments d<br>ON     d.department_id = e.department_id <br>JOIN   locations l<br>ON     d.location_id = l.location_id;<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554979110008.png"></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554978690764-20220325171615834.png"></p><h3 id="3-3-å¤–è¿æ¥-OUTER-JOIN-çš„å®ç°"><a href="#3-3-å¤–è¿æ¥-OUTER-JOIN-çš„å®ç°" class="headerlink" title="3.3 å¤–è¿æ¥(OUTER JOIN)çš„å®ç°"></a>3.3 å¤–è¿æ¥(OUTER JOIN)çš„å®ç°</h3><p><strong>å½“é¢˜ç›®ä¸­å‡ºç°æ¯ä¸ªï¼Œæ‰€æœ‰ç­‰é™å®šè¯æ—¶ï¼Œéœ€è¦è€ƒè™‘æ˜¯ä¸æ˜¯å·¦å¤–è¿æ¥å³å¤–è¿æ¥ï¼Œç”šè‡³æ»¡å¤–è¿æ¥</strong></p><h4 id="3-3-1-å·¦å¤–è¿æ¥-LEFT-OUTER-JOIN"><a href="#3-3-1-å·¦å¤–è¿æ¥-LEFT-OUTER-JOIN" class="headerlink" title="3.3.1 å·¦å¤–è¿æ¥(LEFT OUTER JOIN)"></a>3.3.1 å·¦å¤–è¿æ¥(LEFT OUTER JOIN)</h4><ul><li>è¯­æ³•ï¼š</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#å®ç°æŸ¥è¯¢ç»“æœæ˜¯A<br>SELECT å­—æ®µåˆ—è¡¨<br>FROM Aè¡¨ LEFT JOIN Bè¡¨ #LEFTå¯ä»¥çœç•¥<br>ON å…³è”æ¡ä»¶<br>WHERE ç­‰å…¶ä»–å­å¥;<br></code></pre></td></tr></table></figure><ul><li>ä¸¾ä¾‹ï¼š</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT e.last_name, e.department_id, d.department_name<br>FROM   employees e<br>LEFT OUTER JOIN departments d<br>ON   (e.department_id = d.department_id) ;<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554979200961.png"></p><h4 id="3-3-2-å³å¤–è¿æ¥-RIGHT-OUTER-JOIN"><a href="#3-3-2-å³å¤–è¿æ¥-RIGHT-OUTER-JOIN" class="headerlink" title="3.3.2 å³å¤–è¿æ¥(RIGHT OUTER JOIN)"></a>3.3.2 å³å¤–è¿æ¥(RIGHT OUTER JOIN)</h4><ul><li>è¯­æ³•ï¼š</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#å®ç°æŸ¥è¯¢ç»“æœæ˜¯B<br>SELECT å­—æ®µåˆ—è¡¨<br>FROM Aè¡¨ RIGHT JOIN Bè¡¨ #OUTERå¯ä»¥çœç•¥<br>ON å…³è”æ¡ä»¶<br>WHERE ç­‰å…¶ä»–å­å¥;<br></code></pre></td></tr></table></figure><ul><li>ä¸¾ä¾‹ï¼š</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT e.last_name, e.department_id, d.department_name<br>FROM   employees e<br>RIGHT OUTER JOIN departments d<br>ON    (e.department_id = d.department_id) ;<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554979243194.png"></p><blockquote><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒLEFT JOIN å’Œ RIGHT JOIN åªå­˜åœ¨äº SQL99 åŠä»¥åçš„æ ‡å‡†ä¸­ï¼Œåœ¨ SQL92 ä¸­ä¸å­˜åœ¨ï¼Œåªèƒ½ç”¨ (+) è¡¨ç¤ºã€‚</p></blockquote><h4 id="3-3-3-æ»¡å¤–è¿æ¥-FULL-OUTER-JOIN"><a href="#3-3-3-æ»¡å¤–è¿æ¥-FULL-OUTER-JOIN" class="headerlink" title="3.3.3 æ»¡å¤–è¿æ¥(FULL OUTER JOIN)"></a>3.3.3 æ»¡å¤–è¿æ¥(FULL OUTER JOIN)</h4><ul><li>æ»¡å¤–è¿æ¥çš„ç»“æœ = å·¦å³è¡¨åŒ¹é…çš„æ•°æ® + å·¦è¡¨æ²¡æœ‰åŒ¹é…åˆ°çš„æ•°æ® + å³è¡¨æ²¡æœ‰åŒ¹é…åˆ°çš„æ•°æ®ã€‚</li><li>SQL99æ˜¯æ”¯æŒæ»¡å¤–è¿æ¥çš„ã€‚ä½¿ç”¨FULL JOIN æˆ– FULL OUTER JOINæ¥å®ç°ã€‚</li><li>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒMySQLä¸æ”¯æŒFULL JOINï¼Œä½†æ˜¯å¯ä»¥ç”¨ LEFT JOIN <strong>UNION</strong> RIGHT joinä»£æ›¿ã€‚</li></ul><h2 id="4-UNIONçš„ä½¿ç”¨"><a href="#4-UNIONçš„ä½¿ç”¨" class="headerlink" title="4. UNIONçš„ä½¿ç”¨"></a>4. UNIONçš„ä½¿ç”¨</h2><p><strong>åˆå¹¶æŸ¥è¯¢ç»“æœ</strong><br>åˆ©ç”¨UNIONå…³é”®å­—ï¼Œå¯ä»¥ç»™å‡ºå¤šæ¡SELECTè¯­å¥ï¼Œå¹¶å°†å®ƒä»¬çš„ç»“æœç»„åˆæˆå•ä¸ªç»“æœé›†ã€‚åˆå¹¶æ—¶ï¼Œ<strong>ä¸¤ä¸ªè¡¨å¯¹åº”çš„åˆ—æ•°å’Œæ•°æ®ç±»å‹å¿…é¡»ç›¸åŒ</strong>ï¼Œå¹¶ä¸”ç›¸äº’å¯¹åº”ã€‚å„ä¸ªSELECTè¯­å¥ä¹‹é—´ä½¿ç”¨UNIONæˆ–UNION ALLå…³é”®å­—åˆ†éš”ã€‚</p><p>è¯­æ³•æ ¼å¼ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT column,... FROM table1<br>UNION [ALL]<br>SELECT column,... FROM table2<br></code></pre></td></tr></table></figure><p><strong>UNIONæ“ä½œç¬¦</strong></p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554979317187.png" alt="" style="zoom: 67%;" /><p>UNION æ“ä½œç¬¦è¿”å›ä¸¤ä¸ªæŸ¥è¯¢çš„ç»“æœé›†çš„å¹¶é›†ï¼Œå»é™¤é‡å¤è®°å½•ã€‚</p><p><strong>UNION ALLæ“ä½œç¬¦</strong></p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554979343634.png" alt="" style="zoom: 67%;" /><p>UNION ALLæ“ä½œç¬¦è¿”å›ä¸¤ä¸ªæŸ¥è¯¢çš„ç»“æœé›†çš„å¹¶é›†ã€‚å¯¹äºä¸¤ä¸ªç»“æœé›†çš„é‡å¤éƒ¨åˆ†ï¼Œä¸å»é‡ã€‚</p><blockquote><p>æ³¨æ„ï¼šæ‰§è¡ŒUNION ALLè¯­å¥æ—¶æ‰€éœ€è¦çš„èµ„æºæ¯”UNIONè¯­å¥å°‘ã€‚å¦‚æœæ˜ç¡®çŸ¥é“åˆå¹¶æ•°æ®åçš„ç»“æœæ•°æ®ä¸å­˜åœ¨é‡å¤æ•°æ®ï¼Œæˆ–è€…ä¸éœ€è¦å»é™¤é‡å¤çš„æ•°æ®ï¼Œåˆ™å°½é‡ä½¿ç”¨UNION ALLè¯­å¥ï¼Œä»¥æé«˜æ•°æ®æŸ¥è¯¢çš„æ•ˆç‡ã€‚</p></blockquote><p>ä¸¾ä¾‹ï¼šæŸ¥è¯¢éƒ¨é—¨ç¼–å·&gt;90æˆ–é‚®ç®±åŒ…å«açš„å‘˜å·¥ä¿¡æ¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#æ–¹å¼1<br>SELECT * FROM employees WHERE email LIKE &#x27;%a%&#x27; OR department_id&gt;90;<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#æ–¹å¼2<br>SELECT * FROM employees  WHERE email LIKE &#x27;%a%&#x27;<br>UNION<br>SELECT * FROM employees  WHERE department_id&gt;90;<br></code></pre></td></tr></table></figure><p>ä¸¾ä¾‹ï¼šæŸ¥è¯¢ä¸­å›½ç”¨æˆ·ä¸­ç”·æ€§çš„ä¿¡æ¯ä»¥åŠç¾å›½ç”¨æˆ·ä¸­å¹´ç”·æ€§çš„ç”¨æˆ·ä¿¡æ¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT id,cname FROM t_chinamale WHERE csex=&#x27;ç”·&#x27;<br>UNION ALL<br>SELECT id,tname FROM t_usmale WHERE tGender=&#x27;male&#x27;;<br></code></pre></td></tr></table></figure><h2 id="5-7ç§SQL-JOINSçš„å®ç°"><a href="#5-7ç§SQL-JOINSçš„å®ç°" class="headerlink" title="5. 7ç§SQL JOINSçš„å®ç°"></a>5. 7ç§SQL JOINSçš„å®ç°</h2><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554979255233.png" alt="" style="zoom:80%;" /><h3 id="5-7-1-ä»£ç å®ç°"><a href="#5-7-1-ä»£ç å®ç°" class="headerlink" title="5.7.1 ä»£ç å®ç°"></a>5.7.1 ä»£ç å®ç°</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#ä¸­å›¾ï¼šå†…è¿æ¥ Aâˆ©B<br>SELECT employee_id,last_name,department_name<br>FROM employees e JOIN departments d<br>ON e.`department_id` = d.`department_id`;<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#å·¦ä¸Šå›¾ï¼šå·¦å¤–è¿æ¥<br>SELECT employee_id,last_name,department_name<br>FROM employees e LEFT JOIN departments d<br>ON e.`department_id` = d.`department_id`;<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#å³ä¸Šå›¾ï¼šå³å¤–è¿æ¥<br>SELECT employee_id,last_name,department_name<br>FROM employees e RIGHT JOIN departments d<br>ON e.`department_id` = d.`department_id`;<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#å·¦ä¸­å›¾ï¼šA - Aâˆ©B<br>SELECT employee_id,last_name,department_name<br>FROM employees e LEFT JOIN departments d<br>ON e.`department_id` = d.`department_id`<br>WHERE d.`department_id` IS NULL<br><br>æˆ–è€…<br><br>SELECT employee_id,last_name,department_name<br>FROM employees e LEFT JOIN departments d<br>ON e.`department_id` = d.`department_id`<br>WHERE NOT d.`department_id` IS NOT NULL;<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#å³ä¸­å›¾ï¼šB-Aâˆ©B<br>SELECT employee_id,last_name,department_name<br>FROM employees e RIGHT JOIN departments d<br>ON e.`department_id` = d.`department_id`<br>WHERE e.`department_id` IS NULL<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#å·¦ä¸‹å›¾ï¼šæ»¡å¤–è¿æ¥<br># å·¦ä¸­å›¾ + å³ä¸Šå›¾  AâˆªB<br>SELECT employee_id,last_name,department_name<br>FROM employees e LEFT JOIN departments d<br>ON e.`department_id` = d.`department_id`<br>WHERE d.`department_id` IS NULL<br>UNION ALL  #æ²¡æœ‰å»é‡æ“ä½œï¼Œæ•ˆç‡é«˜<br>SELECT employee_id,last_name,department_name<br>FROM employees e RIGHT JOIN departments d<br>ON e.`department_id` = d.`department_id`;<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#å³ä¸‹å›¾<br>#å·¦ä¸­å›¾ + å³ä¸­å›¾  AâˆªB - Aâˆ©B æˆ–è€… (A -  Aâˆ©B) âˆª ï¼ˆB - Aâˆ©Bï¼‰<br>SELECT employee_id,last_name,department_name<br>FROM employees e LEFT JOIN departments d<br>ON e.`department_id` = d.`department_id`<br>WHERE d.`department_id` IS NULL<br>UNION ALL<br>SELECT employee_id,last_name,department_name<br>FROM employees e RIGHT JOIN departments d<br>ON e.`department_id` = d.`department_id`<br>WHERE e.`department_id` IS NULL<br></code></pre></td></tr></table></figure><h3 id="5-7-2-è¯­æ³•æ ¼å¼å°ç»“"><a href="#5-7-2-è¯­æ³•æ ¼å¼å°ç»“" class="headerlink" title="5.7.2 è¯­æ³•æ ¼å¼å°ç»“"></a>5.7.2 è¯­æ³•æ ¼å¼å°ç»“</h3><ul><li>å·¦ä¸­å›¾</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#å®ç°A -  Aâˆ©B<br>select å­—æ®µåˆ—è¡¨<br>from Aè¡¨ left join Bè¡¨<br>on å…³è”æ¡ä»¶<br>where ä»è¡¨å…³è”å­—æ®µ is null and ç­‰å…¶ä»–å­å¥;<br></code></pre></td></tr></table></figure><ul><li>å³ä¸­å›¾</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#å®ç°B -  Aâˆ©B<br>select å­—æ®µåˆ—è¡¨<br>from Aè¡¨ right join Bè¡¨<br>on å…³è”æ¡ä»¶<br>where ä»è¡¨å…³è”å­—æ®µ is null and ç­‰å…¶ä»–å­å¥;<br></code></pre></td></tr></table></figure><ul><li>å·¦ä¸‹å›¾</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#å®ç°æŸ¥è¯¢ç»“æœæ˜¯AâˆªB<br>#ç”¨å·¦å¤–çš„Aï¼Œunion å³å¤–çš„B<br>select å­—æ®µåˆ—è¡¨<br>from Aè¡¨ left join Bè¡¨<br>on å…³è”æ¡ä»¶<br>where ç­‰å…¶ä»–å­å¥<br><br>union <br><br>select å­—æ®µåˆ—è¡¨<br>from Aè¡¨ right join Bè¡¨<br>on å…³è”æ¡ä»¶<br>where ç­‰å…¶ä»–å­å¥;<br></code></pre></td></tr></table></figure><ul><li>å³ä¸‹å›¾</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#å®ç°AâˆªB -  Aâˆ©B  æˆ–   (A -  Aâˆ©B) âˆª ï¼ˆB - Aâˆ©Bï¼‰<br>#ä½¿ç”¨å·¦å¤–çš„ (A -  Aâˆ©B)  union å³å¤–çš„ï¼ˆB - Aâˆ©Bï¼‰<br>select å­—æ®µåˆ—è¡¨<br>from Aè¡¨ left join Bè¡¨<br>on å…³è”æ¡ä»¶<br>where ä»è¡¨å…³è”å­—æ®µ is null and ç­‰å…¶ä»–å­å¥<br><br>union<br><br>select å­—æ®µåˆ—è¡¨<br>from Aè¡¨ right join Bè¡¨<br>on å…³è”æ¡ä»¶<br>where ä»è¡¨å…³è”å­—æ®µ is null and ç­‰å…¶ä»–å­å¥<br></code></pre></td></tr></table></figure><h2 id="6-SQL99è¯­æ³•æ–°ç‰¹æ€§"><a href="#6-SQL99è¯­æ³•æ–°ç‰¹æ€§" class="headerlink" title="6. SQL99è¯­æ³•æ–°ç‰¹æ€§"></a>6. SQL99è¯­æ³•æ–°ç‰¹æ€§</h2><h3 id="6-1-è‡ªç„¶è¿æ¥"><a href="#6-1-è‡ªç„¶è¿æ¥" class="headerlink" title="6.1 è‡ªç„¶è¿æ¥"></a>6.1 è‡ªç„¶è¿æ¥</h3><p>SQL99 åœ¨ SQL92 çš„åŸºç¡€ä¸Šæä¾›äº†ä¸€äº›ç‰¹æ®Šè¯­æ³•ï¼Œæ¯”å¦‚ <code>NATURAL JOIN</code> ç”¨æ¥è¡¨ç¤ºè‡ªç„¶è¿æ¥ã€‚æˆ‘ä»¬å¯ä»¥æŠŠè‡ªç„¶è¿æ¥ç†è§£ä¸º SQL92 ä¸­çš„ç­‰å€¼è¿æ¥ã€‚å®ƒä¼šå¸®ä½ è‡ªåŠ¨æŸ¥è¯¢ä¸¤å¼ è¿æ¥è¡¨ä¸­<code>æ‰€æœ‰ç›¸åŒçš„å­—æ®µ</code>ï¼Œç„¶åè¿›è¡Œ<code>ç­‰å€¼è¿æ¥</code>ã€‚</p><p>åœ¨SQL92æ ‡å‡†ä¸­ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT employee_id,last_name,department_name<br>FROM employees e JOIN departments d<br>ON e.`department_id` = d.`department_id`<br>AND e.`manager_id` = d.`manager_id`;<br></code></pre></td></tr></table></figure><p>åœ¨ SQL99 ä¸­ä½ å¯ä»¥å†™æˆï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT employee_id,last_name,department_name<br>FROM employees e NATURAL JOIN departments d;<br></code></pre></td></tr></table></figure><h3 id="6-2-USINGè¿æ¥"><a href="#6-2-USINGè¿æ¥" class="headerlink" title="6.2 USINGè¿æ¥"></a>6.2 USINGè¿æ¥</h3><p>å½“æˆ‘ä»¬è¿›è¡Œè¿æ¥çš„æ—¶å€™ï¼ŒSQL99è¿˜æ”¯æŒä½¿ç”¨ USING æŒ‡å®šæ•°æ®è¡¨é‡Œçš„<code>åŒåå­—æ®µ</code>è¿›è¡Œç­‰å€¼è¿æ¥ã€‚ä½†æ˜¯åªèƒ½é…åˆJOINä¸€èµ·ä½¿ç”¨ã€‚æ¯”å¦‚ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT employee_id,last_name,department_name<br>FROM employees e JOIN departments d<br>USING (department_id);<br></code></pre></td></tr></table></figure><p>ä½ èƒ½çœ‹å‡ºä¸è‡ªç„¶è¿æ¥ NATURAL JOIN ä¸åŒçš„æ˜¯ï¼ŒUSING æŒ‡å®šäº†å…·ä½“çš„ç›¸åŒçš„å­—æ®µåç§°ï¼Œä½ éœ€è¦åœ¨ USING çš„æ‹¬å· () ä¸­å¡«å…¥è¦æŒ‡å®šçš„åŒåå­—æ®µã€‚åŒæ—¶ä½¿ç”¨ <code>JOIN...USING</code> å¯ä»¥ç®€åŒ– JOIN ON çš„ç­‰å€¼è¿æ¥ã€‚å®ƒä¸ä¸‹é¢çš„ SQL æŸ¥è¯¢ç»“æœæ˜¯ç›¸åŒçš„ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT employee_id,last_name,department_name<br>FROM employees e ,departments d<br>WHERE e.department_id = d.department_id;<br></code></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¯ä»¥ä¸ä½¿ç”¨<code>NATURAL JION</code>å’Œ<code>USING</code>ï¼Œåªä½¿ç”¨<code>JION ON</code>å› ä¸ºå…¶è¡¨è¾¾æ¸…æ¥šï¼Œé€‚ç”¨èŒƒå›´å¹¿ã€‚</p><h2 id="7-ç« èŠ‚å°ç»“"><a href="#7-ç« èŠ‚å°ç»“" class="headerlink" title="7. ç« èŠ‚å°ç»“"></a>7. ç« èŠ‚å°ç»“</h2><p>è¡¨è¿æ¥çš„çº¦æŸæ¡ä»¶å¯ä»¥æœ‰ä¸‰ç§æ–¹å¼ï¼šWHERE, ON, USING</p><ul><li><p>WHEREï¼šé€‚ç”¨äºæ‰€æœ‰å…³è”æŸ¥è¯¢</p></li><li><p><code>ON</code>ï¼šåªèƒ½å’ŒJOINä¸€èµ·ä½¿ç”¨ï¼Œåªèƒ½å†™å…³è”æ¡ä»¶ã€‚è™½ç„¶å…³è”æ¡ä»¶å¯ä»¥å¹¶åˆ°WHEREä¸­å’Œå…¶ä»–æ¡ä»¶ä¸€èµ·å†™ï¼Œä½†åˆ†å¼€å†™å¯è¯»æ€§æ›´å¥½ã€‚<strong>æ¨è</strong></p></li><li><p>USINGï¼šåªèƒ½å’ŒJOINä¸€èµ·ä½¿ç”¨ï¼Œè€Œä¸”è¦æ±‚<strong>ä¸¤ä¸ª</strong>å…³è”å­—æ®µåœ¨å…³è”è¡¨ä¸­åç§°ä¸€è‡´ï¼Œè€Œä¸”åªèƒ½è¡¨ç¤ºå…³è”å­—æ®µå€¼ç›¸ç­‰</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#å…³è”æ¡ä»¶<br>#æŠŠå…³è”æ¡ä»¶å†™åœ¨whereåé¢<br>SELECT last_name,department_name <br>FROM employees,departments <br>WHERE employees.department_id = departments.department_id;<br><br>#æŠŠå…³è”æ¡ä»¶å†™åœ¨onåé¢ï¼Œåªèƒ½å’ŒJOINä¸€èµ·ä½¿ç”¨<br>SELECT last_name,department_name <br>FROM employees INNER JOIN departments <br>ON employees.department_id = departments.department_id;<br><br>SELECT last_name,department_name <br>FROM employees CROSS JOIN departments <br>ON employees.department_id = departments.department_id;<br><br>SELECT last_name,department_name  <br>FROM employees JOIN departments <br>ON employees.department_id = departments.department_id;<br><br>#æŠŠå…³è”å­—æ®µå†™åœ¨using()ä¸­ï¼Œåªèƒ½å’ŒJOINä¸€èµ·ä½¿ç”¨<br>#è€Œä¸”ä¸¤ä¸ªè¡¨ä¸­çš„å…³è”å­—æ®µå¿…é¡»åç§°ç›¸åŒï¼Œè€Œä¸”åªèƒ½è¡¨ç¤º=<br>#æŸ¥è¯¢å‘˜å·¥å§“åä¸åŸºæœ¬å·¥èµ„<br>SELECT last_name,job_title<br>FROM employees INNER JOIN jobs USING(job_id);<br><br>#nå¼ è¡¨å…³è”ï¼Œéœ€è¦n-1ä¸ªå…³è”æ¡ä»¶<br>#æŸ¥è¯¢å‘˜å·¥å§“åï¼ŒåŸºæœ¬å·¥èµ„ï¼Œéƒ¨é—¨åç§°<br>SELECT last_name,job_title,department_name FROM employees,departments,jobs <br>WHERE employees.department_id = departments.department_id <br>AND employees.job_id = jobs.job_id;<br><br>SELECT last_name,job_title,department_name <br>FROM employees INNER JOIN departments INNER JOIN jobs <br>ON employees.department_id = departments.department_id <br>AND employees.job_id = jobs.job_id;<br><br>#æˆ–è€…ï¼Œè¿™ä¸¤ç§å½¢å¼MySQLéƒ½æ”¯æŒ<br><br>SELECT e.last_name, d.department_name, d.location_id, l.city<br>FROM employees e LEFT JOIN departments d<br>ON e.department_id = d.department_id<br>LEFT JOIN locations l<br>ON d.location_id = l.location_id<br>WHERE e.commission_pct IS NOT NULL<br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„ï¼š</strong></p><p>æˆ‘ä»¬è¦<code>æ§åˆ¶è¿æ¥è¡¨çš„æ•°é‡</code>ã€‚å¤šè¡¨è¿æ¥å°±ç›¸å½“äºåµŒå¥— for å¾ªç¯ä¸€æ ·ï¼Œéå¸¸æ¶ˆè€—èµ„æºï¼Œä¼šè®© SQL æŸ¥è¯¢æ€§èƒ½ä¸‹é™å¾—å¾ˆä¸¥é‡ï¼Œå› æ­¤ä¸è¦è¿æ¥ä¸å¿…è¦çš„è¡¨ã€‚åœ¨è®¸å¤š DBMS ä¸­ï¼Œä¹Ÿéƒ½ä¼šæœ‰æœ€å¤§è¿æ¥è¡¨çš„é™åˆ¶ã€‚</p><blockquote><p>ã€å¼ºåˆ¶ã€‘è¶…è¿‡ä¸‰ä¸ªè¡¨ç¦æ­¢ joinã€‚éœ€è¦ join çš„å­—æ®µï¼Œæ•°æ®ç±»å‹ä¿æŒç»å¯¹ä¸€è‡´ï¼›å¤šè¡¨å…³è”æŸ¥è¯¢æ—¶ï¼Œ ä¿è¯è¢«å…³è”çš„å­—æ®µéœ€è¦æœ‰ç´¢å¼•ã€‚ </p><p>è¯´æ˜ï¼šå³ä½¿åŒè¡¨ join ä¹Ÿè¦æ³¨æ„è¡¨ç´¢å¼•ã€SQL æ€§èƒ½ã€‚</p><p>æ¥æºï¼šé˜¿é‡Œå·´å·´ã€ŠJavaå¼€å‘æ‰‹å†Œã€‹</p></blockquote><h2 id="é™„å½•ï¼šå¸¸ç”¨çš„-SQL-æ ‡å‡†æœ‰å“ªäº›"><a href="#é™„å½•ï¼šå¸¸ç”¨çš„-SQL-æ ‡å‡†æœ‰å“ªäº›" class="headerlink" title="é™„å½•ï¼šå¸¸ç”¨çš„ SQL æ ‡å‡†æœ‰å“ªäº›"></a>é™„å½•ï¼šå¸¸ç”¨çš„ SQL æ ‡å‡†æœ‰å“ªäº›</h2><p>åœ¨æ­£å¼å¼€å§‹è®²è¿æ¥è¡¨çš„ç§ç±»æ—¶ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦çŸ¥é“ SQL å­˜åœ¨ä¸åŒç‰ˆæœ¬çš„æ ‡å‡†è§„èŒƒï¼Œå› ä¸ºä¸åŒè§„èŒƒä¸‹çš„è¡¨è¿æ¥æ“ä½œæ˜¯æœ‰åŒºåˆ«çš„ã€‚</p><p>SQL æœ‰ä¸¤ä¸ªä¸»è¦çš„æ ‡å‡†ï¼Œåˆ†åˆ«æ˜¯ <code>SQL92</code> å’Œ <code>SQL99</code>ã€‚92 å’Œ 99 ä»£è¡¨äº†æ ‡å‡†æå‡ºçš„æ—¶é—´ï¼ŒSQL92 å°±æ˜¯ 92 å¹´æå‡ºçš„æ ‡å‡†è§„èŒƒã€‚å½“ç„¶é™¤äº† SQL92 å’Œ SQL99 ä»¥å¤–ï¼Œè¿˜å­˜åœ¨ SQL-86ã€SQL-89ã€SQL:2003ã€SQL:2008ã€SQL:2011 å’Œ SQL:2016 ç­‰å…¶ä»–çš„æ ‡å‡†ã€‚</p><p>è¿™ä¹ˆå¤šæ ‡å‡†ï¼Œåˆ°åº•è¯¥å­¦ä¹ å“ªä¸ªå‘¢ï¼Ÿ<strong>å®é™…ä¸Šæœ€é‡è¦çš„ SQL æ ‡å‡†å°±æ˜¯ SQL92 å’Œ SQL99</strong>ã€‚ä¸€èˆ¬æ¥è¯´ SQL92 çš„å½¢å¼æ›´ç®€å•ï¼Œä½†æ˜¯å†™çš„ SQL è¯­å¥ä¼šæ¯”è¾ƒé•¿ï¼Œå¯è¯»æ€§è¾ƒå·®ã€‚è€Œ SQL99 ç›¸æ¯”äº SQL92 æ¥è¯´ï¼Œè¯­æ³•æ›´åŠ å¤æ‚ï¼Œä½†å¯è¯»æ€§æ›´å¼ºã€‚æˆ‘ä»¬ä»è¿™ä¸¤ä¸ªæ ‡å‡†å‘å¸ƒçš„é¡µæ•°ä¹Ÿèƒ½çœ‹å‡ºï¼ŒSQL92 çš„æ ‡å‡†æœ‰ 500 é¡µï¼Œè€Œ SQL99 æ ‡å‡†è¶…è¿‡äº† 1000 é¡µã€‚å®é™…ä¸Šä» SQL99 ä¹‹åï¼Œå¾ˆå°‘æœ‰äººèƒ½æŒæ¡æ‰€æœ‰å†…å®¹ï¼Œå› ä¸ºç¡®å®å¤ªå¤šäº†ã€‚å°±å¥½æ¯”æˆ‘ä»¬ä½¿ç”¨ Windowsã€Linux å’Œ Office çš„æ—¶å€™ï¼Œå¾ˆå°‘æœ‰äººèƒ½æŒæ¡å…¨éƒ¨å†…å®¹ä¸€æ ·ã€‚æˆ‘ä»¬åªéœ€è¦æŒæ¡ä¸€äº›æ ¸å¿ƒçš„åŠŸèƒ½ï¼Œæ»¡è¶³æ—¥å¸¸å·¥ä½œçš„éœ€æ±‚å³å¯ã€‚</p><p><strong>SQL92 å’Œ SQL99 æ˜¯ç»å…¸çš„ SQL æ ‡å‡†ï¼Œä¹Ÿåˆ†åˆ«å«åš SQL-2 å’Œ SQL-3 æ ‡å‡†ã€‚</strong>ä¹Ÿæ­£æ˜¯åœ¨è¿™ä¸¤ä¸ªæ ‡å‡†å‘å¸ƒä¹‹åï¼ŒSQL å½±å“åŠ›è¶Šæ¥è¶Šå¤§ï¼Œç”šè‡³è¶…è¶Šäº†æ•°æ®åº“é¢†åŸŸã€‚ç°å¦‚ä»Š SQL å·²ç»ä¸ä»…ä»…æ˜¯æ•°æ®åº“é¢†åŸŸçš„ä¸»æµè¯­è¨€ï¼Œè¿˜æ˜¯ä¿¡æ¯é¢†åŸŸä¸­ä¿¡æ¯å¤„ç†çš„ä¸»æµè¯­è¨€ã€‚åœ¨å›¾å½¢æ£€ç´¢ã€å›¾åƒæ£€ç´¢ä»¥åŠè¯­éŸ³æ£€ç´¢ä¸­éƒ½èƒ½çœ‹åˆ° SQL è¯­è¨€çš„ä½¿ç”¨ã€‚</p><h1 id="ç¬¬07ç« -å•è¡Œå‡½æ•°"><a href="#ç¬¬07ç« -å•è¡Œå‡½æ•°" class="headerlink" title="ç¬¬07ç« _å•è¡Œå‡½æ•°"></a>ç¬¬07ç« _å•è¡Œå‡½æ•°</h1><h2 id="1-å‡½æ•°çš„ç†è§£"><a href="#1-å‡½æ•°çš„ç†è§£" class="headerlink" title="1. å‡½æ•°çš„ç†è§£"></a>1. å‡½æ•°çš„ç†è§£</h2><h3 id="1-1-ä»€ä¹ˆæ˜¯å‡½æ•°"><a href="#1-1-ä»€ä¹ˆæ˜¯å‡½æ•°" class="headerlink" title="1.1 ä»€ä¹ˆæ˜¯å‡½æ•°"></a>1.1 ä»€ä¹ˆæ˜¯å‡½æ•°</h3><p>å‡½æ•°åœ¨è®¡ç®—æœºè¯­è¨€çš„ä½¿ç”¨ä¸­è´¯ç©¿å§‹ç»ˆï¼Œå‡½æ•°çš„ä½œç”¨æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå®ƒå¯ä»¥æŠŠæˆ‘ä»¬ç»å¸¸ä½¿ç”¨çš„ä»£ç å°è£…èµ·æ¥ï¼Œéœ€è¦çš„æ—¶å€™ç›´æ¥è°ƒç”¨å³å¯ã€‚è¿™æ ·æ—¢<code>æé«˜äº†ä»£ç æ•ˆç‡</code>ï¼Œåˆ<code>æé«˜äº†å¯ç»´æŠ¤æ€§</code>ã€‚åœ¨ SQL ä¸­æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨å‡½æ•°å¯¹æ£€ç´¢å‡ºæ¥çš„æ•°æ®è¿›è¡Œå‡½æ•°æ“ä½œã€‚ä½¿ç”¨è¿™äº›å‡½æ•°ï¼Œå¯ä»¥æå¤§åœ°<code>æé«˜ç”¨æˆ·å¯¹æ•°æ®åº“çš„ç®¡ç†æ•ˆç‡</code>ã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554979529525.png"></p><p>ä»å‡½æ•°å®šä¹‰çš„è§’åº¦å‡ºå‘ï¼Œæˆ‘ä»¬å¯ä»¥å°†å‡½æ•°åˆ†æˆ<code>å†…ç½®å‡½æ•°</code>å’Œ<code>è‡ªå®šä¹‰å‡½æ•°</code>ã€‚åœ¨ SQL è¯­è¨€ä¸­ï¼ŒåŒæ ·ä¹ŸåŒ…æ‹¬äº†å†…ç½®å‡½æ•°å’Œè‡ªå®šä¹‰å‡½æ•°ã€‚å†…ç½®å‡½æ•°æ˜¯ç³»ç»Ÿå†…ç½®çš„é€šç”¨å‡½æ•°ï¼Œè€Œè‡ªå®šä¹‰å‡½æ•°æ˜¯æˆ‘ä»¬æ ¹æ®è‡ªå·±çš„éœ€è¦ç¼–å†™çš„ï¼Œæœ¬ç« åŠä¸‹ä¸€ç« è®²è§£çš„æ˜¯ SQL çš„å†…ç½®å‡½æ•°ã€‚</p><h3 id="1-2-ä¸åŒDBMSå‡½æ•°çš„å·®å¼‚"><a href="#1-2-ä¸åŒDBMSå‡½æ•°çš„å·®å¼‚" class="headerlink" title="1.2 ä¸åŒDBMSå‡½æ•°çš„å·®å¼‚"></a>1.2 ä¸åŒDBMSå‡½æ•°çš„å·®å¼‚</h3><p>æˆ‘ä»¬åœ¨ä½¿ç”¨ SQL è¯­è¨€çš„æ—¶å€™ï¼Œä¸æ˜¯ç›´æ¥å’Œè¿™é—¨è¯­è¨€æ‰“äº¤é“ï¼Œè€Œæ˜¯é€šè¿‡å®ƒä½¿ç”¨ä¸åŒçš„æ•°æ®åº“è½¯ä»¶ï¼Œå³ DBMSã€‚<strong>DBMS ä¹‹é—´çš„å·®å¼‚æ€§å¾ˆå¤§ï¼Œè¿œå¤§äºåŒä¸€ä¸ªè¯­è¨€ä¸åŒç‰ˆæœ¬ä¹‹é—´çš„å·®å¼‚ã€‚</strong>å®é™…ä¸Šï¼Œåªæœ‰å¾ˆå°‘çš„å‡½æ•°æ˜¯è¢« DBMS åŒæ—¶æ”¯æŒçš„ã€‚æ¯”å¦‚ï¼Œå¤§å¤šæ•° DBMS ä½¿ç”¨ï¼ˆ||ï¼‰æˆ–è€…ï¼ˆ+ï¼‰æ¥åšæ‹¼æ¥ç¬¦ï¼Œè€Œåœ¨ MySQL ä¸­çš„å­—ç¬¦ä¸²æ‹¼æ¥å‡½æ•°ä¸ºconcat()ã€‚å¤§éƒ¨åˆ† DBMS ä¼šæœ‰è‡ªå·±ç‰¹å®šçš„å‡½æ•°ï¼Œè¿™å°±æ„å‘³ç€<strong>é‡‡ç”¨ SQL å‡½æ•°çš„ä»£ç å¯ç§»æ¤æ€§æ˜¯å¾ˆå·®çš„</strong>ï¼Œå› æ­¤åœ¨ä½¿ç”¨å‡½æ•°çš„æ—¶å€™éœ€è¦ç‰¹åˆ«æ³¨æ„ã€‚</p><h3 id="1-3-MySQLçš„å†…ç½®å‡½æ•°åŠåˆ†ç±»"><a href="#1-3-MySQLçš„å†…ç½®å‡½æ•°åŠåˆ†ç±»" class="headerlink" title="1.3 MySQLçš„å†…ç½®å‡½æ•°åŠåˆ†ç±»"></a>1.3 MySQLçš„å†…ç½®å‡½æ•°åŠåˆ†ç±»</h3><p>MySQLæä¾›äº†ä¸°å¯Œçš„å†…ç½®å‡½æ•°ï¼Œè¿™äº›å‡½æ•°ä½¿å¾—æ•°æ®çš„ç»´æŠ¤ä¸ç®¡ç†æ›´åŠ æ–¹ä¾¿ï¼Œèƒ½å¤Ÿæ›´å¥½åœ°æä¾›æ•°æ®çš„åˆ†æä¸ç»Ÿè®¡åŠŸèƒ½ï¼Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šæé«˜äº†å¼€å‘äººå‘˜è¿›è¡Œæ•°æ®åˆ†æä¸ç»Ÿè®¡çš„æ•ˆç‡ã€‚</p><p>MySQLæä¾›çš„å†…ç½®å‡½æ•°ä»<code>å®ç°çš„åŠŸèƒ½è§’åº¦</code>å¯ä»¥åˆ†ä¸ºæ•°å€¼å‡½æ•°ã€å­—ç¬¦ä¸²å‡½æ•°ã€æ—¥æœŸå’Œæ—¶é—´å‡½æ•°ã€æµç¨‹æ§åˆ¶å‡½æ•°ã€åŠ å¯†ä¸è§£å¯†å‡½æ•°ã€è·å–MySQLä¿¡æ¯å‡½æ•°ã€èšåˆå‡½æ•°ç­‰ã€‚è¿™é‡Œï¼Œæˆ‘å°†è¿™äº›ä¸°å¯Œçš„å†…ç½®å‡½æ•°å†åˆ†ä¸ºä¸¤ç±»ï¼š<code>å•è¡Œå‡½æ•°</code>ã€<code>èšåˆå‡½æ•°ï¼ˆæˆ–åˆ†ç»„å‡½æ•°ï¼‰</code>ã€‚</p><p><strong>ä¸¤ç§SQLå‡½æ•°</strong></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1555433204337.png"></p><p><strong>å•è¡Œå‡½æ•°</strong></p><ul><li>æ“ä½œæ•°æ®å¯¹è±¡</li><li>æ¥å—å‚æ•°è¿”å›ä¸€ä¸ªç»“æœ</li><li><strong>åªå¯¹ä¸€è¡Œè¿›è¡Œå˜æ¢</strong></li><li><strong>æ¯è¡Œè¿”å›ä¸€ä¸ªç»“æœ</strong></li><li>å¯ä»¥åµŒå¥—</li><li>å‚æ•°å¯ä»¥æ˜¯ä¸€åˆ—æˆ–ä¸€ä¸ªå€¼</li></ul><h2 id="2-æ•°å€¼å‡½æ•°"><a href="#2-æ•°å€¼å‡½æ•°" class="headerlink" title="2. æ•°å€¼å‡½æ•°"></a>2. æ•°å€¼å‡½æ•°</h2><h3 id="2-1-åŸºæœ¬å‡½æ•°"><a href="#2-1-åŸºæœ¬å‡½æ•°" class="headerlink" title="2.1 åŸºæœ¬å‡½æ•°"></a>2.1 åŸºæœ¬å‡½æ•°</h3><table><thead><tr><th>å‡½æ•°</th><th>ç”¨æ³•</th></tr></thead><tbody><tr><td>ABS(x)</td><td>è¿”å›xçš„ç»å¯¹å€¼</td></tr><tr><td>SIGN(X)</td><td>è¿”å›Xçš„ç¬¦å·ã€‚æ­£æ•°è¿”å›1ï¼Œè´Ÿæ•°è¿”å›-1ï¼Œ0è¿”å›0</td></tr><tr><td>PI()</td><td>è¿”å›åœ†å‘¨ç‡çš„å€¼</td></tr><tr><td>CEIL(x)ï¼ŒCEILING(x)</td><td>è¿”å›å¤§äºæˆ–ç­‰äºæŸä¸ªå€¼çš„æœ€å°æ•´æ•°</td></tr><tr><td>FLOOR(x)</td><td>è¿”å›å°äºæˆ–ç­‰äºæŸä¸ªå€¼çš„æœ€å¤§æ•´æ•°</td></tr><tr><td>LEAST(e1,e2,e3â€¦)</td><td>è¿”å›åˆ—è¡¨ä¸­çš„æœ€å°å€¼</td></tr><tr><td>GREATEST(e1,e2,e3â€¦)</td><td>è¿”å›åˆ—è¡¨ä¸­çš„æœ€å¤§å€¼</td></tr><tr><td>MOD(x,y)</td><td>è¿”å›Xé™¤ä»¥Yåçš„ä½™æ•°</td></tr><tr><td>RAND()</td><td>è¿”å›0~1çš„éšæœºå€¼</td></tr><tr><td>RAND(x)</td><td>è¿”å›0~1çš„éšæœºå€¼ï¼Œå…¶ä¸­xçš„å€¼ç”¨ä½œç§å­å€¼ï¼Œç›¸åŒçš„Xå€¼ä¼šäº§ç”Ÿç›¸åŒçš„éšæœºæ•°</td></tr><tr><td>ROUND(x)</td><td>è¿”å›ä¸€ä¸ªå¯¹xçš„å€¼è¿›è¡Œå››èˆäº”å…¥åï¼Œæœ€æ¥è¿‘äºXçš„æ•´æ•°</td></tr><tr><td>ROUND(x,y)</td><td>è¿”å›ä¸€ä¸ªå¯¹xçš„å€¼è¿›è¡Œå››èˆäº”å…¥åæœ€æ¥è¿‘Xçš„å€¼ï¼Œå¹¶ä¿ç•™åˆ°å°æ•°ç‚¹åé¢Yä½(yä¸ºè´Ÿæ•°ï¼Œåˆ™èˆå»å¯¹åº”ä½çš„æ•´æ•°ä½)</td></tr><tr><td>TRUNCATE(x,y)</td><td>è¿”å›æ•°å­—xæˆªæ–­ä¸ºyä½å°æ•°çš„ç»“æœ</td></tr><tr><td>SQRT(x)</td><td>è¿”å›xçš„å¹³æ–¹æ ¹ã€‚å½“Xçš„å€¼ä¸ºè´Ÿæ•°æ—¶ï¼Œè¿”å›NULL</td></tr></tbody></table><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT ABS(-123),ABS(32),SIGN(-23),SIGN(43),PI(),CEIL(32.32),CEILING(-43.23),FLOOR(32.32),<br>FLOOR(-43.23),MOD(12,5)<br>FROM DUAL;<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211025162304844.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT RAND(),RAND(),RAND(10),RAND(10),RAND(-1),RAND(-1)<br>FROM DUAL;<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211025162538958.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT ROUND(12.33),ROUND(12.343,2),ROUND(12.324,-1),TRUNCATE(12.66,1),TRUNCATE(12.66,-1)<br>FROM DUAL;<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211025162730421.png"></p><h3 id="2-2-è§’åº¦ä¸å¼§åº¦äº’æ¢å‡½æ•°"><a href="#2-2-è§’åº¦ä¸å¼§åº¦äº’æ¢å‡½æ•°" class="headerlink" title="2.2 è§’åº¦ä¸å¼§åº¦äº’æ¢å‡½æ•°"></a>2.2 è§’åº¦ä¸å¼§åº¦äº’æ¢å‡½æ•°</h3><table><thead><tr><th>å‡½æ•°</th><th>ç”¨æ³•</th></tr></thead><tbody><tr><td>RADIANS(x)</td><td>å°†è§’åº¦è½¬åŒ–ä¸ºå¼§åº¦ï¼Œå…¶ä¸­ï¼Œå‚æ•°xä¸ºè§’åº¦å€¼</td></tr><tr><td>DEGREES(x)</td><td>å°†å¼§åº¦è½¬åŒ–ä¸ºè§’åº¦ï¼Œå…¶ä¸­ï¼Œå‚æ•°xä¸ºå¼§åº¦å€¼</td></tr></tbody></table><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT RADIANS(30),RADIANS(60),RADIANS(90),DEGREES(2*PI()),DEGREES(RADIANS(90))<br>FROM DUAL;<br></code></pre></td></tr></table></figure><h3 id="2-3-ä¸‰è§’å‡½æ•°"><a href="#2-3-ä¸‰è§’å‡½æ•°" class="headerlink" title="2.3 ä¸‰è§’å‡½æ•°"></a>2.3 ä¸‰è§’å‡½æ•°</h3><table><thead><tr><th>å‡½æ•°</th><th>ç”¨æ³•</th></tr></thead><tbody><tr><td>SIN(x)</td><td>è¿”å›xçš„æ­£å¼¦å€¼ï¼Œå…¶ä¸­ï¼Œå‚æ•°xä¸ºå¼§åº¦å€¼</td></tr><tr><td>ASIN(x)</td><td>è¿”å›xçš„åæ­£å¼¦å€¼ï¼Œå³è·å–æ­£å¼¦ä¸ºxçš„å€¼ã€‚å¦‚æœxçš„å€¼ä¸åœ¨-1åˆ°1ä¹‹é—´ï¼Œåˆ™è¿”å›NULL</td></tr><tr><td>COS(x)</td><td>è¿”å›xçš„ä½™å¼¦å€¼ï¼Œå…¶ä¸­ï¼Œå‚æ•°xä¸ºå¼§åº¦å€¼</td></tr><tr><td>ACOS(x)</td><td>è¿”å›xçš„åä½™å¼¦å€¼ï¼Œå³è·å–ä½™å¼¦ä¸ºxçš„å€¼ã€‚å¦‚æœxçš„å€¼ä¸åœ¨-1åˆ°1ä¹‹é—´ï¼Œåˆ™è¿”å›NULL</td></tr><tr><td>TAN(x)</td><td>è¿”å›xçš„æ­£åˆ‡å€¼ï¼Œå…¶ä¸­ï¼Œå‚æ•°xä¸ºå¼§åº¦å€¼</td></tr><tr><td>ATAN(x)</td><td>è¿”å›xçš„åæ­£åˆ‡å€¼ï¼Œå³è¿”å›æ­£åˆ‡å€¼ä¸ºxçš„å€¼</td></tr><tr><td>ATAN2(m,n)</td><td>è¿”å›ä¸¤ä¸ªå‚æ•°çš„åæ­£åˆ‡å€¼</td></tr><tr><td>COT(x)</td><td>è¿”å›xçš„ä½™åˆ‡å€¼ï¼Œå…¶ä¸­ï¼ŒXä¸ºå¼§åº¦å€¼</td></tr></tbody></table><p>ä¸¾ä¾‹ï¼š</p><p>ATAN2(M,N)å‡½æ•°è¿”å›ä¸¤ä¸ªå‚æ•°çš„åæ­£åˆ‡å€¼ã€‚<br>ä¸ATAN(X)å‡½æ•°ç›¸æ¯”ï¼ŒATAN2(M,N)éœ€è¦ä¸¤ä¸ªå‚æ•°ï¼Œä¾‹å¦‚æœ‰ä¸¤ä¸ªç‚¹point(x1,y1)å’Œpoint(x2,y2)ï¼Œä½¿ç”¨ATAN(X)å‡½æ•°è®¡ç®—åæ­£åˆ‡å€¼ä¸ºATAN((y2-y1)/(x2-x1))ï¼Œä½¿ç”¨ATAN2(M,N)è®¡ç®—åæ­£åˆ‡å€¼åˆ™ä¸ºATAN2(y2-y1,x2-x1)ã€‚ç”±ä½¿ç”¨æ–¹å¼å¯ä»¥çœ‹å‡ºï¼Œå½“x2-x1ç­‰äº0æ—¶ï¼ŒATAN(X)å‡½æ•°ä¼šæŠ¥é”™ï¼Œè€ŒATAN2(M,N)å‡½æ•°åˆ™ä»ç„¶å¯ä»¥è®¡ç®—ã€‚</p><p>ATAN2(M,N)å‡½æ•°çš„ä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT SIN(RADIANS(30)),DEGREES(ASIN(1)),TAN(RADIANS(45)),DEGREES(ATAN(1)),DEGREES(ATAN2(1,1))<br>FROM DUAL;<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211025163846974.png"></p><h3 id="2-4-æŒ‡æ•°ä¸å¯¹æ•°"><a href="#2-4-æŒ‡æ•°ä¸å¯¹æ•°" class="headerlink" title="2.4 æŒ‡æ•°ä¸å¯¹æ•°"></a>2.4 æŒ‡æ•°ä¸å¯¹æ•°</h3><table><thead><tr><th>å‡½æ•°</th><th>ç”¨æ³•</th></tr></thead><tbody><tr><td>POW(x,y)ï¼ŒPOWER(X,Y)</td><td>è¿”å›xçš„yæ¬¡æ–¹</td></tr><tr><td>EXP(X)</td><td>è¿”å›eçš„Xæ¬¡æ–¹ï¼Œå…¶ä¸­eæ˜¯ä¸€ä¸ªå¸¸æ•°ï¼Œ2.718281828459045</td></tr><tr><td>LN(X)ï¼ŒLOG(X)</td><td>è¿”å›ä»¥eä¸ºåº•çš„Xçš„å¯¹æ•°ï¼Œå½“X &lt;= 0 æ—¶ï¼Œè¿”å›çš„ç»“æœä¸ºNULL</td></tr><tr><td>LOG10(X)</td><td>è¿”å›ä»¥10ä¸ºåº•çš„Xçš„å¯¹æ•°ï¼Œå½“X &lt;= 0 æ—¶ï¼Œè¿”å›çš„ç»“æœä¸ºNULL</td></tr><tr><td>LOG2(X)</td><td>è¿”å›ä»¥2ä¸ºåº•çš„Xçš„å¯¹æ•°ï¼Œå½“X &lt;= 0 æ—¶ï¼Œè¿”å›NULL</td></tr></tbody></table><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT POW(2,5),POWER(2,4),EXP(2),LN(10),LOG10(10),LOG2(4)<br>    -&gt; FROM DUAL;<br>+----------+------------+------------------+-------------------+-----------+---------+<br>| POW(2,5) | POWER(2,4) | EXP(2)           | LN(10)            | LOG10(10) | LOG2(4) |<br>+----------+------------+------------------+-------------------+-----------+---------+<br>|       32 |         16 | 7.38905609893065 | 2.302585092994046 |         1 |       2 |<br>+----------+------------+------------------+-------------------+-----------+---------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><h3 id="2-5-è¿›åˆ¶é—´çš„è½¬æ¢"><a href="#2-5-è¿›åˆ¶é—´çš„è½¬æ¢" class="headerlink" title="2.5 è¿›åˆ¶é—´çš„è½¬æ¢"></a>2.5 è¿›åˆ¶é—´çš„è½¬æ¢</h3><table><thead><tr><th>å‡½æ•°</th><th>ç”¨æ³•</th></tr></thead><tbody><tr><td>BIN(x)</td><td>è¿”å›xçš„äºŒè¿›åˆ¶ç¼–ç </td></tr><tr><td>HEX(x)</td><td>è¿”å›xçš„åå…­è¿›åˆ¶ç¼–ç </td></tr><tr><td>OCT(x)</td><td>è¿”å›xçš„å…«è¿›åˆ¶ç¼–ç </td></tr><tr><td>CONV(x,f1,f2)</td><td>è¿”å›f1è¿›åˆ¶æ•°å˜æˆf2è¿›åˆ¶æ•°</td></tr></tbody></table><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT BIN(10),HEX(10),OCT(10),CONV(10,2,8)<br>    -&gt; FROM DUAL;<br>+---------+---------+---------+--------------+<br>| BIN(10) | HEX(10) | OCT(10) | CONV(10,2,8) |<br>+---------+---------+---------+--------------+<br>| 1010    | A       | 12      | 2            |<br>+---------+---------+---------+--------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><h2 id="3-å­—ç¬¦ä¸²å‡½æ•°"><a href="#3-å­—ç¬¦ä¸²å‡½æ•°" class="headerlink" title="3. å­—ç¬¦ä¸²å‡½æ•°"></a>3. å­—ç¬¦ä¸²å‡½æ•°</h2><table><thead><tr><th>å‡½æ•°</th><th>ç”¨æ³•</th></tr></thead><tbody><tr><td>ASCII(S)</td><td>è¿”å›å­—ç¬¦ä¸²Sä¸­çš„ç¬¬ä¸€ä¸ªå­—ç¬¦çš„ASCIIç å€¼</td></tr><tr><td>CHAR_LENGTH(s)</td><td>è¿”å›å­—ç¬¦ä¸²sçš„å­—ç¬¦æ•°ã€‚ä½œç”¨ä¸CHARACTER_LENGTH(s)ç›¸åŒ</td></tr><tr><td>LENGTH(s)</td><td>è¿”å›å­—ç¬¦ä¸²sçš„å­—èŠ‚æ•°ï¼Œå’Œå­—ç¬¦é›†æœ‰å…³</td></tr><tr><td>CONCAT(s1,s2,â€¦â€¦,sn)</td><td>è¿æ¥s1,s2,â€¦â€¦,snä¸ºä¸€ä¸ªå­—ç¬¦ä¸²</td></tr><tr><td>CONCAT_WS(x, s1,s2,â€¦â€¦,sn)</td><td>åŒCONCAT(s1,s2,â€¦)å‡½æ•°ï¼Œä½†æ˜¯æ¯ä¸ªå­—ç¬¦ä¸²ä¹‹é—´è¦åŠ ä¸Šx</td></tr><tr><td>INSERT(str, idx, len, replacestr)</td><td>å°†å­—ç¬¦ä¸²strä»ç¬¬idxä½ç½®å¼€å§‹ï¼Œlenä¸ªå­—ç¬¦é•¿çš„å­ä¸²æ›¿æ¢ä¸ºå­—ç¬¦ä¸²replacestrï¼ˆæ³¨æ„è¿™é‡Œçš„å­—ç¬¦ä¸²ç´¢å¼•æ˜¯ä»1å¼€å§‹çš„ï¼‰</td></tr><tr><td>REPLACE(str, a, b)</td><td>ç”¨å­—ç¬¦ä¸²bæ›¿æ¢å­—ç¬¦ä¸²strä¸­<strong>æ‰€æœ‰</strong>å‡ºç°çš„å­—ç¬¦ä¸²a</td></tr><tr><td>UPPER(s) æˆ– UCASE(s)</td><td>å°†å­—ç¬¦ä¸²sçš„æ‰€æœ‰å­—æ¯è½¬æˆå¤§å†™å­—æ¯</td></tr><tr><td>LOWER(s)  æˆ–LCASE(s)</td><td>å°†å­—ç¬¦ä¸²sçš„æ‰€æœ‰å­—æ¯è½¬æˆå°å†™å­—æ¯</td></tr><tr><td>LEFT(str,n)</td><td>è¿”å›å­—ç¬¦ä¸²stræœ€å·¦è¾¹çš„nä¸ªå­—ç¬¦</td></tr><tr><td>RIGHT(str,n)</td><td>è¿”å›å­—ç¬¦ä¸²stræœ€å³è¾¹çš„nä¸ªå­—ç¬¦</td></tr><tr><td>LPAD(str, len, pad)</td><td>ç”¨å­—ç¬¦ä¸²padå¯¹stræœ€å·¦è¾¹è¿›è¡Œå¡«å……ï¼Œç›´åˆ°strçš„é•¿åº¦ä¸ºlenä¸ªå­—ç¬¦</td></tr><tr><td>RPAD(str ,len, pad)</td><td>ç”¨å­—ç¬¦ä¸²padå¯¹stræœ€å³è¾¹è¿›è¡Œå¡«å……ï¼Œç›´åˆ°strçš„é•¿åº¦ä¸ºlenä¸ªå­—ç¬¦</td></tr><tr><td>LTRIM(s)</td><td>å»æ‰å­—ç¬¦ä¸²så·¦ä¾§çš„ç©ºæ ¼</td></tr><tr><td>RTRIM(s)</td><td>å»æ‰å­—ç¬¦ä¸²så³ä¾§çš„ç©ºæ ¼</td></tr><tr><td>TRIM(s)</td><td>å»æ‰å­—ç¬¦ä¸²så¼€å§‹ä¸ç»“å°¾çš„ç©ºæ ¼</td></tr><tr><td>TRIM(s1 FROM s)</td><td>å»æ‰å­—ç¬¦ä¸²så¼€å§‹ä¸ç»“å°¾çš„s1</td></tr><tr><td>TRIM(LEADING s1 FROM s)</td><td>å»æ‰å­—ç¬¦ä¸²så¼€å§‹å¤„çš„s1</td></tr><tr><td>TRIM(TRAILING s1 FROM s)</td><td>å»æ‰å­—ç¬¦ä¸²sç»“å°¾å¤„çš„s1</td></tr><tr><td>REPEAT(str, n)</td><td>è¿”å›stré‡å¤næ¬¡çš„ç»“æœ</td></tr><tr><td>SPACE(n)</td><td>è¿”å›nä¸ªç©ºæ ¼</td></tr><tr><td>STRCMP(s1,s2)</td><td>æ¯”è¾ƒå­—ç¬¦ä¸²s1,s2çš„ASCIIç å€¼çš„å¤§å°ï¼ˆs1 &gt; s2ï¼šè¿”å›1ï¼Œs1 &lt; s2:è¿”å›-1ï¼Œå¦åˆ™ï¼šè¿”å›0ï¼‰</td></tr><tr><td>SUBSTR(s,index,len)</td><td>è¿”å›ä»å­—ç¬¦ä¸²sçš„indexä½ç½®å…¶lenä¸ªå­—ç¬¦ï¼Œä½œç”¨ä¸SUBSTRING(s,n,len)ã€MID(s,n,len)ç›¸åŒ</td></tr><tr><td>LOCATE(substr,str)</td><td>è¿”å›å­—ç¬¦ä¸²substråœ¨å­—ç¬¦ä¸²strä¸­é¦–æ¬¡å‡ºç°çš„ä½ç½®ï¼Œä½œç”¨äºPOSITION(substr IN str)ã€INSTR(str,substr)ç›¸åŒã€‚æœªæ‰¾åˆ°ï¼Œè¿”å›0</td></tr><tr><td>ELT(m,s1,s2,â€¦,sn)</td><td>è¿”å›æŒ‡å®šä½ç½®çš„å­—ç¬¦ä¸²ï¼Œå¦‚æœm=1ï¼Œåˆ™è¿”å›s1ï¼Œå¦‚æœm=2ï¼Œåˆ™è¿”å›s2ï¼Œå¦‚æœm=nï¼Œåˆ™è¿”å›sn</td></tr><tr><td>FIELD(s,s1,s2,â€¦,sn)</td><td>è¿”å›å­—ç¬¦ä¸²såœ¨å­—ç¬¦ä¸²åˆ—è¡¨ä¸­ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®</td></tr><tr><td>FIND_IN_SET(s1,s2)</td><td>è¿”å›å­—ç¬¦ä¸²s1åœ¨å­—ç¬¦ä¸²s2ä¸­å‡ºç°çš„ä½ç½®ã€‚å…¶ä¸­ï¼Œå­—ç¬¦ä¸²s2æ˜¯ä¸€ä¸ªä»¥é€—å·åˆ†éš”çš„å­—ç¬¦ä¸²</td></tr><tr><td>REVERSE(s)</td><td>è¿”å›såè½¬åçš„å­—ç¬¦ä¸²</td></tr><tr><td>NULLIF(value1,value2)</td><td>æ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²ï¼Œå¦‚æœvalue1ä¸value2ç›¸ç­‰ï¼Œåˆ™è¿”å›NULLï¼Œå¦åˆ™è¿”å›value1</td></tr></tbody></table><blockquote><p>æ³¨æ„ï¼šMySQLä¸­ï¼Œå­—ç¬¦ä¸²çš„ä½ç½®æ˜¯ä»1å¼€å§‹çš„ã€‚</p><p>MySQLåœ¨åˆé€‚çš„æ—¶å€™ï¼Œæ•°å­—å’Œå­—ç¬¦ä¸²ä¼šè‡ªåŠ¨è½¬æ¢ã€‚</p></blockquote><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT FIELD(&#x27;mm&#x27;,&#x27;hello&#x27;,&#x27;msm&#x27;,&#x27;amma&#x27;),FIND_IN_SET(&#x27;mm&#x27;,&#x27;hello,mm,amma&#x27;)<br>    -&gt; FROM DUAL;<br>+----------------------------------+-----------------------------------+<br>| FIELD(&#x27;mm&#x27;,&#x27;hello&#x27;,&#x27;msm&#x27;,&#x27;amma&#x27;) | FIND_IN_SET(&#x27;mm&#x27;,&#x27;hello,mm,amma&#x27;) |<br>+----------------------------------+-----------------------------------+<br>|                                0 |                                 2 |<br>+----------------------------------+-----------------------------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT NULLIF(&#x27;mysql&#x27;,&#x27;mysql&#x27;),NULLIF(&#x27;mysql&#x27;, &#x27;&#x27;);<br>+-------------------------+---------------------+<br>| NULLIF(&#x27;mysql&#x27;,&#x27;mysql&#x27;) | NULLIF(&#x27;mysql&#x27;, &#x27;&#x27;) |<br>+-------------------------+---------------------+<br>| NULL                    | mysql               |<br>+-------------------------+---------------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><h2 id="4-æ—¥æœŸå’Œæ—¶é—´å‡½æ•°"><a href="#4-æ—¥æœŸå’Œæ—¶é—´å‡½æ•°" class="headerlink" title="4. æ—¥æœŸå’Œæ—¶é—´å‡½æ•°"></a>4. æ—¥æœŸå’Œæ—¶é—´å‡½æ•°</h2><h3 id="4-1-è·å–æ—¥æœŸã€æ—¶é—´"><a href="#4-1-è·å–æ—¥æœŸã€æ—¶é—´" class="headerlink" title="4.1 è·å–æ—¥æœŸã€æ—¶é—´"></a>4.1 è·å–æ—¥æœŸã€æ—¶é—´</h3><table><thead><tr><th>å‡½æ•°</th><th>ç”¨æ³•</th></tr></thead><tbody><tr><td><strong>CURDATE()</strong> ï¼ŒCURRENT_DATE()</td><td>è¿”å›å½“å‰æ—¥æœŸï¼ŒåªåŒ…å«å¹´ã€æœˆã€æ—¥</td></tr><tr><td><strong>CURTIME()</strong> ï¼Œ CURRENT_TIME()</td><td>è¿”å›å½“å‰æ—¶é—´ï¼ŒåªåŒ…å«æ—¶ã€åˆ†ã€ç§’</td></tr><tr><td><strong>NOW()</strong> / SYSDATE() / CURRENT_TIMESTAMP() / LOCALTIME() / LOCALTIMESTAMP()</td><td>è¿”å›å½“å‰ç³»ç»Ÿæ—¥æœŸå’Œæ—¶é—´</td></tr><tr><td>UTC_DATE()</td><td>è¿”å›UTCï¼ˆä¸–ç•Œæ ‡å‡†æ—¶é—´ï¼‰æ—¥æœŸ</td></tr><tr><td>UTC_TIME()</td><td>è¿”å›UTCï¼ˆä¸–ç•Œæ ‡å‡†æ—¶é—´ï¼‰æ—¶é—´ï¼ˆè‹±å›½æ—¶é—´ï¼‰</td></tr></tbody></table><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT CURDATE(),CURTIME(),NOW(),SYSDATE()+0,UTC_DATE(),UTC_DATE()+0,UTC_TIME(),UTC_TIME()+0<br>FROM DUAL;<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211025193742633.png"></p><h3 id="4-2-æ—¥æœŸä¸æ—¶é—´æˆ³çš„è½¬æ¢"><a href="#4-2-æ—¥æœŸä¸æ—¶é—´æˆ³çš„è½¬æ¢" class="headerlink" title="4.2 æ—¥æœŸä¸æ—¶é—´æˆ³çš„è½¬æ¢"></a>4.2 æ—¥æœŸä¸æ—¶é—´æˆ³çš„è½¬æ¢</h3><table><thead><tr><th>å‡½æ•°</th><th>ç”¨æ³•</th></tr></thead><tbody><tr><td>UNIX_TIMESTAMP()</td><td>ä»¥UNIXæ—¶é—´æˆ³çš„å½¢å¼è¿”å›å½“å‰æ—¶é—´ã€‚SELECT UNIX_TIMESTAMP() -&gt;1634348884</td></tr><tr><td>UNIX_TIMESTAMP(date)</td><td>å°†æ—¶é—´dateä»¥UNIXæ—¶é—´æˆ³çš„å½¢å¼è¿”å›ã€‚(dateä»¥MySQLæ—¶é—´æ ‡å‡†æ ¼å¼ç»™å‡ºå¦‚ï¼šâ€™2022-03-06 16:36:35â€™)</td></tr><tr><td>FROM_UNIXTIME(timestamp)</td><td>å°†UNIXæ—¶é—´æˆ³çš„æ—¶é—´è½¬æ¢ä¸ºæ™®é€šæ ¼å¼çš„æ—¶é—´</td></tr></tbody></table><p>æ—¶é—´æˆ³æ˜¯æŒ‡1970-1-1 00:00:00(UTC)åˆ°ç°åœ¨çš„æ¯«ç§’æ•°ã€‚</p><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT UNIX_TIMESTAMP(now());<br>+-----------------------+<br>| UNIX_TIMESTAMP(now()) |<br>+-----------------------+<br>|            1576380910 |<br>+-----------------------+<br>1 row in set (0.01 sec)<br><br>mysql&gt; SELECT UNIX_TIMESTAMP(CURDATE());<br>+---------------------------+<br>| UNIX_TIMESTAMP(CURDATE()) |<br>+---------------------------+<br>|                1576339200 |<br>+---------------------------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; SELECT UNIX_TIMESTAMP(CURTIME());<br>+---------------------------+<br>| UNIX_TIMESTAMP(CURTIME()) |<br>+---------------------------+<br>|                1576380969 |<br>+---------------------------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; SELECT UNIX_TIMESTAMP(&#x27;2011-11-11 11:11:11&#x27;)<br>+---------------------------------------+<br>| UNIX_TIMESTAMP(&#x27;2011-11-11 11:11:11&#x27;) |<br>+---------------------------------------+<br>|                            1320981071 |<br>+---------------------------------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT FROM_UNIXTIME(1576380910);<br>+---------------------------+<br>| FROM_UNIXTIME(1576380910) |<br>+---------------------------+<br>| 2019-12-15 11:35:10       |<br>+---------------------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><h3 id="4-3-è·å–æœˆä»½ã€æ˜ŸæœŸã€æ˜ŸæœŸæ•°ã€å¤©æ•°ç­‰å‡½æ•°"><a href="#4-3-è·å–æœˆä»½ã€æ˜ŸæœŸã€æ˜ŸæœŸæ•°ã€å¤©æ•°ç­‰å‡½æ•°" class="headerlink" title="4.3 è·å–æœˆä»½ã€æ˜ŸæœŸã€æ˜ŸæœŸæ•°ã€å¤©æ•°ç­‰å‡½æ•°"></a>4.3 è·å–æœˆä»½ã€æ˜ŸæœŸã€æ˜ŸæœŸæ•°ã€å¤©æ•°ç­‰å‡½æ•°</h3><table><thead><tr><th>å‡½æ•°</th><th>ç”¨æ³•</th></tr></thead><tbody><tr><td>YEAR(date) / MONTH(date) / DAY(date)</td><td>è¿”å›å…·ä½“çš„æ—¥æœŸå€¼</td></tr><tr><td>HOUR(time) / MINUTE(time) / SECOND(time)</td><td>è¿”å›å…·ä½“çš„æ—¶é—´å€¼</td></tr><tr><td>MONTHNAME(date)</td><td>è¿”å›æœˆä»½ï¼šJanuaryï¼Œâ€¦</td></tr><tr><td>DAYNAME(date)</td><td>è¿”å›æ˜ŸæœŸå‡ ï¼šMONDAYï¼ŒTUESDAYâ€¦..SUNDAY</td></tr><tr><td>WEEKDAY(date)</td><td>è¿”å›å‘¨å‡ ï¼Œæ³¨æ„ï¼Œå‘¨1æ˜¯0ï¼Œå‘¨2æ˜¯1ï¼Œã€‚ã€‚ã€‚å‘¨æ—¥æ˜¯6</td></tr><tr><td>QUARTER(date)</td><td>è¿”å›æ—¥æœŸå¯¹åº”çš„å­£åº¦ï¼ŒèŒƒå›´ä¸º1ï½4</td></tr><tr><td>WEEK(date) ï¼Œ WEEKOFYEAR(date)</td><td>è¿”å›ä¸€å¹´ä¸­çš„ç¬¬å‡ å‘¨</td></tr><tr><td>DAYOFYEAR(date)</td><td>è¿”å›æ—¥æœŸæ˜¯ä¸€å¹´ä¸­çš„ç¬¬å‡ å¤©</td></tr><tr><td>DAYOFMONTH(date)</td><td>è¿”å›æ—¥æœŸä½äºæ‰€åœ¨æœˆä»½çš„ç¬¬å‡ å¤©</td></tr><tr><td>DAYOFWEEK(date)</td><td>è¿”å›å‘¨å‡ ï¼Œæ³¨æ„ï¼šå‘¨æ—¥æ˜¯1ï¼Œå‘¨ä¸€æ˜¯2ï¼Œã€‚ã€‚ã€‚å‘¨å…­æ˜¯7</td></tr></tbody></table><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT YEAR(CURDATE()),MONTH(CURDATE()),DAY(CURDATE()),<br>HOUR(CURTIME()),MINUTE(NOW()),SECOND(SYSDATE())<br>FROM DUAL;<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211025213504115.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT MONTHNAME(&#x27;2021-10-26&#x27;),DAYNAME(&#x27;2021-10-26&#x27;),WEEKDAY(&#x27;2021-10-26&#x27;), #æ­¤å¤„åŒ…å«éšå¼è½¬æ¢ï¼Œä»å­—ç¬¦ä¸²åˆ°æ—¥æœŸç±»å‹<br>QUARTER(CURDATE()),WEEK(CURDATE()),DAYOFYEAR(NOW()),<br>DAYOFMONTH(NOW()),DAYOFWEEK(NOW())<br>FROM DUAL;<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211025214818623.png"></p><h3 id="4-4-æ—¥æœŸçš„æ“ä½œå‡½æ•°"><a href="#4-4-æ—¥æœŸçš„æ“ä½œå‡½æ•°" class="headerlink" title="4.4 æ—¥æœŸçš„æ“ä½œå‡½æ•°"></a>4.4 æ—¥æœŸçš„æ“ä½œå‡½æ•°</h3><table><thead><tr><th>å‡½æ•°</th><th>ç”¨æ³•</th></tr></thead><tbody><tr><td>EXTRACT(type FROM date)</td><td>è¿”å›æŒ‡å®šæ—¥æœŸä¸­ç‰¹å®šçš„éƒ¨åˆ†ï¼ŒtypeæŒ‡å®šè¿”å›çš„å€¼</td></tr></tbody></table><p>EXTRACT(type FROM date)å‡½æ•°ä¸­typeçš„å–å€¼ä¸å«ä¹‰ï¼šï¼ˆæ³¨æ„ä¸‹é¢çš„microsecondéƒ½æ˜¯å¾®ç§’ï¼Œè¿™é‡Œå†™é”™äº†ã€‚1microsecond = 1e-6 secondï¼‰</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211012142639469.png"></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211012142746444.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT EXTRACT(MINUTE FROM NOW()),EXTRACT( WEEK FROM NOW()),<br>EXTRACT( QUARTER FROM NOW()),EXTRACT( MINUTE_SECOND FROM NOW())<br>FROM DUAL;<br><br>#MySQL è¾ƒæ–°çš„ç‰ˆæœ¬ä¸­ï¼ˆMySQL 6.0.5ï¼‰ï¼Œä¹Ÿè¿˜æ²¡æœ‰äº§ç”Ÿå¾®ç§’çš„å‡½æ•°ï¼Œnow() åªèƒ½ç²¾ç¡®åˆ°ç§’ã€‚ MySQL ä¸­ä¹Ÿæ²¡æœ‰å­˜å‚¨å¸¦æœ‰æ¯«ç§’ã€å¾®ç§’çš„æ—¥æœŸæ—¶é—´ç±»å‹ã€‚æƒ³åœ¨ MySQL è·å¾—æ¯«ç§’ã€å¾®ç§’è¿˜æ˜¯è¦åœ¨åº”ç”¨å±‚ç¨‹åºä¸­æƒ³åŠæ³•ã€‚<br>select extract(microsecond from &#x27;12:00:00.123456&#x27;);             -- 123456<br>select extract(microsecond from &#x27;1997-12-31 23:59:59.000010&#x27;);  -- 10<br></code></pre></td></tr></table></figure><h3 id="4-5-æ—¶é—´å’Œç§’é’Ÿè½¬æ¢çš„å‡½æ•°"><a href="#4-5-æ—¶é—´å’Œç§’é’Ÿè½¬æ¢çš„å‡½æ•°" class="headerlink" title="4.5 æ—¶é—´å’Œç§’é’Ÿè½¬æ¢çš„å‡½æ•°"></a>4.5 æ—¶é—´å’Œç§’é’Ÿè½¬æ¢çš„å‡½æ•°</h3><table><thead><tr><th>å‡½æ•°</th><th>ç”¨æ³•</th></tr></thead><tbody><tr><td>TIME_TO_SEC(time)</td><td>å°† time è½¬åŒ–ä¸ºç§’å¹¶è¿”å›ç»“æœå€¼ã€‚è½¬åŒ–çš„å…¬å¼ä¸ºï¼š<code>å°æ—¶*3600+åˆ†é’Ÿ*60+ç§’</code></td></tr><tr><td>SEC_TO_TIME(seconds)</td><td>å°† seconds æè¿°è½¬åŒ–ä¸ºåŒ…å«å°æ—¶ã€åˆ†é’Ÿå’Œç§’çš„æ—¶é—´</td></tr></tbody></table><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT TIME_TO_SEC(NOW());<br>+--------------------+<br>| TIME_TO_SEC(NOW()) |<br>+--------------------+<br>|               78774 |<br>+--------------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT SEC_TO_TIME(78774);<br>+--------------------+<br>| SEC_TO_TIME(78774) |<br>+--------------------+<br>| 21:52:54            |<br>+--------------------+<br>1 row in set (0.12 sec)<br></code></pre></td></tr></table></figure><h3 id="4-6-è®¡ç®—æ—¥æœŸå’Œæ—¶é—´çš„å‡½æ•°"><a href="#4-6-è®¡ç®—æ—¥æœŸå’Œæ—¶é—´çš„å‡½æ•°" class="headerlink" title="4.6 è®¡ç®—æ—¥æœŸå’Œæ—¶é—´çš„å‡½æ•°"></a>4.6 è®¡ç®—æ—¥æœŸå’Œæ—¶é—´çš„å‡½æ•°</h3><p><strong>ç¬¬1ç»„ï¼š</strong></p><table><thead><tr><th>å‡½æ•°</th><th>ç”¨æ³•</th></tr></thead><tbody><tr><td>DATE_ADD(datetime, INTERVAL  expr type)ï¼ŒADDDATE(date,INTERVAL expr type)</td><td>è¿”å›ä¸ç»™å®šæ—¥æœŸæ—¶é—´ç›¸å·®INTERVALæ—¶é—´æ®µçš„æ—¥æœŸæ—¶é—´</td></tr><tr><td>DATE_SUB(date,INTERVAL expr type)ï¼ŒSUBDATE(date,INTERVAL expr type)</td><td>è¿”å›ä¸dateç›¸å·®INTERVALæ—¶é—´é—´éš”çš„æ—¥æœŸ</td></tr></tbody></table><p>ä¸Šè¿°å‡½æ•°ä¸­typeçš„å–å€¼ï¼š</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211012143203355.png"></p><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT DATE_ADD(NOW(), INTERVAL 1 DAY) AS col1,DATE_ADD(&#x27;2021-10-21 23:32:12&#x27;,INTERVAL 1 SECOND) AS col2,<br>ADDDATE(&#x27;2021-10-21 23:32:12&#x27;,INTERVAL 1 SECOND) AS col3,<br>DATE_ADD(&#x27;2021-10-21 23:32:12&#x27;,INTERVAL &#x27;1_1&#x27; MINUTE_SECOND) AS col4,<br>DATE_ADD(NOW(), INTERVAL -1 YEAR) AS col5, #å¯ä»¥æ˜¯è´Ÿæ•°<br>DATE_ADD(NOW(), INTERVAL &#x27;1_1&#x27; YEAR_MONTH) AS col6 #éœ€è¦å•å¼•å·<br>FROM DUAL;<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT DATE_SUB(&#x27;2021-01-21&#x27;,INTERVAL 31 DAY) AS col1,<br>SUBDATE(&#x27;2021-01-21&#x27;,INTERVAL 31 DAY) AS col2,<br>DATE_SUB(&#x27;2021-01-21 02:01:01&#x27;,INTERVAL &#x27;1 1&#x27; DAY_HOUR) AS col3<br>FROM DUAL;<br></code></pre></td></tr></table></figure><p><strong>ç¬¬2ç»„ï¼š</strong></p><table><thead><tr><th>å‡½æ•°</th><th>ç”¨æ³•</th></tr></thead><tbody><tr><td>ADDTIME(time1,time2)</td><td>è¿”å›time1åŠ ä¸Štime2çš„æ—¶é—´ã€‚å½“time2ä¸ºä¸€ä¸ªæ•°å­—æ—¶ï¼Œä»£è¡¨çš„æ˜¯<code>ç§’</code>ï¼Œå¯ä»¥ä¸ºè´Ÿæ•°</td></tr><tr><td>SUBTIME(time1,time2)</td><td>è¿”å›time1å‡å»time2åçš„æ—¶é—´ã€‚å½“time2ä¸ºä¸€ä¸ªæ•°å­—æ—¶ï¼Œä»£è¡¨çš„æ˜¯<code>ç§’</code>ï¼Œå¯ä»¥ä¸ºè´Ÿæ•°</td></tr><tr><td>DATEDIFF(date1,date2)</td><td>è¿”å›date1 - date2çš„æ—¥æœŸé—´éš”å¤©æ•°</td></tr><tr><td>TIMEDIFF(time1, time2)</td><td>è¿”å›time1 - time2çš„æ—¶é—´é—´Aéš”</td></tr><tr><td>FROM_DAYS(N)</td><td>è¿”å›ä»0000å¹´1æœˆ1æ—¥èµ·ï¼ŒNå¤©ä»¥åçš„æ—¥æœŸ</td></tr><tr><td>TO_DAYS(date)</td><td>è¿”å›æ—¥æœŸdateè·ç¦»0000å¹´1æœˆ1æ—¥çš„å¤©æ•°</td></tr><tr><td>LAST_DAY(date)</td><td>è¿”å›dateæ‰€åœ¨æœˆä»½çš„æœ€åä¸€å¤©çš„æ—¥æœŸ</td></tr><tr><td>MAKEDATE(year,n)</td><td>é’ˆå¯¹ç»™å®šå¹´ä»½ä¸æ‰€åœ¨å¹´ä»½ä¸­çš„å¤©æ•°è¿”å›ä¸€ä¸ªæ—¥æœŸ</td></tr><tr><td>MAKETIME(hour,minute,second)</td><td>å°†ç»™å®šçš„å°æ—¶ã€åˆ†é’Ÿå’Œç§’ç»„åˆæˆæ—¶é—´å¹¶è¿”å›</td></tr><tr><td>PERIOD_ADD(time,n)</td><td>è¿”å›timeåŠ ä¸Šnåçš„æ—¶é—´</td></tr></tbody></table><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT ADDTIME(NOW(),20),SUBTIME(NOW(),30),SUBTIME(NOW(),&#x27;1:1:3&#x27;),DATEDIFF(NOW(),&#x27;2021-10-01&#x27;),<br>TIMEDIFF(NOW(),&#x27;2021-10-25 22:10:10&#x27;),FROM_DAYS(366),TO_DAYS(&#x27;0000-12-25&#x27;),<br>LAST_DAY(NOW()),MAKEDATE(YEAR(NOW()),12),MAKETIME(10,21,23),PERIOD_ADD(20200101010101,10) #NOW() + 0 è½¬åŒ–ä¸ºæ•°å­—<br>FROM DUAL;<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT ADDTIME(NOW(), 50);<br>+---------------------+<br>| ADDTIME(NOW(), 50)  |<br>+---------------------+<br>| 2019-12-15 22:17:47 |<br>+---------------------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; SELECT ADDTIME(NOW(), &#x27;1:1:1&#x27;);<br>+-------------------------+<br>| ADDTIME(NOW(), &#x27;1:1:1&#x27;) |<br>+-------------------------+<br>| 2019-12-15 23:18:46     |<br>+-------------------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT SUBTIME(NOW(), &#x27;1:1:1&#x27;);<br>+-------------------------+<br>| SUBTIME(NOW(), &#x27;1:1:1&#x27;) |<br>+-------------------------+<br>| 2019-12-15 21:23:50     |<br>+-------------------------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; SELECT SUBTIME(NOW(), &#x27;-1:-1:-1&#x27;); <br>+----------------------------+<br>| SUBTIME(NOW(), &#x27;-1:-1:-1&#x27;) |<br>+----------------------------+<br>| 2019-12-15 22:25:11        |<br>+----------------------------+<br>1 row in set, 1 warning (0.00 sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT FROM_DAYS(366);<br>+----------------+<br>| FROM_DAYS(366) |<br>+----------------+<br>| 0001-01-01     |<br>+----------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT MAKEDATE(2020,1);<br>+------------------+<br>| MAKEDATE(2020,1) |<br>+------------------+<br>| 2020-01-01       |<br>+------------------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; SELECT MAKEDATE(2020,32);<br>+-------------------+<br>| MAKEDATE(2020,32) |<br>+-------------------+<br>| 2020-02-01        |<br>+-------------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT MAKETIME(1,1,1);<br>+-----------------+<br>| MAKETIME(1,1,1) |<br>+-----------------+<br>| 01:01:01        |<br>+-----------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT PERIOD_ADD(20200101010101,1);<br>+------------------------------+<br>| PERIOD_ADD(20200101010101,1) |<br>+------------------------------+<br>|               20200101010102 |<br>+------------------------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT TO_DAYS(NOW());<br>+----------------+<br>| TO_DAYS(NOW()) |<br>+----------------+<br>|          737773 |<br>+----------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>ä¸¾ä¾‹ï¼šæŸ¥è¯¢ 7 å¤©å†…çš„æ–°å¢ç”¨æˆ·æ•°æœ‰å¤šå°‘ï¼Ÿ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT COUNT(*) as num FROM new_user WHERE TO_DAYS(NOW())-TO_DAYS(regist_time)&lt;=7<br></code></pre></td></tr></table></figure><h3 id="4-7-æ—¥æœŸçš„æ ¼å¼åŒ–ä¸è§£æ"><a href="#4-7-æ—¥æœŸçš„æ ¼å¼åŒ–ä¸è§£æ" class="headerlink" title="4.7 æ—¥æœŸçš„æ ¼å¼åŒ–ä¸è§£æ"></a>4.7 æ—¥æœŸçš„æ ¼å¼åŒ–ä¸è§£æ</h3><table><thead><tr><th>å‡½æ•°</th><th>ç”¨æ³•</th></tr></thead><tbody><tr><td>DATE_FORMAT(date,fmt)</td><td>æŒ‰ç…§å­—ç¬¦ä¸²fmtæ ¼å¼åŒ–æ—¥æœŸdateå€¼</td></tr><tr><td>TIME_FORMAT(time,fmt)</td><td>æŒ‰ç…§å­—ç¬¦ä¸²fmtæ ¼å¼åŒ–æ—¶é—´timeå€¼</td></tr><tr><td>GET_FORMAT(date_type,format_type)</td><td>è¿”å›æ—¥æœŸå­—ç¬¦ä¸²çš„æ˜¾ç¤ºæ ¼å¼</td></tr><tr><td>STR_TO_DATE(str, fmt)</td><td>æŒ‰ç…§å­—ç¬¦ä¸²fmtå¯¹strè¿›è¡Œè§£æï¼Œè§£æä¸ºä¸€ä¸ªæ—¥æœŸ</td></tr></tbody></table><p>ä¸Šè¿°<code>éGET_FORMAT</code>å‡½æ•°ä¸­fmtå‚æ•°å¸¸ç”¨çš„æ ¼å¼ç¬¦ï¼š</p><table><thead><tr><th>æ ¼å¼ç¬¦</th><th>è¯´æ˜</th><th>æ ¼å¼ç¬¦</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>%Y</td><td>4ä½æ•°å­—è¡¨ç¤ºå¹´ä»½</td><td>%y</td><td>è¡¨ç¤ºä¸¤ä½æ•°å­—è¡¨ç¤ºå¹´ä»½</td></tr><tr><td>%M</td><td>æœˆåè¡¨ç¤ºæœˆä»½ï¼ˆJanuary,â€¦.ï¼‰</td><td>%m</td><td>ä¸¤ä½æ•°å­—è¡¨ç¤ºæœˆä»½ï¼ˆ01,02,03ã€‚ã€‚ã€‚ï¼‰</td></tr><tr><td>%b</td><td>ç¼©å†™çš„æœˆåï¼ˆJan.ï¼ŒFeb.ï¼Œâ€¦.ï¼‰</td><td>%c</td><td>æ•°å­—è¡¨ç¤ºæœˆä»½ï¼ˆ1,2,3,â€¦ï¼‰</td></tr><tr><td>%D</td><td>è‹±æ–‡åç¼€è¡¨ç¤ºæœˆä¸­çš„å¤©æ•°ï¼ˆ1st,2nd,3rd,â€¦ï¼‰</td><td>%d</td><td>ä¸¤ä½æ•°å­—è¡¨ç¤ºæœˆä¸­çš„å¤©æ•°(01,02â€¦)</td></tr><tr><td>%e</td><td>æ•°å­—å½¢å¼è¡¨ç¤ºæœˆä¸­çš„å¤©æ•°ï¼ˆ1,2,3,4,5â€¦..ï¼‰</td><td></td><td></td></tr><tr><td>%H</td><td>ä¸¤ä½æ•°å­—è¡¨ç¤ºå°æ•°ï¼Œ24å°æ—¶åˆ¶ï¼ˆ01,02..ï¼‰</td><td>%hå’Œ%I</td><td>ä¸¤ä½æ•°å­—è¡¨ç¤ºå°æ—¶ï¼Œ12å°æ—¶åˆ¶ï¼ˆ01,02..ï¼‰</td></tr><tr><td>%k</td><td>æ•°å­—å½¢å¼çš„å°æ—¶ï¼Œ24å°æ—¶åˆ¶(1,2,3)</td><td>%l</td><td>æ•°å­—å½¢å¼è¡¨ç¤ºå°æ—¶ï¼Œ12å°æ—¶åˆ¶ï¼ˆ1,2,3,4â€¦.ï¼‰</td></tr><tr><td>%i</td><td>ä¸¤ä½æ•°å­—è¡¨ç¤ºåˆ†é’Ÿï¼ˆ00,01,02ï¼‰</td><td>%Så’Œ%s</td><td>ä¸¤ä½æ•°å­—è¡¨ç¤ºç§’(00,01,02â€¦)</td></tr><tr><td>%W</td><td>ä¸€å‘¨ä¸­çš„æ˜ŸæœŸåç§°ï¼ˆSundayâ€¦ï¼‰</td><td>%a</td><td>ä¸€å‘¨ä¸­çš„æ˜ŸæœŸç¼©å†™ï¼ˆSun.ï¼ŒMon.,Tues.ï¼Œ..ï¼‰</td></tr><tr><td>%w</td><td>ä»¥æ•°å­—è¡¨ç¤ºå‘¨ä¸­çš„å¤©æ•°(0=Sunday,1=Mondayâ€¦.)</td><td></td><td></td></tr><tr><td>%j</td><td>ä»¥3ä½æ•°å­—è¡¨ç¤ºå¹´ä¸­çš„å¤©æ•°(001,002â€¦)</td><td>%U</td><td>ä»¥æ•°å­—è¡¨ç¤ºå¹´ä¸­çš„ç¬¬å‡ å‘¨ï¼Œï¼ˆ1,2,3ã€‚ã€‚ï¼‰å…¶ä¸­Sundayä¸ºå‘¨ä¸­ç¬¬ä¸€å¤©</td></tr><tr><td>%u</td><td>ä»¥æ•°å­—è¡¨ç¤ºå¹´ä¸­çš„ç¬¬å‡ å‘¨ï¼Œï¼ˆ1,2,3ã€‚ã€‚ï¼‰å…¶ä¸­Mondayä¸ºå‘¨ä¸­ç¬¬ä¸€å¤©</td><td></td><td></td></tr><tr><td>%T</td><td>24å°æ—¶åˆ¶</td><td>%r</td><td>12å°æ—¶åˆ¶</td></tr><tr><td>%p</td><td>AMæˆ–PM</td><td>%%</td><td>è¡¨ç¤º%</td></tr></tbody></table><p>GET_FORMATå‡½æ•°ä¸­date_typeå’Œformat_typeå‚æ•°å–å€¼å¦‚ä¸‹ï¼š</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211012145231321.png"></p><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT DATE_FORMAT(NOW(), &#x27;%H:%i:%s&#x27;);<br>+--------------------------------+<br>| DATE_FORMAT(NOW(), &#x27;%H:%i:%s&#x27;) |<br>+--------------------------------+<br>| 22:57:34                        |<br>+--------------------------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT STR_TO_DATE(&#x27;09/01/2009&#x27;,&#x27;%m/%d/%Y&#x27;)<br>FROM DUAL;<br><br>SELECT STR_TO_DATE(&#x27;20140422154706&#x27;,&#x27;%Y%m%d%H%i%s&#x27;)<br>FROM DUAL;<br><br>SELECT STR_TO_DATE(&#x27;2014-04-22 15:47:06&#x27;,&#x27;%Y-%m-%d %H:%i:%s&#x27;)<br>FROM DUAL;<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT GET_FORMAT(DATE, &#x27;USA&#x27;);<br>+-------------------------+<br>| GET_FORMAT(DATE, &#x27;USA&#x27;) |<br>+-------------------------+<br>| %m.%d.%Y                |<br>+-------------------------+<br>1 row in set (0.00 sec)<br><br>SELECT DATE_FORMAT(NOW(),GET_FORMAT(DATE,&#x27;USA&#x27;)),<br>FROM DUAL;<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT STR_TO_DATE(&#x27;2020-01-01 00:00:00&#x27;,&#x27;%Y-%m-%d&#x27;); <br>+-----------------------------------------------+<br>| STR_TO_DATE(&#x27;2020-01-01 00:00:00&#x27;,&#x27;%Y-%m-%d&#x27;) |<br>+-----------------------------------------------+<br>| 2020-01-01                                    |<br>+-----------------------------------------------+<br>1 row in set, 1 warning (0.00 sec)<br></code></pre></td></tr></table></figure><h2 id="5-æµç¨‹æ§åˆ¶å‡½æ•°"><a href="#5-æµç¨‹æ§åˆ¶å‡½æ•°" class="headerlink" title="5. æµç¨‹æ§åˆ¶å‡½æ•°"></a>5. æµç¨‹æ§åˆ¶å‡½æ•°</h2><p>æµç¨‹å¤„ç†å‡½æ•°å¯ä»¥æ ¹æ®ä¸åŒçš„æ¡ä»¶ï¼Œæ‰§è¡Œä¸åŒçš„å¤„ç†æµç¨‹ï¼Œå¯ä»¥åœ¨SQLè¯­å¥ä¸­å®ç°ä¸åŒçš„æ¡ä»¶é€‰æ‹©ã€‚MySQLä¸­çš„æµç¨‹å¤„ç†å‡½æ•°ä¸»è¦åŒ…æ‹¬IF()ã€IFNULL()å’ŒCASE()å‡½æ•°ã€‚</p><table><thead><tr><th>å‡½æ•°</th><th>ç”¨æ³•</th></tr></thead><tbody><tr><td>IF(value,value1,wvalue2)</td><td>å¦‚æœvalueçš„å€¼ä¸ºTRUEï¼Œè¿”å›value1ï¼Œå¦åˆ™è¿”å›value2</td></tr><tr><td>IFNULL(value1, value2)</td><td>å¦‚æœvalue1ä¸ä¸ºNULLï¼Œè¿”å›value1ï¼Œå¦åˆ™è¿”å›value2</td></tr><tr><td>CASE WHEN æ¡ä»¶1 THEN ç»“æœ1 WHEN æ¡ä»¶2 THEN ç»“æœ2 â€¦. [ELSE resultn] END</td><td>ç›¸å½“äºJavaçš„ifâ€¦else ifâ€¦elseâ€¦</td></tr><tr><td>CASE  expr WHEN å¸¸é‡å€¼1 THEN å€¼1 WHEN å¸¸é‡å€¼1 THEN å€¼1 â€¦. [ELSE å€¼n] END</td><td>ç›¸å½“äºJavaçš„switchâ€¦caseâ€¦</td></tr></tbody></table><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT IF(1 &gt; 0,&#x27;æ­£ç¡®&#x27;,&#x27;é”™è¯¯&#x27;)    <br>-&gt;æ­£ç¡®<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT IFNULL(null,&#x27;Hello Word&#x27;)<br>-&gt;Hello Word<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT CASE <br>ã€€ã€€WHEN 1 &gt; 0<br>ã€€ã€€THEN &#x27;1 &gt; 0&#x27;<br>ã€€ã€€WHEN 2 &gt; 0<br>ã€€ã€€THEN &#x27;2 &gt; 0&#x27;<br>ã€€ã€€ELSE &#x27;3 &gt; 0&#x27;<br>ã€€ã€€END<br>-&gt;1 &gt; 0<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT CASE 1 <br>ã€€ã€€WHEN 1 THEN &#x27;æˆ‘æ˜¯1&#x27;<br>ã€€ã€€WHEN 2 THEN &#x27;æˆ‘æ˜¯2&#x27;<br>ELSE &#x27;ä½ æ˜¯è°&#x27;<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT employee_id,salary, CASE WHEN salary&gt;=15000 THEN &#x27;é«˜è–ª&#x27; <br>  WHEN salary&gt;=10000 THEN &#x27;æ½œåŠ›è‚¡&#x27;  <br>  WHEN salary&gt;=8000 THEN &#x27;å±Œä¸&#x27; <br>  ELSE &#x27;è‰æ ¹&#x27; END  &quot;æè¿°&quot;<br>FROM employees; <br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT oid,`status`, CASE `status` WHEN 1 THEN &#x27;æœªä»˜æ¬¾&#x27; <br>   WHEN 2 THEN &#x27;å·²ä»˜æ¬¾&#x27; <br>   WHEN 3 THEN &#x27;å·²å‘è´§&#x27;  <br>   WHEN 4 THEN &#x27;ç¡®è®¤æ”¶è´§&#x27;  <br>   ELSE &#x27;æ— æ•ˆè®¢å•&#x27; END <br>FROM t_order;<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT CASE WHEN 1 &gt; 0 THEN &#x27;yes&#x27; WHEN 1 &lt;= 0 THEN &#x27;no&#x27; ELSE &#x27;unknown&#x27; END;<br>+---------------------------------------------------------------------+<br>| CASE WHEN 1 &gt; 0 THEN &#x27;yes&#x27; WHEN 1 &lt;= 0 THEN &#x27;no&#x27; ELSE &#x27;unknown&#x27; END |<br>+---------------------------------------------------------------------+<br>| yes                                                                  |<br>+---------------------------------------------------------------------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; SELECT CASE WHEN 1 &lt; 0 THEN &#x27;yes&#x27; WHEN 1 = 0 THEN &#x27;no&#x27; ELSE &#x27;unknown&#x27; END;  <br>+--------------------------------------------------------------------+<br>| CASE WHEN 1 &lt; 0 THEN &#x27;yes&#x27; WHEN 1 = 0 THEN &#x27;no&#x27; ELSE &#x27;unknown&#x27; END |<br>+--------------------------------------------------------------------+<br>| unknown                                                             |<br>+--------------------------------------------------------------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT CASE 1 WHEN 0 THEN 0 WHEN 1 THEN 1 ELSE -1 END;<br>+------------------------------------------------+<br>| CASE 1 WHEN 0 THEN 0 WHEN 1 THEN 1 ELSE -1 END |<br>+------------------------------------------------+<br>|                                               1 |<br>+------------------------------------------------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; SELECT CASE -1 WHEN 0 THEN 0 WHEN 1 THEN 1 ELSE -1 END;<br>+-------------------------------------------------+<br>| CASE -1 WHEN 0 THEN 0 WHEN 1 THEN 1 ELSE -1 END |<br>+-------------------------------------------------+<br>|                                               -1 |<br>+-------------------------------------------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT employee_id,12 * salary * (1 + IFNULL(commission_pct,0))<br>FROM employees;<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT last_name, job_id, salary,<br>       CASE job_id WHEN &#x27;IT_PROG&#x27;  THEN  1.10*salary<br>                   WHEN &#x27;ST_CLERK&#x27; THEN  1.15*salary<br>                   WHEN &#x27;SA_REP&#x27;   THEN  1.20*salary<br>          ELSE      salary END     &quot;REVISED_SALARY&quot;<br>FROM   employees;<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554980865631.png"></p><p><strong>ç»ƒä¹ ï¼šæŸ¥è¯¢éƒ¨é—¨å·ä¸º 10,20, 30 çš„å‘˜å·¥ä¿¡æ¯, è‹¥éƒ¨é—¨å·ä¸º 10, åˆ™æ‰“å°å…¶å·¥èµ„çš„ 1.1 å€, 20 å·éƒ¨é—¨, åˆ™æ‰“å°å…¶å·¥èµ„çš„ 1.2 å€, 30 å·éƒ¨é—¨æ‰“å°å…¶å·¥èµ„çš„ 1.3 å€æ•°ã€‚</strong></p><h2 id="6-åŠ å¯†ä¸è§£å¯†å‡½æ•°"><a href="#6-åŠ å¯†ä¸è§£å¯†å‡½æ•°" class="headerlink" title="6. åŠ å¯†ä¸è§£å¯†å‡½æ•°"></a>6. åŠ å¯†ä¸è§£å¯†å‡½æ•°</h2><p>åŠ å¯†ä¸è§£å¯†å‡½æ•°ä¸»è¦ç”¨äºå¯¹æ•°æ®åº“ä¸­çš„æ•°æ®è¿›è¡ŒåŠ å¯†å’Œè§£å¯†å¤„ç†ï¼Œä»¥é˜²æ­¢æ•°æ®è¢«ä»–äººçªƒå–ã€‚è¿™äº›å‡½æ•°åœ¨ä¿è¯æ•°æ®åº“å®‰å…¨æ—¶éå¸¸æœ‰ç”¨ã€‚</p><table><thead><tr><th>å‡½æ•°</th><th>ç”¨æ³•</th></tr></thead><tbody><tr><td>PASSWORD(str)</td><td>è¿”å›å­—ç¬¦ä¸²strçš„åŠ å¯†ç‰ˆæœ¬ï¼Œ41ä½é•¿çš„å­—ç¬¦ä¸²ã€‚åŠ å¯†ç»“æœ<code>ä¸å¯é€†</code>ï¼Œå¸¸ç”¨äºç”¨æˆ·çš„å¯†ç åŠ å¯†ã€‚ï¼ˆåœ¨MySQL8.0ä¸­è¢«å¼ƒç”¨ï¼Œä½¿ç”¨ä¼šæŠ¥é”™ï¼‰</td></tr><tr><td>MD5(str)</td><td>è¿”å›å­—ç¬¦ä¸²strçš„md5åŠ å¯†åçš„å€¼ï¼Œä¹Ÿæ˜¯ä¸€ç§åŠ å¯†æ–¹å¼ï¼ˆä¸å¯é€†ï¼‰ã€‚è‹¥å‚æ•°ä¸ºNULLï¼Œåˆ™ä¼šè¿”å›NULL</td></tr><tr><td>SHA(str)</td><td>ä»åŸæ˜æ–‡å¯†ç strè®¡ç®—å¹¶è¿”å›åŠ å¯†åçš„å¯†ç å­—ç¬¦ä¸²ï¼Œå½“å‚æ•°ä¸ºNULLæ—¶ï¼Œè¿”å›NULLã€‚<code>SHAåŠ å¯†ç®—æ³•æ¯”MD5æ›´åŠ å®‰å…¨</code>ã€‚</td></tr><tr><td>ENCODE(value,password_seed)</td><td>è¿”å›ä½¿ç”¨password_seedä½œä¸ºåŠ å¯†å¯†ç åŠ å¯†valueï¼ˆåœ¨MySQL8.0ä¸­è¢«å¼ƒç”¨ï¼Œä½¿ç”¨ä¼šæŠ¥é”™ï¼‰</td></tr><tr><td>DECODE(value,password_seed)</td><td>è¿”å›ä½¿ç”¨password_seedä½œä¸ºåŠ å¯†å¯†ç è§£å¯†valueï¼ˆåœ¨MySQL8.0ä¸­è¢«å¼ƒç”¨ï¼Œä½¿ç”¨ä¼šæŠ¥é”™ï¼‰</td></tr></tbody></table><p>å¯ä»¥çœ‹åˆ°ï¼ŒENCODE(value,password_seed)å‡½æ•°ä¸DECODE(value,password_seed)å‡½æ•°äº’ä¸ºåå‡½æ•°ã€‚</p><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT PASSWORD(&#x27;mysql&#x27;), PASSWORD(NULL);<br>+-------------------------------------------+----------------+<br>| PASSWORD(&#x27;mysql&#x27;)                         | PASSWORD(NULL) |<br>+-------------------------------------------+----------------+<br>| *E74858DB86EBA20BC33D0AECAE8A8108C56B17FA |                |<br>+-------------------------------------------+----------------+<br>1 row in set, 1 warning (0.00 sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT md5(&#x27;123&#x27;)<br>-&gt;202cb962ac59075b964b07152d234b70<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT SHA(&#x27;Tom123&#x27;)<br>-&gt;c7c506980abc31cc390a2438c90861d0f1216d50<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT ENCODE(&#x27;mysql&#x27;, &#x27;mysql&#x27;);<br>+--------------------------+<br>| ENCODE(&#x27;mysql&#x27;, &#x27;mysql&#x27;) |<br>+--------------------------+<br>| Ã­gã€€Â¼ã€€Ã¬Ã‰                  |<br>+--------------------------+<br>1 row in set, 1 warning (0.01 sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT DECODE(ENCODE(&#x27;mysql&#x27;,&#x27;mysql&#x27;),&#x27;mysql&#x27;);<br>+-----------------------------------------+<br>| DECODE(ENCODE(&#x27;mysql&#x27;,&#x27;mysql&#x27;),&#x27;mysql&#x27;) |<br>+-----------------------------------------+<br>| mysql                                   |<br>+-----------------------------------------+<br>1 row in set, 2 warnings (0.00 sec)<br></code></pre></td></tr></table></figure><h2 id="7-MySQLä¿¡æ¯å‡½æ•°"><a href="#7-MySQLä¿¡æ¯å‡½æ•°" class="headerlink" title="7. MySQLä¿¡æ¯å‡½æ•°"></a>7. MySQLä¿¡æ¯å‡½æ•°</h2><p>MySQLä¸­å†…ç½®äº†ä¸€äº›å¯ä»¥æŸ¥è¯¢MySQLä¿¡æ¯çš„å‡½æ•°ï¼Œè¿™äº›å‡½æ•°ä¸»è¦ç”¨äºå¸®åŠ©æ•°æ®åº“å¼€å‘æˆ–è¿ç»´äººå‘˜æ›´å¥½åœ°å¯¹æ•°æ®åº“è¿›è¡Œç»´æŠ¤å·¥ä½œã€‚</p><table><thead><tr><th>å‡½æ•°</th><th>ç”¨æ³•</th></tr></thead><tbody><tr><td>VERSION()</td><td>è¿”å›å½“å‰MySQLçš„ç‰ˆæœ¬å·</td></tr><tr><td>CONNECTION_ID()</td><td>è¿”å›å½“å‰MySQLæœåŠ¡å™¨çš„è¿æ¥id</td></tr><tr><td>DATABASE()ï¼ŒSCHEMA()</td><td>è¿”å›MySQLå‘½ä»¤è¡Œå½“å‰æ‰€åœ¨çš„æ•°æ®åº“</td></tr><tr><td>USER()ï¼ŒCURRENT_USER()ã€SYSTEM_USER()ï¼ŒSESSION_USER()</td><td>è¿”å›å½“å‰è¿æ¥MySQLçš„ç”¨æˆ·åï¼Œè¿”å›ç»“æœæ ¼å¼ä¸ºâ€œä¸»æœºå@ç”¨æˆ·åâ€</td></tr><tr><td>CHARSET(value)</td><td>è¿”å›å­—ç¬¦ä¸²valueè‡ªå˜é‡çš„å­—ç¬¦é›†</td></tr><tr><td>COLLATION(value)</td><td>è¿”å›å­—ç¬¦ä¸²valueçš„æ¯”è¾ƒè§„åˆ™</td></tr></tbody></table><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT DATABASE();<br>+------------+<br>| DATABASE() |<br>+------------+<br>| test       |<br>+------------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; SELECT DATABASE();<br>+------------+<br>| DATABASE() |<br>+------------+<br>| test       |<br>+------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT USER(), CURRENT_USER(), SYSTEM_USER(),SESSION_USER();<br>+----------------+----------------+----------------+----------------+<br>| USER()         | CURRENT_USER() | SYSTEM_USER()  | SESSION_USER() |<br>+----------------+----------------+----------------+----------------+<br>| root@localhost | root@localhost | root@localhost | root@localhost |<br>+----------------+----------------+----------------+----------------+<br><br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT CHARSET(&#x27;ABC&#x27;);<br>+----------------+<br>| CHARSET(&#x27;ABC&#x27;) |<br>+----------------+<br>| utf8mb4        |<br>+----------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT COLLATION(&#x27;ABC&#x27;);<br>+--------------------+<br>| COLLATION(&#x27;ABC&#x27;)   |<br>+--------------------+<br>| utf8mb4_general_ci |<br>+--------------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><h2 id="8-å…¶ä»–å‡½æ•°"><a href="#8-å…¶ä»–å‡½æ•°" class="headerlink" title="8. å…¶ä»–å‡½æ•°"></a>8. å…¶ä»–å‡½æ•°</h2><p>MySQLä¸­æœ‰äº›å‡½æ•°æ— æ³•å¯¹å…¶è¿›è¡Œå…·ä½“çš„åˆ†ç±»ï¼Œä½†æ˜¯è¿™äº›å‡½æ•°åœ¨MySQLçš„å¼€å‘å’Œè¿ç»´è¿‡ç¨‹ä¸­ä¹Ÿæ˜¯ä¸å®¹å¿½è§†çš„ã€‚</p><table><thead><tr><th>å‡½æ•°</th><th>ç”¨æ³•</th></tr></thead><tbody><tr><td>FORMAT(value,n)</td><td>è¿”å›å¯¹æ•°å­—valueè¿›è¡Œæ ¼å¼åŒ–åçš„ç»“æœæ•°æ®ã€‚nè¡¨ç¤º<code>å››èˆäº”å…¥</code>åä¿ç•™åˆ°å°æ•°ç‚¹ånä½   (å¦‚æœnçš„å€¼å°äºæˆ–è€…ç­‰äº0ï¼Œåˆ™åªä¿ç•™æ•´æ•°éƒ¨åˆ†)</td></tr><tr><td>CONV(value,from,to)</td><td>å°†valueçš„å€¼è¿›è¡Œä¸åŒè¿›åˆ¶ä¹‹é—´çš„è½¬æ¢</td></tr><tr><td>INET_ATON(ipvalue)</td><td>å°†ä»¥ç‚¹åˆ†éš”çš„IPåœ°å€è½¬åŒ–ä¸ºä¸€ä¸ªæ•°å­—</td></tr><tr><td>INET_NTOA(value)</td><td>å°†æ•°å­—å½¢å¼çš„IPåœ°å€è½¬åŒ–ä¸ºä»¥ç‚¹åˆ†éš”çš„IPåœ°å€</td></tr><tr><td>BENCHMARK(n,expr)</td><td>å°†è¡¨è¾¾å¼expré‡å¤æ‰§è¡Œnæ¬¡ã€‚ç”¨äºæµ‹è¯•MySQLå¤„ç†exprè¡¨è¾¾å¼æ‰€è€—è´¹çš„æ—¶é—´</td></tr><tr><td>CONVERT(value USING char_code)</td><td>å°†valueæ‰€ä½¿ç”¨çš„å­—ç¬¦ç¼–ç ä¿®æ”¹ä¸ºchar_code</td></tr></tbody></table><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mysql"># å¦‚æœnçš„å€¼å°äºæˆ–è€…ç­‰äº0ï¼Œåˆ™åªä¿ç•™æ•´æ•°éƒ¨åˆ†<br>mysql&gt; SELECT FORMAT(123.123, 2), FORMAT(123.523, 0), FORMAT(123.123, -2); <br>+--------------------+--------------------+---------------------+<br>| FORMAT(123.123, 2) | FORMAT(123.523, 0) | FORMAT(123.123, -2) |<br>+--------------------+--------------------+---------------------+<br>| 123.12             | 124                | 123                 |<br>+--------------------+--------------------+---------------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT CONV(16, 10, 2), CONV(8888,10,16), CONV(NULL, 10, 2);<br>+-----------------+------------------+-------------------+<br>| CONV(16, 10, 2) | CONV(8888,10,16) | CONV(NULL, 10, 2) |<br>+-----------------+------------------+-------------------+<br>| 10000           | 22B8             | NULL              |<br>+-----------------+------------------+-------------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT INET_ATON(&#x27;192.168.1.100&#x27;);<br>+----------------------------+<br>| INET_ATON(&#x27;192.168.1.100&#x27;) |<br>+----------------------------+<br>|                 3232235876 |<br>+----------------------------+<br>1 row in set (0.00 sec)<br><br># ä»¥â€œ192.168.1.100â€ä¸ºä¾‹ï¼Œè®¡ç®—æ–¹å¼ä¸º192ä¹˜ä»¥256çš„3æ¬¡æ–¹ï¼ŒåŠ ä¸Š168ä¹˜ä»¥256çš„2æ¬¡æ–¹ï¼ŒåŠ ä¸Š1ä¹˜ä»¥256ï¼Œå†åŠ ä¸Š100ã€‚<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT INET_NTOA(3232235876);<br>+-----------------------+<br>| INET_NTOA(3232235876) |<br>+-----------------------+<br>| 192.168.1.100         |<br>+-----------------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT BENCHMARK(1, MD5(&#x27;mysql&#x27;));<br>+----------------------------+<br>| BENCHMARK(1, MD5(&#x27;mysql&#x27;)) |<br>+----------------------------+<br>|                          0 |<br>+----------------------------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; SELECT BENCHMARK(1000000, MD5(&#x27;mysql&#x27;)); <br>+----------------------------------+<br>| BENCHMARK(1000000, MD5(&#x27;mysql&#x27;)) |<br>+----------------------------------+<br>|                                0 |<br>+----------------------------------+<br>1 row in set (0.20 sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT CHARSET(&#x27;mysql&#x27;), CHARSET(CONVERT(&#x27;mysql&#x27; USING &#x27;utf8&#x27;));<br>+------------------+----------------------------------------+<br>| CHARSET(&#x27;mysql&#x27;) | CHARSET(CONVERT(&#x27;mysql&#x27; USING &#x27;utf8&#x27;)) |<br>+------------------+----------------------------------------+<br>| utf8mb4          | utf8                                   |<br>+------------------+----------------------------------------+<br>1 row in set, 1 warning (0.00 sec)<br></code></pre></td></tr></table></figure><h1 id="ç¬¬08ç« -èšåˆå‡½æ•°"><a href="#ç¬¬08ç« -èšåˆå‡½æ•°" class="headerlink" title="ç¬¬08ç« _èšåˆå‡½æ•°"></a>ç¬¬08ç« _èšåˆå‡½æ•°</h1><p>æˆ‘ä»¬ä¸Šä¸€ç« è®²åˆ°äº† SQL å•è¡Œå‡½æ•°ã€‚å®é™…ä¸Š SQL å‡½æ•°è¿˜æœ‰ä¸€ç±»ï¼Œå«åšèšåˆï¼ˆæˆ–èšé›†ã€åˆ†ç»„ï¼‰å‡½æ•°ï¼Œå®ƒæ˜¯å¯¹ä¸€ç»„æ•°æ®è¿›è¡Œæ±‡æ€»çš„å‡½æ•°ï¼Œè¾“å…¥çš„æ˜¯ä¸€ç»„æ•°æ®çš„é›†åˆï¼Œè¾“å‡ºçš„æ˜¯å•ä¸ªå€¼ã€‚</p><h2 id="1-èšåˆå‡½æ•°ä»‹ç»"><a href="#1-èšåˆå‡½æ•°ä»‹ç»" class="headerlink" title="1. èšåˆå‡½æ•°ä»‹ç»"></a>1. èšåˆå‡½æ•°ä»‹ç»</h2><ul><li><strong>ä»€ä¹ˆæ˜¯èšåˆå‡½æ•°</strong></li></ul><p>èšåˆå‡½æ•°ä½œç”¨äºä¸€ç»„æ•°æ®ï¼Œå¹¶å¯¹ä¸€ç»„æ•°æ®è¿”å›ä¸€ä¸ªå€¼ã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554980924940.png"></p><ul><li><p><strong>èšåˆå‡½æ•°ç±»å‹</strong></p><ul><li><strong>AVG()</strong> </li><li><strong>SUM()</strong></li><li><strong>MAX()</strong> </li><li><strong>MIN()</strong> </li><li>**COUNT() **</li></ul></li><li><p>èšåˆå‡½æ•°è¯­æ³•</p></li></ul><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554981029920.png"></p><ul><li>èšåˆå‡½æ•°ä¸èƒ½åµŒå¥—è°ƒç”¨ã€‚æ¯”å¦‚ä¸èƒ½å‡ºç°ç±»ä¼¼â€œAVG(SUM(å­—æ®µåç§°))â€å½¢å¼çš„è°ƒç”¨ã€‚</li></ul><h3 id="1-1-AVGå’ŒSUMå‡½æ•°"><a href="#1-1-AVGå’ŒSUMå‡½æ•°" class="headerlink" title="1.1 AVGå’ŒSUMå‡½æ•°"></a>1.1 AVGå’ŒSUMå‡½æ•°</h3><p>å¯ä»¥å¯¹<strong>æ•°å€¼å‹æ•°æ®</strong>ä½¿ç”¨AVG å’Œ SUM å‡½æ•°ã€‚å¯¹äºä¸æ˜¯æ•°å€¼ç±»å‹çš„ï¼Œç»“æœæ— æ„ä¹‰ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">AVG</span>(salary), <span class="hljs-built_in">MAX</span>(salary),<span class="hljs-built_in">MIN</span>(salary), <span class="hljs-built_in">SUM</span>(salary)<br><span class="hljs-keyword">FROM</span>   employees<br><span class="hljs-keyword">WHERE</span>  job_id <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;%REP%&#x27;</span>;<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554981279723.png"></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-built_in">AVG</span>(<span class="hljs-keyword">DISTINCT</span> expression)<br></code></pre></td></tr></table></figure><p>æ‚¨å¯ä»¥ä½¿ç”¨AVG()å‡½æ•°ä¸­çš„<a href="http://www.yiibai.com/mysql/distinct.html">DISTINCT</a><a href="https://so.csdn.net/so/search?q=%E8%BF%90%E7%AE%97%E7%AC%A6&spm=1001.2101.3001.7020">è¿ç®—ç¬¦</a>æ¥è®¡ç®—ä¸åŒå€¼çš„å¹³å‡å€¼ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æœ‰ä¸€ç»„å€¼<code>1</code>,<code>1</code>,<code>2</code>,<code>3</code>ï¼Œå…·æœ‰<code>DISTINCT</code>æ“ä½œçš„AVG()å‡½æ•°å°†è¿”å›ä¸åŒå€¼çš„å’Œï¼Œå³ï¼š<code>(1 + 2 + 3)/3 = 2.00</code>ã€‚</p><h3 id="1-2-MINå’ŒMAXå‡½æ•°"><a href="#1-2-MINå’ŒMAXå‡½æ•°" class="headerlink" title="1.2 MINå’ŒMAXå‡½æ•°"></a>1.2 MINå’ŒMAXå‡½æ•°</h3><p>å¯ä»¥å¯¹<strong>ä»»æ„æ•°æ®ç±»å‹</strong>çš„æ•°æ®ä½¿ç”¨ MIN å’Œ MAX å‡½æ•°ã€‚å­—ç¬¦ä¸²ç”±äºæœ‰æ¯”è¾ƒè§„åˆ™ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨MIN / MAXå‡½æ•°ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">MIN</span>(hire_date), <span class="hljs-built_in">MAX</span>(hire_date)<br><span class="hljs-keyword">FROM</span>  employees;<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554981253194.png"></p><h3 id="1-3-COUNTå‡½æ•°"><a href="#1-3-COUNTå‡½æ•°" class="headerlink" title="1.3 COUNTå‡½æ•°"></a>1.3 COUNTå‡½æ•°</h3><ul><li>COUNT(*)è¿”å›è¡¨ä¸­è®°å½•æ€»æ•°ï¼Œé€‚ç”¨äº<strong>ä»»æ„æ•°æ®ç±»å‹</strong>ã€‚</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>)<br><span class="hljs-keyword">FROM</span>  employees<br><span class="hljs-keyword">WHERE</span>  department_id <span class="hljs-operator">=</span> <span class="hljs-number">50</span>;<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554981241299.png"></p><ul><li>COUNT(expr) è¿”å›<strong>exprä¸ä¸ºç©º</strong>çš„è®°å½•æ€»æ•°ã€‚</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(commission_pct)<br><span class="hljs-keyword">FROM</span>   employees<br><span class="hljs-keyword">WHERE</span>  department_id <span class="hljs-operator">=</span> <span class="hljs-number">50</span>;<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554981328678.png"></p><ul><li><p><strong>é—®é¢˜ï¼šç”¨count(*)ï¼Œcount(1)ï¼Œcount(åˆ—å)è°å¥½å‘¢?</strong></p><p>å…¶å®ï¼Œå¯¹äºMyISAMå¼•æ“çš„è¡¨æ˜¯æ²¡æœ‰åŒºåˆ«çš„ã€‚è¿™ç§å¼•æ“å†…éƒ¨æœ‰ä¸€è®¡æ•°å™¨åœ¨ç»´æŠ¤ç€è¡Œæ•°ã€‚</p><p>Innodbå¼•æ“çš„è¡¨ç”¨count(<em>),count(1),count(2)â€¦â€¦ç›´æ¥è¯»è¡Œæ•°ï¼Œå¤æ‚åº¦æ˜¯O(n)ï¼Œå› ä¸ºinnodbçœŸçš„è¦å»æ•°ä¸€éã€‚ä½†å¥½äºå…·ä½“çš„count(åˆ—å)ã€‚*<em>count(null)æ˜¯0ã€‚</em></em></p></li><li><p><strong>é—®é¢˜ï¼šèƒ½ä¸èƒ½ä½¿ç”¨count(åˆ—å)æ›¿æ¢count(*)?</strong></p><p>ä¸è¦ä½¿ç”¨ count(åˆ—å)æ¥æ›¿ä»£ <code>count(*)</code>ï¼Œ<code>count(*)</code>æ˜¯ SQL92 å®šä¹‰çš„æ ‡å‡†ç»Ÿè®¡è¡Œæ•°çš„è¯­æ³•ï¼Œè·Ÿæ•°æ®åº“æ— å…³ï¼Œè·Ÿ NULL å’Œé NULL æ— å…³ã€‚ </p><p>è¯´æ˜ï¼šcount(*)ä¼šç»Ÿè®¡å€¼ä¸º NULL çš„è¡Œï¼Œè€Œ count(åˆ—å)ä¸ä¼šç»Ÿè®¡æ­¤åˆ—ä¸º NULL å€¼çš„è¡Œã€‚</p></li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">AVG</span>(salary), <span class="hljs-built_in">SUM</span>(salary) <span class="hljs-operator">/</span> <span class="hljs-built_in">COUNT</span>(salary), <span class="hljs-built_in">AVG</span>(commission_pct), <span class="hljs-built_in">SUM</span>(commission_pct) <span class="hljs-operator">/</span> <span class="hljs-built_in">COUNT</span>(commission_pct), <span class="hljs-built_in">SUM</span>(commission_pct) <span class="hljs-operator">/</span> <span class="hljs-number">107</span><br><span class="hljs-keyword">FROM</span> employees;<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20220307184608281.png"></p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒSUM / AVG / COUNTå‡ä¸è€ƒè™‘NULLå€¼ï¼ˆè¿‡æ»¤æ‰NULLå€¼ï¼Œå½“åšä¸å­˜åœ¨ï¼‰ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">#æ­£ç¡®å†™æ³•<br><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">AVG</span>(IFNULL(commission_pct,<span class="hljs-number">0</span>)), <span class="hljs-built_in">SUM</span>(IFNULL(commission_pct, <span class="hljs-number">0</span>)) <span class="hljs-operator">/</span> <span class="hljs-built_in">COUNT</span>(IFNULL(commission_pct, <span class="hljs-number">0</span>))<br><span class="hljs-keyword">FROM</span> employees;<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20220307185315221.png"></p><h2 id="2-GROUP-BY"><a href="#2-GROUP-BY" class="headerlink" title="2. GROUP BY"></a>2. GROUP BY</h2><h3 id="2-1-åŸºæœ¬ä½¿ç”¨"><a href="#2-1-åŸºæœ¬ä½¿ç”¨" class="headerlink" title="2.1 åŸºæœ¬ä½¿ç”¨"></a>2.1 åŸºæœ¬ä½¿ç”¨</h3><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554981374920.png"></p><p><strong>å¯ä»¥ä½¿ç”¨GROUP BYå­å¥å°†è¡¨ä¸­çš„æ•°æ®åˆ†æˆè‹¥å¹²ç»„</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">column</span>, group_function(<span class="hljs-keyword">column</span>)<br><span class="hljs-keyword">FROM</span> <span class="hljs-keyword">table</span><br>[<span class="hljs-keyword">WHERE</span><span class="hljs-keyword">condition</span>]<br>[<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span>group_by_expression]<br>[<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span><span class="hljs-keyword">column</span>];<br></code></pre></td></tr></table></figure><blockquote><p><strong>æ˜ç¡®ï¼šWHEREä¸€å®šæ”¾åœ¨FROMåé¢</strong></p></blockquote><p><strong>åœ¨SELECTåˆ—è¡¨ä¸­æ‰€æœ‰æœªåŒ…å«åœ¨ç»„å‡½æ•°ä¸­çš„åˆ—éƒ½åº”è¯¥åŒ…å«åœ¨ GROUP BYå­å¥ä¸­</strong>ï¼ŒMySQL5.7ä¸æŠ¥é”™ï¼ŒMySQL8.0æŠ¥é”™ã€‚MySQLæœ‰æ—¶å€™å‡ºé”™ï¼Œä¹Ÿä¸æŠ¥é”™ï¼ˆå¯èƒ½å¯ä»¥æ‰§è¡Œä½†æ˜¯ç»“æœä¸å¯¹ï¼‰</p><p><strong>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒSQL92ä¸å…è®¸ä¸åŒ…å«åœ¨group byå­å¥ä¸­çš„åˆ—ã€‚ä½†æ˜¯SQL99åŠä¹‹åï¼ŒMySQL5.7.5ä¹‹åï¼Œå¯ç”¨ONLY_FULL_GROUP_BY SQLæ¨¡å¼æ—¶ï¼ŒMySQL 5.7.5å’Œæ›´é«˜ç‰ˆæœ¬è¿˜å…è®¸åœ¨GROUP BYå­å¥ä¸­æœªå‘½åçš„éèšåˆåˆ—ï¼Œä½†å‰ææ˜¯è¯¥åˆ—é™äºå•ä¸ªå€¼ã€‚</strong>ä¸è¿‡æœ€å¥½ä¸è¦ä½¿ç”¨ï¼Œå¯èƒ½ä¼šäº§ç”Ÿæ„æƒ³ä¸åˆ°çš„æƒ…å†µï¼Œå¯ä»¥å†å¥—ä¸Šä¸€å±‚å­æŸ¥è¯¢è¾¾åˆ°éœ€è¦çš„æ•ˆæœã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span>   department_id, <span class="hljs-built_in">AVG</span>(salary)<br><span class="hljs-keyword">FROM</span>     employees<br><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> department_id ;<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554981539408.png"></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554981544191.png" alt="1554981544191"></p><p>åŒ…å«åœ¨ GROUP BY å­å¥ä¸­çš„åˆ—ä¸å¿…åŒ…å«åœ¨SELECT åˆ—è¡¨ä¸­</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span>   <span class="hljs-built_in">AVG</span>(salary)<br><span class="hljs-keyword">FROM</span>     employees<br><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> department_id ;<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554981574152.png"></p><h3 id="2-2-ä½¿ç”¨å¤šä¸ªåˆ—åˆ†ç»„"><a href="#2-2-ä½¿ç”¨å¤šä¸ªåˆ—åˆ†ç»„" class="headerlink" title="2.2 ä½¿ç”¨å¤šä¸ªåˆ—åˆ†ç»„"></a>2.2 ä½¿ç”¨å¤šä¸ªåˆ—åˆ†ç»„</h3><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554981607442.png"></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span>   department_id dept_id, job_id, <span class="hljs-built_in">SUM</span>(salary)<br><span class="hljs-keyword">FROM</span>     employees<br><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> department_id, job_id ;<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554981624864.png"></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554981629733.png"></p><h3 id="2-3-GROUP-BYä¸­ä½¿ç”¨WITH-ROLLUP"><a href="#2-3-GROUP-BYä¸­ä½¿ç”¨WITH-ROLLUP" class="headerlink" title="2.3 GROUP BYä¸­ä½¿ç”¨WITH ROLLUP"></a>2.3 GROUP BYä¸­ä½¿ç”¨WITH ROLLUP</h3><p>ä½¿ç”¨<code>WITH ROLLUP</code>å…³é”®å­—ä¹‹åï¼Œåœ¨æ‰€æœ‰æŸ¥è¯¢å‡ºçš„åˆ†ç»„è®°å½•ä¹‹åå¢åŠ ä¸€æ¡è®°å½•ï¼Œè¯¥è®°å½•è®¡ç®—æŸ¥è¯¢å‡ºçš„æ‰€æœ‰è®°å½•çš„èšåˆå‡½æ•°ï¼Œå³ç»Ÿè®¡è®°å½•æ•°é‡ã€‚<strong>å³å°†æ¯ç»„çš„èšåˆç»“æœè¿›è¡Œæ±‚å’Œï¼Œæ–¹ä¾¿æŸ¥çœ‹ç»Ÿè®¡ç»“æœã€‚</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT year, country, product, SUM(profit) AS profit<br>       FROM sales<br>       GROUP BY year, country, product;<br>+------+---------+------------+--------+<br>| year | country | product    | profit |<br>+------+---------+------------+--------+<br>| 2000 | Finland | Computer   |   1500 |<br>| 2000 | Finland | Phone      |    100 |<br>| 2000 | India   | Calculator |    150 |<br>| 2000 | India   | Computer   |   1200 |<br>| 2000 | USA     | Calculator |     75 |<br>| 2000 | USA     | Computer   |   1500 |<br>| 2001 | Finland | Phone      |     10 |<br>| 2001 | USA     | Calculator |     50 |<br>| 2001 | USA     | Computer   |   2700 |<br>| 2001 | USA     | TV         |    250 |<br>+------+---------+------------+--------+<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT year, country, product, SUM(profit) AS profit<br>       FROM sales<br>       GROUP BY year, country, product WITH ROLLUP;<br>+------+---------+------------+--------+<br>| year | country | product    | profit |<br>+------+---------+------------+--------+<br>| 2000 | Finland | Computer   |   1500 |<br>| 2000 | Finland | Phone      |    100 |<br>| 2000 | Finland | NULL       |   1600 |<br>| 2000 | India   | Calculator |    150 |<br>| 2000 | India   | Computer   |   1200 |<br>| 2000 | India   | NULL       |   1350 |<br>| 2000 | USA     | Calculator |     75 |<br>| 2000 | USA     | Computer   |   1500 |<br>| 2000 | USA     | NULL       |   1575 |<br>| 2000 | NULL    | NULL       |   4525 |<br>| 2001 | Finland | Phone      |     10 |<br>| 2001 | Finland | NULL       |     10 |<br>| 2001 | USA     | Calculator |     50 |<br>| 2001 | USA     | Computer   |   2700 |<br>| 2001 | USA     | TV         |    250 |<br>| 2001 | USA     | NULL       |   3000 |<br>| 2001 | NULL    | NULL       |   3010 |<br>| NULL | NULL    | NULL       |   7535 |<br>+------+---------+------------+--------+<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT department_id,AVG(salary)<br>FROM employees<br>WHERE department_id &gt; 80<br>GROUP BY department_id WITH ROLLUP;<br></code></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼š</p><p>â‘ å½“ä½¿ç”¨ROLLUPæ—¶ï¼Œä¸èƒ½åŒæ—¶ä½¿ç”¨ORDER BYå­å¥è¿›è¡Œç»“æœæ’åºï¼Œå³ROLLUPå’ŒORDER BYæ˜¯äº’ç›¸æ’æ–¥çš„ã€‚5.7æŠ¥é”™ï¼Œ8.0ä¹‹åä¸æŠ¥é”™</p><p>â‘¡WITH ROLLUPåªèƒ½å¯¹æ‰€æœ‰GROUP BYçš„åˆ—å®è¡Œï¼Œä¸èƒ½åªå¯¹æŸäº›åˆ—å®è¡Œï¼Œæ‰€ä»¥WITH ROLLUPåªèƒ½æ”¾åœ¨GROUP BYæ‰€æœ‰åˆ—çš„ç»“å°¾ã€‚</p></blockquote><h2 id="3-HAVING"><a href="#3-HAVING" class="headerlink" title="3. HAVING"></a>3. HAVING</h2><h3 id="3-1-åŸºæœ¬ä½¿ç”¨"><a href="#3-1-åŸºæœ¬ä½¿ç”¨" class="headerlink" title="3.1 åŸºæœ¬ä½¿ç”¨"></a>3.1 åŸºæœ¬ä½¿ç”¨</h3><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554981656798.png"></p><p><strong>è¿‡æ»¤åˆ†ç»„ï¼šHAVINGå­å¥</strong></p><ol><li><p>è¡Œå·²ç»è¢«åˆ†ç»„ã€‚</p></li><li><p>ä½¿ç”¨äº†èšåˆå‡½æ•°ã€‚</p></li><li><p>æ»¡è¶³HAVING å­å¥ä¸­æ¡ä»¶çš„åˆ†ç»„å°†è¢«æ˜¾ç¤ºã€‚</p></li><li><p>HAVING ä¸èƒ½å•ç‹¬ä½¿ç”¨ï¼Œå¿…é¡»è¦è·Ÿ GROUP BY ä¸€èµ·ä½¿ç”¨ã€‚ï¼ˆè¯­æ³•å±‚é¢éå¼ºåˆ¶ï¼Œä¸ä¼šæŠ¥é”™ã€‚ä½†æ˜¯å•ç‹¬ä½¿ç”¨havingæ²¡æœ‰æ„ä¹‰ï¼‰</p><p>å¦‚æœè¿‡æ»¤æ¡ä»¶ä¸­ä½¿ç”¨äº†èšåˆå‡½æ•°ï¼Œåˆ™å¿…é¡»ä½¿ç”¨HAVINGæ¥æ›¿æ¢WHEREã€‚å¦åˆ™ï¼ŒæŠ¥é”™ã€‚<strong>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œhavingæ˜¯è¿‡æ»¤æ˜¾ç¤ºçš„åˆ†ç»„ï¼Œæ˜¯ç­‰group byè¿˜æœ‰rollupåšå®Œä¹‹åæ‰å¼€å§‹è¿‡æ»¤ï¼Œä¸å½±å“ç¨‹åºé€»è¾‘</strong></p></li></ol><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554981808091.png"></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span>   department_id, <span class="hljs-built_in">MAX</span>(salary)<br><span class="hljs-keyword">FROM</span>     employees<br><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> department_id<br><span class="hljs-keyword">HAVING</span>   <span class="hljs-built_in">MAX</span>(salary)<span class="hljs-operator">&gt;</span><span class="hljs-number">10000</span> ;<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554981824564.png"></p><ul><li><strong>éæ³•ä½¿ç”¨èšåˆå‡½æ•° ï¼š ä¸èƒ½åœ¨ WHERE å­å¥ä¸­ä½¿ç”¨èšåˆå‡½æ•°ã€‚</strong>å¦‚ä¸‹ï¼š</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span>   department_id, <span class="hljs-built_in">AVG</span>(salary)<br><span class="hljs-keyword">FROM</span>     employees<br><span class="hljs-keyword">WHERE</span>    <span class="hljs-built_in">AVG</span>(salary) <span class="hljs-operator">&gt;</span> <span class="hljs-number">8000</span><br><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> department_id;<br></code></pre></td></tr></table></figure><p> <img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554981724375.png"></p><h3 id="3-2-WHEREå’ŒHAVINGçš„å¯¹æ¯”"><a href="#3-2-WHEREå’ŒHAVINGçš„å¯¹æ¯”" class="headerlink" title="3.2 WHEREå’ŒHAVINGçš„å¯¹æ¯”"></a>3.2 WHEREå’ŒHAVINGçš„å¯¹æ¯”</h3><p><strong>åŒºåˆ«1ï¼šWHERE å¯ä»¥ç›´æ¥ä½¿ç”¨è¡¨ä¸­çš„å­—æ®µä½œä¸ºç­›é€‰æ¡ä»¶ï¼Œä½†ä¸èƒ½ä½¿ç”¨åˆ†ç»„ä¸­çš„è®¡ç®—å‡½æ•°ä½œä¸ºç­›é€‰æ¡ä»¶ï¼›HAVING å¿…é¡»è¦ä¸ GROUP BY é…åˆä½¿ç”¨ï¼Œå¯ä»¥æŠŠåˆ†ç»„è®¡ç®—çš„å‡½æ•°å’Œåˆ†ç»„å­—æ®µä½œä¸ºç­›é€‰æ¡ä»¶ã€‚</strong> </p><p>è¿™å†³å®šäº†ï¼Œåœ¨éœ€è¦å¯¹æ•°æ®è¿›è¡Œåˆ†ç»„ç»Ÿè®¡çš„æ—¶å€™ï¼ŒHAVING å¯ä»¥å®Œæˆ WHERE ä¸èƒ½å®Œæˆçš„ä»»åŠ¡ã€‚è¿™æ˜¯å› ä¸ºï¼Œåœ¨æŸ¥è¯¢è¯­æ³•ç»“æ„ä¸­ï¼ŒWHERE åœ¨ GROUP BY ä¹‹å‰ï¼Œæ‰€ä»¥æ— æ³•å¯¹åˆ†ç»„ç»“æœè¿›è¡Œç­›é€‰ã€‚HAVING åœ¨ GROUP BY ä¹‹åï¼Œå¯ä»¥ä½¿ç”¨åˆ†ç»„å­—æ®µå’Œåˆ†ç»„ä¸­çš„è®¡ç®—å‡½æ•°ï¼Œå¯¹åˆ†ç»„çš„ç»“æœé›†è¿›è¡Œç­›é€‰ï¼Œè¿™ä¸ªåŠŸèƒ½æ˜¯ WHERE æ— æ³•å®Œæˆçš„ã€‚å¦å¤–ï¼ŒWHEREæ’é™¤çš„è®°å½•ä¸å†åŒ…æ‹¬åœ¨åˆ†ç»„ä¸­ã€‚</p><p><strong>åŒºåˆ«2ï¼šå¦‚æœéœ€è¦é€šè¿‡è¿æ¥ä»å…³è”è¡¨ä¸­è·å–éœ€è¦çš„æ•°æ®ï¼ŒWHERE æ˜¯å…ˆç­›é€‰åè¿æ¥ï¼Œè€Œ HAVING æ˜¯å…ˆè¿æ¥åç­›é€‰ã€‚</strong> è¿™ä¸€ç‚¹ï¼Œå°±å†³å®šäº†åœ¨å…³è”æŸ¥è¯¢ä¸­ï¼ŒWHERE æ¯” HAVING æ›´é«˜æ•ˆã€‚å› ä¸º WHERE å¯ä»¥å…ˆç­›é€‰ï¼Œç”¨ä¸€ä¸ªç­›é€‰åçš„è¾ƒå°æ•°æ®é›†å’Œå…³è”è¡¨è¿›è¡Œè¿æ¥ï¼Œè¿™æ ·å ç”¨çš„èµ„æºæ¯”è¾ƒå°‘ï¼Œæ‰§è¡Œæ•ˆç‡ä¹Ÿæ¯”è¾ƒé«˜ã€‚HAVING åˆ™éœ€è¦å…ˆæŠŠç»“æœé›†å‡†å¤‡å¥½ï¼Œä¹Ÿå°±æ˜¯ç”¨æœªè¢«ç­›é€‰çš„æ•°æ®é›†è¿›è¡Œå…³è”ï¼Œç„¶åå¯¹è¿™ä¸ªå¤§çš„æ•°æ®é›†è¿›è¡Œç­›é€‰ï¼Œè¿™æ ·å ç”¨çš„èµ„æºå°±æ¯”è¾ƒå¤šï¼Œæ‰§è¡Œæ•ˆç‡ä¹Ÿè¾ƒä½ã€‚ </p><p>å°ç»“å¦‚ä¸‹ï¼š</p><table><thead><tr><th></th><th>ä¼˜ç‚¹</th><th>ç¼ºç‚¹</th></tr></thead><tbody><tr><td>WHERE</td><td>å…ˆç­›é€‰æ•°æ®å†å…³è”ï¼Œæ‰§è¡Œæ•ˆç‡é«˜</td><td>ä¸èƒ½ä½¿ç”¨åˆ†ç»„ä¸­çš„è®¡ç®—å‡½æ•°è¿›è¡Œç­›é€‰</td></tr><tr><td>HAVING</td><td>å¯ä»¥ä½¿ç”¨åˆ†ç»„ä¸­çš„è®¡ç®—å‡½æ•°</td><td>åœ¨æœ€åçš„ç»“æœé›†ä¸­è¿›è¡Œç­›é€‰ï¼Œæ‰§è¡Œæ•ˆç‡è¾ƒä½</td></tr></tbody></table><p><strong>å¼€å‘ä¸­çš„é€‰æ‹©ï¼š</strong></p><p>WHERE å’Œ HAVING ä¹Ÿä¸æ˜¯äº’ç›¸æ’æ–¥çš„ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸€ä¸ªæŸ¥è¯¢é‡Œé¢åŒæ—¶ä½¿ç”¨ WHERE å’Œ HAVINGã€‚åŒ…å«åˆ†ç»„ç»Ÿè®¡å‡½æ•°çš„æ¡ä»¶ç”¨ HAVINGï¼Œæ™®é€šæ¡ä»¶ç”¨ WHEREã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±æ—¢åˆ©ç”¨äº† WHERE æ¡ä»¶çš„é«˜æ•ˆå¿«é€Ÿï¼Œåˆå‘æŒ¥äº† HAVING å¯ä»¥ä½¿ç”¨åŒ…å«åˆ†ç»„ç»Ÿè®¡å‡½æ•°çš„æŸ¥è¯¢æ¡ä»¶çš„ä¼˜ç‚¹ã€‚å½“æ•°æ®é‡ç‰¹åˆ«å¤§çš„æ—¶å€™ï¼Œè¿è¡Œæ•ˆç‡ä¼šæœ‰å¾ˆå¤§çš„å·®åˆ«ã€‚</p><h2 id="4-SELECTçš„æ‰§è¡Œè¿‡ç¨‹"><a href="#4-SELECTçš„æ‰§è¡Œè¿‡ç¨‹" class="headerlink" title="4. SELECTçš„æ‰§è¡Œè¿‡ç¨‹"></a>4. SELECTçš„æ‰§è¡Œè¿‡ç¨‹</h2><h3 id="4-1-æŸ¥è¯¢çš„ç»“æ„"><a href="#4-1-æŸ¥è¯¢çš„ç»“æ„" class="headerlink" title="4.1 æŸ¥è¯¢çš„ç»“æ„"></a>4.1 æŸ¥è¯¢çš„ç»“æ„</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#æ–¹å¼1ï¼š<br>SELECT ...,....,...<br>FROM ...,...,....<br>WHERE å¤šè¡¨çš„è¿æ¥æ¡ä»¶<br>AND ä¸åŒ…å«ç»„å‡½æ•°çš„è¿‡æ»¤æ¡ä»¶<br>GROUP BY ...,...<br>HAVING åŒ…å«ç»„å‡½æ•°çš„è¿‡æ»¤æ¡ä»¶<br>ORDER BY ... ASC/DESC<br>LIMIT ...,...<br><br>#æ–¹å¼2ï¼š<br>SELECT ...,....,...<br>FROM ... (LEFT / RIGHT) JOIN ... <br>ON å¤šè¡¨çš„è¿æ¥æ¡ä»¶<br>(LEFT / RIGHT) JOIN ... # åœ¨å¼€å‘ä¸­ä¸€èˆ¬æŠŠå¤šçš„æ”¾å·¦è¾¹ï¼Œæ‰€ä»¥ä¸€èˆ¬ä½¿ç”¨LEFT JOIN<br>ON ...<br>WHERE ä¸åŒ…å«ç»„å‡½æ•°çš„è¿‡æ»¤æ¡ä»¶<br>AND/OR ä¸åŒ…å«ç»„å‡½æ•°çš„è¿‡æ»¤æ¡ä»¶<br>GROUP BY ...,...<br>HAVING åŒ…å«ç»„å‡½æ•°çš„è¿‡æ»¤æ¡ä»¶<br>ORDER BY ... ASC/DESC<br>LIMIT ...,...<br><br>#å…¶ä¸­ï¼š<br>#ï¼ˆ1ï¼‰fromï¼šä»å“ªäº›è¡¨ä¸­ç­›é€‰<br>#ï¼ˆ2ï¼‰onï¼šå…³è”å¤šè¡¨æŸ¥è¯¢æ—¶ï¼Œå»é™¤ç¬›å¡å°”ç§¯<br>#ï¼ˆ3ï¼‰whereï¼šä»è¡¨ä¸­ç­›é€‰çš„æ¡ä»¶<br>#ï¼ˆ4ï¼‰group byï¼šåˆ†ç»„ä¾æ®<br>#ï¼ˆ5ï¼‰havingï¼šåœ¨ç»Ÿè®¡ç»“æœä¸­å†æ¬¡ç­›é€‰<br>#ï¼ˆ6ï¼‰order byï¼šæ’åº<br>#ï¼ˆ7ï¼‰limitï¼šåˆ†é¡µ<br></code></pre></td></tr></table></figure><h3 id="4-2-SELECTæ‰§è¡Œé¡ºåº"><a href="#4-2-SELECTæ‰§è¡Œé¡ºåº" class="headerlink" title="4.2 SELECTæ‰§è¡Œé¡ºåº"></a>4.2 SELECTæ‰§è¡Œé¡ºåº</h3><p>ä½ éœ€è¦è®°ä½ SELECT æŸ¥è¯¢æ—¶çš„ä¸¤ä¸ªé¡ºåºï¼š</p><p><strong>1. å…³é”®å­—çš„é¡ºåºæ˜¯ä¸èƒ½é¢ å€’çš„ï¼š</strong></p><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lasso"><span class="hljs-keyword">SELECT</span> <span class="hljs-params">...</span> FROM <span class="hljs-params">...</span> <span class="hljs-keyword">WHERE</span> <span class="hljs-params">...</span> <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-params">...</span> HAVING <span class="hljs-params">...</span> <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-params">...</span> LIMIT<span class="hljs-params">...</span><br></code></pre></td></tr></table></figure><p><strong>2.SELECT è¯­å¥çš„æ‰§è¡Œé¡ºåº</strong>ï¼ˆåœ¨ MySQL å’Œ Oracle ä¸­ï¼ŒSELECT æ‰§è¡Œé¡ºåºåŸºæœ¬ç›¸åŒï¼‰ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">FROM</span> <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">WHERE</span> <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">HAVING</span> <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">SELECT</span> çš„å­—æ®µ <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">DISTINCT</span> <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> LIMIT<br>   #è¡Œé™åˆ¶         #åˆ—é™åˆ¶                            #è¡Œé™åˆ¶<br>#<span class="hljs-keyword">from</span><span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span><span class="hljs-keyword">on</span><span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span><span class="hljs-keyword">join</span><span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span><span class="hljs-keyword">where</span><span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span><span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span>ï¼ˆå¼€å§‹ä½¿ç”¨<span class="hljs-keyword">select</span>ä¸­çš„åˆ«åï¼Œåé¢çš„è¯­å¥ä¸­éƒ½å¯ä»¥ä½¿ç”¨åˆ«åï¼‰<span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span>sumã€countã€maxã€avg<span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span><span class="hljs-keyword">having</span><span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span><span class="hljs-keyword">select</span><span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span><span class="hljs-keyword">distinct</span><span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span><span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span><span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span>limit<br><br><br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1566872301088.png"></p><p>æ¯”å¦‚ä½ å†™äº†ä¸€ä¸ª SQL è¯­å¥ï¼Œé‚£ä¹ˆå®ƒçš„å…³é”®å­—é¡ºåºå’Œæ‰§è¡Œé¡ºåºæ˜¯ä¸‹é¢è¿™æ ·çš„ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT DISTINCT player_id, player_name, count(*) as num # é¡ºåº 5<br>FROM player JOIN team ON player.team_id = team.team_id # é¡ºåº 1<br>WHERE height &gt; 1.80 # é¡ºåº 2<br>GROUP BY player.team_id # é¡ºåº 3<br>HAVING num &gt; 2 # é¡ºåº 4<br>ORDER BY num DESC # é¡ºåº 6<br>LIMIT 2 # é¡ºåº 7<br></code></pre></td></tr></table></figure><p>åœ¨ SELECT è¯­å¥æ‰§è¡Œè¿™äº›æ­¥éª¤çš„æ—¶å€™ï¼Œæ¯ä¸ªæ­¥éª¤éƒ½ä¼šäº§ç”Ÿä¸€ä¸ª<code>è™šæ‹Ÿè¡¨</code>ï¼Œç„¶åå°†è¿™ä¸ªè™šæ‹Ÿè¡¨ä¼ å…¥ä¸‹ä¸€ä¸ªæ­¥éª¤ä¸­ä½œä¸ºè¾“å…¥ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™äº›æ­¥éª¤éšå«åœ¨ SQL çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå¯¹äºæˆ‘ä»¬æ¥è¯´æ˜¯ä¸å¯è§çš„ã€‚</p><h3 id="4-3-SQL-çš„æ‰§è¡ŒåŸç†"><a href="#4-3-SQL-çš„æ‰§è¡ŒåŸç†" class="headerlink" title="4.3 SQL çš„æ‰§è¡ŒåŸç†"></a>4.3 SQL çš„æ‰§è¡ŒåŸç†</h3><p>SELECT æ˜¯å…ˆæ‰§è¡Œ FROM è¿™ä¸€æ­¥çš„ã€‚åœ¨è¿™ä¸ªé˜¶æ®µï¼Œå¦‚æœæ˜¯å¤šå¼ è¡¨è”æŸ¥ï¼Œè¿˜ä¼šç»å†ä¸‹é¢çš„å‡ ä¸ªæ­¥éª¤ï¼š</p><ol><li>é¦–å…ˆå…ˆé€šè¿‡ CROSS JOIN æ±‚ç¬›å¡å°”ç§¯ï¼Œç›¸å½“äºå¾—åˆ°è™šæ‹Ÿè¡¨ vtï¼ˆvirtual tableï¼‰1-1ï¼›</li><li>é€šè¿‡ ON è¿›è¡Œç­›é€‰ï¼Œåœ¨è™šæ‹Ÿè¡¨ vt1-1 çš„åŸºç¡€ä¸Šè¿›è¡Œç­›é€‰ï¼Œå¾—åˆ°è™šæ‹Ÿè¡¨ vt1-2ï¼›</li><li>æ·»åŠ å¤–éƒ¨è¡Œã€‚å¦‚æœæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯å·¦è¿æ¥ã€å³é“¾æ¥æˆ–è€…å…¨è¿æ¥ï¼Œå°±ä¼šæ¶‰åŠåˆ°å¤–éƒ¨è¡Œï¼Œä¹Ÿå°±æ˜¯åœ¨è™šæ‹Ÿè¡¨ vt1-2 çš„åŸºç¡€ä¸Šå¢åŠ å¤–éƒ¨è¡Œï¼Œå¾—åˆ°è™šæ‹Ÿè¡¨ vt1-3ã€‚</li></ol><p>å½“ç„¶å¦‚æœæˆ‘ä»¬æ“ä½œçš„æ˜¯ä¸¤å¼ ä»¥ä¸Šçš„è¡¨ï¼Œè¿˜ä¼šé‡å¤ä¸Šé¢çš„æ­¥éª¤ï¼Œç›´åˆ°æ‰€æœ‰è¡¨éƒ½è¢«å¤„ç†å®Œä¸ºæ­¢ã€‚è¿™ä¸ªè¿‡ç¨‹å¾—åˆ°æ˜¯æˆ‘ä»¬çš„åŸå§‹æ•°æ®ã€‚</p><p>å½“æˆ‘ä»¬æ‹¿åˆ°äº†æŸ¥è¯¢æ•°æ®è¡¨çš„åŸå§‹æ•°æ®ï¼Œä¹Ÿå°±æ˜¯æœ€ç»ˆçš„è™šæ‹Ÿè¡¨ <code>vt1</code>ï¼Œå°±å¯ä»¥åœ¨æ­¤åŸºç¡€ä¸Šå†è¿›è¡Œ <code>WHERE é˜¶æ®µ</code>ã€‚åœ¨è¿™ä¸ªé˜¶æ®µä¸­ï¼Œä¼šæ ¹æ® vt1 è¡¨çš„ç»“æœè¿›è¡Œç­›é€‰è¿‡æ»¤ï¼Œå¾—åˆ°è™šæ‹Ÿè¡¨ <code>vt2</code>ã€‚</p><p>ç„¶åè¿›å…¥ç¬¬ä¸‰æ­¥å’Œç¬¬å››æ­¥ï¼Œä¹Ÿå°±æ˜¯ <code>GROUP å’Œ HAVING é˜¶æ®µ</code>ã€‚åœ¨è¿™ä¸ªé˜¶æ®µä¸­ï¼Œå®é™…ä¸Šæ˜¯åœ¨è™šæ‹Ÿè¡¨ vt2 çš„åŸºç¡€ä¸Šè¿›è¡Œåˆ†ç»„å’Œåˆ†ç»„è¿‡æ»¤ï¼Œå¾—åˆ°ä¸­é—´çš„è™šæ‹Ÿè¡¨ <code>vt3</code> å’Œ <code>vt4</code>ã€‚</p><p>å½“æˆ‘ä»¬å®Œæˆäº†æ¡ä»¶ç­›é€‰éƒ¨åˆ†ä¹‹åï¼Œå°±å¯ä»¥ç­›é€‰è¡¨ä¸­æå–çš„å­—æ®µï¼Œä¹Ÿå°±æ˜¯è¿›å…¥åˆ° <code>SELECT å’Œ DISTINCT é˜¶æ®µ</code>ã€‚</p><p>é¦–å…ˆåœ¨ SELECT é˜¶æ®µä¼šæå–æƒ³è¦çš„å­—æ®µï¼Œç„¶ååœ¨ DISTINCT é˜¶æ®µè¿‡æ»¤æ‰é‡å¤çš„è¡Œï¼Œåˆ†åˆ«å¾—åˆ°ä¸­é—´çš„è™šæ‹Ÿè¡¨ <code>vt5-1</code> å’Œ <code>vt5-2</code>ã€‚</p><p>å½“æˆ‘ä»¬æå–äº†æƒ³è¦çš„å­—æ®µæ•°æ®ä¹‹åï¼Œå°±å¯ä»¥æŒ‰ç…§æŒ‡å®šçš„å­—æ®µè¿›è¡Œæ’åºï¼Œä¹Ÿå°±æ˜¯ <code>ORDER BY é˜¶æ®µ</code>ï¼Œå¾—åˆ°è™šæ‹Ÿè¡¨ <code>vt6</code>ã€‚</p><p>æœ€ååœ¨ vt6 çš„åŸºç¡€ä¸Šï¼Œå–å‡ºæŒ‡å®šè¡Œçš„è®°å½•ï¼Œä¹Ÿå°±æ˜¯ <code>LIMIT é˜¶æ®µ</code>ï¼Œå¾—åˆ°æœ€ç»ˆçš„ç»“æœï¼Œå¯¹åº”çš„æ˜¯è™šæ‹Ÿè¡¨ <code>vt7</code>ã€‚</p><p>å½“ç„¶æˆ‘ä»¬åœ¨å†™ SELECT è¯­å¥çš„æ—¶å€™ï¼Œä¸ä¸€å®šå­˜åœ¨æ‰€æœ‰çš„å…³é”®å­—ï¼Œç›¸åº”çš„é˜¶æ®µå°±ä¼šçœç•¥ã€‚</p><p>åŒæ—¶å› ä¸º SQL æ˜¯ä¸€é—¨ç±»ä¼¼è‹±è¯­çš„ç»“æ„åŒ–æŸ¥è¯¢è¯­è¨€ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨å†™ SELECT è¯­å¥çš„æ—¶å€™ï¼Œè¿˜è¦æ³¨æ„ç›¸åº”çš„å…³é”®å­—é¡ºåºï¼Œ<strong>æ‰€è°“åº•å±‚è¿è¡Œçš„åŸç†ï¼Œå°±æ˜¯æˆ‘ä»¬åˆšæ‰è®²åˆ°çš„æ‰§è¡Œé¡ºåºã€‚</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs sql">#å¦å¤–ä¸€ç§æ›´åŠ è¯¦ç»†çš„<br><span class="hljs-number">1</span>ã€<span class="hljs-keyword">FROM</span>ï¼šå¯¹<span class="hljs-keyword">FROM</span>å·¦è¾¹çš„è¡¨å’Œå³è¾¹çš„è¡¨è®¡ç®—ç¬›å¡å°”ç§¯ï¼Œäº§ç”Ÿè™šè¡¨VT1ï¼›<br><br><span class="hljs-number">2</span>ã€<span class="hljs-keyword">ON</span>ï¼šå¯¹è™šæ‹Ÿè¡¨VT1è¿›è¡Œ<span class="hljs-keyword">ON</span>ç­›é€‰ï¼Œåªæœ‰é‚£äº›ç¬¦åˆ<span class="hljs-operator">&lt;</span>join_condition<span class="hljs-operator">&gt;</span>æ¡ä»¶çš„è¡Œæ‰ä¼šè¢«è®°å½•åœ¨è™šæ‹Ÿè¡¨VT2ä¸­ï¼›<br><br><span class="hljs-number">3</span>ã€<span class="hljs-keyword">JOIN</span>ï¼šå¦‚æœæ˜¯<span class="hljs-keyword">OUT</span> <span class="hljs-keyword">JOIN</span>ï¼Œé‚£ä¹ˆå°†ä¿ç•™è¡¨ä¸­ï¼ˆå¦‚å·¦è¡¨æˆ–è€…å³è¡¨ï¼‰æœªåŒ¹é…çš„è¡Œä½œä¸ºå¤–éƒ¨è¡Œæ·»åŠ åˆ°è™šæ‹Ÿè¡¨VT2ä¸­ï¼Œä»è€Œäº§ç”Ÿè™šæ‹Ÿè¡¨VT3ï¼›<br><br><span class="hljs-number">4</span>ã€<span class="hljs-keyword">WHERE</span>ï¼šå¯¹è™šæ‹Ÿè¡¨VT3è¿›è¡Œ<span class="hljs-keyword">WHERE</span>æ¡ä»¶è¿‡æ»¤ï¼Œåªæœ‰ç¬¦åˆ<span class="hljs-operator">&lt;</span>where_condition<span class="hljs-operator">&gt;</span>çš„è®°å½•æ‰ä¼šè¢«æ”¾å…¥åˆ°è™šæ‹Ÿè¡¨VT4ï¼›<br><br><span class="hljs-number">5</span>ã€<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span>ï¼šæ ¹æ®<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span>å­å¥ä¸­çš„åˆ—ï¼Œå¯¹è™šæ‹Ÿè¡¨VT4è¿›è¡Œåˆ†ç»„æ“ä½œï¼Œäº§ç”Ÿè™šæ‹Ÿè¡¨VT5ï¼›<br><br><span class="hljs-number">6</span>ã€<span class="hljs-keyword">CUBE</span><span class="hljs-operator">|</span><span class="hljs-keyword">ROLLUP</span>ï¼šå¯¹è™šæ‹Ÿè¡¨VT5è¿›è¡Œ<span class="hljs-keyword">CUBE</span>æˆ–è€…<span class="hljs-keyword">ROLLUP</span>æ“ä½œï¼Œäº§ç”Ÿè™šæ‹Ÿè¡¨VT6ï¼›<br><br><span class="hljs-number">7</span>ã€<span class="hljs-keyword">HAVING</span>ï¼šå¯¹è™šæ‹Ÿè¡¨VT6è¿›è¡Œ<span class="hljs-keyword">HAVING</span>æ¡ä»¶è¿‡æ»¤ï¼Œåªæœ‰ç¬¦åˆ<span class="hljs-operator">&lt;</span>having_condition<span class="hljs-operator">&gt;</span>çš„è®°å½•æ‰ä¼šè¢«æ’å…¥åˆ°è™šæ‹Ÿè¡¨VT7ä¸­ï¼›<br><br><span class="hljs-number">8</span>ã€<span class="hljs-keyword">SELECT</span>ï¼šæ‰§è¡Œ<span class="hljs-keyword">SELECT</span>æ“ä½œï¼Œé€‰æ‹©æŒ‡å®šçš„åˆ—ï¼Œæ’å…¥åˆ°è™šæ‹Ÿè¡¨VT8ä¸­ï¼›<br><br><span class="hljs-number">9</span>ã€<span class="hljs-keyword">DISTINCT</span>ï¼šå¯¹è™šæ‹Ÿè¡¨VT8ä¸­çš„è®°å½•è¿›è¡Œå»é‡ï¼Œäº§ç”Ÿè™šæ‹Ÿè¡¨VT9ï¼›<br><br><span class="hljs-number">10</span>ã€<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span>ï¼šå°†è™šæ‹Ÿè¡¨VT9ä¸­çš„è®°å½•æŒ‰ç…§<span class="hljs-operator">&lt;</span>order_by_list<span class="hljs-operator">&gt;</span>è¿›è¡Œæ’åºæ“ä½œï¼Œäº§ç”Ÿè™šæ‹Ÿè¡¨VT10ï¼›<br><br><span class="hljs-number">11</span>ã€LIMITï¼šå–å‡ºæŒ‡å®šè¡Œçš„è®°å½•ï¼Œäº§ç”Ÿè™šæ‹Ÿè¡¨VT11ï¼Œå¹¶å°†ç»“æœè¿”å›ã€‚<br></code></pre></td></tr></table></figure><h3 id="4-4-è¯¾åç»ƒä¹ "><a href="#4-4-è¯¾åç»ƒä¹ " class="headerlink" title="4.4 è¯¾åç»ƒä¹ "></a>4.4 è¯¾åç»ƒä¹ </h3><p><strong>æŸ¥è¯¢æ¯ä¸ªå·¥ç§ã€æ¯ä¸ªéƒ¨é—¨çš„éƒ¨é—¨åã€å·¥ç§åå’Œæœ€ä½å·¥èµ„</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> d.department_name, e.job_id, <span class="hljs-built_in">MIN</span>(salary)<br><span class="hljs-keyword">FROM</span> employees e <span class="hljs-keyword">RIGHT</span> <span class="hljs-keyword">JOIN</span> departments d <br><span class="hljs-keyword">ON</span> e.department_id <span class="hljs-operator">=</span> d.department_id<br><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> e.job_id, d.department_name<br><span class="hljs-keyword">UNION</span><br><span class="hljs-keyword">SELECT</span> d.department_name, e.job_id, <span class="hljs-built_in">MIN</span>(salary)<br><span class="hljs-keyword">FROM</span> employees e <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> departments d <br><span class="hljs-keyword">ON</span> e.department_id <span class="hljs-operator">=</span> d.department_id <br><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> e.job_id, d.department_name;<br></code></pre></td></tr></table></figure><p><strong>æŸ¥è¯¢æ‰€æœ‰éƒ¨é—¨çš„åå­—ï¼Œ</strong>location_id<strong>ï¼Œå‘˜å·¥æ•°é‡å’Œå¹³å‡å·¥èµ„ï¼Œå¹¶æŒ‰å¹³å‡å·¥ èµ„é™åº</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> d.department_name, d.location_id, <span class="hljs-built_in">COUNT</span>(IFNULL(salary, <span class="hljs-keyword">NULL</span>)), <span class="hljs-built_in">AVG</span>(salary) avg_salary<br><span class="hljs-keyword">FROM</span> employees e <span class="hljs-keyword">RIGHT</span> <span class="hljs-keyword">JOIN</span> departments d <br><span class="hljs-keyword">ON</span> e.department_id <span class="hljs-operator">=</span> d.department_id<br><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> d.department_id<br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> avg_salary <span class="hljs-keyword">DESC</span>;<br></code></pre></td></tr></table></figure><h1 id="ç¬¬09ç« -å­æŸ¥è¯¢"><a href="#ç¬¬09ç« -å­æŸ¥è¯¢" class="headerlink" title="ç¬¬09ç« _å­æŸ¥è¯¢"></a>ç¬¬09ç« _å­æŸ¥è¯¢</h1><p>å­æŸ¥è¯¢æŒ‡ä¸€ä¸ªæŸ¥è¯¢è¯­å¥åµŒå¥—åœ¨å¦ä¸€ä¸ªæŸ¥è¯¢è¯­å¥å†…éƒ¨çš„æŸ¥è¯¢ï¼Œè¿™ä¸ªç‰¹æ€§ä»MySQL 4.1å¼€å§‹å¼•å…¥ã€‚</p><p>SQL ä¸­å­æŸ¥è¯¢çš„ä½¿ç”¨å¤§å¤§å¢å¼ºäº† SELECT æŸ¥è¯¢çš„èƒ½åŠ›ï¼Œå› ä¸ºå¾ˆå¤šæ—¶å€™æŸ¥è¯¢éœ€è¦ä»ç»“æœé›†ä¸­è·å–æ•°æ®ï¼Œæˆ–è€…éœ€è¦ä»åŒä¸€ä¸ªè¡¨ä¸­å…ˆè®¡ç®—å¾—å‡ºä¸€ä¸ªæ•°æ®ç»“æœï¼Œç„¶åä¸è¿™ä¸ªæ•°æ®ç»“æœï¼ˆå¯èƒ½æ˜¯æŸä¸ªæ ‡é‡ï¼Œä¹Ÿå¯èƒ½æ˜¯æŸä¸ªé›†åˆï¼‰è¿›è¡Œæ¯”è¾ƒã€‚</p><h2 id="1-éœ€æ±‚åˆ†æä¸é—®é¢˜è§£å†³"><a href="#1-éœ€æ±‚åˆ†æä¸é—®é¢˜è§£å†³" class="headerlink" title="1. éœ€æ±‚åˆ†æä¸é—®é¢˜è§£å†³"></a>1. éœ€æ±‚åˆ†æä¸é—®é¢˜è§£å†³</h2><h3 id="1-1-å®é™…é—®é¢˜"><a href="#1-1-å®é™…é—®é¢˜" class="headerlink" title="1.1 å®é™…é—®é¢˜"></a>1.1 å®é™…é—®é¢˜</h3><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554991034688.png" alt="" style="zoom:80%;" /><p>ç°æœ‰è§£å†³æ–¹å¼ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#æ–¹å¼ä¸€ï¼š<br>SELECT salary<br>FROM employees<br>WHERE last_name = &#x27;Abel&#x27;;<br><br>SELECT last_name,salary<br>FROM employees<br>WHERE salary &gt; 11000;<br><br>#æ–¹å¼äºŒï¼šè‡ªè¿æ¥<br>SELECT e2.last_name,e2.salary<br>FROM employees e1,employees e2<br>WHERE e1.last_name = &#x27;Abel&#x27;<br>AND e1.`salary` &lt; e2.`salary`<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#æ–¹å¼ä¸‰ï¼šå­æŸ¥è¯¢<br>SELECT last_name,salary<br>FROM employees<br>WHERE salary &gt; (<br>SELECT salary<br>FROM employees<br>WHERE last_name = &#x27;Abel&#x27;<br>);<br></code></pre></td></tr></table></figure><p> <img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554991316599.png"></p><h3 id="1-2-å­æŸ¥è¯¢çš„åŸºæœ¬ä½¿ç”¨"><a href="#1-2-å­æŸ¥è¯¢çš„åŸºæœ¬ä½¿ç”¨" class="headerlink" title="1.2 å­æŸ¥è¯¢çš„åŸºæœ¬ä½¿ç”¨"></a>1.2 å­æŸ¥è¯¢çš„åŸºæœ¬ä½¿ç”¨</h3><ul><li>å­æŸ¥è¯¢çš„åŸºæœ¬è¯­æ³•ç»“æ„ï¼š</li></ul><p> <img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554991054388.png"></p><ul><li>å­æŸ¥è¯¢ï¼ˆå†…æŸ¥è¯¢ï¼‰åœ¨ä¸»æŸ¥è¯¢ä¹‹å‰ä¸€æ¬¡æ‰§è¡Œå®Œæˆã€‚</li><li>å­æŸ¥è¯¢çš„ç»“æœè¢«ä¸»æŸ¥è¯¢ï¼ˆå¤–æŸ¥è¯¢ï¼‰ä½¿ç”¨ ã€‚</li><li><strong>æ³¨æ„äº‹é¡¹</strong><ul><li>å­æŸ¥è¯¢è¦åŒ…å«åœ¨æ‹¬å·å†…</li><li>å°†å­æŸ¥è¯¢æ”¾åœ¨æ¯”è¾ƒæ¡ä»¶çš„å³ä¾§ï¼ˆåªæ˜¯è§„èŒƒï¼Œå¯ä»¥æ”¾åœ¨å·¦ä¾§ï¼Œä½†æ˜¯ä¸ºäº†å¯è¯»æ€§å’Œç¾è§‚è§’åº¦æ€è€ƒï¼Œæ”¾åœ¨å³ä¾§ï¼‰</li><li>å•è¡Œæ“ä½œç¬¦å¯¹åº”å•è¡Œå­æŸ¥è¯¢ï¼Œå¤šè¡Œæ“ä½œç¬¦å¯¹åº”å¤šè¡Œå­æŸ¥è¯¢</li></ul></li></ul><h3 id="1-3-å­æŸ¥è¯¢çš„åˆ†ç±»"><a href="#1-3-å­æŸ¥è¯¢çš„åˆ†ç±»" class="headerlink" title="1.3 å­æŸ¥è¯¢çš„åˆ†ç±»"></a>1.3 å­æŸ¥è¯¢çš„åˆ†ç±»</h3><p><strong>åˆ†ç±»æ–¹å¼1ï¼š</strong></p><p>æˆ‘ä»¬æŒ‰å†…æŸ¥è¯¢çš„ç»“æœè¿”å›ä¸€æ¡è¿˜æ˜¯å¤šæ¡è®°å½•ï¼Œå°†å­æŸ¥è¯¢åˆ†ä¸º<code>å•è¡Œå­æŸ¥è¯¢</code>ã€<code>å¤šè¡Œå­æŸ¥è¯¢</code>ã€‚</p><ul><li><p>å•è¡Œå­æŸ¥è¯¢</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554991538719.png"></p></li><li><p>å¤šè¡Œå­æŸ¥è¯¢</p></li></ul><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554991555669.png"></p><p><strong>åˆ†ç±»æ–¹å¼2ï¼š</strong></p><p>æˆ‘ä»¬æŒ‰å†…æŸ¥è¯¢æ˜¯å¦è¢«æ‰§è¡Œå¤šæ¬¡ï¼Œå°†å­æŸ¥è¯¢åˆ’åˆ†ä¸º<code>ç›¸å…³(æˆ–å…³è”)å­æŸ¥è¯¢</code>å’Œ<code>ä¸ç›¸å…³(æˆ–éå…³è”)å­æŸ¥è¯¢</code>ã€‚</p><p>å­æŸ¥è¯¢ä»æ•°æ®è¡¨ä¸­æŸ¥è¯¢äº†æ•°æ®ç»“æœï¼Œå¦‚æœè¿™ä¸ªæ•°æ®ç»“æœåªæ‰§è¡Œä¸€æ¬¡ï¼Œç„¶åè¿™ä¸ªæ•°æ®ç»“æœä½œä¸ºä¸»æŸ¥è¯¢çš„æ¡ä»¶è¿›è¡Œæ‰§è¡Œï¼Œé‚£ä¹ˆè¿™æ ·çš„å­æŸ¥è¯¢å«åšä¸ç›¸å…³å­æŸ¥è¯¢ã€‚</p><p>åŒæ ·ï¼Œå¦‚æœå­æŸ¥è¯¢éœ€è¦æ‰§è¡Œå¤šæ¬¡ï¼Œå³é‡‡ç”¨å¾ªç¯çš„æ–¹å¼ï¼Œå…ˆä»å¤–éƒ¨æŸ¥è¯¢å¼€å§‹ï¼Œæ¯æ¬¡éƒ½ä¼ å…¥å­æŸ¥è¯¢è¿›è¡ŒæŸ¥è¯¢ï¼Œç„¶åå†å°†ç»“æœåé¦ˆç»™å¤–éƒ¨ï¼Œè¿™ç§åµŒå¥—çš„æ‰§è¡Œæ–¹å¼å°±ç§°ä¸ºç›¸å…³å­æŸ¥è¯¢ã€‚</p><h2 id="2-å•è¡Œå­æŸ¥è¯¢"><a href="#2-å•è¡Œå­æŸ¥è¯¢" class="headerlink" title="2. å•è¡Œå­æŸ¥è¯¢"></a>2. å•è¡Œå­æŸ¥è¯¢</h2><h3 id="2-1-å•è¡Œæ¯”è¾ƒæ“ä½œç¬¦"><a href="#2-1-å•è¡Œæ¯”è¾ƒæ“ä½œç¬¦" class="headerlink" title="2.1 å•è¡Œæ¯”è¾ƒæ“ä½œç¬¦"></a>2.1 å•è¡Œæ¯”è¾ƒæ“ä½œç¬¦</h3><table><thead><tr><th>æ“ä½œç¬¦</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>=</td><td>equal to</td></tr><tr><td>&gt;</td><td>greater than</td></tr><tr><td>&gt;=</td><td>greater than or equal to</td></tr><tr><td>&lt;</td><td>less than</td></tr><tr><td>&lt;=</td><td>less than or equal to</td></tr><tr><td>&lt;&gt;</td><td>not equal to</td></tr></tbody></table><h3 id="2-2-ä»£ç ç¤ºä¾‹"><a href="#2-2-ä»£ç ç¤ºä¾‹" class="headerlink" title="2.2 ä»£ç ç¤ºä¾‹"></a>2.2 ä»£ç ç¤ºä¾‹</h3><p><strong>é¢˜ç›®ï¼šæŸ¥è¯¢å·¥èµ„å¤§äº149å·å‘˜å·¥å·¥èµ„çš„å‘˜å·¥çš„ä¿¡æ¯</strong></p><p> <img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20210914232952626.png"></p><p> <img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20210914232935062.png"></p><p><strong>é¢˜ç›®ï¼šè¿”å›job_idä¸141å·å‘˜å·¥ç›¸åŒï¼Œsalaryæ¯”143å·å‘˜å·¥å¤šçš„å‘˜å·¥å§“åï¼Œjob_idå’Œå·¥èµ„</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> last_name, job_id, salary<br><span class="hljs-keyword">FROM</span>   employees<br><span class="hljs-keyword">WHERE</span>  job_id <span class="hljs-operator">=</span>  <br>                (<span class="hljs-keyword">SELECT</span> job_id<br>                 <span class="hljs-keyword">FROM</span>   employees<br>                 <span class="hljs-keyword">WHERE</span>  employee_id <span class="hljs-operator">=</span> <span class="hljs-number">141</span>)<br><span class="hljs-keyword">AND</span>    salary <span class="hljs-operator">&gt;</span><br>                (<span class="hljs-keyword">SELECT</span> salary<br>                 <span class="hljs-keyword">FROM</span>   employees<br>                 <span class="hljs-keyword">WHERE</span>  employee_id <span class="hljs-operator">=</span> <span class="hljs-number">143</span>);<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554991892770.png"></p><p><strong>é¢˜ç›®ï¼šè¿”å›å…¬å¸å·¥èµ„æœ€å°‘çš„å‘˜å·¥çš„last_name,job_idå’Œsalary</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> last_name, job_id, salary<br><span class="hljs-keyword">FROM</span>   employees<br><span class="hljs-keyword">WHERE</span>  salary <span class="hljs-operator">=</span> <br>                (<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">MIN</span>(salary)<br>                 <span class="hljs-keyword">FROM</span>   employees);<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554991935186.png"></p><p><strong>é¢˜ç›®ï¼šæŸ¥è¯¢ä¸141å·æˆ–174å·å‘˜å·¥çš„manager_idå’Œdepartment_idç›¸åŒçš„å…¶ä»–å‘˜å·¥çš„employee_idï¼Œmanager_idï¼Œdepartment_id</strong></p><p>å®ç°æ–¹å¼1ï¼šä¸æˆå¯¹æ¯”è¾ƒ</p><figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sas"><span class="hljs-meta">SELECT</span>  employee_id, manager_id, department_id<br><span class="hljs-meta">FROM</span>    employees<br><span class="hljs-meta">WHERE</span>   manager_id <span class="hljs-meta">IN</span><br>  (<span class="hljs-meta">SELECT</span>  manager_id<br>                   <span class="hljs-meta">FROM</span>    employees<br>                   <span class="hljs-meta">WHERE</span>   employee_id <span class="hljs-meta">IN</span> (174,141))<br><span class="hljs-meta">AND</span>     department_id <span class="hljs-meta">IN</span> <br>  (<span class="hljs-meta">SELECT</span>  department_id<br>                   <span class="hljs-meta">FROM</span>    employees<br>                   <span class="hljs-meta">WHERE</span>   employee_id <span class="hljs-meta">IN</span> (174,141))<br><span class="hljs-meta">AND</span>employee_id <span class="hljs-meta">NOT</span> <span class="hljs-meta">IN(</span>174,141);<br></code></pre></td></tr></table></figure><p>å®ç°æ–¹å¼2ï¼šæˆå¯¹æ¯”è¾ƒ</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">SELECT</span>employee_id, manager_id, department_id<br><span class="hljs-keyword">FROM</span>employees<br><span class="hljs-keyword">WHERE</span>  (manager_id, department_id) <span class="hljs-keyword">IN</span><br>                      (<span class="hljs-keyword">SELECT</span> manager_id, department_id<br>                       <span class="hljs-keyword">FROM</span>   employees<br>                       <span class="hljs-keyword">WHERE</span>  employee_id <span class="hljs-keyword">IN</span> (<span class="hljs-number">141</span>,<span class="hljs-number">174</span>))<br><span class="hljs-keyword">AND</span>employee_id <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">IN</span> (<span class="hljs-number">141</span>,<span class="hljs-number">174</span>);<br></code></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs sql">#å®ç°æ–¹å¼<span class="hljs-number">1</span>å†™æ³•ï¼Œæœ‰å¯èƒ½ä¼šå­˜åœ¨äº¤å‰ç›¸ç­‰ï¼Œå³manager_id æ˜¯<span class="hljs-number">141</span>çš„ï¼Œè€Œdepartment_idæ˜¯<span class="hljs-number">174</span>çš„ã€‚å®ç°æ–¹å¼<span class="hljs-number">2</span>å’Œä¸‹é¢è¿™ç§å†™æ³•ä¸ä¼šå‡ºé”™ã€‚<br><span class="hljs-keyword">SELECT</span> e.employee_id, e.manager_id, e.department_id<br><span class="hljs-keyword">FROM</span> employees e<br><span class="hljs-keyword">WHERE</span> (e.manager_id <span class="hljs-operator">=</span> (<br>                        <span class="hljs-keyword">SELECT</span> manager_id<br>                        <span class="hljs-keyword">FROM</span> employees<br>                        <span class="hljs-keyword">WHERE</span> employee_id <span class="hljs-operator">=</span> <span class="hljs-number">141</span>)<br>                         <span class="hljs-keyword">AND</span><br> e.department_id <span class="hljs-operator">=</span> (<br>                         <span class="hljs-keyword">SELECT</span> department_id<br>                         <span class="hljs-keyword">FROM</span> employees<br>                         <span class="hljs-keyword">WHERE</span> employee_id <span class="hljs-operator">=</span> <span class="hljs-number">141</span>)<br>                       <span class="hljs-keyword">OR</span><br>e.manager_id <span class="hljs-operator">=</span> (<br>                        <span class="hljs-keyword">SELECT</span> manager_id<br>                        <span class="hljs-keyword">FROM</span> employees<br>                        <span class="hljs-keyword">WHERE</span> employee_id <span class="hljs-operator">=</span> <span class="hljs-number">174</span>)<br>                <span class="hljs-keyword">AND</span><br> e.department_id <span class="hljs-operator">=</span> (<br>                         <span class="hljs-keyword">SELECT</span> department_id<br>                         <span class="hljs-keyword">FROM</span> employees<br>                         <span class="hljs-keyword">WHERE</span> employee_id <span class="hljs-operator">=</span> <span class="hljs-number">174</span>)) <span class="hljs-keyword">AND</span> e.employee_id <span class="hljs-operator">!=</span> <span class="hljs-number">141</span> <span class="hljs-keyword">AND</span> e.employee_id <span class="hljs-operator">!=</span> <span class="hljs-number">174</span>;<br></code></pre></td></tr></table></figure><h3 id="2-3-HAVING-ä¸­çš„å­æŸ¥è¯¢"><a href="#2-3-HAVING-ä¸­çš„å­æŸ¥è¯¢" class="headerlink" title="2.3 HAVING ä¸­çš„å­æŸ¥è¯¢"></a>2.3 HAVING ä¸­çš„å­æŸ¥è¯¢</h3><ul><li>é¦–å…ˆæ‰§è¡Œå­æŸ¥è¯¢ã€‚</li><li>å‘ä¸»æŸ¥è¯¢ä¸­çš„HAVING å­å¥è¿”å›ç»“æœã€‚</li></ul><p><strong>é¢˜ç›®ï¼šæŸ¥è¯¢æœ€ä½å·¥èµ„å¤§äº50å·éƒ¨é—¨æœ€ä½å·¥èµ„çš„éƒ¨é—¨idå’Œå…¶æœ€ä½å·¥èµ„</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span>   department_id, <span class="hljs-built_in">MIN</span>(salary)<br><span class="hljs-keyword">FROM</span>     employees<br><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> department_id<br><span class="hljs-keyword">HAVING</span>   <span class="hljs-built_in">MIN</span>(salary) <span class="hljs-operator">&gt;</span><br>                       (<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">MIN</span>(salary)<br>                        <span class="hljs-keyword">FROM</span>   employees<br>                        <span class="hljs-keyword">WHERE</span>  department_id <span class="hljs-operator">=</span> <span class="hljs-number">50</span>);<br></code></pre></td></tr></table></figure><h3 id="2-4-CASEä¸­çš„å­æŸ¥è¯¢"><a href="#2-4-CASEä¸­çš„å­æŸ¥è¯¢" class="headerlink" title="2.4 CASEä¸­çš„å­æŸ¥è¯¢"></a>2.4 CASEä¸­çš„å­æŸ¥è¯¢</h3><p>åœ¨CASEè¡¨è¾¾å¼ä¸­ä½¿ç”¨å•åˆ—å­æŸ¥è¯¢ï¼š</p><p><strong>é¢˜ç›®ï¼šæ˜¾å¼å‘˜å·¥çš„employee_id,last_nameå’Œlocationã€‚å…¶ä¸­ï¼Œè‹¥å‘˜å·¥department_idä¸location_idä¸º1800çš„department_idç›¸åŒï¼Œåˆ™locationä¸ºâ€™Canadaâ€™ï¼Œå…¶ä½™åˆ™ä¸ºâ€™USAâ€™ã€‚</strong></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">SELECT</span> employee_id, last_name,<br>       (<span class="hljs-keyword">CASE</span> department_id<br>        <span class="hljs-keyword">WHEN</span><br>             (<span class="hljs-keyword">SELECT</span> department_id <span class="hljs-keyword">FROM</span> departments<br>      <span class="hljs-keyword">WHERE</span> location_id = <span class="hljs-number">1800</span>)           <br>        <span class="hljs-keyword">THEN</span> <span class="hljs-string">&#x27;Canada&#x27;</span> <span class="hljs-keyword">ELSE</span> <span class="hljs-string">&#x27;USA&#x27;</span> <span class="hljs-keyword">END</span>) <span class="hljs-keyword">location</span><br><span class="hljs-keyword">FROM</span>   employees;<br></code></pre></td></tr></table></figure><h3 id="2-5-å­æŸ¥è¯¢ä¸­çš„ç©ºå€¼é—®é¢˜"><a href="#2-5-å­æŸ¥è¯¢ä¸­çš„ç©ºå€¼é—®é¢˜" class="headerlink" title="2.5 å­æŸ¥è¯¢ä¸­çš„ç©ºå€¼é—®é¢˜"></a>2.5 å­æŸ¥è¯¢ä¸­çš„ç©ºå€¼é—®é¢˜</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> last_name, job_id<br><span class="hljs-keyword">FROM</span>   employees<br><span class="hljs-keyword">WHERE</span>  job_id <span class="hljs-operator">=</span><br>                (<span class="hljs-keyword">SELECT</span> job_id<br>                 <span class="hljs-keyword">FROM</span>   employees<br>                 <span class="hljs-keyword">WHERE</span>  last_name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;Haas&#x27;</span>);<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554992067381.png"></p><blockquote><p><strong>å­æŸ¥è¯¢ä¸è¿”å›ä»»ä½•è¡Œ</strong></p></blockquote><h3 id="2-5-éæ³•ä½¿ç”¨å­æŸ¥è¯¢"><a href="#2-5-éæ³•ä½¿ç”¨å­æŸ¥è¯¢" class="headerlink" title="2.5 éæ³•ä½¿ç”¨å­æŸ¥è¯¢"></a>2.5 éæ³•ä½¿ç”¨å­æŸ¥è¯¢</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> employee_id, last_name<br><span class="hljs-keyword">FROM</span>   employees<br><span class="hljs-keyword">WHERE</span>  salary <span class="hljs-operator">=</span><br>                (<span class="hljs-keyword">SELECT</span>   <span class="hljs-built_in">MIN</span>(salary)<br>                 <span class="hljs-keyword">FROM</span>     employees<br>                 <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> department_id);<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554992135819.png"></p><blockquote><p><strong>å¤šè¡Œå­æŸ¥è¯¢ä½¿ç”¨å•è¡Œæ¯”è¾ƒç¬¦</strong></p></blockquote><h2 id="3-å¤šè¡Œå­æŸ¥è¯¢"><a href="#3-å¤šè¡Œå­æŸ¥è¯¢" class="headerlink" title="3. å¤šè¡Œå­æŸ¥è¯¢"></a>3. å¤šè¡Œå­æŸ¥è¯¢</h2><ul><li>ä¹Ÿç§°ä¸ºé›†åˆæ¯”è¾ƒå­æŸ¥è¯¢</li><li>å†…æŸ¥è¯¢è¿”å›å¤šè¡Œ</li><li>ä½¿ç”¨å¤šè¡Œæ¯”è¾ƒæ“ä½œç¬¦</li></ul><h3 id="3-1-å¤šè¡Œæ¯”è¾ƒæ“ä½œç¬¦"><a href="#3-1-å¤šè¡Œæ¯”è¾ƒæ“ä½œç¬¦" class="headerlink" title="3.1 å¤šè¡Œæ¯”è¾ƒæ“ä½œç¬¦"></a>3.1 å¤šè¡Œæ¯”è¾ƒæ“ä½œç¬¦</h3><table><thead><tr><th>æ“ä½œç¬¦</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>IN</td><td>ç­‰äºåˆ—è¡¨ä¸­çš„<strong>ä»»æ„ä¸€ä¸ª</strong></td></tr><tr><td>ANY</td><td>éœ€è¦å’Œå•è¡Œæ¯”è¾ƒæ“ä½œç¬¦ä¸€èµ·ä½¿ç”¨ï¼Œå’Œå­æŸ¥è¯¢è¿”å›çš„<strong>æŸä¸€ä¸ª</strong>å€¼æ¯”è¾ƒ</td></tr><tr><td>ALL</td><td>éœ€è¦å’Œå•è¡Œæ¯”è¾ƒæ“ä½œç¬¦ä¸€èµ·ä½¿ç”¨ï¼Œå’Œå­æŸ¥è¯¢è¿”å›çš„<strong>æ‰€æœ‰</strong>å€¼æ¯”è¾ƒ</td></tr><tr><td>SOME</td><td>å®é™…ä¸Šæ˜¯ANYçš„åˆ«åï¼Œä½œç”¨ç›¸åŒï¼Œä¸€èˆ¬å¸¸ä½¿ç”¨ANY</td></tr></tbody></table><blockquote><p>ä½“ä¼š ANY å’Œ ALL çš„åŒºåˆ«</p></blockquote><h3 id="3-2-ä»£ç ç¤ºä¾‹"><a href="#3-2-ä»£ç ç¤ºä¾‹" class="headerlink" title="3.2 ä»£ç ç¤ºä¾‹"></a>3.2 ä»£ç ç¤ºä¾‹</h3><p><strong>é¢˜ç›®ï¼šè¿”å›å…¶å®ƒjob_idä¸­æ¯”job_idä¸ºâ€˜IT_PROGâ€™éƒ¨é—¨ä»»ä¸€å·¥èµ„ä½çš„å‘˜å·¥çš„å‘˜å·¥å·ã€å§“åã€job_id ä»¥åŠsalary</strong></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554992658876.png"></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554992664594.png"></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554992668429.png"></p><p><strong>é¢˜ç›®ï¼šè¿”å›å…¶å®ƒjob_idä¸­æ¯”job_idä¸ºâ€˜IT_PROGâ€™éƒ¨é—¨æ‰€æœ‰å·¥èµ„éƒ½ä½çš„å‘˜å·¥çš„å‘˜å·¥å·ã€å§“åã€job_idä»¥åŠsalary</strong></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554992753654.png"></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554992759467.png"></p><p><strong>é¢˜ç›®ï¼šæŸ¥è¯¢å¹³å‡å·¥èµ„æœ€ä½çš„éƒ¨é—¨id</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#æ–¹å¼1ï¼š<br>SELECT department_id<br>FROM employees<br>GROUP BY department_id<br>HAVING AVG(salary) = (<br>SELECT MIN(avg_sal)<br>FROM (<br>SELECT AVG(salary) avg_sal<br>FROM employees<br>GROUP BY department_id<br>) dept_avg_sal #æŠŠå­æŸ¥è¯¢å½“åšä¸€ä¸ªè¡¨ï¼Œä½†æ˜¯éœ€è¦è¡¨æœ‰åˆ«åï¼ˆå¿…é¡»è¦èµ·ä¸ªåˆ«åï¼Œå› ä¸ºå­æŸ¥è¯¢ç»“æœçš„è¡¨é»˜è®¤æ²¡æœ‰åå­—ï¼‰<br>)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#æ–¹å¼2ï¼š<br>SELECT department_id<br>FROM employees<br>GROUP BY department_id<br>HAVING AVG(salary) &lt;= ALL (<br>SELECT AVG(salary) avg_sal<br>FROM employees<br>GROUP BY department_id<br>)<br></code></pre></td></tr></table></figure><h3 id="3-3-ç©ºå€¼é—®é¢˜"><a href="#3-3-ç©ºå€¼é—®é¢˜" class="headerlink" title="3.3 ç©ºå€¼é—®é¢˜"></a>3.3 ç©ºå€¼é—®é¢˜</h3><p>å½“å­æŸ¥è¯¢ä½¿ç”¨<code>NOT IN</code>è¿›è¡Œä¸ç›¸ç­‰æ¯”è¾ƒæ—¶ï¼Œå­æŸ¥è¯¢ç»“æœä¸­å«æœ‰NULLï¼Œè¿”å›ç©ºé›†ï¼Œæ‰€ä»¥ä¸‹åˆ—sqlè¯­å¥æ²¡æœ‰ä»»ä½•è¾“å‡ºã€‚</p><p>ä½¿ç”¨<code>IN</code>æ—¶ï¼Œä¸ä¼šå‡ºç°ä¸Šé¢çš„é”™è¯¯ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT last_name<br>FROM employees<br>WHERE employee_id NOT IN (<br>SELECT manager_id<br>FROM employees<br>);<br></code></pre></td></tr></table></figure><p> <img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211027195906773.png"></p><h2 id="4-ç›¸å…³å­æŸ¥è¯¢"><a href="#4-ç›¸å…³å­æŸ¥è¯¢" class="headerlink" title="4. ç›¸å…³å­æŸ¥è¯¢"></a>4. ç›¸å…³å­æŸ¥è¯¢</h2><h3 id="4-1-ç›¸å…³å­æŸ¥è¯¢æ‰§è¡Œæµç¨‹"><a href="#4-1-ç›¸å…³å­æŸ¥è¯¢æ‰§è¡Œæµç¨‹" class="headerlink" title="4.1 ç›¸å…³å­æŸ¥è¯¢æ‰§è¡Œæµç¨‹"></a>4.1 ç›¸å…³å­æŸ¥è¯¢æ‰§è¡Œæµç¨‹</h3><p>å¦‚æœå­æŸ¥è¯¢çš„æ‰§è¡Œä¾èµ–äºå¤–éƒ¨æŸ¥è¯¢ï¼Œé€šå¸¸æƒ…å†µä¸‹éƒ½æ˜¯å› ä¸ºå­æŸ¥è¯¢ä¸­çš„è¡¨ç”¨åˆ°äº†å¤–éƒ¨çš„è¡¨ï¼Œå¹¶è¿›è¡Œäº†æ¡ä»¶å…³è”ï¼Œå› æ­¤æ¯æ‰§è¡Œä¸€æ¬¡å¤–éƒ¨æŸ¥è¯¢ï¼Œå­æŸ¥è¯¢éƒ½è¦é‡æ–°è®¡ç®—ä¸€æ¬¡ï¼Œè¿™æ ·çš„å­æŸ¥è¯¢å°±ç§°ä¹‹ä¸º<code>å…³è”å­æŸ¥è¯¢</code>ã€‚<strong>ç›¸å…³å­æŸ¥è¯¢åªèƒ½ä¸¤å±‚ç›¸è¿ï¼Œä¸èƒ½è·¨å±‚ç›¸è¿</strong></p><p>ç›¸å…³å­æŸ¥è¯¢æŒ‰ç…§ä¸€è¡Œæ¥ä¸€è¡Œçš„é¡ºåºæ‰§è¡Œï¼Œä¸»æŸ¥è¯¢çš„æ¯ä¸€è¡Œéƒ½æ‰§è¡Œä¸€æ¬¡å­æŸ¥è¯¢ã€‚</p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554992898234.png" alt="" style="zoom:80%;" /><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554992925281.png" alt="" style="zoom:80%;" /><p>è¯´æ˜ï¼š<strong>å­æŸ¥è¯¢ä¸­ä½¿ç”¨ä¸»æŸ¥è¯¢ä¸­çš„åˆ—</strong></p><h3 id="4-2-ä»£ç ç¤ºä¾‹"><a href="#4-2-ä»£ç ç¤ºä¾‹" class="headerlink" title="4.2 ä»£ç ç¤ºä¾‹"></a>4.2 ä»£ç ç¤ºä¾‹</h3><p><strong>é¢˜ç›®ï¼šæŸ¥è¯¢å‘˜å·¥ä¸­å·¥èµ„å¤§äºæœ¬éƒ¨é—¨å¹³å‡å·¥èµ„çš„å‘˜å·¥çš„last_name,salaryå’Œå…¶department_id</strong></p><p><strong>æ–¹å¼ä¸€ï¼šç›¸å…³å­æŸ¥è¯¢</strong></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554992986225.png"></p><p><strong>æ–¹å¼äºŒï¼šåœ¨ FROM ä¸­ä½¿ç”¨å­æŸ¥è¯¢</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> last_name,salary,e1.department_id<br><span class="hljs-keyword">FROM</span> employees e1,(<span class="hljs-keyword">SELECT</span> department_id,<span class="hljs-built_in">AVG</span>(salary) dept_avg_sal <span class="hljs-keyword">FROM</span> employees <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> department_id) e2<br><span class="hljs-keyword">WHERE</span> e1.`department_id` <span class="hljs-operator">=</span> e2.department_id<br><span class="hljs-keyword">AND</span> e2.dept_avg_sal <span class="hljs-operator">&lt;</span> e1.`salary`;<br></code></pre></td></tr></table></figure><blockquote><p>fromå‹çš„å­æŸ¥è¯¢ï¼šå­æŸ¥è¯¢æ˜¯ä½œä¸ºfromçš„ä¸€éƒ¨åˆ†ï¼Œå­æŸ¥è¯¢è¦ç”¨()å¼•èµ·æ¥ï¼Œå¹¶ä¸”è¦ç»™è¿™ä¸ªå­æŸ¥è¯¢å–åˆ«åï¼Œ<br>æŠŠå®ƒå½“æˆä¸€å¼ â€œä¸´æ—¶çš„è™šæ‹Ÿçš„è¡¨â€æ¥ä½¿ç”¨ã€‚</p></blockquote><p>åœ¨ORDER BY ä¸­ä½¿ç”¨å­æŸ¥è¯¢ï¼š</p><p><strong>é¢˜ç›®ï¼šæŸ¥è¯¢å‘˜å·¥çš„id,salary,æŒ‰ç…§department_name æ’åº</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> employee_id,salary<br><span class="hljs-keyword">FROM</span> employees e<br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> (<br>  <span class="hljs-keyword">SELECT</span> department_name<br>  <span class="hljs-keyword">FROM</span> departments d<br>  <span class="hljs-keyword">WHERE</span> e.`department_id` <span class="hljs-operator">=</span> d.`department_id`<br>);<br></code></pre></td></tr></table></figure><p><strong>é¢˜ç›®ï¼šè‹¥employeesè¡¨ä¸­employee_idä¸job_historyè¡¨ä¸­employee_idç›¸åŒçš„æ•°ç›®ä¸å°äº2ï¼Œè¾“å‡ºè¿™äº›ç›¸åŒidçš„å‘˜å·¥çš„employee_id,last_nameå’Œå…¶job_id</strong></p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">e</span>.employee_id, last_name,<span class="hljs-built_in">e</span>.job_id<br><span class="hljs-keyword">FROM</span>   employees <span class="hljs-built_in">e</span> <br><span class="hljs-keyword">WHERE</span>  <span class="hljs-number">2</span> &lt;= (<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(*)<br>             <span class="hljs-keyword">FROM</span>   job_history <br>             <span class="hljs-keyword">WHERE</span>  employee_id = <span class="hljs-built_in">e</span>.employee_id);<br></code></pre></td></tr></table></figure><p><strong>åœ¨SELECTå“ªäº›ä½ç½®å¯ä»¥ä½¿ç”¨å­æŸ¥è¯¢å‘¢ï¼Ÿ</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql">#åœ¨<span class="hljs-keyword">SELECT</span>æŸ¥è¯¢è¯­å¥ä¸­ï¼Œé™¤äº†<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span>å’ŒLIMITä¹‹å¤–ï¼Œå…¶ä»–ä½ç½®éƒ½å¯ä»¥å£°æ˜å­æŸ¥è¯¢ï¼<br><span class="hljs-keyword">SELECT</span> ..., ..., ...<br><span class="hljs-keyword">FROM</span> ... (<span class="hljs-keyword">LEFT</span> <span class="hljs-operator">/</span> <span class="hljs-keyword">RIGHT</span>) <span class="hljs-keyword">JOIN</span> ... <span class="hljs-keyword">ON</span> å¤šè¡¨çš„è¿æ¥æ¡ä»¶<br>(<span class="hljs-keyword">LEFT</span> <span class="hljs-operator">/</span> <span class="hljs-keyword">RIGHT</span>) <span class="hljs-keyword">JOIN</span> ... <span class="hljs-keyword">ON</span> ...<br><span class="hljs-keyword">WHERE</span> ä¸åŒ…å«èšåˆå‡½æ•°çš„è¿‡æ»¤æ¡ä»¶<br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> ...<span class="hljs-operator">/</span> ...(<span class="hljs-keyword">ASC</span> <span class="hljs-operator">/</span> <span class="hljs-keyword">DESC</span>)<br>LIMIT ..., ...<br></code></pre></td></tr></table></figure><h3 id="4-3-EXISTS-ä¸-NOT-EXISTSå…³é”®å­—"><a href="#4-3-EXISTS-ä¸-NOT-EXISTSå…³é”®å­—" class="headerlink" title="4.3 EXISTS ä¸ NOT EXISTSå…³é”®å­—"></a>4.3 EXISTS ä¸ NOT EXISTSå…³é”®å­—</h3><ul><li>å…³è”å­æŸ¥è¯¢é€šå¸¸ä¹Ÿä¼šå’Œ EXISTSæ“ä½œç¬¦ä¸€èµ·æ¥ä½¿ç”¨ï¼Œç”¨æ¥æ£€æŸ¥åœ¨å­æŸ¥è¯¢ä¸­æ˜¯å¦å­˜åœ¨æ»¡è¶³æ¡ä»¶çš„è¡Œã€‚</li><li><strong>å¦‚æœåœ¨å­æŸ¥è¯¢ä¸­ä¸å­˜åœ¨æ»¡è¶³æ¡ä»¶çš„è¡Œï¼š</strong><ul><li>æ¡ä»¶è¿”å› FALSE</li><li>ç»§ç»­åœ¨å­æŸ¥è¯¢ä¸­æŸ¥æ‰¾</li></ul></li><li><strong>å¦‚æœåœ¨å­æŸ¥è¯¢ä¸­å­˜åœ¨æ»¡è¶³æ¡ä»¶çš„è¡Œï¼š</strong><ul><li>ä¸åœ¨å­æŸ¥è¯¢ä¸­ç»§ç»­æŸ¥æ‰¾</li><li>æ¡ä»¶è¿”å› TRUE</li></ul></li><li>NOT EXISTSå…³é”®å­—è¡¨ç¤ºå¦‚æœä¸å­˜åœ¨æŸç§æ¡ä»¶ï¼Œåˆ™è¿”å›TRUEï¼Œå¦åˆ™è¿”å›FALSEã€‚</li></ul><p><strong>é¢˜ç›®ï¼šæŸ¥è¯¢å…¬å¸ç®¡ç†è€…çš„employee_idï¼Œlast_nameï¼Œjob_idï¼Œdepartment_idä¿¡æ¯</strong></p><p>æ–¹å¼ä¸€ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> employee_id, last_name, job_id, department_id<br><span class="hljs-keyword">FROM</span>   employees e1<br><span class="hljs-keyword">WHERE</span>  <span class="hljs-keyword">EXISTS</span> ( <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span><br>                 <span class="hljs-keyword">FROM</span>   employees e2<br>                 <span class="hljs-keyword">WHERE</span>  e2.manager_id <span class="hljs-operator">=</span> <br>                        e1.employee_id);<br></code></pre></td></tr></table></figure><p>æ–¹å¼äºŒï¼šè‡ªè¿æ¥</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> e1.employee_id, e1.last_name, e1.job_id, e1.department_id<br><span class="hljs-keyword">FROM</span>   employees e1 <span class="hljs-keyword">JOIN</span> employees e2<br><span class="hljs-keyword">WHERE</span> e1.employee_id <span class="hljs-operator">=</span> e2.manager_id;<br></code></pre></td></tr></table></figure><p>æ–¹å¼ä¸‰ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> employee_id,last_name,job_id,department_id<br><span class="hljs-keyword">FROM</span> employees<br><span class="hljs-keyword">WHERE</span> employee_id <span class="hljs-keyword">IN</span> (<br>     <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> manager_id<br>     <span class="hljs-keyword">FROM</span> employees<br>     <br>     );<br></code></pre></td></tr></table></figure><p><strong>é¢˜ç›®ï¼šæŸ¥è¯¢departmentsè¡¨ä¸­ï¼Œä¸å­˜åœ¨äºemployeesè¡¨ä¸­çš„éƒ¨é—¨çš„department_idå’Œdepartment_name</strong></p><p>æ–¹å¼ä¸€ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> department_id, department_name<br><span class="hljs-keyword">FROM</span> departments d<br><span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-string">&#x27;X&#x27;</span><br>                  <span class="hljs-keyword">FROM</span>   employees<br>                  <span class="hljs-keyword">WHERE</span>  department_id <span class="hljs-operator">=</span> d.department_id);<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554993169269.png"></p><p>æ–¹å¼äºŒï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> d.department_id, d.department_name<br><span class="hljs-keyword">FROM</span> employees e <span class="hljs-keyword">RIGHT</span> <span class="hljs-keyword">JOIN</span> departments d <br><span class="hljs-keyword">ON</span> e.department_id <span class="hljs-operator">=</span> d.department_id<br><span class="hljs-keyword">WHERE</span> e.employee_id <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NULL</span>;<br></code></pre></td></tr></table></figure><h3 id="4-4-ç›¸å…³æ›´æ–°"><a href="#4-4-ç›¸å…³æ›´æ–°" class="headerlink" title="4.4 ç›¸å…³æ›´æ–°"></a>4.4 ç›¸å…³æ›´æ–°</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql">UPDATE table1 alias1<br><span class="hljs-keyword">SET</span>    <span class="hljs-keyword">column</span> <span class="hljs-operator">=</span> (<span class="hljs-keyword">SELECT</span> expression<br>                 <span class="hljs-keyword">FROM</span>   table2 alias2<br>                 <span class="hljs-keyword">WHERE</span>  alias1.column <span class="hljs-operator">=</span> alias2.column);<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨ç›¸å…³å­æŸ¥è¯¢ä¾æ®ä¸€ä¸ªè¡¨ä¸­çš„æ•°æ®æ›´æ–°å¦ä¸€ä¸ªè¡¨çš„æ•°æ®ã€‚</p><p><strong>é¢˜ç›®ï¼šåœ¨employeesä¸­å¢åŠ ä¸€ä¸ªdepartment_nameå­—æ®µï¼Œæ•°æ®ä¸ºå‘˜å·¥å¯¹åº”çš„éƒ¨é—¨åç§°</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs mysql"># 1ï¼‰<br>ALTER TABLE employees<br>ADD(department_name VARCHAR2(14));<br><br># 2ï¼‰<br>UPDATE employees e<br>SET department_name =  (SELECT department_name <br>                       FROM   departments d<br>                       WHERE  e.department_id = d.department_id);<br><br></code></pre></td></tr></table></figure><h3 id="4-4-ç›¸å…³åˆ é™¤"><a href="#4-4-ç›¸å…³åˆ é™¤" class="headerlink" title="4.4 ç›¸å…³åˆ é™¤"></a>4.4 ç›¸å…³åˆ é™¤</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> table1 alias1<br><span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">column</span> operator (<span class="hljs-keyword">SELECT</span> expression<br>                       <span class="hljs-keyword">FROM</span>   table2 alias2<br>                       <span class="hljs-keyword">WHERE</span>  alias1.column <span class="hljs-operator">=</span> alias2.column);<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨ç›¸å…³å­æŸ¥è¯¢ä¾æ®ä¸€ä¸ªè¡¨ä¸­çš„æ•°æ®åˆ é™¤å¦ä¸€ä¸ªè¡¨çš„æ•°æ®ã€‚</p><p><strong>é¢˜ç›®ï¼šåˆ é™¤è¡¨employeesä¸­ï¼Œå…¶ä¸emp_historyè¡¨çš†æœ‰çš„æ•°æ®</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> employees e<br><span class="hljs-keyword">WHERE</span> employee_id <span class="hljs-keyword">in</span>  <br>           (<span class="hljs-keyword">SELECT</span> employee_id<br>            <span class="hljs-keyword">FROM</span>   emp_history <br>            <span class="hljs-keyword">WHERE</span>  employee_id <span class="hljs-operator">=</span> e.employee_id);<br></code></pre></td></tr></table></figure><h2 id="5-æŠ›ä¸€ä¸ªæ€è€ƒé¢˜"><a href="#5-æŠ›ä¸€ä¸ªæ€è€ƒé¢˜" class="headerlink" title="5. æŠ›ä¸€ä¸ªæ€è€ƒé¢˜"></a>5. æŠ›ä¸€ä¸ªæ€è€ƒé¢˜</h2><p><strong>é—®é¢˜ï¼š</strong>è°çš„å·¥èµ„æ¯”Abelçš„é«˜ï¼Ÿ</p><p><strong>è§£ç­”ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#æ–¹å¼1ï¼šè‡ªè¿æ¥<br>SELECT e2.last_name,e2.salary<br>FROM employees e1,employees e2<br>WHERE e1.last_name = &#x27;Abel&#x27;<br>AND e1.`salary` &lt; e2.`salary`<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#æ–¹å¼2ï¼šå­æŸ¥è¯¢<br>SELECT last_name,salary<br>FROM employees<br>WHERE salary &gt; (<br>SELECT salary<br>FROM employees<br>WHERE last_name = &#x27;Abel&#x27;<br>);<br></code></pre></td></tr></table></figure><p><strong>é—®é¢˜ï¼š</strong>ä»¥ä¸Šä¸¤ç§æ–¹å¼æœ‰å¥½åä¹‹åˆ†å—ï¼Ÿ</p><p><strong>è§£ç­”ï¼š</strong>è‡ªè¿æ¥æ–¹å¼å¥½ï¼</p><p>é¢˜ç›®ä¸­å¯ä»¥ä½¿ç”¨å­æŸ¥è¯¢ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨è‡ªè¿æ¥ã€‚ä¸€èˆ¬æƒ…å†µå»ºè®®ä½ ä½¿ç”¨è‡ªè¿æ¥ï¼Œå› ä¸ºåœ¨è®¸å¤š DBMS çš„å¤„ç†è¿‡ç¨‹ä¸­ï¼Œå¯¹äºè‡ªè¿æ¥çš„å¤„ç†é€Ÿåº¦è¦æ¯”å­æŸ¥è¯¢å¿«å¾—å¤šã€‚</p><p>å¯ä»¥è¿™æ ·ç†è§£ï¼šå­æŸ¥è¯¢å®é™…ä¸Šæ˜¯é€šè¿‡æœªçŸ¥è¡¨è¿›è¡ŒæŸ¥è¯¢åçš„æ¡ä»¶åˆ¤æ–­ï¼Œè€Œè‡ªè¿æ¥æ˜¯é€šè¿‡å·²çŸ¥çš„è‡ªèº«æ•°æ®è¡¨è¿›è¡Œæ¡ä»¶åˆ¤æ–­ï¼Œå› æ­¤åœ¨å¤§éƒ¨åˆ† DBMS ä¸­éƒ½å¯¹è‡ªè¿æ¥å¤„ç†è¿›è¡Œäº†ä¼˜åŒ–ã€‚</p><h2 id="6-è¯¾åç»ƒä¹ "><a href="#6-è¯¾åç»ƒä¹ " class="headerlink" title="6.è¯¾åç»ƒä¹ "></a>6.è¯¾åç»ƒä¹ </h2><p>å­æŸ¥è¯¢çš„ç¼–å†™æŠ€å·§ï¼Œä»å¤–å¾€é‡Œå†™æˆ–è€…ä»é‡Œå¾€å¤–å†™ï¼Ÿ</p><p>â‘ å¦‚æœå­æŸ¥è¯¢è¾ƒç®€å•ï¼Œå»ºè®®ä»å¤–å¾€é‡Œå†™ï¼›å¦‚æœå­æŸ¥è¯¢è¾ƒå›°éš¾ï¼Œå»ºè®®ä»é‡Œå¾€å¤–å†™ã€‚</p><p>â‘¡å¦‚æœæ˜¯ç›¸å…³å­æŸ¥è¯¢ï¼Œå»ºè®®ä»å¤–å¾€é‡Œå†™ã€‚</p><p>1.<strong>æŸ¥è¯¢å’Œ</strong>Zlotkey<strong>ç›¸åŒéƒ¨é—¨çš„å‘˜å·¥å§“åå’Œå·¥èµ„</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> last_name, salary<br><span class="hljs-keyword">FROM</span> employees<br><span class="hljs-keyword">WHERE</span> department_id <span class="hljs-operator">=</span> (<br>    <span class="hljs-keyword">SELECT</span> department_id<br>    <span class="hljs-keyword">FROM</span> employees<br>    <span class="hljs-keyword">WHERE</span> last_name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;Zlotkey&#x27;</span><br>)<br></code></pre></td></tr></table></figure><p>2.<strong>æŸ¥è¯¢å·¥èµ„æ¯”å…¬å¸å¹³å‡å·¥èµ„é«˜çš„å‘˜å·¥çš„å‘˜å·¥å·ï¼Œå§“åå’Œå·¥èµ„</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> employee_id, last_name, salary<br><span class="hljs-keyword">FROM</span> employees<br><span class="hljs-keyword">WHERE</span> salary <span class="hljs-operator">&gt;</span> (<br>    <span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">AVG</span>(salary)<br>    <span class="hljs-keyword">FROM</span> employees<br>)<br></code></pre></td></tr></table></figure><p>3.<strong>é€‰æ‹©å·¥èµ„å¤§äºæ‰€æœ‰</strong>JOB_ID = â€˜SA_MANâ€™<strong>çš„å‘˜å·¥çš„å·¥èµ„çš„å‘˜å·¥çš„</strong>last_name, job_id, salary</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> last_name,job_id,salary<br><span class="hljs-keyword">FROM</span> employees<br><span class="hljs-keyword">WHERE</span> salary <span class="hljs-operator">&gt;</span> <span class="hljs-keyword">ALL</span> (<br>            <span class="hljs-keyword">SELECT</span> salary<br>            <span class="hljs-keyword">FROM</span> employees<br>            <span class="hljs-keyword">WHERE</span> job_id <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;SA_MAN&#x27;</span><br>            );<br></code></pre></td></tr></table></figure><p>4.<strong>æŸ¥è¯¢å’Œå§“åä¸­åŒ…å«å­—æ¯</strong>u<strong>çš„å‘˜å·¥åœ¨ç›¸åŒéƒ¨é—¨çš„å‘˜å·¥çš„å‘˜å·¥å·å’Œå§“å</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> employee_id, last_name<br><span class="hljs-keyword">FROM</span> employees<br><span class="hljs-keyword">WHERE</span> department_id <span class="hljs-operator">=</span> <span class="hljs-keyword">ANY</span>(<br>    <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> department_id<br>    <span class="hljs-keyword">FROM</span> employees<br>    <span class="hljs-keyword">WHERE</span> last_name <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;%u%&#x27;</span><br>)<br></code></pre></td></tr></table></figure><p>5.<strong>æŸ¥è¯¢åœ¨éƒ¨é—¨çš„</strong>location_id<strong>ä¸º</strong>1700<strong>çš„éƒ¨é—¨å·¥ä½œçš„å‘˜å·¥çš„å‘˜å·¥å·</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> employee_id<br><span class="hljs-keyword">FROM</span> employees<br><span class="hljs-keyword">WHERE</span> department_id <span class="hljs-keyword">IN</span> (<br>    <span class="hljs-keyword">SELECT</span> department_id<br>    <span class="hljs-keyword">FROM</span> departments<br>    <span class="hljs-keyword">WHERE</span> location_id <span class="hljs-operator">=</span> <span class="hljs-number">1700</span><br>)<br></code></pre></td></tr></table></figure><p>6.<strong>æŸ¥è¯¢ç®¡ç†è€…æ˜¯</strong>King<strong>çš„å‘˜å·¥å§“åå’Œå·¥èµ„</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> last_name, salary<br><span class="hljs-keyword">FROM</span> employees<br><span class="hljs-keyword">WHERE</span> manager_id <span class="hljs-keyword">IN</span> (<br>    <span class="hljs-keyword">SELECT</span> employee_id<br>    <span class="hljs-keyword">FROM</span> employees<br>    <span class="hljs-keyword">WHERE</span> last_name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;King&#x27;</span><br>)<br></code></pre></td></tr></table></figure><p>7.<strong>æŸ¥è¯¢å·¥èµ„æœ€ä½çš„å‘˜å·¥ä¿¡æ¯</strong>: last_name, salary</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> last_name,salary<br><span class="hljs-keyword">FROM</span> employees<br><span class="hljs-keyword">WHERE</span> salary <span class="hljs-operator">=</span> (<br>        <span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">MIN</span>(salary)<br>        <span class="hljs-keyword">FROM</span> employees<br>);<br></code></pre></td></tr></table></figure><p>8.<strong>æŸ¥è¯¢å¹³å‡å·¥èµ„æœ€ä½çš„éƒ¨é—¨ä¿¡æ¯</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sql">#æ–¹å¼ä¸€:<br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span><br><span class="hljs-keyword">FROM</span> departments<br><span class="hljs-keyword">WHERE</span> department_id <span class="hljs-operator">=</span> (<br>            <span class="hljs-keyword">SELECT</span> department_id<br>            <span class="hljs-keyword">FROM</span> employees<br>            <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> department_id<br>            <span class="hljs-keyword">HAVING</span> <span class="hljs-built_in">AVG</span>(salary) <span class="hljs-operator">=</span> (<br>                        <span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">MIN</span>(dept_avgsal)<br>                        <span class="hljs-keyword">FROM</span> (<br>                            <span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">AVG</span>(salary) dept_avgsal<br>                            <span class="hljs-keyword">FROM</span> employees<br>                            <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> department_id<br>                            ) avg_sal<br>                                )<br>                    );<br></code></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sql">#æ–¹å¼äºŒ:<br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span><br><span class="hljs-keyword">FROM</span> departments<br><span class="hljs-keyword">WHERE</span> department_id <span class="hljs-operator">=</span> (<br>            <span class="hljs-keyword">SELECT</span> department_id<br>            <span class="hljs-keyword">FROM</span> employees<br>            <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> department_id<br>            <span class="hljs-keyword">HAVING</span> <span class="hljs-built_in">AVG</span>(salary) <span class="hljs-operator">&lt;=</span> <span class="hljs-keyword">ALL</span>(<br>                            <span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">AVG</span>(salary) avg_sal<br>                            <span class="hljs-keyword">FROM</span> employees<br>                            <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> department_id<br>)<br>);<br></code></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sql">#æ–¹å¼ä¸‰:<br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span><br><span class="hljs-keyword">FROM</span> departments<br><span class="hljs-keyword">WHERE</span> department_id <span class="hljs-operator">=</span> (<br>                    <span class="hljs-keyword">SELECT</span> department_id<br>                    <span class="hljs-keyword">FROM</span> employees<br>                    <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> department_id<br>                    <span class="hljs-keyword">HAVING</span> <span class="hljs-built_in">AVG</span>(salary) <span class="hljs-operator">=</span> (<br>                         <span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">AVG</span>(salary) avg_sal<br>                         <span class="hljs-keyword">FROM</span> employees<br>                         <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> department_id<br>                         <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> avg_sal<br>                         LIMIT <span class="hljs-number">0</span>,<span class="hljs-number">1</span> <br>                    )<br>)<br></code></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql">#æ–¹å¼å››:<br><span class="hljs-keyword">SELECT</span> d.<span class="hljs-operator">*</span><br><span class="hljs-keyword">FROM</span> departments d,(<br>    <span class="hljs-keyword">SELECT</span> department_id,<span class="hljs-built_in">AVG</span>(salary) avg_sal<br>    <span class="hljs-keyword">FROM</span> employees<br>    <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> department_id<br>    <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> avg_sal<br>    LIMIT <span class="hljs-number">0</span>,<span class="hljs-number">1</span>) dept_avg_sal<br><span class="hljs-keyword">WHERE</span> d.department_id <span class="hljs-operator">=</span> dept_avg_sal.department_id<br></code></pre></td></tr></table></figure><p>9.<strong>æŸ¥è¯¢å¹³å‡å·¥èµ„æœ€ä½çš„éƒ¨é—¨ä¿¡æ¯å’Œè¯¥éƒ¨é—¨çš„å¹³å‡å·¥èµ„(ç›¸å…³å­æŸ¥è¯¢)</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sql">#æ–¹å¼ä¸€ï¼š<br><span class="hljs-keyword">SELECT</span> d.<span class="hljs-operator">*</span>,(<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">AVG</span>(salary) <span class="hljs-keyword">FROM</span> employees <span class="hljs-keyword">WHERE</span> department_id <span class="hljs-operator">=</span> d.department_id) avg_sal<br><span class="hljs-keyword">FROM</span> departments d<br><span class="hljs-keyword">WHERE</span> department_id <span class="hljs-operator">=</span> (<br>            <span class="hljs-keyword">SELECT</span> department_id<br>            <span class="hljs-keyword">FROM</span> employees<br>            <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> department_id<br>            <span class="hljs-keyword">HAVING</span> <span class="hljs-built_in">AVG</span>(salary) <span class="hljs-operator">=</span> (<br>                        <span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">MIN</span>(dept_avgsal)<br>                        <span class="hljs-keyword">FROM</span> (<br>                            <span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">AVG</span>(salary) dept_avgsal<br>                            <span class="hljs-keyword">FROM</span> employees<br>                            <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> department_id<br>                            ) avg_sal<br>                ) <br>);<br></code></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sql">#æ–¹å¼äºŒ:<br><span class="hljs-keyword">SELECT</span> d.<span class="hljs-operator">*</span>,(<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">AVG</span>(salary) <span class="hljs-keyword">FROM</span> employees <span class="hljs-keyword">WHERE</span> department_id <span class="hljs-operator">=</span> d.`department_id`) avg_sal<br><span class="hljs-keyword">FROM</span> departments d<br><span class="hljs-keyword">WHERE</span> department_id <span class="hljs-operator">=</span> (<br>            <span class="hljs-keyword">SELECT</span> department_id<br>            <span class="hljs-keyword">FROM</span> employees<br>            <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> department_id<br>            <span class="hljs-keyword">HAVING</span> <span class="hljs-built_in">AVG</span>(salary) <span class="hljs-operator">&lt;=</span> <span class="hljs-keyword">ALL</span>(<br>                        <span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">AVG</span>(salary) avg_sal<br>                        <span class="hljs-keyword">FROM</span> employees<br>                        <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> department_id<br>                        )<br>)<br></code></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sql">#æ–¹å¼ä¸‰:<br><span class="hljs-keyword">SELECT</span> d.<span class="hljs-operator">*</span>,(<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">AVG</span>(salary) <span class="hljs-keyword">FROM</span> employees <span class="hljs-keyword">WHERE</span> department_id <span class="hljs-operator">=</span> d.department_id) avg_sal<br><span class="hljs-keyword">FROM</span> departments d<br><span class="hljs-keyword">WHERE</span> department_id <span class="hljs-operator">=</span> (<br>            <span class="hljs-keyword">SELECT</span> department_id<br>            <span class="hljs-keyword">FROM</span> employees<br>            <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> department_id<br>            <span class="hljs-keyword">HAVING</span> <span class="hljs-built_in">AVG</span>(salary) <span class="hljs-operator">=</span> (<br>                 <span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">AVG</span>(salary) avg_sal<br>                 <span class="hljs-keyword">FROM</span> employees<br>                 <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> department_id<br>                 <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> avg_sal<br>                 LIMIT <span class="hljs-number">0</span>,<span class="hljs-number">1</span> <br>            )<br>)<br></code></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql">#æ–¹å¼å››:<br><span class="hljs-keyword">SELECT</span> d.<span class="hljs-operator">*</span>,dept_avg_sal.avg_sal <span class="hljs-keyword">FROM</span> departments d,(<br>    <span class="hljs-keyword">SELECT</span> department_id,<span class="hljs-built_in">AVG</span>(salary) avg_sal<br>    <span class="hljs-keyword">FROM</span> employees<br>    <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> department_id<br>    <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> avg_sal<br>    LIMIT <span class="hljs-number">0</span>,<span class="hljs-number">1</span>) dept_avg_sal<br><span class="hljs-keyword">WHERE</span> d.department_id <span class="hljs-operator">=</span> dept_avg_sal.department_id<br></code></pre></td></tr></table></figure><p>10.<strong>æŸ¥è¯¢å¹³å‡å·¥èµ„æœ€é«˜çš„</strong> job <strong>ä¿¡æ¯</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sql">#æ–¹å¼ä¸€:<br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span><br><span class="hljs-keyword">FROM</span> jobs<br><span class="hljs-keyword">WHERE</span> job_id <span class="hljs-operator">=</span> (<br>        <span class="hljs-keyword">SELECT</span> job_id<br>        <span class="hljs-keyword">FROM</span> employees<br>        <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> job_id<br>        <span class="hljs-keyword">HAVING</span> <span class="hljs-built_in">AVG</span>(salary) <span class="hljs-operator">=</span> (<br>                    <span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">MAX</span>(avg_sal)<br>                    <span class="hljs-keyword">FROM</span>(<br>                        <span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">AVG</span>(salary) avg_sal<br>                        <span class="hljs-keyword">FROM</span> employees<br>                        <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> job_id<br>                        ) job_avgsal       <br>) <br>);<br></code></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sql">#æ–¹å¼äºŒ:<br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span><br><span class="hljs-keyword">FROM</span> jobs<br><span class="hljs-keyword">WHERE</span> job_id <span class="hljs-operator">=</span> (<br>        <span class="hljs-keyword">SELECT</span> job_id<br>        <span class="hljs-keyword">FROM</span> employees<br>        <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> job_id<br>        <span class="hljs-keyword">HAVING</span> <span class="hljs-built_in">AVG</span>(salary) <span class="hljs-operator">&gt;=</span> <span class="hljs-keyword">ALL</span>(<br>            <span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">AVG</span>(salary)<br>            <span class="hljs-keyword">FROM</span> employees<br>            <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> job_id<br>            )<br>);<br></code></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sql">#æ–¹å¼ä¸‰:<br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span><br><span class="hljs-keyword">FROM</span> jobs<br><span class="hljs-keyword">WHERE</span> job_id <span class="hljs-operator">=</span> (<br>        <span class="hljs-keyword">SELECT</span> job_id<br>        <span class="hljs-keyword">FROM</span> employees<br>        <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> job_id<br>        <span class="hljs-keyword">HAVING</span> <span class="hljs-built_in">AVG</span>(salary) <span class="hljs-operator">=</span> (<br>            <span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">AVG</span>(salary) avg_sal<br>            <span class="hljs-keyword">FROM</span> employees<br>            <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> job_id<br>            <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> avg_sal <span class="hljs-keyword">DESC</span><br>            LIMIT <span class="hljs-number">0</span>,<span class="hljs-number">1</span><br>            )<br>);<br></code></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql">#æ–¹å¼å››: <br><span class="hljs-keyword">SELECT</span> j.<span class="hljs-operator">*</span> <br><span class="hljs-keyword">FROM</span> jobs j,(<br>        <span class="hljs-keyword">SELECT</span> job_id,<span class="hljs-built_in">AVG</span>(salary) avg_sal<br>        <span class="hljs-keyword">FROM</span> employees<br>        <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> job_id<br>        <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> avg_sal <span class="hljs-keyword">DESC</span><br>        LIMIT <span class="hljs-number">0</span>,<span class="hljs-number">1</span> ) job_avg_sal<br><span class="hljs-keyword">WHERE</span> j.job_id <span class="hljs-operator">=</span> job_avg_sal.job_id<br></code></pre></td></tr></table></figure><p>11.<strong>æŸ¥è¯¢å¹³å‡å·¥èµ„é«˜äºå…¬å¸å¹³å‡å·¥èµ„çš„éƒ¨é—¨æœ‰å“ªäº›</strong>?</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> department_id<br><span class="hljs-keyword">FROM</span> employees<br><span class="hljs-keyword">WHERE</span> department_id <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span><br><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> department_id<br><span class="hljs-keyword">HAVING</span> <span class="hljs-built_in">AVG</span>(salary) <span class="hljs-operator">&gt;</span> (<br>              <span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">AVG</span>(salary)<br>              <span class="hljs-keyword">FROM</span> employees<br>            );<br></code></pre></td></tr></table></figure><p>12.<strong>æŸ¥è¯¢å‡ºå…¬å¸ä¸­æ‰€æœ‰</strong> manager <strong>çš„è¯¦ç»†ä¿¡æ¯</strong>.</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql">#æ–¹å¼<span class="hljs-number">1</span>:<br><span class="hljs-keyword">SELECT</span> employee_id,last_name,salary <span class="hljs-keyword">FROM</span> employees<br><span class="hljs-keyword">WHERE</span> employee_id <span class="hljs-keyword">IN</span> (<br>              <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> manager_id<br>              <span class="hljs-keyword">FROM</span> employees<br>            );<br></code></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql">#æ–¹å¼<span class="hljs-number">2</span>:<br><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> e1.employee_id, e1.last_name, e1.salary <br><span class="hljs-keyword">FROM</span> employees e1 <span class="hljs-keyword">JOIN</span> employees e2<br><span class="hljs-keyword">WHERE</span> e1.employee_id <span class="hljs-operator">=</span> e2.manager_id;<br></code></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql">#æ–¹å¼<span class="hljs-number">3</span>:<br><span class="hljs-keyword">SELECT</span> employee_id, last_name, salary <span class="hljs-keyword">FROM</span> employees e1<br><span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">EXISTS</span> ( <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span><br>                 <span class="hljs-keyword">FROM</span>   employees e2<br>                 <span class="hljs-keyword">WHERE</span>  e2.manager_id <span class="hljs-operator">=</span> e1.employee_id);<br></code></pre></td></tr></table></figure><p>13.<strong>å„ä¸ªéƒ¨é—¨ä¸­ æœ€é«˜å·¥èµ„ä¸­æœ€ä½çš„é‚£ä¸ªéƒ¨é—¨çš„ æœ€ä½å·¥èµ„æ˜¯å¤šå°‘</strong>?</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sql">#æ–¹å¼<span class="hljs-number">1</span>:<br><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">MIN</span>(salary)<br><span class="hljs-keyword">FROM</span> employees<br><span class="hljs-keyword">WHERE</span> department_id <span class="hljs-operator">=</span> (<br>            <span class="hljs-keyword">SELECT</span> department_id<br>            <span class="hljs-keyword">FROM</span> employees<br>            <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> department_id<br>            <span class="hljs-keyword">HAVING</span> <span class="hljs-built_in">MAX</span>(salary) <span class="hljs-operator">=</span> (<br>                        <span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">MIN</span>(max_sal)<br>                        <span class="hljs-keyword">FROM</span> (<br>                        <span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">MAX</span>(salary) max_sal<br>                        <span class="hljs-keyword">FROM</span> employees<br>                        <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> department_id) dept_max_sal<br>                        )<br>);<br></code></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sql">#æ–¹å¼<span class="hljs-number">2</span>:<br><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">MIN</span>(salary)<br><span class="hljs-keyword">FROM</span> employees<br><span class="hljs-keyword">WHERE</span> department_id <span class="hljs-operator">=</span> (<br>            <span class="hljs-keyword">SELECT</span> department_id<br>            <span class="hljs-keyword">FROM</span> employees<br>            <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> department_id<br>            <span class="hljs-keyword">HAVING</span> <span class="hljs-built_in">MAX</span>(salary) <span class="hljs-operator">&lt;=</span> <span class="hljs-keyword">ALL</span>(<br>                <span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">MAX</span>(salary) max_sal<br>                <span class="hljs-keyword">FROM</span> employees<br>                <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> department_id<br>                )<br>);<br></code></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sql">#æ–¹å¼<span class="hljs-number">3</span>:<br><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">MIN</span>(salary)<br><span class="hljs-keyword">FROM</span> employees<br><span class="hljs-keyword">WHERE</span> department_id <span class="hljs-operator">=</span> (<br>            <span class="hljs-keyword">SELECT</span> department_id<br>            <span class="hljs-keyword">FROM</span> employees<br>            <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> department_id<br>            <span class="hljs-keyword">HAVING</span> <span class="hljs-built_in">MAX</span>(salary) <span class="hljs-operator">=</span> (<br>                <span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">MAX</span>(salary) max_sal<br>                <span class="hljs-keyword">FROM</span> employees<br>                <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> department_id<br>                <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> max_sal<br>                LIMIT <span class="hljs-number">0</span>,<span class="hljs-number">1</span> <br>            )<br>)<br></code></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql">#æ–¹å¼<span class="hljs-number">4</span>:<br><span class="hljs-keyword">SELECT</span> employee_id,<span class="hljs-built_in">MIN</span>(salary) <br><span class="hljs-keyword">FROM</span> employees e,<br>                (<span class="hljs-keyword">SELECT</span> department_id,<span class="hljs-built_in">MAX</span>(salary) max_sal<br>                <span class="hljs-keyword">FROM</span> employees<br>                <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> department_id<br>                <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> max_sal<br>                LIMIT <span class="hljs-number">0</span>,<span class="hljs-number">1</span>) dept_max_sal<br><span class="hljs-keyword">WHERE</span> e.department_id <span class="hljs-operator">=</span> dept_max_sal.department_id<br></code></pre></td></tr></table></figure><p>14.<strong>æŸ¥è¯¢å¹³å‡å·¥èµ„æœ€é«˜çš„éƒ¨é—¨çš„</strong> manager <strong>çš„è¯¦ç»†ä¿¡æ¯</strong>: last_name,department_id, email, salary</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs sql">#æ–¹å¼ä¸€:<br><span class="hljs-keyword">SELECT</span> employee_id,last_name, department_id, email, salary <span class="hljs-keyword">FROM</span> employees<br><span class="hljs-keyword">WHERE</span> employee_id <span class="hljs-keyword">IN</span> (<br>            <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> manager_id<br>            <span class="hljs-keyword">FROM</span> employees<br>            <span class="hljs-keyword">WHERE</span> department_id <span class="hljs-operator">=</span> (<br>                        <span class="hljs-keyword">SELECT</span> department_id<br>                        <span class="hljs-keyword">FROM</span> employees<br>                        <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> department_id<br>                        <span class="hljs-keyword">HAVING</span> <span class="hljs-built_in">AVG</span>(salary) <span class="hljs-operator">=</span> (<br>                                    <span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">MAX</span>(avg_sal)<br>                                    <span class="hljs-keyword">FROM</span>(<br>                                        <span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">AVG</span>(salary) avg_sal<br>                                        <span class="hljs-keyword">FROM</span> employees<br>                                        <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> department_id<br>                                        ) dept_sal<br>                            )<br>                )<br>    );<br></code></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sql">#æ–¹å¼äºŒ:<br><span class="hljs-keyword">SELECT</span> employee_id,last_name, department_id, email, salary <span class="hljs-keyword">FROM</span> employees<br><span class="hljs-keyword">WHERE</span> employee_id <span class="hljs-keyword">IN</span> (<br>                    <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> manager_id<br>                    <span class="hljs-keyword">FROM</span> employees<br>                    <span class="hljs-keyword">WHERE</span> department_id <span class="hljs-operator">=</span> (<br>                        <span class="hljs-keyword">SELECT</span> department_id<br>                        <span class="hljs-keyword">FROM</span> employees e<br>                        <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> department_id<br>                        <span class="hljs-keyword">HAVING</span> <span class="hljs-built_in">AVG</span>(salary)<span class="hljs-operator">&gt;=</span><span class="hljs-keyword">ALL</span>(<br>                                            <span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">AVG</span>(salary)<br>                                            <span class="hljs-keyword">FROM</span> employees<br>                                            <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> department_id<br>                        )<br>                    )                        <br>);<br></code></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sql">#æ–¹å¼ä¸‰:<br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span><br><span class="hljs-keyword">FROM</span> employees<br><span class="hljs-keyword">WHERE</span> employee_id <span class="hljs-keyword">IN</span> (<br>            <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> manager_id<br>            <span class="hljs-keyword">FROM</span> employees e,(<br>                    <span class="hljs-keyword">SELECT</span> department_id,<span class="hljs-built_in">AVG</span>(salary) avg_sal<br>                    <span class="hljs-keyword">FROM</span> employees<br>                    <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> department_id<br>                    <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> avg_sal <span class="hljs-keyword">DESC</span><br>                    LIMIT <span class="hljs-number">0</span>,<span class="hljs-number">1</span>) dept_avg_sal<br>            <span class="hljs-keyword">WHERE</span> e.department_id <span class="hljs-operator">=</span> dept_avg_sal.department_id<br>            )<br></code></pre></td></tr></table></figure><p>15.<strong>æŸ¥è¯¢éƒ¨é—¨çš„éƒ¨é—¨å·ï¼Œå…¶ä¸­ä¸åŒ…æ‹¬</strong>job_id<strong>æ˜¯</strong>â€œST_CLERKâ€<strong>çš„éƒ¨é—¨å·</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql">#æ–¹æ³•ä¸€:<br><span class="hljs-keyword">SELECT</span> department_id<br><span class="hljs-keyword">FROM</span> departments d<br><span class="hljs-keyword">WHERE</span> department_id <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">IN</span> (<br>        <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> department_id<br>        <span class="hljs-keyword">FROM</span> employees<br>        <span class="hljs-keyword">WHERE</span> job_id <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;ST_CLERK&#x27;</span><br>        );<br></code></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql">#æ–¹æ³•äºŒ:<br><span class="hljs-keyword">SELECT</span> department_id <span class="hljs-keyword">FROM</span> departments d <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> (<br>        <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span><br>        <span class="hljs-keyword">FROM</span> employees e<br>        <span class="hljs-keyword">WHERE</span> d.`department_id` <span class="hljs-operator">=</span> e.`department_id`<br>        <span class="hljs-keyword">AND</span> job_id <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;ST_CLERK&#x27;</span><br>        );<br></code></pre></td></tr></table></figure><p>16.<strong>é€‰æ‹©æ‰€æœ‰æ²¡æœ‰ç®¡ç†è€…çš„å‘˜å·¥çš„</strong>last_name</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> last_name<br><span class="hljs-keyword">FROM</span> employees e1<br><span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> (<br>        <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span><br>        <span class="hljs-keyword">FROM</span> employees e2<br>        <span class="hljs-keyword">WHERE</span> e1.manager_id <span class="hljs-operator">=</span> e2.employee_id<br>        );<br></code></pre></td></tr></table></figure><p>17**.æŸ¥è¯¢å‘˜å·¥å·ã€å§“åã€é›‡ç”¨æ—¶é—´ã€å·¥èµ„ï¼Œå…¶ä¸­å‘˜å·¥çš„ç®¡ç†è€…ä¸º** â€˜De Haanâ€™</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql">#æ–¹å¼<span class="hljs-number">1</span>:<br><span class="hljs-keyword">SELECT</span> employee_id, last_name, hire_date, salary <span class="hljs-keyword">FROM</span> employees<br><span class="hljs-keyword">WHERE</span> manager_id <span class="hljs-operator">=</span> (<br>    <span class="hljs-keyword">SELECT</span> employee_id<br>    <span class="hljs-keyword">FROM</span> employees<br>    <span class="hljs-keyword">WHERE</span> last_name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;De Haan&#x27;</span><br>)<br></code></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql">#æ–¹å¼<span class="hljs-number">2</span>:<br><span class="hljs-keyword">SELECT</span> employee_id, last_name, hire_date, salary <span class="hljs-keyword">FROM</span> employees e1<br><span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">EXISTS</span> (<br>        <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span><br>        <span class="hljs-keyword">FROM</span> employees e2<br>        <span class="hljs-keyword">WHERE</span> e2.`employee_id` <span class="hljs-operator">=</span> e1.manager_id<br>        <span class="hljs-keyword">AND</span> e2.last_name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;De Haan&#x27;</span><br>        );<br></code></pre></td></tr></table></figure><p>18.<strong>æŸ¥è¯¢å„éƒ¨é—¨ä¸­å·¥èµ„æ¯”æœ¬éƒ¨é—¨å¹³å‡å·¥èµ„é«˜çš„å‘˜å·¥çš„å‘˜å·¥å·</strong>, <strong>å§“åå’Œå·¥èµ„</strong>(<strong>éš¾</strong>)</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql">#æ–¹å¼ä¸€:ç›¸å…³å­æŸ¥è¯¢<br><span class="hljs-keyword">SELECT</span> employee_id,last_name,salary <span class="hljs-keyword">FROM</span> employees e1<br><span class="hljs-keyword">WHERE</span> salary <span class="hljs-operator">&gt;</span> (<br>                # æŸ¥è¯¢æŸå‘˜å·¥æ‰€åœ¨éƒ¨é—¨çš„å¹³å‡<br>                <span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">AVG</span>(salary)<br>                <span class="hljs-keyword">FROM</span> employees e2<br>                <span class="hljs-keyword">WHERE</span> e2.department_id <span class="hljs-operator">=</span> e1.`department_id` <br>);<br></code></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql">#æ–¹å¼äºŒ:<br><span class="hljs-keyword">SELECT</span> employee_id,last_name,salary<br><span class="hljs-keyword">FROM</span> employees e1,<br>(<span class="hljs-keyword">SELECT</span> department_id,<span class="hljs-built_in">AVG</span>(salary) avg_sal<br><span class="hljs-keyword">FROM</span> employees e2 <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> department_id<br>) dept_avg_sal<br><span class="hljs-keyword">WHERE</span> e1.`department_id` <span class="hljs-operator">=</span> dept_avg_sal.department_id <span class="hljs-keyword">AND</span> e1.`salary` <span class="hljs-operator">&gt;</span> dept_avg_sal.avg_sal;<br></code></pre></td></tr></table></figure><p>19.<strong>æŸ¥è¯¢æ¯ä¸ªéƒ¨é—¨ä¸‹çš„éƒ¨é—¨äººæ•°å¤§äº</strong> 5 <strong>çš„éƒ¨é—¨åç§°</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> department_name,department_id<br><span class="hljs-keyword">FROM</span> departments d<br><span class="hljs-keyword">WHERE</span> <span class="hljs-number">5</span> <span class="hljs-operator">&lt;</span> (<br>    <span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>)<br>    <span class="hljs-keyword">FROM</span> employees e<br>    <span class="hljs-keyword">WHERE</span> d.`department_id` <span class="hljs-operator">=</span> e.`department_id`<br>    );<br></code></pre></td></tr></table></figure><p>20.<strong>æŸ¥è¯¢æ¯ä¸ªå›½å®¶ä¸‹çš„éƒ¨é—¨ä¸ªæ•°å¤§äº</strong> 2 <strong>çš„å›½å®¶ç¼–å·</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> country_id<br><span class="hljs-keyword">FROM</span> locations l<br><span class="hljs-keyword">WHERE</span> <span class="hljs-number">2</span> <span class="hljs-operator">&lt;</span> (<br>    <span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>)<br>    <span class="hljs-keyword">FROM</span> departments d<br>    <span class="hljs-keyword">WHERE</span> l.`location_id` <span class="hljs-operator">=</span> d.`location_id`<br>    );<br></code></pre></td></tr></table></figure><h1 id="ç¬¬10ç« -åˆ›å»ºå’Œç®¡ç†è¡¨"><a href="#ç¬¬10ç« -åˆ›å»ºå’Œç®¡ç†è¡¨" class="headerlink" title="ç¬¬10ç« _åˆ›å»ºå’Œç®¡ç†è¡¨"></a>ç¬¬10ç« _åˆ›å»ºå’Œç®¡ç†è¡¨</h1><h2 id="1-åŸºç¡€çŸ¥è¯†"><a href="#1-åŸºç¡€çŸ¥è¯†" class="headerlink" title="1. åŸºç¡€çŸ¥è¯†"></a>1. åŸºç¡€çŸ¥è¯†</h2><h3 id="1-1-ä¸€æ¡æ•°æ®å­˜å‚¨çš„è¿‡ç¨‹"><a href="#1-1-ä¸€æ¡æ•°æ®å­˜å‚¨çš„è¿‡ç¨‹" class="headerlink" title="1.1 ä¸€æ¡æ•°æ®å­˜å‚¨çš„è¿‡ç¨‹"></a>1.1 ä¸€æ¡æ•°æ®å­˜å‚¨çš„è¿‡ç¨‹</h3><p><code>å­˜å‚¨æ•°æ®æ˜¯å¤„ç†æ•°æ®çš„ç¬¬ä¸€æ­¥</code>ã€‚åªæœ‰æ­£ç¡®åœ°æŠŠæ•°æ®å­˜å‚¨èµ·æ¥ï¼Œæˆ‘ä»¬æ‰èƒ½è¿›è¡Œæœ‰æ•ˆçš„å¤„ç†å’Œåˆ†æã€‚å¦åˆ™ï¼Œåªèƒ½æ˜¯ä¸€å›¢ä¹±éº»ï¼Œæ— ä»ä¸‹æ‰‹ã€‚</p><p>é‚£ä¹ˆï¼Œæ€æ ·æ‰èƒ½æŠŠç”¨æˆ·å„ç§ç»è¥ç›¸å…³çš„ã€çº·ç¹å¤æ‚çš„æ•°æ®ï¼Œæœ‰åºã€é«˜æ•ˆåœ°å­˜å‚¨èµ·æ¥å‘¢ï¼Ÿ åœ¨ MySQL ä¸­ï¼Œä¸€ä¸ªå®Œæ•´çš„æ•°æ®å­˜å‚¨è¿‡ç¨‹æ€»å…±æœ‰ 4 æ­¥ï¼Œåˆ†åˆ«æ˜¯åˆ›å»ºæ•°æ®åº“ã€ç¡®è®¤å­—æ®µã€åˆ›å»ºæ•°æ®è¡¨ã€æ’å…¥æ•°æ®ã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211007155810920.png"></p><p>æˆ‘ä»¬è¦å…ˆåˆ›å»ºä¸€ä¸ªæ•°æ®åº“ï¼Œè€Œä¸æ˜¯ç›´æ¥åˆ›å»ºæ•°æ®è¡¨å‘¢ï¼Ÿ </p><p>å› ä¸ºä»ç³»ç»Ÿæ¶æ„çš„å±‚æ¬¡ä¸Šçœ‹ï¼ŒMySQL æ•°æ®åº“ç³»ç»Ÿä»å¤§åˆ°å°ä¾æ¬¡æ˜¯<code>æ•°æ®åº“æœåŠ¡å™¨</code>ã€<code>æ•°æ®åº“</code>ã€<code>æ•°æ®è¡¨</code>ã€æ•°æ®è¡¨çš„<code>è¡Œä¸åˆ—</code>ã€‚ </p><p>MySQL æ•°æ®åº“æœåŠ¡å™¨ä¹‹å‰å·²ç»å®‰è£…ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å°±ä»åˆ›å»ºæ•°æ®åº“å¼€å§‹ã€‚</p><h3 id="1-2-æ ‡è¯†ç¬¦å‘½åè§„åˆ™"><a href="#1-2-æ ‡è¯†ç¬¦å‘½åè§„åˆ™" class="headerlink" title="1.2 æ ‡è¯†ç¬¦å‘½åè§„åˆ™"></a>1.2 æ ‡è¯†ç¬¦å‘½åè§„åˆ™</h3><ul><li>æ•°æ®åº“åã€è¡¨åä¸å¾—è¶…è¿‡30ä¸ªå­—ç¬¦ï¼Œå˜é‡åé™åˆ¶ä¸º29ä¸ª</li><li>å¿…é¡»åªèƒ½åŒ…å« Aâ€“Z, aâ€“z, 0â€“9, _å…±63ä¸ªå­—ç¬¦</li><li>æ•°æ®åº“åã€è¡¨åã€å­—æ®µåç­‰å¯¹è±¡åä¸­é—´ä¸è¦åŒ…å«ç©ºæ ¼</li><li>åŒä¸€ä¸ªMySQLè½¯ä»¶ä¸­ï¼Œæ•°æ®åº“ä¸èƒ½åŒåï¼›åŒä¸€ä¸ªåº“ä¸­ï¼Œè¡¨ä¸èƒ½é‡åï¼›åŒä¸€ä¸ªè¡¨ä¸­ï¼Œå­—æ®µä¸èƒ½é‡å</li><li>å¿…é¡»ä¿è¯ä½ çš„å­—æ®µæ²¡æœ‰å’Œä¿ç•™å­—ã€æ•°æ®åº“ç³»ç»Ÿæˆ–å¸¸ç”¨æ–¹æ³•å†²çªã€‚å¦‚æœåšæŒä½¿ç”¨ï¼Œè¯·åœ¨SQLè¯­å¥ä¸­ä½¿ç”¨`ï¼ˆç€é‡å·ï¼‰å¼•èµ·æ¥</li><li>ä¿æŒå­—æ®µåå’Œç±»å‹çš„ä¸€è‡´æ€§ï¼šåœ¨å‘½åå­—æ®µå¹¶ä¸ºå…¶æŒ‡å®šæ•°æ®ç±»å‹çš„æ—¶å€™ä¸€å®šè¦ä¿è¯ä¸€è‡´æ€§ï¼Œå‡å¦‚æ•°æ®ç±»å‹åœ¨ä¸€ä¸ªè¡¨é‡Œæ˜¯æ•´æ•°ï¼Œé‚£åœ¨å¦ä¸€ä¸ªè¡¨é‡Œå¯å°±åˆ«å˜æˆå­—ç¬¦å‹äº†</li></ul><h3 id="1-3-MySQLä¸­çš„æ•°æ®ç±»å‹"><a href="#1-3-MySQLä¸­çš„æ•°æ®ç±»å‹" class="headerlink" title="1.3 MySQLä¸­çš„æ•°æ®ç±»å‹"></a>1.3 MySQLä¸­çš„æ•°æ®ç±»å‹</h3><table><thead><tr><th>ç±»å‹</th><th>ç±»å‹ä¸¾ä¾‹</th></tr></thead><tbody><tr><td>æ•´æ•°ç±»å‹</td><td>TINYINTã€SMALLINTã€MEDIUMINTã€**INT(æˆ–INTEGER)**ã€BIGINT</td></tr><tr><td>æµ®ç‚¹ç±»å‹</td><td>FLOATã€DOUBLE   ä¸é è°±</td></tr><tr><td>å®šç‚¹æ•°ç±»å‹</td><td>**DECIMAL ** æ›´å‡†ç¡®</td></tr><tr><td>ä½ç±»å‹</td><td>BIT</td></tr><tr><td>æ—¥æœŸæ—¶é—´ç±»å‹</td><td>YEARã€TIMEã€<strong>DATE</strong>ã€DATETIMEã€TIMESTAMP</td></tr><tr><td>æ–‡æœ¬å­—ç¬¦ä¸²ç±»å‹</td><td>CHARã€<strong>VARCHAR</strong>ã€TINYTEXTã€TEXTã€MEDIUMTEXTã€LONGTEXT</td></tr><tr><td>æšä¸¾ç±»å‹</td><td>ENUM</td></tr><tr><td>é›†åˆç±»å‹</td><td>SET</td></tr><tr><td>äºŒè¿›åˆ¶å­—ç¬¦ä¸²ç±»å‹</td><td>BINARYã€VARBINARYã€TINYBLOBã€BLOBã€MEDIUMBLOBã€LONGBLOB</td></tr><tr><td>JSONç±»å‹</td><td>JSONå¯¹è±¡ã€JSONæ•°ç»„</td></tr><tr><td>ç©ºé—´æ•°æ®ç±»å‹</td><td>å•å€¼ï¼šGEOMETRYã€POINTã€LINESTRINGã€POLYGONï¼›<br/>é›†åˆï¼šMULTIPOINTã€MULTILINESTRINGã€MULTIPOLYGONã€GEOMETRYCOLLECTION</td></tr></tbody></table><p>å…¶ä¸­ï¼Œå¸¸ç”¨çš„å‡ ç±»ç±»å‹ä»‹ç»å¦‚ä¸‹ï¼š</p><table><thead><tr><th>æ•°æ®ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td>INT</td><td>ä»-2^31åˆ°2^31-1çš„æ•´å‹æ•°æ®ã€‚å­˜å‚¨å¤§å°ä¸º 4ä¸ªå­—èŠ‚</td></tr><tr><td>CHAR(size)</td><td>å®šé•¿å­—ç¬¦æ•°æ®ã€‚è‹¥æœªæŒ‡å®šï¼Œé»˜è®¤ä¸º1ä¸ªå­—ç¬¦ï¼Œæœ€å¤§é•¿åº¦255</td></tr><tr><td>VARCHAR(size)</td><td>å¯å˜é•¿å­—ç¬¦æ•°æ®ï¼Œæ ¹æ®å­—ç¬¦ä¸²å®é™…é•¿åº¦ä¿å­˜ï¼Œ<strong>å¿…é¡»æŒ‡å®šé•¿åº¦</strong></td></tr><tr><td>FLOAT(M,D)</td><td>å•ç²¾åº¦ï¼Œå ç”¨4ä¸ªå­—èŠ‚ï¼ŒM=æ•´æ•°ä½+å°æ•°ä½ï¼ŒD=å°æ•°ä½ã€‚ D&lt;=M&lt;=255,0&lt;=D&lt;=30ï¼Œé»˜è®¤M+D&lt;=6</td></tr><tr><td>DOUBLE(M,D)</td><td>åŒç²¾åº¦ï¼Œå ç”¨8ä¸ªå­—èŠ‚ï¼ŒD&lt;=M&lt;=255,0&lt;=D&lt;=30ï¼Œé»˜è®¤M+D&lt;=15</td></tr><tr><td>DECIMAL(M,D)</td><td>é«˜ç²¾åº¦å°æ•°ï¼Œå ç”¨M+2ä¸ªå­—èŠ‚ï¼ŒD&lt;=M&lt;=65ï¼Œ0&lt;=D&lt;=30ï¼Œæœ€å¤§å–å€¼èŒƒå›´ä¸DOUBLEç›¸åŒã€‚</td></tr><tr><td>DATE</td><td>æ—¥æœŸå‹æ•°æ®ï¼Œæ ¼å¼â€™YYYY-MM-DDâ€™</td></tr><tr><td>BLOB</td><td>äºŒè¿›åˆ¶å½¢å¼çš„é•¿æ–‡æœ¬æ•°æ®ï¼Œæœ€å¤§å¯è¾¾4G</td></tr><tr><td>TEXT</td><td>é•¿æ–‡æœ¬æ•°æ®ï¼Œæœ€å¤§å¯è¾¾4G</td></tr></tbody></table><h2 id="2-åˆ›å»ºå’Œç®¡ç†æ•°æ®åº“"><a href="#2-åˆ›å»ºå’Œç®¡ç†æ•°æ®åº“" class="headerlink" title="2. åˆ›å»ºå’Œç®¡ç†æ•°æ®åº“"></a>2. åˆ›å»ºå’Œç®¡ç†æ•°æ®åº“</h2><h3 id="2-1-åˆ›å»ºæ•°æ®åº“"><a href="#2-1-åˆ›å»ºæ•°æ®åº“" class="headerlink" title="2.1 åˆ›å»ºæ•°æ®åº“"></a>2.1 åˆ›å»ºæ•°æ®åº“</h3><ul><li>æ–¹å¼1ï¼šåˆ›å»ºæ•°æ®åº“(æ–°æ•°æ®åº“ä½¿ç”¨é»˜è®¤çš„å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™)</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE DATABASE æ•°æ®åº“å; <br></code></pre></td></tr></table></figure><ul><li>æ–¹å¼2ï¼šåˆ›å»ºæ•°æ®åº“å¹¶æŒ‡å®šå­—ç¬¦é›†</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE DATABASE æ•°æ®åº“å CHARACTER SET å­—ç¬¦é›†;<br></code></pre></td></tr></table></figure><ul><li>æ–¹å¼3ï¼šåˆ¤æ–­æ•°æ®åº“æ˜¯å¦å·²ç»å­˜åœ¨ï¼Œä¸å­˜åœ¨åˆ™åˆ›å»ºæ•°æ®åº“ï¼ˆ<code>æ¨è</code>ï¼‰</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE DATABASE IF NOT EXISTS æ•°æ®åº“å; <br></code></pre></td></tr></table></figure><p>å¦‚æœMySQLä¸­å·²ç»å­˜åœ¨ç›¸å…³çš„æ•°æ®åº“ï¼Œåˆ™å¿½ç•¥åˆ›å»ºè¯­å¥ï¼Œä¸å†åˆ›å»ºæ•°æ®åº“ã€‚</p><blockquote><p>æ³¨æ„ï¼šDATABASE ä¸èƒ½æ”¹åã€‚ä¸€äº›å¯è§†åŒ–å·¥å…·å¯ä»¥æ”¹åï¼Œå®ƒæ˜¯å»ºæ–°åº“ï¼ŒæŠŠæ‰€æœ‰è¡¨å¤åˆ¶åˆ°æ–°åº“ï¼Œå†åˆ æ—§åº“å®Œæˆçš„ã€‚</p></blockquote><h3 id="2-2-ä½¿ç”¨æ•°æ®åº“"><a href="#2-2-ä½¿ç”¨æ•°æ®åº“" class="headerlink" title="2.2 ä½¿ç”¨æ•°æ®åº“"></a>2.2 ä½¿ç”¨æ•°æ®åº“</h3><ul><li>æŸ¥çœ‹å½“å‰æ‰€æœ‰çš„æ•°æ®åº“</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SHOW DATABASES; #æœ‰ä¸€ä¸ªSï¼Œä»£è¡¨å¤šä¸ªæ•°æ®åº“<br></code></pre></td></tr></table></figure><ul><li>æŸ¥çœ‹å½“å‰æ­£åœ¨ä½¿ç”¨çš„æ•°æ®åº“</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT DATABASE();  #ä½¿ç”¨çš„ä¸€ä¸ª mysql ä¸­çš„å…¨å±€å‡½æ•°<br></code></pre></td></tr></table></figure><ul><li>æŸ¥çœ‹æŒ‡å®šåº“ä¸‹æ‰€æœ‰çš„è¡¨</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SHOW TABLES FROM æ•°æ®åº“å; / SHOW TABLES #é»˜è®¤æŸ¥è¯¢å½“å‰æ•°æ®åº“<br></code></pre></td></tr></table></figure><ul><li>æŸ¥çœ‹æ•°æ®åº“çš„åˆ›å»ºä¿¡æ¯</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SHOW CREATE DATABASE æ•°æ®åº“å;<br>æˆ–è€…ï¼š<br>SHOW CREATE DATABASE æ•°æ®åº“å\G<br></code></pre></td></tr></table></figure><ul><li>ä½¿ç”¨/åˆ‡æ¢æ•°æ®åº“</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">USE æ•°æ®åº“å;<br></code></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼šè¦æ“ä½œè¡¨æ ¼å’Œæ•°æ®ä¹‹å‰å¿…é¡»å…ˆè¯´æ˜æ˜¯å¯¹å“ªä¸ªæ•°æ®åº“è¿›è¡Œæ“ä½œï¼Œå¦åˆ™å°±è¦å¯¹æ‰€æœ‰å¯¹è±¡åŠ ä¸Šâ€œæ•°æ®åº“å.â€ã€‚</p></blockquote><h3 id="2-3-ä¿®æ”¹æ•°æ®åº“"><a href="#2-3-ä¿®æ”¹æ•°æ®åº“" class="headerlink" title="2.3 ä¿®æ”¹æ•°æ®åº“"></a>2.3 ä¿®æ”¹æ•°æ®åº“</h3><ul><li>æ›´æ”¹æ•°æ®åº“å­—ç¬¦é›†</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">ALTER DATABASE æ•°æ®åº“å CHARACTER SET å­—ç¬¦é›†;  #æ¯”å¦‚ï¼šgbkã€utf8ç­‰<br></code></pre></td></tr></table></figure><h3 id="2-4-åˆ é™¤æ•°æ®åº“"><a href="#2-4-åˆ é™¤æ•°æ®åº“" class="headerlink" title="2.4 åˆ é™¤æ•°æ®åº“"></a>2.4 åˆ é™¤æ•°æ®åº“</h3><ul><li>æ–¹å¼1ï¼šåˆ é™¤æŒ‡å®šçš„æ•°æ®åº“</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DROP DATABASE æ•°æ®åº“å;<br></code></pre></td></tr></table></figure><ul><li>æ–¹å¼2ï¼šåˆ é™¤æŒ‡å®šçš„æ•°æ®åº“ï¼ˆ<code>æ¨è</code>ï¼‰</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DROP DATABASE IF EXISTS æ•°æ®åº“å;<br></code></pre></td></tr></table></figure><h2 id="3-åˆ›å»ºè¡¨"><a href="#3-åˆ›å»ºè¡¨" class="headerlink" title="3. åˆ›å»ºè¡¨"></a>3. åˆ›å»ºè¡¨</h2><h3 id="3-1-åˆ›å»ºæ–¹å¼1"><a href="#3-1-åˆ›å»ºæ–¹å¼1" class="headerlink" title="3.1 åˆ›å»ºæ–¹å¼1"></a>3.1 åˆ›å»ºæ–¹å¼1</h3><ul><li><strong>å¿…é¡»å…·å¤‡ï¼š</strong><ul><li>CREATE TABLEæƒé™</li><li>å­˜å‚¨ç©ºé—´</li></ul></li><li><strong>è¯­æ³•æ ¼å¼ï¼š</strong></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE TABLE [IF NOT EXISTS] è¡¨å(<br>å­—æ®µ1, æ•°æ®ç±»å‹ [çº¦æŸæ¡ä»¶] [é»˜è®¤å€¼],<br>å­—æ®µ2, æ•°æ®ç±»å‹ [çº¦æŸæ¡ä»¶] [é»˜è®¤å€¼],<br>å­—æ®µ3, æ•°æ®ç±»å‹ [çº¦æŸæ¡ä»¶] [é»˜è®¤å€¼],<br>â€¦â€¦<br>[è¡¨çº¦æŸæ¡ä»¶]<br>);<br></code></pre></td></tr></table></figure><blockquote><p>åŠ ä¸Šäº†IF NOT EXISTSå…³é”®å­—ï¼Œåˆ™è¡¨ç¤ºï¼šå¦‚æœå½“å‰æ•°æ®åº“ä¸­ä¸å­˜åœ¨è¦åˆ›å»ºçš„æ•°æ®è¡¨ï¼Œåˆ™åˆ›å»ºæ•°æ®è¡¨ï¼›å¦‚æœå½“å‰æ•°æ®åº“ä¸­å·²ç»å­˜åœ¨è¦åˆ›å»ºçš„æ•°æ®è¡¨ï¼Œåˆ™å¿½ç•¥å»ºè¡¨è¯­å¥ï¼Œä¸å†åˆ›å»ºæ•°æ®è¡¨ã€‚</p></blockquote><ul><li><strong>å¿…é¡»æŒ‡å®šï¼š</strong><ul><li>è¡¨å</li><li>åˆ—å(æˆ–å­—æ®µå)ï¼Œæ•°æ®ç±»å‹ï¼Œ<strong>é•¿åº¦</strong></li></ul></li><li><strong>å¯é€‰æŒ‡å®šï¼š</strong><ul><li>çº¦æŸæ¡ä»¶</li><li>é»˜è®¤å€¼</li></ul></li><li>åˆ›å»ºè¡¨ä¸¾ä¾‹1ï¼š</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs mysql">-- åˆ›å»ºè¡¨<br>CREATE TABLE emp (<br>  -- intç±»å‹<br>  emp_id INT,<br>  -- æœ€å¤šä¿å­˜20ä¸ªä¸­è‹±æ–‡å­—ç¬¦<br>  emp_name VARCHAR(20),<br>  -- æ€»ä½æ•°ä¸è¶…è¿‡15ä½<br>  salary DOUBLE,<br>  -- æ—¥æœŸç±»å‹<br>  birthday DATE<br>);<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DESC emp;<br></code></pre></td></tr></table></figure><p> <img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211016160557995.png"></p><p>MySQLåœ¨æ‰§è¡Œå»ºè¡¨è¯­å¥æ—¶ï¼Œå°†idå­—æ®µçš„ç±»å‹è®¾ç½®ä¸ºint(11)ï¼Œè¿™é‡Œçš„11å®é™…ä¸Šæ˜¯intç±»å‹æŒ‡å®šçš„æ˜¾ç¤ºå®½åº¦ï¼Œé»˜è®¤çš„æ˜¾ç¤ºå®½åº¦ä¸º11ã€‚ä¹Ÿå¯ä»¥åœ¨åˆ›å»ºæ•°æ®è¡¨çš„æ—¶å€™æŒ‡å®šæ•°æ®çš„æ˜¾ç¤ºå®½åº¦ã€‚</p><ul><li>åˆ›å»ºè¡¨ä¸¾ä¾‹2ï¼š</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE TABLE dept(<br>    -- intç±»å‹ï¼Œè‡ªå¢<br>deptno INT(2) AUTO_INCREMENT,<br>dname VARCHAR(14),<br>loc VARCHAR(13),<br>    -- ä¸»é”®<br>    PRIMARY KEY (deptno)<br>) CHARACTER SET &#x27;utf8&#x27;;<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DESCRIBE dept;<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211016160643445.png"></p><blockquote><p>åœ¨MySQL 8.xç‰ˆæœ¬ä¸­ï¼Œä¸å†æ¨èä¸ºINTç±»å‹æŒ‡å®šæ˜¾ç¤ºé•¿åº¦ï¼Œå¹¶åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­å¯èƒ½å»æ‰è¿™æ ·çš„è¯­æ³•ã€‚</p></blockquote><h3 id="3-2-åˆ›å»ºæ–¹å¼2"><a href="#3-2-åˆ›å»ºæ–¹å¼2" class="headerlink" title="3.2 åˆ›å»ºæ–¹å¼2"></a>3.2 åˆ›å»ºæ–¹å¼2</h3><ul><li><p>ä½¿ç”¨ AS subquery é€‰é¡¹ï¼Œ<strong>å°†åˆ›å»ºè¡¨å’Œæ’å…¥æ•°æ®ç»“åˆèµ·æ¥</strong></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554997882872.png"></p></li><li><p>æŒ‡å®šçš„åˆ—å’Œå­æŸ¥è¯¢ä¸­çš„åˆ—è¦ä¸€ä¸€å¯¹åº”</p></li><li><p>é€šè¿‡åˆ—åå’Œé»˜è®¤å€¼å®šä¹‰åˆ—</p></li><li><p><strong>ä¸»è¦æ˜¯å¤åˆ¶æ•°æ®ï¼ŒåŸè¡¨ä¸­é™¤äº†éç©ºçº¦æŸï¼Œå…¶ä»–çº¦æŸä¸ä¼šå¤åˆ¶åˆ°æ–°è¡¨ä¸­</strong></p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE TABLE emp1 AS SELECT * FROM employees;<br><br>CREATE TABLE emp2 AS SELECT * FROM employees WHERE 1=2; -- åˆ›å»ºçš„emp2æ˜¯ç©ºè¡¨<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE TABLE dept80<br>AS <br>SELECT  employee_id, last_name, salary*12 ANNSAL, hire_date<br>FROM    employees<br>WHERE   department_id = 80;<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DESCRIBE dept80;<br></code></pre></td></tr></table></figure><p> <img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554997998148.png"></p><p> <img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554998004494.png"></p><h3 id="3-3-æŸ¥çœ‹æ•°æ®è¡¨ç»“æ„"><a href="#3-3-æŸ¥çœ‹æ•°æ®è¡¨ç»“æ„" class="headerlink" title="3.3 æŸ¥çœ‹æ•°æ®è¡¨ç»“æ„"></a>3.3 æŸ¥çœ‹æ•°æ®è¡¨ç»“æ„</h3><p>åœ¨MySQLä¸­åˆ›å»ºå¥½æ•°æ®è¡¨ä¹‹åï¼Œå¯ä»¥æŸ¥çœ‹æ•°æ®è¡¨çš„ç»“æ„ã€‚MySQLæ”¯æŒä½¿ç”¨<code>DESCRIBE/DESC</code>è¯­å¥æŸ¥çœ‹æ•°æ®è¡¨ç»“æ„ï¼Œä¹Ÿæ”¯æŒä½¿ç”¨<code>SHOW CREATE TABLE</code>è¯­å¥æŸ¥çœ‹æ•°æ®è¡¨ç»“æ„ã€‚</p><p>è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SHOW CREATE TABLE è¡¨å\G<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨SHOW CREATE TABLEè¯­å¥ä¸ä»…å¯ä»¥æŸ¥çœ‹è¡¨åˆ›å»ºæ—¶çš„è¯¦ç»†è¯­å¥ï¼Œè¿˜å¯ä»¥æŸ¥çœ‹å­˜å‚¨å¼•æ“å’Œå­—ç¬¦ç¼–ç ã€‚</p><h3 id="3-4-æŸ¥çœ‹æ•°æ®è¡¨å±æ€§"><a href="#3-4-æŸ¥çœ‹æ•°æ®è¡¨å±æ€§" class="headerlink" title="3.4 æŸ¥çœ‹æ•°æ®è¡¨å±æ€§"></a>3.4 æŸ¥çœ‹æ•°æ®è¡¨å±æ€§</h3><p>è¯­æ³•æ ¼å¼å¦‚ä¸‹:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SHOW</span> <span class="hljs-keyword">TABLE</span> STATUS <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;è¡¨å&#x27;</span>;   #ä»¥è¡¨æ ¼å½¢å¼æ˜¾ç¤º<br>æˆ–è€…<br><span class="hljs-keyword">SHOW</span> <span class="hljs-keyword">TABLE</span> STATUS <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;è¡¨å&#x27;</span>\G  #ä»¥è¡Œå½¢å¼æ˜¾ç¤º<br></code></pre></td></tr></table></figure><h3 id="3-5-ä¿®æ”¹è¡¨çš„å­—ç¬¦é›†"><a href="#3-5-ä¿®æ”¹è¡¨çš„å­—ç¬¦é›†" class="headerlink" title="3.5 ä¿®æ”¹è¡¨çš„å­—ç¬¦é›†"></a>3.5 ä¿®æ”¹è¡¨çš„å­—ç¬¦é›†</h3><p>è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> t_emp <span class="hljs-keyword">convert</span> <span class="hljs-keyword">to</span> <span class="hljs-type">character</span> <span class="hljs-keyword">set</span> <span class="hljs-string">&#x27;utf8&#x27;</span>;<br></code></pre></td></tr></table></figure><h2 id="4-ä¿®æ”¹è¡¨"><a href="#4-ä¿®æ”¹è¡¨" class="headerlink" title="4. ä¿®æ”¹è¡¨"></a>4. ä¿®æ”¹è¡¨</h2><p>ä¿®æ”¹è¡¨æŒ‡çš„æ˜¯ä¿®æ”¹æ•°æ®åº“ä¸­å·²ç»å­˜åœ¨çš„æ•°æ®è¡¨çš„ç»“æ„ã€‚</p><p><strong>ä½¿ç”¨ ALTER TABLE è¯­å¥å¯ä»¥å®ç°ï¼š</strong></p><ul><li><p>å‘å·²æœ‰çš„è¡¨ä¸­æ·»åŠ åˆ—</p></li><li><p>ä¿®æ”¹ç°æœ‰è¡¨ä¸­çš„åˆ—</p></li><li><p>åˆ é™¤ç°æœ‰è¡¨ä¸­çš„åˆ—</p></li><li><p>é‡å‘½åç°æœ‰è¡¨ä¸­çš„åˆ—</p></li></ul><h3 id="4-1-è¿½åŠ ä¸€ä¸ªåˆ—"><a href="#4-1-è¿½åŠ ä¸€ä¸ªåˆ—" class="headerlink" title="4.1 è¿½åŠ ä¸€ä¸ªåˆ—"></a>4.1 è¿½åŠ ä¸€ä¸ªåˆ—</h3><p>è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">ALTER TABLE è¡¨å ADD ã€COLUMNã€‘ å­—æ®µå å­—æ®µç±»å‹ ã€FIRST|AFTER å­—æ®µåã€‘; #é»˜è®¤åŠ åœ¨æœ€åä¸€åˆ—ï¼ŒFIRSTåŠ åœ¨ç¬¬ä¸€åˆ—<br></code></pre></td></tr></table></figure><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">ALTER TABLE dept80 <br>ADD job_id varchar(15);<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1554998139815.png"></p><h3 id="4-2-ä¿®æ”¹ä¸€ä¸ªåˆ—"><a href="#4-2-ä¿®æ”¹ä¸€ä¸ªåˆ—" class="headerlink" title="4.2 ä¿®æ”¹ä¸€ä¸ªåˆ—"></a>4.2 ä¿®æ”¹ä¸€ä¸ªåˆ—</h3><ul><li><p>å¯ä»¥ä¿®æ”¹åˆ—çš„æ•°æ®ç±»å‹ï¼Œé•¿åº¦ã€é»˜è®¤å€¼å’Œä½ç½®</p></li><li><p>ä¿®æ”¹å­—æ®µæ•°æ®ç±»å‹ã€é•¿åº¦ã€é»˜è®¤å€¼ã€ä½ç½®çš„è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">ALTER TABLE è¡¨å MODIFY ã€COLUMNã€‘ å­—aæ®µå1 å­—æ®µç±»å‹ ã€DEFAULT é»˜è®¤å€¼ã€‘ã€FIRST|AFTER å­—æ®µå2ã€‘;<br></code></pre></td></tr></table></figure><ul><li>ä¸¾ä¾‹ï¼š</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">ALTER TABLEdept80<br>MODIFY last_name VARCHAR(30);<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">ALTER TABLEdept80<br>MODIFY salary double(9,2) default 1000;<br></code></pre></td></tr></table></figure><ul><li>å¯¹é»˜è®¤å€¼çš„ä¿®æ”¹åªå½±å“ä»Šåå¯¹è¡¨çš„ä¿®æ”¹</li><li>æ­¤å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡æ­¤ç§æ–¹å¼ä¿®æ”¹åˆ—çš„çº¦æŸã€‚è¿™é‡Œæš‚å…ˆä¸è®²ã€‚</li></ul><h3 id="4-3-é‡å‘½åä¸€ä¸ªåˆ—"><a href="#4-3-é‡å‘½åä¸€ä¸ªåˆ—" class="headerlink" title="4.3 é‡å‘½åä¸€ä¸ªåˆ—"></a>4.3 é‡å‘½åä¸€ä¸ªåˆ—</h3><p>ä½¿ç”¨ CHANGE old_column  new_column  dataTypeå­å¥é‡å‘½ååˆ—ã€‚è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">ALTER TABLE è¡¨å CHANGE ã€columnã€‘ åˆ—å æ–°åˆ—å æ–°æ•°æ®ç±»å‹; #å¯ä»¥å†æ”¹åçš„åŒæ—¶ä¿®æ”¹åˆ—çš„æ•°æ®ç±»å‹<br></code></pre></td></tr></table></figure><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">ALTER TABLE  dept80<br>CHANGE department_name dept_name varchar(15); <br></code></pre></td></tr></table></figure><h3 id="4-4-åˆ é™¤ä¸€ä¸ªåˆ—"><a href="#4-4-åˆ é™¤ä¸€ä¸ªåˆ—" class="headerlink" title="4.4 åˆ é™¤ä¸€ä¸ªåˆ—"></a>4.4 åˆ é™¤ä¸€ä¸ªåˆ—</h3><p>åˆ é™¤è¡¨ä¸­æŸä¸ªå­—æ®µçš„è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">ALTER TABLE è¡¨å DROP ã€COLUMNã€‘å­—æ®µå<br></code></pre></td></tr></table></figure><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">ALTER TABLE  dept80<br>DROP COLUMN  jfrob_id; <br></code></pre></td></tr></table></figure><h2 id="5-é‡å‘½åè¡¨"><a href="#5-é‡å‘½åè¡¨" class="headerlink" title="5. é‡å‘½åè¡¨"></a>5. é‡å‘½åè¡¨</h2><ul><li>æ–¹å¼ä¸€ï¼šæ¨èä½¿ç”¨RENAME</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">RENAME TABLE emp<br>TO myemp;<br></code></pre></td></tr></table></figure><ul><li>æ–¹å¼äºŒï¼š</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">ALTER table dept<br>RENAME [TO] detail_dept;  -- [TO]å¯ä»¥çœç•¥<br></code></pre></td></tr></table></figure><ul><li>å¿…é¡»æ˜¯å¯¹è±¡çš„æ‹¥æœ‰è€…</li></ul><h2 id="6-åˆ é™¤è¡¨"><a href="#6-åˆ é™¤è¡¨" class="headerlink" title="6. åˆ é™¤è¡¨"></a>6. åˆ é™¤è¡¨</h2><ul><li><p>åœ¨MySQLä¸­ï¼Œå½“ä¸€å¼ æ•°æ®è¡¨<code>æ²¡æœ‰ä¸å…¶ä»–ä»»ä½•æ•°æ®è¡¨å½¢æˆå…³è”å…³ç³»</code>æ—¶ï¼Œå¯ä»¥å°†å½“å‰æ•°æ®è¡¨ç›´æ¥åˆ é™¤ã€‚</p></li><li><p>æ•°æ®å’Œç»“æ„éƒ½è¢«åˆ é™¤</p></li><li><p>æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„ç›¸å…³äº‹åŠ¡è¢«æäº¤</p></li><li><p>æ‰€æœ‰ç›¸å…³ç´¢å¼•è¢«åˆ é™¤</p></li><li><p>è¯­æ³•æ ¼å¼ï¼š</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DROP TABLE [IF EXISTS] æ•°æ®è¡¨1 [, æ•°æ®è¡¨2, â€¦, æ•°æ®è¡¨n];<br></code></pre></td></tr></table></figure><p><code>IF EXISTS</code>çš„å«ä¹‰ä¸ºï¼šå¦‚æœå½“å‰æ•°æ®åº“ä¸­å­˜åœ¨ç›¸åº”çš„æ•°æ®è¡¨ï¼Œåˆ™åˆ é™¤æ•°æ®è¡¨ï¼›å¦‚æœå½“å‰æ•°æ®åº“ä¸­ä¸å­˜åœ¨ç›¸åº”çš„æ•°æ®è¡¨ï¼Œåˆ™å¿½ç•¥åˆ é™¤è¯­å¥ï¼Œä¸å†æ‰§è¡Œåˆ é™¤æ•°æ®è¡¨çš„æ“ä½œã€‚</p><ul><li>ä¸¾ä¾‹ï¼š</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DROP TABLE dept80;<br></code></pre></td></tr></table></figure><ul><li>DROP TABLE è¯­å¥ä¸èƒ½å›æ»š</li></ul><h2 id="7-æ¸…ç©ºè¡¨"><a href="#7-æ¸…ç©ºè¡¨" class="headerlink" title="7. æ¸…ç©ºè¡¨"></a>7. æ¸…ç©ºè¡¨</h2><ul><li><p>TRUNCATE TABLEè¯­å¥ï¼š</p><ul><li>åˆ é™¤è¡¨ä¸­æ‰€æœ‰çš„æ•°æ®</li><li>é‡Šæ”¾è¡¨çš„å­˜å‚¨ç©ºé—´</li></ul></li><li><p>ä¸¾ä¾‹ï¼š</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">TRUNCATE TABLE detail_dept;<br></code></pre></td></tr></table></figure><ul><li>TRUNCATEè¯­å¥<strong>ä¸èƒ½å›æ»š</strong>ï¼Œè€Œä½¿ç”¨ DELETE è¯­å¥åˆ é™¤æ•°æ®ï¼Œå¯ä»¥å›æ»šï¼ˆåœ¨ä¿®æ”¹autocommit = FALSEæ“ä½œçš„æƒ…å†µä¸‹ï¼‰</li><li>COMMITï¼šæäº¤æ•°æ®ã€‚ä¸€æ—¦æ‰§è¡ŒCOMMITï¼Œåˆ™è¯¥æ•°æ®å°±è¢«æ°¸ä¹…çš„ä¿å­˜åœ¨äº†æ•°æ®åº“ä¸­ï¼Œæ„å‘³ç€è¯¥æ•°æ®ä¸å¯ä»¥è¢«å›æ»šï¼ˆä¸èƒ½è¦†ç›–è¯¥æ•°æ®ï¼‰ã€‚</li><li>ROLLBACKï¼šä¸€æ—¦æ‰§è¡ŒROLLBACKï¼Œåˆ™å¯ä»¥å®ç°æ•°æ®çš„å›æ»šï¼ˆä½†ä¸ä¸€å®šæˆåŠŸï¼‰ã€‚å›æ»šåˆ°æœ€è¿‘ä¸€æ¬¡çš„COMMITä¹‹åã€‚</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SET autocommit = FALSE;<br>  <br>DELETE FROM emp2; <br>#TRUNCATE TABLE emp2; #æ•°æ®è¢«åˆ é™¤ï¼Œä¸”ä¸èƒ½å›æ»š<br>  <br>SELECT * FROM emp2; #æ•°æ®è¢«åˆ é™¤<br>  <br>ROLLBACK;<br>  <br>SELECT * FROM emp2; #æ•°æ®ä»ç„¶å­˜åœ¨<br></code></pre></td></tr></table></figure><blockquote><p>é˜¿é‡Œå¼€å‘è§„èŒƒï¼š</p><p>ã€å‚è€ƒã€‘TRUNCATE TABLE æ¯” DELETE é€Ÿåº¦å¿«ï¼Œä¸”ä½¿ç”¨çš„ç³»ç»Ÿå’Œäº‹åŠ¡æ—¥å¿—èµ„æºå°‘ï¼Œä½† TRUNCATE æ— äº‹åŠ¡ä¸”ä¸è§¦å‘ TRIGGERï¼ˆè§¦å‘å™¨ï¼‰ï¼Œæœ‰å¯èƒ½é€ æˆäº‹æ•…ï¼Œæ•…ä¸å»ºè®®åœ¨å¼€å‘ä»£ç ä¸­ä½¿ç”¨æ­¤è¯­å¥ã€‚ </p><p>è¯´æ˜ï¼šTRUNCATE TABLE åœ¨åŠŸèƒ½ä¸Šä¸ä¸å¸¦ WHERE å­å¥çš„ DELETE è¯­å¥ç›¸åŒã€‚</p></blockquote><p><strong>DDL å’Œ DML çš„è¯´æ˜</strong></p><p>â‘  DDLçš„æ“ä½œä¸€æ—¦æ‰§è¡Œï¼Œå°±ä¸å¯ä»¥å›æ»šã€‚æŒ‡ä»¤SET autocommit = FALSEå¯¹DDLæ“ä½œå¤±æ•ˆã€‚ï¼ˆå› ä¸ºåœ¨æ‰§è¡Œå®ŒDDLæ“ä½œä¹‹åï¼Œä¸€å®šä¼šæ‰§è¡Œä¸€æ¬¡COMMITã€‚è€Œæ­¤COMMITæ“ä½œä¸å—SET autocommit = FALSEçš„å½±å“ã€‚</p><p>â‘¡ DMLçš„æ“ä½œé»˜è®¤æƒ…å†µä¸‹ï¼Œä¸€æ—¦æ‰§è¡Œï¼Œä¹Ÿæ˜¯ä¸å¯ä»¥å›æ»šçš„ã€‚ä½†æ˜¯ï¼Œå¦‚æœåœ¨æ‰§è¡ŒDMLä¹‹å‰ï¼Œæ‰§è¡Œäº†SET autocommit = FASLEï¼Œ åˆ™æ‰§è¡Œçš„DMLæ“ä½œå°±å¯ä»¥å®ç°å›æ»šã€‚</p><h2 id="8-å†…å®¹æ‹“å±•"><a href="#8-å†…å®¹æ‹“å±•" class="headerlink" title="8. å†…å®¹æ‹“å±•"></a>8. å†…å®¹æ‹“å±•</h2><h3 id="æ‹“å±•1ï¼šé˜¿é‡Œå·´å·´ã€ŠJavaå¼€å‘æ‰‹å†Œã€‹ä¹‹MySQLå­—æ®µå‘½å"><a href="#æ‹“å±•1ï¼šé˜¿é‡Œå·´å·´ã€ŠJavaå¼€å‘æ‰‹å†Œã€‹ä¹‹MySQLå­—æ®µå‘½å" class="headerlink" title="æ‹“å±•1ï¼šé˜¿é‡Œå·´å·´ã€ŠJavaå¼€å‘æ‰‹å†Œã€‹ä¹‹MySQLå­—æ®µå‘½å"></a>æ‹“å±•1ï¼šé˜¿é‡Œå·´å·´ã€ŠJavaå¼€å‘æ‰‹å†Œã€‹ä¹‹MySQLå­—æ®µå‘½å</h3><ul><li><p>ã€<code>å¼ºåˆ¶</code>ã€‘è¡¨åã€å­—æ®µåå¿…é¡»ä½¿ç”¨å°å†™å­—æ¯æˆ–æ•°å­—ï¼Œç¦æ­¢å‡ºç°æ•°å­—å¼€å¤´ï¼Œç¦æ­¢ä¸¤ä¸ªä¸‹åˆ’çº¿ä¸­é—´åªå‡ºç°æ•°å­—ã€‚æ•°æ®åº“å­—æ®µåçš„ä¿®æ”¹ä»£ä»·å¾ˆå¤§ï¼Œå› ä¸ºæ— æ³•è¿›è¡Œé¢„å‘å¸ƒï¼Œæ‰€ä»¥å­—æ®µåç§°éœ€è¦æ…é‡è€ƒè™‘ã€‚</p><ul><li>æ­£ä¾‹ï¼šaliyun_adminï¼Œrdc_configï¼Œlevel3_name </li><li>åä¾‹ï¼šAliyunAdminï¼ŒrdcConfigï¼Œlevel_3_name</li></ul></li><li><p>ã€<code>å¼ºåˆ¶</code>ã€‘ç¦ç”¨ä¿ç•™å­—ï¼Œå¦‚ descã€rangeã€matchã€delayed ç­‰ï¼Œè¯·å‚è€ƒ MySQL å®˜æ–¹ä¿ç•™å­—ã€‚</p></li><li><p>ã€<code>å¼ºåˆ¶</code>ã€‘è¡¨å¿…å¤‡ä¸‰å­—æ®µï¼šid, gmt_create, gmt_modifiedã€‚ </p><ul><li>è¯´æ˜ï¼šå…¶ä¸­ id å¿…ä¸ºä¸»é”®ï¼Œç±»å‹ä¸ºBIGINT UNSIGNEDã€å•è¡¨æ—¶è‡ªå¢ã€æ­¥é•¿ä¸º 1ã€‚gmt_create, gmt_modified çš„ç±»å‹å‡ä¸º DATETIME ç±»å‹ï¼Œå‰è€…ç°åœ¨æ—¶è¡¨ç¤ºä¸»åŠ¨å¼åˆ›å»ºï¼Œåè€…è¿‡å»åˆ†è¯è¡¨ç¤ºè¢«åŠ¨å¼æ›´æ–°</li></ul></li><li><p>ã€<code>æ¨è</code>ã€‘è¡¨çš„å‘½åæœ€å¥½æ˜¯éµå¾ª â€œä¸šåŠ¡åç§°_è¡¨çš„ä½œç”¨â€ã€‚ </p><ul><li>æ­£ä¾‹ï¼šalipay_task ã€ force_projectã€ trade_config</li></ul></li><li><p>ã€<code>æ¨è</code>ã€‘åº“åä¸åº”ç”¨åç§°å°½é‡ä¸€è‡´ã€‚</p></li><li><p>ã€å‚è€ƒã€‘åˆé€‚çš„å­—ç¬¦å­˜å‚¨é•¿åº¦ï¼Œä¸ä½†èŠ‚çº¦æ•°æ®åº“è¡¨ç©ºé—´ã€èŠ‚çº¦ç´¢å¼•å­˜å‚¨ï¼Œæ›´é‡è¦çš„æ˜¯æå‡æ£€ç´¢é€Ÿåº¦ã€‚ </p><ul><li>æ­£ä¾‹ï¼šæ— ç¬¦å·å€¼å¯ä»¥é¿å…è¯¯å­˜è´Ÿæ•°ï¼Œä¸”æ‰©å¤§äº†è¡¨ç¤ºèŒƒå›´ã€‚</li></ul><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211024012735469.png"></p></li></ul><h3 id="æ‹“å±•2ï¼šå¦‚ä½•ç†è§£æ¸…ç©ºè¡¨ã€åˆ é™¤è¡¨ç­‰æ“ä½œéœ€è°¨æ…ï¼Ÿï¼"><a href="#æ‹“å±•2ï¼šå¦‚ä½•ç†è§£æ¸…ç©ºè¡¨ã€åˆ é™¤è¡¨ç­‰æ“ä½œéœ€è°¨æ…ï¼Ÿï¼" class="headerlink" title="æ‹“å±•2ï¼šå¦‚ä½•ç†è§£æ¸…ç©ºè¡¨ã€åˆ é™¤è¡¨ç­‰æ“ä½œéœ€è°¨æ…ï¼Ÿï¼"></a>æ‹“å±•2ï¼šå¦‚ä½•ç†è§£æ¸…ç©ºè¡¨ã€åˆ é™¤è¡¨ç­‰æ“ä½œéœ€è°¨æ…ï¼Ÿï¼</h3><p><code>è¡¨åˆ é™¤</code>æ“ä½œå°†æŠŠè¡¨çš„å®šä¹‰å’Œè¡¨ä¸­çš„æ•°æ®ä¸€èµ·åˆ é™¤ï¼Œå¹¶ä¸”MySQLåœ¨æ‰§è¡Œåˆ é™¤æ“ä½œæ—¶ï¼Œä¸ä¼šæœ‰ä»»ä½•çš„ç¡®è®¤ä¿¡æ¯æç¤ºï¼Œå› æ­¤æ‰§è¡Œåˆ é™¤æ“æ—¶åº”å½“æ…é‡ã€‚åœ¨åˆ é™¤è¡¨å‰ï¼Œæœ€å¥½å¯¹è¡¨ä¸­çš„æ•°æ®è¿›è¡Œ<code>å¤‡ä»½</code>ï¼Œè¿™æ ·å½“æ“ä½œå¤±è¯¯æ—¶å¯ä»¥å¯¹æ•°æ®è¿›è¡Œæ¢å¤ï¼Œä»¥å…é€ æˆæ— æ³•æŒ½å›çš„åæœã€‚</p><p>åŒæ ·çš„ï¼Œåœ¨ä½¿ç”¨ <code>ALTER TABLE</code> è¿›è¡Œè¡¨çš„åŸºæœ¬ä¿®æ”¹æ“ä½œæ—¶ï¼Œåœ¨æ‰§è¡Œæ“ä½œè¿‡ç¨‹ä¹‹å‰ï¼Œä¹Ÿåº”è¯¥ç¡®ä¿å¯¹æ•°æ®è¿›è¡Œå®Œæ•´çš„<code>å¤‡ä»½</code>ï¼Œå› ä¸ºæ•°æ®åº“çš„æ”¹å˜æ˜¯<code>æ— æ³•æ’¤é”€</code>çš„ï¼Œå¦‚æœæ·»åŠ äº†ä¸€ä¸ªä¸éœ€è¦çš„å­—æ®µï¼Œå¯ä»¥å°†å…¶åˆ é™¤ï¼›ç›¸åŒçš„ï¼Œå¦‚æœåˆ é™¤äº†ä¸€ä¸ªéœ€è¦çš„åˆ—ï¼Œè¯¥åˆ—ä¸‹é¢çš„æ‰€æœ‰æ•°æ®éƒ½å°†ä¼šä¸¢å¤±ã€‚</p><h3 id="æ‹“å±•3ï¼šMySQL8æ–°ç‰¹æ€§â€”DDLçš„åŸå­åŒ–"><a href="#æ‹“å±•3ï¼šMySQL8æ–°ç‰¹æ€§â€”DDLçš„åŸå­åŒ–" class="headerlink" title="æ‹“å±•3ï¼šMySQL8æ–°ç‰¹æ€§â€”DDLçš„åŸå­åŒ–"></a>æ‹“å±•3ï¼šMySQL8æ–°ç‰¹æ€§â€”DDLçš„åŸå­åŒ–</h3><p>åœ¨MySQL 8.0ç‰ˆæœ¬ä¸­ï¼ŒInnoDBè¡¨çš„DDLæ”¯æŒäº‹åŠ¡å®Œæ•´æ€§ï¼Œå³<code>DDLæ“ä½œè¦ä¹ˆæˆåŠŸè¦ä¹ˆå›æ»š</code>ã€‚DDLæ“ä½œå›æ»šæ—¥å¿—å†™å…¥åˆ°data dictionaryæ•°æ®å­—å…¸è¡¨mysql.innodb_ddl_logï¼ˆè¯¥è¡¨æ˜¯éšè—çš„è¡¨ï¼Œé€šè¿‡show tablesæ— æ³•çœ‹åˆ°ï¼‰ä¸­ï¼Œç”¨äºå›æ»šæ“ä½œã€‚é€šè¿‡è®¾ç½®å‚æ•°ï¼Œå¯å°†DDLæ“ä½œæ—¥å¿—æ‰“å°è¾“å‡ºåˆ°MySQLé”™è¯¯æ—¥å¿—ä¸­ã€‚</p><p>åˆ†åˆ«åœ¨MySQL 5.7ç‰ˆæœ¬å’ŒMySQL 8.0ç‰ˆæœ¬ä¸­åˆ›å»ºæ•°æ®åº“å’Œæ•°æ®è¡¨ï¼Œç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE DATABASE mytest;<br><br>USE mytest;<br><br>CREATE TABLE book1(<br>book_id INT ,<br>book_name VARCHAR(255)<br>);<br><br>SHOW TABLES;<br></code></pre></td></tr></table></figure><p>ï¼ˆ1ï¼‰åœ¨MySQL 5.7ç‰ˆæœ¬ä¸­ï¼Œæµ‹è¯•æ­¥éª¤å¦‚ä¸‹ï¼š<br>åˆ é™¤æ•°æ®è¡¨book1å’Œæ•°æ®è¡¨book2ï¼Œç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; DROP TABLE book1,book2;<br>ERROR 1051 (42S02): Unknown table &#x27;mytest.book2&#x27;<br></code></pre></td></tr></table></figure><p>å†æ¬¡æŸ¥è¯¢æ•°æ®åº“ä¸­çš„æ•°æ®è¡¨åç§°ï¼Œç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SHOW TABLES;<br>Empty set (0.00 sec)<br></code></pre></td></tr></table></figure><p>ä»ç»“æœå¯ä»¥çœ‹å‡ºï¼Œè™½ç„¶åˆ é™¤æ“ä½œæ—¶æŠ¥é”™äº†ï¼Œä½†æ˜¯ä»ç„¶åˆ é™¤äº†æ•°æ®è¡¨book1ã€‚</p><p>ï¼ˆ2ï¼‰åœ¨MySQL 8.0ç‰ˆæœ¬ä¸­ï¼Œæµ‹è¯•æ­¥éª¤å¦‚ä¸‹ï¼š<br>åˆ é™¤æ•°æ®è¡¨book1å’Œæ•°æ®è¡¨book2ï¼Œç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; DROP TABLE book1,book2;<br>ERROR 1051 (42S02): Unknown table &#x27;mytest.book2&#x27;<br></code></pre></td></tr></table></figure><p>å†æ¬¡æŸ¥è¯¢æ•°æ®åº“ä¸­çš„æ•°æ®è¡¨åç§°ï¼Œç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; show tables;<br>+------------------+<br>| Tables_in_mytest |<br>+------------------+<br>| book1            |<br>+------------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>ä»ç»“æœå¯ä»¥çœ‹å‡ºï¼Œæ•°æ®è¡¨book1å¹¶æ²¡æœ‰è¢«åˆ é™¤ã€‚</p><h1 id="ç¬¬11ç« -æ•°æ®å¤„ç†ä¹‹å¢åˆ æ”¹"><a href="#ç¬¬11ç« -æ•°æ®å¤„ç†ä¹‹å¢åˆ æ”¹" class="headerlink" title="ç¬¬11ç« _æ•°æ®å¤„ç†ä¹‹å¢åˆ æ”¹"></a>ç¬¬11ç« _æ•°æ®å¤„ç†ä¹‹å¢åˆ æ”¹</h1><h2 id="1-æ’å…¥æ•°æ®"><a href="#1-æ’å…¥æ•°æ®" class="headerlink" title="1. æ’å…¥æ•°æ®"></a>1. æ’å…¥æ•°æ®</h2><h3 id="1-1-å®é™…é—®é¢˜-1"><a href="#1-1-å®é™…é—®é¢˜-1" class="headerlink" title="1.1 å®é™…é—®é¢˜"></a>1.1 å®é™…é—®é¢˜</h3><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1555425366064.png" alt="" style="zoom:80%;" /><p>è§£å†³æ–¹å¼ï¼šä½¿ç”¨ INSERT è¯­å¥å‘è¡¨ä¸­æ’å…¥æ•°æ®ã€‚</p><h3 id="1-2-æ–¹å¼1ï¼šVALUESçš„æ–¹å¼æ·»åŠ "><a href="#1-2-æ–¹å¼1ï¼šVALUESçš„æ–¹å¼æ·»åŠ " class="headerlink" title="1.2 æ–¹å¼1ï¼šVALUESçš„æ–¹å¼æ·»åŠ "></a>1.2 æ–¹å¼1ï¼šVALUESçš„æ–¹å¼æ·»åŠ </h3><p>ä½¿ç”¨è¿™ç§è¯­æ³•ä¸€æ¬¡åªèƒ½å‘è¡¨ä¸­æ’å…¥<strong>ä¸€æ¡</strong>æ•°æ®ã€‚</p><p><strong>æƒ…å†µ1ï¼šä¸ºè¡¨çš„æ‰€æœ‰å­—æ®µæŒ‰é»˜è®¤é¡ºåºæ’å…¥æ•°æ®</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> è¡¨å<br><span class="hljs-keyword">VALUES</span> (value1,value2,....);<br></code></pre></td></tr></table></figure><p>å€¼åˆ—è¡¨ä¸­éœ€è¦ä¸ºè¡¨çš„æ¯ä¸€ä¸ªå­—æ®µæŒ‡å®šå€¼ï¼Œå¹¶ä¸”å€¼çš„é¡ºåºå¿…é¡»å’Œæ•°æ®è¡¨ä¸­å­—æ®µå®šä¹‰æ—¶çš„é¡ºåºç›¸åŒã€‚</p><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">INSERT INTO departments<br>VALUES (70, &#x27;Pub&#x27;, 100, 1700);<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">INSERT INTOdepartments<br>VALUES(100, &#x27;Finance&#x27;, NULL, NULL);<br></code></pre></td></tr></table></figure><p><strong>æƒ…å†µ2ï¼šä¸ºè¡¨çš„æŒ‡å®šå­—æ®µæ’å…¥æ•°æ®</strong>ï¼ˆæ¨èï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">INSERT INTO è¡¨å(column1 [, column2, â€¦, columnn]) <br>VALUES (value1 [,value2, â€¦, valuen]);<br></code></pre></td></tr></table></figure><p>ä¸ºè¡¨çš„æŒ‡å®šå­—æ®µæ’å…¥æ•°æ®ï¼Œå°±æ˜¯åœ¨INSERTè¯­å¥ä¸­åªå‘éƒ¨åˆ†å­—æ®µä¸­æ’å…¥å€¼ï¼Œè€Œå…¶ä»–å­—æ®µçš„å€¼ä¸ºè¡¨å®šä¹‰æ—¶çš„é»˜è®¤å€¼ã€‚</p><p>åœ¨ INSERT å­å¥ä¸­éšæ„åˆ—å‡ºåˆ—åï¼Œä½†æ˜¯ä¸€æ—¦åˆ—å‡ºï¼ŒVALUESä¸­è¦æ’å…¥çš„value1,â€¦.valuenéœ€è¦ä¸column1,â€¦columnnåˆ—ä¸€ä¸€å¯¹åº”ã€‚å¦‚æœç±»å‹ä¸åŒï¼Œå°†æ— æ³•æ’å…¥ï¼Œå¹¶ä¸”MySQLä¼šäº§ç”Ÿé”™è¯¯ã€‚</p><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">INSERT INTO departments(department_id, department_name)<br>VALUES (80, &#x27;IT&#x27;);<br></code></pre></td></tr></table></figure><p> <strong>æƒ…å†µ3ï¼šåŒæ—¶æ’å…¥å¤šæ¡è®°å½•</strong></p><p>INSERTè¯­å¥å¯ä»¥åŒæ—¶å‘æ•°æ®è¡¨ä¸­æ’å…¥å¤šæ¡è®°å½•ï¼Œæ’å…¥æ—¶æŒ‡å®šå¤šä¸ªå€¼åˆ—è¡¨ï¼Œæ¯ä¸ªå€¼åˆ—è¡¨ä¹‹é—´ç”¨é€—å·åˆ†éš”å¼€ï¼ŒåŸºæœ¬è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs mysql">INSERT INTO table_name <br>VALUES <br>(value1 [,value2, â€¦, valuen]),<br>(value1 [,value2, â€¦, valuen]),<br>â€¦â€¦<br>(value1 [,value2, â€¦, valuen]);<br></code></pre></td></tr></table></figure><p>æˆ–è€…</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs mysql">INSERT INTO table_name(column1 [, column2, â€¦, columnn]) <br>VALUES <br>(value1 [,value2, â€¦, valuen]),<br>(value1 [,value2, â€¦, valuen]),<br>â€¦â€¦<br>(value1 [,value2, â€¦, valuen]);<br></code></pre></td></tr></table></figure><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; INSERT INTO emp(emp_id,emp_name)<br>    -&gt; VALUES (1001,&#x27;shkstart&#x27;),<br>    -&gt; (1002,&#x27;atguigu&#x27;),<br>    -&gt; (1003,&#x27;Tom&#x27;);<br>Query OK, 3 rows affected (0.00 sec)<br>Records: 3  Duplicates: 0  Warnings: 0<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨INSERTåŒæ—¶æ’å…¥å¤šæ¡è®°å½•æ—¶ï¼ŒMySQLä¼šè¿”å›ä¸€äº›åœ¨æ‰§è¡Œå•è¡Œæ’å…¥æ—¶æ²¡æœ‰çš„é¢å¤–ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯çš„å«ä¹‰å¦‚ä¸‹ï¼š<br>â—ã€€Recordsï¼šè¡¨æ˜æ’å…¥çš„è®°å½•æ¡æ•°ã€‚<br>â—ã€€Duplicatesï¼šè¡¨æ˜æ’å…¥æ—¶è¢«å¿½ç•¥çš„è®°å½•ï¼ŒåŸå› å¯èƒ½æ˜¯è¿™äº›è®°å½•åŒ…å«äº†é‡å¤çš„ä¸»é”®å€¼ã€‚<br>â—ã€€Warningsï¼šè¡¨æ˜æœ‰é—®é¢˜çš„æ•°æ®å€¼ï¼Œä¾‹å¦‚å‘ç”Ÿæ•°æ®ç±»å‹è½¬æ¢ã€‚</p><blockquote><p>ä¸€ä¸ªåŒæ—¶æ’å…¥å¤šè¡Œè®°å½•çš„INSERTè¯­å¥ç­‰åŒäºå¤šä¸ªå•è¡Œæ’å…¥çš„INSERTè¯­å¥ï¼Œä½†æ˜¯å¤šè¡Œçš„INSERTè¯­å¥åœ¨å¤„ç†è¿‡ç¨‹ä¸­<code>æ•ˆç‡æ›´é«˜</code>ã€‚å› ä¸ºMySQLæ‰§è¡Œå•æ¡INSERTè¯­å¥æ’å…¥å¤šè¡Œæ•°æ®æ¯”ä½¿ç”¨å¤šæ¡INSERTè¯­å¥å¿«ï¼Œæ‰€ä»¥åœ¨æ’å…¥å¤šæ¡è®°å½•æ—¶æœ€å¥½é€‰æ‹©ä½¿ç”¨å•æ¡INSERTè¯­å¥çš„æ–¹å¼æ’å…¥ã€‚</p></blockquote><p><strong>å°ç»“ï¼š</strong></p><ul><li><code>VALUES</code>ä¹Ÿå¯ä»¥å†™æˆ<code>VALUE</code>ï¼Œä½†æ˜¯VALUESæ˜¯æ ‡å‡†å†™æ³•ã€‚</li></ul><ul><li>å­—ç¬¦å’Œæ—¥æœŸå‹æ•°æ®åº”åŒ…å«åœ¨å•å¼•å·ä¸­ã€‚</li></ul><h3 id="1-3-æ–¹å¼2ï¼šå°†æŸ¥è¯¢ç»“æœæ’å…¥åˆ°è¡¨ä¸­"><a href="#1-3-æ–¹å¼2ï¼šå°†æŸ¥è¯¢ç»“æœæ’å…¥åˆ°è¡¨ä¸­" class="headerlink" title="1.3 æ–¹å¼2ï¼šå°†æŸ¥è¯¢ç»“æœæ’å…¥åˆ°è¡¨ä¸­"></a>1.3 æ–¹å¼2ï¼šå°†æŸ¥è¯¢ç»“æœæ’å…¥åˆ°è¡¨ä¸­</h3><p>INSERTè¿˜å¯ä»¥å°†SELECTè¯­å¥æŸ¥è¯¢çš„ç»“æœæ’å…¥åˆ°è¡¨ä¸­ï¼Œæ­¤æ—¶ä¸éœ€è¦æŠŠæ¯ä¸€æ¡è®°å½•çš„å€¼ä¸€ä¸ªä¸€ä¸ªè¾“å…¥ï¼Œåªéœ€è¦ä½¿ç”¨ä¸€æ¡INSERTè¯­å¥å’Œä¸€æ¡SELECTè¯­å¥ç»„æˆçš„ç»„åˆè¯­å¥å³å¯å¿«é€Ÿåœ°ä»ä¸€ä¸ªæˆ–å¤šä¸ªè¡¨ä¸­å‘ä¸€ä¸ªè¡¨ä¸­æ’å…¥å¤šè¡Œã€‚</p><p>åŸºæœ¬è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs mysql">INSERT INTO ç›®æ ‡è¡¨å<br>(tar_column1 [, tar_column2, â€¦, tar_columnn])<br>SELECT<br>(src_column1 [, src_column2, â€¦, src_columnn])<br>FROM æºè¡¨å<br>[WHERE condition]<br></code></pre></td></tr></table></figure><ul><li>åœ¨ INSERT è¯­å¥ä¸­åŠ å…¥å­æŸ¥è¯¢ã€‚ </li><li><strong>ä¸å¿…ä¹¦å†™</strong> <strong>VALUES</strong> <strong>å­å¥ã€‚</strong> </li><li>å­æŸ¥è¯¢ä¸­çš„å€¼åˆ—è¡¨åº”ä¸ INSERT å­å¥ä¸­çš„åˆ—åå¯¹åº”ã€‚</li></ul><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> emp2 <br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <br><span class="hljs-keyword">FROM</span> employees<br><span class="hljs-keyword">WHERE</span> department_id <span class="hljs-operator">=</span> <span class="hljs-number">90</span>;<br></code></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> sales_reps(id, name, salary, commission_pct)<br><span class="hljs-keyword">SELECT</span> employee_id, last_name, salary, commission_pct<br><span class="hljs-keyword">FROM</span>   employees<br><span class="hljs-keyword">WHERE</span>  job_id <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;%REP%&#x27;</span>;<br></code></pre></td></tr></table></figure><p><strong>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç›®æ ‡è¡¨ä¸­è¦æ·»åŠ æ•°æ®çš„å­—æ®µçš„é•¿åº¦ä¸èƒ½ä½äºæ¥æºè¡¨ä¸­æŸ¥è¯¢çš„å­—æ®µçš„é•¿åº¦ã€‚å¦‚æœç›®æ ‡è¡¨ä¸­è¦æ·»åŠ æ•°æ®çš„å­—æ®µçš„é•¿åº¦ä½äºæ¥æºè¡¨ä¸­æŸ¥è¯¢çš„å­—æ®µçš„é•¿åº¦çš„è¯ï¼Œå°±ä¼šæœ‰æ·»åŠ ä¸æˆåŠŸçš„é£é™©ã€‚</strong></p><h2 id="2-æ›´æ–°æ•°æ®"><a href="#2-æ›´æ–°æ•°æ®" class="headerlink" title="2. æ›´æ–°æ•°æ®"></a>2. æ›´æ–°æ•°æ®</h2><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1555425824246.png"></p><ul><li>ä½¿ç”¨ UPDATE è¯­å¥æ›´æ–°æ•°æ®ã€‚è¯­æ³•å¦‚ä¸‹ï¼š</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">UPDATE table_name<br><span class="hljs-keyword">SET</span> column1<span class="hljs-operator">=</span>value1, column2<span class="hljs-operator">=</span>value2, â€¦ , <span class="hljs-keyword">column</span><span class="hljs-operator">=</span>valuen<br>[<span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">condition</span>]<br></code></pre></td></tr></table></figure><ul><li><p>å¯ä»¥ä¸€æ¬¡æ›´æ–°<strong>å¤šæ¡</strong>æ•°æ®ã€‚</p></li><li><p>å¦‚æœéœ€è¦å›æ»šæ•°æ®ï¼Œéœ€è¦ä¿è¯åœ¨DMLå‰ï¼Œè¿›è¡Œè®¾ç½®ï¼š<strong>SET AUTOCOMMIT = FALSE;</strong></p></li></ul><hr><ul><li>ä½¿ç”¨ <strong>WHERE</strong> å­å¥æŒ‡å®šéœ€è¦æ›´æ–°çš„æ•°æ®ã€‚</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">UPDATE employees<br><span class="hljs-keyword">SET</span>    department_id <span class="hljs-operator">=</span> <span class="hljs-number">70</span><br><span class="hljs-keyword">WHERE</span>  employee_id <span class="hljs-operator">=</span> <span class="hljs-number">113</span>;<br></code></pre></td></tr></table></figure><ul><li>å¦‚æœçœç•¥ WHERE å­å¥ï¼Œåˆ™è¡¨ä¸­çš„æ‰€æœ‰æ•°æ®éƒ½å°†è¢«æ›´æ–°ã€‚</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql">UPDATE copy_emp<br><span class="hljs-keyword">SET</span>    department_id <span class="hljs-operator">=</span> <span class="hljs-number">110</span>;<br></code></pre></td></tr></table></figure><ul><li><strong>æ›´æ–°ä¸­çš„æ•°æ®å®Œæ•´æ€§é”™è¯¯</strong></li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">UPDATE employees<br><span class="hljs-keyword">SET</span>    department_id <span class="hljs-operator">=</span> <span class="hljs-number">55</span><br><span class="hljs-keyword">WHERE</span>  department_id <span class="hljs-operator">=</span> <span class="hljs-number">110</span>;<br></code></pre></td></tr></table></figure><p> <img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1555426069578.png"></p><blockquote><p>è¯´æ˜ï¼šä¸å­˜åœ¨ 55 å·éƒ¨é—¨</p></blockquote><p><strong>ä¿®æ”¹æ•°æ®æ—¶ï¼Œæ—¶å¯èƒ½å­˜åœ¨ä¸æˆåŠŸçš„æƒ…å†µçš„ã€‚ï¼ˆå¯èƒ½æ˜¯ç”±äºçº¦æŸçš„å½±å“é€ æˆçš„ï¼‰ã€‚</strong></p><h2 id="3-åˆ é™¤æ•°æ®"><a href="#3-åˆ é™¤æ•°æ®" class="headerlink" title="3. åˆ é™¤æ•°æ®"></a>3. åˆ é™¤æ•°æ®</h2><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1555426124751.png"></p><ul><li>ä½¿ç”¨ DELETE è¯­å¥ä»è¡¨ä¸­åˆ é™¤æ•°æ®</li></ul><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1555426162264.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DELETE FROM table_name [WHERE &lt;condition&gt;];<br></code></pre></td></tr></table></figure><p>table_nameæŒ‡å®šè¦æ‰§è¡Œåˆ é™¤æ“ä½œçš„è¡¨ï¼›â€œ[WHERE <condition>]â€ä¸ºå¯é€‰å‚æ•°ï¼ŒæŒ‡å®šåˆ é™¤æ¡ä»¶ï¼Œå¦‚æœæ²¡æœ‰WHEREå­å¥ï¼ŒDELETEè¯­å¥å°†åˆ é™¤è¡¨ä¸­çš„æ‰€æœ‰è®°å½•ã€‚</p><ul><li>ä½¿ç”¨ WHERE å­å¥åˆ é™¤æŒ‡å®šçš„è®°å½•ã€‚</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> departments<br><span class="hljs-keyword">WHERE</span>  department_name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;Finance&#x27;</span>;<br></code></pre></td></tr></table></figure><ul><li>å¦‚æœçœç•¥ WHERE å­å¥ï¼Œåˆ™è¡¨ä¸­çš„å…¨éƒ¨æ•°æ®å°†è¢«åˆ é™¤</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span>  copy_emp;<br></code></pre></td></tr></table></figure><ul><li><strong>åˆ é™¤ä¸­çš„æ•°æ®å®Œæ•´æ€§é”™è¯¯</strong></li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> departments<br><span class="hljs-keyword">WHERE</span>       department_id <span class="hljs-operator">=</span> <span class="hljs-number">60</span>;<br></code></pre></td></tr></table></figure><p> <img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1555426258516.png"></p><blockquote><p>è¯´æ˜ï¼šYou cannot delete a row that contains a primary key that is used as a foreign key in another table.</p></blockquote><p><strong>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ’å…¥ã€æ›´æ–°ã€åˆ é™¤æ“ä½œï¼Œéƒ½éœ€è¦æ»¡è¶³ç°æœ‰çº¦æŸï¼Œå¦åˆ™æ‰§è¡Œä¸æˆåŠŸã€‚</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql">#ç‰¹æ®Šç”¨æ³•ï¼šå°†useridä¸ºBbiriçš„<span class="hljs-keyword">user</span>è¡¨å’Œmy_employeesè¡¨çš„è®°å½•å…¨éƒ¨åˆ é™¤ <br><span class="hljs-keyword">DELETE</span> u,e<br><span class="hljs-keyword">FROM</span> users u<br><span class="hljs-keyword">JOIN</span> my_employees e <span class="hljs-keyword">ON</span> u.`userid`<span class="hljs-operator">=</span>e.`Userid`<br><span class="hljs-keyword">WHERE</span> u.`userid`<span class="hljs-operator">=</span><span class="hljs-string">&#x27;Bbiri&#x27;</span>;<br></code></pre></td></tr></table></figure><h2 id="4-MySQL8æ–°ç‰¹æ€§ï¼šè®¡ç®—åˆ—"><a href="#4-MySQL8æ–°ç‰¹æ€§ï¼šè®¡ç®—åˆ—" class="headerlink" title="4. MySQL8æ–°ç‰¹æ€§ï¼šè®¡ç®—åˆ—"></a>4. MySQL8æ–°ç‰¹æ€§ï¼šè®¡ç®—åˆ—</h2><p>ä»€ä¹ˆå«è®¡ç®—åˆ—å‘¢ï¼Ÿç®€å•æ¥è¯´å°±æ˜¯æŸä¸€åˆ—çš„å€¼æ˜¯é€šè¿‡åˆ«çš„åˆ—è®¡ç®—å¾—æ¥çš„ã€‚ä¾‹å¦‚ï¼Œaåˆ—å€¼ä¸º1ã€båˆ—å€¼ä¸º2ï¼Œcåˆ—ä¸éœ€è¦æ‰‹åŠ¨æ’å…¥ï¼Œå®šä¹‰a+bçš„ç»“æœä¸ºcçš„å€¼ï¼Œé‚£ä¹ˆcå°±æ˜¯è®¡ç®—åˆ—ï¼Œæ˜¯é€šè¿‡åˆ«çš„åˆ—è®¡ç®—å¾—æ¥çš„ã€‚</p><p>åœ¨MySQL 8.0ä¸­ï¼ŒCREATE TABLE å’Œ ALTER TABLE ä¸­éƒ½æ”¯æŒå¢åŠ è®¡ç®—åˆ—ã€‚ä¸‹é¢ä»¥CREATE TABLEä¸ºä¾‹è¿›è¡Œè®²è§£ã€‚</p><p>ä¸¾ä¾‹ï¼šå®šä¹‰æ•°æ®è¡¨tb1ï¼Œç„¶åå®šä¹‰å­—æ®µidã€å­—æ®µaã€å­—æ®µbå’Œå­—æ®µcï¼Œå…¶ä¸­å­—æ®µcä¸ºè®¡ç®—åˆ—ï¼Œç”¨äºè®¡ç®—a+bçš„å€¼ã€‚<br>é¦–å…ˆåˆ›å»ºæµ‹è¯•è¡¨tb1ï¼Œè¯­å¥å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> tb1(<br>id <span class="hljs-type">INT</span>,<br>a <span class="hljs-type">INT</span>,<br>b <span class="hljs-type">INT</span>,<br>c <span class="hljs-type">INT</span> GENERATED ALWAYS <span class="hljs-keyword">AS</span> (a <span class="hljs-operator">+</span> b) VIRTUAL<br>);<br><br>æˆ–è€…<br><br><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> test1 <br><span class="hljs-keyword">ADD</span> c <span class="hljs-type">INT</span> GENERATED ALWAYS <span class="hljs-keyword">AS</span> (a <span class="hljs-operator">+</span> b) VIRTUAL;<br></code></pre></td></tr></table></figure><p>æ’å…¥æ¼”ç¤ºæ•°æ®ï¼Œè¯­å¥å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">INSERT INTO tb1(a,b) VALUES (100,200);<br></code></pre></td></tr></table></figure><p>æŸ¥è¯¢æ•°æ®è¡¨tb1ä¸­çš„æ•°æ®ï¼Œç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT * FROM tb1;<br>+------+------+------+------+<br>| id   | a    | b    | c    |<br>+------+------+------+------+<br>| NULL |  100 |  200 |  300 |<br>+------+------+------+------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>æ›´æ–°æ•°æ®ä¸­çš„æ•°æ®ï¼Œè¯­å¥å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; UPDATE tb1 SET a = 500;<br>Query OK, 0 rows affected (0.00 sec)<br>Rows matched: 1  Changed: 0  Warnings: 0<br></code></pre></td></tr></table></figure><h2 id="5-ç»¼åˆæ¡ˆä¾‹"><a href="#5-ç»¼åˆæ¡ˆä¾‹" class="headerlink" title="5. ç»¼åˆæ¡ˆä¾‹"></a>5. ç»¼åˆæ¡ˆä¾‹</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql"># 1ã€åˆ›å»ºæ•°æ®åº“test01_library<br><br># 2ã€åˆ›å»ºè¡¨ booksï¼Œè¡¨ç»“æ„å¦‚ä¸‹ï¼š<br></code></pre></td></tr></table></figure><table><thead><tr><th>å­—æ®µå</th><th>å­—æ®µè¯´æ˜</th><th>æ•°æ®ç±»å‹</th></tr></thead><tbody><tr><td>id</td><td>ä¹¦ç¼–å·</td><td>INT</td></tr><tr><td>name</td><td>ä¹¦å</td><td>VARCHAR(50)</td></tr><tr><td>authors</td><td>ä½œè€…</td><td>VARCHAR(100)</td></tr><tr><td>price</td><td>ä»·æ ¼</td><td>FLOAT</td></tr><tr><td>pubdate</td><td>å‡ºç‰ˆæ—¥æœŸ</td><td>YEAR</td></tr><tr><td>note</td><td>è¯´æ˜</td><td>VARCHAR(100)</td></tr><tr><td>num</td><td>åº“å­˜</td><td>INT</td></tr></tbody></table><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql"># 3ã€å‘booksè¡¨ä¸­æ’å…¥è®°å½•<br><br># 1ï¼‰ä¸æŒ‡å®šå­—æ®µåç§°ï¼Œæ’å…¥ç¬¬ä¸€æ¡è®°å½•<br># 2ï¼‰æŒ‡å®šæ‰€æœ‰å­—æ®µåç§°ï¼Œæ’å…¥ç¬¬äºŒè®°å½•<br># 3ï¼‰åŒæ—¶æ’å…¥å¤šæ¡è®°å½•ï¼ˆå‰©ä¸‹çš„æ‰€æœ‰è®°å½•ï¼‰<br></code></pre></td></tr></table></figure><table><thead><tr><th>id</th><th>name</th><th>authors</th><th>price</th><th>pubdate</th><th>note</th><th>num</th></tr></thead><tbody><tr><td>1</td><td>Tal of AAA</td><td>Dickes</td><td>23</td><td>1995</td><td>novel</td><td>11</td></tr><tr><td>2</td><td>EmmaT</td><td>Jane lura</td><td>35</td><td>1993</td><td>joke</td><td>22</td></tr><tr><td>3</td><td>Story of Jane</td><td>Jane Tim</td><td>40</td><td>2001</td><td>novel</td><td>0</td></tr><tr><td>4</td><td>Lovey Day</td><td>George Byron</td><td>20</td><td>2005</td><td>novel</td><td>30</td></tr><tr><td>5</td><td>Old land</td><td>Honore Blade</td><td>30</td><td>2010</td><td>law</td><td>0</td></tr><tr><td>6</td><td>The Battle</td><td>Upton Sara</td><td>30</td><td>1999</td><td>medicine</td><td>40</td></tr><tr><td>7</td><td>Rose Hood</td><td>Richard haggard</td><td>28</td><td>2008</td><td>cartoon</td><td>28</td></tr></tbody></table><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql"># 4ã€å°†å°è¯´ç±»å‹(novel)çš„ä¹¦çš„ä»·æ ¼éƒ½å¢åŠ 5ã€‚<br><br># 5ã€å°†åç§°ä¸ºEmmaTçš„ä¹¦çš„ä»·æ ¼æ”¹ä¸º40ï¼Œå¹¶å°†è¯´æ˜æ”¹ä¸ºdramaã€‚<br><br># 6ã€åˆ é™¤åº“å­˜ä¸º0çš„è®°å½•ã€‚<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs mysql"># 7ã€ç»Ÿè®¡ä¹¦åä¸­åŒ…å«aå­—æ¯çš„ä¹¦<br><br># 8ã€ç»Ÿè®¡ä¹¦åä¸­åŒ…å«aå­—æ¯çš„ä¹¦çš„æ•°é‡å’Œåº“å­˜æ€»é‡<br><br># 9ã€æ‰¾å‡ºâ€œnovelâ€ç±»å‹çš„ä¹¦ï¼ŒæŒ‰ç…§ä»·æ ¼é™åºæ’åˆ—<br><br># 10ã€æŸ¥è¯¢å›¾ä¹¦ä¿¡æ¯ï¼ŒæŒ‰ç…§åº“å­˜é‡é™åºæ’åˆ—ï¼Œå¦‚æœåº“å­˜é‡ç›¸åŒçš„æŒ‰ç…§noteå‡åºæ’åˆ—<br><br># 11ã€æŒ‰ç…§noteåˆ†ç±»ç»Ÿè®¡ä¹¦çš„æ•°é‡<br><br># 12ã€æŒ‰ç…§noteåˆ†ç±»ç»Ÿè®¡ä¹¦çš„åº“å­˜é‡ï¼Œæ˜¾ç¤ºåº“å­˜é‡è¶…è¿‡30æœ¬çš„<br><br># 13ã€æŸ¥è¯¢æ‰€æœ‰å›¾ä¹¦ï¼Œæ¯é¡µæ˜¾ç¤º5æœ¬ï¼Œæ˜¾ç¤ºç¬¬äºŒé¡µ<br><br># 14ã€æŒ‰ç…§noteåˆ†ç±»ç»Ÿè®¡ä¹¦çš„åº“å­˜é‡ï¼Œæ˜¾ç¤ºåº“å­˜é‡æœ€å¤šçš„<br><br># 15ã€æŸ¥è¯¢ä¹¦åè¾¾åˆ°10ä¸ªå­—ç¬¦çš„ä¹¦ï¼Œä¸åŒ…æ‹¬é‡Œé¢çš„ç©ºæ ¼<br><br># 16ã€æŸ¥è¯¢ä¹¦åå’Œç±»å‹ï¼Œå…¶ä¸­noteå€¼ä¸ºnovelæ˜¾ç¤ºå°è¯´ï¼Œlawæ˜¾ç¤ºæ³•å¾‹ï¼Œmedicineæ˜¾ç¤ºåŒ»è¯ï¼Œcartoonæ˜¾ç¤ºå¡é€šï¼Œjokeæ˜¾ç¤ºç¬‘è¯<br><br># 17ã€æŸ¥è¯¢ä¹¦åã€åº“å­˜ï¼Œå…¶ä¸­numå€¼è¶…è¿‡30æœ¬çš„ï¼Œæ˜¾ç¤ºæ»é”€ï¼Œå¤§äº0å¹¶ä½äº10çš„ï¼Œæ˜¾ç¤ºç•…é”€ï¼Œä¸º0çš„æ˜¾ç¤ºéœ€è¦æ— è´§<br><br># 18ã€ç»Ÿè®¡æ¯ä¸€ç§noteçš„åº“å­˜é‡ï¼Œå¹¶åˆè®¡æ€»é‡<br><br># 19ã€ç»Ÿè®¡æ¯ä¸€ç§noteçš„æ•°é‡ï¼Œå¹¶åˆè®¡æ€»é‡<br><br># 20ã€ç»Ÿè®¡åº“å­˜é‡å‰ä¸‰åçš„å›¾ä¹¦<br><br># 21ã€æ‰¾å‡ºæœ€æ—©å‡ºç‰ˆçš„ä¸€æœ¬ä¹¦<br><br># 22ã€æ‰¾å‡ºnovelä¸­ä»·æ ¼æœ€é«˜çš„ä¸€æœ¬ä¹¦<br><br># 23ã€æ‰¾å‡ºä¹¦åä¸­å­—æ•°æœ€å¤šçš„ä¸€æœ¬ä¹¦ï¼Œä¸å«ç©ºæ ¼<br></code></pre></td></tr></table></figure><p>ç­”æ¡ˆï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#1ã€åˆ›å»ºæ•°æ®åº“test01_library<br>CREATE DATABASE IF NOT EXISTS test01_library CHARACTER SET &#x27;utf8&#x27;;<br><br>#æŒ‡å®šä½¿ç”¨å“ªä¸ªæ•°æ®åº“<br>USE test01_library;<br><br>#2ã€åˆ›å»ºè¡¨ books<br>CREATE TABLE books(<br>id INT,<br>name VARCHAR(50),<br>`authors` VARCHAR(100) ,<br>price FLOAT,<br>pubdate YEAR ,<br>note VARCHAR(100),<br>num INT<br>);<br><br>#3ã€å‘booksè¡¨ä¸­æ’å…¥è®°å½•<br># 1ï¼‰ä¸æŒ‡å®šå­—æ®µåç§°ï¼Œæ’å…¥ç¬¬ä¸€æ¡è®°å½•<br>INSERT INTO books <br>VALUES(1,&#x27;Tal of AAA&#x27;,&#x27;Dickes&#x27;,23,1995,&#x27;novel&#x27;,11);<br># 2ï¼‰æŒ‡å®šæ‰€æœ‰å­—æ®µåç§°ï¼Œæ’å…¥ç¬¬äºŒè®°å½•<br>INSERT INTO books (id,name,`authors`,price,pubdate,note,num)<br>VALUES(2,&#x27;EmmaT&#x27;,&#x27;Jane lura&#x27;,35,1993,&#x27;Joke&#x27;,22);<br># 3ï¼‰åŒæ—¶æ’å…¥å¤šæ¡è®°å½•ï¼ˆå‰©ä¸‹çš„æ‰€æœ‰è®°å½•ï¼‰<br>INSERT INTO books (id,name,`authors`,price,pubdate,note,num) VALUES<br>(3,&#x27;Story of Jane&#x27;,&#x27;Jane Tim&#x27;,40,2001,&#x27;novel&#x27;,0),<br>(4,&#x27;Lovey Day&#x27;,&#x27;George Byron&#x27;,20,2005,&#x27;novel&#x27;,30),<br>(5,&#x27;Old land&#x27;,&#x27;Honore Blade&#x27;,30,2010,&#x27;Law&#x27;,0),<br>(6,&#x27;The Battle&#x27;,&#x27;Upton Sara&#x27;,30,1999,&#x27;medicine&#x27;,40),<br>(7,&#x27;Rose Hood&#x27;,&#x27;Richard haggard&#x27;,28,2008,&#x27;cartoon&#x27;,28);<br><br># 4ã€å°†å°è¯´ç±»å‹(novel)çš„ä¹¦çš„ä»·æ ¼éƒ½å¢åŠ 5ã€‚<br>UPDATE books SET price=price+5 WHERE note = &#x27;novel&#x27;;<br><br># 5ã€å°†åç§°ä¸ºEmmaTçš„ä¹¦çš„ä»·æ ¼æ”¹ä¸º40ï¼Œå¹¶å°†è¯´æ˜æ”¹ä¸ºdramaã€‚<br>UPDATE books SET price=40,note=&#x27;drama&#x27; WHERE name=&#x27;EmmaT&#x27;;<br><br># 6ã€åˆ é™¤åº“å­˜ä¸º0çš„è®°å½•ã€‚<br>DELETE FROM books WHERE num=0;<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs mysql"># 7ã€ç»Ÿè®¡ä¹¦åä¸­åŒ…å«aå­—æ¯çš„ä¹¦<br>SELECT * FROM books WHERE name LIKE &#x27;%a%&#x27;;<br><br># 8ã€ç»Ÿè®¡ä¹¦åä¸­åŒ…å«aå­—æ¯çš„ä¹¦çš„æ•°é‡å’Œåº“å­˜æ€»é‡<br>SELECT COUNT(*),SUM(num) FROM books WHERE name LIKE &#x27;%a%&#x27;;<br><br># 9ã€æ‰¾å‡ºâ€œnovelâ€ç±»å‹çš„ä¹¦ï¼ŒæŒ‰ç…§ä»·æ ¼é™åºæ’åˆ—<br>SELECT * FROM books WHERE note = &#x27;novel&#x27; ORDER BY price DESC;<br><br># 10ã€æŸ¥è¯¢å›¾ä¹¦ä¿¡æ¯ï¼ŒæŒ‰ç…§åº“å­˜é‡é™åºæ’åˆ—ï¼Œå¦‚æœåº“å­˜é‡ç›¸åŒçš„æŒ‰ç…§noteå‡åºæ’åˆ—<br>SELECT * FROM books ORDER BY num DESC,note ASC;<br><br># 11ã€æŒ‰ç…§noteåˆ†ç±»ç»Ÿè®¡ä¹¦çš„æ•°é‡<br>SELECT note,COUNT(*) FROM books GROUP BY note;<br><br># 12ã€æŒ‰ç…§noteåˆ†ç±»ç»Ÿè®¡ä¹¦çš„åº“å­˜é‡ï¼Œæ˜¾ç¤ºåº“å­˜é‡è¶…è¿‡30æœ¬çš„<br>SELECT note,SUM(num) FROM books GROUP BY note HAVING SUM(num)&gt;30;<br><br># 13ã€æŸ¥è¯¢æ‰€æœ‰å›¾ä¹¦ï¼Œæ¯é¡µæ˜¾ç¤º5æœ¬ï¼Œæ˜¾ç¤ºç¬¬äºŒé¡µ<br>SELECT * FROM books LIMIT 5,5;<br><br># 14ã€æŒ‰ç…§noteåˆ†ç±»ç»Ÿè®¡ä¹¦çš„åº“å­˜é‡ï¼Œæ˜¾ç¤ºåº“å­˜é‡æœ€å¤šçš„<br>SELECT note,SUM(num) sum_num FROM books GROUP BY note ORDER BY sum_num DESC LIMIT 0,1;<br><br># 15ã€æŸ¥è¯¢ä¹¦åè¾¾åˆ°10ä¸ªå­—ç¬¦çš„ä¹¦ï¼Œä¸åŒ…æ‹¬é‡Œé¢çš„ç©ºæ ¼<br>SELECT * FROM books WHERE CHAR_LENGTH(REPLACE(name,&#x27; &#x27;,&#x27;&#x27;))&gt;=10;<br><br>/*<br>16ã€æŸ¥è¯¢ä¹¦åå’Œç±»å‹ï¼Œ<br> å…¶ä¸­noteå€¼ä¸º novelæ˜¾ç¤ºå°è¯´ï¼Œlawæ˜¾ç¤ºæ³•å¾‹ï¼Œmedicineæ˜¾ç¤ºåŒ»è¯ï¼Œcartoonæ˜¾ç¤ºå¡é€šï¼Œjokeæ˜¾ç¤ºç¬‘è¯<br>*/<br>SELECT name AS &quot;ä¹¦å&quot; ,note, CASE note <br> WHEN &#x27;novel&#x27; THEN &#x27;å°è¯´&#x27;<br> WHEN &#x27;law&#x27; THEN &#x27;æ³•å¾‹&#x27;<br> WHEN &#x27;medicine&#x27; THEN &#x27;åŒ»è¯&#x27;<br> WHEN &#x27;cartoon&#x27; THEN &#x27;å¡é€š&#x27;<br> WHEN &#x27;joke&#x27; THEN &#x27;ç¬‘è¯&#x27;<br> END AS &quot;ç±»å‹&quot;<br>FROM books;<br><br><br># 17ã€æŸ¥è¯¢ä¹¦åã€åº“å­˜ï¼Œå…¶ä¸­numå€¼è¶…è¿‡30æœ¬çš„ï¼Œæ˜¾ç¤ºæ»é”€ï¼Œå¤§äº0å¹¶ä½äº10çš„ï¼Œæ˜¾ç¤ºç•…é”€ï¼Œä¸º0çš„æ˜¾ç¤ºéœ€è¦æ— è´§<br>SELECT name,num,CASE <br>  WHEN num&gt;30 THEN &#x27;æ»é”€&#x27;<br>  WHEN num&gt;0 AND num&lt;10 THEN &#x27;ç•…é”€&#x27;<br>  WHEN num=0 THEN &#x27;æ— è´§&#x27;<br>  ELSE &#x27;æ­£å¸¸&#x27;<br>  END AS &quot;åº“å­˜çŠ¶æ€&quot;<br>FROM books;<br><br># 18ã€ç»Ÿè®¡æ¯ä¸€ç§noteçš„åº“å­˜é‡ï¼Œå¹¶åˆè®¡æ€»é‡<br>SELECT IFNULL(note,&#x27;åˆè®¡æ€»åº“å­˜é‡&#x27;) AS note,SUM(num) FROM books GROUP BY note WITH ROLLUP;<br><br># 19ã€ç»Ÿè®¡æ¯ä¸€ç§noteçš„æ•°é‡ï¼Œå¹¶åˆè®¡æ€»é‡<br>SELECT IFNULL(note,&#x27;åˆè®¡æ€»æ•°&#x27;) AS note,COUNT(*) FROM books GROUP BY note WITH ROLLUP;<br><br># 20ã€ç»Ÿè®¡åº“å­˜é‡å‰ä¸‰åçš„å›¾ä¹¦<br>SELECT * FROM books ORDER BY num DESC LIMIT 0,3;<br><br># 21ã€æ‰¾å‡ºæœ€æ—©å‡ºç‰ˆçš„ä¸€æœ¬ä¹¦<br>SELECT * FROM books ORDER BY pubdate ASC LIMIT 0,1;<br><br># 22ã€æ‰¾å‡ºnovelä¸­ä»·æ ¼æœ€é«˜çš„ä¸€æœ¬ä¹¦<br>SELECT * FROM books WHERE note = &#x27;novel&#x27; ORDER BY price DESC LIMIT 0,1;<br><br># 23ã€æ‰¾å‡ºä¹¦åä¸­å­—æ•°æœ€å¤šçš„ä¸€æœ¬ä¹¦ï¼Œä¸å«ç©ºæ ¼<br>SELECT * FROM books ORDER BY CHAR_LENGTH(REPLACE(name,&#x27; &#x27;,&#x27;&#x27;)) DESC LIMIT 0,1;<br></code></pre></td></tr></table></figure><h1 id="ç¬¬12ç« -MySQLæ•°æ®ç±»å‹ç²¾è®²"><a href="#ç¬¬12ç« -MySQLæ•°æ®ç±»å‹ç²¾è®²" class="headerlink" title="ç¬¬12ç« _MySQLæ•°æ®ç±»å‹ç²¾è®²"></a>ç¬¬12ç« _MySQLæ•°æ®ç±»å‹ç²¾è®²</h1><h2 id="1-MySQLä¸­çš„æ•°æ®ç±»å‹"><a href="#1-MySQLä¸­çš„æ•°æ®ç±»å‹" class="headerlink" title="1. MySQLä¸­çš„æ•°æ®ç±»å‹"></a>1. MySQLä¸­çš„æ•°æ®ç±»å‹</h2><table><thead><tr><th>ç±»å‹</th><th>ç±»å‹ä¸¾ä¾‹</th></tr></thead><tbody><tr><td>æ•´æ•°ç±»å‹</td><td>TINYINTã€SMALLINTã€MEDIUMINTã€INT(æˆ–INTEGER)ã€BIGINT</td></tr><tr><td>æµ®ç‚¹ç±»å‹</td><td>FLOATã€DOUBLE</td></tr><tr><td>å®šç‚¹æ•°ç±»å‹</td><td>DECIMAL</td></tr><tr><td>ä½ç±»å‹</td><td>BIT</td></tr><tr><td>æ—¥æœŸæ—¶é—´ç±»å‹</td><td>YEARã€TIMEã€DATEã€DATETIMEã€TIMESTAMP</td></tr><tr><td>æ–‡æœ¬å­—ç¬¦ä¸²ç±»å‹</td><td>CHARã€VARCHARã€TINYTEXTã€TEXTã€MEDIUMTEXTã€LONGTEXT</td></tr><tr><td>æšä¸¾ç±»å‹</td><td>ENUM</td></tr><tr><td>é›†åˆç±»å‹</td><td>SET</td></tr><tr><td>äºŒè¿›åˆ¶å­—ç¬¦ä¸²ç±»å‹</td><td>BINARYã€VARBINARYã€TINYBLOBã€BLOBã€MEDIUMBLOBã€LONGBLOB</td></tr><tr><td>JSONç±»å‹</td><td>JSONå¯¹è±¡ã€JSONæ•°ç»„</td></tr><tr><td>ç©ºé—´æ•°æ®ç±»å‹</td><td>å•å€¼ç±»å‹ï¼šGEOMETRYã€POINTã€LINESTRINGã€POLYGONï¼›<br/>é›†åˆç±»å‹ï¼šMULTIPOINTã€MULTILINESTRINGã€MULTIPOLYGONã€GEOMETRYCOLLECTION</td></tr></tbody></table><p>å¸¸è§æ•°æ®ç±»å‹çš„å±æ€§ï¼Œå¦‚ä¸‹ï¼š</p><table><thead><tr><th>MySQLå…³é”®å­—</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>NULL</td><td>æ•°æ®åˆ—å¯åŒ…å«NULLå€¼</td></tr><tr><td>NOT NULL</td><td>æ•°æ®åˆ—ä¸å…è®¸åŒ…å«NULLå€¼</td></tr><tr><td>DEFAULT</td><td>é»˜è®¤å€¼</td></tr><tr><td>PRIMARY KEY</td><td>ä¸»é”®</td></tr><tr><td>AUTO_INCREMENT</td><td>è‡ªåŠ¨é€’å¢ï¼Œé€‚ç”¨äºæ•´æ•°ç±»å‹</td></tr><tr><td>UNSIGNED</td><td>æ— ç¬¦å·</td></tr><tr><td>CHARACTER SET name</td><td>æŒ‡å®šä¸€ä¸ªå­—ç¬¦é›†</td></tr></tbody></table><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql">#åˆ›å»ºæ•°æ®åº“æ—¶æŒ‡æ˜å­—ç¬¦é›†<br><span class="hljs-keyword">CREATE</span> DATABASE IF <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> dbtest12 <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> <span class="hljs-string">&#x27;utf8&#x27;</span><br><br>#åˆ›å»ºè¡¨æ—¶ï¼ŒæŒ‡æ˜è¡¨çš„å­—ç¬¦é›†<br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> table1(<br>id <span class="hljs-type">INT</span>) <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> <span class="hljs-string">&#x27;utf8&#x27;</span>;<br><br>#åˆ›å»ºè¡¨æ—¶ï¼ŒæŒ‡åè¡¨ä¸­å­—æ®µçš„å­—ç¬¦é›†<br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> table2(<br>id <span class="hljs-type">INT</span> <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> <span class="hljs-string">&#x27;utf8&#x27;</span><br>);<br></code></pre></td></tr></table></figure><h2 id="2-æ•´æ•°ç±»å‹"><a href="#2-æ•´æ•°ç±»å‹" class="headerlink" title="2. æ•´æ•°ç±»å‹"></a>2. æ•´æ•°ç±»å‹</h2><h3 id="2-1-ç±»å‹ä»‹ç»"><a href="#2-1-ç±»å‹ä»‹ç»" class="headerlink" title="2.1 ç±»å‹ä»‹ç»"></a>2.1 ç±»å‹ä»‹ç»</h3><p>æ•´æ•°ç±»å‹ä¸€å…±æœ‰ 5 ç§ï¼ŒåŒ…æ‹¬ TINYINTã€SMALLINTã€MEDIUMINTã€INTï¼ˆINTEGERï¼‰å’Œ BIGINTã€‚</p><p>å®ƒä»¬çš„åŒºåˆ«å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p><table><thead><tr><th><strong>æ•´æ•°ç±»å‹</strong></th><th><strong>å­—èŠ‚</strong></th><th>æœ‰ç¬¦å·æ•°å–å€¼èŒƒå›´</th><th>æ— ç¬¦å·æ•°å–å€¼èŒƒå›´</th></tr></thead><tbody><tr><td>TINYINT</td><td>1</td><td>-128~127</td><td>0~255</td></tr><tr><td>SMALLINT</td><td>2</td><td>-32768~32767</td><td>0~65535</td></tr><tr><td>MEDIUMINT</td><td>3</td><td>-8388608~8388607</td><td>0~16777215</td></tr><tr><td>INTã€INTEGER</td><td>4</td><td>-2147483648~2147483647</td><td>0~4294967295</td></tr><tr><td>BIGINT</td><td>8</td><td>-9223372036854775808~9223372036854775807</td><td>0~18446744073709551615</td></tr></tbody></table><h3 id="2-2-å¯é€‰å±æ€§"><a href="#2-2-å¯é€‰å±æ€§" class="headerlink" title="2.2 å¯é€‰å±æ€§"></a>2.2 å¯é€‰å±æ€§</h3><p><strong>æ•´æ•°ç±»å‹çš„å¯é€‰å±æ€§æœ‰ä¸‰ä¸ªï¼š</strong></p><h4 id="2-2-1-M"><a href="#2-2-1-M" class="headerlink" title="2.2.1 M"></a>2.2.1 M</h4><p><code>M</code>: è¡¨ç¤ºæ˜¾ç¤ºå®½åº¦ï¼ŒMçš„å–å€¼èŒƒå›´æ˜¯(0, 255)ã€‚ä¾‹å¦‚ï¼Œint(5)ï¼šå½“æ•°æ®å®½åº¦å°äº5ä½çš„æ—¶å€™åœ¨æ•°å­—å‰é¢éœ€è¦ç”¨å­—ç¬¦å¡«æ»¡å®½åº¦ã€‚è¯¥é¡¹åŠŸèƒ½éœ€è¦é…åˆâ€œ<code>ZEROFILL</code>â€ä½¿ç”¨ï¼Œè¡¨ç¤ºç”¨â€œ0â€å¡«æ»¡å®½åº¦ï¼Œå¦åˆ™æŒ‡å®šæ˜¾ç¤ºå®½åº¦æ— æ•ˆã€‚å½“æ•°æ®å®½åº¦å¤§äº5ä½æ—¶ï¼Œæ˜¾ç¤ºåŸæ•°æ®ã€‚</p><p>å¦‚æœè®¾ç½®äº†æ˜¾ç¤ºå®½åº¦ï¼Œé‚£ä¹ˆæ’å…¥çš„æ•°æ®å®½åº¦è¶…è¿‡æ˜¾ç¤ºå®½åº¦é™åˆ¶ï¼Œä¼šä¸ä¼šæˆªæ–­æˆ–æ’å…¥å¤±è´¥ï¼Ÿ</p><p>ç­”æ¡ˆï¼šä¸ä¼šå¯¹æ’å…¥çš„æ•°æ®æœ‰ä»»ä½•å½±å“ï¼Œè¿˜æ˜¯æŒ‰ç…§ç±»å‹çš„å®é™…å®½åº¦è¿›è¡Œä¿å­˜ï¼Œå³<code>æ˜¾ç¤ºå®½åº¦ä¸ç±»å‹å¯ä»¥å­˜å‚¨çš„å€¼èŒƒå›´æ— å…³</code>ã€‚<strong>ä»MySQL 8.0.17å¼€å§‹ï¼Œæ•´æ•°æ•°æ®ç±»å‹ä¸æ¨èä½¿ç”¨æ˜¾ç¤ºå®½åº¦å±æ€§ã€‚</strong></p><p>æ•´å‹æ•°æ®ç±»å‹å¯ä»¥åœ¨å®šä¹‰è¡¨ç»“æ„æ—¶æŒ‡å®šæ‰€éœ€è¦çš„æ˜¾ç¤ºå®½åº¦ï¼Œå¦‚æœä¸æŒ‡å®šï¼Œåˆ™ç³»ç»Ÿä¸ºæ¯ä¸€ç§ç±»å‹æŒ‡å®šé»˜è®¤çš„å®½åº¦å€¼ã€‚</p><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE TABLE test_int1 ( x TINYINT,ã€€y SMALLINT,ã€€z MEDIUMINT,ã€€m INT,ã€€n BIGINT );<br></code></pre></td></tr></table></figure><p>æŸ¥çœ‹è¡¨ç»“æ„ ï¼ˆMySQL5.7ä¸­æ˜¾å¼å¦‚ä¸‹ï¼ŒMySQL8ä¸­ä¸å†æ˜¾å¼èŒƒå›´ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; desc test_int1;<br>+-------+--------------+------+-----+---------+-------+<br>| Field | Type         | Null | Key | Default | Extra |<br>+-------+--------------+------+-----+---------+-------+<br>|   x   | tinyint(4)   | YES  |     | NULL    |       |<br>| ã€€y   | smallint(6)  | YES  |     | NULL    |       |<br>| ã€€z   | mediumint(9) | YES  |     | NULL    |       |<br>| ã€€m   | int(11)      | YES  |     | NULL    |       |<br>| ã€€n   | bigint(20)   | YES  |     | NULL    |       |<br>+-------+--------------+------+-----+---------+-------+<br>5 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>TINYINTæœ‰ç¬¦å·æ•°å’Œæ— ç¬¦å·æ•°çš„å–å€¼èŒƒå›´åˆ†åˆ«ä¸º-128<del>127å’Œ0</del>255ï¼Œç”±äºè´Ÿå·å äº†ä¸€ä¸ªæ•°å­—ä½ï¼Œå› æ­¤TINYINTé»˜è®¤çš„æ˜¾ç¤ºå®½åº¦ä¸º4ã€‚åŒç†ï¼Œå…¶ä»–æ•´æ•°ç±»å‹çš„é»˜è®¤æ˜¾ç¤ºå®½åº¦ä¸å…¶æœ‰ç¬¦å·æ•°çš„æœ€å°å€¼çš„å®½åº¦ç›¸åŒã€‚</p><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE TABLE test_int2(<br>f1 INT,<br>f2 INT(5),<br>f3 INT(5) ZEROFILL<br>)<br><br>DESC test_int2;<br><br>INSERT INTO test_int2(f1,f2,f3)<br>VALUES(1,123,123);<br><br>INSERT INTO test_int2(f1,f2)<br>VALUES(123456,123456);<br><br>INSERT INTO test_int2(f1,f2,f3)<br>VALUES(123456,123456,123456);<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT * FROM test_int2;<br>+--------+--------+--------+<br>| f1     | f2     | f3     |<br>+--------+--------+--------+<br>|      1 |    123 |  00123 |<br>| 123456 | 123456 |   NULL |<br>| 123456 | 123456 | 123456 |<br>+--------+--------+--------+<br>3 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><h4 id="2-2-2-UNSIGNED"><a href="#2-2-2-UNSIGNED" class="headerlink" title="2.2.2 UNSIGNED"></a>2.2.2 UNSIGNED</h4><p><code>UNSIGNED</code>: æ— ç¬¦å·ç±»å‹ï¼ˆéè´Ÿï¼‰ï¼Œæ‰€æœ‰çš„æ•´æ•°ç±»å‹éƒ½æœ‰ä¸€ä¸ªå¯é€‰çš„å±æ€§UNSIGNEDï¼ˆæ— ç¬¦å·å±æ€§ï¼‰ï¼Œæ— ç¬¦å·æ•´æ•°ç±»å‹çš„æœ€å°å–å€¼ä¸º0ã€‚æ‰€ä»¥ï¼Œå¦‚æœéœ€è¦åœ¨MySQLæ•°æ®åº“ä¸­ä¿å­˜éè´Ÿæ•´æ•°å€¼æ—¶ï¼Œå¯ä»¥å°†æ•´æ•°ç±»å‹è®¾ç½®ä¸ºæ— ç¬¦å·ç±»å‹ã€‚</p><p>intç±»å‹é»˜è®¤æ˜¾ç¤ºå®½åº¦ä¸ºint(11)ï¼Œæ— ç¬¦å·intç±»å‹é»˜è®¤æ˜¾ç¤ºå®½åº¦ä¸ºint(10)ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE TABLE test_int3(<br>f1 INT UNSIGNED<br>);<br><br>mysql&gt; desc test_int3;<br>+-------+------------------+------+-----+---------+-------+<br>| Field | Type             | Null | Key | Default | Extra |<br>+-------+------------------+------+-----+---------+-------+<br>| f1    | int(10) unsigned | YES  |     | NULL    |       |<br>+-------+------------------+------+-----+---------+-------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><h4 id="2-2-3-ZEROFILL"><a href="#2-2-3-ZEROFILL" class="headerlink" title="2.2.3 ZEROFILL"></a>2.2.3 ZEROFILL</h4><p><code>ZEROFILL</code>: 0å¡«å……,ï¼ˆ<strong>å¦‚æœæŸåˆ—æ˜¯ZEROFILLï¼Œé‚£ä¹ˆMySQLä¼šè‡ªåŠ¨ä¸ºå½“å‰åˆ—æ·»åŠ UNSIGNEDå±æ€§</strong>ï¼‰ï¼Œå¦‚æœæŒ‡å®šäº†ZEROFILLåªæ˜¯è¡¨ç¤ºä¸å¤ŸMä½æ—¶ï¼Œç”¨0åœ¨å·¦è¾¹å¡«å……ï¼Œå¦‚æœè¶…è¿‡Mä½ï¼Œåªè¦ä¸è¶…è¿‡æ•°æ®å­˜å‚¨èŒƒå›´å³å¯ã€‚</p><p>åŸæ¥ï¼Œåœ¨ int(M) ä¸­ï¼ŒM çš„å€¼è·Ÿ int(M) æ‰€å å¤šå°‘å­˜å‚¨ç©ºé—´å¹¶æ— ä»»ä½•å…³ç³»ã€‚ int(3)ã€int(4)ã€int(8) åœ¨ç£ç›˜ä¸Šéƒ½æ˜¯å ç”¨ 4 bytes çš„å­˜å‚¨ç©ºé—´ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>int(M)ï¼Œå¿…é¡»å’ŒUNSIGNED ZEROFILLä¸€èµ·ä½¿ç”¨æ‰æœ‰æ„ä¹‰ã€‚</strong>å¦‚æœæ•´æ•°å€¼è¶…è¿‡Mä½ï¼Œå°±æŒ‰ç…§å®é™…ä½æ•°å­˜å‚¨ã€‚åªæ˜¯æ— é¡»å†ç”¨å­—ç¬¦ 0 è¿›è¡Œå¡«å……ã€‚</p><h3 id="2-3-é€‚ç”¨åœºæ™¯"><a href="#2-3-é€‚ç”¨åœºæ™¯" class="headerlink" title="2.3 é€‚ç”¨åœºæ™¯"></a>2.3 é€‚ç”¨åœºæ™¯</h3><p><code>TINYINT</code>ï¼šä¸€èˆ¬ç”¨äºæšä¸¾æ•°æ®ï¼Œæ¯”å¦‚ç³»ç»Ÿè®¾å®šå–å€¼èŒƒå›´å¾ˆå°ä¸”å›ºå®šçš„åœºæ™¯ã€‚</p><p><code>SMALLINT</code>ï¼šå¯ä»¥ç”¨äºè¾ƒå°èŒƒå›´çš„ç»Ÿè®¡æ•°æ®ï¼Œæ¯”å¦‚ç»Ÿè®¡å·¥å‚çš„å›ºå®šèµ„äº§åº“å­˜æ•°é‡ç­‰ã€‚</p><p><code>MEDIUMINT</code>ï¼šç”¨äºè¾ƒå¤§æ•´æ•°çš„è®¡ç®—ï¼Œæ¯”å¦‚è½¦ç«™æ¯æ—¥çš„å®¢æµé‡ç­‰ã€‚</p><p><code>INTã€INTEGER</code>ï¼šå–å€¼èŒƒå›´è¶³å¤Ÿå¤§ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä¸ç”¨è€ƒè™‘è¶…é™é—®é¢˜ï¼Œç”¨å¾—æœ€å¤šã€‚æ¯”å¦‚å•†å“ç¼–å·ã€‚</p><p><code>BIGINT</code>ï¼šåªæœ‰å½“ä½ å¤„ç†ç‰¹åˆ«å·¨å¤§çš„æ•´æ•°æ—¶æ‰ä¼šç”¨åˆ°ã€‚æ¯”å¦‚åŒåä¸€çš„äº¤æ˜“é‡ã€å¤§å‹é—¨æˆ·ç½‘ç«™ç‚¹å‡»é‡ã€è¯åˆ¸å…¬å¸è¡ç”Ÿäº§å“æŒä»“ç­‰ã€‚</p><h3 id="2-4-å¦‚ä½•é€‰æ‹©ï¼Ÿ"><a href="#2-4-å¦‚ä½•é€‰æ‹©ï¼Ÿ" class="headerlink" title="2.4 å¦‚ä½•é€‰æ‹©ï¼Ÿ"></a>2.4 å¦‚ä½•é€‰æ‹©ï¼Ÿ</h3><p>åœ¨è¯„ä¼°ç”¨å“ªç§æ•´æ•°ç±»å‹çš„æ—¶å€™ï¼Œä½ éœ€è¦è€ƒè™‘<code>å­˜å‚¨ç©ºé—´</code>å’Œ<code>å¯é æ€§</code>çš„å¹³è¡¡é—®é¢˜ï¼šä¸€æ–¹ é¢ï¼Œç”¨å ç”¨å­—èŠ‚æ•°å°‘çš„æ•´æ•°ç±»å‹å¯ä»¥èŠ‚çœå­˜å‚¨ç©ºé—´ï¼›å¦ä¸€æ–¹é¢ï¼Œè¦æ˜¯ä¸ºäº†èŠ‚çœå­˜å‚¨ç©ºé—´ï¼Œ ä½¿ç”¨çš„æ•´æ•°ç±»å‹å–å€¼èŒƒå›´å¤ªå°ï¼Œä¸€æ—¦é‡åˆ°è¶…å‡ºå–å€¼èŒƒå›´çš„æƒ…å†µï¼Œå°±å¯èƒ½å¼•èµ·<code>ç³»ç»Ÿé”™è¯¯</code>ï¼Œå½±å“å¯é æ€§ã€‚ </p><p>ä¸¾ä¸ªä¾‹å­ï¼Œå•†å“ç¼–å·é‡‡ç”¨çš„æ•°æ®ç±»å‹æ˜¯ INTã€‚åŸå› å°±åœ¨äºï¼Œå®¢æˆ·é—¨åº—ä¸­æµé€šçš„å•†å“ç§ç±»è¾ƒå¤šï¼Œè€Œä¸”ï¼Œæ¯å¤©éƒ½æœ‰æ—§å•†å“ä¸‹æ¶ï¼Œæ–°å•†å“ä¸Šæ¶ï¼Œè¿™æ ·ä¸æ–­è¿­ä»£ï¼Œæ—¥ç§¯æœˆç´¯ã€‚</p><p>å¦‚æœä½¿ç”¨ SMALLINT ç±»å‹ï¼Œè™½ç„¶å ç”¨å­—èŠ‚æ•°æ¯” INT ç±»å‹çš„æ•´æ•°å°‘ï¼Œä½†æ˜¯å´ä¸èƒ½ä¿è¯æ•°æ®ä¸ä¼šè¶…å‡ºèŒƒå›´ 65535ã€‚ç›¸åï¼Œä½¿ç”¨ INTï¼Œå°±èƒ½ç¡®ä¿æœ‰è¶³å¤Ÿå¤§çš„å–å€¼èŒƒå›´ï¼Œä¸ç”¨æ‹…å¿ƒæ•°æ®è¶…å‡ºèŒƒå›´å½±å“å¯é æ€§çš„é—®é¢˜ã€‚ </p><p>ä½ è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨å®é™…å·¥ä½œä¸­ï¼Œ<strong>ç³»ç»Ÿæ•…éšœäº§ç”Ÿçš„æˆæœ¬è¿œè¿œè¶…è¿‡å¢åŠ å‡ ä¸ªå­—æ®µå­˜å‚¨ç©ºé—´æ‰€äº§ç”Ÿçš„æˆæœ¬</strong>ã€‚å› æ­¤ï¼Œæˆ‘å»ºè®®ä½ é¦–å…ˆç¡®ä¿æ•°æ®ä¸ä¼šè¶…è¿‡å–å€¼èŒƒå›´ï¼Œåœ¨è¿™ä¸ªå‰æä¹‹ä¸‹ï¼Œå†å»è€ƒè™‘å¦‚ä½•èŠ‚çœå­˜å‚¨ç©ºé—´ã€‚</p><h2 id="3-æµ®ç‚¹ç±»å‹"><a href="#3-æµ®ç‚¹ç±»å‹" class="headerlink" title="3. æµ®ç‚¹ç±»å‹"></a>3. æµ®ç‚¹ç±»å‹</h2><h3 id="3-1-ç±»å‹ä»‹ç»"><a href="#3-1-ç±»å‹ä»‹ç»" class="headerlink" title="3.1 ç±»å‹ä»‹ç»"></a>3.1 ç±»å‹ä»‹ç»</h3><p>æµ®ç‚¹æ•°å’Œå®šç‚¹æ•°ç±»å‹çš„ç‰¹ç‚¹æ˜¯å¯ä»¥<code>å¤„ç†å°æ•°</code>ï¼Œä½ å¯ä»¥æŠŠæ•´æ•°çœ‹æˆå°æ•°çš„ä¸€ä¸ªç‰¹ä¾‹ã€‚å› æ­¤ï¼Œæµ®ç‚¹æ•°å’Œå®šç‚¹æ•°çš„ä½¿ç”¨åœºæ™¯ï¼Œæ¯”æ•´æ•°å¤§å¤šäº†ã€‚ MySQLæ”¯æŒçš„æµ®ç‚¹æ•°ç±»å‹ï¼Œåˆ†åˆ«æ˜¯ FLOATã€DOUBLEã€REALã€‚</p><ul><li>FLOAT è¡¨ç¤ºå•ç²¾åº¦æµ®ç‚¹æ•°ï¼›</li><li>DOUBLE è¡¨ç¤ºåŒç²¾åº¦æµ®ç‚¹æ•°ï¼›</li></ul><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211007173312237.png"></p><ul><li><p>REALé»˜è®¤å°±æ˜¯ DOUBLEã€‚å¦‚æœä½ æŠŠ SQL æ¨¡å¼è®¾å®šä¸ºå¯ç”¨â€œ<code>REAL_AS_FLOAT</code>â€ï¼Œé‚£ ä¹ˆï¼ŒMySQL å°±è®¤ä¸º REAL æ˜¯ FLOATã€‚å¦‚æœè¦å¯ç”¨â€œREAL_AS_FLOATâ€ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹ SQL è¯­å¥å®ç°ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SET sql_mode = â€œREAL_AS_FLOATâ€;<br></code></pre></td></tr></table></figure></li></ul><p><strong>é—®é¢˜1ï¼š</strong>FLOAT å’Œ DOUBLE è¿™ä¸¤ç§æ•°æ®ç±»å‹çš„åŒºåˆ«æ˜¯å•¥å‘¢ï¼Ÿ</p><p>FLOAT å ç”¨å­—èŠ‚æ•°å°‘ï¼Œå–å€¼èŒƒå›´å°ï¼›DOUBLE å ç”¨å­—èŠ‚æ•°å¤šï¼Œå–å€¼èŒƒå›´ä¹Ÿå¤§ã€‚</p><p><strong>é—®é¢˜2ï¼š</strong>ä¸ºä»€ä¹ˆæµ®ç‚¹æ•°ç±»å‹çš„æ— ç¬¦å·æ•°å–å€¼èŒƒå›´ï¼Œåªç›¸å½“äºæœ‰ç¬¦å·æ•°å–å€¼èŒƒå›´çš„ä¸€åŠï¼Œä¹Ÿå°±æ˜¯åªç›¸å½“äºæœ‰ç¬¦å·æ•°å–å€¼èŒƒå›´å¤§äºç­‰äºé›¶çš„éƒ¨åˆ†å‘¢ï¼Ÿ </p><p>MySQL å­˜å‚¨æµ®ç‚¹æ•°çš„æ ¼å¼ä¸ºï¼š<code>ç¬¦å·(S)</code>ã€<code>å°¾æ•°(M)</code>å’Œ <code>é˜¶ç (E)</code>ã€‚å› æ­¤ï¼Œæ— è®ºæœ‰æ²¡æœ‰ç¬¦å·ï¼ŒMySQL çš„æµ®ç‚¹æ•°éƒ½ä¼šå­˜å‚¨è¡¨ç¤ºç¬¦å·çš„éƒ¨åˆ†ã€‚å› æ­¤ï¼Œ æ‰€è°“çš„æ— ç¬¦å·æ•°å–å€¼èŒƒå›´ï¼Œå…¶å®å°±æ˜¯æœ‰ç¬¦å·æ•°å–å€¼èŒƒå›´å¤§äºç­‰äºé›¶çš„éƒ¨åˆ†ã€‚</p><h3 id="3-2-æ•°æ®ç²¾åº¦è¯´æ˜"><a href="#3-2-æ•°æ®ç²¾åº¦è¯´æ˜" class="headerlink" title="3.2 æ•°æ®ç²¾åº¦è¯´æ˜"></a>3.2 æ•°æ®ç²¾åº¦è¯´æ˜</h3><p>å¯¹äºæµ®ç‚¹ç±»å‹ï¼Œåœ¨MySQLä¸­å•ç²¾åº¦å€¼ä½¿ç”¨<code>4</code>ä¸ªå­—èŠ‚ï¼ŒåŒç²¾åº¦å€¼ä½¿ç”¨<code>8</code>ä¸ªå­—èŠ‚ã€‚</p><ul><li><p>MySQLå…è®¸ä½¿ç”¨<code>éæ ‡å‡†è¯­æ³•</code>ï¼ˆå…¶ä»–æ•°æ®åº“æœªå¿…æ”¯æŒï¼Œå› æ­¤å¦‚æœæ¶‰åŠåˆ°æ•°æ®è¿ç§»ï¼Œåˆ™æœ€å¥½ä¸è¦è¿™ä¹ˆç”¨ï¼‰ï¼š<code>FLOAT(M,D)</code>æˆ–<code>DOUBLE(M,D)</code>ã€‚è¿™é‡Œï¼ŒMç§°ä¸º<code>ç²¾åº¦</code>ï¼ŒDç§°ä¸º<code>æ ‡åº¦</code>ã€‚(M,D)ä¸­ M=æ•´æ•°ä½+å°æ•°ä½ï¼ŒD=å°æ•°ä½ã€‚ D&lt;=M&lt;=255ï¼Œ0&lt;=D&lt;=30ã€‚</p><p>ä¾‹å¦‚ï¼Œå®šä¹‰ä¸ºFLOAT(5,2)çš„ä¸€ä¸ªåˆ—å¯ä»¥æ˜¾ç¤ºä¸º-999.99-999.99ã€‚å¦‚æœè¶…è¿‡è¿™ä¸ªèŒƒå›´ä¼šæŠ¥é”™ã€‚</p></li></ul><ul><li>FLOATå’ŒDOUBLEç±»å‹åœ¨ä¸æŒ‡å®š(M,D)æ—¶ï¼Œé»˜è®¤ä¼šæŒ‰ç…§å®é™…çš„ç²¾åº¦ï¼ˆç”±å®é™…çš„ç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿå†³å®šï¼‰æ¥æ˜¾ç¤ºã€‚</li><li>è¯´æ˜ï¼šæµ®ç‚¹ç±»å‹ï¼Œä¹Ÿå¯ä»¥åŠ <code>UNSIGNED</code>ï¼Œä½†æ˜¯ä¸ä¼šæ”¹å˜æ•°æ®èŒƒå›´ï¼Œä¾‹å¦‚ï¼šFLOAT(3,2) UNSIGNEDä»ç„¶åªèƒ½è¡¨ç¤º0-9.99çš„èŒƒå›´ã€‚åªæ˜¯åŠ ä¸Š<code>UNSINGED</code>æ’å…¥è´Ÿæ•°ä¼šæŠ¥é”™ã€‚</li></ul><ul><li><p>ä¸ç®¡æ˜¯å¦æ˜¾å¼è®¾ç½®äº†ç²¾åº¦(M,D)ï¼Œè¿™é‡ŒMySQLçš„å¤„ç†æ–¹æ¡ˆå¦‚ä¸‹ï¼š</p><ul><li><p>å¦‚æœå­˜å‚¨æ—¶ï¼Œæ•´æ•°éƒ¨åˆ†è¶…å‡ºäº†èŒƒå›´ï¼ŒMySQLå°±ä¼šæŠ¥é”™ï¼Œä¸å…è®¸å­˜è¿™æ ·çš„å€¼</p></li><li><p>å¦‚æœå­˜å‚¨æ—¶ï¼Œå°æ•°ç‚¹éƒ¨åˆ†è‹¥è¶…å‡ºèŒƒå›´ï¼Œå°±åˆ†ä»¥ä¸‹æƒ…å†µï¼š</p><ul><li>è‹¥å››èˆäº”å…¥åï¼Œæ•´æ•°éƒ¨åˆ†æ²¡æœ‰è¶…å‡ºèŒƒå›´ï¼Œåˆ™åªè­¦å‘Šï¼Œä½†èƒ½æˆåŠŸæ“ä½œå¹¶å››èˆäº”å…¥åˆ é™¤å¤šä½™çš„å°æ•°ä½åä¿å­˜ã€‚ä¾‹å¦‚åœ¨FLOAT(5,2)åˆ—å†…æ’å…¥999.009ï¼Œè¿‘ä¼¼ç»“æœæ˜¯999.01ã€‚</li><li>è‹¥å››èˆäº”å…¥åï¼Œæ•´æ•°éƒ¨åˆ†è¶…å‡ºèŒƒå›´ï¼Œåˆ™MySQLæŠ¥é”™ï¼Œå¹¶æ‹’ç»å¤„ç†ã€‚å¦‚FLOAT(5,2)åˆ—å†…æ’å…¥999.995å’Œ-999.995éƒ½ä¼šæŠ¥é”™ã€‚</li></ul></li></ul></li><li><p><strong>ä»MySQL 8.0.17å¼€å§‹ï¼ŒFLOAT(M,D) å’ŒDOUBLE(M,D)ç”¨æ³•åœ¨å®˜æ–¹æ–‡æ¡£ä¸­å·²ç»æ˜ç¡®ä¸æ¨èä½¿ç”¨</strong>ï¼Œå°†æ¥å¯èƒ½è¢«ç§»é™¤ã€‚å¦å¤–ï¼Œå…³äºæµ®ç‚¹å‹FLOATå’ŒDOUBLEçš„UNSIGNEDä¹Ÿä¸æ¨èä½¿ç”¨äº†ï¼Œå°†æ¥ä¹Ÿå¯èƒ½è¢«ç§»é™¤ã€‚</p></li><li><p>ä¸¾ä¾‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE TABLE test_double1(<br>f1 FLOAT,<br>f2 FLOAT(5,2),<br>f3 DOUBLE,<br>f4 DOUBLE(5,2)<br>);<br><br>DESC test_double1;<br><br>INSERT INTO test_double1<br>VALUES(123.456,123.456,123.4567,123.45);<br><br>#Out of range value for column &#x27;f2&#x27; at row 1<br>INSERT INTO test_double1<br>VALUES(123.456,1234.456,123.4567,123.45); <br><br>SELECT * FROM test_double1;<br></code></pre></td></tr></table></figure></li></ul><h3 id="3-3-ç²¾åº¦è¯¯å·®è¯´æ˜"><a href="#3-3-ç²¾åº¦è¯¯å·®è¯´æ˜" class="headerlink" title="3.3 ç²¾åº¦è¯¯å·®è¯´æ˜"></a>3.3 ç²¾åº¦è¯¯å·®è¯´æ˜</h3><p>æµ®ç‚¹æ•°ç±»å‹æœ‰ä¸ªç¼ºé™·ï¼Œå°±æ˜¯ä¸ç²¾å‡†ã€‚ä¸‹é¢æˆ‘æ¥é‡ç‚¹è§£é‡Šä¸€ä¸‹ä¸ºä»€ä¹ˆ MySQL çš„æµ®ç‚¹æ•°ä¸å¤Ÿç²¾å‡†ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬è®¾è®¡ä¸€ä¸ªè¡¨ï¼Œæœ‰f1è¿™ä¸ªå­—æ®µï¼Œæ’å…¥å€¼åˆ†åˆ«ä¸º0.47,0.44,0.19ï¼Œæˆ‘ä»¬æœŸå¾…çš„è¿è¡Œç»“æœæ˜¯ï¼š0.47 + 0.44 + 0.19 = 1.1ã€‚è€Œä½¿ç”¨sumä¹‹åæŸ¥è¯¢ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE TABLE test_double2(<br>f1 DOUBLE<br>);<br><br>INSERT INTO test_double2<br>VALUES(0.47),(0.44),(0.19);<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT SUM(f1)<br>    -&gt; FROM test_double2;<br>+--------------------+<br>| SUM(f1)            |<br>+--------------------+<br>| 1.0999999999999999 |<br>+--------------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT SUM(f1) = 1.1,1.1 = 1.1<br>    -&gt; FROM test_double2;<br>+---------------+-----------+<br>| SUM(f1) = 1.1 | 1.1 = 1.1 |<br>+---------------+-----------+<br>|             0 |         1 |<br>+---------------+-----------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>æŸ¥è¯¢ç»“æœæ˜¯ 1.0999999999999999ã€‚çœ‹åˆ°äº†å—ï¼Ÿè™½ç„¶è¯¯å·®å¾ˆå°ï¼Œä½†ç¡®å®æœ‰è¯¯å·®ã€‚ ä½ ä¹Ÿå¯ä»¥å°è¯•æŠŠæ•°æ®ç±»å‹æ”¹æˆ FLOATï¼Œç„¶åè¿è¡Œæ±‚å’ŒæŸ¥è¯¢ï¼Œå¾—åˆ°çš„æ˜¯ï¼Œ 1.0999999940395355ã€‚æ˜¾ç„¶ï¼Œè¯¯å·®æ›´å¤§äº†ã€‚</p><p>é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆä¼šå­˜åœ¨è¿™æ ·çš„è¯¯å·®å‘¢ï¼Ÿé—®é¢˜è¿˜æ˜¯å‡ºåœ¨ MySQL å¯¹æµ®ç‚¹ç±»å‹æ•°æ®çš„å­˜å‚¨æ–¹å¼ä¸Šã€‚ </p><p>MySQL ç”¨ 4 ä¸ªå­—èŠ‚å­˜å‚¨ FLOAT ç±»å‹æ•°æ®ï¼Œç”¨ 8 ä¸ªå­—èŠ‚æ¥å­˜å‚¨ DOUBLE ç±»å‹æ•°æ®ã€‚æ— è®ºå“ªä¸ªï¼Œéƒ½æ˜¯é‡‡ç”¨äºŒè¿›åˆ¶çš„æ–¹å¼æ¥è¿›è¡Œå­˜å‚¨çš„ã€‚æ¯”å¦‚ 9.625ï¼Œç”¨äºŒè¿›åˆ¶æ¥è¡¨è¾¾ï¼Œå°±æ˜¯ 1001.101ï¼Œæˆ–è€…è¡¨è¾¾æˆ 1.001101Ã—2^3ã€‚å¦‚æœå°¾æ•°ä¸æ˜¯ 0 æˆ– 5ï¼ˆæ¯”å¦‚ 9.624ï¼‰ï¼Œä½ å°±æ— æ³•ç”¨ä¸€ä¸ªäºŒè¿›åˆ¶æ•°æ¥ç²¾ç¡®è¡¨è¾¾ã€‚è¿›è€Œï¼Œå°±åªå¥½åœ¨å–å€¼å…è®¸çš„èŒƒå›´å†…è¿›è¡Œå››èˆäº”å…¥ã€‚ </p><p>åœ¨ç¼–ç¨‹ä¸­ï¼Œå¦‚æœç”¨åˆ°æµ®ç‚¹æ•°ï¼Œè¦ç‰¹åˆ«æ³¨æ„è¯¯å·®é—®é¢˜ï¼Œ<strong>å› ä¸ºæµ®ç‚¹æ•°æ˜¯ä¸å‡†ç¡®çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦é¿å…ä½¿ç”¨â€œ=â€æ¥åˆ¤æ–­ä¸¤ä¸ªæ•°æ˜¯å¦ç›¸ç­‰ã€‚</strong>åŒæ—¶ï¼Œåœ¨ä¸€äº›å¯¹ç²¾ç¡®åº¦è¦æ±‚è¾ƒé«˜çš„é¡¹ç›®ä¸­ï¼Œåƒä¸‡ä¸è¦ä½¿ç”¨æµ®ç‚¹æ•°ï¼Œä¸ç„¶ä¼šå¯¼è‡´ç»“æœé”™è¯¯ï¼Œç”šè‡³æ˜¯é€ æˆä¸å¯æŒ½å›çš„æŸå¤±ã€‚é‚£ä¹ˆï¼ŒMySQL æœ‰æ²¡æœ‰ç²¾å‡†çš„æ•°æ®ç±»å‹å‘¢ï¼Ÿå½“ç„¶æœ‰ï¼Œè¿™å°±æ˜¯å®šç‚¹æ•°ç±»å‹ï¼š<code>DECIMAL</code>ã€‚</p><h2 id="4-å®šç‚¹æ•°ç±»å‹"><a href="#4-å®šç‚¹æ•°ç±»å‹" class="headerlink" title="4. å®šç‚¹æ•°ç±»å‹"></a>4. å®šç‚¹æ•°ç±»å‹</h2><h3 id="4-1-ç±»å‹ä»‹ç»"><a href="#4-1-ç±»å‹ä»‹ç»" class="headerlink" title="4.1 ç±»å‹ä»‹ç»"></a>4.1 ç±»å‹ä»‹ç»</h3><ul><li><p>MySQLä¸­çš„å®šç‚¹æ•°ç±»å‹åªæœ‰ DECIMAL ä¸€ç§ç±»å‹ã€‚</p><table><thead><tr><th>æ•°æ®ç±»å‹</th><th>å­—èŠ‚æ•°</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>DECIMAL(M,D),DEC,NUMERIC</td><td>M+2å­—èŠ‚</td><td>æœ‰æ•ˆèŒƒå›´ç”±Må’ŒDå†³å®š</td></tr></tbody></table><p>ä½¿ç”¨ DECIMAL(M,D) çš„æ–¹å¼è¡¨ç¤ºé«˜ç²¾åº¦å°æ•°ã€‚å…¶ä¸­ï¼ŒMè¢«ç§°ä¸ºç²¾åº¦ï¼ŒDè¢«ç§°ä¸ºæ ‡åº¦ã€‚0&lt;=M&lt;=65ï¼Œ0&lt;=D&lt;=30ï¼ŒD&lt;Mã€‚ä¾‹å¦‚ï¼Œå®šä¹‰DECIMALï¼ˆ5,2ï¼‰çš„ç±»å‹ï¼Œè¡¨ç¤ºè¯¥åˆ—å–å€¼èŒƒå›´æ˜¯-999.99~999.99ã€‚</p></li><li><p><strong>DECIMAL(M,D)çš„æœ€å¤§å–å€¼èŒƒå›´ä¸DOUBLEç±»å‹ä¸€æ ·</strong>ï¼Œä½†æ˜¯æœ‰æ•ˆçš„æ•°æ®èŒƒå›´æ˜¯ç”±Må’ŒDå†³å®šçš„ã€‚DECIMAL çš„å­˜å‚¨ç©ºé—´å¹¶ä¸æ˜¯å›ºå®šçš„ï¼Œç”±ç²¾åº¦å€¼Må†³å®šï¼Œæ€»å…±å ç”¨çš„å­˜å‚¨ç©ºé—´ä¸ºM+2ä¸ªå­—èŠ‚ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ä¸€äº›å¯¹ç²¾åº¦è¦æ±‚ä¸é«˜çš„åœºæ™¯ä¸‹ï¼Œæ¯”èµ·å ç”¨åŒæ ·å­—èŠ‚é•¿åº¦çš„å®šç‚¹æ•°ï¼Œæµ®ç‚¹æ•°è¡¨è¾¾çš„æ•°å€¼èŒƒå›´å¯ä»¥æ›´å¤§ä¸€äº›ã€‚</p></li><li><p>å®šç‚¹æ•°åœ¨MySQLå†…éƒ¨æ˜¯ä»¥<code>å­—ç¬¦ä¸²</code>çš„å½¢å¼è¿›è¡Œå­˜å‚¨ï¼Œè¿™å°±å†³å®šäº†å®ƒä¸€å®šæ˜¯ç²¾å‡†çš„ã€‚</p></li><li><p>å½“DECIMALç±»å‹ä¸æŒ‡å®šç²¾åº¦å’Œæ ‡åº¦æ—¶ï¼Œå…¶é»˜è®¤ä¸ºDECIMAL(10,0)ã€‚å½“æ•°æ®çš„ç²¾åº¦è¶…å‡ºäº†å®šç‚¹æ•°ç±»å‹çš„ç²¾åº¦èŒƒå›´æ—¶ï¼Œåˆ™MySQLåŒæ ·ä¼šè¿›è¡Œå››èˆäº”å…¥å¤„ç†ï¼ˆå’ŒFLOAT/DOUBLEä¸€æ ·çš„å¤„ç†æ–¹å¼ï¼‰ã€‚</p></li><li><p><strong>æµ®ç‚¹æ•° vs å®šç‚¹æ•°</strong></p><ul><li>æµ®ç‚¹æ•°ç›¸å¯¹äºå®šç‚¹æ•°çš„ä¼˜ç‚¹æ˜¯åœ¨é•¿åº¦ä¸€å®šçš„æƒ…å†µä¸‹ï¼Œæµ®ç‚¹ç±»å‹å–å€¼èŒƒå›´å¤§ï¼Œä½†æ˜¯ä¸ç²¾å‡†ï¼Œé€‚ç”¨äºéœ€è¦å–å€¼èŒƒå›´å¤§ï¼Œåˆå¯ä»¥å®¹å¿å¾®å°è¯¯å·®çš„ç§‘å­¦è®¡ç®—åœºæ™¯ï¼ˆæ¯”å¦‚è®¡ç®—åŒ–å­¦ã€åˆ†å­å»ºæ¨¡ã€æµä½“åŠ¨åŠ›å­¦ç­‰ï¼‰</li><li>å®šç‚¹æ•°ç±»å‹å–å€¼èŒƒå›´ç›¸å¯¹å°ï¼Œä½†æ˜¯ç²¾å‡†ï¼Œæ²¡æœ‰è¯¯å·®ï¼Œé€‚åˆäºå¯¹ç²¾åº¦è¦æ±‚æé«˜çš„åœºæ™¯ ï¼ˆæ¯”å¦‚æ¶‰åŠé‡‘é¢è®¡ç®—çš„åœºæ™¯ï¼‰</li></ul></li><li><p>ä¸¾ä¾‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE TABLE test_decimal1(<br>f1 DECIMAL,<br>f2 DECIMAL(5,2)<br>);<br><br>DESC test_decimal1;<br><br>INSERT INTO test_decimal1(f1,f2)<br>VALUES(123.123,123.456);<br><br>#Out of range value for column &#x27;f2&#x27; at row 1<br>INSERT INTO test_decimal1(f2)<br>VALUES(1234.34);<br><br>#Out of range value for column &#x27;f2&#x27; at row 1<br>INSERT INTO test_decimal1(f2)<br>VALUES(999.995);<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT * FROM test_decimal1;<br>+------+--------+<br>| f1   | f2     |<br>+------+--------+<br>|  123 | 123.46 |<br>+------+--------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure></li><li><p>ä¸¾ä¾‹</p><p>æˆ‘ä»¬è¿è¡Œä¸‹é¢çš„è¯­å¥ï¼ŒæŠŠtest_double2è¡¨ä¸­å­—æ®µâ€œf1â€çš„æ•°æ®ç±»å‹ä¿®æ”¹ä¸º DECIMAL(5,2)ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">ALTER TABLE test_double2<br>MODIFY f1 DECIMAL(5,2);<br></code></pre></td></tr></table></figure><p>ç„¶åï¼Œæˆ‘ä»¬å†ä¸€æ¬¡è¿è¡Œæ±‚å’Œè¯­å¥ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT SUM(f1)<br>    -&gt; FROM test_double2;<br>+---------+<br>| SUM(f1) |<br>+---------+<br>|    1.10 |<br>+---------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT SUM(f1) = 1.1<br>    -&gt; FROM test_double2;<br>+---------------+<br>| SUM(f1) = 1.1 |<br>+---------------+<br>|             1 |<br>+---------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure></li></ul><h3 id="4-2-å¼€å‘ä¸­ç»éªŒ"><a href="#4-2-å¼€å‘ä¸­ç»éªŒ" class="headerlink" title="4.2 å¼€å‘ä¸­ç»éªŒ"></a>4.2 å¼€å‘ä¸­ç»éªŒ</h3><blockquote><p>â€œç”±äº DECIMAL æ•°æ®ç±»å‹çš„ç²¾å‡†æ€§ï¼Œåœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­ï¼Œé™¤äº†æå°‘æ•°ï¼ˆæ¯”å¦‚å•†å“ç¼–å·ï¼‰ç”¨åˆ°æ•´æ•°ç±»å‹å¤–ï¼Œå…¶ä»–çš„æ•°å€¼éƒ½ç”¨çš„æ˜¯ DECIMALï¼ŒåŸå› å°±æ˜¯è¿™ä¸ªé¡¹ç›®æ‰€å¤„çš„é›¶å”®è¡Œä¸šï¼Œè¦æ±‚ç²¾å‡†ï¼Œä¸€åˆ†é’±ä¹Ÿä¸èƒ½å·®ã€‚ â€ â€”â€”æ¥è‡ªæŸé¡¹ç›®ç»ç†</p></blockquote><h2 id="5-ä½ç±»å‹ï¼šBIT"><a href="#5-ä½ç±»å‹ï¼šBIT" class="headerlink" title="5. ä½ç±»å‹ï¼šBIT"></a>5. ä½ç±»å‹ï¼šBIT</h2><p>BITç±»å‹ä¸­å­˜å‚¨çš„æ˜¯äºŒè¿›åˆ¶å€¼ï¼Œç±»ä¼¼010110ã€‚</p><table><thead><tr><th>äºŒè¿›åˆ¶å­—ç¬¦ä¸²ç±»å‹</th><th>é•¿åº¦</th><th>é•¿åº¦èŒƒå›´</th><th>å ç”¨ç©ºé—´</th></tr></thead><tbody><tr><td>BIT(M)</td><td>M</td><td>1 &lt;= M &lt;= 64</td><td>çº¦ä¸º(M + 7)/8ä¸ªå­—èŠ‚</td></tr></tbody></table><p>BITç±»å‹ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®š(M)ï¼Œé»˜è®¤æ˜¯1ä½ã€‚è¿™ä¸ª1ä½ï¼Œè¡¨ç¤ºåªèƒ½å­˜1ä½çš„äºŒè¿›åˆ¶å€¼ã€‚è¿™é‡Œ(M)æ˜¯è¡¨ç¤ºäºŒè¿›åˆ¶çš„ä½æ•°ï¼Œä½æ•°æœ€å°å€¼ä¸º1ï¼Œæœ€å¤§å€¼ä¸º64ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE TABLE test_bit1(<br>f1 BIT,<br>f2 BIT(5),<br>f3 BIT(64)<br>);<br><br>INSERT INTO test_bit1(f1)<br>VALUES(1);<br><br>#Data too long for column &#x27;f1&#x27; at row 1<br>INSERT INTO test_bit1(f1)<br>VALUES(2);<br><br>INSERT INTO test_bit1(f2)<br>VALUES(23);<br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼šåœ¨å‘BITç±»å‹çš„å­—æ®µä¸­æ’å…¥æ•°æ®æ—¶ï¼Œä¸€å®šè¦ç¡®ä¿æ’å…¥çš„æ•°æ®åœ¨BITç±»å‹æ”¯æŒçš„èŒƒå›´å†…ã€‚</p><p>ä½¿ç”¨SELECTå‘½ä»¤æŸ¥è¯¢ä½å­—æ®µæ—¶ï¼Œå¯ä»¥ç”¨<code>BIN()</code>æˆ–<code>HEX()</code>å‡½æ•°è¿›è¡Œè¯»å–ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT * FROM test_bit1;<br>+------------+------------+------------+<br>| f1         | f2         | f3         |<br>+------------+------------+------------+<br>| 0x01       | NULL       | NULL       |<br>| NULL       | 0x17       | NULL       |<br>+------------+------------+------------+<br>2 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT BIN(f2),HEX(f2)<br>    -&gt; FROM test_bit1;<br>+---------+---------+<br>| BIN(f2) | HEX(f2) |<br>+---------+---------+<br>| NULL    | NULL    |<br>| 10111   | 17      |<br>+---------+---------+<br>2 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT f2 + 0<br>    -&gt; FROM test_bit1;<br>+--------+<br>| f2 + 0 |<br>+--------+<br>|   NULL |<br>|     23 |<br>+--------+<br>2 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œä½¿ç”¨b+0æŸ¥è¯¢æ•°æ®æ—¶ï¼Œå¯ä»¥ç›´æ¥æŸ¥è¯¢å‡ºå­˜å‚¨çš„åè¿›åˆ¶æ•°æ®çš„å€¼ã€‚</p><h2 id="6-æ—¥æœŸä¸æ—¶é—´ç±»å‹"><a href="#6-æ—¥æœŸä¸æ—¶é—´ç±»å‹" class="headerlink" title="6. æ—¥æœŸä¸æ—¶é—´ç±»å‹"></a>6. æ—¥æœŸä¸æ—¶é—´ç±»å‹</h2><p>æ—¥æœŸä¸æ—¶é—´æ˜¯é‡è¦çš„ä¿¡æ¯ï¼Œåœ¨æˆ‘ä»¬çš„ç³»ç»Ÿä¸­ï¼Œå‡ ä¹æ‰€æœ‰çš„æ•°æ®è¡¨éƒ½ç”¨å¾—åˆ°ã€‚åŸå› æ˜¯å®¢æˆ·éœ€è¦çŸ¥é“æ•°æ®çš„æ—¶é—´æ ‡ç­¾ï¼Œä»è€Œè¿›è¡Œæ•°æ®æŸ¥è¯¢ã€ç»Ÿè®¡å’Œå¤„ç†ã€‚ </p><p>MySQLæœ‰å¤šç§è¡¨ç¤ºæ—¥æœŸå’Œæ—¶é—´çš„æ•°æ®ç±»å‹ï¼Œä¸åŒçš„ç‰ˆæœ¬å¯èƒ½æœ‰æ‰€å·®å¼‚ï¼ŒMySQL8.0ç‰ˆæœ¬æ”¯æŒçš„æ—¥æœŸå’Œæ—¶é—´ç±»å‹ä¸»è¦æœ‰ï¼šYEARç±»å‹ã€TIMEç±»å‹ã€DATEç±»å‹ã€DATETIMEç±»å‹å’ŒTIMESTAMPç±»å‹ã€‚</p><ul><li><code>YEAR</code>ç±»å‹é€šå¸¸ç”¨æ¥è¡¨ç¤ºå¹´</li><li><code>DATE</code>ç±»å‹é€šå¸¸ç”¨æ¥è¡¨ç¤ºå¹´ã€æœˆã€æ—¥</li><li><code>TIME</code>ç±»å‹é€šå¸¸ç”¨æ¥è¡¨ç¤ºæ—¶ã€åˆ†ã€ç§’</li><li><code>DATETIME</code>ç±»å‹é€šå¸¸ç”¨æ¥è¡¨ç¤ºå¹´ã€æœˆã€æ—¥ã€æ—¶ã€åˆ†ã€ç§’</li><li><code>TIMESTAMP</code>ç±»å‹é€šå¸¸ç”¨æ¥è¡¨ç¤ºå¸¦æ—¶åŒºçš„å¹´ã€æœˆã€æ—¥ã€æ—¶ã€åˆ†ã€ç§’</li></ul><table><thead><tr><th>ç±»å‹</th><th>åç§°</th><th>å­—èŠ‚</th><th>æ—¥æœŸæ ¼å¼</th><th>æœ€å°å€¼</th><th>æœ€å¤§å€¼</th></tr></thead><tbody><tr><td>YEAR</td><td>å¹´</td><td>1</td><td>YYYYæˆ–YY</td><td>1901</td><td>2155</td></tr><tr><td>TIME</td><td>æ—¶é—´</td><td>3</td><td>HH:MM:SS</td><td>-838:59:59</td><td>838:59:59</td></tr><tr><td>DATE</td><td>æ—¥æœŸ</td><td>3</td><td>YYYY-MM-DD</td><td>1000-01-01</td><td>9999-12-03</td></tr><tr><td>DATETIME</td><td>æ—¥æœŸæ—¶é—´</td><td>8</td><td>YYYY-MM-DD HH:MM:SS</td><td>1000-01-01 00:00:00</td><td>9999-12-31 23:59:59</td></tr><tr><td>TIMESTAMP</td><td>æ—¥æœŸæ—¶é—´</td><td>4</td><td>YYYY-MM-DD HH:MM:SS</td><td>1970-01-01 00:00:00 UTC</td><td>2038-01-19 03:14:07UTC</td></tr></tbody></table><p>å¯ä»¥çœ‹åˆ°ï¼Œä¸åŒæ•°æ®ç±»å‹è¡¨ç¤ºçš„æ—¶é—´å†…å®¹ä¸åŒã€å–å€¼èŒƒå›´ä¸åŒï¼Œè€Œä¸”å ç”¨çš„å­—èŠ‚æ•°ä¹Ÿä¸ä¸€æ ·ï¼Œä½ è¦æ ¹æ®å®é™…éœ€è¦çµæ´»é€‰å–ã€‚</p><p>ä¸ºä»€ä¹ˆæ—¶é—´ç±»å‹ TIME çš„å–å€¼èŒƒå›´ä¸æ˜¯ -23:59:59ï½23:59:59 å‘¢ï¼ŸåŸå› æ˜¯ MySQL è®¾è®¡çš„ TIME ç±»å‹ï¼Œä¸å…‰è¡¨ç¤ºä¸€å¤©ä¹‹å†…çš„æ—¶é—´ï¼Œè€Œä¸”å¯ä»¥ç”¨æ¥è¡¨ç¤ºä¸€ä¸ªæ—¶é—´é—´éš”ï¼Œè¿™ä¸ªæ—¶é—´é—´éš”å¯ä»¥è¶…è¿‡ 24 å°æ—¶ã€‚</p><h3 id="6-1-YEARç±»å‹"><a href="#6-1-YEARç±»å‹" class="headerlink" title="6.1 YEARç±»å‹"></a>6.1 YEARç±»å‹</h3><p>YEARç±»å‹ç”¨æ¥è¡¨ç¤ºå¹´ä»½ï¼Œåœ¨æ‰€æœ‰çš„æ—¥æœŸæ—¶é—´ç±»å‹ä¸­æ‰€å ç”¨çš„å­˜å‚¨ç©ºé—´æœ€å°ï¼Œåªéœ€è¦<code>1ä¸ªå­—èŠ‚</code>çš„å­˜å‚¨ç©ºé—´ã€‚</p><p>åœ¨MySQLä¸­ï¼ŒYEARæœ‰ä»¥ä¸‹å‡ ç§å­˜å‚¨æ ¼å¼ï¼š</p><ul><li>ä»¥4ä½å­—ç¬¦ä¸²æˆ–æ•°å­—æ ¼å¼è¡¨ç¤ºYEARç±»å‹ï¼Œå…¶æ ¼å¼ä¸ºYYYYï¼Œæœ€å°å€¼ä¸º1901ï¼Œæœ€å¤§å€¼ä¸º2155ã€‚</li><li>ä»¥2ä½å­—ç¬¦ä¸²æ ¼å¼è¡¨ç¤ºYEARç±»å‹ï¼Œæœ€å°å€¼ä¸º00ï¼Œæœ€å¤§å€¼ä¸º99ã€‚<ul><li>å½“å–å€¼ä¸º01åˆ°69æ—¶ï¼Œè¡¨ç¤º2001åˆ°2069ï¼›</li><li>å½“å–å€¼ä¸º70åˆ°99æ—¶ï¼Œè¡¨ç¤º1970åˆ°1999ï¼›</li><li>å½“å–å€¼æ•´æ•°çš„0æˆ–00æ·»åŠ çš„è¯ï¼Œé‚£ä¹ˆæ˜¯0000å¹´ï¼›</li><li>å½“å–å€¼æ˜¯æ—¥æœŸ/å­—ç¬¦ä¸²çš„â€™0â€™æ·»åŠ çš„è¯ï¼Œæ˜¯2000å¹´ã€‚</li></ul></li></ul><p><strong>ä»MySQL5.5.27å¼€å§‹ï¼Œ2ä½æ ¼å¼çš„YEARå·²ç»ä¸æ¨èä½¿ç”¨</strong>ã€‚YEARé»˜è®¤æ ¼å¼å°±æ˜¯â€œYYYYâ€ï¼Œæ²¡å¿…è¦å†™æˆYEAR(4)ï¼Œä»MySQL 8.0.19å¼€å§‹ï¼Œä¸æ¨èä½¿ç”¨æŒ‡å®šæ˜¾ç¤ºå®½åº¦çš„YEAR(4)æ•°æ®ç±»å‹ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE TABLE test_year(<br>f1 YEAR,<br>f2 YEAR(4)<br>);<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; DESC test_year;<br>+-------+---------+------+-----+---------+-------+<br>| Field | Type    | Null | Key | Default | Extra |<br>+-------+---------+------+-----+---------+-------+<br>| f1    | year(4) | YES  |     | NULL    |       |<br>| f2    | year(4) | YES  |     | NULL    |       |<br>+-------+---------+------+-----+---------+-------+<br>2 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs mysql">INSERT INTO test_year<br>VALUES(&#x27;2020&#x27;,2021);<br><br>mysql&gt; SELECT * FROM test_year;<br>+------+------+<br>| f1   | f2   |<br>+------+------+<br>| 2020 | 2021 |<br>+------+------+<br>1 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs mysql">INSERT INTO test_year<br>VALUES(&#x27;45&#x27;,&#x27;71&#x27;);<br><br>INSERT INTO test_year<br>VALUES(0,&#x27;0&#x27;);<br><br>mysql&gt; SELECT * FROM test_year;<br>+------+------+<br>| f1   | f2   |<br>+------+------+<br>| 2020 | 2021 |<br>| 2045 | 1971 |<br>| 0000 | 2000 |<br>+------+------+<br>3 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><h3 id="6-2-DATEç±»å‹"><a href="#6-2-DATEç±»å‹" class="headerlink" title="6.2 DATEç±»å‹"></a>6.2 DATEç±»å‹</h3><p>DATEç±»å‹è¡¨ç¤ºæ—¥æœŸï¼Œæ²¡æœ‰æ—¶é—´éƒ¨åˆ†ï¼Œæ ¼å¼ä¸º<code>YYYY-MM-DD</code>ï¼Œå…¶ä¸­ï¼ŒYYYYè¡¨ç¤ºå¹´ä»½ï¼ŒMMè¡¨ç¤ºæœˆä»½ï¼ŒDDè¡¨ç¤ºæ—¥æœŸã€‚éœ€è¦<code>3ä¸ªå­—èŠ‚</code>çš„å­˜å‚¨ç©ºé—´ã€‚åœ¨å‘DATEç±»å‹çš„å­—æ®µæ’å…¥æ•°æ®æ—¶ï¼ŒåŒæ ·éœ€è¦æ»¡è¶³ä¸€å®šçš„æ ¼å¼æ¡ä»¶ã€‚</p><ul><li>ä»¥<code>YYYY-MM-DD</code>æ ¼å¼æˆ–è€…<code>YYYYMMDD</code>æ ¼å¼è¡¨ç¤ºçš„å­—ç¬¦ä¸²æ—¥æœŸï¼Œå…¶æœ€å°å–å€¼ä¸º1000-01-01ï¼Œæœ€å¤§å–å€¼ä¸º9999-12-03ã€‚YYYYMMDDæ ¼å¼ä¼šè¢«è½¬åŒ–ä¸ºYYYY-MM-DDæ ¼å¼ã€‚<code>æ¨èå†™æ³•</code></li><li>ä»¥<code>YY-MM-DD</code>æ ¼å¼æˆ–è€…<code>YYMMDD</code>æ ¼å¼è¡¨ç¤ºçš„å­—ç¬¦ä¸²æ—¥æœŸï¼Œæ­¤æ ¼å¼ä¸­ï¼Œå¹´ä»½ä¸ºä¸¤ä½æ•°å€¼æˆ–å­—ç¬¦ä¸²æ»¡è¶³YEARç±»å‹çš„æ ¼å¼æ¡ä»¶ä¸ºï¼šå½“å¹´ä»½å–å€¼ä¸º00åˆ°69æ—¶ï¼Œä¼šè¢«è½¬åŒ–ä¸º2000åˆ°2069ï¼›å½“å¹´ä»½å–å€¼ä¸º70åˆ°99æ—¶ï¼Œä¼šè¢«è½¬åŒ–ä¸º1970åˆ°1999ã€‚<code>ä¸æ¨èå†™æ³•</code></li><li>ä½¿ç”¨<code>CURRENT_DATE()</code>æˆ–è€…<code>NOW()</code>å‡½æ•°ï¼Œä¼šæ’å…¥å½“å‰ç³»ç»Ÿçš„æ—¥æœŸã€‚</li></ul><p><strong>ä¸¾ä¾‹ï¼š</strong></p><p>åˆ›å»ºæ•°æ®è¡¨ï¼Œè¡¨ä¸­åªåŒ…å«ä¸€ä¸ªDATEç±»å‹çš„å­—æ®µf1ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE TABLE test_date1(<br>f1 DATE<br>);<br>Query OK, 0 rows affected (0.13 sec)<br></code></pre></td></tr></table></figure><p>æ’å…¥æ•°æ®ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs mysql">INSERT INTO test_date1<br>VALUES (&#x27;2020-10-01&#x27;), (&#x27;20201001&#x27;),(20201001);<br><br>INSERT INTO test_date1<br>VALUES (&#x27;00-01-01&#x27;), (&#x27;000101&#x27;), (&#x27;69-10-01&#x27;), (&#x27;691001&#x27;), (&#x27;70-01-01&#x27;), (&#x27;700101&#x27;), (&#x27;99-01-01&#x27;), (&#x27;990101&#x27;);<br><br>INSERT INTO test_date1<br>VALUES (000301), (690301), (700301), (990301); <br><br>INSERT INTO test_date1<br>VALUES (CURRENT_DATE()), (NOW());<br><br>SELECT *<br>FROM test_date1;<br></code></pre></td></tr></table></figure><h3 id="6-3-TIMEç±»å‹"><a href="#6-3-TIMEç±»å‹" class="headerlink" title="6.3 TIMEç±»å‹"></a>6.3 TIMEç±»å‹</h3><p>TIMEç±»å‹ç”¨æ¥è¡¨ç¤ºæ—¶é—´ï¼Œä¸åŒ…å«æ—¥æœŸéƒ¨åˆ†ã€‚åœ¨MySQLä¸­ï¼Œéœ€è¦<code>3ä¸ªå­—èŠ‚</code>çš„å­˜å‚¨ç©ºé—´æ¥å­˜å‚¨TIMEç±»å‹çš„æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨â€œHH:MM:SSâ€æ ¼å¼æ¥è¡¨ç¤ºTIMEç±»å‹ï¼Œå…¶ä¸­ï¼ŒHHè¡¨ç¤ºå°æ—¶ï¼ŒMMè¡¨ç¤ºåˆ†é’Ÿï¼ŒSSè¡¨ç¤ºç§’ã€‚</p><p>åœ¨MySQLä¸­ï¼Œå‘TIMEç±»å‹çš„å­—æ®µæ’å…¥æ•°æ®æ—¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å‡ ç§ä¸åŒçš„æ ¼å¼ã€‚<br>ï¼ˆ1ï¼‰å¯ä»¥ä½¿ç”¨å¸¦æœ‰å†’å·çš„å­—ç¬¦ä¸²ï¼Œæ¯”å¦‚â€™<code>D HH:MM:SS&#39;</code>ã€â€™<code>HH:MM:SS</code>â€˜ã€â€™<code>HH:MM</code>â€˜ã€â€™<code>D HH:MM</code>â€˜ã€â€™<code>D HH</code>â€˜æˆ–â€™<code>SS</code>â€˜æ ¼å¼ï¼Œéƒ½èƒ½è¢«æ­£ç¡®åœ°æ’å…¥TIMEç±»å‹çš„å­—æ®µä¸­ã€‚å…¶ä¸­Dè¡¨ç¤ºå¤©ï¼Œå…¶æœ€å°å€¼ä¸º0ï¼Œæœ€å¤§å€¼ä¸º34ã€‚å¦‚æœä½¿ç”¨å¸¦æœ‰Dæ ¼å¼çš„å­—ç¬¦ä¸²æ’å…¥TIMEç±»å‹çš„å­—æ®µæ—¶ï¼ŒDä¼šè¢«è½¬åŒ–ä¸ºå°æ—¶ï¼Œè®¡ç®—æ ¼å¼ä¸ºD*24+HHã€‚å½“ä½¿ç”¨å¸¦æœ‰å†’å·å¹¶ä¸”ä¸å¸¦Dçš„å­—ç¬¦ä¸²è¡¨ç¤ºæ—¶é—´æ—¶ï¼Œè¡¨ç¤ºå½“å¤©çš„æ—¶é—´ï¼Œæ¯”å¦‚12:10è¡¨ç¤º12:10:00ï¼Œè€Œä¸æ˜¯00:12:10ã€‚<br>ï¼ˆ2ï¼‰å¯ä»¥ä½¿ç”¨ä¸å¸¦æœ‰å†’å·çš„å­—ç¬¦ä¸²æˆ–è€…æ•°å­—ï¼Œæ ¼å¼ä¸ºâ€™<code>HHMMSS</code>â€˜æˆ–è€…<code>HHMMSS</code>ã€‚å¦‚æœæ’å…¥ä¸€ä¸ªä¸åˆæ³•çš„å­—ç¬¦ä¸²æˆ–è€…æ•°å­—ï¼ŒMySQLåœ¨å­˜å‚¨æ•°æ®æ—¶ï¼Œä¼šå°†å…¶è‡ªåŠ¨è½¬åŒ–ä¸º00:00:00è¿›è¡Œå­˜å‚¨ã€‚æ¯”å¦‚1210ï¼ŒMySQLä¼šå°†æœ€å³è¾¹çš„ä¸¤ä½è§£ææˆç§’ï¼Œè¡¨ç¤º00:12:10ï¼Œè€Œä¸æ˜¯12:10:00ã€‚<br>ï¼ˆ3ï¼‰ä½¿ç”¨<code>CURRENT_TIME()</code>æˆ–è€…<code>NOW()</code>ï¼Œä¼šæ’å…¥å½“å‰ç³»ç»Ÿçš„æ—¶é—´ã€‚</p><p><strong>ä¸¾ä¾‹ï¼š</strong></p><p>åˆ›å»ºæ•°æ®è¡¨ï¼Œè¡¨ä¸­åŒ…å«ä¸€ä¸ªTIMEç±»å‹çš„å­—æ®µf1ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE TABLE test_time1(<br>f1 TIME<br>);<br>Query OK, 0 rows affected (0.02 sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs mysql">INSERT INTO test_time1<br>VALUES(&#x27;2 12:30:29&#x27;), (&#x27;12:35:29&#x27;), (&#x27;12:40&#x27;), (&#x27;2 12:40&#x27;),(&#x27;1 05&#x27;), (&#x27;45&#x27;);<br><br>INSERT INTO test_time1<br>VALUES (&#x27;123520&#x27;), (124011),(1210);<br><br>INSERT INTO test_time1<br>VALUES (NOW()), (CURRENT_TIME());<br><br>SELECT * FROM test_time1;<br></code></pre></td></tr></table></figure><h3 id="6-4-DATETIMEç±»å‹"><a href="#6-4-DATETIMEç±»å‹" class="headerlink" title="6.4 DATETIMEç±»å‹"></a>6.4 DATETIMEç±»å‹</h3><p>DATETIMEç±»å‹åœ¨æ‰€æœ‰çš„æ—¥æœŸæ—¶é—´ç±»å‹ä¸­å ç”¨çš„å­˜å‚¨ç©ºé—´æœ€å¤§ï¼Œæ€»å…±éœ€è¦<code>8</code>ä¸ªå­—èŠ‚çš„å­˜å‚¨ç©ºé—´ã€‚åœ¨æ ¼å¼ä¸Šä¸ºDATEç±»å‹å’ŒTIMEç±»å‹çš„ç»„åˆï¼Œå¯ä»¥è¡¨ç¤ºä¸º<code>YYYY-MM-DD HH:MM:SS</code>ï¼Œå…¶ä¸­YYYYè¡¨ç¤ºå¹´ä»½ï¼ŒMMè¡¨ç¤ºæœˆä»½ï¼ŒDDè¡¨ç¤ºæ—¥æœŸï¼ŒHHè¡¨ç¤ºå°æ—¶ï¼ŒMMè¡¨ç¤ºåˆ†é’Ÿï¼ŒSSè¡¨ç¤ºç§’ã€‚</p><p>åœ¨å‘DATETIMEç±»å‹çš„å­—æ®µæ’å…¥æ•°æ®æ—¶ï¼ŒåŒæ ·éœ€è¦æ»¡è¶³ä¸€å®šçš„æ ¼å¼æ¡ä»¶ã€‚</p><ul><li>ä»¥<code>YYYY-MM-DD HH:MM:SS</code>æ ¼å¼æˆ–è€…<code>YYYYMMDDHHMMSS</code>æ ¼å¼çš„å­—ç¬¦ä¸²æ’å…¥DATETIMEç±»å‹çš„å­—æ®µæ—¶ï¼Œæœ€å°å€¼ä¸º1000-01-01 00:00:00ï¼Œæœ€å¤§å€¼ä¸º9999-12-03 23:59:59ã€‚<ul><li>ä»¥YYYYMMDDHHMMSSæ ¼å¼çš„æ•°å­—æ’å…¥DATETIMEç±»å‹çš„å­—æ®µæ—¶ï¼Œä¼šè¢«è½¬åŒ–ä¸ºYYYY-MM-DD HH:MM:SSæ ¼å¼ã€‚</li></ul></li><li>ä»¥<code>YY-MM-DD HH:MM:SS</code>æ ¼å¼æˆ–è€…<code>YYMMDDHHMMSS</code>æ ¼å¼çš„å­—ç¬¦ä¸²æ’å…¥DATETIMEç±»å‹çš„å­—æ®µæ—¶ï¼Œä¸¤ä½æ•°çš„å¹´ä»½è§„åˆ™ç¬¦åˆYEARç±»å‹çš„è§„åˆ™ï¼Œ00åˆ°69è¡¨ç¤º2000åˆ°2069ï¼›70åˆ°99è¡¨ç¤º1970åˆ°1999ã€‚</li><li>ä½¿ç”¨å‡½æ•°<code>CURRENT_TIMESTAMP()</code>å’Œ<code>NOW()</code>ï¼Œå¯ä»¥å‘DATETIMEç±»å‹çš„å­—æ®µæ’å…¥ç³»ç»Ÿçš„å½“å‰æ—¥æœŸå’Œæ—¶é—´ã€‚</li></ul><p><strong>ä¸¾ä¾‹ï¼š</strong></p><p>åˆ›å»ºæ•°æ®è¡¨ï¼Œè¡¨ä¸­åŒ…å«ä¸€ä¸ªDATETIMEç±»å‹çš„å­—æ®µdtã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE TABLE test_datetime1(<br>dt DATETIME<br>);<br>Query OK, 0 rows affected (0.02 sec)<br></code></pre></td></tr></table></figure><p>æ’å…¥æ•°æ®ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs mysql">INSERT INTO test_datetime1<br>VALUES (&#x27;2021-01-01 06:50:30&#x27;), (&#x27;20210101065030&#x27;);<br><br>INSERT INTO test_datetime1<br>VALUES (&#x27;99-01-01 00:00:00&#x27;), (&#x27;990101000000&#x27;), (&#x27;20-01-01 00:00:00&#x27;), (&#x27;200101000000&#x27;);<br><br>INSERT INTO test_datetime1<br>VALUES (20200101000000), (200101000000), (19990101000000), (990101000000);<br> <br>INSERT INTO test_datetime1<br>VALUES (CURRENT_TIMESTAMP()), (NOW());<br></code></pre></td></tr></table></figure><h3 id="6-5-TIMESTAMPç±»å‹"><a href="#6-5-TIMESTAMPç±»å‹" class="headerlink" title="6.5 TIMESTAMPç±»å‹"></a>6.5 TIMESTAMPç±»å‹</h3><p>TIMESTAMPç±»å‹ä¹Ÿå¯ä»¥è¡¨ç¤ºæ—¥æœŸæ—¶é—´ï¼Œå…¶æ˜¾ç¤ºæ ¼å¼ä¸DATETIMEç±»å‹ç›¸åŒï¼Œéƒ½æ˜¯<code>YYYY-MM-DD HH:MM:SS</code>ï¼Œéœ€è¦4ä¸ªå­—èŠ‚çš„å­˜å‚¨ç©ºé—´ã€‚ä½†æ˜¯TIMESTAMPå­˜å‚¨çš„æ—¶é—´èŒƒå›´æ¯”DATETIMEè¦å°å¾ˆå¤šï¼Œåªèƒ½å­˜å‚¨â€œ1970-01-01 00:00:01 UTCâ€åˆ°â€œ2038-01-19 03:14:07 UTCâ€ä¹‹é—´çš„æ—¶é—´ã€‚å…¶ä¸­ï¼ŒUTCè¡¨ç¤ºä¸–ç•Œç»Ÿä¸€æ—¶é—´ï¼Œä¹Ÿå«ä½œä¸–ç•Œæ ‡å‡†æ—¶é—´ã€‚</p><ul><li><strong>å­˜å‚¨æ•°æ®çš„æ—¶å€™éœ€è¦å¯¹å½“å‰æ—¶é—´æ‰€åœ¨çš„æ—¶åŒºè¿›è¡Œè½¬æ¢ï¼ŒæŸ¥è¯¢æ•°æ®çš„æ—¶å€™å†å°†æ—¶é—´è½¬æ¢å›å½“å‰çš„æ—¶åŒºã€‚å› æ­¤ï¼Œä½¿ç”¨TIMESTAMPå­˜å‚¨çš„åŒä¸€ä¸ªæ—¶é—´å€¼ï¼Œåœ¨ä¸åŒçš„æ—¶åŒºæŸ¥è¯¢æ—¶ä¼šæ˜¾ç¤ºä¸åŒçš„æ—¶é—´ã€‚</strong></li></ul><p>å‘TIMESTAMPç±»å‹çš„å­—æ®µæ’å…¥æ•°æ®æ—¶ï¼Œå½“æ’å…¥çš„æ•°æ®æ ¼å¼æ»¡è¶³YY-MM-DD HH:MM:SSå’ŒYYMMDDHHMMSSæ—¶ï¼Œä¸¤ä½æ•°å€¼çš„å¹´ä»½åŒæ ·ç¬¦åˆYEARç±»å‹çš„è§„åˆ™æ¡ä»¶ï¼Œåªä¸è¿‡è¡¨ç¤ºçš„æ—¶é—´èŒƒå›´è¦å°å¾ˆå¤šã€‚</p><p>å¦‚æœå‘TIMESTAMPç±»å‹çš„å­—æ®µæ’å…¥çš„æ—¶é—´è¶…å‡ºäº†TIMESTAMPç±»å‹çš„èŒƒå›´ï¼Œåˆ™MySQLä¼šæŠ›å‡ºé”™è¯¯ä¿¡æ¯ã€‚</p><p><strong>ä¸¾ä¾‹ï¼š</strong></p><p>åˆ›å»ºæ•°æ®è¡¨ï¼Œè¡¨ä¸­åŒ…å«ä¸€ä¸ªTIMESTAMPç±»å‹çš„å­—æ®µtsã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE TABLE test_timestamp1(<br>ts TIMESTAMP<br>);<br></code></pre></td></tr></table></figure><p>æ’å…¥æ•°æ®ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs mysql">INSERT INTO test_timestamp1<br>VALUES (&#x27;1999-01-01 03:04:50&#x27;), (&#x27;19990101030405&#x27;), (&#x27;99-01-01 03:04:05&#x27;), (&#x27;990101030405&#x27;);<br><br>INSERT INTO test_timestamp1<br>VALUES (&#x27;2020@01@01@00@00@00&#x27;), (&#x27;20@01@01@00@00@00&#x27;);<br><br>INSERT INTO test_timestamp1<br>VALUES (CURRENT_TIMESTAMP()), (NOW());<br><br>#Incorrect datetime value<br>INSERT INTO test_timestamp1<br>VALUES (&#x27;2038-01-20 03:14:07&#x27;);<br></code></pre></td></tr></table></figure><p><strong>TIMESTAMPå’ŒDATETIMEçš„åŒºåˆ«ï¼š</strong></p><ul><li><p>TIMESTAMPå­˜å‚¨ç©ºé—´æ¯”è¾ƒå°ï¼Œè¡¨ç¤ºçš„æ—¥æœŸæ—¶é—´èŒƒå›´ä¹Ÿæ¯”è¾ƒå°</p></li><li><p>åº•å±‚å­˜å‚¨æ–¹å¼ä¸åŒï¼ŒTIMESTAMPåº•å±‚å­˜å‚¨çš„æ˜¯æ¯«ç§’å€¼ï¼Œè·ç¦»ä¸–ç•Œæ ‡å‡†æ—¶é—´ï¼ˆè‹±å›½æ—¶åŒºï¼‰1970-1-1 0:0:0 0æ¯«ç§’çš„æ¯«ç§’å€¼ã€‚</p></li><li><p>ä¸¤ä¸ªæ—¥æœŸæ¯”è¾ƒå¤§å°æˆ–æ—¥æœŸè®¡ç®—æ—¶ï¼ŒTIMESTAMPæ›´æ–¹ä¾¿ã€æ›´å¿«ã€‚</p></li><li><p>TIMESTAMPå’Œæ—¶åŒºæœ‰å…³ã€‚TIMESTAMPä¼šæ ¹æ®ç”¨æˆ·çš„æ—¶åŒºä¸åŒï¼Œæ˜¾ç¤ºä¸åŒçš„ç»“æœã€‚è€ŒDATETIMEåˆ™åªèƒ½åæ˜ å‡ºæ’å…¥æ—¶å½“åœ°çš„æ—¶åŒºï¼Œå…¶ä»–æ—¶åŒºçš„äººæŸ¥çœ‹æ•°æ®å¿…ç„¶ä¼šæœ‰è¯¯å·®çš„ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE TABLE temp_time(<br>d1 DATETIME,<br>d2 TIMESTAMP<br>);<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">INSERT INTO temp_time VALUES(&#x27;2021-9-2 14:45:52&#x27;,&#x27;2021-9-2 14:45:52&#x27;);<br><br>INSERT INTO temp_time VALUES(NOW(),NOW());<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT * FROM temp_time;<br>+---------------------+---------------------+<br>| d1                  | d2                  |<br>+---------------------+---------------------+<br>| 2021-09-02 14:45:52 | 2021-09-02 14:45:52 |<br>| 2021-11-03 17:38:17 | 2021-11-03 17:38:17 |<br>+---------------------+---------------------+<br>2 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#ä¿®æ”¹å½“å‰çš„æ—¶åŒº<br>SET time_zone = &#x27;+9:00&#x27;;<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT * FROM temp_time;<br>+---------------------+---------------------+<br>| d1                  | d2                  |<br>+---------------------+---------------------+<br>| 2021-09-02 14:45:52 | 2021-09-02 15:45:52 |<br>| 2021-11-03 17:38:17 | 2021-11-03 18:38:17 |<br>+---------------------+---------------------+<br>2 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure></li></ul><h3 id="6-6-å¼€å‘ä¸­ç»éªŒ"><a href="#6-6-å¼€å‘ä¸­ç»éªŒ" class="headerlink" title="6.6 å¼€å‘ä¸­ç»éªŒ"></a>6.6 å¼€å‘ä¸­ç»éªŒ</h3><p>ç”¨å¾—æœ€å¤šçš„æ—¥æœŸæ—¶é—´ç±»å‹ï¼Œå°±æ˜¯ <code>DATETIME</code>ã€‚è™½ç„¶ MySQL ä¹Ÿæ”¯æŒ YEARï¼ˆå¹´ï¼‰ã€ TIMEï¼ˆæ—¶é—´ï¼‰ã€DATEï¼ˆæ—¥æœŸï¼‰ï¼Œä»¥åŠ TIMESTAMP ç±»å‹ï¼Œä½†æ˜¯åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œå°½é‡ç”¨ DATETIME ç±»å‹ã€‚å› ä¸ºè¿™ä¸ªæ•°æ®ç±»å‹åŒ…æ‹¬äº†å®Œæ•´çš„æ—¥æœŸå’Œæ—¶é—´ä¿¡æ¯ï¼Œå–å€¼èŒƒå›´ä¹Ÿæœ€å¤§ï¼Œä½¿ç”¨èµ·æ¥æ¯”è¾ƒæ–¹ä¾¿ã€‚æ¯•ç«Ÿï¼Œå¦‚æœæ—¥æœŸæ—¶é—´ä¿¡æ¯åˆ†æ•£åœ¨å¥½å‡ ä¸ªå­—æ®µï¼Œå¾ˆä¸å®¹æ˜“è®°ï¼Œè€Œä¸”æŸ¥è¯¢çš„æ—¶å€™ï¼ŒSQL è¯­å¥ä¹Ÿä¼šæ›´åŠ å¤æ‚ã€‚ </p><p>æ­¤å¤–ï¼Œä¸€èˆ¬å­˜æ³¨å†Œæ—¶é—´ã€å•†å“å‘å¸ƒæ—¶é—´ç­‰ï¼Œä¸å»ºè®®ä½¿ç”¨DATETIMEå­˜å‚¨ï¼Œè€Œæ˜¯ä½¿ç”¨<code>æ—¶é—´æˆ³</code>ï¼Œå› ä¸ºDATETIMEè™½ç„¶ç›´è§‚ï¼Œä½†ä¸ä¾¿äºè®¡ç®—ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT UNIX_TIMESTAMP();<br>+------------------+<br>| UNIX_TIMESTAMP() |<br>+------------------+<br>|       1635932762 |<br>+------------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><h2 id="7-æ–‡æœ¬å­—ç¬¦ä¸²ç±»å‹"><a href="#7-æ–‡æœ¬å­—ç¬¦ä¸²ç±»å‹" class="headerlink" title="7. æ–‡æœ¬å­—ç¬¦ä¸²ç±»å‹"></a>7. æ–‡æœ¬å­—ç¬¦ä¸²ç±»å‹</h2><p>åœ¨å®é™…çš„é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬è¿˜ç»å¸¸é‡åˆ°ä¸€ç§æ•°æ®ï¼Œå°±æ˜¯å­—ç¬¦ä¸²æ•°æ®ã€‚</p><p>MySQLä¸­ï¼Œæ–‡æœ¬å­—ç¬¦ä¸²æ€»ä½“ä¸Šåˆ†ä¸º<code>CHAR</code>ã€<code>VARCHAR</code>ã€<code>TINYTEXT</code>ã€<code>TEXT</code>ã€<code>MEDIUMTEXT</code>ã€<code>LONGTEXT</code>ã€<code>ENUM</code>ã€<code>SET</code>ç­‰ç±»å‹ã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211012003508730.png"></p><h3 id="7-1-CHARä¸VARCHARç±»å‹"><a href="#7-1-CHARä¸VARCHARç±»å‹" class="headerlink" title="7.1 CHARä¸VARCHARç±»å‹"></a>7.1 CHARä¸VARCHARç±»å‹</h3><p>CHARå’ŒVARCHARç±»å‹éƒ½å¯ä»¥å­˜å‚¨æ¯”è¾ƒçŸ­çš„å­—ç¬¦ä¸²ã€‚</p><table><thead><tr><th>å­—ç¬¦ä¸²(æ–‡æœ¬)ç±»å‹</th><th>ç‰¹ç‚¹</th><th>é•¿åº¦</th><th>é•¿åº¦èŒƒå›´</th><th>å ç”¨çš„å­˜å‚¨ç©ºé—´</th></tr></thead><tbody><tr><td>CHAR(M)</td><td>å›ºå®šé•¿åº¦</td><td>M</td><td>0 &lt;= M &lt;= 255</td><td>M * 3 ä¸ªå­—èŠ‚</td></tr><tr><td>VARCHAR(M)</td><td>å¯å˜é•¿åº¦</td><td>M</td><td>0 &lt;= M &lt;= 21845</td><td>(å®é™…é•¿åº¦ + 1)  * 3 ä¸ªå­—èŠ‚</td></tr></tbody></table><p><strong>CHARç±»å‹ï¼š</strong></p><ul><li>CHAR(M) ç±»å‹ä¸€èˆ¬éœ€è¦é¢„å…ˆå®šä¹‰å­—ç¬¦ä¸²é•¿åº¦ã€‚å¦‚æœä¸æŒ‡å®š(M)ï¼Œåˆ™è¡¨ç¤ºé•¿åº¦é»˜è®¤æ˜¯1ä¸ªå­—ç¬¦ã€‚</li><li>å¦‚æœä¿å­˜æ—¶ï¼Œæ•°æ®çš„å®é™…é•¿åº¦æ¯”CHARç±»å‹å£°æ˜çš„é•¿åº¦å°ï¼Œåˆ™ä¼šåœ¨<code>å³ä¾§å¡«å……</code>ç©ºæ ¼ä»¥è¾¾åˆ°æŒ‡å®šçš„é•¿åº¦ã€‚å½“MySQLæ£€ç´¢CHARç±»å‹çš„æ•°æ®æ—¶ï¼ŒCHARç±»å‹çš„å­—æ®µä¼šå»é™¤å°¾éƒ¨çš„ç©ºæ ¼ã€‚ï¼ˆæ— è®ºæ˜¯è‡ªå·±æ·»åŠ çš„å°¾éƒ¨ç©ºæ ¼ï¼Œè¿˜æ˜¯è‡ªåŠ¨å¡«å……çš„ç©ºæ ¼ï¼Œéƒ½ä¸æ˜¾ç¤ºï¼‰</li><li>å®šä¹‰CHARç±»å‹å­—æ®µæ—¶ï¼Œå£°æ˜çš„å­—æ®µé•¿åº¦å³ä¸ºCHARç±»å‹å­—æ®µæ‰€å çš„å­˜å‚¨ç©ºé—´çš„å­—èŠ‚æ•°ã€‚</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE TABLE test_char1(<br>c1 CHAR,<br>c2 CHAR(5)<br>);<br><br>DESC test_char1;<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">INSERT INTO test_char1<br>VALUES(&#x27;a&#x27;,&#x27;Tom&#x27;);<br><br>SELECT c1,CONCAT(c2,&#x27;***&#x27;) FROM test_char1;<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">INSERT INTO test_char1(c2)<br>VALUES(&#x27;a  &#x27;);<br><br>SELECT CHAR_LENGTH(c2)<br>FROM test_char1;<br></code></pre></td></tr></table></figure><p><strong>VARCHARç±»å‹ï¼š</strong></p><ul><li>VARCHAR(M) å®šä¹‰æ—¶ï¼Œ<code>å¿…é¡»æŒ‡å®š</code>é•¿åº¦Mï¼Œå¦åˆ™æŠ¥é”™ã€‚ï¼ˆå¿…é¡»è¦æŒ‡æ˜æœ€å¤šå¯ä»¥å­˜å‚¨å¤šå°‘ä¸ªå­—ç¬¦ï¼‰</li><li>MySQL4.0ç‰ˆæœ¬ä»¥ä¸‹ï¼Œvarchar(20)ï¼šæŒ‡çš„æ˜¯20å­—èŠ‚ï¼Œå¦‚æœå­˜æ”¾UTF8æ±‰å­—æ—¶ï¼Œåªèƒ½å­˜6ä¸ªï¼ˆæ¯ä¸ªæ±‰å­—3å­—èŠ‚ï¼‰ ï¼›MySQL5.0ç‰ˆæœ¬ä»¥ä¸Šï¼Œvarchar(20)ï¼šæŒ‡çš„æ˜¯20å­—ç¬¦ã€‚</li><li>æ£€ç´¢VARCHARç±»å‹çš„å­—æ®µæ•°æ®æ—¶ï¼Œä¼šä¿ç•™æ•°æ®å°¾éƒ¨çš„ç©ºæ ¼ã€‚VARCHARç±»å‹çš„å­—æ®µæ‰€å ç”¨çš„å­˜å‚¨ç©ºé—´ä¸ºå­—ç¬¦ä¸²å®é™…é•¿åº¦åŠ 1ä¸ªå­—èŠ‚ã€‚</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE TABLE test_varchar1(<br>NAME VARCHAR  #é”™è¯¯<br>);<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#Column length too big for column &#x27;NAME&#x27; (max = 21845);<br>CREATE TABLE test_varchar2(<br>NAME VARCHAR(65535)  #é”™è¯¯<br>);<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE TABLE test_varchar3(<br>NAME VARCHAR(5)<br>);<br><br>INSERT INTO test_varchar3<br>VALUES(&#x27;å°šç¡…è°·&#x27;),(&#x27;å°šç¡…è°·æ•™è‚²&#x27;);<br><br>#Data too long for column &#x27;NAME&#x27; at row 1<br>INSERT INTO test_varchar3<br>VALUES(&#x27;å°šç¡…è°·ITæ•™è‚²&#x27;);<br></code></pre></td></tr></table></figure><p><strong>å“ªäº›æƒ…å†µä½¿ç”¨ CHAR æˆ– VARCHAR æ›´å¥½</strong></p><table><thead><tr><th>ç±»å‹</th><th>ç‰¹ç‚¹</th><th>ç©ºé—´ä¸Š</th><th>æ—¶é—´ä¸Š</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>CHAR(M)</td><td>å›ºå®šé•¿åº¦</td><td>æµªè´¹å­˜å‚¨ç©ºé—´</td><td>æ•ˆç‡é«˜</td><td>å­˜å‚¨ä¸å¤§ï¼Œé€Ÿåº¦è¦æ±‚é«˜</td></tr><tr><td>VARCHAR(M)</td><td>å¯å˜é•¿åº¦</td><td>èŠ‚çœå­˜å‚¨ç©ºé—´</td><td>æ•ˆç‡ä½</td><td>éCHARçš„æƒ…å†µ</td></tr></tbody></table><p>æƒ…å†µ1ï¼šå­˜å‚¨å¾ˆçŸ­çš„ä¿¡æ¯ã€‚æ¯”å¦‚é—¨ç‰Œå·ç 101ï¼Œ201â€¦â€¦è¿™æ ·å¾ˆçŸ­çš„ä¿¡æ¯åº”è¯¥ç”¨charï¼Œå› ä¸ºvarcharè¿˜è¦å ä¸ªbyteç”¨äºå­˜å‚¨ä¿¡æ¯é•¿åº¦ï¼Œæœ¬æ¥æ‰“ç®—èŠ‚çº¦å­˜å‚¨çš„ï¼Œç»“æœå¾—ä¸å¿å¤±ã€‚</p><p>æƒ…å†µ2ï¼šå›ºå®šé•¿åº¦çš„ã€‚æ¯”å¦‚ä½¿ç”¨uuidä½œä¸ºä¸»é”®ï¼Œé‚£ç”¨charåº”è¯¥æ›´åˆé€‚ã€‚å› ä¸ºä»–å›ºå®šé•¿åº¦ï¼ŒvarcharåŠ¨æ€æ ¹æ®é•¿åº¦çš„ç‰¹æ€§å°±æ¶ˆå¤±äº†ï¼Œè€Œä¸”è¿˜è¦å ä¸ªé•¿åº¦ä¿¡æ¯ã€‚</p><p>æƒ…å†µ3ï¼šååˆ†é¢‘ç¹æ”¹å˜çš„columnã€‚å› ä¸ºvarcharæ¯æ¬¡å­˜å‚¨éƒ½è¦æœ‰é¢å¤–çš„è®¡ç®—ï¼Œå¾—åˆ°é•¿åº¦ç­‰å·¥ä½œï¼Œå¦‚æœä¸€ä¸ªéå¸¸é¢‘ç¹æ”¹å˜çš„ï¼Œé‚£å°±è¦æœ‰å¾ˆå¤šçš„ç²¾åŠ›ç”¨äºè®¡ç®—ï¼Œè€Œè¿™äº›å¯¹äºcharæ¥è¯´æ˜¯ä¸éœ€è¦çš„ã€‚</p><p>æƒ…å†µ4ï¼šå…·ä½“å­˜å‚¨å¼•æ“ä¸­çš„æƒ…å†µï¼š</p><ul><li><p><code>MyISAM</code> æ•°æ®å­˜å‚¨å¼•æ“å’Œæ•°æ®åˆ—ï¼šMyISAMæ•°æ®è¡¨ï¼Œæœ€å¥½ä½¿ç”¨å›ºå®šé•¿åº¦(CHAR)çš„æ•°æ®åˆ—ä»£æ›¿å¯å˜é•¿åº¦(VARCHAR)çš„æ•°æ®åˆ—ã€‚è¿™æ ·ä½¿å¾—æ•´ä¸ªè¡¨é™æ€åŒ–ï¼Œä»è€Œä½¿<code>æ•°æ®æ£€ç´¢æ›´å¿«</code>ï¼Œç”¨ç©ºé—´æ¢æ—¶é—´ã€‚</p></li><li><p><code>MEMORY</code> å­˜å‚¨å¼•æ“å’Œæ•°æ®åˆ—ï¼šMEMORYæ•°æ®è¡¨ç›®å‰éƒ½ä½¿ç”¨å›ºå®šé•¿åº¦çš„æ•°æ®è¡Œå­˜å‚¨ï¼Œå› æ­¤æ— è®ºä½¿ç”¨CHARæˆ–VARCHARåˆ—éƒ½æ²¡æœ‰å…³ç³»ï¼Œä¸¤è€…éƒ½æ˜¯ä½œä¸ºCHARç±»å‹å¤„ç†çš„ã€‚</p></li><li><p><code>InnoDB</code>å­˜å‚¨å¼•æ“ï¼Œå»ºè®®ä½¿ç”¨VARCHARç±»å‹ã€‚å› ä¸ºå¯¹äºInnoDBæ•°æ®è¡¨ï¼Œå†…éƒ¨çš„è¡Œå­˜å‚¨æ ¼å¼å¹¶æ²¡æœ‰åŒºåˆ†å›ºå®šé•¿åº¦å’Œå¯å˜é•¿åº¦åˆ—ï¼ˆæ‰€æœ‰æ•°æ®è¡Œéƒ½ä½¿ç”¨æŒ‡å‘æ•°æ®åˆ—å€¼çš„å¤´æŒ‡é’ˆï¼‰ï¼Œè€Œä¸”<strong>ä¸»è¦å½±å“æ€§èƒ½çš„å› ç´ æ˜¯æ•°æ®è¡Œä½¿ç”¨çš„å­˜å‚¨æ€»é‡</strong>ï¼Œç”±äºcharå¹³å‡å ç”¨çš„ç©ºé—´å¤šäºvarcharï¼Œæ‰€ä»¥é™¤äº†ç®€çŸ­å¹¶ä¸”å›ºå®šé•¿åº¦çš„ï¼Œå…¶ä»–è€ƒè™‘varcharã€‚è¿™æ ·èŠ‚çœç©ºé—´ï¼Œå¯¹ç£ç›˜I/Oå’Œæ•°æ®å­˜å‚¨æ€»é‡æ¯”è¾ƒå¥½ã€‚</p></li></ul><h3 id="7-2-TEXTç±»å‹"><a href="#7-2-TEXTç±»å‹" class="headerlink" title="7.2 TEXTç±»å‹"></a>7.2 TEXTç±»å‹</h3><p>åœ¨MySQLä¸­ï¼ŒTEXTç”¨æ¥ä¿å­˜æ–‡æœ¬ç±»å‹çš„å­—ç¬¦ä¸²ï¼Œæ€»å…±åŒ…å«4ç§ç±»å‹ï¼Œåˆ†åˆ«ä¸ºTINYTEXTã€TEXTã€MEDIUMTEXT å’Œ LONGTEXT ç±»å‹ã€‚</p><p>åœ¨å‘TEXTç±»å‹çš„å­—æ®µä¿å­˜å’ŒæŸ¥è¯¢æ•°æ®æ—¶ï¼Œç³»ç»Ÿè‡ªåŠ¨æŒ‰ç…§å®é™…é•¿åº¦å­˜å‚¨ï¼Œä¸éœ€è¦é¢„å…ˆå®šä¹‰é•¿åº¦ã€‚è¿™ä¸€ç‚¹å’Œ VARCHARç±»å‹ç›¸åŒã€‚</p><p>æ¯ç§TEXTç±»å‹ä¿å­˜çš„æ•°æ®é•¿åº¦å’Œæ‰€å ç”¨çš„å­˜å‚¨ç©ºé—´ä¸åŒï¼Œå¦‚ä¸‹ï¼š</p><table><thead><tr><th>æ–‡æœ¬å­—ç¬¦ä¸²ç±»å‹</th><th>ç‰¹ç‚¹</th><th>é•¿åº¦</th><th>é•¿åº¦èŒƒå›´</th><th>å ç”¨çš„å­˜å‚¨ç©ºé—´</th></tr></thead><tbody><tr><td>TINYTEXT</td><td>å°æ–‡æœ¬ã€å¯å˜é•¿åº¦</td><td>L</td><td>0 &lt;= L &lt;= 255</td><td>L + 2 ä¸ªå­—èŠ‚</td></tr><tr><td>TEXT</td><td>æ–‡æœ¬ã€å¯å˜é•¿åº¦</td><td>L</td><td>0 &lt;= L &lt;= 65535</td><td>L + 2 ä¸ªå­—èŠ‚</td></tr><tr><td>MEDIUMTEXT</td><td>ä¸­ç­‰æ–‡æœ¬ã€å¯å˜é•¿åº¦</td><td>L</td><td>0 &lt;= L &lt;= 16777215</td><td>L + 3 ä¸ªå­—èŠ‚</td></tr><tr><td>LONGTEXT</td><td>å¤§æ–‡æœ¬ã€å¯å˜é•¿åº¦</td><td>L</td><td>0 &lt;= L&lt;= 4294967295ï¼ˆç›¸å½“äº4GBï¼‰</td><td>L + 4 ä¸ªå­—èŠ‚</td></tr></tbody></table><p><strong>ç”±äºå®é™…å­˜å‚¨çš„é•¿åº¦ä¸ç¡®å®šï¼ŒMySQL ä¸å…è®¸ TEXT ç±»å‹çš„å­—æ®µåšä¸»é”®</strong>ã€‚é‡åˆ°è¿™ç§æƒ…å†µï¼Œä½ åªèƒ½é‡‡ç”¨ CHAR(M)ï¼Œæˆ–è€… VARCHAR(M)ã€‚</p><p><strong>ä¸¾ä¾‹ï¼š</strong></p><p>åˆ›å»ºæ•°æ®è¡¨ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE TABLE test_text(<br>tx TEXT<br>);<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">INSERT INTO test_text<br>VALUES(&#x27;atguigu   &#x27;);<br><br>SELECT CHAR_LENGTH(tx)<br>FROM test_text; #10      éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒTEXTä¸ä¼šå¿½ç•¥å­—ç¬¦ä¸²ç»“å°¾çš„ç©ºæ ¼ï¼Œè€ŒCHARä¼šå¿½ç•¥å­—ç¬¦ä¸²ç»“å°¾çš„ç©ºæ ¼ã€‚<br></code></pre></td></tr></table></figure><p>è¯´æ˜åœ¨ä¿å­˜å’ŒæŸ¥è¯¢æ•°æ®æ—¶ï¼Œå¹¶æ²¡æœ‰åˆ é™¤TEXTç±»å‹çš„æ•°æ®å°¾éƒ¨çš„ç©ºæ ¼ã€‚</p><p><strong>å¼€å‘ä¸­ç»éªŒï¼š</strong></p><p>TEXTæ–‡æœ¬ç±»å‹ï¼Œå¯ä»¥å­˜æ¯”è¾ƒå¤§çš„æ–‡æœ¬æ®µï¼Œæœç´¢é€Ÿåº¦ç¨æ…¢ï¼Œå› æ­¤å¦‚æœä¸æ˜¯ç‰¹åˆ«å¤§çš„å†…å®¹ï¼Œå»ºè®®ä½¿ç”¨CHARï¼ŒVARCHARæ¥ä»£æ›¿ã€‚è¿˜æœ‰TEXTç±»å‹ä¸ç”¨åŠ é»˜è®¤å€¼ï¼ŒåŠ äº†ä¹Ÿæ²¡ç”¨ã€‚è€Œä¸”textå’Œblobç±»å‹çš„æ•°æ®åˆ é™¤åå®¹æ˜“å¯¼è‡´â€œç©ºæ´â€ï¼Œä½¿å¾—æ–‡ä»¶ç¢ç‰‡æ¯”è¾ƒå¤šï¼Œæ‰€ä»¥é¢‘ç¹ä½¿ç”¨çš„è¡¨ä¸å»ºè®®åŒ…å«TEXTç±»å‹å­—æ®µï¼Œå»ºè®®å•ç‹¬åˆ†å‡ºå»ï¼Œå•ç‹¬ç”¨ä¸€ä¸ªè¡¨ã€‚</p><p><strong>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒTEXTä¸ä¼šå¿½ç•¥å­—ç¬¦ä¸²ç»“å°¾çš„ç©ºæ ¼ï¼Œè€ŒCHARä¼šå¿½ç•¥å­—ç¬¦ä¸²ç»“å°¾çš„ç©ºæ ¼ã€‚</strong></p><h2 id="8-ENUMç±»å‹"><a href="#8-ENUMç±»å‹" class="headerlink" title="8. ENUMç±»å‹"></a>8. ENUMç±»å‹</h2><p>ENUMç±»å‹ä¹Ÿå«ä½œæšä¸¾ç±»å‹ï¼ŒENUMç±»å‹çš„å–å€¼èŒƒå›´éœ€è¦åœ¨å®šä¹‰å­—æ®µæ—¶è¿›è¡ŒæŒ‡å®šã€‚è®¾ç½®å­—æ®µå€¼æ—¶ï¼ŒENUMç±»å‹åªå…è®¸ä»æˆå‘˜ä¸­é€‰å–å•ä¸ªå€¼ï¼ˆMySQLå¿½ç•¥å¤§å°å†™ï¼‰ï¼Œä¸èƒ½ä¸€æ¬¡é€‰å–å¤šä¸ªå€¼ã€‚</p><p>å…¶æ‰€éœ€è¦çš„å­˜å‚¨ç©ºé—´ç”±å®šä¹‰ENUMç±»å‹æ—¶æŒ‡å®šçš„æˆå‘˜ä¸ªæ•°å†³å®šã€‚</p><table><thead><tr><th>æ–‡æœ¬å­—ç¬¦ä¸²ç±»å‹</th><th>é•¿åº¦</th><th>é•¿åº¦èŒƒå›´</th><th>å ç”¨çš„å­˜å‚¨ç©ºé—´</th></tr></thead><tbody><tr><td>ENUM</td><td>L</td><td>1 &lt;= L &lt;= 65535</td><td>1æˆ–2ä¸ªå­—èŠ‚</td></tr></tbody></table><ul><li><p>å½“ENUMç±»å‹åŒ…å«1ï½255ä¸ªæˆå‘˜æ—¶ï¼Œéœ€è¦1ä¸ªå­—èŠ‚çš„å­˜å‚¨ç©ºé—´ï¼›</p></li><li><p>å½“ENUMç±»å‹åŒ…å«256ï½65535ä¸ªæˆå‘˜æ—¶ï¼Œéœ€è¦2ä¸ªå­—èŠ‚çš„å­˜å‚¨ç©ºé—´ã€‚</p></li><li><p>ENUMç±»å‹çš„æˆå‘˜ä¸ªæ•°çš„ä¸Šé™ä¸º65535ä¸ªã€‚</p></li></ul><p>ä¸¾ä¾‹ï¼š</p><p>åˆ›å»ºè¡¨å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE TABLE test_enum(<br>season ENUM(&#x27;æ˜¥&#x27;,&#x27;å¤&#x27;,&#x27;ç§‹&#x27;,&#x27;å†¬&#x27;,&#x27;unknow&#x27;) #ä¸‹æ ‡ä»1å¼€å§‹ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹æ ‡è¿›è¡Œæ’å…¥ã€‚<br>);<br></code></pre></td></tr></table></figure><p>æ·»åŠ æ•°æ®ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs mysql">INSERT INTO test_enum<br>VALUES(&#x27;æ˜¥&#x27;),(&#x27;ç§‹&#x27;);<br><br># å¿½ç•¥å¤§å°å†™<br>INSERT INTO test_enum<br>VALUES(&#x27;UNKNOW&#x27;);<br><br># å…è®¸æŒ‰ç…§è§’æ ‡çš„æ–¹å¼è·å–æŒ‡å®šç´¢å¼•ä½ç½®çš„æšä¸¾å€¼<br>INSERT INTO test_enum<br>VALUES(&#x27;1&#x27;),(3);<br><br># Data truncated for column &#x27;season&#x27; at row 1<br>INSERT INTO test_enum<br>VALUES(&#x27;ab&#x27;);<br><br># å½“ENUMç±»å‹çš„å­—æ®µæ²¡æœ‰å£°æ˜ä¸ºNOT NULLæ—¶ï¼Œæ’å…¥NULLä¹Ÿæ˜¯æœ‰æ•ˆçš„<br>INSERT INTO test_enum<br>VALUES(NULL);<br></code></pre></td></tr></table></figure><h2 id="9-SETç±»å‹"><a href="#9-SETç±»å‹" class="headerlink" title="9. SETç±»å‹"></a>9. SETç±»å‹</h2><p>SETè¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ï¼Œå¯ä»¥åŒ…å«0ä¸ªæˆ–å¤šä¸ªæˆå‘˜ï¼Œä½†æˆå‘˜ä¸ªæ•°çš„ä¸Šé™ä¸º<code>64</code>ã€‚è®¾ç½®å­—æ®µå€¼æ—¶ï¼Œå¯ä»¥å–å–å€¼èŒƒå›´å†…çš„ 0 ä¸ªæˆ–å¤šä¸ªå€¼ã€‚</p><p>å½“SETç±»å‹åŒ…å«çš„æˆå‘˜ä¸ªæ•°ä¸åŒæ—¶ï¼Œå…¶æ‰€å ç”¨çš„å­˜å‚¨ç©ºé—´ä¹Ÿæ˜¯ä¸åŒçš„ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p><table><thead><tr><th>æˆå‘˜ä¸ªæ•°èŒƒå›´ï¼ˆLè¡¨ç¤ºå®é™…æˆå‘˜ä¸ªæ•°ï¼‰</th><th>å ç”¨çš„å­˜å‚¨ç©ºé—´</th></tr></thead><tbody><tr><td>1 &lt;= L &lt;= 8</td><td>1ä¸ªå­—èŠ‚</td></tr><tr><td>9 &lt;= L &lt;= 16</td><td>2ä¸ªå­—èŠ‚</td></tr><tr><td>17 &lt;= L &lt;= 24</td><td>3ä¸ªå­—èŠ‚</td></tr><tr><td>25 &lt;= L &lt;= 32</td><td>4ä¸ªå­—èŠ‚</td></tr><tr><td>33 &lt;= L &lt;= 64</td><td>8ä¸ªå­—èŠ‚</td></tr></tbody></table><p>SETç±»å‹åœ¨å­˜å‚¨æ•°æ®æ—¶æˆå‘˜ä¸ªæ•°è¶Šå¤šï¼Œå…¶å ç”¨çš„å­˜å‚¨ç©ºé—´è¶Šå¤§ã€‚æ³¨æ„ï¼šSETç±»å‹åœ¨é€‰å–æˆå‘˜æ—¶ï¼Œå¯ä»¥ä¸€æ¬¡é€‰æ‹©å¤šä¸ªæˆå‘˜ï¼Œè¿™ä¸€ç‚¹ä¸ENUMç±»å‹ä¸åŒã€‚<strong>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸€æ¬¡é€‰æ‹©å¤šä¸ªæˆå‘˜æ—¶ï¼Œä¸è¦å¤šå†™ç©ºæ ¼ï¼›å¹¶ä¸”è¦å†™åœ¨ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­ä»¥é€—å·åˆ†éš”ã€‚</strong>å¯ä»¥ä½¿ç”¨ä¸‹æ ‡æ’å…¥å…ƒç´ ï¼Œä½†æ˜¯ä½¿ç”¨ä¸‹æ ‡åªèƒ½æ’å…¥ä¸€ä¸ªæˆå‘˜ï¼Œä¸èƒ½æ’å…¥å¤šä¸ªæˆå‘˜ã€‚</p><p>ä¸¾ä¾‹ï¼š</p><p>åˆ›å»ºè¡¨ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE TABLE test_set(<br>s SET (&#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27;)<br>);<br></code></pre></td></tr></table></figure><p>å‘è¡¨ä¸­æ’å…¥æ•°æ®ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs mysql">INSERT INTO test_set (s) VALUES (&#x27;A&#x27;), (&#x27;A,B&#x27;);<br><br>#æ’å…¥é‡å¤çš„SETç±»å‹æˆå‘˜æ—¶ï¼ŒMySQLä¼šè‡ªåŠ¨åˆ é™¤é‡å¤çš„æˆå‘˜<br>INSERT INTO test_set (s) VALUES (&#x27;A,B,C,A&#x27;);<br><br>#å‘SETç±»å‹çš„å­—æ®µæ’å…¥SETæˆå‘˜ä¸­ä¸å­˜åœ¨çš„å€¼æ—¶ï¼ŒMySQLä¼šæŠ›å‡ºé”™è¯¯ã€‚<br>INSERT INTO test_set (s) VALUES (&#x27;A,B,C,D&#x27;);<br><br>SELECT *<br>FROM test_set;<br></code></pre></td></tr></table></figure><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE TABLE temp_mul(<br>gender ENUM(&#x27;ç”·&#x27;,&#x27;å¥³&#x27;),<br>hobby SET(&#x27;åƒé¥­&#x27;,&#x27;ç¡è§‰&#x27;,&#x27;æ‰“è±†è±†&#x27;,&#x27;å†™ä»£ç &#x27;)<br>);<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs mysql">INSERT INTO temp_mul VALUES(&#x27;ç”·&#x27;,&#x27;ç¡è§‰,æ‰“è±†è±†&#x27;); #æˆåŠŸ<br><br># Data truncated for column &#x27;gender&#x27; at row 1<br>INSERT INTO temp_mul VALUES(&#x27;ç”·,å¥³&#x27;,&#x27;ç¡è§‰,å†™ä»£ç &#x27;); #å¤±è´¥<br><br># Data truncated for column &#x27;gender&#x27; at row 1<br>INSERT INTO temp_mul VALUES(&#x27;å¦–&#x27;,&#x27;ç¡è§‰,å†™ä»£ç &#x27;);#å¤±è´¥<br><br><br>INSERT INTO temp_mul VALUES(&#x27;ç”·&#x27;,&#x27;ç¡è§‰,å†™ä»£ç ,åƒé¥­&#x27;); #æˆåŠŸ<br></code></pre></td></tr></table></figure><h2 id="10-äºŒè¿›åˆ¶å­—ç¬¦ä¸²ç±»å‹"><a href="#10-äºŒè¿›åˆ¶å­—ç¬¦ä¸²ç±»å‹" class="headerlink" title="10. äºŒè¿›åˆ¶å­—ç¬¦ä¸²ç±»å‹"></a>10. äºŒè¿›åˆ¶å­—ç¬¦ä¸²ç±»å‹</h2><p>MySQLä¸­çš„äºŒè¿›åˆ¶å­—ç¬¦ä¸²ç±»å‹ä¸»è¦å­˜å‚¨ä¸€äº›äºŒè¿›åˆ¶æ•°æ®ï¼Œæ¯”å¦‚å¯ä»¥å­˜å‚¨å›¾ç‰‡ã€éŸ³é¢‘å’Œè§†é¢‘ç­‰äºŒè¿›åˆ¶æ•°æ®ã€‚</p><p>MySQLä¸­æ”¯æŒçš„äºŒè¿›åˆ¶å­—ç¬¦ä¸²ç±»å‹ä¸»è¦åŒ…æ‹¬BINARYã€VARBINARYã€TINYBLOBã€BLOBã€MEDIUMBLOB å’Œ LONGBLOBç±»å‹ã€‚</p><h4 id="BINARYä¸VARBINARYç±»å‹"><a href="#BINARYä¸VARBINARYç±»å‹" class="headerlink" title="BINARYä¸VARBINARYç±»å‹"></a>BINARYä¸VARBINARYç±»å‹</h4><p>BINARYå’ŒVARBINARYç±»ä¼¼äºCHARå’ŒVARCHARï¼Œåªæ˜¯å®ƒä»¬å­˜å‚¨çš„æ˜¯äºŒè¿›åˆ¶å­—ç¬¦ä¸²ã€‚</p><p>BINARY (M)ä¸ºå›ºå®šé•¿åº¦çš„äºŒè¿›åˆ¶å­—ç¬¦ä¸²ï¼ŒMè¡¨ç¤ºæœ€å¤šèƒ½å­˜å‚¨çš„å­—èŠ‚æ•°ï¼Œå–å€¼èŒƒå›´æ˜¯0~255ä¸ªå­—ç¬¦ã€‚å¦‚æœæœªæŒ‡å®š(M)ï¼Œè¡¨ç¤ºåªèƒ½å­˜å‚¨<code>1ä¸ªå­—èŠ‚</code>ã€‚ä¾‹å¦‚BINARY (8)ï¼Œè¡¨ç¤ºæœ€å¤šèƒ½å­˜å‚¨8ä¸ªå­—èŠ‚ï¼Œå¦‚æœå­—æ®µå€¼ä¸è¶³(M)ä¸ªå­—èŠ‚ï¼Œå°†åœ¨å³è¾¹å¡«å……â€™\0â€™ä»¥è¡¥é½æŒ‡å®šé•¿åº¦ã€‚</p><p>VARBINARY (M)ä¸ºå¯å˜é•¿åº¦çš„äºŒè¿›åˆ¶å­—ç¬¦ä¸²ï¼ŒMè¡¨ç¤ºæœ€å¤šèƒ½å­˜å‚¨çš„å­—èŠ‚æ•°ï¼Œæ€»å­—èŠ‚æ•°ä¸èƒ½è¶…è¿‡è¡Œçš„å­—èŠ‚é•¿åº¦é™åˆ¶65535ï¼Œå¦å¤–è¿˜è¦è€ƒè™‘é¢å¤–å­—èŠ‚å¼€é”€ï¼ŒVARBINARYç±»å‹çš„æ•°æ®é™¤äº†å­˜å‚¨æ•°æ®æœ¬èº«å¤–ï¼Œè¿˜éœ€è¦1æˆ–2ä¸ªå­—èŠ‚æ¥å­˜å‚¨æ•°æ®çš„å­—èŠ‚æ•°ã€‚VARBINARYç±»å‹<code>å¿…é¡»æŒ‡å®š(M)</code>ï¼Œå¦åˆ™æŠ¥é”™ã€‚</p><table><thead><tr><th>äºŒè¿›åˆ¶å­—ç¬¦ä¸²ç±»å‹</th><th>ç‰¹ç‚¹</th><th>å€¼çš„é•¿åº¦</th><th>å ç”¨ç©ºé—´</th></tr></thead><tbody><tr><td>BINARY(M)</td><td>å›ºå®šé•¿åº¦</td><td>M ï¼ˆ0 &lt;= M &lt;= 255ï¼‰</td><td>Mä¸ªå­—èŠ‚</td></tr><tr><td>VARBINARY(M)</td><td>å¯å˜é•¿åº¦</td><td>Mï¼ˆ0 &lt;= M &lt;= 65535ï¼‰</td><td>M+1ä¸ªå­—èŠ‚</td></tr></tbody></table><p>ä¸¾ä¾‹ï¼š</p><p>åˆ›å»ºè¡¨ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE TABLE test_binary1(<br>f1 BINARY,<br>f2 BINARY(3),<br># f3 VARBINARY,<br>f4 VARBINARY(10)<br>);<br></code></pre></td></tr></table></figure><p>æ·»åŠ æ•°æ®ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">INSERT INTO test_binary1(f1,f2)<br>VALUES(&#x27;a&#x27;,&#x27;a&#x27;);<br><br>INSERT INTO test_binary1(f1,f2)<br>VALUES(&#x27;å°š&#x27;,&#x27;å°š&#x27;);#å¤±è´¥,è¿™æ˜¯æ±‰å­—å­—ç¬¦ï¼Œéœ€è¦å ç”¨å¤§äºä¸€ä¸ªå­—èŠ‚çš„ç©ºé—´<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs mysql">INSERT INTO test_binary1(f2,f4)<br>VALUES(&#x27;ab&#x27;,&#x27;ab&#x27;);<br><br>mysql&gt; SELECT LENGTH(f2),LENGTH(f4)<br>    -&gt; FROM test_binary1;<br>+------------+------------+<br>| LENGTH(f2) | LENGTH(f4) |<br>+------------+------------+<br>|          3 |       NULL |<br>|          3 |          2 |<br>+------------+------------+<br>2 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><h4 id="BLOBç±»å‹"><a href="#BLOBç±»å‹" class="headerlink" title="BLOBç±»å‹"></a>BLOBç±»å‹</h4><p>BLOBæ˜¯ä¸€ä¸ª<code>äºŒè¿›åˆ¶å¤§å¯¹è±¡</code>ï¼Œå¯ä»¥å®¹çº³å¯å˜æ•°é‡çš„æ•°æ®ã€‚</p><p>MySQLä¸­çš„BLOBç±»å‹åŒ…æ‹¬TINYBLOBã€BLOBã€MEDIUMBLOBå’ŒLONGBLOB 4ç§ç±»å‹ï¼Œå®ƒä»¬å¯å®¹çº³å€¼çš„æœ€å¤§é•¿åº¦ä¸åŒã€‚å¯ä»¥å­˜å‚¨ä¸€ä¸ªäºŒè¿›åˆ¶çš„å¤§å¯¹è±¡ï¼Œæ¯”å¦‚<code>å›¾ç‰‡</code>ã€<code>éŸ³é¢‘</code>å’Œ<code>è§†é¢‘</code>ç­‰ã€‚</p><p><strong>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨å®é™…å·¥ä½œä¸­ï¼Œå¾€å¾€ä¸ä¼šåœ¨MySQLæ•°æ®åº“ä¸­ä½¿ç”¨BLOBç±»å‹å­˜å‚¨å¤§å¯¹è±¡æ•°æ®ï¼Œé€šå¸¸ä¼šå°†å›¾ç‰‡ã€éŸ³é¢‘å’Œè§†é¢‘æ–‡ä»¶å­˜å‚¨åˆ°<code>æœåŠ¡å™¨çš„ç£ç›˜ä¸Š</code>ï¼Œå¹¶å°†å›¾ç‰‡ã€éŸ³é¢‘å’Œè§†é¢‘çš„è®¿é—®è·¯å¾„å­˜å‚¨åˆ°MySQLä¸­ã€‚</strong></p><table><thead><tr><th>äºŒè¿›åˆ¶å­—ç¬¦ä¸²ç±»å‹</th><th>å€¼çš„é•¿åº¦</th><th>é•¿åº¦èŒƒå›´</th><th>å ç”¨ç©ºé—´</th></tr></thead><tbody><tr><td>TINYBLOB</td><td>L</td><td>0 &lt;= L &lt;= 255</td><td>L + 1 ä¸ªå­—èŠ‚</td></tr><tr><td>BLOB</td><td>L</td><td>0 &lt;= L &lt;= 65535ï¼ˆç›¸å½“äº64KBï¼‰</td><td>L + 2 ä¸ªå­—èŠ‚</td></tr><tr><td>MEDIUMBLOB</td><td>L</td><td>0 &lt;= L &lt;= 16777215 ï¼ˆç›¸å½“äº16MBï¼‰</td><td>L + 3 ä¸ªå­—èŠ‚</td></tr><tr><td>LONGBLOB</td><td>L</td><td>0 &lt;= L &lt;= 4294967295ï¼ˆç›¸å½“äº4GBï¼‰</td><td>L + 4 ä¸ªå­—èŠ‚</td></tr></tbody></table><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE TABLE test_blob1(<br>id INT,<br>img MEDIUMBLOB<br>);<br></code></pre></td></tr></table></figure><p><strong>TEXTå’ŒBLOBçš„ä½¿ç”¨æ³¨æ„äº‹é¡¹ï¼š</strong></p><p>åœ¨ä½¿ç”¨textå’Œblobå­—æ®µç±»å‹æ—¶è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼Œä»¥ä¾¿æ›´å¥½çš„å‘æŒ¥æ•°æ®åº“çš„æ€§èƒ½ã€‚</p><p>â‘  BLOBå’ŒTEXTå€¼ä¹Ÿä¼šå¼•èµ·è‡ªå·±çš„ä¸€äº›é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯æ‰§è¡Œäº†å¤§é‡çš„åˆ é™¤æˆ–æ›´æ–°æ“ä½œçš„æ—¶å€™ã€‚åˆ é™¤è¿™ç§å€¼ä¼šåœ¨æ•°æ®è¡¨ä¸­ç•™ä¸‹å¾ˆå¤§çš„â€<code>ç©ºæ´</code>â€œï¼Œä»¥åå¡«å…¥è¿™äº›â€ç©ºæ´â€çš„è®°å½•å¯èƒ½é•¿åº¦ä¸åŒã€‚ä¸ºäº†æé«˜æ€§èƒ½ï¼Œå»ºè®®å®šæœŸä½¿ç”¨ OPTIMIZE TABLE åŠŸèƒ½å¯¹è¿™ç±»è¡¨è¿›è¡Œ<code>ç¢ç‰‡æ•´ç†</code>ã€‚</p><p>â‘¡ å¦‚æœéœ€è¦å¯¹å¤§æ–‡æœ¬å­—æ®µè¿›è¡Œæ¨¡ç³ŠæŸ¥è¯¢ï¼ŒMySQL æä¾›äº†<code>å‰ç¼€ç´¢å¼•</code>ã€‚ä½†æ˜¯ä»ç„¶è¦åœ¨ä¸å¿…è¦çš„æ—¶å€™é¿å…æ£€ç´¢å¤§å‹çš„BLOBæˆ–TEXTå€¼ã€‚ä¾‹å¦‚ï¼ŒSELECT * æŸ¥è¯¢å°±ä¸æ˜¯å¾ˆå¥½çš„æƒ³æ³•ï¼Œé™¤éä½ èƒ½å¤Ÿç¡®å®šä½œä¸ºçº¦æŸæ¡ä»¶çš„WHEREå­å¥åªä¼šæ‰¾åˆ°æ‰€éœ€è¦çš„æ•°æ®è¡Œã€‚å¦åˆ™ï¼Œä½ å¯èƒ½æ¯«æ— ç›®çš„åœ°åœ¨ç½‘ç»œä¸Šä¼ è¾“å¤§é‡çš„å€¼ã€‚</p><p>â‘¢ æŠŠBLOBæˆ–TEXTåˆ—<code>åˆ†ç¦»åˆ°å•ç‹¬çš„è¡¨</code>ä¸­ã€‚åœ¨æŸäº›ç¯å¢ƒä¸­ï¼Œå¦‚æœæŠŠè¿™äº›æ•°æ®åˆ—ç§»åŠ¨åˆ°ç¬¬äºŒå¼ æ•°æ®è¡¨ä¸­ï¼Œå¯ä»¥è®©ä½ æŠŠåŸæ•°æ®è¡¨ä¸­çš„æ•°æ®åˆ—è½¬æ¢ä¸ºå›ºå®šé•¿åº¦çš„æ•°æ®è¡Œæ ¼å¼ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯æœ‰æ„ä¹‰çš„ã€‚è¿™ä¼š<code>å‡å°‘ä¸»è¡¨ä¸­çš„ç¢ç‰‡</code>ï¼Œä½¿ä½ å¾—åˆ°å›ºå®šé•¿åº¦æ•°æ®è¡Œçš„æ€§èƒ½ä¼˜åŠ¿ã€‚å®ƒè¿˜ä½¿ä½ åœ¨ä¸»æ•°æ®è¡¨ä¸Šè¿è¡Œ SELECT * æŸ¥è¯¢çš„æ—¶å€™ä¸ä¼šé€šè¿‡ç½‘ç»œä¼ è¾“å¤§é‡çš„BLOBæˆ–TEXTå€¼ã€‚</p><h2 id="11-JSON-ç±»å‹"><a href="#11-JSON-ç±»å‹" class="headerlink" title="11. JSON ç±»å‹"></a>11. JSON ç±»å‹</h2><p>JSONï¼ˆJavaScript Object Notationï¼‰æ˜¯ä¸€ç§è½»é‡çº§çš„<code>æ•°æ®äº¤æ¢æ ¼å¼</code>ã€‚ç®€æ´å’Œæ¸…æ™°çš„å±‚æ¬¡ç»“æ„ä½¿å¾— JSON æˆä¸ºç†æƒ³çš„æ•°æ®äº¤æ¢è¯­è¨€ã€‚å®ƒæ˜“äºäººé˜…è¯»å’Œç¼–å†™ï¼ŒåŒæ—¶ä¹Ÿæ˜“äºæœºå™¨è§£æå’Œç”Ÿæˆï¼Œå¹¶æœ‰æ•ˆåœ°æå‡ç½‘ç»œä¼ è¾“æ•ˆç‡ã€‚<strong>JSON å¯ä»¥å°† JavaScript å¯¹è±¡ä¸­è¡¨ç¤ºçš„ä¸€ç»„æ•°æ®è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œç„¶åå°±å¯ä»¥åœ¨ç½‘ç»œæˆ–è€…ç¨‹åºä¹‹é—´è½»æ¾åœ°ä¼ é€’è¿™ä¸ªå­—ç¬¦ä¸²ï¼Œå¹¶åœ¨éœ€è¦çš„æ—¶å€™å°†å®ƒè¿˜åŸä¸ºå„ç¼–ç¨‹è¯­è¨€æ‰€æ”¯æŒçš„æ•°æ®æ ¼å¼ã€‚</strong></p><p>åœ¨MySQL 5.7ä¸­ï¼Œå°±å·²ç»æ”¯æŒJSONæ•°æ®ç±»å‹ã€‚åœ¨MySQL 8.xç‰ˆæœ¬ä¸­ï¼ŒJSONç±»å‹æä¾›äº†å¯ä»¥è¿›è¡Œè‡ªåŠ¨éªŒè¯çš„JSONæ–‡æ¡£å’Œä¼˜åŒ–çš„å­˜å‚¨ç»“æ„ï¼Œä½¿å¾—åœ¨MySQLä¸­å­˜å‚¨å’Œè¯»å–JSONç±»å‹çš„æ•°æ®æ›´åŠ æ–¹ä¾¿å’Œé«˜æ•ˆã€‚<br>åˆ›å»ºæ•°æ®è¡¨ï¼Œè¡¨ä¸­åŒ…å«ä¸€ä¸ªJSONç±»å‹çš„å­—æ®µ js ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE TABLE test_json(<br>js json<br><br>);<br></code></pre></td></tr></table></figure><p>å‘è¡¨ä¸­æ’å…¥JSONæ•°æ®ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">INSERT INTO test_json (js) <br>VALUES (&#x27;&#123;&quot;name&quot;:&quot;songhk&quot;, &quot;age&quot;:18, &quot;address&quot;:&#123;&quot;province&quot;:&quot;beijing&quot;, &quot;city&quot;:&quot;beijing&quot;&#125;&#125;&#x27;);<br></code></pre></td></tr></table></figure><p>æŸ¥è¯¢t19è¡¨ä¸­çš„æ•°æ®ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT *<br>    -&gt; FROM test_json;<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211104192516324.png"></p><p>å½“éœ€è¦æ£€ç´¢JSONç±»å‹çš„å­—æ®µä¸­æ•°æ®çš„æŸä¸ªå…·ä½“å€¼æ—¶ï¼Œå¯ä»¥ä½¿ç”¨â€œ-&gt;â€å’Œâ€œ-&gt;&gt;â€ç¬¦å·ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT js -&gt; &#x27;$.name&#x27; AS NAME,js -&gt; &#x27;$.age&#x27; AS age ,js -&gt; &#x27;$.address.province&#x27; AS province, js -&gt; &#x27;$.address.city&#x27; AS city<br>    -&gt; FROM test_json;<br>+----------+------+-----------+-----------+<br>| NAME     | age  | province  | city      |<br>+----------+------+-----------+-----------+<br>| &quot;songhk&quot; | 18   | &quot;beijing&quot; | &quot;beijing&quot; |<br>+----------+------+-----------+-----------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>é€šè¿‡â€œ-&gt;â€å’Œâ€œ-&gt;&gt;â€ç¬¦å·ï¼Œä»JSONå­—æ®µä¸­æ­£ç¡®æŸ¥è¯¢å‡ºäº†æŒ‡å®šçš„JSONæ•°æ®çš„å€¼ã€‚</p><h2 id="12-ç©ºé—´ç±»å‹"><a href="#12-ç©ºé—´ç±»å‹" class="headerlink" title="12. ç©ºé—´ç±»å‹"></a>12. ç©ºé—´ç±»å‹</h2><p>MySQL ç©ºé—´ç±»å‹æ‰©å±•æ”¯æŒåœ°ç†ç‰¹å¾çš„ç”Ÿæˆã€å­˜å‚¨å’Œåˆ†æã€‚è¿™é‡Œçš„åœ°ç†ç‰¹å¾è¡¨ç¤ºä¸–ç•Œä¸Šå…·æœ‰ä½ç½®çš„ä»»ä½•ä¸œè¥¿ï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªå®ä½“ï¼Œä¾‹å¦‚ä¸€åº§å±±ï¼›å¯ä»¥æ˜¯ç©ºé—´ï¼Œä¾‹å¦‚ä¸€åº§åŠå…¬æ¥¼ï¼›ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªå¯å®šä¹‰çš„ä½ç½®ï¼Œä¾‹å¦‚ä¸€ä¸ªåå­—è·¯å£ç­‰ç­‰ã€‚MySQLä¸­ä½¿ç”¨<code>Geometryï¼ˆå‡ ä½•ï¼‰</code>æ¥è¡¨ç¤ºæ‰€æœ‰åœ°ç†ç‰¹å¾ã€‚GeometryæŒ‡ä¸€ä¸ªç‚¹æˆ–ç‚¹çš„é›†åˆï¼Œä»£è¡¨ä¸–ç•Œä¸Šä»»ä½•å…·æœ‰ä½ç½®çš„äº‹ç‰©ã€‚</p><p>MySQLçš„ç©ºé—´æ•°æ®ç±»å‹ï¼ˆSpatial Data Typeï¼‰å¯¹åº”äºOpenGISç±»ï¼ŒåŒ…æ‹¬å•å€¼ç±»å‹ï¼šGEOMETRYã€POINTã€LINESTRINGã€POLYGONä»¥åŠé›†åˆç±»å‹ï¼šMULTIPOINTã€MULTILINESTRINGã€MULTIPOLYGONã€GEOMETRYCOLLECTION ã€‚</p><ul><li>Geometryæ˜¯æ‰€æœ‰ç©ºé—´é›†åˆç±»å‹çš„åŸºç±»ï¼Œå…¶ä»–ç±»å‹å¦‚POINTã€LINESTRINGã€POLYGONéƒ½æ˜¯Geometryçš„å­ç±»ã€‚<ul><li>Pointï¼Œé¡¾åæ€ä¹‰å°±æ˜¯ç‚¹ï¼Œæœ‰ä¸€ä¸ªåæ ‡å€¼ã€‚ä¾‹å¦‚POINT(121.213342 31.234532)ï¼ŒPOINT(30 10)ï¼Œåæ ‡å€¼æ”¯æŒDECIMALç±»å‹ï¼Œç»åº¦ï¼ˆlongitudeï¼‰åœ¨å‰ï¼Œç»´åº¦ï¼ˆlatitudeï¼‰åœ¨åï¼Œç”¨ç©ºæ ¼åˆ†éš”ã€‚</li><li>LineStringï¼Œçº¿ï¼Œç”±ä¸€ç³»åˆ—ç‚¹è¿æ¥è€Œæˆã€‚å¦‚æœçº¿ä»å¤´è‡³å°¾æ²¡æœ‰äº¤å‰ï¼Œé‚£å°±æ˜¯ç®€å•çš„ï¼ˆsimpleï¼‰ï¼›å¦‚æœèµ·ç‚¹å’Œç»ˆç‚¹é‡å ï¼Œé‚£å°±æ˜¯å°é—­çš„ï¼ˆclosedï¼‰ã€‚ä¾‹å¦‚LINESTRING(30 10,10 30,40 40)ï¼Œç‚¹ä¸ç‚¹ä¹‹é—´ç”¨é€—å·åˆ†éš”ï¼Œä¸€ä¸ªç‚¹ä¸­çš„ç»çº¬åº¦ç”¨ç©ºæ ¼åˆ†éš”ï¼Œä¸POINTæ ¼å¼ä¸€è‡´ã€‚</li><li>Polygonï¼Œå¤šè¾¹å½¢ã€‚å¯ä»¥æ˜¯ä¸€ä¸ªå®å¿ƒå¹³é¢å½¢ï¼Œå³æ²¡æœ‰å†…éƒ¨è¾¹ç•Œï¼Œä¹Ÿå¯ä»¥æœ‰ç©ºæ´ï¼Œç±»ä¼¼çº½æ‰£ã€‚æœ€ç®€å•çš„å°±æ˜¯åªæœ‰ä¸€ä¸ªå¤–è¾¹ç•Œçš„æƒ…å†µï¼Œä¾‹å¦‚POLYGON((0 0,10 0,10 10, 0 10))ã€‚</li></ul></li></ul><p>ä¸‹é¢å±•ç¤ºå‡ ç§å¸¸è§çš„å‡ ä½•å›¾å½¢å…ƒç´ ï¼š</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211104192912988.png"></p><ul><li>MultiPointã€MultiLineStringã€MultiPolygonã€GeometryCollection è¿™4ç§ç±»å‹éƒ½æ˜¯é›†åˆç±»ï¼Œæ˜¯å¤šä¸ªPointã€LineStringæˆ–Polygonç»„åˆè€Œæˆã€‚</li></ul><p>ä¸‹é¢å±•ç¤ºçš„æ˜¯å¤šä¸ªåŒç±»æˆ–å¼‚ç±»å‡ ä½•å›¾å½¢å…ƒç´ çš„ç»„åˆï¼š</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211104193330204.png"></p><h2 id="13-å°ç»“åŠé€‰æ‹©å»ºè®®"><a href="#13-å°ç»“åŠé€‰æ‹©å»ºè®®" class="headerlink" title="13. å°ç»“åŠé€‰æ‹©å»ºè®®"></a>13. å°ç»“åŠé€‰æ‹©å»ºè®®</h2><p>åœ¨å®šä¹‰æ•°æ®ç±»å‹æ—¶ï¼Œå¦‚æœç¡®å®šæ˜¯<code>æ•´æ•°</code>ï¼Œå°±ç”¨<code> INT</code>ï¼› å¦‚æœæ˜¯<code>å°æ•°</code>ï¼Œä¸€å®šç”¨å®šç‚¹æ•°ç±»å‹ <code>DECIMAL(M,D)</code>ï¼› å¦‚æœæ˜¯æ—¥æœŸä¸æ—¶é—´ï¼Œå°±ç”¨ <code>DATETIME</code>ã€‚ </p><p>è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œé¦–å…ˆç¡®ä¿ä½ çš„ç³»ç»Ÿä¸ä¼šå› ä¸ºæ•°æ®ç±»å‹å®šä¹‰å‡ºé”™ï¼ˆä¸ä¼šæ’å…¥æ•°æ®æ—¶äº§ç”Ÿæº¢å‡ºï¼‰ã€‚ä¸è¿‡ï¼Œå‡¡äº‹éƒ½æ˜¯æœ‰ä¸¤é¢çš„ï¼Œå¯é æ€§å¥½ï¼Œå¹¶ä¸æ„å‘³ç€é«˜æ•ˆã€‚æ¯”å¦‚ï¼ŒTEXT è™½ç„¶ä½¿ç”¨æ–¹ä¾¿ï¼Œä½†æ˜¯æ•ˆç‡ä¸å¦‚ CHAR(M) å’Œ VARCHAR(M)ã€‚</p><p>å…³äºå­—ç¬¦ä¸²çš„é€‰æ‹©ï¼Œå»ºè®®å‚è€ƒå¦‚ä¸‹é˜¿é‡Œå·´å·´çš„ã€ŠJavaå¼€å‘æ‰‹å†Œã€‹è§„èŒƒï¼š</p><p><strong>é˜¿é‡Œå·´å·´ã€ŠJavaå¼€å‘æ‰‹å†Œã€‹ä¹‹MySQLæ•°æ®åº“ï¼š</strong></p><ul><li>ä»»ä½•å­—æ®µå¦‚æœä¸ºéè´Ÿæ•°ï¼Œå¿…é¡»æ˜¯ UNSIGNED</li><li>ã€<code>å¼ºåˆ¶</code>ã€‘å°æ•°ç±»å‹ä¸º DECIMALï¼Œç¦æ­¢ä½¿ç”¨ FLOAT å’Œ DOUBLEã€‚ <ul><li>è¯´æ˜ï¼šåœ¨å­˜å‚¨çš„æ—¶å€™ï¼ŒFLOAT å’Œ DOUBLE éƒ½å­˜åœ¨ç²¾åº¦æŸå¤±çš„é—®é¢˜ï¼Œå¾ˆå¯èƒ½åœ¨æ¯”è¾ƒå€¼çš„æ—¶å€™ï¼Œå¾—åˆ°ä¸æ­£ç¡®çš„ç»“æœã€‚å¦‚æœå­˜å‚¨çš„æ•°æ®èŒƒå›´è¶…è¿‡ DECIMAL çš„èŒƒå›´ï¼Œå»ºè®®å°†æ•°æ®æ‹†æˆæ•´æ•°å’Œå°æ•°å¹¶åˆ†å¼€å­˜å‚¨ã€‚</li></ul></li><li>ã€<code>å¼ºåˆ¶</code>ã€‘å¦‚æœå­˜å‚¨çš„å­—ç¬¦ä¸²é•¿åº¦å‡ ä¹ç›¸ç­‰ï¼Œä½¿ç”¨ CHAR å®šé•¿å­—ç¬¦ä¸²ç±»å‹ã€‚ </li><li>ã€<code>å¼ºåˆ¶</code>ã€‘VARCHAR æ˜¯å¯å˜é•¿å­—ç¬¦ä¸²ï¼Œä¸é¢„å…ˆåˆ†é…å­˜å‚¨ç©ºé—´ï¼Œé•¿åº¦ä¸è¦è¶…è¿‡ 5000ã€‚å¦‚æœå­˜å‚¨é•¿åº¦å¤§äºæ­¤å€¼ï¼Œå®šä¹‰å­—æ®µç±»å‹ä¸º TEXTï¼Œç‹¬ç«‹å‡ºæ¥ä¸€å¼ è¡¨ï¼Œç”¨ä¸»é”®æ¥å¯¹åº”ï¼Œé¿å…å½±å“å…¶å®ƒå­—æ®µç´¢å¼•æ•ˆç‡ã€‚</li></ul><h1 id="ç¬¬13ç« -çº¦æŸ"><a href="#ç¬¬13ç« -çº¦æŸ" class="headerlink" title="ç¬¬13ç« _çº¦æŸ"></a>ç¬¬13ç« _çº¦æŸ</h1><h2 id="1-çº¦æŸ-constraint-æ¦‚è¿°"><a href="#1-çº¦æŸ-constraint-æ¦‚è¿°" class="headerlink" title="1. çº¦æŸ(constraint)æ¦‚è¿°"></a>1. çº¦æŸ(constraint)æ¦‚è¿°</h2><h3 id="1-1-ä¸ºä»€ä¹ˆéœ€è¦çº¦æŸ"><a href="#1-1-ä¸ºä»€ä¹ˆéœ€è¦çº¦æŸ" class="headerlink" title="1.1 ä¸ºä»€ä¹ˆéœ€è¦çº¦æŸ"></a>1.1 ä¸ºä»€ä¹ˆéœ€è¦çº¦æŸ</h3><p>æ•°æ®å®Œæ•´æ€§ï¼ˆData Integrityï¼‰æ˜¯æŒ‡æ•°æ®çš„ç²¾ç¡®æ€§ï¼ˆAccuracyï¼‰å’Œå¯é æ€§ï¼ˆReliabilityï¼‰ã€‚å®ƒæ˜¯é˜²æ­¢æ•°æ®åº“ä¸­å­˜åœ¨ä¸ç¬¦åˆè¯­ä¹‰è§„å®šçš„æ•°æ®å’Œé˜²æ­¢å› é”™è¯¯ä¿¡æ¯çš„è¾“å…¥è¾“å‡ºé€ æˆæ— æ•ˆæ“ä½œæˆ–é”™è¯¯ä¿¡æ¯è€Œæå‡ºçš„ã€‚</p><p>ä¸ºäº†ä¿è¯æ•°æ®çš„å®Œæ•´æ€§ï¼ŒSQLè§„èŒƒä»¥çº¦æŸçš„æ–¹å¼å¯¹<strong>è¡¨æ•°æ®è¿›è¡Œé¢å¤–çš„æ¡ä»¶é™åˆ¶</strong>ã€‚ä»ä»¥ä¸‹å››ä¸ªæ–¹é¢è€ƒè™‘ï¼š</p><ul><li><code>å®ä½“å®Œæ•´æ€§ï¼ˆEntity Integrityï¼‰</code>ï¼šä¾‹å¦‚ï¼ŒåŒä¸€ä¸ªè¡¨ä¸­ï¼Œä¸èƒ½å­˜åœ¨ä¸¤æ¡å®Œå…¨ç›¸åŒæ— æ³•åŒºåˆ†çš„è®°å½•</li><li><code>åŸŸå®Œæ•´æ€§ï¼ˆDomain Integrityï¼‰</code>ï¼šä¾‹å¦‚ï¼šå¹´é¾„èŒƒå›´0-120ï¼Œæ€§åˆ«èŒƒå›´â€œç”·/å¥³â€</li><li><code>å¼•ç”¨å®Œæ•´æ€§ï¼ˆReferential Integrityï¼‰</code>ï¼šä¾‹å¦‚ï¼šå‘˜å·¥æ‰€åœ¨éƒ¨é—¨ï¼Œåœ¨éƒ¨é—¨è¡¨ä¸­è¦èƒ½æ‰¾åˆ°è¿™ä¸ªéƒ¨é—¨</li><li><code>ç”¨æˆ·è‡ªå®šä¹‰å®Œæ•´æ€§ï¼ˆUser-defined Integrityï¼‰</code>ï¼šä¾‹å¦‚ï¼šç”¨æˆ·åå”¯ä¸€ã€å¯†ç ä¸èƒ½ä¸ºç©ºç­‰ï¼Œæœ¬éƒ¨é—¨ç»ç†çš„å·¥èµ„ä¸å¾—é«˜äºæœ¬éƒ¨é—¨èŒå·¥çš„å¹³å‡å·¥èµ„çš„5å€ã€‚</li></ul><h3 id="1-2-ä»€ä¹ˆæ˜¯çº¦æŸ"><a href="#1-2-ä»€ä¹ˆæ˜¯çº¦æŸ" class="headerlink" title="1.2 ä»€ä¹ˆæ˜¯çº¦æŸ"></a>1.2 ä»€ä¹ˆæ˜¯çº¦æŸ</h3><p>çº¦æŸæ˜¯è¡¨çº§çš„å¼ºåˆ¶è§„å®šã€‚</p><p>å¯ä»¥åœ¨<strong>åˆ›å»ºè¡¨æ—¶è§„å®šçº¦æŸï¼ˆé€šè¿‡ CREATE TABLE è¯­å¥ï¼‰</strong>ï¼Œæˆ–è€…åœ¨<strong>è¡¨åˆ›å»ºä¹‹åé€šè¿‡ ALTER TABLE è¯­å¥è§„å®šçº¦æŸ</strong>ã€‚</p><h3 id="1-3-çº¦æŸçš„åˆ†ç±»"><a href="#1-3-çº¦æŸçš„åˆ†ç±»" class="headerlink" title="1.3 çº¦æŸçš„åˆ†ç±»"></a>1.3 çº¦æŸçš„åˆ†ç±»</h3><ul><li><strong>æ ¹æ®çº¦æŸæ•°æ®åˆ—çš„é™åˆ¶ï¼Œ</strong>çº¦æŸå¯åˆ†ä¸ºï¼š<ul><li><strong>å•åˆ—çº¦æŸ</strong>ï¼šæ¯ä¸ªçº¦æŸåªçº¦æŸä¸€åˆ—</li><li><strong>å¤šåˆ—çº¦æŸ</strong>ï¼šæ¯ä¸ªçº¦æŸå¯çº¦æŸå¤šåˆ—æ•°æ®</li></ul></li><li><strong>æ ¹æ®çº¦æŸçš„ä½œç”¨èŒƒå›´</strong>ï¼Œçº¦æŸå¯åˆ†ä¸ºï¼š<ul><li><strong>åˆ—çº§çº¦æŸ</strong>ï¼šåªèƒ½ä½œç”¨åœ¨ä¸€ä¸ªåˆ—ä¸Šï¼Œè·Ÿåœ¨åˆ—çš„å®šä¹‰åé¢</li><li><strong>è¡¨çº§çº¦æŸ</strong>ï¼šå¯ä»¥ä½œç”¨åœ¨å¤šä¸ªåˆ—ä¸Šï¼Œä¸ä¸åˆ—ä¸€èµ·ï¼Œè€Œæ˜¯å•ç‹¬å®šä¹‰</li></ul></li></ul><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs">ä½ç½®æ”¯æŒçš„çº¦æŸç±»å‹æ˜¯å¦å¯ä»¥èµ·çº¦æŸå<br>åˆ—çº§çº¦æŸï¼šåˆ—çš„åé¢è¯­æ³•éƒ½æ”¯æŒï¼Œä½†å¤–é”®æ²¡æœ‰æ•ˆæœä¸å¯ä»¥<br>è¡¨çº§çº¦æŸï¼šæ‰€æœ‰åˆ—çš„ä¸‹é¢   é»˜è®¤å’Œéç©ºä¸æ”¯æŒï¼Œå…¶ä»–æ”¯æŒ   å¯ä»¥ï¼ˆä¸»é”®æ²¡æœ‰æ•ˆæœï¼‰<br></code></pre></td></tr></table></figure><ul><li><strong>æ ¹æ®çº¦æŸèµ·çš„ä½œç”¨</strong>ï¼Œçº¦æŸå¯åˆ†ä¸ºï¼š<ul><li><strong>NOT NULL</strong> <strong>éç©ºçº¦æŸï¼Œè§„å®šæŸä¸ªå­—æ®µä¸èƒ½ä¸ºç©º</strong></li><li><strong>UNIQUE</strong>  <strong>å”¯ä¸€çº¦æŸ</strong>ï¼Œ<strong>è§„å®šæŸä¸ªå­—æ®µåœ¨æ•´ä¸ªè¡¨ä¸­æ˜¯å”¯ä¸€çš„</strong></li><li><strong>PRIMARY KEY  ä¸»é”®(éç©ºä¸”å”¯ä¸€)çº¦æŸ</strong></li><li><strong>FOREIGN KEY</strong>  <strong>å¤–é”®çº¦æŸ</strong></li><li><strong>CHECK</strong>  <strong>æ£€æŸ¥çº¦æŸ</strong></li><li><strong>DEFAULT</strong>  <strong>é»˜è®¤å€¼çº¦æŸ</strong></li></ul></li></ul><blockquote><p>æ³¨æ„ï¼š MySQLä¸æ”¯æŒcheckçº¦æŸï¼Œä½†å¯ä»¥ä½¿ç”¨checkçº¦æŸï¼Œè€Œæ²¡æœ‰ä»»ä½•æ•ˆæœ</p></blockquote><ul><li>æŸ¥çœ‹æŸä¸ªè¡¨å·²æœ‰çš„çº¦æŸ</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#information_schemaæ•°æ®åº“åï¼ˆç³»ç»Ÿåº“ï¼‰<br>#table_constraintsè¡¨åç§°ï¼ˆä¸“é—¨å­˜å‚¨å„ä¸ªè¡¨çš„çº¦æŸï¼‰<br>SELECT * FROM information_schema.table_constraints <br>WHERE table_name = &#x27;è¡¨åç§°&#x27;; #éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œæ˜¯ä¸€ä¸ªè¡¨ï¼Œè¡¨åæ˜¯ä½œä¸ºä¸€ä¸ªå­—ç¬¦ä¸²å‡ºç°åœ¨è¡¨ä¸­çš„ï¼Œæ‰€ä»¥éœ€è¦å•å¼•å·ã€‚<br></code></pre></td></tr></table></figure><h2 id="2-éç©ºçº¦æŸ"><a href="#2-éç©ºçº¦æŸ" class="headerlink" title="2. éç©ºçº¦æŸ"></a>2. éç©ºçº¦æŸ</h2><h3 id="2-1-ä½œç”¨"><a href="#2-1-ä½œç”¨" class="headerlink" title="2.1 ä½œç”¨"></a>2.1 ä½œç”¨</h3><p>é™å®šæŸä¸ªå­—æ®µ/æŸåˆ—çš„å€¼ä¸å…è®¸ä¸ºç©º</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1555426972098.png"></p><h3 id="2-2-å…³é”®å­—"><a href="#2-2-å…³é”®å­—" class="headerlink" title="2.2 å…³é”®å­—"></a>2.2 å…³é”®å­—</h3><p>NOT NULL</p><h3 id="2-3-ç‰¹ç‚¹"><a href="#2-3-ç‰¹ç‚¹" class="headerlink" title="2.3 ç‰¹ç‚¹"></a>2.3 ç‰¹ç‚¹</h3><ul><li><p>é»˜è®¤ï¼Œæ‰€æœ‰çš„ç±»å‹çš„å€¼éƒ½å¯ä»¥æ˜¯NULLï¼ŒåŒ…æ‹¬INTã€FLOATç­‰æ•°æ®ç±»å‹</p></li><li><p>éç©ºçº¦æŸåªèƒ½å‡ºç°åœ¨è¡¨å¯¹è±¡çš„åˆ—ä¸Šï¼Œåªèƒ½æŸä¸ªåˆ—å•ç‹¬é™å®šéç©ºï¼Œä¸èƒ½ç»„åˆéç©º(åªèƒ½ä½¿ç”¨åˆ—çº§çº¦æŸï¼Œä¸èƒ½ä½¿ç”¨è¡¨çº§çº¦æŸ)</p></li><li><p>ä¸€ä¸ªè¡¨å¯ä»¥æœ‰å¾ˆå¤šåˆ—éƒ½åˆ†åˆ«é™å®šäº†éç©º</p></li><li><p>ç©ºå­—ç¬¦ä¸²â€™â€™ä¸ç­‰äºNULLï¼Œ0ä¹Ÿä¸ç­‰äºNULL</p></li></ul><h3 id="2-4-æ·»åŠ éç©ºçº¦æŸ"><a href="#2-4-æ·»åŠ éç©ºçº¦æŸ" class="headerlink" title="2.4 æ·»åŠ éç©ºçº¦æŸ"></a>2.4 æ·»åŠ éç©ºçº¦æŸ</h3><p>ï¼ˆ1ï¼‰å»ºè¡¨æ—¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE TABLE è¡¨åç§°(<br>å­—æ®µå  æ•°æ®ç±»å‹,<br>    å­—æ®µå  æ•°æ®ç±»å‹ NOT NULL,  <br>    å­—æ®µå  æ•°æ®ç±»å‹ NOT NULL<br>);<br></code></pre></td></tr></table></figure><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE TABLE emp(<br>id INT(10) NOT NULL,<br>NAME VARCHAR(20) NOT NULL,<br>sex CHAR NULL<br>);<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE TABLE student(<br>sid int,<br>    sname varchar(20) not null,<br>    tel char(11) ,<br>    cardid char(18) not null<br>);<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs mysql">insert into student values(1,&#x27;å¼ ä¸‰&#x27;,&#x27;13710011002&#x27;,&#x27;110222198912032545&#x27;); #æˆåŠŸ<br><br>insert into student values(2,&#x27;æå››&#x27;,&#x27;13710011002&#x27;,null);#èº«ä»½è¯å·ä¸ºç©º<br>ERROR 1048 (23000): Column &#x27;cardid&#x27; cannot be null<br><br>insert into student values(2,&#x27;æå››&#x27;,null,&#x27;110222198912032546&#x27;);#æˆåŠŸï¼Œtelå…è®¸ä¸ºç©º<br><br>insert into student values(3,null,null,&#x27;110222198912032547&#x27;);#å¤±è´¥<br>ERROR 1048 (23000): Column &#x27;sname&#x27; cannot be null<br><br>update student <br>set sname = NULL<br>where id = 1; #å¤±è´¥<br>Column &#x27;sname&#x27; cannot be null<br></code></pre></td></tr></table></figure><p>ï¼ˆ2ï¼‰å»ºè¡¨å</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">alter table è¡¨åç§° modify å­—æ®µå æ•°æ®ç±»å‹ not null;<br></code></pre></td></tr></table></figure><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">ALTER TABLE emp<br>MODIFY sex VARCHAR(30) NOT NULL;<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">alter table student modify sname varchar(20) not null;<br></code></pre></td></tr></table></figure><h3 id="2-5-åˆ é™¤éç©ºçº¦æŸ"><a href="#2-5-åˆ é™¤éç©ºçº¦æŸ" class="headerlink" title="2.5 åˆ é™¤éç©ºçº¦æŸ"></a>2.5 åˆ é™¤éç©ºçº¦æŸ</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">alter table è¡¨åç§° modify å­—æ®µå æ•°æ®ç±»å‹ NULL;#å»æ‰not nullï¼Œç›¸å½“äºä¿®æ”¹æŸä¸ªéæ³¨è§£å­—æ®µï¼Œè¯¥å­—æ®µå…è®¸ä¸ºç©º<br><br>æˆ– <br><br>alter table è¡¨åç§° modify å­—æ®µå æ•°æ®ç±»å‹;#å»æ‰not nullï¼Œç›¸å½“äºä¿®æ”¹æŸä¸ªéæ³¨è§£å­—æ®µï¼Œè¯¥å­—æ®µå…è®¸ä¸ºç©º<br></code></pre></td></tr></table></figure><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">ALTER TABLE emp<br>MODIFY sex VARCHAR(30) NULL;<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">ALTER TABLE emp<br>MODIFY NAME VARCHAR(15) DEFAULT &#x27;abc&#x27; NULL;<br></code></pre></td></tr></table></figure><h2 id="3-å”¯ä¸€æ€§çº¦æŸ"><a href="#3-å”¯ä¸€æ€§çº¦æŸ" class="headerlink" title="3. å”¯ä¸€æ€§çº¦æŸ"></a>3. å”¯ä¸€æ€§çº¦æŸ</h2><h3 id="3-1-ä½œç”¨"><a href="#3-1-ä½œç”¨" class="headerlink" title="3.1 ä½œç”¨"></a>3.1 ä½œç”¨</h3><p>ç”¨æ¥é™åˆ¶æŸä¸ªå­—æ®µ/æŸåˆ—çš„å€¼ä¸èƒ½é‡å¤ã€‚</p><p> <img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1555427198811.png"></p><h3 id="3-2-å…³é”®å­—"><a href="#3-2-å…³é”®å­—" class="headerlink" title="3.2 å…³é”®å­—"></a>3.2 å…³é”®å­—</h3><p>UNIQUE</p><h3 id="3-3-ç‰¹ç‚¹"><a href="#3-3-ç‰¹ç‚¹" class="headerlink" title="3.3 ç‰¹ç‚¹"></a>3.3 ç‰¹ç‚¹</h3><ul><li>åŒä¸€ä¸ªè¡¨å¯ä»¥æœ‰å¤šä¸ªå”¯ä¸€çº¦æŸã€‚</li><li>å”¯ä¸€çº¦æŸå¯ä»¥æ˜¯æŸä¸€ä¸ªåˆ—çš„å€¼å”¯ä¸€ï¼Œä¹Ÿå¯ä»¥å¤šä¸ªåˆ—ç»„åˆçš„å€¼å”¯ä¸€ã€‚</li><li>å”¯ä¸€æ€§çº¦æŸå…è®¸åˆ—å€¼ä¸ºç©ºï¼Œè€Œä¸”å…è®¸å‡ºç°å¤šä¸ªNULLå€¼ã€‚</li><li>åœ¨åˆ›å»ºå”¯ä¸€çº¦æŸçš„æ—¶å€™ï¼Œå¦‚æœä¸ç»™å”¯ä¸€çº¦æŸå‘½åï¼Œå°±é»˜è®¤å’Œåˆ—åç›¸åŒã€‚</li><li><strong>MySQLä¼šç»™å”¯ä¸€çº¦æŸçš„åˆ—ä¸Šé»˜è®¤åˆ›å»ºä¸€ä¸ªå”¯ä¸€ç´¢å¼•ã€‚</strong></li></ul><h3 id="3-4-æ·»åŠ å”¯ä¸€çº¦æŸ"><a href="#3-4-æ·»åŠ å”¯ä¸€çº¦æŸ" class="headerlink" title="3.4 æ·»åŠ å”¯ä¸€çº¦æŸ"></a>3.4 æ·»åŠ å”¯ä¸€çº¦æŸ</h3><p>ï¼ˆ1ï¼‰å»ºè¡¨æ—¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs mysql">create table è¡¨åç§°(<br>å­—æ®µå  æ•°æ®ç±»å‹,<br>    å­—æ®µå  æ•°æ®ç±»å‹  unique,  <br>    å­—æ®µå  æ•°æ®ç±»å‹  unique key,<br>    å­—æ®µå  æ•°æ®ç±»å‹<br>);<br>create table è¡¨åç§°(<br>å­—æ®µå  æ•°æ®ç±»å‹,<br>    å­—æ®µå  æ•°æ®ç±»å‹,  <br>    å­—æ®µå  æ•°æ®ç±»å‹,<br>    [constraint çº¦æŸå] unique key(å­—æ®µå) #å¯ä»¥ä¸èµ·çº¦æŸå<br>);<br></code></pre></td></tr></table></figure><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs mysql">create table student(<br>sid int,<br>    sname varchar(20),<br>    tel char(11) unique,<br>    cardid char(18) unique key<br>);<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE TABLE t_course(<br>cid INT UNIQUE,<br>cname VARCHAR(100) UNIQUE,<br>description VARCHAR(200)<br>);<br><br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE TABLE USER(<br> id INT NOT NULL,<br> NAME VARCHAR(25),<br> PASSWORD VARCHAR(16),<br> -- ä½¿ç”¨è¡¨çº§çº¦æŸè¯­æ³•<br> CONSTRAINT uk_name_pwd UNIQUE(NAME,PASSWORD)<br>);<br></code></pre></td></tr></table></figure><blockquote><p>è¡¨ç¤ºç”¨æˆ·åå’Œå¯†ç ç»„åˆä¸èƒ½é‡å¤</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">insert into student values(1,&#x27;å¼ ä¸‰&#x27;,&#x27;13710011002&#x27;,&#x27;101223199012015623&#x27;);<br>insert into student values(2,&#x27;æå››&#x27;,&#x27;13710011003&#x27;,&#x27;101223199012015624&#x27;);<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select * from student;<br>+-----+-------+-------------+--------------------+<br>| sid | sname | tel         | cardid             |<br>+-----+-------+-------------+--------------------+<br>|   1 | å¼ ä¸‰  | 13710011002 | 101223199012015623 |<br>|   2 | æå››  | 13710011003 | 101223199012015624 |<br>+-----+-------+-------------+--------------------+<br>2 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">insert into student values(3,&#x27;ç‹äº”&#x27;,&#x27;13710011004&#x27;,&#x27;101223199012015624&#x27;); #èº«ä»½è¯å·é‡å¤<br>ERROR 1062 (23000): Duplicate entry &#x27;101223199012015624&#x27; for key &#x27;cardid&#x27;<br><br>insert into student values(3,&#x27;ç‹äº”&#x27;,&#x27;13710011003&#x27;,&#x27;101223199012015625&#x27;); <br>ERROR 1062 (23000): Duplicate entry &#x27;13710011003&#x27; for key &#x27;tel&#x27;<br></code></pre></td></tr></table></figure><p>ï¼ˆ2ï¼‰å»ºè¡¨åæŒ‡å®šå”¯ä¸€é”®çº¦æŸ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#å­—æ®µåˆ—è¡¨ä¸­å¦‚æœæ˜¯ä¸€ä¸ªå­—æ®µï¼Œè¡¨ç¤ºè¯¥åˆ—çš„å€¼å”¯ä¸€ã€‚å¦‚æœæ˜¯ä¸¤ä¸ªæˆ–æ›´å¤šä¸ªå­—æ®µï¼Œé‚£ä¹ˆå¤åˆå”¯ä¸€ï¼Œå³å¤šä¸ªå­—æ®µçš„ç»„åˆæ˜¯å”¯ä¸€çš„<br>#æ–¹å¼1ï¼š<br>alter table è¡¨åç§° add [constraint çº¦æŸåç§°] unique [key] (å­—æ®µåˆ—è¡¨); <br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#æ–¹å¼2ï¼š<br>alter table è¡¨åç§° modify å­—æ®µå å­—æ®µç±»å‹ unique;<br></code></pre></td></tr></table></figure><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">ALTER TABLE USER <br>ADD UNIQUE(NAME,PASSWORD);<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">ALTER TABLE USER <br>ADD CONSTRAINT uk_name_pwd UNIQUE(NAME,PASSWORD);<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">ALTER TABLE USER <br>MODIFY NAME VARCHAR(20) UNIQUE;<br></code></pre></td></tr></table></figure><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs mysql">create table student(<br>sid int primary key,<br>    sname varchar(20),<br>    tel char(11) ,<br>    cardid char(18) <br>);<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">alter table student add unique key(tel);<br>alter table student add unique key(cardid);<br></code></pre></td></tr></table></figure><h3 id="3-5-å…³äºå¤åˆå”¯ä¸€çº¦æŸ"><a href="#3-5-å…³äºå¤åˆå”¯ä¸€çº¦æŸ" class="headerlink" title="3.5 å…³äºå¤åˆå”¯ä¸€çº¦æŸ"></a>3.5 å…³äºå¤åˆå”¯ä¸€çº¦æŸ</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs mysql">create table è¡¨åç§°(<br>å­—æ®µå  æ•°æ®ç±»å‹,<br>    å­—æ®µå  æ•°æ®ç±»å‹,  <br>    å­—æ®µå  æ•°æ®ç±»å‹,<br>    unique key(å­—æ®µåˆ—è¡¨) #å­—æ®µåˆ—è¡¨ä¸­å†™çš„æ˜¯å¤šä¸ªå­—æ®µåï¼Œå¤šä¸ªå­—æ®µåç”¨é€—å·åˆ†éš”ï¼Œè¡¨ç¤ºé‚£ä¹ˆæ˜¯å¤åˆå”¯ä¸€ï¼Œå³å¤šä¸ªå­—æ®µçš„ç»„åˆæ˜¯å”¯ä¸€çš„<br>);<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#å­¦ç”Ÿè¡¨<br>create table student(<br>sid int,#å­¦å·<br>    sname varchar(20),#å§“å<br>    tel char(11) unique key,  #ç”µè¯<br>    cardid char(18) unique key #èº«ä»½è¯å·<br>);<br><br>#è¯¾ç¨‹è¡¨<br>create table course(<br>cid int,  #è¯¾ç¨‹ç¼–å·<br>    cname varchar(20)     #è¯¾ç¨‹åç§°<br>);<br><br>#é€‰è¯¾è¡¨<br>create table student_course(<br>    id int,<br>sid int,<br>    cid int,<br>    score int,<br>    unique key(sid,cid)  #å¤åˆå”¯ä¸€<br>);<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">insert into student values(1,&#x27;å¼ ä¸‰&#x27;,&#x27;13710011002&#x27;,&#x27;101223199012015623&#x27;);#æˆåŠŸ<br>insert into student values(2,&#x27;æå››&#x27;,&#x27;13710011003&#x27;,&#x27;101223199012015624&#x27;);#æˆåŠŸ<br>insert into course values(1001,&#x27;Java&#x27;),(1002,&#x27;MySQL&#x27;);#æˆåŠŸ<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select * from student;<br>+-----+-------+-------------+--------------------+<br>| sid | sname | tel         | cardid             |<br>+-----+-------+-------------+--------------------+<br>|   1 | å¼ ä¸‰  | 13710011002 | 101223199012015623 |<br>|   2 | æå››  | 13710011003 | 101223199012015624 |<br>+-----+-------+-------------+--------------------+<br>2 rows in set (0.00 sec)<br><br>mysql&gt; select * from course;<br>+------+-------+<br>| cid  | cname |<br>+------+-------+<br>| 1001 | Java  |<br>| 1002 | MySQL |<br>+------+-------+<br>2 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">insert into student_course values<br>(1, 1, 1001, 89),<br>(2, 1, 1002, 90),<br>(3, 2, 1001, 88),<br>(4, 2, 1002, 56);#æˆåŠŸ<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select * from student_course;<br>+----+------+------+-------+<br>| id | sid  | cid  | score |<br>+----+------+------+-------+<br>|  1 |    1 | 1001 |    89 |<br>|  2 |    1 | 1002 |    90 |<br>|  3 |    2 | 1001 |    88 |<br>|  4 |    2 | 1002 |    56 |<br>+----+------+------+-------+<br>4 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">insert into student_course values (5, 1, 1001, 88);#å¤±è´¥<br><br>#ERROR 1062 (23000): Duplicate entry &#x27;1-1001&#x27; for key &#x27;sid&#x27;   è¿åsid-cidçš„å¤åˆå”¯ä¸€<br></code></pre></td></tr></table></figure><h3 id="3-5-åˆ é™¤å”¯ä¸€çº¦æŸ"><a href="#3-5-åˆ é™¤å”¯ä¸€çº¦æŸ" class="headerlink" title="3.5 åˆ é™¤å”¯ä¸€çº¦æŸ"></a>3.5 åˆ é™¤å”¯ä¸€çº¦æŸ</h3><ul><li>æ·»åŠ å”¯ä¸€æ€§çº¦æŸçš„åˆ—ä¸Šä¹Ÿä¼šè‡ªåŠ¨åˆ›å»ºå”¯ä¸€ç´¢å¼•ã€‚</li><li>åˆ é™¤å”¯ä¸€çº¦æŸåªèƒ½é€šè¿‡åˆ é™¤å”¯ä¸€ç´¢å¼•çš„æ–¹å¼åˆ é™¤ã€‚</li><li>åˆ é™¤æ—¶éœ€è¦æŒ‡å®šå”¯ä¸€ç´¢å¼•åï¼Œå”¯ä¸€ç´¢å¼•åä¸å¯¹åº”å”¯ä¸€çº¦æŸåä¸€æ ·ã€‚</li><li>å¦‚æœåˆ›å»ºå”¯ä¸€çº¦æŸæ—¶æœªæŒ‡å®šåç§°ï¼Œå¦‚æœæ˜¯å•åˆ—ï¼Œå°±é»˜è®¤å’Œåˆ—åç›¸åŒï¼›å¦‚æœæ˜¯ç»„åˆåˆ—ï¼Œé‚£ä¹ˆé»˜è®¤å’Œ()ä¸­æ’åœ¨ç¬¬ä¸€ä¸ªçš„åˆ—åç›¸åŒã€‚ä¹Ÿå¯ä»¥è‡ªå®šä¹‰å”¯ä¸€æ€§çº¦æŸåã€‚</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT * FROM information_schema.table_constraints WHERE table_name = &#x27;è¡¨å&#x27;; #æŸ¥çœ‹éƒ½æœ‰å“ªäº›çº¦æŸ<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">ALTER TABLE è¡¨æ°‘ <br>DROP INDEX uk_name_pwd;<br></code></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼šå¯ä»¥é€šè¿‡ <code>show index from è¡¨åç§°; </code>æŸ¥çœ‹è¡¨çš„ç´¢å¼•</p></blockquote><h2 id="4-PRIMARY-KEY-çº¦æŸ"><a href="#4-PRIMARY-KEY-çº¦æŸ" class="headerlink" title="4. PRIMARY KEY çº¦æŸ"></a>4. PRIMARY KEY çº¦æŸ</h2><h3 id="4-1-ä½œç”¨"><a href="#4-1-ä½œç”¨" class="headerlink" title="4.1 ä½œç”¨"></a>4.1 ä½œç”¨</h3><p>ç”¨æ¥å”¯ä¸€æ ‡è¯†è¡¨ä¸­çš„ä¸€è¡Œè®°å½•ã€‚</p><h3 id="4-2-å…³é”®å­—"><a href="#4-2-å…³é”®å­—" class="headerlink" title="4.2 å…³é”®å­—"></a>4.2 å…³é”®å­—</h3><p>primary key</p><h3 id="4-3-ç‰¹ç‚¹"><a href="#4-3-ç‰¹ç‚¹" class="headerlink" title="4.3 ç‰¹ç‚¹"></a>4.3 ç‰¹ç‚¹</h3><ul><li>ä¸»é”®çº¦æŸç›¸å½“äº<strong>å”¯ä¸€çº¦æŸ+éç©ºçº¦æŸçš„ç»„åˆ</strong>ï¼Œä¸»é”®çº¦æŸåˆ—ä¸å…è®¸é‡å¤ï¼Œä¹Ÿä¸å…è®¸å‡ºç°ç©ºå€¼ã€‚</li></ul><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1555427492244.png"></p><ul><li>ä¸€ä¸ªè¡¨æœ€å¤šåªèƒ½æœ‰ä¸€ä¸ªä¸»é”®çº¦æŸï¼Œå»ºç«‹ä¸»é”®çº¦æŸå¯ä»¥åœ¨åˆ—çº§åˆ«åˆ›å»ºï¼Œä¹Ÿå¯ä»¥åœ¨è¡¨çº§åˆ«ä¸Šåˆ›å»ºã€‚</li></ul><ul><li><p>ä¸»é”®çº¦æŸå¯¹åº”ç€è¡¨ä¸­çš„ä¸€åˆ—æˆ–è€…å¤šåˆ—ï¼ˆå¤åˆä¸»é”®ï¼‰</p></li><li><p>å¦‚æœæ˜¯å¤šåˆ—ç»„åˆçš„å¤åˆä¸»é”®çº¦æŸï¼Œé‚£ä¹ˆè¿™äº›åˆ—éƒ½ä¸å…è®¸ä¸ºç©ºå€¼ï¼Œå¹¶ä¸”ç»„åˆçš„å€¼ä¸å…è®¸é‡å¤ã€‚</p></li><li><p><strong>MySQLçš„ä¸»é”®åæ€»æ˜¯PRIMARY</strong>ï¼Œå°±ç®—è‡ªå·±å‘½åäº†ä¸»é”®çº¦æŸåä¹Ÿæ²¡ç”¨ã€‚</p></li><li><p>å½“åˆ›å»ºä¸»é”®çº¦æŸæ—¶ï¼Œç³»ç»Ÿé»˜è®¤ä¼šåœ¨æ‰€åœ¨çš„åˆ—æˆ–åˆ—ç»„åˆä¸Šå»ºç«‹å¯¹åº”çš„<strong>ä¸»é”®ç´¢å¼•</strong>ï¼ˆèƒ½å¤Ÿæ ¹æ®ä¸»é”®æŸ¥è¯¢çš„ï¼Œå°±æ ¹æ®ä¸»é”®æŸ¥è¯¢ï¼Œæ•ˆç‡æ›´é«˜ï¼‰ã€‚å¦‚æœåˆ é™¤ä¸»é”®çº¦æŸäº†ï¼Œä¸»é”®çº¦æŸå¯¹åº”çš„ç´¢å¼•å°±è‡ªåŠ¨åˆ é™¤äº†ã€‚</p></li></ul><ul><li>éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œä¸è¦ä¿®æ”¹ä¸»é”®å­—æ®µçš„å€¼ã€‚å› ä¸ºä¸»é”®æ˜¯æ•°æ®è®°å½•çš„å”¯ä¸€æ ‡è¯†ï¼ˆå•çº¯UNIQUEä¸èƒ½ä¿è¯å”¯ä¸€ï¼Œå› ä¸ºå¯ä»¥å¤šä¸ªNULLå€¼ï¼‰ï¼Œå¦‚æœä¿®æ”¹äº†ä¸»é”®çš„å€¼ï¼Œå°±æœ‰å¯èƒ½ä¼šç ´åæ•°æ®çš„å®Œæ•´æ€§ã€‚</li></ul><h3 id="4-4-æ·»åŠ ä¸»é”®çº¦æŸ"><a href="#4-4-æ·»åŠ ä¸»é”®çº¦æŸ" class="headerlink" title="4.4 æ·»åŠ ä¸»é”®çº¦æŸ"></a>4.4 æ·»åŠ ä¸»é”®çº¦æŸ</h3><p>ï¼ˆ1ï¼‰å»ºè¡¨æ—¶æŒ‡å®šä¸»é”®çº¦æŸ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs mysql">create table è¡¨åç§°(<br>å­—æ®µå  æ•°æ®ç±»å‹  primary key, #åˆ—çº§æ¨¡å¼<br>    å­—æ®µå  æ•°æ®ç±»å‹,  <br>    å­—æ®µå  æ•°æ®ç±»å‹  <br>);<br>create table è¡¨åç§°(<br>å­—æ®µå  æ•°æ®ç±»å‹,<br>    å­—æ®µå  æ•°æ®ç±»å‹,  <br>    å­—æ®µå  æ•°æ®ç±»å‹,<br>    [constraint çº¦æŸå] primary key(å­—æ®µå) #è¡¨çº§æ¨¡å¼<br>);<br></code></pre></td></tr></table></figure><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">create table temp(<br>id int primary key,<br>    name varchar(20)<br>);<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; desc temp;<br>+-------+-------------+------+-----+---------+-------+<br>| Field | Type        | Null | Key | Default | Extra |<br>+-------+-------------+------+-----+---------+-------+<br>| id    | int(11)     | NO   | PRI | NULL    |       |<br>| name  | varchar(20) | YES  |     | NULL    |       |<br>+-------+-------------+------+-----+---------+-------+<br>2 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">insert into temp values(1,&#x27;å¼ ä¸‰&#x27;);#æˆåŠŸ<br>insert into temp values(2,&#x27;æå››&#x27;);#æˆåŠŸ<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select * from temp;<br>+----+------+<br>| id | name |<br>+----+------+<br>|  1 | å¼ ä¸‰ |<br>|  2 | æå›› |<br>+----+------+<br>2 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mysql">insert into temp values(1,&#x27;å¼ ä¸‰&#x27;);#å¤±è´¥<br>ERROR 1062 (23000): Duplicateï¼ˆé‡å¤ï¼‰ entryï¼ˆé”®å…¥ï¼Œè¾“å…¥ï¼‰ &#x27;1&#x27; for key &#x27;PRIMARY&#x27;<br><br><br>insert into temp values(1,&#x27;ç‹äº”&#x27;);#å¤±è´¥<br>ERROR 1062 (23000): Duplicate entry &#x27;1&#x27; for key &#x27;PRIMARY&#x27;<br><br>insert into temp values(3,&#x27;å¼ ä¸‰&#x27;);#æˆåŠŸ<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select * from temp;<br>+----+------+<br>| id | name |<br>+----+------+<br>|  1 | å¼ ä¸‰ |<br>|  2 | æå›› |<br>|  3 | å¼ ä¸‰ |<br>+----+------+<br>3 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">insert into temp values(4,null);#æˆåŠŸ<br><br><br>insert into temp values(null,&#x27;æç¦&#x27;);#å¤±è´¥<br>ERROR 1048 (23000): Column &#x27;id&#x27; cannot be null<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select * from temp;<br>+----+------+<br>| id | name |<br>+----+------+<br>|  1 | å¼ ä¸‰ |<br>|  2 | æå›› |<br>|  3 | å¼ ä¸‰ |<br>|  4 | NULL |<br>+----+------+<br>4 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#æ¼”ç¤ºä¸€ä¸ªè¡¨å»ºç«‹ä¸¤ä¸ªä¸»é”®çº¦æŸ<br>create table temp(<br>id int primary key,<br>    name varchar(20) primary key<br>);<br>ERROR 1068 (42000): Multipleï¼ˆå¤šé‡çš„ï¼‰ primary key definedï¼ˆå®šä¹‰ï¼‰<br></code></pre></td></tr></table></figure><p>å†ä¸¾ä¾‹ï¼š</p><ul><li>åˆ—çº§çº¦æŸ</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE TABLE emp4(<br>id INT PRIMARY KEY AUTO_INCREMENT ,<br>NAME VARCHAR(20)<br>);<br></code></pre></td></tr></table></figure><ul><li>è¡¨çº§çº¦æŸ</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE TABLE emp5(<br>id INT NOT NULL AUTO_INCREMENT,<br>NAME VARCHAR(20),<br>pwd VARCHAR(15),<br>CONSTRAINT emp5_id_pk PRIMARY KEY(id)<br>);<br></code></pre></td></tr></table></figure><p>ï¼ˆ2ï¼‰å»ºè¡¨åå¢åŠ ä¸»é”®çº¦æŸ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">ALTER TABLE è¡¨åç§° ADD [CONSTRAINT ä¸»é”®å] PRIMARY KEY(å­—æ®µåˆ—è¡¨); #å­—æ®µåˆ—è¡¨å¯ä»¥æ˜¯ä¸€ä¸ªå­—æ®µï¼Œä¹Ÿå¯ä»¥æ˜¯å¤šä¸ªå­—æ®µï¼Œå¦‚æœæ˜¯å¤šä¸ªå­—æ®µçš„è¯ï¼Œæ˜¯å¤åˆä¸»é”®<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">ALTER TABLE student ADD PRIMARY KEY (sid);<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">ALTER TABLE emp5 ADD PRIMARY KEY(NAME,pwd);<br></code></pre></td></tr></table></figure><h3 id="4-5-å…³äºå¤åˆä¸»é”®"><a href="#4-5-å…³äºå¤åˆä¸»é”®" class="headerlink" title="4.5 å…³äºå¤åˆä¸»é”®"></a>4.5 å…³äºå¤åˆä¸»é”®</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs mysql">create table è¡¨åç§°(<br>å­—æ®µå  æ•°æ®ç±»å‹,<br>    å­—æ®µå  æ•°æ®ç±»å‹,  <br>    å­—æ®µå  æ•°æ®ç±»å‹,<br>    primary key(å­—æ®µå1,å­—æ®µå2)  #è¡¨ç¤ºå­—æ®µ1å’Œå­—æ®µ2çš„ç»„åˆæ˜¯å”¯ä¸€çš„ï¼Œä¹Ÿå¯ä»¥æœ‰æ›´å¤šä¸ªå­—æ®µ<br>);<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#å­¦ç”Ÿè¡¨<br>create table student(<br>sid int primary key,  #å­¦å·<br>    sname varchar(20)     #å­¦ç”Ÿå§“å<br>);<br><br>#è¯¾ç¨‹è¡¨<br>create table course(<br>cid int primary key,  #è¯¾ç¨‹ç¼–å·<br>    cname varchar(20)     #è¯¾ç¨‹åç§°<br>);<br><br>#é€‰è¯¾è¡¨<br>create table student_course(<br>sid int,<br>    cid int,<br>    score int,<br>    primary key(sid,cid)  #å¤åˆä¸»é”®<br>);<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">insert into student values(1,&#x27;å¼ ä¸‰&#x27;),(2,&#x27;æå››&#x27;);<br>insert into course values(1001,&#x27;Java&#x27;),(1002,&#x27;MySQL&#x27;);<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select * from student;<br>+-----+-------+<br>| sid | sname |<br>+-----+-------+<br>|   1 | å¼ ä¸‰  |<br>|   2 | æå››  |<br>+-----+-------+<br>2 rows in set (0.00 sec)<br><br>mysql&gt; select * from course;<br>+------+-------+<br>| cid  | cname |<br>+------+-------+<br>| 1001 | Java  |<br>| 1002 | MySQL |<br>+------+-------+<br>2 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">insert into student_course values(1, 1001, 89),(1,1002,90),(2,1001,88),(2,1002,56);<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select * from student_course;<br>+-----+------+-------+<br>| sid | cid  | score |<br>+-----+------+-------+<br>|   1 | 1001 |    89 |<br>|   1 | 1002 |    90 |<br>|   2 | 1001 |    88 |<br>|   2 | 1002 |    56 |<br>+-----+------+-------+<br>4 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">insert into student_course values(1, 1001, 100);<br>ERROR 1062 (23000): Duplicate entry &#x27;1-1001&#x27; for key &#x27;PRIMARY&#x27;<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; desc student_course;<br>+-------+---------+------+-----+---------+-------+<br>| Field | Type    | Null | Key | Default | Extra |<br>+-------+---------+------+-----+---------+-------+<br>| sid   | int(11) | NO   | PRI | NULL    |       |<br>| cid   | int(11) | NO   | PRI | NULL    |       |<br>| score | int(11) | YES  |     | NULL    |       |<br>+-------+---------+------+-----+---------+-------+<br>3 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><ul><li>å†ä¸¾ä¾‹</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE TABLE emp6(<br>id INT NOT NULL,<br>NAME VARCHAR(20),<br>pwd VARCHAR(15),<br>CONSTRAINT emp7_pk PRIMARY KEY(NAME,pwd)<br>);<br></code></pre></td></tr></table></figure><h3 id="4-6-åˆ é™¤ä¸»é”®çº¦æŸ"><a href="#4-6-åˆ é™¤ä¸»é”®çº¦æŸ" class="headerlink" title="4.6 åˆ é™¤ä¸»é”®çº¦æŸ"></a>4.6 åˆ é™¤ä¸»é”®çº¦æŸ</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">alter table è¡¨åç§° drop primary key;<br></code></pre></td></tr></table></figure><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">ALTER TABLE student DROP PRIMARY KEY;<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">ALTER TABLE emp5 DROP PRIMARY KEY;<br></code></pre></td></tr></table></figure><blockquote><p>è¯´æ˜ï¼šåˆ é™¤ä¸»é”®çº¦æŸï¼Œä¸éœ€è¦æŒ‡å®šä¸»é”®åï¼Œå› ä¸ºä¸€ä¸ªè¡¨åªæœ‰ä¸€ä¸ªä¸»é”®ï¼Œåˆ é™¤ä¸»é”®çº¦æŸåï¼Œéç©ºè¿˜å­˜åœ¨ã€‚</p></blockquote><p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œä¸ä¼šå»åˆ é™¤ä¸»é”®çº¦æŸã€‚ï¼ˆè¡¨æ˜¯ä»¥ä¸»é”®æ¥æ„å»ºB+æ ‘çš„ï¼Œå¦‚æœæ²¡æœ‰ä¸»é”®ä¼šä»¥å”¯ä¸€çº¦æŸæ¥æ„å»ºB+æ ‘ï¼Œå¦‚æœå†æ²¡æœ‰ï¼Œé‚£ä¹ˆInnodbå†…éƒ¨ä¼šåŸºäºä¸€ä¸ªåŒ…å«äº†ROW_IDå€¼çš„åˆ—ç”Ÿæˆä¸€ä¸ªéšè—çš„èšé›†ç´¢å¼•GEN_CLUST_INDEX ï¼ŒROW_IDæ˜¯ä¸€ä¸ª6ä¸ªå­—èŠ‚å³48ä½å•è°ƒé€’å¢çš„åˆ—ã€‚ï¼‰</p><h2 id="5-è‡ªå¢åˆ—ï¼šAUTO-INCREMENT"><a href="#5-è‡ªå¢åˆ—ï¼šAUTO-INCREMENT" class="headerlink" title="5. è‡ªå¢åˆ—ï¼šAUTO_INCREMENT"></a>5. è‡ªå¢åˆ—ï¼šAUTO_INCREMENT</h2><h3 id="5-1-ä½œç”¨"><a href="#5-1-ä½œç”¨" class="headerlink" title="5.1 ä½œç”¨"></a>5.1 ä½œç”¨</h3><p>æŸä¸ªå­—æ®µçš„å€¼è‡ªå¢</p><h3 id="5-2-å…³é”®å­—"><a href="#5-2-å…³é”®å­—" class="headerlink" title="5.2 å…³é”®å­—"></a>5.2 å…³é”®å­—</h3><p>auto_increment</p><h3 id="5-3-ç‰¹ç‚¹å’Œè¦æ±‚"><a href="#5-3-ç‰¹ç‚¹å’Œè¦æ±‚" class="headerlink" title="5.3 ç‰¹ç‚¹å’Œè¦æ±‚"></a>5.3 ç‰¹ç‚¹å’Œè¦æ±‚</h3><p>ï¼ˆ1ï¼‰ä¸€ä¸ªè¡¨æœ€å¤šåªèƒ½æœ‰ä¸€ä¸ªè‡ªå¢é•¿åˆ—</p><p>ï¼ˆ2ï¼‰å½“éœ€è¦äº§ç”Ÿå”¯ä¸€æ ‡è¯†ç¬¦æˆ–é¡ºåºå€¼æ—¶ï¼Œå¯è®¾ç½®è‡ªå¢é•¿ï¼ˆæ¯æ¬¡ä¼šåœ¨å½“å‰æœ€å¤§å€¼çš„åŸºç¡€ä¸Šè‡ªå¢ï¼‰</p><p>ï¼ˆ3ï¼‰è‡ªå¢é•¿åˆ—çº¦æŸçš„åˆ—å¿…é¡»æ˜¯é”®åˆ—ï¼ˆä¸»é”®åˆ—ï¼Œå”¯ä¸€é”®åˆ—ï¼‰</p><p>ï¼ˆ4ï¼‰è‡ªå¢çº¦æŸçš„åˆ—çš„æ•°æ®ç±»å‹å¿…é¡»æ˜¯æ•´æ•°ç±»å‹</p><p>ï¼ˆ5ï¼‰å¦‚æœè‡ªå¢åˆ—æŒ‡å®šäº† 0 å’Œ nullï¼Œä¼šåœ¨å½“å‰æœ€å¤§å€¼çš„åŸºç¡€ä¸Šè‡ªå¢ï¼›å¦‚æœè‡ªå¢åˆ—æ‰‹åŠ¨æŒ‡å®šäº†å…·ä½“å€¼ï¼ˆæ­£æ•´æ•°æˆ–è€…è´Ÿæ•´æ•°ï¼‰ï¼Œç›´æ¥èµ‹å€¼ä¸ºå…·ä½“å€¼ã€‚</p><p>ï¼ˆ6ï¼‰åœ¨å®é™…å¼€å‘ä¸­ï¼Œä¸è¦å¯¹è‡ªå¢é•¿åˆ—èµ‹å€¼ï¼Œè®©å…¶è‡ªåŠ¨è‡ªå¢é•¿ã€‚ï¼ˆååˆ†ä¸å»ºè®®æ‰‹åŠ¨èµ‹å€¼ï¼‰</p><p>é”™è¯¯æ¼”ç¤ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">create table employee(<br>eid int auto_increment,<br>    ename varchar(20)<br>);<br># ERROR 1075 (42000): Incorrect table definition; there can be only one auto column and it must be defined as a key   <br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">create table employee(<br>eid int primary key,<br>    ename varchar(20) unique key auto_increment<br>);<br># ERROR 1063 (42000): Incorrect column specifier for column &#x27;ename&#x27;  å› ä¸ºenameä¸æ˜¯æ•´æ•°ç±»å‹<br></code></pre></td></tr></table></figure><h3 id="5-4-å¦‚ä½•æŒ‡å®šè‡ªå¢çº¦æŸ"><a href="#5-4-å¦‚ä½•æŒ‡å®šè‡ªå¢çº¦æŸ" class="headerlink" title="5.4 å¦‚ä½•æŒ‡å®šè‡ªå¢çº¦æŸ"></a>5.4 å¦‚ä½•æŒ‡å®šè‡ªå¢çº¦æŸ</h3><p><strong>ï¼ˆ1ï¼‰å»ºè¡¨æ—¶</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs mysql">create table è¡¨åç§°(<br>å­—æ®µå  æ•°æ®ç±»å‹  primary key auto_increment,<br>    å­—æ®µå  æ•°æ®ç±»å‹  unique key not null,  <br>    å­—æ®µå  æ•°æ®ç±»å‹  unique key,<br>    å­—æ®µå  æ•°æ®ç±»å‹  not null default é»˜è®¤å€¼, <br>);<br>create table è¡¨åç§°(<br>å­—æ®µå  æ•°æ®ç±»å‹ default é»˜è®¤å€¼ ,<br>    å­—æ®µå  æ•°æ®ç±»å‹ unique key auto_increment,  <br>    å­—æ®µå  æ•°æ®ç±»å‹ not null default é»˜è®¤å€¼,,<br>    primary key(å­—æ®µå)<br>);<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">create table employee(<br>eid int primary key auto_increment,<br>    ename varchar(20)<br>);<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; desc employee;<br>+-------+-------------+------+-----+---------+----------------+<br>| Field | Type        | Null | Key | Default | Extra          |<br>+-------+-------------+------+-----+---------+----------------+<br>| eid   | int(11)     | NO   | PRI | NULL    | auto_increment |<br>| ename | varchar(20) | YES  |     | NULL    |                |<br>+-------+-------------+------+-----+---------+----------------+<br>2 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><p><strong>ï¼ˆ2ï¼‰å»ºè¡¨å</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">alter table è¡¨åç§° modify å­—æ®µå æ•°æ®ç±»å‹ auto_increment; #æ­¤å¤„å­—æ®µå¿…é¡»å·²ç»æ˜¯ä¸»é”®æˆ–è€…å”¯ä¸€é”®<br></code></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">create table employee(<br>eid int primary key ,<br>    ename varchar(20)<br>);<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">alter table employee modify eid int auto_increment;<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; desc employee;<br>+-------+-------------+------+-----+---------+----------------+<br>| Field | Type        | Null | Key | Default | Extra          |<br>+-------+-------------+------+-----+---------+----------------+<br>| eid   | int(11)     | NO   | PRI | NULL    | auto_increment |<br>| ename | varchar(20) | YES  |     | NULL    |                |<br>+-------+-------------+------+-----+---------+----------------+<br>2 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><h3 id="5-5-å¦‚ä½•åˆ é™¤è‡ªå¢çº¦æŸ"><a href="#5-5-å¦‚ä½•åˆ é™¤è‡ªå¢çº¦æŸ" class="headerlink" title="5.5 å¦‚ä½•åˆ é™¤è‡ªå¢çº¦æŸ"></a>5.5 å¦‚ä½•åˆ é™¤è‡ªå¢çº¦æŸ</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#alter table è¡¨åç§° modify å­—æ®µå æ•°æ®ç±»å‹ auto_increment;#ç»™è¿™ä¸ªå­—æ®µå¢åŠ è‡ªå¢çº¦æŸ<br><br>alter table è¡¨åç§° modify å­—æ®µå æ•°æ®ç±»å‹; #å»æ‰auto_incrementç›¸å½“äºåˆ é™¤<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">alter table employee modify eid int;<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; desc employee;<br>+-------+-------------+------+-----+---------+-------+<br>| Field | Type        | Null | Key | Default | Extra |<br>+-------+-------------+------+-----+---------+-------+<br>| eid   | int(11)     | NO   | PRI | NULL    |       |<br>| ename | varchar(20) | YES  |     | NULL    |       |<br>+-------+-------------+------+-----+---------+-------+<br>2 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><h3 id="5-6-MySQL-8-0æ–°ç‰¹æ€§â€”è‡ªå¢å˜é‡çš„æŒä¹…åŒ–"><a href="#5-6-MySQL-8-0æ–°ç‰¹æ€§â€”è‡ªå¢å˜é‡çš„æŒä¹…åŒ–" class="headerlink" title="5.6 MySQL 8.0æ–°ç‰¹æ€§â€”è‡ªå¢å˜é‡çš„æŒä¹…åŒ–"></a>5.6 MySQL 8.0æ–°ç‰¹æ€§â€”è‡ªå¢å˜é‡çš„æŒä¹…åŒ–</h3><p>åœ¨MySQL 8.0ä¹‹å‰ï¼Œè‡ªå¢ä¸»é”®AUTO_INCREMENTçš„å€¼å¦‚æœå¤§äºmax(primary key)+1ï¼Œåœ¨MySQLé‡å¯åï¼Œä¼šé‡ç½®AUTO_INCREMENT=max(primary key)+1ï¼Œè¿™ç§ç°è±¡åœ¨æŸäº›æƒ…å†µä¸‹ä¼šå¯¼è‡´ä¸šåŠ¡ä¸»é”®å†²çªæˆ–è€…å…¶ä»–éš¾ä»¥å‘ç°çš„é—®é¢˜ã€‚<br>ä¸‹é¢é€šè¿‡æ¡ˆä¾‹æ¥å¯¹æ¯”ä¸åŒçš„ç‰ˆæœ¬ä¸­è‡ªå¢å˜é‡æ˜¯å¦æŒä¹…åŒ–ã€‚<br>åœ¨MySQL 5.7ç‰ˆæœ¬ä¸­ï¼Œæµ‹è¯•æ­¥éª¤å¦‚ä¸‹ï¼š<br>åˆ›å»ºçš„æ•°æ®è¡¨ä¸­åŒ…å«è‡ªå¢ä¸»é”®çš„idå­—æ®µï¼Œè¯­å¥å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE TABLE test1(<br>id INT PRIMARY KEY AUTO_INCREMENT<br>);<br></code></pre></td></tr></table></figure><p>æ’å…¥4ä¸ªç©ºå€¼ï¼Œæ‰§è¡Œå¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">INSERT INTO test1<br>VALUES(0),(0),(0),(0);<br></code></pre></td></tr></table></figure><p>æŸ¥è¯¢æ•°æ®è¡¨test1ä¸­çš„æ•°æ®ï¼Œç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT * FROM test1;<br>+----+<br>| id |<br>+----+<br>|  1 |<br>|  2 |<br>|  3 |<br>|  4 |<br>+----+<br>4 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>åˆ é™¤idä¸º4çš„è®°å½•ï¼Œè¯­å¥å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DELETE FROM test1 WHERE id = 4;<br></code></pre></td></tr></table></figure><p>å†æ¬¡æ’å…¥ä¸€ä¸ªç©ºå€¼ï¼Œè¯­å¥å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">INSERT INTO test1 VALUES(0);<br></code></pre></td></tr></table></figure><p>æŸ¥è¯¢æ­¤æ—¶æ•°æ®è¡¨test1ä¸­çš„æ•°æ®ï¼Œç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT * FROM test1;<br>+----+<br>| id |<br>+----+<br>|  1 |<br>|  2 |<br>|  3 |<br>|  5 |<br>+----+<br>4 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>ä»ç»“æœå¯ä»¥çœ‹å‡ºï¼Œè™½ç„¶åˆ é™¤äº†idä¸º4çš„è®°å½•ï¼Œä½†æ˜¯å†æ¬¡æ’å…¥ç©ºå€¼æ—¶ï¼Œå¹¶æ²¡æœ‰é‡ç”¨è¢«åˆ é™¤çš„4ï¼Œè€Œæ˜¯åˆ†é…äº†5ã€‚<br>åˆ é™¤idä¸º5çš„è®°å½•ï¼Œç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DELETE FROM test1 where id=5;<br></code></pre></td></tr></table></figure><p><strong>é‡å¯æ•°æ®åº“</strong>ï¼Œé‡æ–°æ’å…¥ä¸€ä¸ªç©ºå€¼ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">INSERT INTO test1 values(0);<br></code></pre></td></tr></table></figure><p>å†æ¬¡æŸ¥è¯¢æ•°æ®è¡¨test1ä¸­çš„æ•°æ®ï¼Œç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT * FROM test1;<br>+----+<br>| id |<br>+----+<br>|  1 |<br>|  2 |<br>|  3 |<br>|  4 |<br>+----+<br>4 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>ä»ç»“æœå¯ä»¥çœ‹å‡ºï¼Œæ–°æ’å…¥çš„0å€¼åˆ†é…çš„æ˜¯4ï¼ŒæŒ‰ç…§é‡å¯å‰çš„æ“ä½œé€»è¾‘ï¼Œæ­¤å¤„åº”è¯¥åˆ†é…6ã€‚å‡ºç°ä¸Šè¿°ç»“æœçš„ä¸»è¦åŸå› æ˜¯è‡ªå¢ä¸»é”®æ²¡æœ‰æŒä¹…åŒ–ã€‚<br>åœ¨MySQL 5.7ç³»ç»Ÿä¸­ï¼Œå¯¹äºè‡ªå¢ä¸»é”®çš„åˆ†é…è§„åˆ™ï¼Œæ˜¯ç”±InnoDBæ•°æ®å­—å…¸å†…éƒ¨ä¸€ä¸ª<code>è®¡æ•°å™¨</code>æ¥å†³å®šçš„ï¼Œè€Œè¯¥è®¡æ•°å™¨åªåœ¨<code>å†…å­˜ä¸­ç»´æŠ¤</code>ï¼Œå¹¶ä¸ä¼šæŒä¹…åŒ–åˆ°ç£ç›˜ä¸­ã€‚å½“æ•°æ®åº“é‡å¯æ—¶ï¼Œè¯¥è®¡æ•°å™¨ä¼šè¢«åˆå§‹åŒ–ã€‚</p><p>åœ¨MySQL 8.0ç‰ˆæœ¬ä¸­ï¼Œä¸Šè¿°æµ‹è¯•æ­¥éª¤æœ€åä¸€æ­¥çš„ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT * FROM test1;<br>+----+<br>| id |<br>+----+<br>|  1 |<br>|  2 |<br>|  3 |<br>|  6 |<br>+----+<br>4 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>ä»ç»“æœå¯ä»¥çœ‹å‡ºï¼Œè‡ªå¢å˜é‡å·²ç»æŒä¹…åŒ–äº†ã€‚</p><p>MySQL 8.0å°†è‡ªå¢ä¸»é”®çš„è®¡æ•°å™¨æŒä¹…åŒ–åˆ°<code>é‡åšæ—¥å¿—</code>ä¸­ã€‚æ¯æ¬¡è®¡æ•°å™¨å‘ç”Ÿæ”¹å˜ï¼Œéƒ½ä¼šå°†å…¶å†™å…¥é‡åšæ—¥å¿—ä¸­ã€‚å¦‚æœæ•°æ®åº“é‡å¯ï¼ŒInnoDBä¼šæ ¹æ®é‡åšæ—¥å¿—ä¸­çš„ä¿¡æ¯æ¥åˆå§‹åŒ–è®¡æ•°å™¨çš„å†…å­˜å€¼ã€‚</p><h2 id="6-FOREIGN-KEY-çº¦æŸ"><a href="#6-FOREIGN-KEY-çº¦æŸ" class="headerlink" title="6. FOREIGN KEY çº¦æŸ"></a>6. FOREIGN KEY çº¦æŸ</h2><h3 id="6-1-ä½œç”¨"><a href="#6-1-ä½œç”¨" class="headerlink" title="6.1 ä½œç”¨"></a>6.1 ä½œç”¨</h3><p><strong>é™å®šæŸä¸ªè¡¨çš„æŸä¸ªå­—æ®µçš„å¼•ç”¨å®Œæ•´æ€§ã€‚</strong></p><p>æ¯”å¦‚ï¼šå‘˜å·¥è¡¨çš„å‘˜å·¥æ‰€åœ¨éƒ¨é—¨çš„é€‰æ‹©ï¼Œå¿…é¡»åœ¨éƒ¨é—¨è¡¨èƒ½æ‰¾åˆ°å¯¹åº”çš„éƒ¨åˆ†ã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1555428214706.png"></p><h3 id="6-2-å…³é”®å­—"><a href="#6-2-å…³é”®å­—" class="headerlink" title="6.2 å…³é”®å­—"></a>6.2 å…³é”®å­—</h3><p>FOREIGN KEY</p><h3 id="6-3-ä¸»è¡¨å’Œä»è¡¨-çˆ¶è¡¨å’Œå­è¡¨"><a href="#6-3-ä¸»è¡¨å’Œä»è¡¨-çˆ¶è¡¨å’Œå­è¡¨" class="headerlink" title="6.3 ä¸»è¡¨å’Œä»è¡¨/çˆ¶è¡¨å’Œå­è¡¨"></a>6.3 ä¸»è¡¨å’Œä»è¡¨/çˆ¶è¡¨å’Œå­è¡¨</h3><p>ä¸»è¡¨ï¼ˆçˆ¶è¡¨ï¼‰ï¼šè¢«å¼•ç”¨çš„è¡¨ï¼Œè¢«å‚è€ƒçš„è¡¨</p><p>ä»è¡¨ï¼ˆå­è¡¨ï¼‰ï¼šå¼•ç”¨åˆ«äººçš„è¡¨ï¼Œå‚è€ƒåˆ«äººçš„è¡¨</p><p>ä¸»è¡¨å’Œä»è¡¨æ˜¯é€»è¾‘æ¦‚å¿µï¼Œä¸»è¡¨å’Œä»è¡¨å¯ä»¥æ˜¯ä¸€ä¸ªè¡¨</p><p>ä¾‹å¦‚ï¼šå‘˜å·¥è¡¨çš„å‘˜å·¥æ‰€åœ¨éƒ¨é—¨è¿™ä¸ªå­—æ®µçš„å€¼è¦å‚è€ƒéƒ¨é—¨è¡¨ï¼šéƒ¨é—¨è¡¨æ˜¯ä¸»è¡¨ï¼Œå‘˜å·¥è¡¨æ˜¯ä»è¡¨ã€‚</p><p>ä¾‹å¦‚ï¼šå­¦ç”Ÿè¡¨ã€è¯¾ç¨‹è¡¨ã€é€‰è¯¾è¡¨ï¼šé€‰è¯¾è¡¨çš„å­¦ç”Ÿå’Œè¯¾ç¨‹è¦åˆ†åˆ«å‚è€ƒå­¦ç”Ÿè¡¨å’Œè¯¾ç¨‹è¡¨ï¼Œå­¦ç”Ÿè¡¨å’Œè¯¾ç¨‹è¡¨æ˜¯ä¸»è¡¨ï¼Œé€‰è¯¾è¡¨æ˜¯ä»è¡¨ã€‚</p><h3 id="6-4-ç‰¹ç‚¹"><a href="#6-4-ç‰¹ç‚¹" class="headerlink" title="6.4 ç‰¹ç‚¹"></a>6.4 ç‰¹ç‚¹</h3><p>ï¼ˆ1ï¼‰ä»è¡¨çš„å¤–é”®åˆ—ï¼Œå¿…é¡»å¼•ç”¨/å‚è€ƒä¸»è¡¨çš„ä¸»é”®æˆ–å”¯ä¸€çº¦æŸçš„åˆ—</p><div class="code-wrapper"><pre><code class="hljs">      ä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºè¢«ä¾èµ–/è¢«å‚è€ƒçš„å€¼å¿…é¡»æ˜¯å”¯ä¸€çš„</code></pre></div><p>ï¼ˆ2ï¼‰åœ¨åˆ›å»ºå¤–é”®çº¦æŸæ—¶ï¼Œå¦‚æœä¸ç»™å¤–é”®çº¦æŸå‘½åï¼Œ<strong>é»˜è®¤åä¸æ˜¯åˆ—åï¼Œè€Œæ˜¯è‡ªåŠ¨äº§ç”Ÿä¸€ä¸ªå¤–é”®å</strong>ï¼ˆä¾‹å¦‚ student_ibfk_1;ï¼‰ï¼Œå»ºè®®æŒ‡å®šå¤–é”®çº¦æŸåã€‚</p><p>ï¼ˆ3ï¼‰åˆ›å»º(CREATE)è¡¨æ—¶å°±æŒ‡å®šå¤–é”®çº¦æŸçš„è¯ï¼Œå…ˆåˆ›å»ºä¸»è¡¨ï¼Œå†åˆ›å»ºä»è¡¨</p><p>ï¼ˆ4ï¼‰åˆ è¡¨æ—¶ï¼Œå…ˆåˆ ä»è¡¨ï¼ˆæˆ–å…ˆåˆ é™¤å¤–é”®çº¦æŸï¼‰ï¼Œå†åˆ é™¤ä¸»è¡¨</p><p>ï¼ˆ5ï¼‰å½“ä¸»è¡¨çš„è®°å½•è¢«ä»è¡¨å‚ç…§æ—¶ï¼Œä¸»è¡¨çš„è®°å½•å°†ä¸å…è®¸åˆ é™¤ï¼Œå¦‚æœè¦åˆ é™¤æ•°æ®ï¼Œéœ€è¦å…ˆåˆ é™¤ä»è¡¨ä¸­ä¾èµ–è¯¥è®°å½•çš„æ•°æ®ï¼Œç„¶åæ‰å¯ä»¥åˆ é™¤ä¸»è¡¨çš„æ•°æ®</p><p>ï¼ˆ6ï¼‰åœ¨â€œä»è¡¨â€ä¸­æŒ‡å®šå¤–é”®çº¦æŸï¼Œå¹¶ä¸”ä¸€ä¸ªè¡¨å¯ä»¥å»ºç«‹å¤šä¸ªå¤–é”®çº¦æŸ</p><p>ï¼ˆ7ï¼‰ä»è¡¨çš„å¤–é”®åˆ—ä¸ä¸»è¡¨è¢«å‚ç…§çš„åˆ—åå­—å¯ä»¥ä¸ç›¸åŒï¼Œä½†æ˜¯æ•°æ®ç±»å‹å¿…é¡»ä¸€æ ·ï¼Œé€»è¾‘æ„ä¹‰ä¸€è‡´ã€‚å¦‚æœç±»å‹ä¸ä¸€æ ·ï¼Œåˆ›å»ºå­è¡¨æ—¶ï¼Œå°±ä¼šå‡ºç°é”™è¯¯â€œERROR 1005 (HY000): Canâ€™t create tableâ€™database.tablenameâ€™(errno: 150)â€ã€‚</p><div class="code-wrapper"><pre><code class="hljs">      ä¾‹å¦‚ï¼šéƒ½æ˜¯è¡¨ç¤ºéƒ¨é—¨ç¼–å·ï¼Œéƒ½æ˜¯intç±»å‹ã€‚</code></pre></div><p>ï¼ˆ8ï¼‰<strong>å½“åˆ›å»ºå¤–é”®çº¦æŸæ—¶ï¼Œç³»ç»Ÿé»˜è®¤ä¼šåœ¨æ‰€åœ¨çš„åˆ—ä¸Šå»ºç«‹å¯¹åº”çš„æ™®é€šç´¢å¼•</strong>ã€‚ä½†æ˜¯ç´¢å¼•åæ˜¯å¤–é”®çš„çº¦æŸåã€‚ï¼ˆæ ¹æ®å¤–é”®æŸ¥è¯¢æ•ˆç‡å¾ˆé«˜ï¼‰</p><p>ï¼ˆ9ï¼‰åˆ é™¤å¤–é”®çº¦æŸåï¼Œå¿…é¡»<code>æ‰‹åŠ¨</code>åˆ é™¤å¯¹åº”çš„ç´¢å¼•</p><h3 id="6-5-æ·»åŠ å¤–é”®çº¦æŸ"><a href="#6-5-æ·»åŠ å¤–é”®çº¦æŸ" class="headerlink" title="6.5 æ·»åŠ å¤–é”®çº¦æŸ"></a>6.5 æ·»åŠ å¤–é”®çº¦æŸ</h3><p>ï¼ˆ1ï¼‰å»ºè¡¨æ—¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs mysql">create table ä¸»è¡¨åç§°(<br>å­—æ®µ1  æ•°æ®ç±»å‹  primary key,<br>    å­—æ®µ2  æ•°æ®ç±»å‹<br>);<br><br>create table ä»è¡¨åç§°(<br>å­—æ®µ1  æ•°æ®ç±»å‹  primary key,<br>    å­—æ®µ2  æ•°æ®ç±»å‹,<br>    [CONSTRAINT &lt;å¤–é”®çº¦æŸåç§°&gt;] FOREIGN KEYï¼ˆä»è¡¨çš„æŸä¸ªå­—æ®µ) references ä¸»è¡¨å(è¢«å‚è€ƒå­—æ®µ)<br>);<br>#(ä»è¡¨çš„æŸä¸ªå­—æ®µ)çš„æ•°æ®ç±»å‹å¿…é¡»ä¸ä¸»è¡¨å(è¢«å‚è€ƒå­—æ®µ)çš„æ•°æ®ç±»å‹ä¸€è‡´ï¼Œé€»è¾‘æ„ä¹‰ä¹Ÿä¸€æ ·<br>#(ä»è¡¨çš„æŸä¸ªå­—æ®µ)çš„å­—æ®µåå¯ä»¥ä¸ä¸»è¡¨å(è¢«å‚è€ƒå­—æ®µ)çš„å­—æ®µåä¸€æ ·ï¼Œä¹Ÿå¯ä»¥ä¸ä¸€æ ·<br><br>-- FOREIGN KEY: åœ¨è¡¨çº§æŒ‡å®šå­è¡¨ä¸­çš„åˆ—<br>-- REFERENCES: æ ‡ç¤ºåœ¨çˆ¶è¡¨ä¸­çš„åˆ—<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs mysql">create table dept( #ä¸»è¡¨<br>did int primary key,#éƒ¨é—¨ç¼–å·<br>    dname varchar(50)#éƒ¨é—¨åç§°<br>);<br><br>create table emp(#ä»è¡¨<br>eid int primary key,  #å‘˜å·¥ç¼–å·<br>    ename varchar(5),     #å‘˜å·¥å§“å<br>    deptid int,#å‘˜å·¥æ‰€åœ¨çš„éƒ¨é—¨<br>    foreign key (deptid) references dept(did)   #åœ¨ä»è¡¨ä¸­æŒ‡å®šå¤–é”®çº¦æŸ<br>    #empè¡¨çš„deptidå’Œå’Œdeptè¡¨çš„didçš„æ•°æ®ç±»å‹ä¸€è‡´ï¼Œæ„ä¹‰éƒ½æ˜¯è¡¨ç¤ºéƒ¨é—¨çš„ç¼–å·<br>);<br><br>è¯´æ˜ï¼š<br>ï¼ˆ1ï¼‰ä¸»è¡¨deptå¿…é¡»å…ˆåˆ›å»ºæˆåŠŸï¼Œç„¶åæ‰èƒ½åˆ›å»ºempè¡¨ï¼ŒæŒ‡å®šå¤–é”®æˆåŠŸã€‚<br>ï¼ˆ2ï¼‰åˆ é™¤è¡¨æ—¶ï¼Œå…ˆåˆ é™¤ä»è¡¨empï¼Œå†åˆ é™¤ä¸»è¡¨dept<br></code></pre></td></tr></table></figure><p>ï¼ˆ2ï¼‰å»ºè¡¨å</p><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè¡¨ä¸è¡¨çš„å…³è”éƒ½æ˜¯æå‰è®¾è®¡å¥½äº†çš„ï¼Œå› æ­¤ï¼Œä¼šåœ¨åˆ›å»ºè¡¨çš„æ—¶å€™å°±æŠŠå¤–é”®çº¦æŸå®šä¹‰å¥½ã€‚ä¸è¿‡ï¼Œå¦‚æœéœ€è¦ä¿®æ”¹è¡¨çš„è®¾è®¡ï¼ˆæ¯”å¦‚æ·»åŠ æ–°çš„å­—æ®µï¼Œå¢åŠ æ–°çš„å…³è”å…³ç³»ï¼‰ï¼Œä½†æ²¡æœ‰é¢„å…ˆå®šä¹‰å¤–é”®çº¦æŸï¼Œé‚£ä¹ˆï¼Œå°±è¦ç”¨ä¿®æ”¹è¡¨çš„æ–¹å¼æ¥è¡¥å……å®šä¹‰ã€‚</p><p>æ ¼å¼ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">ALTER TABLE ä»è¡¨å ADD [CONSTRAINT çº¦æŸå] FOREIGN KEY (ä»è¡¨çš„å­—æ®µ) REFERENCES ä¸»è¡¨å(è¢«å¼•ç”¨å­—æ®µ) [on update xx][on delete xx];<br></code></pre></td></tr></table></figure><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">ALTER TABLE emp1<br>ADD [CONSTRAINT emp_dept_id_fk] FOREIGN KEY(dept_id) REFERENCES dept(dept_id);<br></code></pre></td></tr></table></figure><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs mysql">create table dept(<br>did int primary key,#éƒ¨é—¨ç¼–å·<br>    dname varchar(50)#éƒ¨é—¨åç§°<br>);<br><br>create table emp(<br>eid int primary key,  #å‘˜å·¥ç¼–å·<br>    ename varchar(5),     #å‘˜å·¥å§“å<br>    deptid int#å‘˜å·¥æ‰€åœ¨çš„éƒ¨é—¨<br>);<br>#è¿™ä¸¤ä¸ªè¡¨åˆ›å»ºæ—¶ï¼Œæ²¡æœ‰æŒ‡å®šå¤–é”®çš„è¯ï¼Œé‚£ä¹ˆåˆ›å»ºé¡ºåºæ˜¯éšæ„<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">alter table emp add foreign key (deptid) references dept(did);<br></code></pre></td></tr></table></figure><h3 id="6-6-æ¼”ç¤ºé—®é¢˜"><a href="#6-6-æ¼”ç¤ºé—®é¢˜" class="headerlink" title="6.6 æ¼”ç¤ºé—®é¢˜"></a>6.6 æ¼”ç¤ºé—®é¢˜</h3><p>ï¼ˆ1ï¼‰å¤±è´¥ï¼šä¸æ˜¯é”®åˆ—</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs mysql">create table dept(<br>did int ,#éƒ¨é—¨ç¼–å·<br>    dname varchar(50)#éƒ¨é—¨åç§°<br>);<br><br>create table emp(<br>eid int primary key,  #å‘˜å·¥ç¼–å·<br>    ename varchar(5),     #å‘˜å·¥å§“å<br>    deptid int,#å‘˜å·¥æ‰€åœ¨çš„éƒ¨é—¨<br>    foreign key (deptid) references dept(did)<br>);<br>#ERROR 1215 (HY000): Cannot add foreign key constraint  åŸå› æ˜¯deptçš„didä¸æ˜¯é”®åˆ—<br></code></pre></td></tr></table></figure><p>ï¼ˆ2ï¼‰å¤±è´¥ï¼šæ•°æ®ç±»å‹ä¸ä¸€è‡´</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs mysql">create table dept(<br>did int primary key,#éƒ¨é—¨ç¼–å·<br>    dname varchar(50)#éƒ¨é—¨åç§°<br>);<br><br>create table emp(<br>eid int primary key,  #å‘˜å·¥ç¼–å·<br>    ename varchar(5),     #å‘˜å·¥å§“å<br>    deptid char,#å‘˜å·¥æ‰€åœ¨çš„éƒ¨é—¨<br>    foreign key (deptid) references dept(did)<br>);<br>#ERROR 1215 (HY000): Cannot add foreign key constraint  åŸå› æ˜¯ä»è¡¨çš„deptidå­—æ®µå’Œä¸»è¡¨çš„didå­—æ®µçš„æ•°æ®ç±»å‹ä¸ä¸€è‡´ï¼Œå¹¶ä¸”è¦å®ƒä¿©çš„é€»è¾‘æ„ä¹‰ä¸€è‡´<br></code></pre></td></tr></table></figure><p>ï¼ˆ3ï¼‰æˆåŠŸï¼Œä¸¤ä¸ªè¡¨å­—æ®µåä¸€æ ·</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs mysql">create table dept(<br>did int primary key,#éƒ¨é—¨ç¼–å·<br>    dname varchar(50)#éƒ¨é—¨åç§°<br>);<br><br>create table emp(<br>eid int primary key,  #å‘˜å·¥ç¼–å·<br>    ename varchar(5),     #å‘˜å·¥å§“å<br>    did int,#å‘˜å·¥æ‰€åœ¨çš„éƒ¨é—¨<br>    foreign key (did) references dept(did)  <br>    #empè¡¨çš„deptidå’Œå’Œdeptè¡¨çš„didçš„æ•°æ®ç±»å‹ä¸€è‡´ï¼Œæ„ä¹‰éƒ½æ˜¯è¡¨ç¤ºéƒ¨é—¨çš„ç¼–å·<br>    #æ˜¯å¦é‡åæ²¡é—®é¢˜ï¼Œå› ä¸ºä¸¤ä¸ªdidåœ¨ä¸åŒçš„è¡¨ä¸­<br>);<br></code></pre></td></tr></table></figure><p>ï¼ˆ4ï¼‰æ·»åŠ ã€åˆ é™¤ã€ä¿®æ”¹é—®é¢˜</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs mysql">create table dept(<br>did int primary key,#éƒ¨é—¨ç¼–å·<br>    dname varchar(50)#éƒ¨é—¨åç§°<br>);<br><br>create table emp(<br>eid int primary key,  #å‘˜å·¥ç¼–å·<br>    ename varchar(5),     #å‘˜å·¥å§“å<br>    deptid int,#å‘˜å·¥æ‰€åœ¨çš„éƒ¨é—¨<br>    foreign key (deptid) references dept(did)  <br>    #empè¡¨çš„deptidå’Œå’Œdeptè¡¨çš„didçš„æ•°æ®ç±»å‹ä¸€è‡´ï¼Œæ„ä¹‰éƒ½æ˜¯è¡¨ç¤ºéƒ¨é—¨çš„ç¼–å·<br>);<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">insert into dept values(1001,&#x27;æ•™å­¦éƒ¨&#x27;);<br>insert into dept values(1003, &#x27;è´¢åŠ¡éƒ¨&#x27;);<br><br>insert into emp values(1,&#x27;å¼ ä¸‰&#x27;,1001); #æ·»åŠ ä»è¡¨è®°å½•æˆåŠŸï¼Œåœ¨æ·»åŠ è¿™æ¡è®°å½•æ—¶ï¼Œè¦æ±‚éƒ¨é—¨è¡¨æœ‰1001éƒ¨é—¨<br><br>insert into emp values(2,&#x27;æå››&#x27;,1005);#æ·»åŠ ä»è¡¨è®°å½•å¤±è´¥<br>ERROR 1452 (23000): Cannot addï¼ˆæ·»åŠ ï¼‰ or updateï¼ˆä¿®æ”¹ï¼‰ a child row: a foreign key constraint fails (`atguigudb`.`emp`, CONSTRAINT `emp_ibfk_1` FOREIGN KEY (`deptid`) REFERENCES `dept` (`did`)) ä»è¡¨empæ·»åŠ è®°å½•å¤±è´¥ï¼Œå› ä¸ºä¸»è¡¨deptæ²¡æœ‰1005éƒ¨é—¨<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select * from dept;<br>+------+--------+<br>| did  | dname  |<br>+------+--------+<br>| 1001 | æ•™å­¦éƒ¨  |<br>| 1003 | è´¢åŠ¡éƒ¨  |<br>+------+--------+<br>2 rows in set (0.00 sec)<br><br>mysql&gt; select * from emp;<br>+-----+-------+--------+<br>| eid | ename | deptid |<br>+-----+-------+--------+<br>|   1 | å¼ ä¸‰   |   1001 |<br>+-----+-------+--------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">update emp set deptid = 1002 where eid = 1;#ä¿®æ”¹ä»è¡¨å¤±è´¥ <br>ERROR 1452 (23000): Cannot addï¼ˆæ·»åŠ ï¼‰ or updateï¼ˆä¿®æ”¹ï¼‰ a child rowï¼ˆå­è¡¨çš„è®°å½•ï¼‰: a foreign key constraint failsï¼ˆå¤–é”®çº¦æŸå¤±è´¥ï¼‰ (`atguigudb`.`emp`, CONSTRAINT `emp_ibfk_1` FOREIGN KEY (`deptid`) REFERENCES `dept` (`did`))  #éƒ¨é—¨è¡¨didå­—æ®µç°åœ¨æ²¡æœ‰1002çš„å€¼ï¼Œæ‰€ä»¥å‘˜å·¥è¡¨ä¸­ä¸èƒ½ä¿®æ”¹å‘˜å·¥æ‰€åœ¨éƒ¨é—¨deptidä¸º1002<br><br>update dept set did = 1002 where did = 1001;#ä¿®æ”¹ä¸»è¡¨å¤±è´¥<br>ERROR 1451 (23000): Cannot deleteï¼ˆåˆ é™¤ï¼‰ or updateï¼ˆä¿®æ”¹ï¼‰ a parent rowï¼ˆçˆ¶è¡¨çš„è®°å½•ï¼‰: a foreign key constraint fails (`atguigudb`.`emp`, CONSTRAINT `emp_ibfk_1` FOREIGN KEY (`deptid`) REFERENCES `dept` (`did`)) #éƒ¨é—¨è¡¨didçš„1001å­—æ®µå·²ç»è¢«empå¼•ç”¨äº†ï¼Œæ‰€ä»¥éƒ¨é—¨è¡¨çš„1001å­—æ®µå°±ä¸èƒ½ä¿®æ”¹äº†ã€‚<br><br>update dept set did = 1002 where did = 1003;#ä¿®æ”¹ä¸»è¡¨æˆåŠŸ  å› ä¸ºéƒ¨é—¨è¡¨çš„1003éƒ¨é—¨æ²¡æœ‰è¢«empè¡¨å¼•ç”¨ï¼Œæ‰€ä»¥å¯ä»¥ä¿®æ”¹<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">delete from dept where did=1001; #åˆ é™¤ä¸»è¡¨å¤±è´¥<br>ERROR 1451 (23000): Cannot deleteï¼ˆåˆ é™¤ï¼‰ or updateï¼ˆä¿®æ”¹ï¼‰ a parent rowï¼ˆçˆ¶è¡¨è®°å½•ï¼‰: a foreign key constraint fails (`atguigudb`.`emp`, CONSTRAINT `emp_ibfk_1` FOREIGN KEY (`deptid`) REFERENCES `dept` (`did`))  #å› ä¸ºéƒ¨é—¨è¡¨didçš„1001å­—æ®µå·²ç»è¢«empå¼•ç”¨äº†ï¼Œæ‰€ä»¥éƒ¨é—¨è¡¨çš„1001å­—æ®µå¯¹åº”çš„è®°å½•å°±ä¸èƒ½è¢«åˆ é™¤<br></code></pre></td></tr></table></figure><p>æ€»ç»“ï¼šçº¦æŸå…³ç³»æ˜¯é’ˆå¯¹åŒæ–¹çš„</p><ul><li><p>æ·»åŠ äº†å¤–é”®çº¦æŸåï¼Œä¸»è¡¨çš„ä¿®æ”¹å’Œåˆ é™¤æ•°æ®å—çº¦æŸ</p></li><li><p>æ·»åŠ äº†å¤–é”®çº¦æŸåï¼Œä»è¡¨çš„æ·»åŠ å’Œä¿®æ”¹æ•°æ®å—çº¦æŸ</p></li><li><p>åœ¨ä»è¡¨ä¸Šå»ºç«‹å¤–é”®ï¼Œè¦æ±‚ä¸»è¡¨å¿…é¡»å­˜åœ¨</p></li><li><p>åˆ é™¤ä¸»è¡¨æ—¶ï¼Œè¦æ±‚ä»è¡¨ä»è¡¨å…ˆåˆ é™¤ï¼Œæˆ–å°†ä»è¡¨ä¸­å¤–é”®å¼•ç”¨è¯¥ä¸»è¡¨çš„å…³ç³»å…ˆåˆ é™¤</p></li></ul><h3 id="6-7-çº¦æŸç­‰çº§"><a href="#6-7-çº¦æŸç­‰çº§" class="headerlink" title="6.7 çº¦æŸç­‰çº§"></a>6.7 çº¦æŸç­‰çº§</h3><ul><li><p><code>Cascadeæ–¹å¼</code>ï¼šåœ¨çˆ¶è¡¨ä¸Šupdate/deleteè®°å½•æ—¶ï¼ŒåŒæ­¥update/deleteæ‰å­è¡¨çš„åŒ¹é…è®°å½• </p></li><li><p><code>Set nullæ–¹å¼</code>ï¼šåœ¨çˆ¶è¡¨ä¸Šupdate/deleteè®°å½•æ—¶ï¼Œå°†å­è¡¨ä¸ŠåŒ¹é…è®°å½•çš„åˆ—è®¾ä¸ºnullï¼Œä½†æ˜¯è¦æ³¨æ„å­è¡¨çš„å¤–é”®åˆ—ä¸èƒ½ä¸ºnot null  </p></li><li><p><code>No actionæ–¹å¼</code>ï¼šå¦‚æœå­è¡¨ä¸­æœ‰åŒ¹é…çš„è®°å½•ï¼Œåˆ™ä¸å…è®¸å¯¹çˆ¶è¡¨å¯¹åº”å€™é€‰é”®è¿›è¡Œupdate/deleteæ“ä½œ  </p></li><li><p><code>Restrictæ–¹å¼</code>ï¼šåŒno actionï¼Œ éƒ½æ˜¯ç«‹å³æ£€æŸ¥å¤–é”®çº¦æŸ</p></li><li><p><code>Set defaultæ–¹å¼</code>ï¼ˆåœ¨å¯è§†åŒ–å·¥å…·SQLyogä¸­å¯èƒ½æ˜¾ç¤ºç©ºç™½ï¼‰ï¼šçˆ¶è¡¨æœ‰å˜æ›´æ—¶ï¼Œå­è¡¨å°†å¤–é”®åˆ—è®¾ç½®æˆä¸€ä¸ªé»˜è®¤çš„å€¼ï¼Œä½†Innodbä¸èƒ½è¯†åˆ«</p></li></ul><p>å¦‚æœæ²¡æœ‰æŒ‡å®šç­‰çº§ï¼Œå°±ç›¸å½“äºRestrictæ–¹å¼ã€‚</p><p>å¯¹äºå¤–é”®çº¦æŸï¼Œæœ€å¥½æ˜¯é‡‡ç”¨: <code>ON UPDATE CASCADE ON DELETE RESTRICT</code> çš„æ–¹å¼ã€‚</p><p>ï¼ˆ1ï¼‰æ¼”ç¤º1ï¼šon update cascade on delete set null</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs mysql">create table dept(<br>did int primary key,#éƒ¨é—¨ç¼–å·<br>    dname varchar(50)#éƒ¨é—¨åç§°<br>);<br><br>create table emp(<br>eid int primary key,  #å‘˜å·¥ç¼–å·<br>    ename varchar(5),     #å‘˜å·¥å§“å<br>    deptid int,#å‘˜å·¥æ‰€åœ¨çš„éƒ¨é—¨<br>    foreign key (deptid) references dept(did)  on update cascade on delete set null<br>    #æŠŠä¿®æ”¹æ“ä½œè®¾ç½®ä¸ºçº§è”ä¿®æ”¹ç­‰çº§ï¼ŒæŠŠåˆ é™¤æ“ä½œè®¾ç½®ä¸ºset nullç­‰çº§<br>);<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs mysql">insert into dept values(1001,&#x27;æ•™å­¦éƒ¨&#x27;);<br>insert into dept values(1002, &#x27;è´¢åŠ¡éƒ¨&#x27;);<br>insert into dept values(1003, &#x27;å’¨è¯¢éƒ¨&#x27;);<br><br><br>insert into emp values(1,&#x27;å¼ ä¸‰&#x27;,1001); #åœ¨æ·»åŠ è¿™æ¡è®°å½•æ—¶ï¼Œè¦æ±‚éƒ¨é—¨è¡¨æœ‰1001éƒ¨é—¨<br>insert into emp values(2,&#x27;æå››&#x27;,1001);<br>insert into emp values(3,&#x27;ç‹äº”&#x27;,1002);<br><br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select * from dept;<br><br>mysql&gt; select * from emp;<br><br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#ä¿®æ”¹ä¸»è¡¨æˆåŠŸï¼Œä»è¡¨ä¹Ÿè·Ÿç€ä¿®æ”¹ï¼Œä¿®æ”¹äº†ä¸»è¡¨è¢«å¼•ç”¨çš„å­—æ®µ1002ä¸º1004ï¼Œä»è¡¨çš„å¼•ç”¨å­—æ®µå°±è·Ÿç€ä¿®æ”¹ä¸º1004äº†<br>mysql&gt; update dept set did = 1004 where did = 1002;<br>Query OK, 1 row affected (0.00 sec)<br>Rows matched: 1  Changed: 1  Warnings: 0<br><br>mysql&gt; select * from dept;<br>+------+--------+<br>| did  | dname  |<br>+------+--------+<br>| 1001 | æ•™å­¦éƒ¨ |<br>| 1003 | å’¨è¯¢éƒ¨ |<br>| 1004 | è´¢åŠ¡éƒ¨ | #åŸæ¥æ˜¯1002ï¼Œä¿®æ”¹ä¸º1004<br>+------+--------+<br>3 rows in set (0.00 sec)<br><br>mysql&gt; select * from emp;<br>+-----+-------+--------+<br>| eid | ename | deptid |<br>+-----+-------+--------+<br>|   1 | å¼ ä¸‰  |   1001 |<br>|   2 | æå››  |   1001 |<br>|   3 | ç‹äº”  |   1004 | #åŸæ¥æ˜¯1002ï¼Œè·Ÿç€ä¿®æ”¹ä¸º1004<br>+-----+-------+--------+<br>3 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#åˆ é™¤ä¸»è¡¨çš„è®°å½•æˆåŠŸï¼Œä»è¡¨å¯¹åº”çš„å­—æ®µçš„å€¼è¢«ä¿®æ”¹ä¸ºnull<br>mysql&gt; delete from dept where did = 1001;<br>Query OK, 1 row affected (0.01 sec)<br><br>mysql&gt; select * from dept;<br>+------+--------+<br>| did  | dname  | #è®°å½•1001éƒ¨é—¨è¢«åˆ é™¤äº†<br>+------+--------+<br>| 1003 | å’¨è¯¢éƒ¨  |<br>| 1004 | è´¢åŠ¡éƒ¨  |<br>+------+--------+<br>2 rows in set (0.00 sec)<br><br>mysql&gt; select * from emp;<br>+-----+-------+--------+<br>| eid | ename | deptid |<br>+-----+-------+--------+<br>|   1 | å¼ ä¸‰  |   NULL | #åŸæ¥å¼•ç”¨1001éƒ¨é—¨çš„å‘˜å·¥ï¼Œdeptidå­—æ®µå˜ä¸ºnull<br>|   2 | æå››  |   NULL |<br>|   3 | ç‹äº”  |   1004 |<br>+-----+-------+--------+<br>3 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>ï¼ˆ2ï¼‰æ¼”ç¤º2ï¼šon update set null on delete cascade</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs mysql">create table dept(<br>did int primary key,#éƒ¨é—¨ç¼–å·<br>    dname varchar(50)#éƒ¨é—¨åç§°<br>);<br><br>create table emp(<br>eid int primary key,  #å‘˜å·¥ç¼–å·<br>    ename varchar(5),     #å‘˜å·¥å§“å<br>    deptid int,#å‘˜å·¥æ‰€åœ¨çš„éƒ¨é—¨<br>    foreign key (deptid) references dept(did)  on update set null on delete cascade<br>    #æŠŠä¿®æ”¹æ“ä½œè®¾ç½®ä¸ºset nullç­‰çº§ï¼ŒæŠŠåˆ é™¤æ“ä½œè®¾ç½®ä¸ºçº§è”åˆ é™¤ç­‰çº§<br>);<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">insert into dept values(1001,&#x27;æ•™å­¦éƒ¨&#x27;);<br>insert into dept values(1002, &#x27;è´¢åŠ¡éƒ¨&#x27;);<br>insert into dept values(1003, &#x27;å’¨è¯¢éƒ¨&#x27;);<br><br>insert into emp values(1,&#x27;å¼ ä¸‰&#x27;,1001); #åœ¨æ·»åŠ è¿™æ¡è®°å½•æ—¶ï¼Œè¦æ±‚éƒ¨é—¨è¡¨æœ‰1001éƒ¨é—¨<br>insert into emp values(2,&#x27;æå››&#x27;,1001);<br>insert into emp values(3,&#x27;ç‹äº”&#x27;,1002);<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select * from dept;<br>+------+--------+<br>| did  | dname  |<br>+------+--------+<br>| 1001 | æ•™å­¦éƒ¨ |<br>| 1002 | è´¢åŠ¡éƒ¨ |<br>| 1003 | å’¨è¯¢éƒ¨ |<br>+------+--------+<br>3 rows in set (0.00 sec)<br><br>mysql&gt; select * from emp;<br>+-----+-------+--------+<br>| eid | ename | deptid |<br>+-----+-------+--------+<br>|   1 | å¼ ä¸‰  |   1001 |<br>|   2 | æå››  |   1001 |<br>|   3 | ç‹äº”  |   1002 |<br>+-----+-------+--------+<br>3 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#ä¿®æ”¹ä¸»è¡¨ï¼Œä»è¡¨å¯¹åº”çš„å­—æ®µè®¾ç½®ä¸ºnull<br>mysql&gt; update dept set did = 1004 where did = 1002;<br>Query OK, 1 row affected (0.00 sec)<br>Rows matched: 1  Changed: 1  Warnings: 0<br><br>mysql&gt; select * from dept;<br>+------+--------+<br>| did  | dname  |<br>+------+--------+<br>| 1001 | æ•™å­¦éƒ¨ |<br>| 1003 | å’¨è¯¢éƒ¨ |<br>| 1004 | è´¢åŠ¡éƒ¨ | #åŸæ¥didæ˜¯1002<br>+------+--------+<br>3 rows in set (0.00 sec)<br><br>mysql&gt; select * from emp;<br>+-----+-------+--------+<br>| eid | ename | deptid |<br>+-----+-------+--------+<br>|   1 | å¼ ä¸‰  |   1001 |<br>|   2 | æå››  |   1001 |<br>|   3 | ç‹äº”  |   NULL | #åŸæ¥deptidæ˜¯1002ï¼Œå› ä¸ºéƒ¨é—¨è¡¨1002è¢«ä¿®æ”¹äº†ï¼Œ1002æ²¡æœ‰å¯¹åº”çš„äº†ï¼Œå°±è®¾ç½®ä¸ºnull<br>+-----+-------+--------+<br>3 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#åˆ é™¤ä¸»è¡¨çš„è®°å½•æˆåŠŸï¼Œä¸»è¡¨çš„1001è¡Œè¢«åˆ é™¤äº†ï¼Œä»è¡¨ç›¸åº”çš„è®°å½•ä¹Ÿè¢«åˆ é™¤äº†<br>mysql&gt; delete from dept where did=1001;<br>Query OK, 1 row affected (0.00 sec)<br><br>mysql&gt; select * from dept;<br>+------+--------+<br>| did  | dname  | #éƒ¨é—¨è¡¨ä¸­1001éƒ¨é—¨è¢«åˆ é™¤<br>+------+--------+<br>| 1003 | å’¨è¯¢éƒ¨ |<br>| 1004 | è´¢åŠ¡éƒ¨ |<br>+------+--------+<br>2 rows in set (0.00 sec)<br><br>mysql&gt; select * from emp;<br>+-----+-------+--------+<br>| eid | ename | deptid |#åŸæ¥1001éƒ¨é—¨çš„å‘˜å·¥ä¹Ÿè¢«åˆ é™¤äº†<br>+-----+-------+--------+<br>|   3 | ç‹äº”  |   NULL |<br>+-----+-------+--------+<br>1 row in set (0.00 sec)<br><br></code></pre></td></tr></table></figure><p>ï¼ˆ3ï¼‰æ¼”ç¤ºï¼šon update cascade on delete cascade</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs mysql">create table dept(<br>did int primary key,#éƒ¨é—¨ç¼–å·<br>    dname varchar(50)#éƒ¨é—¨åç§°<br>);<br><br>create table emp(<br>eid int primary key,  #å‘˜å·¥ç¼–å·<br>    ename varchar(5),     #å‘˜å·¥å§“å<br>    deptid int,#å‘˜å·¥æ‰€åœ¨çš„éƒ¨é—¨<br>    foreign key (deptid) references dept(did)  on update cascade on delete cascade<br>    #æŠŠä¿®æ”¹æ“ä½œè®¾ç½®ä¸ºçº§è”ä¿®æ”¹ç­‰çº§ï¼ŒæŠŠåˆ é™¤æ“ä½œä¹Ÿè®¾ç½®ä¸ºçº§è”åˆ é™¤ç­‰çº§<br>);<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">insert into dept values(1001,&#x27;æ•™å­¦éƒ¨&#x27;);<br>insert into dept values(1002, &#x27;è´¢åŠ¡éƒ¨&#x27;);<br>insert into dept values(1003, &#x27;å’¨è¯¢éƒ¨&#x27;);<br><br>insert into emp values(1,&#x27;å¼ ä¸‰&#x27;,1001); #åœ¨æ·»åŠ è¿™æ¡è®°å½•æ—¶ï¼Œè¦æ±‚éƒ¨é—¨è¡¨æœ‰1001éƒ¨é—¨<br>insert into emp values(2,&#x27;æå››&#x27;,1001);<br>insert into emp values(3,&#x27;ç‹äº”&#x27;,1002);<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select * from dept;<br>+------+--------+<br>| did  | dname  |<br>+------+--------+<br>| 1001 | æ•™å­¦éƒ¨ |<br>| 1002 | è´¢åŠ¡éƒ¨ |<br>| 1003 | å’¨è¯¢éƒ¨ |<br>+------+--------+<br>3 rows in set (0.00 sec)<br><br>mysql&gt; select * from emp;<br>+-----+-------+--------+<br>| eid | ename | deptid |<br>+-----+-------+--------+<br>|   1 | å¼ ä¸‰  |   1001 |<br>|   2 | æå››  |   1001 |<br>|   3 | ç‹äº”  |   1002 |<br>+-----+-------+--------+<br>3 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#ä¿®æ”¹ä¸»è¡¨ï¼Œä»è¡¨å¯¹åº”çš„å­—æ®µè‡ªåŠ¨ä¿®æ”¹<br>mysql&gt; update dept set did = 1004 where did = 1002;<br>Query OK, 1 row affected (0.00 sec)<br>Rows matched: 1  Changed: 1  Warnings: 0<br><br>mysql&gt; select * from dept;<br>+------+--------+<br>| did  | dname  |<br>+------+--------+<br>| 1001 | æ•™å­¦éƒ¨ |<br>| 1003 | å’¨è¯¢éƒ¨ |<br>| 1004 | è´¢åŠ¡éƒ¨ | #éƒ¨é—¨1002ä¿®æ”¹ä¸º1004<br>+------+--------+<br>3 rows in set (0.00 sec)<br><br>mysql&gt; select * from emp;<br>+-----+-------+--------+<br>| eid | ename | deptid |<br>+-----+-------+--------+<br>|   1 | å¼ ä¸‰  |   1001 |<br>|   2 | æå››  |   1001 |<br>|   3 | ç‹äº”  |   1004 | #çº§è”ä¿®æ”¹<br>+-----+-------+--------+<br>3 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#åˆ é™¤ä¸»è¡¨çš„è®°å½•æˆåŠŸï¼Œä¸»è¡¨çš„1001è¡Œè¢«åˆ é™¤äº†ï¼Œä»è¡¨ç›¸åº”çš„è®°å½•ä¹Ÿè¢«åˆ é™¤äº†<br>mysql&gt; delete from dept where did=1001;<br>Query OK, 1 row affected (0.00 sec)<br><br>mysql&gt; select * from dept;<br>+------+--------+<br>| did  | dname  | #1001éƒ¨é—¨è¢«åˆ é™¤äº†<br>+------+--------+<br>| 1003 | å’¨è¯¢éƒ¨ |<br>| 1004 | è´¢åŠ¡éƒ¨ | <br>+------+--------+<br>2 rows in set (0.00 sec)<br><br>mysql&gt; select * from emp;<br>+-----+-------+--------+<br>| eid | ename | deptid |  #1001éƒ¨é—¨çš„å‘˜å·¥ä¹Ÿè¢«åˆ é™¤äº†<br>+-----+-------+--------+<br>|   3 | ç‹äº”  |   1004 |<br>+-----+-------+--------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><h3 id="6-8-åˆ é™¤å¤–é”®çº¦æŸ"><a href="#6-8-åˆ é™¤å¤–é”®çº¦æŸ" class="headerlink" title="6.8 åˆ é™¤å¤–é”®çº¦æŸ"></a>6.8 åˆ é™¤å¤–é”®çº¦æŸ</h3><p>æµç¨‹å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs mysql">(1)ç¬¬ä¸€æ­¥å…ˆæŸ¥çœ‹çº¦æŸåå’Œåˆ é™¤å¤–é”®çº¦æŸ<br>SELECT * FROM information_schema.table_constraints WHERE table_name = &#x27;è¡¨åç§°&#x27;;#æŸ¥çœ‹æŸä¸ªè¡¨çš„çº¦æŸå<br><br>ALTER TABLE ä»è¡¨å DROP FOREIGN KEY å¤–é”®çº¦æŸå;<br><br>ï¼ˆ2ï¼‰ç¬¬äºŒæ­¥æŸ¥çœ‹ç´¢å¼•åå’Œåˆ é™¤ç´¢å¼•ã€‚ï¼ˆæ³¨æ„ï¼Œåªèƒ½æ‰‹åŠ¨åˆ é™¤ï¼‰<br>SHOW INDEX FROM è¡¨åç§°; #æŸ¥çœ‹æŸä¸ªè¡¨çš„ç´¢å¼•å<br><br>ALTER TABLE ä»è¡¨å DROP INDEX ç´¢å¼•å; #æ­¤å¤„ç´¢å¼•åå°±æ˜¯å¤–é”®åï¼ˆäºŒè€…åŒåï¼‰<br><br></code></pre></td></tr></table></figure><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT * FROM information_schema.table_constraints WHERE table_name = &#x27;emp&#x27;;<br><br>mysql&gt; alter table emp drop foreign key emp_ibfk_1;<br>Query OK, 0 rows affected (0.02 sec)<br>Records: 0  Duplicates: 0  Warnings: 0<br><br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; show index from emp;<br><br>mysql&gt; alter table emp drop index deptid;<br>Query OK, 0 rows affected (0.01 sec)<br>Records: 0  Duplicates: 0  Warnings: 0<br><br>mysql&gt;  show index from emp;<br></code></pre></td></tr></table></figure><h3 id="6-9-å¼€å‘åœºæ™¯"><a href="#6-9-å¼€å‘åœºæ™¯" class="headerlink" title="6.9 å¼€å‘åœºæ™¯"></a>6.9 å¼€å‘åœºæ™¯</h3><p><strong>é—®é¢˜1ï¼šå¦‚æœä¸¤ä¸ªè¡¨ä¹‹é—´æœ‰å…³ç³»ï¼ˆä¸€å¯¹ä¸€ã€ä¸€å¯¹å¤šï¼‰ï¼Œæ¯”å¦‚ï¼šå‘˜å·¥è¡¨å’Œéƒ¨é—¨è¡¨ï¼ˆä¸€å¯¹å¤šï¼‰ï¼Œå®ƒä»¬ä¹‹é—´æ˜¯å¦ä¸€å®šè¦å»ºå¤–é”®çº¦æŸï¼Ÿ</strong></p><p>ç­”ï¼šä¸æ˜¯çš„</p><p><strong>é—®é¢˜2ï¼šå»ºå’Œä¸å»ºå¤–é”®çº¦æŸæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</strong></p><p>ç­”ï¼šå»ºå¤–é”®çº¦æŸï¼Œä½ çš„æ“ä½œï¼ˆåˆ›å»ºè¡¨ã€åˆ é™¤è¡¨ã€æ·»åŠ ã€ä¿®æ”¹ã€åˆ é™¤ï¼‰ä¼šå—åˆ°é™åˆ¶ï¼Œä»è¯­æ³•å±‚é¢å—åˆ°é™åˆ¶ã€‚ä¾‹å¦‚ï¼šåœ¨å‘˜å·¥è¡¨ä¸­ä¸å¯èƒ½æ·»åŠ ä¸€ä¸ªå‘˜å·¥ä¿¡æ¯ï¼Œå®ƒçš„éƒ¨é—¨çš„å€¼åœ¨éƒ¨é—¨è¡¨ä¸­æ‰¾ä¸åˆ°ã€‚</p><p>ä¸å»ºå¤–é”®çº¦æŸï¼Œä½ çš„æ“ä½œï¼ˆåˆ›å»ºè¡¨ã€åˆ é™¤è¡¨ã€æ·»åŠ ã€ä¿®æ”¹ã€åˆ é™¤ï¼‰ä¸å—é™åˆ¶ï¼Œè¦ä¿è¯æ•°æ®çš„<code>å¼•ç”¨å®Œæ•´æ€§</code>ï¼Œåªèƒ½ä¾<code>é ç¨‹åºå‘˜çš„è‡ªè§‰</code>ï¼Œæˆ–è€…æ˜¯<code>åœ¨Javaç¨‹åºä¸­è¿›è¡Œé™å®š</code>ã€‚ä¾‹å¦‚ï¼šåœ¨å‘˜å·¥è¡¨ä¸­ï¼Œå¯ä»¥æ·»åŠ ä¸€ä¸ªå‘˜å·¥çš„ä¿¡æ¯ï¼Œå®ƒçš„éƒ¨é—¨æŒ‡å®šä¸ºä¸€ä¸ªå®Œå…¨ä¸å­˜åœ¨çš„éƒ¨é—¨ã€‚</p><p><strong>é—®é¢˜3ï¼šé‚£ä¹ˆå»ºå’Œä¸å»ºå¤–é”®çº¦æŸå’ŒæŸ¥è¯¢æœ‰æ²¡æœ‰å…³ç³»ï¼Ÿ</strong></p><p>ç­”ï¼šæ²¡æœ‰</p><blockquote><p>åœ¨ MySQL é‡Œï¼Œå¤–é”®çº¦æŸæ˜¯æœ‰æˆæœ¬çš„ï¼Œéœ€è¦æ¶ˆè€—ç³»ç»Ÿèµ„æºã€‚å¯¹äºå¤§å¹¶å‘çš„ SQL æ“ä½œï¼Œæœ‰å¯èƒ½ä¼šä¸é€‚åˆã€‚æ¯”å¦‚å¤§å‹ç½‘ç«™çš„ä¸­å¤®æ•°æ®åº“ï¼Œå¯èƒ½ä¼š<code>å› ä¸ºå¤–é”®çº¦æŸçš„ç³»ç»Ÿå¼€é”€è€Œå˜å¾—éå¸¸æ…¢</code>ã€‚æ‰€ä»¥ï¼Œ MySQL å…è®¸ä½ ä¸ä½¿ç”¨ç³»ç»Ÿè‡ªå¸¦çš„å¤–é”®çº¦æŸï¼Œåœ¨<code>åº”ç”¨å±‚é¢</code>å®Œæˆæ£€æŸ¥æ•°æ®ä¸€è‡´æ€§çš„é€»è¾‘ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå³ä½¿ä½ ä¸ç”¨å¤–é”®çº¦æŸï¼Œä¹Ÿè¦æƒ³åŠæ³•é€šè¿‡åº”ç”¨å±‚é¢çš„é™„åŠ é€»è¾‘ï¼Œæ¥å®ç°å¤–é”®çº¦æŸçš„åŠŸèƒ½ï¼Œç¡®ä¿æ•°æ®çš„ä¸€è‡´æ€§ã€‚</p></blockquote><h3 id="6-10-é˜¿é‡Œå¼€å‘è§„èŒƒ"><a href="#6-10-é˜¿é‡Œå¼€å‘è§„èŒƒ" class="headerlink" title="6.10 é˜¿é‡Œå¼€å‘è§„èŒƒ"></a>6.10 é˜¿é‡Œå¼€å‘è§„èŒƒ</h3><p>ã€<code>å¼ºåˆ¶</code>ã€‘ä¸å¾—ä½¿ç”¨å¤–é”®ä¸çº§è”ï¼Œä¸€åˆ‡å¤–é”®æ¦‚å¿µå¿…é¡»åœ¨åº”ç”¨å±‚è§£å†³ã€‚ </p><p>è¯´æ˜ï¼šï¼ˆæ¦‚å¿µè§£é‡Šï¼‰å­¦ç”Ÿè¡¨ä¸­çš„ student_id æ˜¯ä¸»é”®ï¼Œé‚£ä¹ˆæˆç»©è¡¨ä¸­çš„ student_id åˆ™ä¸ºå¤–é”®ã€‚å¦‚æœæ›´æ–°å­¦ç”Ÿè¡¨ä¸­çš„ student_idï¼ŒåŒæ—¶è§¦å‘æˆç»©è¡¨ä¸­çš„ student_id æ›´æ–°ï¼Œå³ä¸ºçº§è”æ›´æ–°ã€‚å¤–é”®ä¸çº§è”æ›´æ–°é€‚ç”¨äº<code>å•æœºä½å¹¶å‘</code>ï¼Œä¸é€‚åˆ<code>åˆ†å¸ƒå¼</code>ã€<code>é«˜å¹¶å‘é›†ç¾¤</code>ï¼›çº§è”æ›´æ–°æ˜¯å¼ºé˜»å¡ï¼Œå­˜åœ¨æ•°æ®åº“<code>æ›´æ–°é£æš´</code>çš„é£é™©ï¼›å¤–é”®å½±å“æ•°æ®åº“çš„<code>æ’å…¥é€Ÿåº¦</code>ã€‚</p><h2 id="7-CHECK-çº¦æŸ"><a href="#7-CHECK-çº¦æŸ" class="headerlink" title="7. CHECK çº¦æŸ"></a>7. CHECK çº¦æŸ</h2><h3 id="7-1-ä½œç”¨"><a href="#7-1-ä½œç”¨" class="headerlink" title="7.1 ä½œç”¨"></a>7.1 ä½œç”¨</h3><p>æ£€æŸ¥æŸä¸ªå­—æ®µçš„å€¼æ˜¯å¦ç¬¦åˆxxè¦æ±‚ï¼Œä¸€èˆ¬æŒ‡çš„æ˜¯å€¼çš„èŒƒå›´</p><h3 id="2ã€å…³é”®å­—"><a href="#2ã€å…³é”®å­—" class="headerlink" title="2ã€å…³é”®å­—"></a>2ã€å…³é”®å­—</h3><p>CHECK</p><h3 id="3ã€è¯´æ˜ï¼šMySQL-5-7-ä¸æ”¯æŒ"><a href="#3ã€è¯´æ˜ï¼šMySQL-5-7-ä¸æ”¯æŒ" class="headerlink" title="3ã€è¯´æ˜ï¼šMySQL 5.7 ä¸æ”¯æŒ"></a>3ã€è¯´æ˜ï¼šMySQL 5.7 ä¸æ”¯æŒ</h3><p>MySQL5.7 å¯ä»¥ä½¿ç”¨checkçº¦æŸï¼Œä½†checkçº¦æŸå¯¹æ•°æ®éªŒè¯æ²¡æœ‰ä»»ä½•ä½œç”¨ã€‚æ·»åŠ æ•°æ®æ—¶ï¼Œæ²¡æœ‰ä»»ä½•é”™è¯¯æˆ–è­¦å‘Š</p><p>ä½†æ˜¯<strong>MySQL 8.0ä¸­å¯ä»¥ä½¿ç”¨checkçº¦æŸäº†</strong>ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">create table employee(<br>eid int primary key,<br>    ename varchar(5),<br>    gender char check (&#x27;ç”·&#x27; or &#x27;å¥³&#x27;)<br>);<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">insert into employee values(1,&#x27;å¼ ä¸‰&#x27;,&#x27;å¦–&#x27;);<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select * from employee;<br>+-----+-------+--------+<br>| eid | ename | gender |<br>+-----+-------+--------+<br>|   1 | å¼ ä¸‰   | å¦–     |<br>+-----+-------+--------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><ul><li>å†ä¸¾ä¾‹</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE TABLE temp(<br>id INT AUTO_INCREMENT,<br>NAME VARCHAR(20),<br>age INT CHECK(age &gt; 20),<br>PRIMARY KEY(id)<br>);<br></code></pre></td></tr></table></figure><ul><li>å†ä¸¾ä¾‹</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">age tinyint check(age &gt;20) æˆ– sex char(2) check(sex in(â€˜ç”·â€™,â€™å¥³â€™))<br></code></pre></td></tr></table></figure><ul><li>å†ä¸¾ä¾‹</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CHECK(height&gt;=0 AND height&lt;3)<br></code></pre></td></tr></table></figure><h2 id="8-DEFAULTçº¦æŸ"><a href="#8-DEFAULTçº¦æŸ" class="headerlink" title="8. DEFAULTçº¦æŸ"></a>8. DEFAULTçº¦æŸ</h2><h3 id="8-1-ä½œç”¨"><a href="#8-1-ä½œç”¨" class="headerlink" title="8.1 ä½œç”¨"></a>8.1 ä½œç”¨</h3><p>ç»™æŸä¸ªå­—æ®µ/æŸåˆ—æŒ‡å®šé»˜è®¤å€¼ï¼Œä¸€æ—¦è®¾ç½®é»˜è®¤å€¼ï¼Œåœ¨æ’å…¥æ•°æ®æ—¶ï¼Œå¦‚æœæ­¤å­—æ®µæ²¡æœ‰æ˜¾å¼èµ‹å€¼ï¼Œåˆ™èµ‹å€¼ä¸ºé»˜è®¤å€¼ã€‚</p><h3 id="8-2-å…³é”®å­—"><a href="#8-2-å…³é”®å­—" class="headerlink" title="8.2 å…³é”®å­—"></a>8.2 å…³é”®å­—</h3><p>DEFAULT</p><h3 id="8-3-å¦‚ä½•ç»™å­—æ®µåŠ é»˜è®¤å€¼"><a href="#8-3-å¦‚ä½•ç»™å­—æ®µåŠ é»˜è®¤å€¼" class="headerlink" title="8.3 å¦‚ä½•ç»™å­—æ®µåŠ é»˜è®¤å€¼"></a>8.3 å¦‚ä½•ç»™å­—æ®µåŠ é»˜è®¤å€¼</h3><p>ï¼ˆ1ï¼‰å»ºè¡¨æ—¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs mysql">create table è¡¨åç§°(<br>å­—æ®µå  æ•°æ®ç±»å‹  primary key,<br>    å­—æ®µå  æ•°æ®ç±»å‹  unique key not null,  <br>    å­—æ®µå  æ•°æ®ç±»å‹  unique key,<br>    å­—æ®µå  æ•°æ®ç±»å‹  not null default é»˜è®¤å€¼, <br>);<br>create table è¡¨åç§°(<br>å­—æ®µå  æ•°æ®ç±»å‹ default é»˜è®¤å€¼ ,<br>    å­—æ®µå  æ•°æ®ç±»å‹ not null default é»˜è®¤å€¼,  <br>    å­—æ®µå  æ•°æ®ç±»å‹ not null default é»˜è®¤å€¼,<br>    primary key(å­—æ®µå),<br>    unique key(å­—æ®µå)<br>);<br><br>è¯´æ˜ï¼šé»˜è®¤å€¼çº¦æŸä¸€èˆ¬ä¸åœ¨å”¯ä¸€é”®å’Œä¸»é”®åˆ—ä¸ŠåŠ <br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs mysql">create table employee(<br>eid int primary key,<br>    ename varchar(20) not null,<br>    gender char default &#x27;ç”·&#x27;,<br>    tel char(11) not null default &#x27;&#x27; #é»˜è®¤æ˜¯ç©ºå­—ç¬¦ä¸²<br>);<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; desc employee;<br>+--------+-------------+------+-----+---------+-------+<br>| Field  | Type        | Null | Key | Default | Extra |<br>+--------+-------------+------+-----+---------+-------+<br>| eid    | int(11)     | NO   | PRI | NULL    |       |<br>| ename  | varchar(20) | NO   |     | NULL    |       |<br>| gender | char(1)     | YES  |     | ç”·      |       |<br>| tel    | char(11)    | NO   |     |         |       |<br>+--------+-------------+------+-----+---------+-------+<br>4 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">insert into employee values(1,&#x27;æ±ªé£&#x27;,&#x27;ç”·&#x27;,&#x27;13700102535&#x27;); #æˆåŠŸ<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select * from employee;<br>+-----+-------+--------+-------------+<br>| eid | ename | gender | tel         |<br>+-----+-------+--------+-------------+<br>|   1 | æ±ªé£  | ç”·     | 13700102535 |<br>+-----+-------+--------+-------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">insert into employee(eid,ename) values(2,&#x27;å¤©çª&#x27;); #æˆåŠŸ<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select * from employee;<br>+-----+-------+--------+-------------+<br>| eid | ename | gender | tel         |<br>+-----+-------+--------+-------------+<br>|   1 | æ±ªé£  | ç”·     | 13700102535 |<br>|   2 | å¤©çª  | ç”·     |             |<br>+-----+-------+--------+-------------+<br>2 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">insert into employee(eid,ename) values(3,&#x27;äºŒè™&#x27;);<br>#ERROR 1062 (23000): Duplicate entry &#x27;&#x27; for key &#x27;tel&#x27;  <br>#å¦‚æœtelæœ‰å”¯ä¸€æ€§çº¦æŸçš„è¯ä¼šæŠ¥é”™ï¼Œå¦‚æœtelæ²¡æœ‰å”¯ä¸€æ€§çº¦æŸï¼Œå¯ä»¥æ·»åŠ æˆåŠŸ<br></code></pre></td></tr></table></figure><p>å†ä¸¾ä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE TABLE myemp(<br>id INT AUTO_INCREMENT PRIMARY KEY,<br>NAME VARCHAR(15),<br>salary DOUBLE(10,2) DEFAULT 2000<br>);<br></code></pre></td></tr></table></figure><p>ï¼ˆ2ï¼‰å»ºè¡¨å</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">alter table è¡¨åç§° modify å­—æ®µå æ•°æ®ç±»å‹ default é»˜è®¤å€¼;<br><br>#å¦‚æœè¿™ä¸ªå­—æ®µåŸæ¥æœ‰éç©ºçº¦æŸï¼Œä½ è¿˜ä¿ç•™éç©ºçº¦æŸï¼Œé‚£ä¹ˆåœ¨åŠ é»˜è®¤å€¼çº¦æŸæ—¶ï¼Œè¿˜å¾—ä¿ç•™éç©ºçº¦æŸï¼Œå¦åˆ™éç©ºçº¦æŸå°±è¢«åˆ é™¤äº†<br>#åŒç†ï¼Œåœ¨ç»™æŸä¸ªå­—æ®µåŠ éç©ºçº¦æŸä¹Ÿä¸€æ ·ï¼Œå¦‚æœè¿™ä¸ªå­—æ®µåŸæ¥æœ‰é»˜è®¤å€¼çº¦æŸï¼Œä½ æƒ³ä¿ç•™ï¼Œä¹Ÿè¦åœ¨modifyè¯­å¥ä¸­ä¿ç•™é»˜è®¤å€¼çº¦æŸï¼Œå¦åˆ™å°±åˆ é™¤äº†<br>alter table è¡¨åç§° modify å­—æ®µå æ•°æ®ç±»å‹ default é»˜è®¤å€¼ not null;<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs mysql">create table employee(<br>eid int primary key,<br>    ename varchar(20),<br>    gender char,<br>    tel char(11) not null<br>);<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; desc employee;<br>+--------+-------------+------+-----+---------+-------+<br>| Field  | Type        | Null | Key | Default | Extra |<br>+--------+-------------+------+-----+---------+-------+<br>| eid    | int(11)     | NO   | PRI | NULL    |       |<br>| ename  | varchar(20) | YES  |     | NULL    |       |<br>| gender | char(1)     | YES  |     | NULL    |       |<br>| tel    | char(11)    | NO   |     | NULL    |       |<br>+--------+-------------+------+-----+---------+-------+<br>4 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">alter table employee modify gender char default &#x27;ç”·&#x27;;  #ç»™genderå­—æ®µå¢åŠ é»˜è®¤å€¼çº¦æŸ<br>alter table employee modify tel char(11) default &#x27;&#x27;; #ç»™telå­—æ®µå¢åŠ é»˜è®¤å€¼çº¦æŸ<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; desc employee;<br>+--------+-------------+------+-----+---------+-------+<br>| Field  | Type        | Null | Key | Default | Extra |<br>+--------+-------------+------+-----+---------+-------+<br>| eid    | int(11)     | NO   | PRI | NULL    |       |<br>| ename  | varchar(20) | YES  |     | NULL    |       |<br>| gender | char(1)     | YES  |     | ç”·      |       |<br>| tel    | char(11)    | YES  |     |         |       |<br>+--------+-------------+------+-----+---------+-------+<br>4 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">alter table employee modify tel char(11) default &#x27;&#x27;  not null;#ç»™telå­—æ®µå¢åŠ é»˜è®¤å€¼çº¦æŸï¼Œå¹¶ä¿ç•™éç©ºçº¦æŸ<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; desc employee;<br>+--------+-------------+------+-----+---------+-------+<br>| Field  | Type        | Null | Key | Default | Extra |<br>+--------+-------------+------+-----+---------+-------+<br>| eid    | int(11)     | NO   | PRI | NULL    |       |<br>| ename  | varchar(20) | YES  |     | NULL    |       |<br>| gender | char(1)     | YES  |     | ç”·      |       |<br>| tel    | char(11)    | NO   |     |         |       |<br>+--------+-------------+------+-----+---------+-------+<br>4 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><h3 id="8-4-å¦‚ä½•åˆ é™¤é»˜è®¤å€¼çº¦æŸ"><a href="#8-4-å¦‚ä½•åˆ é™¤é»˜è®¤å€¼çº¦æŸ" class="headerlink" title="8.4 å¦‚ä½•åˆ é™¤é»˜è®¤å€¼çº¦æŸ"></a>8.4 å¦‚ä½•åˆ é™¤é»˜è®¤å€¼çº¦æŸ</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">alter table è¡¨åç§° modify å­—æ®µå æ•°æ®ç±»å‹ ;#åˆ é™¤é»˜è®¤å€¼çº¦æŸï¼Œä¹Ÿä¸ä¿ç•™éç©ºçº¦æŸ<br><br>alter table è¡¨åç§° modify å­—æ®µå æ•°æ®ç±»å‹  not null; #åˆ é™¤é»˜è®¤å€¼çº¦æŸï¼Œä¿ç•™éç©ºçº¦æŸ<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">alter table employee modify gender char; #åˆ é™¤genderå­—æ®µé»˜è®¤å€¼çº¦æŸï¼Œå¦‚æœæœ‰éç©ºçº¦æŸï¼Œä¹Ÿä¸€å¹¶åˆ é™¤<br>alter table employee modify tel char(11)  not null;#åˆ é™¤telå­—æ®µé»˜è®¤å€¼çº¦æŸï¼Œä¿ç•™éç©ºçº¦æŸ<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; desc employee;<br>+--------+-------------+------+-----+---------+-------+<br>| Field  | Type        | Null | Key | Default | Extra |<br>+--------+-------------+------+-----+---------+-------+<br>| eid    | int(11)     | NO   | PRI | NULL    |       |<br>| ename  | varchar(20) | YES  |     | NULL    |       |<br>| gender | char(1)     | YES  |     | NULL    |       |<br>| tel    | char(11)    | NO   |     | NULL    |       |<br>+--------+-------------+------+-----+---------+-------+<br>4 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><h2 id="9-é¢è¯•"><a href="#9-é¢è¯•" class="headerlink" title="9. é¢è¯•"></a>9. é¢è¯•</h2><p><strong>é¢è¯•1ã€ä¸ºä»€ä¹ˆå»ºè¡¨æ—¶ï¼ŒåŠ  not null default â€˜â€™ ï¼ˆå­—ç¬¦ä¸²ç±»å‹ï¼‰æˆ– default 0ï¼ˆæ•°å­—ç±»å‹ï¼‰</strong></p><p>ç­”ï¼šä¸æƒ³è®©è¡¨ä¸­å‡ºç°nullå€¼ã€‚</p><p><strong>é¢è¯•2ã€ä¸ºä»€ä¹ˆä¸æƒ³è¦ null çš„å€¼</strong></p><p>ç­”:ï¼ˆ1ï¼‰ä¸å¥½æ¯”è¾ƒã€‚nullæ˜¯ä¸€ç§ç‰¹æ®Šå€¼ï¼Œæ¯”è¾ƒæ—¶åªèƒ½ç”¨ä¸“é—¨çš„is null å’Œ is not nullæ¥æ¯”è¾ƒã€‚ç¢°åˆ°è¿ç®—ç¬¦ï¼Œé€šå¸¸è¿”å›nullã€‚</p><div class="code-wrapper"><pre><code class="hljs"> ï¼ˆ2ï¼‰æ•ˆç‡ä¸é«˜ã€‚å½±å“æé«˜ç´¢å¼•æ•ˆæœã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¾€å¾€åœ¨å»ºè¡¨æ—¶ not null default &#39;&#39; æˆ– default 0</code></pre></div><p><strong>é¢è¯•3ã€å¸¦AUTO_INCREMENTçº¦æŸçš„å­—æ®µå€¼æ˜¯ä»1å¼€å§‹çš„å—ï¼Ÿ</strong><br>åœ¨MySQLä¸­ï¼Œé»˜è®¤AUTO_INCREMENTçš„åˆå§‹å€¼æ˜¯1ï¼Œæ¯æ–°å¢ä¸€æ¡è®°å½•ï¼Œå­—æ®µå€¼è‡ªåŠ¨åŠ 1ã€‚è®¾ç½®è‡ªå¢å±æ€§ï¼ˆAUTO_INCREMENTï¼‰çš„æ—¶å€™ï¼Œè¿˜å¯ä»¥æŒ‡å®šç¬¬ä¸€æ¡æ’å…¥è®°å½•çš„è‡ªå¢å­—æ®µçš„å€¼ï¼Œè¿™æ ·æ–°æ’å…¥çš„è®°å½•çš„è‡ªå¢å­—æ®µå€¼ä»åˆå§‹å€¼å¼€å§‹é€’å¢ï¼Œå¦‚åœ¨è¡¨ä¸­æ’å…¥ç¬¬ä¸€æ¡è®°å½•ï¼ŒåŒæ—¶æŒ‡å®šidå€¼ä¸º5ï¼Œåˆ™ä»¥åæ’å…¥çš„è®°å½•çš„idå€¼å°±ä¼šä»6å¼€å§‹å¾€ä¸Šå¢åŠ ã€‚æ·»åŠ ä¸»é”®çº¦æŸæ—¶ï¼Œå¾€å¾€éœ€è¦è®¾ç½®å­—æ®µè‡ªåŠ¨å¢åŠ å±æ€§ã€‚</p><p><strong>é¢è¯•4ã€å¹¶ä¸æ˜¯æ¯ä¸ªè¡¨éƒ½å¯ä»¥ä»»æ„é€‰æ‹©å­˜å‚¨å¼•æ“ï¼Ÿ</strong><br>å¤–é”®çº¦æŸï¼ˆFOREIGN KEYï¼‰ä¸èƒ½è·¨å¼•æ“ä½¿ç”¨ã€‚</p><p>MySQLæ”¯æŒå¤šç§å­˜å‚¨å¼•æ“ï¼Œæ¯ä¸€ä¸ªè¡¨éƒ½å¯ä»¥æŒ‡å®šä¸€ä¸ªä¸åŒçš„å­˜å‚¨å¼•æ“ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼šå¤–é”®çº¦æŸæ˜¯ç”¨æ¥ä¿è¯æ•°æ®çš„å‚ç…§å®Œæ•´æ€§çš„ï¼Œå¦‚æœè¡¨ä¹‹é—´éœ€è¦å…³è”å¤–é”®ï¼Œå´æŒ‡å®šäº†ä¸åŒçš„å­˜å‚¨å¼•æ“ï¼Œé‚£ä¹ˆè¿™äº›è¡¨ä¹‹é—´æ˜¯ä¸èƒ½åˆ›å»ºå¤–é”®çº¦æŸçš„ã€‚æ‰€ä»¥è¯´ï¼Œå­˜å‚¨å¼•æ“çš„é€‰æ‹©ä¹Ÿä¸å®Œå…¨æ˜¯éšæ„çš„ã€‚</p><p>å¯¹æ¯ä¸ªè¡¨é€‰æ‹©å­˜å‚¨å¼•æ“æ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">#å¯¹äºåˆ›å»ºè¡¨æ—¶çš„å®šä¹‰ï¼Œå¯ä»¥ä»¿ç…§ä¸‹é¢æŒ‡ä»¤è¿”å›çš„æ ¼å¼æ¥å†™<br><br><span class="hljs-keyword">SHOW</span> <span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> è¡¨å;<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20220314234125501.png"></p><h1 id="ç¬¬14ç« -è§†å›¾"><a href="#ç¬¬14ç« -è§†å›¾" class="headerlink" title="ç¬¬14ç« _è§†å›¾"></a>ç¬¬14ç« _è§†å›¾</h1><h2 id="1-å¸¸è§çš„æ•°æ®åº“å¯¹è±¡"><a href="#1-å¸¸è§çš„æ•°æ®åº“å¯¹è±¡" class="headerlink" title="1. å¸¸è§çš„æ•°æ®åº“å¯¹è±¡"></a>1. å¸¸è§çš„æ•°æ®åº“å¯¹è±¡</h2><table><thead><tr><th>å¯¹è±¡</th><th>æè¿°</th></tr></thead><tbody><tr><td>è¡¨(TABLE)</td><td>è¡¨æ˜¯å­˜å‚¨æ•°æ®çš„é€»è¾‘å•å…ƒï¼Œä»¥è¡Œå’Œåˆ—çš„å½¢å¼å­˜åœ¨ï¼Œåˆ—å°±æ˜¯å­—æ®µï¼Œè¡Œå°±æ˜¯è®°å½•</td></tr><tr><td>æ•°æ®å­—å…¸</td><td>å°±æ˜¯ç³»ç»Ÿè¡¨ï¼Œå­˜æ”¾æ•°æ®åº“ç›¸å…³ä¿¡æ¯çš„è¡¨ã€‚ç³»ç»Ÿè¡¨çš„æ•°æ®é€šå¸¸ç”±æ•°æ®åº“ç³»ç»Ÿç»´æŠ¤ï¼Œç¨‹åºå‘˜é€šå¸¸ä¸åº”è¯¥ä¿®æ”¹ï¼Œåªå¯æŸ¥çœ‹</td></tr><tr><td>çº¦æŸ(CONSTRAINT)</td><td>æ‰§è¡Œæ•°æ®æ ¡éªŒçš„è§„åˆ™ï¼Œç”¨äºä¿è¯<strong>æ•°æ®å®Œæ•´æ€§</strong>çš„è§„åˆ™</td></tr><tr><td>è§†å›¾(VIEW)</td><td>ä¸€ä¸ªæˆ–è€…å¤šä¸ªæ•°æ®è¡¨é‡Œçš„æ•°æ®çš„é€»è¾‘æ˜¾ç¤ºï¼Œè§†å›¾å¹¶ä¸å­˜å‚¨æ•°æ®</td></tr><tr><td>ç´¢å¼•(INDEX)</td><td>ç”¨äºæé«˜æŸ¥è¯¢æ€§èƒ½ï¼Œç›¸å½“äºä¹¦çš„ç›®å½•</td></tr><tr><td>å­˜å‚¨è¿‡ç¨‹(PROCEDURE)</td><td>ç”¨äºå®Œæˆä¸€æ¬¡å®Œæ•´çš„ä¸šåŠ¡å¤„ç†ï¼Œæ²¡æœ‰è¿”å›å€¼ï¼Œä½†å¯é€šè¿‡ä¼ å‡ºå‚æ•°å°†å¤šä¸ªå€¼ä¼ ç»™è°ƒç”¨ç¯å¢ƒ</td></tr><tr><td>å­˜å‚¨å‡½æ•°(FUNCTION)</td><td>ç”¨äºå®Œæˆä¸€æ¬¡ç‰¹å®šçš„è®¡ç®—ï¼Œå…·æœ‰ä¸€ä¸ªè¿”å›å€¼</td></tr><tr><td>è§¦å‘å™¨(TRIGGER)</td><td>ç›¸å½“äºä¸€ä¸ªäº‹ä»¶ç›‘å¬å™¨ï¼Œå½“æ•°æ®åº“å‘ç”Ÿç‰¹å®šäº‹ä»¶åï¼Œè§¦å‘å™¨è¢«è§¦å‘ï¼Œå®Œæˆç›¸åº”çš„å¤„ç†</td></tr></tbody></table><h2 id="2-è§†å›¾æ¦‚è¿°"><a href="#2-è§†å›¾æ¦‚è¿°" class="headerlink" title="2. è§†å›¾æ¦‚è¿°"></a>2. è§†å›¾æ¦‚è¿°</h2><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1555430281798.png"></p><h3 id="2-1-ä¸ºä»€ä¹ˆä½¿ç”¨è§†å›¾ï¼Ÿ"><a href="#2-1-ä¸ºä»€ä¹ˆä½¿ç”¨è§†å›¾ï¼Ÿ" class="headerlink" title="2.1 ä¸ºä»€ä¹ˆä½¿ç”¨è§†å›¾ï¼Ÿ"></a>2.1 ä¸ºä»€ä¹ˆä½¿ç”¨è§†å›¾ï¼Ÿ</h3><p>è§†å›¾ä¸€æ–¹é¢å¯ä»¥å¸®æˆ‘ä»¬ä½¿ç”¨è¡¨çš„ä¸€éƒ¨åˆ†è€Œä¸æ˜¯æ‰€æœ‰çš„è¡¨ï¼Œå¦ä¸€æ–¹é¢ä¹Ÿå¯ä»¥é’ˆå¯¹ä¸åŒçš„ç”¨æˆ·åˆ¶å®šä¸åŒçš„æŸ¥è¯¢è§†å›¾ã€‚æ¯”å¦‚ï¼Œé’ˆå¯¹ä¸€ä¸ªå…¬å¸çš„é”€å”®äººå‘˜ï¼Œæˆ‘ä»¬åªæƒ³ç»™ä»–çœ‹éƒ¨åˆ†æ•°æ®ï¼Œè€ŒæŸäº›ç‰¹æ®Šçš„æ•°æ®ï¼Œæ¯”å¦‚é‡‡è´­çš„ä»·æ ¼ï¼Œåˆ™ä¸ä¼šæä¾›ç»™ä»–ã€‚å†æ¯”å¦‚ï¼Œäººå‘˜è–ªé…¬æ˜¯ä¸ªæ•æ„Ÿçš„å­—æ®µï¼Œé‚£ä¹ˆåªç»™æŸä¸ªçº§åˆ«ä»¥ä¸Šçš„äººå‘˜å¼€æ”¾ï¼Œå…¶ä»–äººçš„æŸ¥è¯¢è§†å›¾ä¸­åˆ™ä¸æä¾›è¿™ä¸ªå­—æ®µã€‚</p><p>åˆšæ‰è®²çš„åªæ˜¯è§†å›¾çš„ä¸€ä¸ªä½¿ç”¨åœºæ™¯ï¼Œå®é™…ä¸Šè§†å›¾è¿˜æœ‰å¾ˆå¤šä½œç”¨ã€‚æœ€åï¼Œæˆ‘ä»¬æ€»ç»“è§†å›¾çš„ä¼˜ç‚¹ã€‚</p><h3 id="2-2-è§†å›¾çš„ç†è§£"><a href="#2-2-è§†å›¾çš„ç†è§£" class="headerlink" title="2.2 è§†å›¾çš„ç†è§£"></a>2.2 è§†å›¾çš„ç†è§£</h3><ul><li><p>è§†å›¾æ˜¯ä¸€ç§<code>è™šæ‹Ÿè¡¨</code>ï¼Œæœ¬èº«æ˜¯<code>ä¸å…·æœ‰æ•°æ®</code>çš„ï¼Œå ç”¨å¾ˆå°‘çš„å†…å­˜ç©ºé—´ï¼Œå®ƒæ˜¯ SQL ä¸­çš„ä¸€ä¸ªé‡è¦æ¦‚å¿µã€‚</p></li><li><p><strong>è§†å›¾å»ºç«‹åœ¨å·²æœ‰è¡¨çš„åŸºç¡€ä¸Š</strong>, è§†å›¾èµ–ä»¥å»ºç«‹çš„è¿™äº›è¡¨ç§°ä¸º<strong>åŸºè¡¨</strong>ã€‚ï¼ˆSELECTè¯­å¥ä¸­æ¶‰åŠåˆ°çš„è¡¨ï¼‰</p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211006211206990.png" alt="" style="zoom:67%;" /></li><li><p>è§†å›¾çš„åˆ›å»ºå’Œåˆ é™¤åªå½±å“è§†å›¾æœ¬èº«ï¼Œä¸å½±å“å¯¹åº”çš„åŸºè¡¨ã€‚ä½†æ˜¯å½“å¯¹è§†å›¾ä¸­çš„æ•°æ®è¿›è¡Œå¢åŠ ã€åˆ é™¤å’Œä¿®æ”¹æ“ä½œæ—¶ï¼Œæ•°æ®è¡¨ä¸­çš„æ•°æ®ä¼šç›¸åº”åœ°å‘ç”Ÿå˜åŒ–ï¼Œåä¹‹äº¦ç„¶ã€‚</p></li><li><p>å‘è§†å›¾æä¾›æ•°æ®å†…å®¹çš„è¯­å¥ä¸º SELECT è¯­å¥, å¯ä»¥å°†è§†å›¾ç†è§£ä¸º<strong>å­˜å‚¨èµ·æ¥çš„</strong> <strong>SELECT</strong> <strong>è¯­å¥</strong> </p><ul><li>åœ¨æ•°æ®åº“ä¸­ï¼Œè§†å›¾ä¸ä¼šä¿å­˜æ•°æ®ï¼Œæ•°æ®çœŸæ­£ä¿å­˜åœ¨æ•°æ®è¡¨ä¸­ã€‚å½“å¯¹è§†å›¾ä¸­çš„æ•°æ®è¿›è¡Œå¢åŠ ã€åˆ é™¤å’Œä¿®æ”¹æ“ä½œæ—¶ï¼Œæ•°æ®è¡¨ä¸­çš„æ•°æ®ä¼šç›¸åº”åœ°å‘ç”Ÿå˜åŒ–ï¼›åä¹‹äº¦ç„¶ã€‚<strong>ä¸è¿‡ï¼Œè§†å›¾ä¸­çš„å­—æ®µå¯èƒ½åœ¨åŸºè¡¨ä¸­å­˜åœ¨ä¸€ä¸€å¯¹åº”çš„å­—æ®µï¼›ä¹Ÿå¯èƒ½åœ¨åŸºè¡¨ä¸­ä¸å­˜åœ¨ä¸€ä¸€å¯¹åº”çš„å­—æ®µ</strong>ã€‚</li></ul></li><li><p>è§†å›¾ï¼Œæ˜¯å‘ç”¨æˆ·æä¾›åŸºè¡¨æ•°æ®çš„å¦ä¸€ç§è¡¨ç°å½¢å¼ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œå°å‹é¡¹ç›®çš„æ•°æ®åº“å¯ä»¥ä¸ä½¿ç”¨è§†å›¾ï¼Œä½†æ˜¯åœ¨å¤§å‹é¡¹ç›®ä¸­ï¼Œä»¥åŠæ•°æ®è¡¨æ¯”è¾ƒå¤æ‚çš„æƒ…å†µä¸‹ï¼Œè§†å›¾çš„ä»·å€¼å°±å‡¸æ˜¾å‡ºæ¥äº†ï¼Œå®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬æŠŠç»å¸¸æŸ¥è¯¢çš„ç»“æœé›†æ”¾åˆ°è™šæ‹Ÿè¡¨ä¸­ï¼Œæå‡ä½¿ç”¨æ•ˆç‡ã€‚ç†è§£å’Œä½¿ç”¨èµ·æ¥éƒ½éå¸¸æ–¹ä¾¿ã€‚</p></li></ul><h2 id="3-åˆ›å»ºè§†å›¾"><a href="#3-åˆ›å»ºè§†å›¾" class="headerlink" title="3. åˆ›å»ºè§†å›¾"></a>3. åˆ›å»ºè§†å›¾</h2><ul><li><strong>åœ¨</strong> <strong>CREATE VIEW</strong> <strong>è¯­å¥ä¸­åµŒå…¥å­æŸ¥è¯¢</strong></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE [OR REPLACE] <br>[ALGORITHM = &#123;UNDEFINED | MERGE | TEMPTABLE&#125;] <br>VIEW è§†å›¾åç§° [(å­—æ®µåˆ—è¡¨)]<br>AS æŸ¥è¯¢è¯­å¥<br>[WITH [CASCADED|LOCAL] CHECK OPTION]<br></code></pre></td></tr></table></figure><ul><li>ç²¾ç®€ç‰ˆ</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE VIEW è§†å›¾åç§° <br>AS æŸ¥è¯¢è¯­å¥<br></code></pre></td></tr></table></figure><h3 id="3-1-åˆ›å»ºå•è¡¨è§†å›¾"><a href="#3-1-åˆ›å»ºå•è¡¨è§†å›¾" class="headerlink" title="3.1 åˆ›å»ºå•è¡¨è§†å›¾"></a>3.1 åˆ›å»ºå•è¡¨è§†å›¾</h3><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE VIEW empvu80<br>AS <br>SELECT  employee_id, last_name, salary<br>FROM    employees<br>WHERE   department_id = 80;<br></code></pre></td></tr></table></figure><p>æŸ¥è¯¢è§†å›¾ï¼š</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">SELECT</span> *<br><span class="hljs-keyword">FROM</span>empvu80;<br></code></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/1555430882363.png" alt="" style="zoom:80%;" /><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#ç¡®å®šè§†å›¾ä¸­å­—æ®µåçš„æ–¹å¼1ï¼šé€šè¿‡CREATE VIEW èµ·åˆ—åˆ«å<br>CREATE VIEW emp_year_salary (ename,year_salary)<br>AS <br>SELECT ename,salary*12*(1+IFNULL(commission_pct,0))<br>FROM t_employee;<br></code></pre></td></tr></table></figure><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#ç¡®å®šè§†å›¾ä¸­å­—æ®µåçš„æ–¹å¼2ï¼šé€šè¿‡select è¯­å¥èµ·åˆ—åˆ«å<br>CREATE VIEW salvu50<br>AS <br>SELECT  employee_id ID_NUMBER, last_name NAME,salary*12 ANN_SALARY<br>FROM    employees<br>WHERE   department_id = 50;<br></code></pre></td></tr></table></figure><p>è¯´æ˜1ï¼šå®é™…ä¸Šå°±æ˜¯æˆ‘ä»¬åœ¨ SQL æŸ¥è¯¢è¯­å¥çš„åŸºç¡€ä¸Šå°è£…äº†è§†å›¾ VIEWï¼Œè¿™æ ·å°±ä¼šåŸºäº SQL è¯­å¥çš„ç»“æœé›†å½¢æˆä¸€å¼ è™šæ‹Ÿè¡¨ã€‚</p><p>è¯´æ˜2ï¼šåœ¨åˆ›å»ºè§†å›¾æ—¶ï¼Œæ²¡æœ‰åœ¨è§†å›¾ååé¢æŒ‡å®šå­—æ®µåˆ—è¡¨ï¼Œåˆ™è§†å›¾ä¸­å­—æ®µåˆ—è¡¨é»˜è®¤å’ŒSELECTè¯­å¥ä¸­çš„å­—æ®µåˆ—è¡¨ä¸€è‡´ã€‚å¦‚æœSELECTè¯­å¥ä¸­ç»™å­—æ®µå–äº†åˆ«åï¼Œé‚£ä¹ˆè§†å›¾ä¸­çš„å­—æ®µåå’Œåˆ«åç›¸åŒã€‚</p><h3 id="3-2-åˆ›å»ºå¤šè¡¨è”åˆè§†å›¾"><a href="#3-2-åˆ›å»ºå¤šè¡¨è”åˆè§†å›¾" class="headerlink" title="3.2 åˆ›å»ºå¤šè¡¨è”åˆè§†å›¾"></a>3.2 åˆ›å»ºå¤šè¡¨è”åˆè§†å›¾</h3><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE VIEW empview <br>AS <br>SELECT employee_id emp_id,last_name NAME,department_name<br>FROM employees e,departments d<br>WHERE e.department_id = d.department_id;<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE VIEW emp_dept<br>AS <br>SELECT ename,dname<br>FROM t_employee LEFT JOIN t_department<br>ON t_employee.did = t_department.did;<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE VIEWdept_sum_vu<br>(name, minsal, maxsal, avgsal)<br>AS <br>SELECT d.department_name, MIN(e.salary), MAX(e.salary),AVG(e.salary)<br>FROM employees e, departments d<br>WHERE e.department_id = d.department_id <br>GROUP BY  d.department_name;<br></code></pre></td></tr></table></figure><ul><li><strong>åˆ©ç”¨è§†å›¾å¯¹æ•°æ®è¿›è¡Œæ ¼å¼åŒ–</strong></li></ul><p>æˆ‘ä»¬ç»å¸¸éœ€è¦è¾“å‡ºæŸä¸ªæ ¼å¼çš„å†…å®¹ï¼Œæ¯”å¦‚æˆ‘ä»¬æƒ³è¾“å‡ºå‘˜å·¥å§“åå’Œå¯¹åº”çš„éƒ¨é—¨åï¼Œå¯¹åº”æ ¼å¼ä¸º emp_name(department_name)ï¼Œå°±å¯ä»¥ä½¿ç”¨è§†å›¾æ¥å®Œæˆæ•°æ®æ ¼å¼åŒ–çš„æ“ä½œï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE VIEW emp_depart<br>AS<br>SELECT CONCAT(last_name,&#x27;(&#x27;,department_name,&#x27;)&#x27;) AS emp_dept<br>FROM employees e JOIN departments d<br>WHERE e.department_id = d.department_id<br></code></pre></td></tr></table></figure><h3 id="3-3-åŸºäºè§†å›¾åˆ›å»ºè§†å›¾"><a href="#3-3-åŸºäºè§†å›¾åˆ›å»ºè§†å›¾" class="headerlink" title="3.3 åŸºäºè§†å›¾åˆ›å»ºè§†å›¾"></a>3.3 åŸºäºè§†å›¾åˆ›å»ºè§†å›¾</h3><p>å½“æˆ‘ä»¬åˆ›å»ºå¥½ä¸€å¼ è§†å›¾ä¹‹åï¼Œè¿˜å¯ä»¥åœ¨å®ƒçš„åŸºç¡€ä¸Šç»§ç»­åˆ›å»ºè§†å›¾ã€‚</p><p>ä¸¾ä¾‹ï¼šè”åˆâ€œemp_deptâ€è§†å›¾å’Œâ€œemp_year_salaryâ€è§†å›¾æŸ¥è¯¢å‘˜å·¥å§“åã€éƒ¨é—¨åç§°ã€å¹´è–ªä¿¡æ¯åˆ›å»º â€œemp_dept_ysalaryâ€è§†å›¾ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE VIEW emp_dept_ysalary<br>AS <br>SELECT emp_dept.ename,dname,year_salary<br>FROM emp_dept INNER JOIN emp_year_salary<br>ON emp_dept.ename = emp_year_salary.ename;<br></code></pre></td></tr></table></figure><h2 id="4-æŸ¥çœ‹è§†å›¾"><a href="#4-æŸ¥çœ‹è§†å›¾" class="headerlink" title="4. æŸ¥çœ‹è§†å›¾"></a>4. æŸ¥çœ‹è§†å›¾</h2><p>è¯­æ³•1ï¼šæŸ¥çœ‹æ•°æ®åº“çš„è¡¨å¯¹è±¡ã€è§†å›¾å¯¹è±¡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SHOW TABLES;<br></code></pre></td></tr></table></figure><p>è¯­æ³•2ï¼šæŸ¥çœ‹è§†å›¾çš„ç»“æ„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DESC / DESCRIBE è§†å›¾åç§°;<br></code></pre></td></tr></table></figure><p>è¯­æ³•3ï¼šæŸ¥çœ‹è§†å›¾çš„å±æ€§ä¿¡æ¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql"># æŸ¥çœ‹è§†å›¾ä¿¡æ¯ï¼ˆæ˜¾ç¤ºæ•°æ®è¡¨çš„å­˜å‚¨å¼•æ“ã€ç‰ˆæœ¬ã€æ•°æ®è¡Œæ•°å’Œæ•°æ®å¤§å°ç­‰ï¼‰<br>SHOW TABLE STATUS LIKE &#x27;è§†å›¾åç§°&#x27;\G<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœæ˜¾ç¤ºï¼Œæ³¨é‡ŠCommentä¸ºVIEWï¼Œè¯´æ˜è¯¥è¡¨ä¸ºè§†å›¾ï¼Œå…¶ä»–çš„ä¿¡æ¯ä¸ºNULLï¼Œè¯´æ˜è¿™æ˜¯ä¸€ä¸ªè™šè¡¨ã€‚</p><p>è¯­æ³•4ï¼šæŸ¥çœ‹è§†å›¾çš„è¯¦ç»†å®šä¹‰ä¿¡æ¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SHOW CREATE VIEW è§†å›¾åç§°;<br></code></pre></td></tr></table></figure><h2 id="5-æ›´æ–°è§†å›¾çš„æ•°æ®"><a href="#5-æ›´æ–°è§†å›¾çš„æ•°æ®" class="headerlink" title="5. æ›´æ–°è§†å›¾çš„æ•°æ®"></a>5. æ›´æ–°è§†å›¾çš„æ•°æ®</h2><h3 id="5-1-ä¸€èˆ¬æƒ…å†µ"><a href="#5-1-ä¸€èˆ¬æƒ…å†µ" class="headerlink" title="5.1 ä¸€èˆ¬æƒ…å†µ"></a>5.1 ä¸€èˆ¬æƒ…å†µ</h3><p>MySQLæ”¯æŒä½¿ç”¨INSERTã€UPDATEå’ŒDELETEè¯­å¥ï¼ˆè·Ÿå¯¹è¡¨çš„è¯­æ³•ä¸€è‡´ï¼‰å¯¹è§†å›¾ä¸­çš„æ•°æ®è¿›è¡Œæ’å…¥ã€æ›´æ–°å’Œåˆ é™¤æ“ä½œã€‚å½“è§†å›¾ä¸­çš„æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ•°æ®è¡¨ä¸­çš„æ•°æ®ä¹Ÿä¼šå‘ç”Ÿå˜åŒ–ï¼Œåä¹‹äº¦ç„¶ã€‚</p><p>ä¸¾ä¾‹ï¼šUPDATEæ“ä½œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT ename,tel FROM emp_tel WHERE ename = &#x27;å­™æ´ªäº®&#x27;;<br>+---------+-------------+<br>| ename   | tel         |<br>+---------+-------------+<br>| å­™æ´ªäº® | 13789098765 |<br>+---------+-------------+<br>1 row in set (0.01 sec)<br><br>mysql&gt; UPDATE emp_tel SET tel = &#x27;13789091234&#x27; WHERE ename = &#x27;å­™æ´ªäº®&#x27;;<br>Query OK, 1 row affected (0.01 sec)<br>Rows matched: 1  Changed: 1  Warnings: 0<br><br>mysql&gt; SELECT ename,tel FROM emp_tel WHERE ename = &#x27;å­™æ´ªäº®&#x27;;<br>+---------+-------------+<br>| ename  | tel         |<br>+---------+-------------+<br>| å­™æ´ªäº® | 13789091234 |<br>+---------+-------------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; SELECT ename,tel FROM t_employee WHERE ename = &#x27;å­™æ´ªäº®&#x27;;<br>+---------+-------------+<br>| ename   | tel         |<br>+---------+-------------+<br>| å­™æ´ªäº® | 13789091234 |<br>+---------+-------------+<br>1 row in set (0.00 sec)<br><br></code></pre></td></tr></table></figure><p>ä¸¾ä¾‹ï¼šDELETEæ“ä½œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT ename,tel FROM emp_tel WHERE ename = &#x27;å­™æ´ªäº®&#x27;;<br>+---------+-------------+<br>| ename  | tel           |<br>+---------+-------------+<br>| å­™æ´ªäº® | 13789091234 |<br>+---------+-------------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; DELETE FROM emp_tel  WHERE ename = &#x27;å­™æ´ªäº®&#x27;;<br>Query OK, 1 row affected (0.01 sec)<br><br>mysql&gt; SELECT ename,tel FROM emp_tel WHERE ename = &#x27;å­™æ´ªäº®&#x27;;<br>Empty set (0.00 sec)<br><br>mysql&gt; SELECT ename,tel FROM t_employee WHERE ename = &#x27;å­™æ´ªäº®&#x27;;<br>Empty set (0.00 sec)<br><br></code></pre></td></tr></table></figure><h3 id="5-2-ä¸å¯æ›´æ–°çš„è§†å›¾"><a href="#5-2-ä¸å¯æ›´æ–°çš„è§†å›¾" class="headerlink" title="5.2 ä¸å¯æ›´æ–°çš„è§†å›¾"></a>5.2 ä¸å¯æ›´æ–°çš„è§†å›¾</h3><p>è¦ä½¿è§†å›¾å¯æ›´æ–°ï¼Œè§†å›¾ä¸­çš„è¡Œå’Œåº•å±‚åŸºæœ¬è¡¨ä¸­çš„è¡Œä¹‹é—´å¿…é¡»å­˜åœ¨<code>ä¸€å¯¹ä¸€</code>çš„å…³ç³»ã€‚å¦å¤–å½“è§†å›¾å®šä¹‰å‡ºç°å¦‚ä¸‹æƒ…å†µæ—¶ï¼Œè§†å›¾ä¸æ”¯æŒæ›´æ–°æ“ä½œï¼š</p><ul><li>åœ¨å®šä¹‰è§†å›¾çš„æ—¶å€™æŒ‡å®šäº†â€œALGORITHM = TEMPTABLEâ€ï¼Œè§†å›¾å°†ä¸æ”¯æŒINSERTå’ŒDELETEæ“ä½œï¼›</li><li>è§†å›¾ä¸­ä¸åŒ…å«åŸºè¡¨ä¸­æ‰€æœ‰è¢«å®šä¹‰ä¸ºéç©ºåˆæœªæŒ‡å®šé»˜è®¤å€¼çš„åˆ—ï¼Œè§†å›¾å°†ä¸æ”¯æŒINSERTæ“ä½œï¼›</li><li>åœ¨å®šä¹‰è§†å›¾çš„SELECTè¯­å¥ä¸­ä½¿ç”¨äº†<code>JOINè”åˆæŸ¥è¯¢</code>ï¼Œè§†å›¾å°†ä¸æ”¯æŒINSERTå’ŒDELETEæ“ä½œï¼›</li><li>åœ¨å®šä¹‰è§†å›¾çš„SELECTè¯­å¥åçš„å­—æ®µåˆ—è¡¨ä¸­ä½¿ç”¨äº†<code>æ•°å­¦è¡¨è¾¾å¼</code>æˆ–<code>å­æŸ¥è¯¢</code>ï¼Œè§†å›¾å°†ä¸æ”¯æŒINSERTï¼Œä¹Ÿä¸æ”¯æŒUPDATEä½¿ç”¨äº†æ•°å­¦è¡¨è¾¾å¼ã€å­æŸ¥è¯¢çš„å­—æ®µå€¼ï¼›</li><li>åœ¨å®šä¹‰è§†å›¾çš„SELECTè¯­å¥åçš„å­—æ®µåˆ—è¡¨ä¸­ä½¿ç”¨<code>DISTINCT</code>ã€<code>èšåˆå‡½æ•°</code>ã€<code>GROUP BY</code>ã€<code>HAVING</code>ã€<code>UNION</code>ç­‰ï¼Œè§†å›¾å°†ä¸æ”¯æŒINSERTã€UPDATEã€DELETEï¼›</li><li>åœ¨å®šä¹‰è§†å›¾çš„SELECTè¯­å¥ä¸­åŒ…å«äº†å­æŸ¥è¯¢ï¼Œè€Œå­æŸ¥è¯¢ä¸­å¼•ç”¨äº†FROMåé¢çš„è¡¨ï¼Œè§†å›¾å°†ä¸æ”¯æŒINSERTã€UPDATEã€DELETEï¼›</li><li>è§†å›¾å®šä¹‰åŸºäºä¸€ä¸ª<code>ä¸å¯æ›´æ–°è§†å›¾</code>ï¼›</li><li>å¸¸é‡è§†å›¾ã€‚</li></ul><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; CREATE OR REPLACE VIEW emp_dept<br>    -&gt; (ename,salary,birthday,tel,email,hiredate,dname)<br>    -&gt; AS SELECT ename,salary,birthday,tel,email,hiredate,dname<br>    -&gt; FROM t_employee INNER JOIN t_department<br>    -&gt; ON t_employee.did = t_department.did ;<br>Query OK, 0 rows affected (0.01 sec)<br><br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; INSERT INTO emp_dept(ename,salary,birthday,tel,email,hiredate,dname)<br>    -&gt; VALUES(&#x27;å¼ ä¸‰&#x27;,15000,&#x27;1995-01-08&#x27;,&#x27;18201587896&#x27;,<br>    -&gt; &#x27;zs@atguigu.com&#x27;,&#x27;2022-02-14&#x27;,&#x27;æ–°éƒ¨é—¨&#x27;);<br>    <br>#ERROR 1393 (HY000): Can not modify more than one base table through a join view &#x27;atguigu_chapter9.emp_dept&#x27;<br><br></code></pre></td></tr></table></figure><p>ä»ä¸Šé¢çš„SQLæ‰§è¡Œç»“æœå¯ä»¥çœ‹å‡ºï¼Œåœ¨å®šä¹‰è§†å›¾çš„SELECTè¯­å¥ä¸­ä½¿ç”¨äº†JOINè”åˆæŸ¥è¯¢ï¼Œè§†å›¾å°†ä¸æ”¯æŒæ›´æ–°æ“ä½œã€‚</p><blockquote><p>è™½ç„¶å¯ä»¥æ›´æ–°è§†å›¾æ•°æ®ï¼Œä½†æ€»çš„æ¥è¯´ï¼Œè§†å›¾ä½œä¸º<code>è™šæ‹Ÿè¡¨</code>ï¼Œä¸»è¦ç”¨äº<code>æ–¹ä¾¿æŸ¥è¯¢</code>ï¼Œä¸å»ºè®®æ›´æ–°è§†å›¾çš„æ•°æ®ã€‚<strong>å¯¹è§†å›¾æ•°æ®çš„æ›´æ”¹ï¼Œéƒ½æ˜¯é€šè¿‡å¯¹å®é™…æ•°æ®è¡¨é‡Œæ•°æ®çš„æ“ä½œæ¥å®Œæˆçš„ã€‚</strong></p></blockquote><h2 id="6-ä¿®æ”¹ã€åˆ é™¤è§†å›¾"><a href="#6-ä¿®æ”¹ã€åˆ é™¤è§†å›¾" class="headerlink" title="6. ä¿®æ”¹ã€åˆ é™¤è§†å›¾"></a>6. ä¿®æ”¹ã€åˆ é™¤è§†å›¾</h2><h3 id="6-1-ä¿®æ”¹è§†å›¾"><a href="#6-1-ä¿®æ”¹è§†å›¾" class="headerlink" title="6.1 ä¿®æ”¹è§†å›¾"></a>6.1 ä¿®æ”¹è§†å›¾</h3><p>æ–¹å¼1ï¼šä½¿ç”¨CREATE <strong>OR REPLACE</strong> VIEW å­å¥<strong>ä¿®æ”¹è§†å›¾</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE OR REPLACE VIEW empvu80 #åˆ›å»ºè§†å›¾ï¼Œå¦‚æœå·²ç»å­˜åœ¨åˆ™æ›¿æ¢ï¼ˆç›¸å½“äºä¿®æ”¹è§†å›¾ï¼‰<br>(id_number, name, sal, department_id)<br>AS <br>SELECT  employee_id, first_name || &#x27; &#x27; || last_name, salary, department_id # || åœ¨ORACLEä¸­æ˜¯å­—ç¬¦ä¸²çš„è¿æ¥ï¼ŒMySQLä¸­æ˜¯or<br>FROM employees<br>WHERE department_id = 80;<br></code></pre></td></tr></table></figure><blockquote><p>è¯´æ˜ï¼šCREATE VIEW å­å¥ä¸­å„åˆ—çš„åˆ«ååº”å’Œå­æŸ¥è¯¢ä¸­å„åˆ—ç›¸å¯¹åº”ã€‚</p></blockquote><p>æ–¹å¼2ï¼šALTER VIEW</p><p>ä¿®æ”¹è§†å›¾çš„è¯­æ³•æ˜¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">ALTER VIEW è§†å›¾åç§° <br>AS<br>æŸ¥è¯¢è¯­å¥<br></code></pre></td></tr></table></figure><h3 id="6-2-åˆ é™¤è§†å›¾"><a href="#6-2-åˆ é™¤è§†å›¾" class="headerlink" title="6.2 åˆ é™¤è§†å›¾"></a>6.2 åˆ é™¤è§†å›¾</h3><ul><li><p>åˆ é™¤è§†å›¾åªæ˜¯åˆ é™¤è§†å›¾çš„å®šä¹‰ï¼Œå¹¶ä¸ä¼šåˆ é™¤åŸºè¡¨çš„æ•°æ®ã€‚</p></li><li><p>åˆ é™¤è§†å›¾çš„è¯­æ³•æ˜¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DROP VIEW IF EXISTS è§†å›¾åç§°;<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DROP VIEW IF EXISTS è§†å›¾åç§°1,è§†å›¾åç§°2,è§†å›¾åç§°3,...;<br></code></pre></td></tr></table></figure></li><li><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DROP VIEW empvu80;<br></code></pre></td></tr></table></figure></li><li><p>è¯´æ˜ï¼šåŸºäºè§†å›¾aã€båˆ›å»ºäº†æ–°çš„è§†å›¾cï¼Œå¦‚æœå°†è§†å›¾aæˆ–è€…è§†å›¾båˆ é™¤ï¼Œä¼šå¯¼è‡´è§†å›¾cçš„æŸ¥è¯¢å¤±è´¥ã€‚è¿™æ ·çš„è§†å›¾céœ€è¦æ‰‹åŠ¨åˆ é™¤æˆ–ä¿®æ”¹ï¼Œå¦åˆ™å½±å“ä½¿ç”¨ã€‚</p></li></ul><h2 id="7-æ€»ç»“"><a href="#7-æ€»ç»“" class="headerlink" title="7. æ€»ç»“"></a>7. æ€»ç»“</h2><h3 id="7-1-è§†å›¾ä¼˜ç‚¹"><a href="#7-1-è§†å›¾ä¼˜ç‚¹" class="headerlink" title="7.1 è§†å›¾ä¼˜ç‚¹"></a>7.1 è§†å›¾ä¼˜ç‚¹</h3><p><strong>1. æ“ä½œç®€å•</strong></p><p>å°†ç»å¸¸ä½¿ç”¨çš„æŸ¥è¯¢æ“ä½œå®šä¹‰ä¸ºè§†å›¾ï¼Œå¯ä»¥ä½¿å¼€å‘äººå‘˜ä¸éœ€è¦å…³å¿ƒè§†å›¾å¯¹åº”çš„æ•°æ®è¡¨çš„ç»“æ„ã€è¡¨ä¸è¡¨ä¹‹é—´çš„å…³è”å…³ç³»ï¼Œä¹Ÿä¸éœ€è¦å…³å¿ƒæ•°æ®è¡¨ä¹‹é—´çš„ä¸šåŠ¡é€»è¾‘å’ŒæŸ¥è¯¢æ¡ä»¶ï¼Œè€Œåªéœ€è¦ç®€å•åœ°æ“ä½œè§†å›¾å³å¯ï¼Œæå¤§ç®€åŒ–äº†å¼€å‘äººå‘˜å¯¹æ•°æ®åº“çš„æ“ä½œã€‚</p><p><strong>2. å‡å°‘æ•°æ®å†—ä½™</strong></p><p>è§†å›¾è·Ÿå®é™…æ•°æ®è¡¨ä¸ä¸€æ ·ï¼Œå®ƒå­˜å‚¨çš„æ˜¯æŸ¥è¯¢è¯­å¥ã€‚æ‰€ä»¥ï¼Œåœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¦é€šè¿‡å®šä¹‰è§†å›¾çš„æŸ¥è¯¢è¯­å¥æ¥è·å–ç»“æœé›†ã€‚è€Œè§†å›¾æœ¬èº«ä¸å­˜å‚¨æ•°æ®ï¼Œä¸å ç”¨æ•°æ®å­˜å‚¨çš„èµ„æºï¼Œå‡å°‘äº†æ•°æ®å†—ä½™ã€‚</p><p><strong>3. æ•°æ®å®‰å…¨</strong></p><p>MySQLå°†ç”¨æˆ·å¯¹æ•°æ®çš„<code>è®¿é—®é™åˆ¶</code>åœ¨æŸäº›æ•°æ®çš„ç»“æœé›†ä¸Šï¼Œè€Œè¿™äº›æ•°æ®çš„ç»“æœé›†å¯ä»¥ä½¿ç”¨è§†å›¾æ¥å®ç°ã€‚ç”¨æˆ·ä¸å¿…ç›´æ¥æŸ¥è¯¢æˆ–æ“ä½œæ•°æ®è¡¨ã€‚è¿™ä¹Ÿå¯ä»¥ç†è§£ä¸ºè§†å›¾å…·æœ‰<code>éš”ç¦»æ€§</code>ã€‚è§†å›¾ç›¸å½“äºåœ¨ç”¨æˆ·å’Œå®é™…çš„æ•°æ®è¡¨ä¹‹é—´åŠ äº†ä¸€å±‚è™šæ‹Ÿè¡¨ã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211010211744459.png"></p><p>åŒæ—¶ï¼ŒMySQLå¯ä»¥æ ¹æ®æƒé™å°†ç”¨æˆ·å¯¹æ•°æ®çš„è®¿é—®é™åˆ¶åœ¨æŸäº›è§†å›¾ä¸Šï¼Œ<strong>ç”¨æˆ·ä¸éœ€è¦æŸ¥è¯¢æ•°æ®è¡¨ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡è§†å›¾è·å–æ•°æ®è¡¨ä¸­çš„ä¿¡æ¯</strong>ã€‚è¿™åœ¨ä¸€å®šç¨‹åº¦ä¸Šä¿éšœäº†æ•°æ®è¡¨ä¸­æ•°æ®çš„å®‰å…¨æ€§ã€‚</p><p><strong>4. é€‚åº”çµæ´»å¤šå˜çš„éœ€æ±‚</strong><br>å½“ä¸šåŠ¡ç³»ç»Ÿçš„éœ€æ±‚å‘ç”Ÿå˜åŒ–åï¼Œå¦‚æœéœ€è¦æ”¹åŠ¨æ•°æ®è¡¨çš„ç»“æ„ï¼Œåˆ™å·¥ä½œé‡ç›¸å¯¹è¾ƒå¤§ï¼Œå¯ä»¥ä½¿ç”¨è§†å›¾æ¥å‡å°‘æ”¹åŠ¨çš„å·¥ä½œé‡ã€‚è¿™ç§æ–¹å¼åœ¨å®é™…å·¥ä½œä¸­ä½¿ç”¨å¾—æ¯”è¾ƒå¤šã€‚</p><p><strong>5. èƒ½å¤Ÿåˆ†è§£å¤æ‚çš„æŸ¥è¯¢é€»è¾‘</strong><br>æ•°æ®åº“ä¸­å¦‚æœå­˜åœ¨å¤æ‚çš„æŸ¥è¯¢é€»è¾‘ï¼Œåˆ™å¯ä»¥å°†é—®é¢˜è¿›è¡Œåˆ†è§£ï¼Œåˆ›å»ºå¤šä¸ªè§†å›¾è·å–æ•°æ®ï¼Œå†å°†åˆ›å»ºçš„å¤šä¸ªè§†å›¾ç»“åˆèµ·æ¥ï¼Œå®Œæˆå¤æ‚çš„æŸ¥è¯¢é€»è¾‘ã€‚</p><h3 id="7-2-è§†å›¾ä¸è¶³"><a href="#7-2-è§†å›¾ä¸è¶³" class="headerlink" title="7.2 è§†å›¾ä¸è¶³"></a>7.2 è§†å›¾ä¸è¶³</h3><p>å¦‚æœæˆ‘ä»¬åœ¨å®é™…æ•°æ®è¡¨çš„åŸºç¡€ä¸Šåˆ›å»ºäº†è§†å›¾ï¼Œé‚£ä¹ˆï¼Œ<strong>å¦‚æœå®é™…æ•°æ®è¡¨çš„ç»“æ„å˜æ›´äº†ï¼Œæˆ‘ä»¬å°±éœ€è¦åŠæ—¶å¯¹ç›¸å…³çš„è§†å›¾è¿›è¡Œç›¸åº”çš„ç»´æŠ¤</strong>ã€‚ç‰¹åˆ«æ˜¯åµŒå¥—çš„è§†å›¾ï¼ˆå°±æ˜¯åœ¨è§†å›¾çš„åŸºç¡€ä¸Šåˆ›å»ºè§†å›¾ï¼‰ï¼Œç»´æŠ¤ä¼šå˜å¾—æ¯”è¾ƒå¤æ‚ï¼Œ<code>å¯è¯»æ€§ä¸å¥½</code>ï¼Œå®¹æ˜“å˜æˆç³»ç»Ÿçš„æ½œåœ¨éšæ‚£ã€‚å› ä¸ºåˆ›å»ºè§†å›¾çš„ SQL æŸ¥è¯¢å¯èƒ½ä¼šå¯¹å­—æ®µé‡å‘½åï¼Œä¹Ÿå¯èƒ½åŒ…å«å¤æ‚çš„é€»è¾‘ï¼Œè¿™äº›éƒ½ä¼šå¢åŠ ç»´æŠ¤çš„æˆæœ¬ã€‚</p><p>å®é™…é¡¹ç›®ä¸­ï¼Œå¦‚æœè§†å›¾è¿‡å¤šï¼Œä¼šå¯¼è‡´æ•°æ®åº“ç»´æŠ¤æˆæœ¬çš„é—®é¢˜ã€‚</p><p>æ‰€ä»¥ï¼Œåœ¨åˆ›å»ºè§†å›¾çš„æ—¶å€™ï¼Œä½ è¦ç»“åˆå®é™…é¡¹ç›®éœ€æ±‚ï¼Œç»¼åˆè€ƒè™‘è§†å›¾çš„ä¼˜ç‚¹å’Œä¸è¶³ï¼Œè¿™æ ·æ‰èƒ½æ­£ç¡®ä½¿ç”¨è§†å›¾ï¼Œä½¿ç³»ç»Ÿæ•´ä½“è¾¾åˆ°æœ€ä¼˜ã€‚</p><h1 id="ç¬¬15ç« -å­˜å‚¨è¿‡ç¨‹ä¸å‡½æ•°"><a href="#ç¬¬15ç« -å­˜å‚¨è¿‡ç¨‹ä¸å‡½æ•°" class="headerlink" title="ç¬¬15ç« _å­˜å‚¨è¿‡ç¨‹ä¸å‡½æ•°"></a>ç¬¬15ç« _å­˜å‚¨è¿‡ç¨‹ä¸å‡½æ•°</h1><p>MySQLä»5.0ç‰ˆæœ¬å¼€å§‹æ”¯æŒå­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°ã€‚å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°èƒ½å¤Ÿå°†å¤æ‚çš„SQLé€»è¾‘å°è£…åœ¨ä¸€èµ·ï¼Œåº”ç”¨ç¨‹åºæ— é¡»å…³æ³¨å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°å†…éƒ¨å¤æ‚çš„SQLé€»è¾‘ï¼Œè€Œåªéœ€è¦ç®€å•åœ°è°ƒç”¨å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°å³å¯ã€‚</p><h2 id="1-å­˜å‚¨è¿‡ç¨‹æ¦‚è¿°"><a href="#1-å­˜å‚¨è¿‡ç¨‹æ¦‚è¿°" class="headerlink" title="1. å­˜å‚¨è¿‡ç¨‹æ¦‚è¿°"></a>1. å­˜å‚¨è¿‡ç¨‹æ¦‚è¿°</h2><h3 id="1-1-ç†è§£"><a href="#1-1-ç†è§£" class="headerlink" title="1.1 ç†è§£"></a>1.1 ç†è§£</h3><p><strong>å«ä¹‰</strong>ï¼šå­˜å‚¨è¿‡ç¨‹çš„è‹±æ–‡æ˜¯ <code>Stored Procedure</code>ã€‚å®ƒçš„æ€æƒ³å¾ˆç®€å•ï¼Œå°±æ˜¯ä¸€ç»„ç»è¿‡<code>é¢„å…ˆç¼–è¯‘</code>çš„ SQL è¯­å¥çš„å°è£…ã€‚</p><p>æ‰§è¡Œè¿‡ç¨‹ï¼šå­˜å‚¨è¿‡ç¨‹é¢„å…ˆå­˜å‚¨åœ¨ MySQL æœåŠ¡å™¨ä¸Šï¼Œéœ€è¦æ‰§è¡Œçš„æ—¶å€™ï¼Œå®¢æˆ·ç«¯åªéœ€è¦å‘æœåŠ¡å™¨ç«¯å‘å‡ºè°ƒç”¨å­˜å‚¨è¿‡ç¨‹çš„å‘½ä»¤ï¼ŒæœåŠ¡å™¨ç«¯å°±å¯ä»¥æŠŠé¢„å…ˆå­˜å‚¨å¥½çš„è¿™ä¸€ç³»åˆ— SQL è¯­å¥å…¨éƒ¨æ‰§è¡Œã€‚</p><p><strong>å¥½å¤„</strong>ï¼š</p><p>1ã€ç®€åŒ–æ“ä½œï¼Œæé«˜äº†sqlè¯­å¥çš„é‡ç”¨æ€§ï¼Œå‡å°‘äº†å¼€å‘ç¨‹åºå‘˜çš„å‹åŠ›<br>2ã€å‡å°‘æ“ä½œè¿‡ç¨‹ä¸­çš„å¤±è¯¯ï¼Œæé«˜æ•ˆç‡<br>3ã€å‡å°‘ç½‘ç»œä¼ è¾“é‡ï¼ˆå®¢æˆ·ç«¯ä¸éœ€è¦æŠŠæ‰€æœ‰çš„ SQL è¯­å¥é€šè¿‡ç½‘ç»œå‘ç»™æœåŠ¡å™¨ï¼‰<br>4ã€å‡å°‘äº† SQL è¯­å¥æš´éœ²åœ¨ç½‘ä¸Šçš„é£é™©ï¼Œä¹Ÿæé«˜äº†æ•°æ®æŸ¥è¯¢çš„å®‰å…¨æ€§</p><p><strong>å’Œè§†å›¾ã€å‡½æ•°çš„å¯¹æ¯”</strong>ï¼š</p><p>å®ƒå’Œè§†å›¾æœ‰ç€åŒæ ·çš„ä¼˜ç‚¹ï¼Œæ¸…æ™°ã€å®‰å…¨ï¼Œè¿˜å¯ä»¥å‡å°‘ç½‘ç»œä¼ è¾“é‡ã€‚ä¸è¿‡å®ƒå’Œè§†å›¾ä¸åŒï¼Œè§†å›¾æ˜¯<code>è™šæ‹Ÿè¡¨</code>ï¼Œé€šå¸¸ä¸å¯¹åº•å±‚æ•°æ®è¡¨ç›´æ¥æ“ä½œï¼ˆé€šå¸¸å¯¹åŸºè¡¨ä¸åšä¿®æ”¹ï¼Œåªæ˜¯åšæŸ¥è¯¢ï¼‰ï¼Œè€Œå­˜å‚¨è¿‡ç¨‹æ˜¯ç¨‹åºåŒ–çš„ SQLï¼Œå¯ä»¥<code>ç›´æ¥æ“ä½œåº•å±‚æ•°æ®è¡¨</code>ï¼Œç›¸æ¯”äºé¢å‘é›†åˆçš„æ“ä½œæ–¹å¼ï¼Œèƒ½å¤Ÿå®ç°ä¸€äº›æ›´å¤æ‚çš„æ•°æ®å¤„ç†ã€‚</p><p>ä¸€æ—¦å­˜å‚¨è¿‡ç¨‹è¢«åˆ›å»ºå‡ºæ¥ï¼Œä½¿ç”¨å®ƒå°±åƒä½¿ç”¨å‡½æ•°ä¸€æ ·ç®€å•ï¼Œæˆ‘ä»¬ç›´æ¥é€šè¿‡è°ƒç”¨å­˜å‚¨è¿‡ç¨‹åå³å¯ã€‚ç›¸è¾ƒäºå‡½æ•°ï¼Œå­˜å‚¨è¿‡ç¨‹æ˜¯<code>æ²¡æœ‰è¿”å›å€¼</code>çš„ã€‚</p><h3 id="1-2-åˆ†ç±»"><a href="#1-2-åˆ†ç±»" class="headerlink" title="1.2 åˆ†ç±»"></a>1.2 åˆ†ç±»</h3><p>å­˜å‚¨è¿‡ç¨‹çš„å‚æ•°ç±»å‹å¯ä»¥æ˜¯INã€OUTå’ŒINOUTã€‚æ ¹æ®è¿™ç‚¹åˆ†ç±»å¦‚ä¸‹ï¼š</p><p>1ã€æ²¡æœ‰å‚æ•°ï¼ˆæ— å‚æ•°æ— è¿”å›ï¼‰<br>2ã€ä»…ä»…å¸¦ IN ç±»å‹ï¼ˆæœ‰å‚æ•°æ— è¿”å›ï¼‰<br>3ã€ä»…ä»…å¸¦ OUT ç±»å‹ï¼ˆæ— å‚æ•°æœ‰è¿”å›ï¼‰<br>4ã€æ—¢å¸¦ IN åˆå¸¦ OUTï¼ˆæœ‰å‚æ•°æœ‰è¿”å›ï¼‰<br>5ã€å¸¦ INOUTï¼ˆæœ‰å‚æ•°æœ‰è¿”å›ï¼‰</p><p>æ³¨æ„ï¼šINã€OUTã€INOUT éƒ½å¯ä»¥åœ¨ä¸€ä¸ªå­˜å‚¨è¿‡ç¨‹ä¸­å¸¦å¤šä¸ªã€‚</p><h2 id="2-åˆ›å»ºå­˜å‚¨è¿‡ç¨‹"><a href="#2-åˆ›å»ºå­˜å‚¨è¿‡ç¨‹" class="headerlink" title="2. åˆ›å»ºå­˜å‚¨è¿‡ç¨‹"></a>2. åˆ›å»ºå­˜å‚¨è¿‡ç¨‹</h2><h3 id="2-1-è¯­æ³•åˆ†æ"><a href="#2-1-è¯­æ³•åˆ†æ" class="headerlink" title="2.1 è¯­æ³•åˆ†æ"></a>2.1 è¯­æ³•åˆ†æ</h3><p>è¯­æ³•ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE PROCEDURE å­˜å‚¨è¿‡ç¨‹å(IN|OUT|INOUT å‚æ•°å å‚æ•°ç±»å‹,...)<br>[characteristics ...]<br>BEGIN<br>å­˜å‚¨è¿‡ç¨‹ä½“<br><br>END<br></code></pre></td></tr></table></figure><p>ç±»ä¼¼äºJavaä¸­çš„æ–¹æ³•ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">ä¿®é¥°ç¬¦ è¿”å›ç±»å‹ æ–¹æ³•å(å‚æ•°ç±»å‹ å‚æ•°å,...)&#123;<br><br>æ–¹æ³•ä½“;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¯´æ˜ï¼š</p><p>1ã€å‚æ•°å‰é¢çš„ç¬¦å·çš„æ„æ€</p><ul><li><p><code>IN</code>ï¼šå½“å‰å‚æ•°ä¸ºè¾“å…¥å‚æ•°ï¼Œä¹Ÿå°±æ˜¯è¡¨ç¤ºå…¥å‚ï¼›</p><p>å­˜å‚¨è¿‡ç¨‹åªæ˜¯è¯»å–è¿™ä¸ªå‚æ•°çš„å€¼ã€‚å¦‚æœæ²¡æœ‰å®šä¹‰å‚æ•°ç§ç±»ï¼Œ<code>é»˜è®¤å°±æ˜¯ IN</code>ï¼Œè¡¨ç¤ºè¾“å…¥å‚æ•°ã€‚</p></li><li><p><code>OUT</code>ï¼šå½“å‰å‚æ•°ä¸ºè¾“å‡ºå‚æ•°ï¼Œä¹Ÿå°±æ˜¯è¡¨ç¤ºå‡ºå‚ï¼›</p><p>æ‰§è¡Œå®Œæˆä¹‹åï¼Œè°ƒç”¨è¿™ä¸ªå­˜å‚¨è¿‡ç¨‹çš„å®¢æˆ·ç«¯æˆ–è€…åº”ç”¨ç¨‹åºå°±å¯ä»¥è¯»å–è¿™ä¸ªå‚æ•°è¿”å›çš„å€¼äº†ã€‚</p></li><li><p><code>INOUT</code>ï¼šå½“å‰å‚æ•°æ—¢å¯ä»¥ä¸ºè¾“å…¥å‚æ•°ï¼Œä¹Ÿå¯ä»¥ä¸ºè¾“å‡ºå‚æ•°ã€‚</p></li></ul><p>2ã€å½¢å‚ç±»å‹å¯ä»¥æ˜¯ MySQLæ•°æ®åº“ä¸­çš„ä»»æ„ç±»å‹ã€‚</p><p>3ã€<code>characteristics</code> è¡¨ç¤ºåˆ›å»ºå­˜å‚¨è¿‡ç¨‹æ—¶æŒ‡å®šçš„å¯¹å­˜å‚¨è¿‡ç¨‹çš„çº¦æŸæ¡ä»¶ï¼Œå…¶å–å€¼ä¿¡æ¯å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">LANGUAGE SQL<br>| [NOT] DETERMINISTIC<br>| &#123; CONTAINS SQL | NO SQL | READS SQL DATA | MODIFIES SQL DATA &#125;<br>| SQL SECURITY &#123; DEFINER | INVOKER &#125;<br>| COMMENT &#x27;string&#x27;<br></code></pre></td></tr></table></figure><ul><li><code>LANGUAGE SQL</code>ï¼šè¯´æ˜å­˜å‚¨è¿‡ç¨‹æ‰§è¡Œä½“æ˜¯ç”±SQLè¯­å¥ç»„æˆçš„ï¼Œå½“å‰ç³»ç»Ÿæ”¯æŒçš„è¯­è¨€ä¸ºSQLã€‚</li><li><code>[NOT] DETERMINISTIC</code>ï¼šæŒ‡æ˜å­˜å‚¨è¿‡ç¨‹æ‰§è¡Œçš„ç»“æœæ˜¯å¦ç¡®å®šã€‚DETERMINISTICè¡¨ç¤ºç»“æœæ˜¯ç¡®å®šçš„ã€‚æ¯æ¬¡æ‰§è¡Œå­˜å‚¨è¿‡ç¨‹æ—¶ï¼Œç›¸åŒçš„è¾“å…¥ä¼šå¾—åˆ°ç›¸åŒçš„è¾“å‡ºã€‚NOT DETERMINISTICè¡¨ç¤ºç»“æœæ˜¯ä¸ç¡®å®šçš„ï¼Œç›¸åŒçš„è¾“å…¥å¯èƒ½å¾—åˆ°ä¸åŒçš„è¾“å‡ºã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šä»»æ„ä¸€ä¸ªå€¼ï¼Œé»˜è®¤ä¸ºNOT DETERMINISTICã€‚</li><li><code>&#123; CONTAINS SQL | NO SQL | READS SQL DATA | MODIFIES SQL DATA &#125;</code>ï¼šæŒ‡æ˜å­ç¨‹åºä½¿ç”¨SQLè¯­å¥çš„é™åˆ¶ã€‚<ul><li>CONTAINS SQLè¡¨ç¤ºå½“å‰å­˜å‚¨è¿‡ç¨‹çš„å­ç¨‹åºåŒ…å«SQLè¯­å¥ï¼Œä½†æ˜¯å¹¶ä¸åŒ…å«è¯»å†™æ•°æ®çš„SQLè¯­å¥ï¼›</li><li>NO SQLè¡¨ç¤ºå½“å‰å­˜å‚¨è¿‡ç¨‹çš„å­ç¨‹åºä¸­ä¸åŒ…å«ä»»ä½•SQLè¯­å¥ï¼›</li><li>READS SQL DATAè¡¨ç¤ºå½“å‰å­˜å‚¨è¿‡ç¨‹çš„å­ç¨‹åºä¸­åŒ…å«è¯»æ•°æ®çš„SQLè¯­å¥ï¼›</li><li>MODIFIES SQL DATAè¡¨ç¤ºå½“å‰å­˜å‚¨è¿‡ç¨‹çš„å­ç¨‹åºä¸­åŒ…å«å†™æ•°æ®çš„SQLè¯­å¥ã€‚</li><li>é»˜è®¤æƒ…å†µä¸‹ï¼Œç³»ç»Ÿä¼šæŒ‡å®šä¸ºCONTAINS SQLã€‚</li></ul></li><li><code>SQL SECURITY &#123; DEFINER | INVOKER &#125;</code>ï¼šæ‰§è¡Œå½“å‰å­˜å‚¨è¿‡ç¨‹çš„æƒé™ï¼Œå³æŒ‡æ˜å“ªäº›ç”¨æˆ·èƒ½å¤Ÿæ‰§è¡Œå½“å‰å­˜å‚¨è¿‡ç¨‹ã€‚<ul><li><code>DEFINER</code>è¡¨ç¤ºåªæœ‰å½“å‰å­˜å‚¨è¿‡ç¨‹çš„åˆ›å»ºè€…æˆ–è€…å®šä¹‰è€…æ‰èƒ½æ‰§è¡Œå½“å‰å­˜å‚¨è¿‡ç¨‹ï¼›</li><li><code>INVOKER</code>è¡¨ç¤ºæ‹¥æœ‰å½“å‰å­˜å‚¨è¿‡ç¨‹çš„è®¿é—®æƒé™çš„ç”¨æˆ·èƒ½å¤Ÿæ‰§è¡Œå½“å‰å­˜å‚¨è¿‡ç¨‹ã€‚</li><li>å¦‚æœæ²¡æœ‰è®¾ç½®ç›¸å…³çš„å€¼ï¼Œåˆ™MySQLé»˜è®¤æŒ‡å®šå€¼ä¸ºDEFINERã€‚</li></ul></li><li><code>COMMENT &#39;string&#39;</code>ï¼šæ³¨é‡Šä¿¡æ¯ï¼Œå¯ä»¥ç”¨æ¥æè¿°å­˜å‚¨è¿‡ç¨‹ã€‚</li></ul><p>4ã€å­˜å‚¨è¿‡ç¨‹ä½“ä¸­å¯ä»¥æœ‰å¤šæ¡ SQL è¯­å¥ï¼Œå¦‚æœä»…ä»…ä¸€æ¡SQL è¯­å¥ï¼Œåˆ™å¯ä»¥çœç•¥ BEGIN å’Œ END</p><p>ç¼–å†™å­˜å‚¨è¿‡ç¨‹å¹¶ä¸æ˜¯ä¸€ä»¶ç®€å•çš„äº‹æƒ…ï¼Œå¯èƒ½å­˜å‚¨è¿‡ç¨‹ä¸­éœ€è¦å¤æ‚çš„ SQL è¯­å¥ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">1. BEGINâ€¦ENDï¼šBEGINâ€¦END ä¸­é—´åŒ…å«äº†å¤šä¸ªè¯­å¥ï¼Œæ¯ä¸ªè¯­å¥éƒ½ä»¥ï¼ˆ;ï¼‰å·ä¸ºç»“æŸç¬¦ã€‚<br>2. DECLAREï¼šDECLARE ç”¨æ¥å£°æ˜å˜é‡ï¼Œä½¿ç”¨çš„ä½ç½®åœ¨äº BEGINâ€¦END è¯­å¥ä¸­é—´ï¼Œè€Œä¸”éœ€è¦åœ¨å…¶ä»–è¯­å¥ä½¿ç”¨ä¹‹å‰è¿›è¡Œå˜é‡çš„å£°æ˜ã€‚<br>3. SETï¼šèµ‹å€¼è¯­å¥ï¼Œç”¨äºå¯¹å˜é‡è¿›è¡Œèµ‹å€¼ã€‚<br>4. SELECTâ€¦ INTOï¼šæŠŠä»æ•°æ®è¡¨ä¸­æŸ¥è¯¢çš„ç»“æœå­˜æ”¾åˆ°å˜é‡ä¸­ï¼Œä¹Ÿå°±æ˜¯ä¸ºå˜é‡èµ‹å€¼ã€‚<br></code></pre></td></tr></table></figure><p>5ã€éœ€è¦è®¾ç½®æ–°çš„ç»“æŸæ ‡è®°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DELIMITER æ–°çš„ç»“æŸæ ‡è®°<br></code></pre></td></tr></table></figure><p>å› ä¸ºMySQLé»˜è®¤çš„è¯­å¥ç»“æŸç¬¦å·ä¸ºåˆ†å·â€˜;â€™ã€‚ä¸ºäº†é¿å…ä¸å­˜å‚¨è¿‡ç¨‹ä¸­SQLè¯­å¥ç»“æŸç¬¦ç›¸å†²çªï¼ˆé˜²æ­¢å­˜å‚¨è¿‡ç¨‹è¿˜æ²¡æ‰§è¡Œå®Œï¼Œå°±è¢«;è¯†åˆ«ç»ˆæ­¢ï¼‰ï¼Œéœ€è¦ä½¿ç”¨DELIMITERæ”¹å˜å­˜å‚¨è¿‡ç¨‹çš„ç»“æŸç¬¦ã€‚<strong>å½“ç„¶åœ¨ç»“æŸåï¼Œä¹Ÿéœ€è¦å°†è¯­å¥ç»“æŸç¬¦å·æ”¹å›åˆ°;</strong></p><p>æ¯”å¦‚ï¼šâ€œDELIMITER //â€è¯­å¥çš„ä½œç”¨æ˜¯å°†MySQLçš„ç»“æŸç¬¦è®¾ç½®ä¸º//ï¼Œå¹¶ä»¥â€œEND //â€ç»“æŸå­˜å‚¨è¿‡ç¨‹ã€‚å­˜å‚¨è¿‡ç¨‹å®šä¹‰å®Œæ¯•ä¹‹åå†ä½¿ç”¨â€œDELIMITER ;â€æ¢å¤é»˜è®¤ç»“æŸç¬¦ã€‚DELIMITERä¹Ÿå¯ä»¥æŒ‡å®šå…¶ä»–ç¬¦å·ä½œä¸ºç»“æŸç¬¦ã€‚</p><p>å½“ä½¿ç”¨DELIMITERå‘½ä»¤æ—¶ï¼Œåº”è¯¥é¿å…ä½¿ç”¨åæ–œæ ï¼ˆâ€˜\â€™ï¼‰å­—ç¬¦ï¼Œå› ä¸ºåæ–œçº¿æ˜¯MySQLçš„è½¬ä¹‰å­—ç¬¦ã€‚</p><p>ç¤ºä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DELIMITER $<br><br>CREATE PROCEDURE å­˜å‚¨è¿‡ç¨‹å(IN|OUT|INOUT å‚æ•°å  å‚æ•°ç±»å‹,...)<br>[characteristics ...]<br>BEGIN<br>sqlè¯­å¥1;<br>sqlè¯­å¥2;<br><br>END $<br><br>DELIMITER ;<br></code></pre></td></tr></table></figure><h3 id="2-2-ä»£ç ä¸¾ä¾‹"><a href="#2-2-ä»£ç ä¸¾ä¾‹" class="headerlink" title="2.2 ä»£ç ä¸¾ä¾‹"></a>2.2 ä»£ç ä¸¾ä¾‹</h3><p>ä¸¾ä¾‹1ï¼šåˆ›å»ºå­˜å‚¨è¿‡ç¨‹select_all_data()ï¼ŒæŸ¥çœ‹ emps è¡¨çš„æ‰€æœ‰æ•°æ®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DELIMITER $<br><br>CREATE PROCEDURE select_all_data()<br>BEGIN<br>SELECT * FROM emps;<br><br>END $<br><br>DELIMITER ;<br></code></pre></td></tr></table></figure><p>ä¸¾ä¾‹2ï¼šåˆ›å»ºå­˜å‚¨è¿‡ç¨‹avg_employee_salary()ï¼Œè¿”å›æ‰€æœ‰å‘˜å·¥çš„å¹³å‡å·¥èµ„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DELIMITER //<br><br>CREATE PROCEDURE avg_employee_salary ()<br>BEGIN<br>SELECT AVG(salary) AS avg_salary FROM emps;<br>END //<br><br>DELIMITER ;<br></code></pre></td></tr></table></figure><p>ä¸¾ä¾‹3ï¼šåˆ›å»ºå­˜å‚¨è¿‡ç¨‹show_max_salary()ï¼Œç”¨æ¥æŸ¥çœ‹â€œempsâ€è¡¨çš„æœ€é«˜è–ªèµ„å€¼ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE PROCEDURE show_max_salary()<br>LANGUAGE SQL<br>NOT DETERMINISTIC<br>CONTAINS SQL<br>SQL SECURITY DEFINER<br>COMMENT &#x27;æŸ¥çœ‹æœ€é«˜è–ªèµ„&#x27;<br>BEGIN<br>SELECT MAX(salary) FROM emps;<br>END //<br><br>DELIMITER ;<br></code></pre></td></tr></table></figure><p>ä¸¾ä¾‹4ï¼šåˆ›å»ºå­˜å‚¨è¿‡ç¨‹show_min_salary()ï¼ŒæŸ¥çœ‹â€œempsâ€è¡¨çš„æœ€ä½è–ªèµ„å€¼ã€‚å¹¶å°†æœ€ä½è–ªèµ„é€šè¿‡OUTå‚æ•°â€œmsâ€è¾“å‡º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DELIMITER //<br><br>CREATE PROCEDURE show_min_salary(OUT ms DOUBLE)<br>BEGIN<br>SELECT MIN(salary) INTO ms FROM emps;<br>END //<br><br>DELIMITER ;<br><br>#è°ƒç”¨<br>CALL show_min_salary(@ms); #@ä»£è¡¨ç”¨æˆ·å®šä¹‰çš„å˜é‡<br><br>SELECT @ms; #æŸ¥çœ‹å˜é‡å€¼<br></code></pre></td></tr></table></figure><p>ä¸¾ä¾‹5ï¼šåˆ›å»ºå­˜å‚¨è¿‡ç¨‹show_someone_salary()ï¼ŒæŸ¥çœ‹â€œempsâ€è¡¨çš„æŸä¸ªå‘˜å·¥çš„è–ªèµ„ï¼Œå¹¶ç”¨INå‚æ•°empnameè¾“å…¥å‘˜å·¥å§“åã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DELIMITER //<br><br>CREATE PROCEDURE show_someone_salary(IN empname VARCHAR(20))<br>BEGIN<br>SELECT salary FROM emps WHERE ename = empname;<br>END //<br><br>DELIMITER ;<br><br>#è°ƒç”¨æ–¹å¼1<br>CALL show_someone_salary(&#x27;Abel&#x27;);<br>#è°ƒç”¨æ–¹å¼2<br>SET @empname := &#x27;Able&#x27;; #æˆ–è€… SET @empname = &#x27;Able&#x27;;<br>CALL show_someone_salary(@empname);<br></code></pre></td></tr></table></figure><p>ä¸¾ä¾‹6ï¼šåˆ›å»ºå­˜å‚¨è¿‡ç¨‹show_someone_salary2()ï¼ŒæŸ¥çœ‹â€œempsâ€è¡¨çš„æŸä¸ªå‘˜å·¥çš„è–ªèµ„ï¼Œå¹¶ç”¨INå‚æ•°empnameè¾“å…¥å‘˜å·¥å§“åï¼Œç”¨OUTå‚æ•°empsalaryè¾“å‡ºå‘˜å·¥è–ªèµ„ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DELIMITER //<br><br>CREATE PROCEDURE show_someone_salary2(IN empname VARCHAR(20),OUT empsalary DOUBLE)<br>BEGIN<br>SELECT salary INTO empsalary FROM emps WHERE ename = empname;<br>END //<br><br>DELIMITER ;<br><br>#è°ƒç”¨<br>SET @empname = &#x27;Abel&#x27;;<br>CALL show_someone_salary2(@empname, @empsalary);<br>SELECT @empsalary;<br></code></pre></td></tr></table></figure><p>ä¸¾ä¾‹7ï¼šåˆ›å»ºå­˜å‚¨è¿‡ç¨‹show_mgr_name()ï¼ŒæŸ¥è¯¢æŸä¸ªå‘˜å·¥é¢†å¯¼çš„å§“åï¼Œå¹¶ç”¨INOUTå‚æ•°â€œempnameâ€è¾“å…¥å‘˜å·¥å§“åï¼Œè¾“å‡ºé¢†å¯¼çš„å§“åã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DELIMITER //<br><br>CREATE PROCEDURE show_mgr_name(INOUT empname VARCHAR(20))<br>BEGIN<br>SELECT ename INTO empname FROM emps<br>WHERE eid = (SELECT MID FROM emps WHERE ename=empname);<br>END //<br><br>DELIMITER ;<br><br>#è°ƒç”¨<br>SET @empname = &#x27;Abel&#x27;;<br>CALL show_mgr_name(@empname);<br>SELECT @empname;<br></code></pre></td></tr></table></figure><h2 id="3-è°ƒç”¨å­˜å‚¨è¿‡ç¨‹"><a href="#3-è°ƒç”¨å­˜å‚¨è¿‡ç¨‹" class="headerlink" title="3. è°ƒç”¨å­˜å‚¨è¿‡ç¨‹"></a>3. è°ƒç”¨å­˜å‚¨è¿‡ç¨‹</h2><h3 id="3-1-è°ƒç”¨æ ¼å¼"><a href="#3-1-è°ƒç”¨æ ¼å¼" class="headerlink" title="3.1 è°ƒç”¨æ ¼å¼"></a>3.1 è°ƒç”¨æ ¼å¼</h3><p>å­˜å‚¨è¿‡ç¨‹æœ‰å¤šç§è°ƒç”¨æ–¹æ³•ã€‚å­˜å‚¨è¿‡ç¨‹å¿…é¡»ä½¿ç”¨CALLè¯­å¥è°ƒç”¨ï¼Œå¹¶ä¸”å­˜å‚¨è¿‡ç¨‹å’Œæ•°æ®åº“ç›¸å…³ï¼Œå¦‚æœè¦æ‰§è¡Œå…¶ä»–æ•°æ®åº“ä¸­çš„å­˜å‚¨è¿‡ç¨‹ï¼Œéœ€è¦æŒ‡å®šæ•°æ®åº“åç§°ï¼Œä¾‹å¦‚CALL dbname.procnameã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CALL å­˜å‚¨è¿‡ç¨‹å(å®å‚åˆ—è¡¨)<br></code></pre></td></tr></table></figure><p><strong>æ ¼å¼ï¼š</strong></p><p>1ã€è°ƒç”¨inæ¨¡å¼çš„å‚æ•°ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CALL sp1(&#x27;å€¼&#x27;);<br></code></pre></td></tr></table></figure><p>2ã€è°ƒç”¨outæ¨¡å¼çš„å‚æ•°ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SET @name;<br>CALL sp1(@name);<br>SELECT @name;<br></code></pre></td></tr></table></figure><p>3ã€è°ƒç”¨inoutæ¨¡å¼çš„å‚æ•°ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SET @name=å€¼;<br>CALL sp1(@name);<br>SELECT @name;<br></code></pre></td></tr></table></figure><h3 id="3-2-ä»£ç ä¸¾ä¾‹"><a href="#3-2-ä»£ç ä¸¾ä¾‹" class="headerlink" title="3.2 ä»£ç ä¸¾ä¾‹"></a>3.2 ä»£ç ä¸¾ä¾‹</h3><p><strong>ä¸¾ä¾‹1ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DELIMITER //<br><br>CREATE PROCEDURE CountProc(IN sid INT,OUT num INT)<br>BEGIN<br>SELECT COUNT(*) INTO num FROM fruits <br>WHERE s_id = sid;<br>END //<br><br>DELIMITER ;<br></code></pre></td></tr></table></figure><p>è°ƒç”¨å­˜å‚¨è¿‡ç¨‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; CALL CountProc (101, @num);<br>Query OK, 1 row affected (0.00 sec)<br></code></pre></td></tr></table></figure><p>æŸ¥çœ‹è¿”å›ç»“æœï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT @num;<br></code></pre></td></tr></table></figure><p>è¯¥å­˜å‚¨è¿‡ç¨‹è¿”å›äº†æŒ‡å®š s_id=101 çš„æ°´æœå•†æä¾›çš„æ°´æœç§ç±»ï¼Œè¿”å›å€¼å­˜å‚¨åœ¨numå˜é‡ä¸­ï¼Œä½¿ç”¨SELECTæŸ¥çœ‹ï¼Œè¿”å›ç»“æœä¸º3ã€‚</p><p><strong>ä¸¾ä¾‹2ï¼š</strong>åˆ›å»ºå­˜å‚¨è¿‡ç¨‹ï¼Œå®ç°ç´¯åŠ è¿ç®—ï¼Œè®¡ç®— 1+2+â€¦+n ç­‰äºå¤šå°‘ã€‚å…·ä½“çš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DELIMITER //<br>CREATE PROCEDURE `add_num`(IN n INT)<br>BEGIN<br>       DECLARE i INT;<br>       DECLARE sum INT;<br>       <br>       SET i = 1;<br>       SET sum = 0;<br>       WHILE i &lt;= n DO<br>              SET sum = sum + i;<br>              SET i = i +1;<br>       END WHILE;<br>       SELECT sum;<br>END //<br>DELIMITER ;<br></code></pre></td></tr></table></figure><p>å¦‚æœä½ ç”¨çš„æ˜¯ Navicat å·¥å…·ï¼Œé‚£ä¹ˆåœ¨ç¼–å†™å­˜å‚¨è¿‡ç¨‹çš„æ—¶å€™ï¼ŒNavicat ä¼šè‡ªåŠ¨è®¾ç½® DELIMITER ä¸ºå…¶ä»–ç¬¦å·ï¼Œæˆ‘ä»¬ä¸éœ€è¦å†è¿›è¡Œ DELIMITER çš„æ“ä½œã€‚</p><p>ç›´æ¥ä½¿ç”¨ <code>CALL add_num(50);</code>å³å¯ã€‚è¿™é‡Œæˆ‘ä¼ å…¥çš„å‚æ•°ä¸º 50ï¼Œä¹Ÿå°±æ˜¯ç»Ÿè®¡ 1+2+â€¦+50 çš„ç§¯ç´¯ä¹‹å’Œã€‚</p><h3 id="3-3-å¦‚ä½•è°ƒè¯•"><a href="#3-3-å¦‚ä½•è°ƒè¯•" class="headerlink" title="3.3 å¦‚ä½•è°ƒè¯•"></a>3.3 å¦‚ä½•è°ƒè¯•</h3><p>åœ¨ MySQL ä¸­ï¼Œå­˜å‚¨è¿‡ç¨‹ä¸åƒæ™®é€šçš„ç¼–ç¨‹è¯­è¨€ï¼ˆæ¯”å¦‚ VC++ã€Java ç­‰ï¼‰é‚£æ ·æœ‰ä¸“é—¨çš„é›†æˆå¼€å‘ç¯å¢ƒï¼Œéš¾ä»¥Debugã€‚å› æ­¤ï¼Œä½ å¯ä»¥é€šè¿‡ SELECT è¯­å¥ï¼ŒæŠŠç¨‹åºæ‰§è¡Œçš„ä¸­é—´ç»“æœæŸ¥è¯¢å‡ºæ¥ï¼Œæ¥è°ƒè¯•ä¸€ä¸ª SQL è¯­å¥çš„æ­£ç¡®æ€§ã€‚è°ƒè¯•æˆåŠŸä¹‹åï¼ŒæŠŠ SELECT è¯­å¥åç§»åˆ°ä¸‹ä¸€ä¸ª SQL è¯­å¥ä¹‹åï¼Œå†è°ƒè¯•ä¸‹ä¸€ä¸ª SQL è¯­å¥ã€‚è¿™æ ·<code>é€æ­¥æ¨è¿›</code>ï¼Œå°±å¯ä»¥å®Œæˆå¯¹å­˜å‚¨è¿‡ç¨‹ä¸­æ‰€æœ‰æ“ä½œçš„è°ƒè¯•äº†ã€‚å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥æŠŠå­˜å‚¨è¿‡ç¨‹ä¸­çš„ SQL è¯­å¥å¤åˆ¶å‡ºæ¥ï¼Œé€æ®µå•ç‹¬è°ƒè¯•ã€‚</p><h2 id="4-å­˜å‚¨å‡½æ•°çš„ä½¿ç”¨"><a href="#4-å­˜å‚¨å‡½æ•°çš„ä½¿ç”¨" class="headerlink" title="4. å­˜å‚¨å‡½æ•°çš„ä½¿ç”¨"></a>4. å­˜å‚¨å‡½æ•°çš„ä½¿ç”¨</h2><p>å‰é¢å­¦ä¹ äº†å¾ˆå¤šå‡½æ•°ï¼Œä½¿ç”¨è¿™äº›å‡½æ•°å¯ä»¥å¯¹æ•°æ®è¿›è¡Œçš„å„ç§å¤„ç†æ“ä½œï¼Œæå¤§åœ°æé«˜ç”¨æˆ·å¯¹æ•°æ®åº“çš„ç®¡ç†æ•ˆç‡ã€‚MySQLæ”¯æŒè‡ªå®šä¹‰å‡½æ•°ï¼Œå®šä¹‰å¥½ä¹‹åï¼Œè°ƒç”¨æ–¹å¼ä¸è°ƒç”¨MySQLé¢„å®šä¹‰çš„ç³»ç»Ÿå‡½æ•°ä¸€æ ·ã€‚</p><h3 id="4-1-è¯­æ³•åˆ†æ"><a href="#4-1-è¯­æ³•åˆ†æ" class="headerlink" title="4.1 è¯­æ³•åˆ†æ"></a>4.1 è¯­æ³•åˆ†æ</h3><p>å­¦è¿‡çš„å‡½æ•°ï¼šLENGTHã€SUBSTRã€CONCATç­‰</p><p>è¯­æ³•æ ¼å¼ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE FUNCTION å‡½æ•°å(å‚æ•°å å‚æ•°ç±»å‹,...) <br>RETURNS è¿”å›å€¼ç±»å‹<br>[characteristics ...]<br>BEGIN<br>å‡½æ•°ä½“   #å‡½æ•°ä½“ä¸­è‚¯å®šæœ‰ RETURN è¯­å¥<br><br>END<br></code></pre></td></tr></table></figure><p>è¯´æ˜ï¼š</p><p>1ã€å‚æ•°åˆ—è¡¨ï¼šæŒ‡å®šå‚æ•°ä¸ºINã€OUTæˆ–INOUTåªå¯¹PROCEDUREæ˜¯åˆæ³•çš„ï¼ŒFUNCTIONä¸­æ€»æ˜¯é»˜è®¤ä¸ºINå‚æ•°ã€‚</p><p>2ã€RETURNS type è¯­å¥è¡¨ç¤ºå‡½æ•°è¿”å›æ•°æ®çš„ç±»å‹ï¼›</p><p>RETURNSå­å¥åªèƒ½å¯¹FUNCTIONåšæŒ‡å®šï¼Œå¯¹å‡½æ•°è€Œè¨€è¿™æ˜¯<code>å¼ºåˆ¶</code>çš„ã€‚å®ƒç”¨æ¥æŒ‡å®šå‡½æ•°çš„è¿”å›ç±»å‹ï¼Œè€Œä¸”å‡½æ•°ä½“å¿…é¡»åŒ…å«ä¸€ä¸ª<code>RETURN value</code>è¯­å¥ã€‚</p><p>3ã€characteristic åˆ›å»ºå‡½æ•°æ—¶æŒ‡å®šçš„å¯¹å‡½æ•°çš„çº¦æŸã€‚å–å€¼ä¸åˆ›å»ºå­˜å‚¨è¿‡ç¨‹æ—¶ç›¸åŒï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚</p><p>4ã€å‡½æ•°ä½“ä¹Ÿå¯ä»¥ç”¨BEGINâ€¦ENDæ¥è¡¨ç¤ºSQLä»£ç çš„å¼€å§‹å’Œç»“æŸã€‚å¦‚æœå‡½æ•°ä½“åªæœ‰ä¸€æ¡è¯­å¥ï¼Œä¹Ÿå¯ä»¥çœç•¥BEGINâ€¦ENDã€‚</p><h3 id="4-2-è°ƒç”¨å­˜å‚¨å‡½æ•°"><a href="#4-2-è°ƒç”¨å­˜å‚¨å‡½æ•°" class="headerlink" title="4.2 è°ƒç”¨å­˜å‚¨å‡½æ•°"></a>4.2 è°ƒç”¨å­˜å‚¨å‡½æ•°</h3><p>åœ¨MySQLä¸­ï¼Œå­˜å‚¨å‡½æ•°çš„ä½¿ç”¨æ–¹æ³•ä¸MySQLå†…éƒ¨å‡½æ•°çš„ä½¿ç”¨æ–¹æ³•æ˜¯ä¸€æ ·çš„ã€‚æ¢è¨€ä¹‹ï¼Œç”¨æˆ·è‡ªå·±å®šä¹‰çš„å­˜å‚¨å‡½æ•°ä¸MySQLå†…éƒ¨å‡½æ•°æ˜¯ä¸€ä¸ªæ€§è´¨çš„ã€‚åŒºåˆ«åœ¨äºï¼Œå­˜å‚¨å‡½æ•°æ˜¯<code>ç”¨æˆ·è‡ªå·±å®šä¹‰</code>çš„ï¼Œè€Œå†…éƒ¨å‡½æ•°æ˜¯MySQLçš„<code>å¼€å‘è€…å®šä¹‰</code>çš„ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT å‡½æ•°å(å®å‚åˆ—è¡¨)<br></code></pre></td></tr></table></figure><h3 id="4-3-ä»£ç ä¸¾ä¾‹"><a href="#4-3-ä»£ç ä¸¾ä¾‹" class="headerlink" title="4.3 ä»£ç ä¸¾ä¾‹"></a>4.3 ä»£ç ä¸¾ä¾‹</h3><p><strong>ä¸¾ä¾‹1ï¼š</strong></p><p>åˆ›å»ºå­˜å‚¨å‡½æ•°ï¼Œåç§°ä¸ºemail_by_name()ï¼Œå‚æ•°å®šä¹‰ä¸ºç©ºï¼Œè¯¥å‡½æ•°æŸ¥è¯¢Abelçš„emailï¼Œå¹¶è¿”å›ï¼Œæ•°æ®ç±»å‹ä¸ºå­—ç¬¦ä¸²å‹ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DELIMITER //<br><br>CREATE FUNCTION email_by_name()<br>RETURNS VARCHAR(25)<br>DETERMINISTIC<br>CONTAINS SQL<br>BEGIN<br>RETURN (SELECT email FROM employees WHERE last_name = &#x27;Abel&#x27;);<br>END //<br><br>DELIMITER ;<br></code></pre></td></tr></table></figure><p>è°ƒç”¨ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT email_by_name();<br></code></pre></td></tr></table></figure><p><strong>ä¸¾ä¾‹2ï¼š</strong></p><p>åˆ›å»ºå­˜å‚¨å‡½æ•°ï¼Œåç§°ä¸ºemail_by_id()ï¼Œå‚æ•°ä¼ å…¥emp_idï¼Œè¯¥å‡½æ•°æŸ¥è¯¢emp_idçš„emailï¼Œå¹¶è¿”å›ï¼Œæ•°æ®ç±»å‹ä¸ºå­—ç¬¦ä¸²å‹ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DELIMITER //<br><br>CREATE FUNCTION email_by_id(emp_id INT)<br>RETURNS VARCHAR(25)<br>DETERMINISTIC<br>CONTAINS SQL<br>BEGIN<br>RETURN (SELECT email FROM employees WHERE employee_id = emp_id);<br>END //<br><br>DELIMITER ;<br></code></pre></td></tr></table></figure><p>è°ƒç”¨ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SET @emp_id = 102;<br>SELECT email_by_id(@emp_id);<br>#or<br>SELECT email_by_id(102);<br></code></pre></td></tr></table></figure><p><strong>ä¸¾ä¾‹3ï¼š</strong></p><p>åˆ›å»ºå­˜å‚¨å‡½æ•°count_by_id()ï¼Œå‚æ•°ä¼ å…¥dept_idï¼Œè¯¥å‡½æ•°æŸ¥è¯¢dept_idéƒ¨é—¨çš„å‘˜å·¥äººæ•°ï¼Œå¹¶è¿”å›ï¼Œæ•°æ®ç±»å‹ä¸ºæ•´å‹ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DELIMITER //<br><br>CREATE FUNCTION count_by_id(dept_id INT)<br>RETURNS INT<br>LANGUAGE SQL<br>NOT DETERMINISTIC<br>READS SQL DATA<br>SQL SECURITY DEFINER<br>COMMENT &#x27;æŸ¥è¯¢éƒ¨é—¨å¹³å‡å·¥èµ„&#x27;<br>BEGIN<br>RETURN (SELECT COUNT(*) FROM employees WHERE department_id = dept_id);<br><br>END //<br><br>DELIMITER ;<br></code></pre></td></tr></table></figure><p>è°ƒç”¨ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SET @dept_id = 50;<br>SELECT count_by_id(@dept_id);<br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„ï¼š</strong></p><p>è‹¥åœ¨åˆ›å»ºå­˜å‚¨å‡½æ•°ä¸­æŠ¥é”™â€œ<code>you might want to use the less safe log_bin_trust_function_creators variable</code>â€ï¼Œæœ‰ä¸¤ç§å¤„ç†æ–¹æ³•ï¼š</p><ul><li>æ–¹å¼1ï¼šåŠ ä¸Šå¿…è¦çš„å‡½æ•°ç‰¹æ€§â€œ[NOT] DETERMINISTICâ€å’Œâ€œ{CONTAINS SQL | NO SQL | READS SQL DATA | MODIFIES SQL DATA}â€</li></ul><ul><li>æ–¹å¼2ï¼š</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SET GLOBAL log_bin_trust_function_creators = 1;<br></code></pre></td></tr></table></figure><h3 id="4-4-å¯¹æ¯”å­˜å‚¨å‡½æ•°å’Œå­˜å‚¨è¿‡ç¨‹"><a href="#4-4-å¯¹æ¯”å­˜å‚¨å‡½æ•°å’Œå­˜å‚¨è¿‡ç¨‹" class="headerlink" title="4.4 å¯¹æ¯”å­˜å‚¨å‡½æ•°å’Œå­˜å‚¨è¿‡ç¨‹"></a>4.4 å¯¹æ¯”å­˜å‚¨å‡½æ•°å’Œå­˜å‚¨è¿‡ç¨‹</h3><table><thead><tr><th></th><th>å…³é”®å­—</th><th>è°ƒç”¨è¯­æ³•</th><th>è¿”å›å€¼</th><th>åº”ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>å­˜å‚¨è¿‡ç¨‹</td><td>PROCEDURE</td><td>CALL å­˜å‚¨è¿‡ç¨‹()</td><td>ç†è§£ä¸ºæœ‰0ä¸ªæˆ–å¤šä¸ª</td><td>ä¸€èˆ¬ç”¨äºæ›´æ–°</td></tr><tr><td>å­˜å‚¨å‡½æ•°</td><td>FUNCTION</td><td>SELECT å‡½æ•°()</td><td>åªèƒ½æ˜¯ä¸€ä¸ª</td><td>ä¸€èˆ¬ç”¨äºæŸ¥è¯¢ç»“æœä¸ºä¸€ä¸ªå€¼å¹¶è¿”å›æ—¶</td></tr></tbody></table><p>æ­¤å¤–ï¼Œ<strong>å­˜å‚¨å‡½æ•°å¯ä»¥æ”¾åœ¨æŸ¥è¯¢è¯­å¥ä¸­ä½¿ç”¨ï¼Œå­˜å‚¨è¿‡ç¨‹ä¸è¡Œ</strong>ã€‚åä¹‹ï¼Œå­˜å‚¨è¿‡ç¨‹çš„åŠŸèƒ½æ›´åŠ å¼ºå¤§ï¼ŒåŒ…æ‹¬èƒ½å¤Ÿæ‰§è¡Œå¯¹è¡¨çš„æ“ä½œï¼ˆæ¯”å¦‚åˆ›å»ºè¡¨ï¼Œåˆ é™¤è¡¨ç­‰ï¼‰å’Œäº‹åŠ¡æ“ä½œï¼Œè¿™äº›åŠŸèƒ½æ˜¯å­˜å‚¨å‡½æ•°ä¸å…·å¤‡çš„ã€‚</p><h2 id="5-å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°çš„æŸ¥çœ‹ã€ä¿®æ”¹ã€åˆ é™¤"><a href="#5-å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°çš„æŸ¥çœ‹ã€ä¿®æ”¹ã€åˆ é™¤" class="headerlink" title="5. å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°çš„æŸ¥çœ‹ã€ä¿®æ”¹ã€åˆ é™¤"></a>5. å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°çš„æŸ¥çœ‹ã€ä¿®æ”¹ã€åˆ é™¤</h2><h3 id="5-1-æŸ¥çœ‹"><a href="#5-1-æŸ¥çœ‹" class="headerlink" title="5.1 æŸ¥çœ‹"></a>5.1 æŸ¥çœ‹</h3><p>åˆ›å»ºå®Œä¹‹åï¼Œæ€ä¹ˆçŸ¥é“æˆ‘ä»¬åˆ›å»ºçš„å­˜å‚¨è¿‡ç¨‹ã€å­˜å‚¨å‡½æ•°æ˜¯å¦æˆåŠŸäº†å‘¢ï¼Ÿ</p><p>MySQLå­˜å‚¨äº†å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°çš„çŠ¶æ€ä¿¡æ¯ï¼Œç”¨æˆ·å¯ä»¥ä½¿ç”¨SHOW STATUSè¯­å¥æˆ–SHOW CREATEè¯­å¥æ¥æŸ¥çœ‹ï¼Œä¹Ÿå¯ç›´æ¥ä»ç³»ç»Ÿçš„information_schemaæ•°æ®åº“ä¸­æŸ¥è¯¢ã€‚è¿™é‡Œä»‹ç»3ç§æ–¹æ³•ã€‚</p><p><strong>1. ä½¿ç”¨SHOW CREATEè¯­å¥æŸ¥çœ‹å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°çš„åˆ›å»ºä¿¡æ¯</strong></p><p>åŸºæœ¬è¯­æ³•ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SHOW CREATE &#123;PROCEDURE | FUNCTION&#125; å­˜å‚¨è¿‡ç¨‹åæˆ–å‡½æ•°å<br></code></pre></td></tr></table></figure><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SHOW CREATE FUNCTION test_db.CountProc \G<br></code></pre></td></tr></table></figure><p><strong>2. ä½¿ç”¨SHOW STATUSè¯­å¥æŸ¥çœ‹å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°çš„çŠ¶æ€ä¿¡æ¯</strong></p><p>åŸºæœ¬è¯­æ³•ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SHOW &#123;PROCEDURE | FUNCTION&#125; STATUS [LIKE &#x27;pattern&#x27;]<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªè¯­å¥è¿”å›å­ç¨‹åºçš„ç‰¹å¾ï¼Œå¦‚æ•°æ®åº“ã€åå­—ã€ç±»å‹ã€åˆ›å»ºè€…åŠåˆ›å»ºå’Œä¿®æ”¹æ—¥æœŸã€‚</p><p>[LIKE â€˜patternâ€™]ï¼šåŒ¹é…å­˜å‚¨è¿‡ç¨‹æˆ–å‡½æ•°çš„åç§°ï¼Œå¯ä»¥çœç•¥ã€‚å½“çœç•¥ä¸å†™æ—¶ï¼Œä¼šåˆ—å‡ºMySQLæ•°æ®åº“ä¸­å­˜åœ¨çš„æ‰€æœ‰å­˜å‚¨è¿‡ç¨‹æˆ–å‡½æ•°çš„ä¿¡æ¯ã€‚<br>ä¸¾ä¾‹ï¼šSHOW STATUSè¯­å¥ç¤ºä¾‹ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SHOW PROCEDURE STATUS LIKE &#x27;SELECT%&#x27; \G <br>*************************** 1. row ***************************<br>                  Db: test_db<br>                Name: SelectAllData<br>                Type: PROCEDURE<br>             Definer: root@localhost<br>            Modified: 2021-10-16 15:55:07<br>             Created: 2021-10-16 15:55:07<br>       Security_type: DEFINER<br>             Comment: <br>character_set_client: utf8mb4<br>collation_connection: utf8mb4_general_ci<br>  Database Collation: utf8mb4_general_ci<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><p><strong>3. ä»information_schema.Routinesè¡¨ä¸­æŸ¥çœ‹å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°çš„ä¿¡æ¯</strong></p><p>MySQLä¸­å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°çš„ä¿¡æ¯å­˜å‚¨åœ¨information_schemaæ•°æ®åº“ä¸‹çš„Routinesè¡¨ä¸­ã€‚å¯ä»¥é€šè¿‡æŸ¥è¯¢è¯¥è¡¨çš„è®°å½•æ¥æŸ¥è¯¢å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°çš„ä¿¡æ¯ã€‚å…¶åŸºæœ¬è¯­æ³•å½¢å¼å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT * FROM information_schema.Routines<br>WHERE ROUTINE_NAME=&#x27;å­˜å‚¨è¿‡ç¨‹æˆ–å‡½æ•°çš„å&#x27; [AND ROUTINE_TYPE = &#123;&#x27;PROCEDURE|FUNCTION&#x27;&#125;];<br></code></pre></td></tr></table></figure><p>è¯´æ˜ï¼šå¦‚æœåœ¨MySQLæ•°æ®åº“ä¸­å­˜åœ¨å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°åç§°ç›¸åŒçš„æƒ…å†µï¼Œæœ€å¥½æŒ‡å®šROUTINE_TYPEæŸ¥è¯¢æ¡ä»¶æ¥æŒ‡æ˜æŸ¥è¯¢çš„æ˜¯å­˜å‚¨è¿‡ç¨‹è¿˜æ˜¯å‡½æ•°ã€‚</p><p>ä¸¾ä¾‹ï¼šä»Routinesè¡¨ä¸­æŸ¥è¯¢åç§°ä¸ºCountProcçš„å­˜å‚¨å‡½æ•°çš„ä¿¡æ¯ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT * FROM information_schema.Routines<br>WHERE ROUTINE_NAME=&#x27;count_by_id&#x27;ã€€ANDã€€ROUTINE_TYPE = &#x27;FUNCTION&#x27; \G #æ­¤å¤„ROUTINE_TYPEåŒºåˆ†å¤§å°å†™ï¼Œå¿…é¡»å†™FUNCTION<br></code></pre></td></tr></table></figure><h3 id="5-2-ä¿®æ”¹"><a href="#5-2-ä¿®æ”¹" class="headerlink" title="5.2 ä¿®æ”¹"></a>5.2 ä¿®æ”¹</h3><p>ä¿®æ”¹å­˜å‚¨è¿‡ç¨‹æˆ–å‡½æ•°ï¼Œä¸å½±å“å­˜å‚¨è¿‡ç¨‹æˆ–å‡½æ•°åŠŸèƒ½ï¼Œåªæ˜¯ä¿®æ”¹ç›¸å…³ç‰¹æ€§ã€‚ä½¿ç”¨ALTERè¯­å¥å®ç°ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">ALTER &#123;PROCEDURE | FUNCTION&#125; å­˜å‚¨è¿‡ç¨‹æˆ–å‡½æ•°çš„å<br>[characteristic ...]<br></code></pre></td></tr></table></figure><p>å…¶ä¸­ï¼ŒcharacteristicæŒ‡å®šå­˜å‚¨è¿‡ç¨‹æˆ–å‡½æ•°çš„ç‰¹æ€§ï¼Œå…¶å–å€¼ä¿¡æ¯ä¸åˆ›å»ºå­˜å‚¨è¿‡ç¨‹ã€å‡½æ•°æ—¶çš„å–å€¼ä¿¡æ¯ç•¥æœ‰ä¸åŒã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">&#123; CONTAINS SQL | NO SQL | READS SQL DATA | MODIFIES SQL DATA &#125;<br>| SQL SECURITY &#123; DEFINER | INVOKER &#125;<br>| COMMENT &#x27;string&#x27;<br></code></pre></td></tr></table></figure><ul><li><code>CONTAINS SQL</code>ï¼Œè¡¨ç¤ºå­ç¨‹åºåŒ…å«SQLè¯­å¥ï¼Œä½†ä¸åŒ…å«è¯»æˆ–å†™æ•°æ®çš„è¯­å¥ã€‚</li><li><code>NO SQL</code>ï¼Œè¡¨ç¤ºå­ç¨‹åºä¸­ä¸åŒ…å«SQLè¯­å¥ã€‚</li><li><code>READS SQL DATA</code>ï¼Œè¡¨ç¤ºå­ç¨‹åºä¸­åŒ…å«è¯»æ•°æ®çš„è¯­å¥ã€‚</li><li><code>MODIFIES SQL DATA</code>ï¼Œè¡¨ç¤ºå­ç¨‹åºä¸­åŒ…å«å†™æ•°æ®çš„è¯­å¥ã€‚</li><li><code>SQL SECURITY &#123; DEFINER | INVOKER &#125;</code>ï¼ŒæŒ‡æ˜è°æœ‰æƒé™æ¥æ‰§è¡Œã€‚<ul><li><code>DEFINER</code>ï¼Œè¡¨ç¤ºåªæœ‰å®šä¹‰è€…è‡ªå·±æ‰èƒ½å¤Ÿæ‰§è¡Œã€‚</li><li><code>INVOKER</code>ï¼Œè¡¨ç¤ºè°ƒç”¨è€…å¯ä»¥æ‰§è¡Œã€‚</li></ul></li><li><code>COMMENT &#39;string&#39;</code>ï¼Œè¡¨ç¤ºæ³¨é‡Šä¿¡æ¯ã€‚</li></ul><blockquote><p>ä¿®æ”¹å­˜å‚¨è¿‡ç¨‹ä½¿ç”¨ALTER PROCEDUREè¯­å¥ï¼Œä¿®æ”¹å­˜å‚¨å‡½æ•°ä½¿ç”¨ALTER FUNCTIONè¯­å¥ã€‚ä½†æ˜¯ï¼Œè¿™ä¸¤ä¸ªè¯­å¥çš„ç»“æ„æ˜¯ä¸€æ ·çš„ï¼Œè¯­å¥ä¸­çš„æ‰€æœ‰å‚æ•°ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚</p></blockquote><p><strong>ä¸¾ä¾‹1ï¼š</strong></p><p>ä¿®æ”¹å­˜å‚¨è¿‡ç¨‹CountProcçš„å®šä¹‰ã€‚å°†è¯»å†™æƒé™æ”¹ä¸ºMODIFIES SQL DATAï¼Œå¹¶æŒ‡æ˜è°ƒç”¨è€…å¯ä»¥æ‰§è¡Œï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">ALTERã€€PROCEDUREã€€CountProc<br>MODIFIES SQL DATA<br>SQL SECURITY INVOKER ;<br></code></pre></td></tr></table></figure><p>æŸ¥è¯¢ä¿®æ”¹åçš„ä¿¡æ¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT specific_name,sql_data_access,security_type<br>FROM information_schema.`ROUTINES`<br>WHERE routine_name = &#x27;CountProc&#x27; AND routine_type = &#x27;PROCEDURE&#x27;;<br></code></pre></td></tr></table></figure><p>ç»“æœæ˜¾ç¤ºï¼Œå­˜å‚¨è¿‡ç¨‹ä¿®æ”¹æˆåŠŸã€‚ä»æŸ¥è¯¢çš„ç»“æœå¯ä»¥çœ‹å‡ºï¼Œè®¿é—®æ•°æ®çš„æƒé™ï¼ˆSQL_DATA_ ACCESSï¼‰å·²ç»å˜æˆMODIFIES SQL DATAï¼Œå®‰å…¨ç±»å‹ï¼ˆSECURITY_TYPEï¼‰å·²ç»å˜æˆINVOKERã€‚</p><p><strong>ä¸¾ä¾‹2ï¼š</strong></p><p>ä¿®æ”¹å­˜å‚¨å‡½æ•°CountProcçš„å®šä¹‰ã€‚å°†è¯»å†™æƒé™æ”¹ä¸ºREADS SQL DATAï¼Œå¹¶åŠ ä¸Šæ³¨é‡Šä¿¡æ¯â€œFIND NAMEâ€ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">ALTERã€€FUNCTIONã€€CountProc<br>READS SQL DATA<br>COMMENT &#x27;FIND NAME&#x27; ;<br></code></pre></td></tr></table></figure><p>å­˜å‚¨å‡½æ•°ä¿®æ”¹æˆåŠŸã€‚ä»æŸ¥è¯¢çš„ç»“æœå¯ä»¥çœ‹å‡ºï¼Œè®¿é—®æ•°æ®çš„æƒé™ï¼ˆSQL_DATA_ACCESSï¼‰å·²ç»å˜æˆREADS SQL DATAï¼Œå‡½æ•°æ³¨é‡Šï¼ˆROUTINE_COMMENTï¼‰å·²ç»å˜æˆFIND NAMEã€‚</p><h3 id="5-3-åˆ é™¤"><a href="#5-3-åˆ é™¤" class="headerlink" title="5.3 åˆ é™¤"></a>5.3 åˆ é™¤</h3><p>åˆ é™¤å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°ï¼Œå¯ä»¥ä½¿ç”¨DROPè¯­å¥ï¼Œå…¶è¯­æ³•ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DROP &#123;PROCEDURE | FUNCTION&#125; [IF EXISTS] å­˜å‚¨è¿‡ç¨‹æˆ–å‡½æ•°çš„å<br></code></pre></td></tr></table></figure><p>IF EXISTSï¼šå¦‚æœç¨‹åºæˆ–å‡½æ•°ä¸å­˜å‚¨ï¼Œå®ƒå¯ä»¥é˜²æ­¢å‘ç”Ÿé”™è¯¯ï¼Œäº§ç”Ÿä¸€ä¸ªç”¨SHOW WARNINGSæŸ¥çœ‹çš„è­¦å‘Šã€‚</p><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DROP PROCEDURE CountProc;<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DROP FUNCTION CountProc;<br></code></pre></td></tr></table></figure><h2 id="6-å…³äºå­˜å‚¨è¿‡ç¨‹ä½¿ç”¨çš„äº‰è®®"><a href="#6-å…³äºå­˜å‚¨è¿‡ç¨‹ä½¿ç”¨çš„äº‰è®®" class="headerlink" title="6. å…³äºå­˜å‚¨è¿‡ç¨‹ä½¿ç”¨çš„äº‰è®®"></a>6. å…³äºå­˜å‚¨è¿‡ç¨‹ä½¿ç”¨çš„äº‰è®®</h2><p>å°½ç®¡å­˜å‚¨è¿‡ç¨‹æœ‰è¯¸å¤šä¼˜ç‚¹ï¼Œä½†æ˜¯å¯¹äºå­˜å‚¨è¿‡ç¨‹çš„ä½¿ç”¨ï¼Œ<strong>ä¸€ç›´éƒ½å­˜åœ¨ç€å¾ˆå¤šäº‰è®®</strong>ï¼Œæ¯”å¦‚æœ‰äº›å…¬å¸å¯¹äºå¤§å‹é¡¹ç›®è¦æ±‚ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹ï¼Œè€Œæœ‰äº›å…¬å¸åœ¨æ‰‹å†Œä¸­æ˜ç¡®ç¦æ­¢ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹ï¼Œä¸ºä»€ä¹ˆè¿™äº›å…¬å¸å¯¹å­˜å‚¨è¿‡ç¨‹çš„ä½¿ç”¨éœ€æ±‚å·®åˆ«è¿™ä¹ˆå¤§å‘¢ï¼Ÿ</p><h3 id="6-1-ä¼˜ç‚¹"><a href="#6-1-ä¼˜ç‚¹" class="headerlink" title="6.1 ä¼˜ç‚¹"></a>6.1 ä¼˜ç‚¹</h3><p><strong>1ã€å­˜å‚¨è¿‡ç¨‹å¯ä»¥ä¸€æ¬¡ç¼–è¯‘å¤šæ¬¡ä½¿ç”¨ã€‚</strong>å­˜å‚¨è¿‡ç¨‹åªåœ¨åˆ›å»ºæ—¶è¿›è¡Œç¼–è¯‘ï¼Œä¹‹åçš„ä½¿ç”¨éƒ½ä¸éœ€è¦é‡æ–°ç¼–è¯‘ï¼Œè¿™å°±æå‡äº† SQL çš„æ‰§è¡Œæ•ˆç‡ã€‚</p><p><strong>2ã€å¯ä»¥å‡å°‘å¼€å‘å·¥ä½œé‡ã€‚</strong>å°†ä»£ç <code>å°è£…</code>æˆæ¨¡å—ï¼Œå®é™…ä¸Šæ˜¯ç¼–ç¨‹çš„æ ¸å¿ƒæ€æƒ³ä¹‹ä¸€ï¼Œè¿™æ ·å¯ä»¥æŠŠå¤æ‚çš„é—®é¢˜æ‹†è§£æˆä¸åŒçš„æ¨¡å—ï¼Œç„¶åæ¨¡å—ä¹‹é—´å¯ä»¥<code>é‡å¤ä½¿ç”¨</code>ï¼Œåœ¨å‡å°‘å¼€å‘å·¥ä½œé‡çš„åŒæ—¶ï¼Œè¿˜èƒ½ä¿è¯ä»£ç çš„ç»“æ„æ¸…æ™°ã€‚</p><p><strong>3ã€å­˜å‚¨è¿‡ç¨‹çš„å®‰å…¨æ€§å¼ºã€‚</strong>æˆ‘ä»¬åœ¨è®¾å®šå­˜å‚¨è¿‡ç¨‹çš„æ—¶å€™å¯ä»¥<code>è®¾ç½®å¯¹ç”¨æˆ·çš„ä½¿ç”¨æƒé™</code>ï¼Œè¿™æ ·å°±å’Œè§†å›¾ä¸€æ ·å…·æœ‰è¾ƒå¼ºçš„å®‰å…¨æ€§ã€‚</p><p><strong>4ã€å¯ä»¥å‡å°‘ç½‘ç»œä¼ è¾“é‡ã€‚</strong>å› ä¸ºä»£ç å°è£…åˆ°å­˜å‚¨è¿‡ç¨‹ä¸­ï¼Œæ¯æ¬¡ä½¿ç”¨åªéœ€è¦è°ƒç”¨å­˜å‚¨è¿‡ç¨‹å³å¯ï¼Œè¿™æ ·å°±å‡å°‘äº†ç½‘ç»œä¼ è¾“é‡ã€‚</p><p><strong>5ã€è‰¯å¥½çš„å°è£…æ€§ã€‚</strong>åœ¨è¿›è¡Œç›¸å¯¹å¤æ‚çš„æ•°æ®åº“æ“ä½œæ—¶ï¼ŒåŸæœ¬éœ€è¦ä½¿ç”¨ä¸€æ¡ä¸€æ¡çš„ SQL è¯­å¥ï¼Œå¯èƒ½è¦è¿æ¥å¤šæ¬¡æ•°æ®åº“æ‰èƒ½å®Œæˆçš„æ“ä½œï¼Œç°åœ¨å˜æˆäº†ä¸€æ¬¡å­˜å‚¨è¿‡ç¨‹ï¼Œåªéœ€è¦<code>è¿æ¥ä¸€æ¬¡å³å¯</code>ã€‚</p><h3 id="6-2-ç¼ºç‚¹"><a href="#6-2-ç¼ºç‚¹" class="headerlink" title="6.2 ç¼ºç‚¹"></a>6.2 ç¼ºç‚¹</h3><p>åŸºäºä¸Šé¢è¿™äº›ä¼˜ç‚¹ï¼Œä¸å°‘å¤§å…¬å¸éƒ½è¦æ±‚å¤§å‹é¡¹ç›®ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹ï¼Œæ¯”å¦‚å¾®è½¯ã€IBM ç­‰å…¬å¸ã€‚ä½†æ˜¯å›½å†…çš„é˜¿é‡Œå¹¶ä¸æ¨èå¼€å‘äººå‘˜ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p><blockquote><h4 id="é˜¿é‡Œå¼€å‘è§„èŒƒ"><a href="#é˜¿é‡Œå¼€å‘è§„èŒƒ" class="headerlink" title="é˜¿é‡Œå¼€å‘è§„èŒƒ"></a>é˜¿é‡Œå¼€å‘è§„èŒƒ</h4><p>ã€å¼ºåˆ¶ã€‘ç¦æ­¢ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹ï¼Œå­˜å‚¨è¿‡ç¨‹éš¾ä»¥è°ƒè¯•å’Œæ‰©å±•ï¼Œæ›´æ²¡æœ‰ç§»æ¤æ€§ã€‚</p></blockquote><p>å­˜å‚¨è¿‡ç¨‹è™½ç„¶æœ‰è¯¸å¦‚ä¸Šé¢çš„å¥½å¤„ï¼Œä½†ç¼ºç‚¹ä¹Ÿæ˜¯å¾ˆæ˜æ˜¾çš„ã€‚</p><p><strong>1ã€å¯ç§»æ¤æ€§å·®ã€‚</strong>å­˜å‚¨è¿‡ç¨‹ä¸èƒ½è·¨æ•°æ®åº“ç§»æ¤ï¼Œæ¯”å¦‚åœ¨ MySQLã€Oracle å’Œ SQL Server é‡Œç¼–å†™çš„å­˜å‚¨è¿‡ç¨‹ï¼Œåœ¨æ¢æˆå…¶ä»–æ•°æ®åº“æ—¶éƒ½éœ€è¦é‡æ–°ç¼–å†™ã€‚</p><p><strong>2ã€è°ƒè¯•å›°éš¾ã€‚</strong>åªæœ‰å°‘æ•° DBMS æ”¯æŒå­˜å‚¨è¿‡ç¨‹çš„è°ƒè¯•ã€‚å¯¹äºå¤æ‚çš„å­˜å‚¨è¿‡ç¨‹æ¥è¯´ï¼Œå¼€å‘å’Œç»´æŠ¤éƒ½ä¸å®¹æ˜“ã€‚è™½ç„¶ä¹Ÿæœ‰ä¸€äº›ç¬¬ä¸‰æ–¹å·¥å…·å¯ä»¥å¯¹å­˜å‚¨è¿‡ç¨‹è¿›è¡Œè°ƒè¯•ï¼Œä½†è¦æ”¶è´¹ã€‚</p><p><strong>3ã€å­˜å‚¨è¿‡ç¨‹çš„ç‰ˆæœ¬ç®¡ç†å¾ˆå›°éš¾ã€‚</strong>æ¯”å¦‚æ•°æ®è¡¨ç´¢å¼•å‘ç”Ÿå˜åŒ–äº†ï¼Œå¯èƒ½ä¼šå¯¼è‡´å­˜å‚¨è¿‡ç¨‹å¤±æ•ˆã€‚æˆ‘ä»¬åœ¨å¼€å‘è½¯ä»¶çš„æ—¶å€™å¾€å¾€éœ€è¦è¿›è¡Œç‰ˆæœ¬ç®¡ç†ï¼Œä½†æ˜¯å­˜å‚¨è¿‡ç¨‹æœ¬èº«æ²¡æœ‰ç‰ˆæœ¬æ§åˆ¶ï¼Œç‰ˆæœ¬è¿­ä»£æ›´æ–°çš„æ—¶å€™å¾ˆéº»çƒ¦ã€‚</p><p><strong>4ã€å®ƒä¸é€‚åˆé«˜å¹¶å‘çš„åœºæ™¯ã€‚</strong>é«˜å¹¶å‘çš„åœºæ™¯éœ€è¦å‡å°‘æ•°æ®åº“çš„å‹åŠ›ï¼Œæœ‰æ—¶æ•°æ®åº“ä¼šé‡‡ç”¨åˆ†åº“åˆ†è¡¨çš„æ–¹å¼ï¼Œè€Œä¸”å¯¹å¯æ‰©å±•æ€§è¦æ±‚å¾ˆé«˜ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå­˜å‚¨è¿‡ç¨‹ä¼šå˜å¾—éš¾ä»¥ç»´æŠ¤ï¼Œ<code>å¢åŠ æ•°æ®åº“çš„å‹åŠ›</code>ï¼Œæ˜¾ç„¶å°±ä¸é€‚ç”¨äº†ã€‚</p><p>å°ç»“ï¼š</p><p>å­˜å‚¨è¿‡ç¨‹æ—¢æ–¹ä¾¿ï¼Œåˆæœ‰å±€é™æ€§ã€‚å°½ç®¡ä¸åŒçš„å…¬å¸å¯¹å­˜å‚¨è¿‡ç¨‹çš„æ€åº¦ä¸ä¸€ï¼Œä½†æ˜¯å¯¹äºæˆ‘ä»¬å¼€å‘äººå‘˜æ¥è¯´ï¼Œä¸è®ºæ€æ ·ï¼ŒæŒæ¡å­˜å‚¨è¿‡ç¨‹éƒ½æ˜¯å¿…å¤‡çš„æŠ€èƒ½ä¹‹ä¸€ã€‚</p><h1 id="ç¬¬16ç« -å˜é‡ã€æµç¨‹æ§åˆ¶ä¸æ¸¸æ ‡"><a href="#ç¬¬16ç« -å˜é‡ã€æµç¨‹æ§åˆ¶ä¸æ¸¸æ ‡" class="headerlink" title="ç¬¬16ç« _å˜é‡ã€æµç¨‹æ§åˆ¶ä¸æ¸¸æ ‡"></a>ç¬¬16ç« _å˜é‡ã€æµç¨‹æ§åˆ¶ä¸æ¸¸æ ‡</h1><h2 id="1-å˜é‡"><a href="#1-å˜é‡" class="headerlink" title="1. å˜é‡"></a>1. å˜é‡</h2><p>åœ¨MySQLæ•°æ®åº“çš„å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°ä¸­ï¼Œå¯ä»¥ä½¿ç”¨å˜é‡æ¥å­˜å‚¨æŸ¥è¯¢æˆ–è®¡ç®—çš„ä¸­é—´ç»“æœæ•°æ®ï¼Œæˆ–è€…è¾“å‡ºæœ€ç»ˆçš„ç»“æœæ•°æ®ã€‚</p><p>åœ¨ MySQL æ•°æ®åº“ä¸­ï¼Œå˜é‡åˆ†ä¸º<code>ç³»ç»Ÿå˜é‡</code>ä»¥åŠ<code>ç”¨æˆ·è‡ªå®šä¹‰å˜é‡</code>ã€‚</p><h3 id="1-1-ç³»ç»Ÿå˜é‡"><a href="#1-1-ç³»ç»Ÿå˜é‡" class="headerlink" title="1.1 ç³»ç»Ÿå˜é‡"></a>1.1 ç³»ç»Ÿå˜é‡</h3><h4 id="1-1-1-ç³»ç»Ÿå˜é‡åˆ†ç±»"><a href="#1-1-1-ç³»ç»Ÿå˜é‡åˆ†ç±»" class="headerlink" title="1.1.1 ç³»ç»Ÿå˜é‡åˆ†ç±»"></a>1.1.1 ç³»ç»Ÿå˜é‡åˆ†ç±»</h4><p>å˜é‡ç”±ç³»ç»Ÿå®šä¹‰ï¼Œä¸æ˜¯ç”¨æˆ·å®šä¹‰ï¼Œå±äº<code>æœåŠ¡å™¨</code>å±‚é¢ã€‚å¯åŠ¨MySQLæœåŠ¡ï¼Œç”ŸæˆMySQLæœåŠ¡å®ä¾‹æœŸé—´ï¼ŒMySQLå°†ä¸ºMySQLæœåŠ¡å™¨å†…å­˜ä¸­çš„ç³»ç»Ÿå˜é‡èµ‹å€¼ï¼Œè¿™äº›ç³»ç»Ÿå˜é‡å®šä¹‰äº†å½“å‰MySQLæœåŠ¡å®ä¾‹çš„å±æ€§ã€ç‰¹å¾ã€‚è¿™äº›ç³»ç»Ÿå˜é‡çš„å€¼è¦ä¹ˆæ˜¯<code>ç¼–è¯‘MySQLæ—¶å‚æ•°</code>çš„é»˜è®¤å€¼ï¼Œè¦ä¹ˆæ˜¯<code>é…ç½®æ–‡ä»¶</code>ï¼ˆä¾‹å¦‚my.iniç­‰ï¼‰ä¸­çš„å‚æ•°å€¼ã€‚å¤§å®¶å¯ä»¥é€šè¿‡ç½‘å€ <code>https://dev.mysql.com/doc/refman/8.0/en/server-system-variables.html</code> æŸ¥çœ‹MySQLæ–‡æ¡£çš„ç³»ç»Ÿå˜é‡ã€‚</p><p>ç³»ç»Ÿå˜é‡åˆ†ä¸ºå…¨å±€ç³»ç»Ÿå˜é‡ï¼ˆéœ€è¦æ·»åŠ <code>global</code> å…³é”®å­—ï¼‰ä»¥åŠä¼šè¯ç³»ç»Ÿå˜é‡ï¼ˆéœ€è¦æ·»åŠ  <code>session</code> å…³é”®å­—ï¼‰ï¼Œæœ‰æ—¶ä¹ŸæŠŠå…¨å±€ç³»ç»Ÿå˜é‡ç®€ç§°ä¸ºå…¨å±€å˜é‡ï¼Œæœ‰æ—¶ä¹ŸæŠŠä¼šè¯ç³»ç»Ÿå˜é‡ç§°ä¸ºlocalå˜é‡ã€‚<strong>å¦‚æœä¸å†™ï¼Œé»˜è®¤ä¼šè¯çº§åˆ«ã€‚</strong>é™æ€å˜é‡ï¼ˆåœ¨ MySQL æœåŠ¡å®ä¾‹è¿è¡ŒæœŸé—´å®ƒä»¬çš„å€¼ä¸èƒ½ä½¿ç”¨ set åŠ¨æ€ä¿®æ”¹ï¼‰å±äºç‰¹æ®Šçš„å…¨å±€ç³»ç»Ÿå˜é‡ã€‚<strong>ä¸€ä¸ªå˜é‡å¯èƒ½æ—¢æ˜¯å…¨å±€ç³»ç»Ÿå˜é‡ä¹Ÿæ˜¯ä¼šè¯ç³»ç»Ÿå˜é‡(ä½†æ˜¯å–å€¼å¯èƒ½ä¸åŒï¼Œåº•å±‚æœ‰ä¸¤ä¸ªç³»ç»Ÿå˜é‡ï¼Œä¸€ä¸ªæ˜¯å…¨å±€ç³»ç»Ÿå˜é‡ï¼Œä¸€ä¸ªæ˜¯ä¼šè¯ç³»ç»Ÿå˜é‡ï¼‰ï¼Œä¹Ÿå¯èƒ½åªæ˜¯å…¨å±€ç³»ç»Ÿå˜é‡ï¼Œä¹Ÿå¯èƒ½åªæ˜¯ä¼šè¯ç³»ç»Ÿå˜é‡ã€‚</strong></p><p>å½“MySQLæœåŠ¡å¯åŠ¨åï¼Œå…¨å±€ç³»ç»Ÿå˜é‡ä¼šè¢«åˆå§‹åŒ–ï¼Œå½“å®¢æˆ·ç«¯è¿æ¥MySQLæœåŠ¡å™¨ä¹‹åï¼Œä¼šäº§ç”Ÿå¯¹åº”çš„ä¼šè¯ï¼Œè¿™æ—¶ä¼šè¯ç³»ç»Ÿå˜é‡ä¼šè¢«åˆå§‹åŒ–ã€‚</p><p>æ¯ä¸€ä¸ªMySQLå®¢æˆ·æœºæˆåŠŸè¿æ¥MySQLæœåŠ¡å™¨åï¼Œéƒ½ä¼šäº§ç”Ÿä¸ä¹‹å¯¹åº”çš„ä¼šè¯ã€‚ä¼šè¯æœŸé—´ï¼ŒMySQLæœåŠ¡å®ä¾‹ä¼šåœ¨MySQLæœåŠ¡å™¨å†…å­˜ä¸­ç”Ÿæˆä¸è¯¥ä¼šè¯å¯¹åº”çš„ä¼šè¯ç³»ç»Ÿå˜é‡ï¼Œè¿™äº›ä¼šè¯ç³»ç»Ÿå˜é‡çš„åˆå§‹å€¼æ˜¯å…¨å±€ç³»ç»Ÿå˜é‡å€¼çš„å¤åˆ¶ã€‚å¦‚ä¸‹å›¾ï¼š</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211108114846634.png"></p><ul><li>å…¨å±€ç³»ç»Ÿå˜é‡é’ˆå¯¹äºæ‰€æœ‰ä¼šè¯ï¼ˆè¿æ¥ï¼‰æœ‰æ•ˆï¼Œä½†<code>ä¸èƒ½è·¨é‡å¯</code>ã€‚ä¾‹å¦‚<code>SET GLOBAL log_bin_trust_function_creators = 1;</code></li><li>ä¼šè¯ç³»ç»Ÿå˜é‡ä»…é’ˆå¯¹äºå½“å‰ä¼šè¯ï¼ˆè¿æ¥ï¼‰æœ‰æ•ˆã€‚ä¼šè¯æœŸé—´ï¼Œå½“å‰ä¼šè¯å¯¹æŸä¸ªä¼šè¯ç³»ç»Ÿå˜é‡å€¼çš„ä¿®æ”¹ï¼Œä¸ä¼šå½±å“å…¶ä»–ä¼šè¯åŒä¸€ä¸ªä¼šè¯ç³»ç»Ÿå˜é‡çš„å€¼ï¼›å¹¶ä¸”ä¼šè¯ç³»ç»Ÿå˜é‡çš„ä¿®æ”¹é’ˆå¯¹å½“å‰ä¼šè¯æ˜¯æœ‰æ•ˆçš„ï¼Œä¸€æ—¦ç»“æŸä¼šè¯ï¼Œé‡æ–°å»ºç«‹æ–°çš„ä¼šè¯ï¼Œè¯¥ä¼šè¯ç³»ç»Ÿå˜é‡ä¼šé‡æ–°è¿›è¡Œåˆå§‹åŒ–ï¼ˆä¿®æ”¹å¤±æ•ˆï¼‰ã€‚</li><li>ä¼šè¯1å¯¹æŸä¸ªå…¨å±€ç³»ç»Ÿå˜é‡å€¼çš„ä¿®æ”¹ä¼šå¯¼è‡´ä¼šè¯2ä¸­åŒä¸€ä¸ªå…¨å±€ç³»ç»Ÿå˜é‡å€¼çš„ä¿®æ”¹ã€‚</li></ul><p>åœ¨MySQLä¸­æœ‰äº›ç³»ç»Ÿå˜é‡åªèƒ½æ˜¯å…¨å±€çš„ï¼Œä¾‹å¦‚ max_connections ç”¨äºé™åˆ¶æœåŠ¡å™¨çš„æœ€å¤§è¿æ¥æ•°ï¼›æœ‰äº›ç³»ç»Ÿå˜é‡ä½œç”¨åŸŸæ—¢å¯ä»¥æ˜¯å…¨å±€åˆå¯ä»¥æ˜¯ä¼šè¯ï¼Œä¾‹å¦‚ character_set_client ç”¨äºè®¾ç½®å®¢æˆ·ç«¯çš„å­—ç¬¦é›†ï¼›æœ‰äº›ç³»ç»Ÿå˜é‡çš„ä½œç”¨åŸŸåªèƒ½æ˜¯å½“å‰ä¼šè¯ï¼Œä¾‹å¦‚ pseudo_thread_id ç”¨äºæ ‡è®°å½“å‰ä¼šè¯çš„ MySQL è¿æ¥ IDã€‚</p><h4 id="1-1-2-æŸ¥çœ‹ç³»ç»Ÿå˜é‡"><a href="#1-1-2-æŸ¥çœ‹ç³»ç»Ÿå˜é‡" class="headerlink" title="1.1.2 æŸ¥çœ‹ç³»ç»Ÿå˜é‡"></a>1.1.2 æŸ¥çœ‹ç³»ç»Ÿå˜é‡</h4><ul><li><strong>æŸ¥çœ‹æ‰€æœ‰æˆ–éƒ¨åˆ†ç³»ç»Ÿå˜é‡</strong></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#æŸ¥çœ‹æ‰€æœ‰å…¨å±€å˜é‡<br>SHOW GLOBAL VARIABLES;<br><br>#æŸ¥çœ‹æ‰€æœ‰ä¼šè¯å˜é‡<br>SHOW SESSION VARIABLES;<br>æˆ–<br>SHOW VARIABLES; #é»˜è®¤æ˜¯ä¼šè¯å˜é‡<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#æŸ¥çœ‹æ»¡è¶³æ¡ä»¶çš„éƒ¨åˆ†ç³»ç»Ÿå˜é‡ã€‚<br>SHOW GLOBAL VARIABLES LIKE &#x27;%æ ‡è¯†ç¬¦%&#x27;;<br><br>#æŸ¥çœ‹æ»¡è¶³æ¡ä»¶çš„éƒ¨åˆ†ä¼šè¯å˜é‡<br>SHOW [SESSION] VARIABLES LIKE &#x27;%æ ‡è¯†ç¬¦%&#x27;; #é»˜è®¤æ˜¯ä¼šè¯å˜é‡g<br></code></pre></td></tr></table></figure><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SHOW GLOBAL VARIABLES LIKE &#x27;admin%&#x27;;<br></code></pre></td></tr></table></figure><ul><li><strong>æŸ¥çœ‹æŒ‡å®šç³»ç»Ÿå˜é‡</strong></li></ul><p>ä½œä¸º MySQL ç¼–ç è§„èŒƒï¼ŒMySQL ä¸­çš„ç³»ç»Ÿå˜é‡ä»¥<code>ä¸¤ä¸ªâ€œ@â€</code>å¼€å¤´ï¼Œå…¶ä¸­â€œ@@globalâ€ä»…ç”¨äºæ ‡è®°å…¨å±€ç³»ç»Ÿå˜é‡ï¼Œâ€œ@@sessionâ€ä»…ç”¨äºæ ‡è®°ä¼šè¯ç³»ç»Ÿå˜é‡ã€‚â€œ@@â€é¦–å…ˆæ ‡è®°ä¼šè¯ç³»ç»Ÿå˜é‡ï¼Œå¦‚æœä¼šè¯ç³»ç»Ÿå˜é‡ä¸å­˜åœ¨ï¼Œåˆ™æ ‡è®°å…¨å±€ç³»ç»Ÿå˜é‡ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#æŸ¥çœ‹æŒ‡å®šçš„ç³»ç»Ÿå˜é‡çš„å€¼<br>SELECT @@global.å˜é‡å;<br><br>#æŸ¥çœ‹æŒ‡å®šçš„ä¼šè¯å˜é‡çš„å€¼<br>SELECT @@session.å˜é‡å;<br>#æˆ–è€…<br>SELECT @@å˜é‡å;<br></code></pre></td></tr></table></figure><ul><li><strong>ä¿®æ”¹ç³»ç»Ÿå˜é‡çš„å€¼</strong></li></ul><p>æœ‰äº›æ—¶å€™ï¼Œæ•°æ®åº“ç®¡ç†å‘˜éœ€è¦ä¿®æ”¹ç³»ç»Ÿå˜é‡çš„é»˜è®¤å€¼ï¼Œä»¥ä¾¿ä¿®æ”¹å½“å‰ä¼šè¯æˆ–è€…MySQLæœåŠ¡å®ä¾‹çš„å±æ€§ã€ç‰¹å¾ã€‚å…·ä½“æ–¹æ³•ï¼š</p><p>æ–¹å¼1ï¼šä¿®æ”¹MySQL<code>é…ç½®æ–‡ä»¶</code>ï¼Œç»§è€Œä¿®æ”¹MySQLç³»ç»Ÿå˜é‡çš„å€¼ï¼ˆè¯¥æ–¹æ³•éœ€è¦é‡å¯MySQLæœåŠ¡ï¼‰<strong>é‡å¯ä¸å¤±æ•ˆ</strong></p><p>æ–¹å¼2ï¼šåœ¨MySQLæœåŠ¡è¿è¡ŒæœŸé—´ï¼Œä½¿ç”¨â€œsetâ€å‘½ä»¤é‡æ–°è®¾ç½®ç³»ç»Ÿå˜é‡çš„å€¼ã€‚<strong>é‡å¯å¤±æ•ˆ</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#ä¸ºæŸä¸ªç³»ç»Ÿå˜é‡èµ‹å€¼<br>#æ–¹å¼1ï¼š<br>SET @@global.å˜é‡å=å˜é‡å€¼;<br>#æ–¹å¼2ï¼š<br>SET GLOBAL å˜é‡å=å˜é‡å€¼;<br><br><br>#ä¸ºæŸä¸ªä¼šè¯å˜é‡èµ‹å€¼<br>#æ–¹å¼1ï¼š<br>SET @@session.å˜é‡å=å˜é‡å€¼;<br>#æ–¹å¼2ï¼š<br>SET SESSION å˜é‡å=å˜é‡å€¼;<br></code></pre></td></tr></table></figure><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT @@global.autocommit;<br>SET GLOBAL autocommit=0;<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT @@session.tx_isolation;<br>SET @@session.tx_isolation=&#x27;read-uncommitted&#x27;;<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SET GLOBAL max_connections = 1000;<br>SELECT @@global.max_connections;<br></code></pre></td></tr></table></figure><h3 id="1-2-ç”¨æˆ·å˜é‡"><a href="#1-2-ç”¨æˆ·å˜é‡" class="headerlink" title="1.2 ç”¨æˆ·å˜é‡"></a>1.2 ç”¨æˆ·å˜é‡</h3><h4 id="1-2-1-ç”¨æˆ·å˜é‡åˆ†ç±»"><a href="#1-2-1-ç”¨æˆ·å˜é‡åˆ†ç±»" class="headerlink" title="1.2.1 ç”¨æˆ·å˜é‡åˆ†ç±»"></a>1.2.1 ç”¨æˆ·å˜é‡åˆ†ç±»</h4><p>ç”¨æˆ·å˜é‡æ˜¯ç”¨æˆ·è‡ªå·±å®šä¹‰çš„ï¼Œä½œä¸º MySQL ç¼–ç è§„èŒƒï¼ŒMySQL ä¸­çš„ç”¨æˆ·å˜é‡ä»¥<code>ä¸€ä¸ªâ€œ@â€</code>å¼€å¤´ï¼ˆé’ˆå¯¹ä¼šè¯ç”¨æˆ·å˜é‡ï¼Œå±€éƒ¨å˜é‡ä¸éœ€è¦ç”¨@ä¿®é¥°ï¼‰ã€‚æ ¹æ®ä½œç”¨èŒƒå›´ä¸åŒï¼Œåˆåˆ†ä¸º<code>ä¼šè¯ç”¨æˆ·å˜é‡</code>å’Œ<code>å±€éƒ¨å˜é‡</code>ã€‚</p><ul><li><p>ä¼šè¯ç”¨æˆ·å˜é‡ï¼šä½¿ç”¨@å¼€å¤´ï¼Œä½œç”¨åŸŸå’Œä¼šè¯å˜é‡ä¸€æ ·ï¼Œåªå¯¹<code>å½“å‰è¿æ¥</code>ä¼šè¯æœ‰æ•ˆã€‚</p></li><li><p>å±€éƒ¨å˜é‡ï¼šåªåœ¨ BEGIN å’Œ END è¯­å¥å—ä¸­æœ‰æ•ˆã€‚å±€éƒ¨å˜é‡åªèƒ½åœ¨<code>å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°</code>ä¸­ä½¿ç”¨ã€‚</p></li></ul><h4 id="1-2-2-ä¼šè¯ç”¨æˆ·å˜é‡"><a href="#1-2-2-ä¼šè¯ç”¨æˆ·å˜é‡" class="headerlink" title="1.2.2 ä¼šè¯ç”¨æˆ·å˜é‡"></a>1.2.2 ä¼šè¯ç”¨æˆ·å˜é‡</h4><ul><li>å˜é‡çš„å®šä¹‰</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#æ–¹å¼1ï¼šâ€œ=â€æˆ–â€œ:=â€<br>SET @ç”¨æˆ·å˜é‡ = å€¼;<br>SET @ç”¨æˆ·å˜é‡ := å€¼;<br><br>#æ–¹å¼2ï¼šâ€œ:=â€ æˆ– INTOå…³é”®å­—<br>SELECT @ç”¨æˆ·å˜é‡ := è¡¨è¾¾å¼ [FROM ç­‰å­å¥];<br>SELECT è¡¨è¾¾å¼ INTO @ç”¨æˆ·å˜é‡  [FROM ç­‰å­å¥];<br>#INTO å¯ä»¥åŒæ—¶èµ‹å¤šä¸ªå€¼ï¼Œ ä½†æ˜¯ := ä¸å¯ä»¥åŒæ—¶èµ‹å¤šä¸ªå€¼ã€‚<br></code></pre></td></tr></table></figure><ul><li>æŸ¥çœ‹ç”¨æˆ·å˜é‡çš„å€¼ ï¼ˆæŸ¥çœ‹ã€æ¯”è¾ƒã€è¿ç®—ç­‰ï¼‰</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT @ç”¨æˆ·å˜é‡<br></code></pre></td></tr></table></figure><ul><li>ä¸¾ä¾‹</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SET @a = 1;<br><br>SELECT @a;<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT @num := COUNT(*) FROM employees;<br><br>SELECT @num;<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT AVG(salary) INTO @avgsalary FROM employees;<br><br>SELECT @avgsalary;<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT @big;  #æŸ¥çœ‹æŸä¸ªæœªå£°æ˜çš„å˜é‡æ—¶ï¼Œå°†å¾—åˆ°NULLå€¼<br></code></pre></td></tr></table></figure><h4 id="1-2-3-å±€éƒ¨å˜é‡"><a href="#1-2-3-å±€éƒ¨å˜é‡" class="headerlink" title="1.2.3 å±€éƒ¨å˜é‡"></a>1.2.3 å±€éƒ¨å˜é‡</h4><p>å®šä¹‰ï¼šå¯ä»¥ä½¿ç”¨<code>DECLARE</code>è¯­å¥å®šä¹‰ä¸€ä¸ªå±€éƒ¨å˜é‡</p><p>ä½œç”¨åŸŸï¼šä»…ä»…åœ¨å®šä¹‰å®ƒçš„ BEGIN â€¦ END ä¸­æœ‰æ•ˆ</p><p><code>DECLARE</code>ä½ç½®ï¼šåªèƒ½æ”¾åœ¨ BEGIN â€¦ END ä¸­ï¼Œè€Œä¸”åªèƒ½æ”¾åœ¨ç¬¬ä¸€å¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs mysql">BEGIN<br>#å£°æ˜å±€éƒ¨å˜é‡<br>DECLARE å˜é‡å1 å˜é‡æ•°æ®ç±»å‹ [DEFAULT å˜é‡é»˜è®¤å€¼];<br>DECLARE å˜é‡å2,å˜é‡å3,... å˜é‡æ•°æ®ç±»å‹ [DEFAULT å˜é‡é»˜è®¤å€¼];<br><br>#ä¸ºå±€éƒ¨å˜é‡èµ‹å€¼<br>SET å˜é‡å1 = å€¼;<br>SELECT å€¼ INTO å˜é‡å2 [FROM å­å¥];<br><br>#æŸ¥çœ‹å±€éƒ¨å˜é‡çš„å€¼<br>SELECT å˜é‡1,å˜é‡2,å˜é‡3;<br>END<br><br></code></pre></td></tr></table></figure><p><strong>1.å£°æ˜å˜é‡</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DECLARE å˜é‡å ç±»å‹ [default å€¼];  # å¦‚æœæ²¡æœ‰DEFAULTå­å¥ï¼Œåˆå§‹å€¼ä¸ºNULL<br></code></pre></td></tr></table></figure><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DECLAREã€€myparamã€€INTã€€DEFAULT 100;<br></code></pre></td></tr></table></figure><p><strong>2.å˜é‡èµ‹å€¼</strong></p><p>æ–¹å¼1ï¼šä¸€èˆ¬ç”¨äºèµ‹ç®€å•çš„å€¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SET å˜é‡å=å€¼;<br>SET å˜é‡å:=å€¼;<br></code></pre></td></tr></table></figure><p>æ–¹å¼2ï¼šä¸€èˆ¬ç”¨äºèµ‹è¡¨ä¸­çš„å­—æ®µå€¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT å­—æ®µåæˆ–è¡¨è¾¾å¼ INTO å˜é‡å FROM è¡¨;<br></code></pre></td></tr></table></figure><p><strong>3.ä½¿ç”¨å˜é‡</strong>ï¼ˆæŸ¥çœ‹ã€æ¯”è¾ƒã€è¿ç®—ç­‰ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT å±€éƒ¨å˜é‡å;<br></code></pre></td></tr></table></figure><p>ä¸¾ä¾‹1ï¼šå£°æ˜å±€éƒ¨å˜é‡ï¼Œå¹¶åˆ†åˆ«èµ‹å€¼ä¸ºemployeesè¡¨ä¸­employee_idä¸º102çš„last_nameå’Œsalary</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DELIMITER //<br><br>CREATE PROCEDURE set_value()<br>BEGIN<br>DECLARE emp_name VARCHAR(25);<br>DECLARE sal DOUBLE(10,2);<br><br>SELECT last_name,salary INTO emp_name,sal #INTO å¯ä»¥åŒæ—¶èµ‹å¤šä¸ªå€¼ï¼Œ ä½†æ˜¯ := ä¸å¯ä»¥åŒæ—¶èµ‹å¤šä¸ªå€¼ã€‚<br>FROM employees <br>WHERE employee_id = 102;<br><br>SELECT emp_name,sal;<br>END //<br><br>DELIMITER ;<br></code></pre></td></tr></table></figure><p>ä¸¾ä¾‹2ï¼šå£°æ˜ä¸¤ä¸ªå˜é‡ï¼Œæ±‚å’Œå¹¶æ‰“å° ï¼ˆåˆ†åˆ«ä½¿ç”¨ä¼šè¯ç”¨æˆ·å˜é‡ã€å±€éƒ¨å˜é‡çš„æ–¹å¼å®ç°ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#æ–¹å¼1ï¼šä½¿ç”¨ç”¨æˆ·å˜é‡<br>SET @m=1;<br>SET @n=1;<br>SET @sum=@m+@n;<br><br>SELECT @sum;<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#æ–¹å¼2ï¼šä½¿ç”¨å±€éƒ¨å˜é‡<br>DELIMITER //<br><br>CREATE PROCEDURE add_value()<br>BEGIN<br>#å±€éƒ¨å˜é‡<br>DECLARE m INT DEFAULT 1;<br>DECLARE n INT DEFAULT 3;<br>DECLARE SUM INT;<br><br>SET SUM = m+n;<br>SELECT SUM;<br>END //<br><br>DELIMITER ;<br></code></pre></td></tr></table></figure><p>ä¸¾ä¾‹3ï¼šåˆ›å»ºå­˜å‚¨è¿‡ç¨‹â€œdifferent_salaryâ€æŸ¥è¯¢æŸå‘˜å·¥å’Œä»–é¢†å¯¼çš„è–ªèµ„å·®è·ï¼Œå¹¶ç”¨INå‚æ•°emp_idæ¥æ”¶å‘˜å·¥idï¼Œç”¨OUTå‚æ•°dif_salaryè¾“å‡ºè–ªèµ„å·®è·ç»“æœã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#å£°æ˜<br>DELIMITER //<br><br>CREATE PROCEDURE different_salary(IN emp_id INT,OUT dif_salary DOUBLE)<br>BEGIN<br>#å£°æ˜å±€éƒ¨å˜é‡<br>DECLARE emp_sal,mgr_sal DOUBLE DEFAULT 0.0;<br>DECLARE mgr_id INT;<br><br>SELECT salary INTO emp_sal FROM employees WHERE employee_id = emp_id;<br>SELECT manager_id INTO mgr_id FROM employees WHERE employee_id = emp_id;<br>SELECT salary INTO mgr_sal FROM employees WHERE employee_id = mgr_id;<br>SET dif_salary = mgr_sal - emp_sal;<br><br>END //<br><br>DELIMITER ;<br><br>#è°ƒç”¨<br>SET @emp_id = 102;<br>CALL different_salary(@emp_id,@diff_sal);<br><br><br>#æŸ¥çœ‹<br>SELECT @diff_sal;<br></code></pre></td></tr></table></figure><h4 id="1-2-4-å¯¹æ¯”ä¼šè¯ç”¨æˆ·å˜é‡ä¸å±€éƒ¨å˜é‡"><a href="#1-2-4-å¯¹æ¯”ä¼šè¯ç”¨æˆ·å˜é‡ä¸å±€éƒ¨å˜é‡" class="headerlink" title="1.2.4 å¯¹æ¯”ä¼šè¯ç”¨æˆ·å˜é‡ä¸å±€éƒ¨å˜é‡"></a>1.2.4 å¯¹æ¯”ä¼šè¯ç”¨æˆ·å˜é‡ä¸å±€éƒ¨å˜é‡</h4><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ada">  ä½œç”¨åŸŸå£°æ˜ä½ç½®  è¯­æ³•<br>ä¼šè¯ç”¨æˆ·å˜é‡  å½“å‰ä¼šè¯   ä¼šè¯çš„ä»»ä½•åœ°æ–¹åŠ @ç¬¦å·ï¼Œä¸ç”¨æŒ‡å®šç±»å‹<br>å±€éƒ¨å˜é‡   å®šä¹‰å®ƒçš„<span class="hljs-keyword">BEGIN</span> <span class="hljs-keyword">END</span>ä¸­ <span class="hljs-keyword">BEGIN</span> <span class="hljs-keyword">END</span>çš„ç¬¬ä¸€å¥è¯  ä¸€èˆ¬ä¸ç”¨åŠ @,éœ€è¦æŒ‡å®šç±»å‹<br></code></pre></td></tr></table></figure><h2 id="2-å®šä¹‰æ¡ä»¶ä¸å¤„ç†ç¨‹åº"><a href="#2-å®šä¹‰æ¡ä»¶ä¸å¤„ç†ç¨‹åº" class="headerlink" title="2. å®šä¹‰æ¡ä»¶ä¸å¤„ç†ç¨‹åº"></a>2. å®šä¹‰æ¡ä»¶ä¸å¤„ç†ç¨‹åº</h2><p><code>å®šä¹‰æ¡ä»¶</code>æ˜¯äº‹å…ˆå®šä¹‰ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­å¯èƒ½é‡åˆ°çš„é—®é¢˜ï¼Œ<code>å¤„ç†ç¨‹åº</code>å®šä¹‰äº†åœ¨é‡åˆ°é—®é¢˜æ—¶åº”å½“é‡‡å–çš„å¤„ç†æ–¹å¼ï¼Œå¹¶ä¸”ä¿è¯å­˜å‚¨è¿‡ç¨‹æˆ–å‡½æ•°åœ¨é‡åˆ°è­¦å‘Šæˆ–é”™è¯¯æ—¶èƒ½ç»§ç»­æ‰§è¡Œã€‚è¿™æ ·å¯ä»¥å¢å¼ºå­˜å‚¨ç¨‹åºå¤„ç†é—®é¢˜çš„èƒ½åŠ›ï¼Œé¿å…ç¨‹åºå¼‚å¸¸åœæ­¢è¿è¡Œã€‚</p><p>è¯´æ˜ï¼šå®šä¹‰æ¡ä»¶å’Œå¤„ç†ç¨‹åºåœ¨å­˜å‚¨è¿‡ç¨‹ã€å­˜å‚¨å‡½æ•°ä¸­éƒ½æ˜¯æ”¯æŒçš„ã€‚</p><h3 id="2-1-æ¡ˆä¾‹åˆ†æ"><a href="#2-1-æ¡ˆä¾‹åˆ†æ" class="headerlink" title="2.1 æ¡ˆä¾‹åˆ†æ"></a>2.1 æ¡ˆä¾‹åˆ†æ</h3><p><strong>æ¡ˆä¾‹åˆ†æï¼š</strong>åˆ›å»ºä¸€ä¸ªåç§°ä¸ºâ€œUpdateDataNoConditionâ€çš„å­˜å‚¨è¿‡ç¨‹ã€‚ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DELIMITER //<br><br>CREATE PROCEDURE UpdateDataNoCondition()<br>BEGIN<br>SET @x = 1; #å®šä¹‰ç”¨æˆ·ä¼šè¯å˜é‡ï¼Œä¸»è¦æ˜¯æƒ³æ£€æµ‹ç¨‹åºæ‰§è¡Œåˆ°äº†å“ªé‡Œ<br>UPDATE employees SET email = NULL WHERE last_name = &#x27;Abel&#x27;;<br>SET @x = 2;<br>UPDATE employees SET email = &#x27;aabbel&#x27; WHERE last_name = &#x27;Abel&#x27;;<br>SET @x = 3;<br>END //<br><br>DELIMITER ;<br></code></pre></td></tr></table></figure><p>è°ƒç”¨å­˜å‚¨è¿‡ç¨‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; CALL UpdateDataNoCondition();<br>ERROR 1048 (23000): Column &#x27;email&#x27; cannot be null<br><br>mysql&gt; SELECT @x;<br>+------+<br>| @x   |<br>+------+<br>|   1  |<br>+------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œæ­¤æ—¶@xå˜é‡çš„å€¼ä¸º1ã€‚ç»“åˆåˆ›å»ºå­˜å‚¨è¿‡ç¨‹çš„SQLè¯­å¥ä»£ç å¯ä»¥å¾—å‡ºï¼šåœ¨å­˜å‚¨è¿‡ç¨‹ä¸­æœªå®šä¹‰æ¡ä»¶å’Œå¤„ç†ç¨‹åºï¼Œä¸”å½“å­˜å‚¨è¿‡ç¨‹ä¸­æ‰§è¡Œçš„SQLè¯­å¥æŠ¥é”™æ—¶ï¼ŒMySQLæ•°æ®åº“ä¼šæŠ›å‡ºé”™è¯¯ï¼Œå¹¶é€€å‡ºå½“å‰SQLé€»è¾‘ï¼Œä¸å†å‘ä¸‹ç»§ç»­æ‰§è¡Œã€‚</p><h3 id="2-2-å®šä¹‰æ¡ä»¶"><a href="#2-2-å®šä¹‰æ¡ä»¶" class="headerlink" title="2.2 å®šä¹‰æ¡ä»¶"></a>2.2 å®šä¹‰æ¡ä»¶</h3><p>å®šä¹‰æ¡ä»¶å°±æ˜¯ç»™MySQLä¸­çš„é”™è¯¯ç å‘½åï¼Œè¿™æœ‰åŠ©äºå­˜å‚¨çš„ç¨‹åºä»£ç æ›´æ¸…æ™°ã€‚å®ƒå°†ä¸€ä¸ª<code>é”™è¯¯åå­—</code>å’Œ<code>æŒ‡å®šçš„é”™è¯¯æ¡ä»¶</code>å…³è”èµ·æ¥ã€‚è¿™ä¸ªåå­—å¯ä»¥éšåè¢«ç”¨åœ¨å®šä¹‰å¤„ç†ç¨‹åºçš„<code>DECLARE HANDLER</code>è¯­å¥ä¸­ã€‚</p><p>å®šä¹‰æ¡ä»¶ä½¿ç”¨DECLAREè¯­å¥ï¼Œè¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DECLARE é”™è¯¯åç§° CONDITION FOR é”™è¯¯ç ;<br>#æˆ–è€…<br>DECLARE é”™è¯¯åç§° CONDITION FOR SQLSTATE &#x27;é”™è¯¯æ¡ä»¶&#x27;; #é”™è¯¯æ¡ä»¶æ˜¯å­—ç¬¦ä¸²ï¼Œéœ€è¦åŠ ä¸Š&#x27;&#x27;ï¼Œé˜²æ­¢è¢«è½¬æ¢ä¸ºå…¶ä»–æ•°æ®ç±»å‹<br></code></pre></td></tr></table></figure><p>é”™è¯¯ç çš„è¯´æ˜ï¼š</p><ul><li><code>MySQL_error_code</code>å’Œ<code>sqlstate_value</code>éƒ½å¯ä»¥è¡¨ç¤ºMySQLçš„é”™è¯¯ã€‚<ul><li>MySQL_error_codeæ˜¯æ•°å€¼ç±»å‹é”™è¯¯ä»£ç ã€‚</li><li>sqlstate_valueæ˜¯é•¿åº¦ä¸º5çš„å­—ç¬¦ä¸²ç±»å‹é”™è¯¯ä»£ç ã€‚</li></ul></li><li>ä¾‹å¦‚ï¼Œåœ¨ERROR 1418 (HY000)ä¸­ï¼Œ1418æ˜¯MySQL_error_codeï¼Œâ€™HY000â€™æ˜¯sqlstate_valueã€‚</li><li>ä¾‹å¦‚ï¼Œåœ¨ERROR 1142ï¼ˆ42000ï¼‰ä¸­ï¼Œ1142æ˜¯MySQL_error_codeï¼Œâ€™42000â€™æ˜¯sqlstate_valueã€‚</li></ul><p><strong>ä¸¾ä¾‹1ï¼š</strong>å®šä¹‰â€œField_Not_Be_NULLâ€é”™è¯¯åä¸MySQLä¸­è¿åéç©ºçº¦æŸçš„é”™è¯¯ç±»å‹æ˜¯â€œERROR 1048 (23000)â€å¯¹åº”ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#ä½¿ç”¨MySQL_error_code<br>DECLARE Field_Not_Be_NULL CONDITION FOR 1048;<br><br>#ä½¿ç”¨sqlstate_value<br>DECLARE Field_Not_Be_NULL CONDITION FOR SQLSTATE &#x27;23000&#x27;;<br></code></pre></td></tr></table></figure><p><strong>ä¸¾ä¾‹2ï¼š</strong>å®šä¹‰â€ERROR 1148(42000)â€é”™è¯¯ï¼Œåç§°ä¸ºcommand_not_allowedã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#ä½¿ç”¨MySQL_error_code<br>DECLARE command_not_allowed CONDITION FOR 1148;<br><br>#ä½¿ç”¨sqlstate_value<br>DECLARE command_not_allowed CONDITION FOR SQLSTATE &#x27;42000&#x27;;<br></code></pre></td></tr></table></figure><h3 id="2-3-å®šä¹‰å¤„ç†ç¨‹åº"><a href="#2-3-å®šä¹‰å¤„ç†ç¨‹åº" class="headerlink" title="2.3 å®šä¹‰å¤„ç†ç¨‹åº"></a>2.3 å®šä¹‰å¤„ç†ç¨‹åº</h3><p>å¯ä»¥ä¸ºSQLæ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿçš„æŸç§ç±»å‹çš„é”™è¯¯å®šä¹‰ç‰¹æ®Šçš„å¤„ç†ç¨‹åºã€‚å®šä¹‰å¤„ç†ç¨‹åºæ—¶ï¼Œä½¿ç”¨DECLAREè¯­å¥çš„è¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DECLARE å¤„ç†æ–¹å¼ HANDLER FOR é”™è¯¯ç±»å‹ å¤„ç†è¯­å¥<br></code></pre></td></tr></table></figure><ul><li><strong>å¤„ç†æ–¹å¼</strong>ï¼šå¤„ç†æ–¹å¼æœ‰3ä¸ªå–å€¼ï¼šCONTINUEã€EXITã€UNDOã€‚<ul><li><code>CONTINUE</code>ï¼šè¡¨ç¤ºé‡åˆ°é”™è¯¯ä¸å¤„ç†ï¼Œç»§ç»­æ‰§è¡Œã€‚</li><li><code>EXIT</code>ï¼šè¡¨ç¤ºé‡åˆ°é”™è¯¯é©¬ä¸Šé€€å‡ºã€‚</li><li><code>UNDO</code>ï¼šè¡¨ç¤ºé‡åˆ°é”™è¯¯åæ’¤å›ä¹‹å‰çš„æ“ä½œã€‚MySQLä¸­æš‚æ—¶ä¸æ”¯æŒè¿™æ ·çš„æ“ä½œã€‚</li></ul></li><li><strong>é”™è¯¯ç±»å‹</strong>ï¼ˆå³æ¡ä»¶ï¼‰å¯ä»¥æœ‰å¦‚ä¸‹å–å€¼ï¼š<ul><li><code>SQLSTATE &#39;å­—ç¬¦ä¸²é”™è¯¯ç &#39;</code>ï¼šè¡¨ç¤ºé•¿åº¦ä¸º5çš„sqlstate_valueç±»å‹çš„é”™è¯¯ä»£ç ï¼›</li><li><code>MySQL_error_code</code>ï¼šåŒ¹é…æ•°å€¼ç±»å‹é”™è¯¯ä»£ç ï¼›</li><li><code>é”™è¯¯åç§°</code>ï¼šè¡¨ç¤ºDECLARE â€¦ CONDITIONå®šä¹‰çš„é”™è¯¯æ¡ä»¶åç§°ã€‚</li><li><code>SQLWARNING</code>ï¼šåŒ¹é…æ‰€æœ‰ä»¥01å¼€å¤´çš„sqlstate_valueé”™è¯¯ä»£ç ï¼›</li><li><code>NOT FOUND</code>ï¼šåŒ¹é…æ‰€æœ‰ä»¥02å¼€å¤´çš„sqlstate_valueé”™è¯¯ä»£ç ï¼›</li><li><code>SQLEXCEPTION</code>ï¼šåŒ¹é…æ‰€æœ‰æ²¡æœ‰è¢«SQLWARNINGæˆ–NOT FOUNDæ•è·çš„sqlstate_valueé”™è¯¯ä»£ç ï¼›</li></ul></li><li><strong>å¤„ç†è¯­å¥</strong>ï¼šå¦‚æœå‡ºç°ä¸Šè¿°æ¡ä»¶ä¹‹ä¸€ï¼Œåˆ™é‡‡ç”¨å¯¹åº”çš„å¤„ç†æ–¹å¼ï¼Œå¹¶æ‰§è¡ŒæŒ‡å®šçš„å¤„ç†è¯­å¥ã€‚è¯­å¥å¯ä»¥æ˜¯åƒâ€œ<code>SET å˜é‡ = å€¼</code>â€è¿™æ ·çš„ç®€å•è¯­å¥ï¼Œä¹Ÿå¯ä»¥æ˜¯ä½¿ç”¨<code>BEGIN ... END</code>ç¼–å†™çš„å¤åˆè¯­å¥ã€‚</li></ul><p>å®šä¹‰å¤„ç†ç¨‹åºçš„å‡ ç§æ–¹å¼ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#æ–¹æ³•1ï¼šæ•è·sqlstate_value<br>DECLARE CONTINUE HANDLER FOR SQLSTATE &#x27;42S02&#x27; SET @info = &#x27;NO_SUCH_TABLE&#x27;;<br><br>#æ–¹æ³•2ï¼šæ•è·mysql_error_value<br>DECLARE CONTINUE HANDLER FOR 1146 SET @info = &#x27;NO_SUCH_TABLE&#x27;;<br><br>#æ–¹æ³•3ï¼šå…ˆå®šä¹‰æ¡ä»¶ï¼Œå†è°ƒç”¨<br>DECLARE no_such_table CONDITION FOR 1146;<br>DECLARE CONTINUE HANDLER FOR NO_SUCH_TABLE SET @info = &#x27;NO_SUCH_TABLE&#x27;;<br><br>#æ–¹æ³•4ï¼šä½¿ç”¨SQLWARNING<br>DECLARE EXIT HANDLER FOR SQLWARNING SET @info = &#x27;ERROR&#x27;;<br><br>#æ–¹æ³•5ï¼šä½¿ç”¨NOT FOUND<br>DECLARE EXIT HANDLER FOR NOT FOUND SET @info = &#x27;NO_SUCH_TABLE&#x27;;<br><br>#æ–¹æ³•6ï¼šä½¿ç”¨SQLEXCEPTION<br>DECLARE EXIT HANDLER FOR SQLEXCEPTION SET @info = &#x27;ERROR&#x27;;<br></code></pre></td></tr></table></figure><h3 id="2-4-æ¡ˆä¾‹è§£å†³"><a href="#2-4-æ¡ˆä¾‹è§£å†³" class="headerlink" title="2.4 æ¡ˆä¾‹è§£å†³"></a>2.4 æ¡ˆä¾‹è§£å†³</h3><p>åœ¨å­˜å‚¨è¿‡ç¨‹ä¸­ï¼Œå®šä¹‰å¤„ç†ç¨‹åºï¼Œæ•è·MySQL_error_codeå€¼ï¼Œå½“é‡åˆ°MySQL_error_codeå€¼ä¸º1048æ—¶ï¼Œæ‰§è¡ŒCONTINUEæ“ä½œï¼Œå¹¶ä¸”å°†@proc_valueçš„å€¼è®¾ç½®ä¸º-1ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DELIMITER //<br><br>CREATE PROCEDURE UpdateDataNoCondition()<br>BEGIN<br>#å®šä¹‰å¤„ç†ç¨‹åº<br>DECLARE CONTINUE HANDLER FOR 1048 SET @proc_value = -1;<br><br>SET @x = 1;<br>UPDATE employees SET email = NULL WHERE last_name = &#x27;Abel&#x27;;<br>SET @x = 2;<br>UPDATE employees SET email = &#x27;aabbel&#x27; WHERE last_name = &#x27;Abel&#x27;;<br>SET @x = 3;<br>END //<br><br>DELIMITER ;<br></code></pre></td></tr></table></figure><p>è°ƒç”¨è¿‡ç¨‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; CALL UpdateDataWithCondition();<br>Query OK, 0 rows affected (0.01 sec)<br><br>mysql&gt; SELECT @x,@proc_value;<br>+------+-------------+<br>| @x   | @proc_value |<br>+------+-------------+<br>|    3 |        -1  |<br>+------+-------------+<br>1 row in set (0.00 sec)<br><br></code></pre></td></tr></table></figure><p><strong>ä¸¾ä¾‹ï¼š</strong></p><p>åˆ›å»ºä¸€ä¸ªåç§°ä¸ºâ€œInsertDataWithConditionâ€çš„å­˜å‚¨è¿‡ç¨‹ï¼Œä»£ç å¦‚ä¸‹ã€‚</p><p>åœ¨å­˜å‚¨è¿‡ç¨‹ä¸­ï¼Œå®šä¹‰å¤„ç†ç¨‹åºï¼Œæ•è·sqlstate_valueå€¼ï¼Œå½“é‡åˆ°sqlstate_valueå€¼ä¸º23000æ—¶ï¼Œæ‰§è¡ŒEXITæ“ä½œï¼Œå¹¶ä¸”å°†@proc_valueçš„å€¼è®¾ç½®ä¸º-1ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#å‡†å¤‡å·¥ä½œ<br>CREATE TABLE departments<br>AS<br>SELECT * FROM atguigudb.`departments`;<br><br>ALTER TABLE departments<br>ADD CONSTRAINT uk_dept_name UNIQUE(department_id);<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DELIMITER //<br><br>CREATE PROCEDURE InsertDataWithCondition()<br>BEGIN<br>DECLARE duplicate_entry CONDITION FOR SQLSTATE &#x27;23000&#x27; ;<br>DECLARE EXIT HANDLER FOR duplicate_entry SET @proc_value = -1;<br><br>SET @x = 1;<br>INSERT INTO departments(department_name) VALUES(&#x27;æµ‹è¯•&#x27;);<br>SET @x = 2;<br>INSERT INTO departments(department_name) VALUES(&#x27;æµ‹è¯•&#x27;);<br>SET @x = 3;<br>END //<br><br>DELIMITER ;<br></code></pre></td></tr></table></figure><p>è°ƒç”¨å­˜å‚¨è¿‡ç¨‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; CALL InsertDataWithCondition();<br>Query OK, 0 rows affected (0.01 sec)<br><br>mysql&gt; SELECT @x,@proc_value;<br>+------+-------------+<br>| @x   | @proc_value |<br>+------+-------------+<br>|    2 |        -1  |<br>+------+-------------+<br>1 row in set (0.00 sec)<br><br></code></pre></td></tr></table></figure><h2 id="3-æµç¨‹æ§åˆ¶"><a href="#3-æµç¨‹æ§åˆ¶" class="headerlink" title="3. æµç¨‹æ§åˆ¶"></a>3. æµç¨‹æ§åˆ¶</h2><p>è§£å†³å¤æ‚é—®é¢˜ä¸å¯èƒ½é€šè¿‡ä¸€ä¸ª SQL è¯­å¥å®Œæˆï¼Œæˆ‘ä»¬éœ€è¦æ‰§è¡Œå¤šä¸ª SQL æ“ä½œã€‚æµç¨‹æ§åˆ¶è¯­å¥çš„ä½œç”¨å°±æ˜¯æ§åˆ¶å­˜å‚¨è¿‡ç¨‹ä¸­ SQL è¯­å¥çš„æ‰§è¡Œé¡ºåºï¼Œæ˜¯æˆ‘ä»¬å®Œæˆå¤æ‚æ“ä½œå¿…ä¸å¯å°‘çš„ä¸€éƒ¨åˆ†ã€‚åªè¦æ˜¯æ‰§è¡Œçš„ç¨‹åºï¼Œæµç¨‹å°±åˆ†ä¸ºä¸‰å¤§ç±»ï¼š</p><ul><li><code>é¡ºåºç»“æ„</code>ï¼šç¨‹åºä»ä¸Šå¾€ä¸‹ä¾æ¬¡æ‰§è¡Œ</li><li><code>åˆ†æ”¯ç»“æ„</code>ï¼šç¨‹åºæŒ‰æ¡ä»¶è¿›è¡Œé€‰æ‹©æ‰§è¡Œï¼Œä»ä¸¤æ¡æˆ–å¤šæ¡è·¯å¾„ä¸­é€‰æ‹©ä¸€æ¡æ‰§è¡Œ</li><li><code>å¾ªç¯ç»“æ„</code>ï¼šç¨‹åºæ»¡è¶³ä¸€å®šæ¡ä»¶ä¸‹ï¼Œé‡å¤æ‰§è¡Œä¸€ç»„è¯­å¥</li></ul><p>é’ˆå¯¹äºMySQL çš„æµç¨‹æ§åˆ¶è¯­å¥ä¸»è¦æœ‰ 3 ç±»ã€‚æ³¨æ„ï¼šåªèƒ½ç”¨äºå­˜å‚¨ç¨‹åºã€‚</p><ul><li><code>æ¡ä»¶åˆ¤æ–­è¯­å¥</code>ï¼šIF è¯­å¥å’Œ CASE è¯­å¥</li><li><code>å¾ªç¯è¯­å¥</code>ï¼šLOOPã€WHILE å’Œ REPEAT è¯­å¥</li><li><code>è·³è½¬è¯­å¥</code>ï¼šITERATE å’Œ LEAVE è¯­å¥</li></ul><h3 id="3-1-åˆ†æ”¯ç»“æ„ä¹‹-IF"><a href="#3-1-åˆ†æ”¯ç»“æ„ä¹‹-IF" class="headerlink" title="3.1 åˆ†æ”¯ç»“æ„ä¹‹ IF"></a>3.1 åˆ†æ”¯ç»“æ„ä¹‹ IF</h3><ul><li>IF è¯­å¥çš„è¯­æ³•ç»“æ„æ˜¯ï¼š</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">IF è¡¨è¾¾å¼1 THEN æ“ä½œ1<br>[ELSEIF è¡¨è¾¾å¼2 THEN æ“ä½œ2]â€¦â€¦<br>[ELSE æ“ä½œN] #æ³¨æ„æœ€åä¸€ä¸ªELSEæ²¡æœ‰è¡¨è¾¾å¼ï¼Œå› ä¸ºæ²¡æœ‰è¡¨è¾¾å¼æ‰€ä»¥æ²¡æœ‰THEN<br>END IF<br></code></pre></td></tr></table></figure><p>æ ¹æ®è¡¨è¾¾å¼çš„ç»“æœä¸ºTRUEæˆ–FALSEæ‰§è¡Œç›¸åº”çš„è¯­å¥ã€‚è¿™é‡Œâ€œ[]â€ä¸­çš„å†…å®¹æ˜¯å¯é€‰çš„ã€‚</p><ul><li><p>ç‰¹ç‚¹ï¼šâ‘  ä¸åŒçš„è¡¨è¾¾å¼å¯¹åº”ä¸åŒçš„æ“ä½œ â‘¡ ä½¿ç”¨åœ¨begin endä¸­</p></li><li><p><strong>ä¸¾ä¾‹1ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">IF val IS NULL <br>THEN SELECT &#x27;val is null&#x27;;<br>ELSE SELECT &#x27;val is not null&#x27;;<br><br>END IF;<br></code></pre></td></tr></table></figure></li><li><p><strong>ä¸¾ä¾‹2ï¼š</strong>å£°æ˜å­˜å‚¨è¿‡ç¨‹â€œupdate_salary_by_eid1â€ï¼Œå®šä¹‰INå‚æ•°emp_idï¼Œè¾“å…¥å‘˜å·¥ç¼–å·ã€‚åˆ¤æ–­è¯¥å‘˜å·¥è–ªèµ„å¦‚æœä½äº8000å…ƒå¹¶ä¸”å…¥èŒæ—¶é—´è¶…è¿‡5å¹´ï¼Œå°±æ¶¨è–ª500å…ƒï¼›å¦åˆ™å°±ä¸å˜ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DELIMITER //<br><br>CREATE PROCEDURE update_salary_by_eid1(IN emp_id INT)<br>BEGIN<br>DECLARE emp_salary DOUBLE;<br>DECLARE hire_year DOUBLE;<br><br>SELECT salary INTO emp_salary FROM employees WHERE employee_id = emp_id;<br><br>SELECT DATEDIFF(CURDATE(),hire_date)/365 INTO hire_year<br>FROM employees WHERE employee_id = emp_id;<br><br>IF emp_salary &lt; 8000 AND hire_year &gt; 5<br>THEN UPDATE employees SET salary = salary + 500 WHERE employee_id = emp_id;<br>END IF;<br>END //<br><br><br>DELIMITER ;<br></code></pre></td></tr></table></figure></li><li><p><strong>ä¸¾ä¾‹3ï¼š</strong>å£°æ˜å­˜å‚¨è¿‡ç¨‹â€œupdate_salary_by_eid2â€ï¼Œå®šä¹‰INå‚æ•°emp_idï¼Œè¾“å…¥å‘˜å·¥ç¼–å·ã€‚åˆ¤æ–­è¯¥å‘˜å·¥è–ªèµ„å¦‚æœä½äº9000å…ƒå¹¶ä¸”å…¥èŒæ—¶é—´è¶…è¿‡5å¹´ï¼Œå°±æ¶¨è–ª500å…ƒï¼›å¦åˆ™å°±æ¶¨è–ª100å…ƒã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DELIMITER //<br><br>CREATE PROCEDURE update_salary_by_eid2(IN emp_id INT)<br>BEGIN<br>DECLARE emp_salary DOUBLE;<br>DECLARE hire_year DOUBLE;<br><br>SELECT salary INTO emp_salary FROM employees WHERE employee_id = emp_id;<br><br>SELECT DATEDIFF(CURDATE(),hire_date)/365 INTO hire_year<br>FROM employees WHERE employee_id = emp_id;<br><br>IF emp_salary &lt; 8000 AND hire_year &gt; 5<br>THEN UPDATE employees SET salary = salary + 500 WHERE employee_id = emp_id;<br>ELSE <br>UPDATE employees SET salary = salary + 100 WHERE employee_id = emp_id;<br>END IF;<br>END //<br><br><br>DELIMITER ;<br></code></pre></td></tr></table></figure></li><li><p><strong>ä¸¾ä¾‹4ï¼š</strong>å£°æ˜å­˜å‚¨è¿‡ç¨‹â€œupdate_salary_by_eid3â€ï¼Œå®šä¹‰INå‚æ•°emp_idï¼Œè¾“å…¥å‘˜å·¥ç¼–å·ã€‚åˆ¤æ–­è¯¥å‘˜å·¥è–ªèµ„å¦‚æœä½äº9000å…ƒï¼Œå°±æ›´æ–°è–ªèµ„ä¸º9000å…ƒï¼›è–ªèµ„å¦‚æœå¤§äºç­‰äº9000å…ƒä¸”ä½äº10000çš„ï¼Œä½†æ˜¯å¥–é‡‘æ¯”ä¾‹ä¸ºNULLçš„ï¼Œå°±æ›´æ–°å¥–é‡‘æ¯”ä¾‹ä¸º0.01ï¼›å…¶ä»–çš„æ¶¨è–ª100å…ƒã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DELIMITER //<br><br>CREATE PROCEDURE update_salary_by_eid3(IN emp_id INT)<br>BEGIN<br>DECLARE emp_salary DOUBLE;<br>DECLARE bonus DECIMAL(3,2);<br><br>SELECT salary INTO emp_salary FROM employees WHERE employee_id = emp_id;<br>SELECT commission_pct INTO bonus FROM employees WHERE employee_id = emp_id;<br><br>IF emp_salary &lt; 9000<br>THEN UPDATE employees SET salary = 9000 WHERE employee_id = emp_id;<br>ELSEIF emp_salary &lt; 10000 AND bonus IS NULL<br>THEN UPDATE employees SET commission_pct = 0.01 WHERE employee_id = emp_id;<br>ELSE<br>UPDATE employees SET salary = salary + 100 WHERE employee_id = emp_id;<br>END IF;<br>END //<br><br>DELIMITER ;<br></code></pre></td></tr></table></figure></li></ul><h3 id="3-2-åˆ†æ”¯ç»“æ„ä¹‹-CASE"><a href="#3-2-åˆ†æ”¯ç»“æ„ä¹‹-CASE" class="headerlink" title="3.2 åˆ†æ”¯ç»“æ„ä¹‹ CASE"></a>3.2 åˆ†æ”¯ç»“æ„ä¹‹ CASE</h3><p>CASE è¯­å¥çš„è¯­æ³•ç»“æ„1ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#æƒ…å†µä¸€ï¼šç±»ä¼¼äºswitch<br>CASE è¡¨è¾¾å¼<br>WHEN å€¼1 THEN ç»“æœ1æˆ–è¯­å¥1(å¦‚æœæ˜¯è¯­å¥ï¼Œéœ€è¦åŠ åˆ†å·) <br>WHEN å€¼2 THEN ç»“æœ2æˆ–è¯­å¥2(å¦‚æœæ˜¯è¯­å¥ï¼Œéœ€è¦åŠ åˆ†å·)<br>...<br>[ELSE ç»“æœnæˆ–è¯­å¥n(å¦‚æœæ˜¯è¯­å¥ï¼Œéœ€è¦åŠ åˆ†å·)]<br>END [case]ï¼ˆå¦‚æœæ˜¯æ”¾åœ¨begin endä¸­éœ€è¦åŠ ä¸Šcaseï¼Œå¦‚æœæ”¾åœ¨selectåé¢ä¸éœ€è¦ï¼‰<br></code></pre></td></tr></table></figure><p>CASE è¯­å¥çš„è¯­æ³•ç»“æ„2ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#æƒ…å†µäºŒï¼šç±»ä¼¼äºå¤šé‡if<br>CASE <br>WHEN æ¡ä»¶1 THEN ç»“æœ1æˆ–è¯­å¥1(å¦‚æœæ˜¯è¯­å¥ï¼Œéœ€è¦åŠ åˆ†å·) <br>WHEN æ¡ä»¶2 THEN ç»“æœ2æˆ–è¯­å¥2(å¦‚æœæ˜¯è¯­å¥ï¼Œéœ€è¦åŠ åˆ†å·)<br>...<br>[ELSE ç»“æœnæˆ–è¯­å¥n(å¦‚æœæ˜¯è¯­å¥ï¼Œéœ€è¦åŠ åˆ†å·)]<br>END [case]ï¼ˆå¦‚æœæ˜¯æ”¾åœ¨begin endä¸­éœ€è¦åŠ ä¸Šcaseï¼Œå¦‚æœæ”¾åœ¨selectåé¢ä¸éœ€è¦ï¼‰<br></code></pre></td></tr></table></figure><ul><li><strong>ä¸¾ä¾‹1ï¼š</strong></li></ul><p>ä½¿ç”¨CASEæµç¨‹æ§åˆ¶è¯­å¥çš„ç¬¬1ç§æ ¼å¼ï¼Œåˆ¤æ–­valå€¼ç­‰äº1ã€ç­‰äº2ï¼Œæˆ–è€…ä¸¤è€…éƒ½ä¸ç­‰ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CASE val<br>ã€€ã€€ã€€WHEN 1 THEN SELECT &#x27;val is 1&#x27;;<br>ã€€ã€€ã€€WHEN 2 THEN SELECT &#x27;val is 2&#x27;;<br>ã€€ã€€ã€€ELSE SELECT &#x27;val is not 1 or 2&#x27;;<br>END CASE;<br></code></pre></td></tr></table></figure><ul><li><strong>ä¸¾ä¾‹2ï¼š</strong></li></ul><p>ä½¿ç”¨CASEæµç¨‹æ§åˆ¶è¯­å¥çš„ç¬¬2ç§æ ¼å¼ï¼Œåˆ¤æ–­valæ˜¯å¦ä¸ºç©ºã€å°äº0ã€å¤§äº0æˆ–è€…ç­‰äº0ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CASE<br>WHEN val IS NULL THEN SELECT &#x27;val is null&#x27;;<br>WHEN val &lt; 0 THEN SELECT &#x27;val is less than 0&#x27;;<br>WHEN val &gt; 0 THEN SELECT &#x27;val is greater than 0&#x27;;<br>ELSE SELECT &#x27;val is 0&#x27;;<br>END CASE;<br></code></pre></td></tr></table></figure><ul><li><strong>ä¸¾ä¾‹3ï¼š</strong>å£°æ˜å­˜å‚¨è¿‡ç¨‹â€œupdate_salary_by_eid4â€ï¼Œå®šä¹‰INå‚æ•°emp_idï¼Œè¾“å…¥å‘˜å·¥ç¼–å·ã€‚åˆ¤æ–­è¯¥å‘˜å·¥è–ªèµ„å¦‚æœä½äº9000å…ƒï¼Œå°±æ›´æ–°è–ªèµ„ä¸º9000å…ƒï¼›è–ªèµ„å¤§äºç­‰äº9000å…ƒä¸”ä½äº10000çš„ï¼Œä½†æ˜¯å¥–é‡‘æ¯”ä¾‹ä¸ºNULLçš„ï¼Œå°±æ›´æ–°å¥–é‡‘æ¯”ä¾‹ä¸º0.01ï¼›å…¶ä»–çš„æ¶¨è–ª100å…ƒã€‚</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DELIMITER //<br><br>CREATE PROCEDURE update_salary_by_eid4(IN emp_id INT)<br>BEGIN<br>DECLARE emp_sal DOUBLE;<br>DECLARE bonus DECIMAL(3,2);<br><br>SELECT salary INTO emp_sal FROM employees WHERE employee_id = emp_id;<br>SELECT commission_pct INTO bonus FROM employees WHERE employee_id = emp_id;<br><br>CASE<br>WHEN emp_sal&lt;9000<br>THEN UPDATE employees SET salary=9000 WHERE employee_id = emp_id;<br>WHEN emp_sal&lt;10000 AND bonus IS NULL<br>THEN UPDATE employees SET commission_pct=0.01 WHERE employee_id = emp_id;<br>ELSE<br>UPDATE employees SET salary=salary+100 WHERE employee_id = emp_id;<br>END CASE;<br>END //<br><br>DELIMITER ;<br></code></pre></td></tr></table></figure><ul><li>ä¸¾ä¾‹4ï¼šå£°æ˜å­˜å‚¨è¿‡ç¨‹update_salary_by_eid5ï¼Œå®šä¹‰INå‚æ•°emp_idï¼Œè¾“å…¥å‘˜å·¥ç¼–å·ã€‚åˆ¤æ–­è¯¥å‘˜å·¥çš„å…¥èŒå¹´é™ï¼Œå¦‚æœæ˜¯0å¹´ï¼Œè–ªèµ„æ¶¨50ï¼›å¦‚æœæ˜¯1å¹´ï¼Œè–ªèµ„æ¶¨100ï¼›å¦‚æœæ˜¯2å¹´ï¼Œè–ªèµ„æ¶¨200ï¼›å¦‚æœæ˜¯3å¹´ï¼Œè–ªèµ„æ¶¨300ï¼›å¦‚æœæ˜¯4å¹´ï¼Œè–ªèµ„æ¶¨400ï¼›å…¶ä»–çš„æ¶¨è–ª500ã€‚</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DELIMITER //<br><br>CREATE PROCEDURE update_salary_by_eid5(IN emp_id INT)<br>BEGIN<br>DECLARE emp_sal DOUBLE;<br>DECLARE hire_year DOUBLE;<br><br>SELECT salary INTO emp_sal FROM employees WHERE employee_id = emp_id;<br><br>SELECT ROUND(DATEDIFF(CURDATE(),hire_date)/365, 0) INTO hire_year FROM employees WHERE employee_id = emp_id;<br><br>CASE hire_year<br>WHEN 0 THEN UPDATE employees SET salary=salary+50 WHERE employee_id = emp_id;<br>WHEN 1 THEN UPDATE employees SET salary=salary+100 WHERE employee_id = emp_id;<br>WHEN 2 THEN UPDATE employees SET salary=salary+200 WHERE employee_id = emp_id;<br>WHEN 3 THEN UPDATE employees SET salary=salary+300 WHERE employee_id = emp_id;<br>WHEN 4 THEN UPDATE employees SET salary=salary+400 WHERE employee_id = emp_id;<br>ELSE UPDATE employees SET salary=salary+500 WHERE employee_id = emp_id;<br>END CASE;<br>END //<br><br>DELIMITER ;<br></code></pre></td></tr></table></figure><h3 id="3-3-å¾ªç¯ç»“æ„ä¹‹LOOP"><a href="#3-3-å¾ªç¯ç»“æ„ä¹‹LOOP" class="headerlink" title="3.3 å¾ªç¯ç»“æ„ä¹‹LOOP"></a>3.3 å¾ªç¯ç»“æ„ä¹‹LOOP</h3><p>LOOPå¾ªç¯è¯­å¥ç”¨æ¥é‡å¤æ‰§è¡ŒæŸäº›è¯­å¥ã€‚LOOPå†…çš„è¯­å¥ä¸€ç›´é‡å¤æ‰§è¡Œç›´åˆ°å¾ªç¯è¢«é€€å‡ºï¼ˆä½¿ç”¨LEAVEå­å¥ï¼‰ï¼Œè·³å‡ºå¾ªç¯è¿‡ç¨‹ã€‚</p><p>LOOPè¯­å¥çš„åŸºæœ¬æ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">[loop_label:] LOOP<br>å¾ªç¯æ‰§è¡Œçš„è¯­å¥<br>END LOOP [loop_label]<br></code></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œloop_labelè¡¨ç¤ºLOOPè¯­å¥çš„æ ‡æ³¨åç§°ï¼Œè¯¥å‚æ•°å¯ä»¥çœç•¥ã€‚</p><p><strong>ä¸¾ä¾‹1ï¼š</strong></p><p>ä½¿ç”¨LOOPè¯­å¥è¿›è¡Œå¾ªç¯æ“ä½œï¼Œidå€¼å°äº10æ—¶å°†é‡å¤æ‰§è¡Œå¾ªç¯è¿‡ç¨‹ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DECLARE id INT DEFAULT 0;<br>add_loop:LOOP<br>SET id = id +1;<br>IF id &gt;= 10 THEN LEAVE add_loop;<br>END IF;<br><br>END LOOP add_loop;<br></code></pre></td></tr></table></figure><p><strong>ä¸¾ä¾‹2ï¼š</strong>å½“å¸‚åœºç¯å¢ƒå˜å¥½æ—¶ï¼Œå…¬å¸ä¸ºäº†å¥–åŠ±å¤§å®¶ï¼Œå†³å®šç»™å¤§å®¶æ¶¨å·¥èµ„ã€‚å£°æ˜å­˜å‚¨è¿‡ç¨‹â€œupdate_salary_loop()â€ï¼Œå£°æ˜OUTå‚æ•°numï¼Œè¾“å‡ºå¾ªç¯æ¬¡æ•°ã€‚å­˜å‚¨è¿‡ç¨‹ä¸­å®ç°å¾ªç¯ç»™å¤§å®¶æ¶¨è–ªï¼Œè–ªèµ„æ¶¨ä¸ºåŸæ¥çš„1.1å€ã€‚ç›´åˆ°å…¨å…¬å¸çš„å¹³å‡è–ªèµ„è¾¾åˆ°12000ç»“æŸã€‚å¹¶ç»Ÿè®¡å¾ªç¯æ¬¡æ•°ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DELIMITER //<br><br>CREATE PROCEDURE update_salary_loop(OUT num INT)<br>BEGIN<br>DECLARE avg_salary DOUBLE;<br>DECLARE loop_count INT DEFAULT 0;<br><br>SELECT AVG(salary) INTO avg_salary FROM employees;<br><br>label_loop:LOOP<br>IF avg_salary &gt;= 12000 THEN LEAVE label_loop;<br>END IF;<br><br>UPDATE employees SET salary = salary * 1.1;<br>SET loop_count = loop_count + 1;<br>SELECT AVG(salary) INTO avg_salary FROM employees;<br>END LOOP label_loop;<br><br>SET num = loop_count;<br><br>END //<br><br>DELIMITER ;<br></code></pre></td></tr></table></figure><h3 id="3-4-å¾ªç¯ç»“æ„ä¹‹WHILE"><a href="#3-4-å¾ªç¯ç»“æ„ä¹‹WHILE" class="headerlink" title="3.4 å¾ªç¯ç»“æ„ä¹‹WHILE"></a>3.4 å¾ªç¯ç»“æ„ä¹‹WHILE</h3><p>WHILEè¯­å¥åˆ›å»ºä¸€ä¸ªå¸¦æ¡ä»¶åˆ¤æ–­çš„å¾ªç¯è¿‡ç¨‹ã€‚WHILEåœ¨æ‰§è¡Œè¯­å¥æ‰§è¡Œæ—¶ï¼Œå…ˆå¯¹æŒ‡å®šçš„è¡¨è¾¾å¼è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœä¸ºçœŸï¼Œå°±æ‰§è¡Œå¾ªç¯å†…çš„è¯­å¥ï¼Œå¦åˆ™é€€å‡ºå¾ªç¯ã€‚WHILEè¯­å¥çš„åŸºæœ¬æ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">[while_label:] WHILE å¾ªç¯æ¡ä»¶  DO<br>å¾ªç¯ä½“<br>END WHILE [while_label];<br></code></pre></td></tr></table></figure><p>while_labelä¸ºWHILEè¯­å¥çš„æ ‡æ³¨åç§°ï¼›å¦‚æœå¾ªç¯æ¡ä»¶ç»“æœä¸ºçœŸï¼ŒWHILEè¯­å¥å†…çš„è¯­å¥æˆ–è¯­å¥ç¾¤è¢«æ‰§è¡Œï¼Œç›´è‡³å¾ªç¯æ¡ä»¶ä¸ºå‡ï¼Œé€€å‡ºå¾ªç¯ã€‚</p><p><strong>ä¸¾ä¾‹1ï¼š</strong></p><p>WHILEè¯­å¥ç¤ºä¾‹ï¼Œiå€¼å°äº10æ—¶ï¼Œå°†é‡å¤æ‰§è¡Œå¾ªç¯è¿‡ç¨‹ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DELIMITER //<br><br>CREATE PROCEDURE test_while()<br>BEGIN<br>DECLARE i INT DEFAULT 0;<br><br>WHILE i &lt; 10 DO<br>SET i = i + 1;<br>END WHILE;<br><br>SELECT i;<br>END //<br><br>DELIMITER ;<br>#è°ƒç”¨<br>CALL test_while();<br></code></pre></td></tr></table></figure><p><strong>ä¸¾ä¾‹2ï¼š</strong>å¸‚åœºç¯å¢ƒä¸å¥½æ—¶ï¼Œå…¬å¸ä¸ºäº†æ¸¡è¿‡éš¾å…³ï¼Œå†³å®šæš‚æ—¶é™ä½å¤§å®¶çš„è–ªèµ„ã€‚å£°æ˜å­˜å‚¨è¿‡ç¨‹â€œupdate_salary_while()â€ï¼Œå£°æ˜OUTå‚æ•°numï¼Œè¾“å‡ºå¾ªç¯æ¬¡æ•°ã€‚å­˜å‚¨è¿‡ç¨‹ä¸­å®ç°å¾ªç¯ç»™å¤§å®¶é™è–ªï¼Œè–ªèµ„é™ä¸ºåŸæ¥çš„90%ã€‚ç›´åˆ°å…¨å…¬å¸çš„å¹³å‡è–ªèµ„è¾¾åˆ°5000ç»“æŸã€‚å¹¶ç»Ÿè®¡å¾ªç¯æ¬¡æ•°ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DELIMITER //<br><br>CREATE PROCEDURE update_salary_while(OUT num INT)<br>BEGIN<br>DECLARE avg_sal DOUBLE ;<br>DECLARE while_count INT DEFAULT 0;<br><br>SELECT AVG(salary) INTO avg_sal FROM employees;<br><br>WHILE avg_sal &gt; 5000 DO<br>UPDATE employees SET salary = salary * 0.9;<br><br>SET while_count = while_count + 1;<br><br>SELECT AVG(salary) INTO avg_sal FROM employees;<br>END WHILE;<br><br>SET num = while_count;<br><br>END //<br><br>DELIMITER ;<br></code></pre></td></tr></table></figure><h3 id="3-5-å¾ªç¯ç»“æ„ä¹‹REPEAT"><a href="#3-5-å¾ªç¯ç»“æ„ä¹‹REPEAT" class="headerlink" title="3.5 å¾ªç¯ç»“æ„ä¹‹REPEAT"></a>3.5 å¾ªç¯ç»“æ„ä¹‹REPEAT</h3><p>REPEATè¯­å¥åˆ›å»ºä¸€ä¸ªå¸¦æ¡ä»¶åˆ¤æ–­çš„å¾ªç¯è¿‡ç¨‹ã€‚ä¸WHILEå¾ªç¯ä¸åŒçš„æ˜¯ï¼ŒREPEAT å¾ªç¯é¦–å…ˆä¼šæ‰§è¡Œä¸€æ¬¡å¾ªç¯ï¼Œç„¶ååœ¨ UNTIL ä¸­è¿›è¡Œè¡¨è¾¾å¼çš„åˆ¤æ–­ï¼Œå¦‚æœ<strong>æ»¡è¶³æ¡ä»¶å°±é€€å‡º</strong>ï¼Œå³ END REPEATï¼›å¦‚æœæ¡ä»¶ä¸æ»¡è¶³ï¼Œåˆ™ä¼šå°±ç»§ç»­æ‰§è¡Œå¾ªç¯ï¼Œç›´åˆ°æ»¡è¶³é€€å‡ºæ¡ä»¶ä¸ºæ­¢ã€‚<strong>è¿™é‡Œçš„REPEATå’Œé«˜çº§è¯­è¨€ä¸­çš„do whileåˆšå¥½ç›¸åï¼ŒREPEATæ»¡è¶³æ¡ä»¶é€€å‡ºï¼Œdo whileæ˜¯æ»¡è¶³æ¡ä»¶æ‰ç»§ç»­ã€‚</strong></p><p>REPEATè¯­å¥çš„åŸºæœ¬æ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">[repeat_label:] REPEAT<br>ã€€ã€€ã€€ã€€å¾ªç¯ä½“çš„è¯­å¥<br>UNTIL ç»“æŸå¾ªç¯çš„æ¡ä»¶è¡¨è¾¾å¼ #æ³¨æ„UNTILè¡¨è¾¾å¼çš„åˆ†å·ä¸è¦åŠ ï¼ŒåŠ ä¸Šåˆ†å·ä¼šæŠ¥é”™<br>END REPEAT [repeat_label]<br></code></pre></td></tr></table></figure><p>repeat_labelä¸ºREPEATè¯­å¥çš„æ ‡æ³¨åç§°ï¼Œè¯¥å‚æ•°å¯ä»¥çœç•¥ï¼›REPEATè¯­å¥å†…çš„è¯­å¥æˆ–è¯­å¥ç¾¤è¢«é‡å¤ï¼Œç›´è‡³expr_conditionä¸ºçœŸã€‚</p><p><strong>ä¸¾ä¾‹1ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DELIMITER //<br><br>CREATE PROCEDURE test_repeat()<br>BEGIN<br>DECLARE i INT DEFAULT 0;<br><br>REPEAT <br>SET i = i + 1;<br>UNTIL i &gt;= 10<br>END REPEAT;<br><br>SELECT i;<br>END //<br><br>DELIMITER ;<br></code></pre></td></tr></table></figure><p><strong>ä¸¾ä¾‹2ï¼š</strong>å½“å¸‚åœºç¯å¢ƒå˜å¥½æ—¶ï¼Œå…¬å¸ä¸ºäº†å¥–åŠ±å¤§å®¶ï¼Œå†³å®šç»™å¤§å®¶æ¶¨å·¥èµ„ã€‚å£°æ˜å­˜å‚¨è¿‡ç¨‹â€œupdate_salary_repeat()â€ï¼Œå£°æ˜OUTå‚æ•°numï¼Œè¾“å‡ºå¾ªç¯æ¬¡æ•°ã€‚å­˜å‚¨è¿‡ç¨‹ä¸­å®ç°å¾ªç¯ç»™å¤§å®¶æ¶¨è–ªï¼Œè–ªèµ„æ¶¨ä¸ºåŸæ¥çš„1.15å€ã€‚ç›´åˆ°å…¨å…¬å¸çš„å¹³å‡è–ªèµ„è¾¾åˆ°13000ç»“æŸã€‚å¹¶ç»Ÿè®¡å¾ªç¯æ¬¡æ•°ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DELIMITER //<br><br>CREATE PROCEDURE update_salary_repeat(OUT num INT)<br>BEGIN<br>DECLARE avg_sal DOUBLE ;<br>DECLARE repeat_count INT DEFAULT 0;<br><br>SELECT AVG(salary) INTO avg_sal FROM employees;<br><br>REPEAT<br>UPDATE employees SET salary = salary * 1.15;<br><br>SET repeat_count = repeat_count + 1;<br><br>SELECT AVG(salary) INTO avg_sal FROM employees;<br>UNTIL avg_sal &gt;= 13000<br>END REPEAT;<br><br>SET num = repeat_count;<br><br>END //<br><br>DELIMITER ;<br></code></pre></td></tr></table></figure><p><strong>å¯¹æ¯”ä¸‰ç§å¾ªç¯ç»“æ„ï¼š</strong></p><p>1ã€è¿™ä¸‰ç§å¾ªç¯éƒ½å¯ä»¥çœç•¥æ ‡ç­¾ï¼Œä½†å¦‚æœå¾ªç¯ä¸­æ·»åŠ äº†å¾ªç¯æ§åˆ¶è¯­å¥ï¼ˆLEAVEæˆ–ITERATEï¼‰åˆ™å¿…é¡»æ·»åŠ æ ‡ç­¾ã€‚<br>2ã€<br>LOOPï¼šä¸€èˆ¬ç”¨äºå®ç°ç®€å•çš„â€æ­»â€å¾ªç¯<br>WHILEï¼šå…ˆåˆ¤æ–­åæ‰§è¡Œ<br>REPEATï¼šå…ˆæ‰§è¡Œååˆ¤æ–­ï¼Œæ— æ¡ä»¶è‡³å°‘æ‰§è¡Œä¸€æ¬¡</p><h3 id="3-6-è·³è½¬è¯­å¥ä¹‹LEAVEè¯­å¥"><a href="#3-6-è·³è½¬è¯­å¥ä¹‹LEAVEè¯­å¥" class="headerlink" title="3.6 è·³è½¬è¯­å¥ä¹‹LEAVEè¯­å¥"></a>3.6 è·³è½¬è¯­å¥ä¹‹LEAVEè¯­å¥</h3><p>LEAVEè¯­å¥ï¼šå¯ä»¥ç”¨åœ¨å¾ªç¯è¯­å¥å†…ï¼Œæˆ–è€…ä»¥ BEGIN å’Œ END åŒ…è£¹èµ·æ¥çš„ç¨‹åºä½“å†…ï¼Œè¡¨ç¤ºè·³å‡ºå¾ªç¯æˆ–è€…è·³å‡ºç¨‹åºä½“çš„æ“ä½œã€‚å¦‚æœä½ æœ‰é¢å‘è¿‡ç¨‹çš„ç¼–ç¨‹è¯­è¨€çš„ä½¿ç”¨ç»éªŒï¼Œä½ å¯ä»¥æŠŠ LEAVE ç†è§£ä¸º breakã€‚</p><p>åŸºæœ¬æ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">LEAVE æ ‡è®°å<br></code></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œlabelå‚æ•°è¡¨ç¤ºå¾ªç¯çš„æ ‡å¿—ã€‚LEAVEå’ŒBEGIN â€¦ ENDæˆ–å¾ªç¯ä¸€èµ·è¢«ä½¿ç”¨ã€‚</p><p><strong>ä¸¾ä¾‹1ï¼š</strong>åˆ›å»ºå­˜å‚¨è¿‡ç¨‹ â€œleave_begin()â€ï¼Œå£°æ˜INTç±»å‹çš„INå‚æ•°numã€‚ç»™BEGINâ€¦ENDåŠ æ ‡è®°åï¼Œå¹¶åœ¨BEGINâ€¦ENDä¸­ä½¿ç”¨IFè¯­å¥åˆ¤æ–­numå‚æ•°çš„å€¼ã€‚</p><ul><li>å¦‚æœnum&lt;=0ï¼Œåˆ™ä½¿ç”¨LEAVEè¯­å¥é€€å‡ºBEGINâ€¦ENDï¼›</li><li>å¦‚æœnum=1ï¼Œåˆ™æŸ¥è¯¢â€œemployeesâ€è¡¨çš„å¹³å‡è–ªèµ„ï¼›</li><li>å¦‚æœnum=2ï¼Œåˆ™æŸ¥è¯¢â€œemployeesâ€è¡¨çš„æœ€ä½è–ªèµ„ï¼›</li><li>å¦‚æœnum&gt;2ï¼Œåˆ™æŸ¥è¯¢â€œemployeesâ€è¡¨çš„æœ€é«˜è–ªèµ„ã€‚</li></ul><p>IFè¯­å¥ç»“æŸåæŸ¥è¯¢â€œemployeesâ€è¡¨çš„æ€»äººæ•°ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DELIMITER //<br><br>CREATE PROCEDURE leave_begin(IN num INT)<br><br>begin_label: BEGIN<br>IF num&lt;=0 <br>THEN LEAVE begin_label;<br>ELSEIF num=1 <br>THEN SELECT AVG(salary) FROM employees;<br>ELSEIF num=2 <br>THEN SELECT MIN(salary) FROM employees;<br>ELSE <br>SELECT MAX(salary) FROM employees;<br>END IF;<br><br>SELECT COUNT(*) FROM employees;<br>END //<br><br><br>DELIMITER ;<br></code></pre></td></tr></table></figure><p><strong>ä¸¾ä¾‹2ï¼š</strong></p><p>å½“å¸‚åœºç¯å¢ƒä¸å¥½æ—¶ï¼Œå…¬å¸ä¸ºäº†æ¸¡è¿‡éš¾å…³ï¼Œå†³å®šæš‚æ—¶é™ä½å¤§å®¶çš„è–ªèµ„ã€‚å£°æ˜å­˜å‚¨è¿‡ç¨‹â€œleave_while()â€ï¼Œå£°æ˜OUTå‚æ•°numï¼Œè¾“å‡ºå¾ªç¯æ¬¡æ•°ï¼Œå­˜å‚¨è¿‡ç¨‹ä¸­ä½¿ç”¨WHILEå¾ªç¯ç»™å¤§å®¶é™ä½è–ªèµ„ä¸ºåŸæ¥è–ªèµ„çš„90%ï¼Œç›´åˆ°å…¨å…¬å¸çš„å¹³å‡è–ªèµ„å°äºç­‰äº10000ï¼Œå¹¶ç»Ÿè®¡å¾ªç¯æ¬¡æ•°ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DELIMITER //<br>CREATE PROCEDURE leave_while(OUT num INT)<br><br>BEGIN <br>#<br>DECLARE avg_sal DOUBLE;#è®°å½•å¹³å‡å·¥èµ„<br>DECLARE while_count INT DEFAULT 0; #è®°å½•å¾ªç¯æ¬¡æ•°<br><br>SELECT AVG(salary) INTO avg_sal FROM employees; #â‘  åˆå§‹åŒ–æ¡ä»¶<br><br>while_label:WHILE TRUE DO  #â‘¡ å¾ªç¯æ¡ä»¶<br><br>#â‘¢ å¾ªç¯ä½“<br>IF avg_sal &lt;= 10000 THEN<br>LEAVE while_label;<br>END IF;<br><br>UPDATE employees SET salary  = salary * 0.9;<br>SET while_count = while_count + 1;<br><br>#â‘£ è¿­ä»£æ¡ä»¶<br>SELECT AVG(salary) INTO avg_sal FROM employees;<br><br>END WHILE;<br><br>#èµ‹å€¼<br>SET num = while_count;<br><br>END //<br><br>DELIMITER ;<br></code></pre></td></tr></table></figure><h3 id="3-7-è·³è½¬è¯­å¥ä¹‹ITERATEè¯­å¥"><a href="#3-7-è·³è½¬è¯­å¥ä¹‹ITERATEè¯­å¥" class="headerlink" title="3.7 è·³è½¬è¯­å¥ä¹‹ITERATEè¯­å¥"></a>3.7 è·³è½¬è¯­å¥ä¹‹ITERATEè¯­å¥</h3><p>ITERATEè¯­å¥ï¼šåªèƒ½ç”¨åœ¨å¾ªç¯è¯­å¥ï¼ˆLOOPã€REPEATå’ŒWHILEè¯­å¥ï¼‰å†…ï¼Œè¡¨ç¤ºé‡æ–°å¼€å§‹å¾ªç¯ï¼Œå°†æ‰§è¡Œé¡ºåºè½¬åˆ°è¯­å¥æ®µå¼€å¤´å¤„ã€‚å¦‚æœä½ æœ‰é¢å‘è¿‡ç¨‹çš„ç¼–ç¨‹è¯­è¨€çš„ä½¿ç”¨ç»éªŒï¼Œä½ å¯ä»¥æŠŠ ITERATE ç†è§£ä¸º continueï¼Œæ„æ€ä¸ºâ€œå†æ¬¡å¾ªç¯â€ã€‚</p><p>è¯­å¥åŸºæœ¬æ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">ITERATE label<br></code></pre></td></tr></table></figure><p>labelå‚æ•°è¡¨ç¤ºå¾ªç¯çš„æ ‡å¿—ã€‚ITERATEè¯­å¥å¿…é¡»è·Ÿåœ¨å¾ªç¯æ ‡å¿—å‰é¢ã€‚</p><p><strong>ä¸¾ä¾‹ï¼š</strong>  å®šä¹‰å±€éƒ¨å˜é‡numï¼Œåˆå§‹å€¼ä¸º0ã€‚å¾ªç¯ç»“æ„ä¸­æ‰§è¡Œnum + 1æ“ä½œã€‚</p><ul><li>å¦‚æœnum &lt; 10ï¼Œåˆ™ç»§ç»­æ‰§è¡Œå¾ªç¯ï¼›</li><li>å¦‚æœnum &gt; 15ï¼Œåˆ™é€€å‡ºå¾ªç¯ç»“æ„ï¼›</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DELIMITER //<br><br>CREATE PROCEDURE test_iterate()<br><br>BEGIN<br>DECLARE num INT DEFAULT 0;<br><br>my_loop:LOOP<br>SET num = num + 1;<br><br>IF num &lt; 10 <br>THEN ITERATE my_loop;<br>ELSEIF num &gt; 15 <br>THEN LEAVE my_loop;<br>END IF;<br><br>SELECT &#x27;å°šç¡…è°·ï¼šè®©å¤©ä¸‹æ²¡æœ‰éš¾å­¦çš„æŠ€æœ¯&#x27;;<br><br>END LOOP my_loop;<br><br>END //<br><br>DELIMITER ;<br></code></pre></td></tr></table></figure><h2 id="4-æ¸¸æ ‡"><a href="#4-æ¸¸æ ‡" class="headerlink" title="4. æ¸¸æ ‡"></a>4. æ¸¸æ ‡</h2><h3 id="4-1-ä»€ä¹ˆæ˜¯æ¸¸æ ‡ï¼ˆæˆ–å…‰æ ‡ï¼‰"><a href="#4-1-ä»€ä¹ˆæ˜¯æ¸¸æ ‡ï¼ˆæˆ–å…‰æ ‡ï¼‰" class="headerlink" title="4.1 ä»€ä¹ˆæ˜¯æ¸¸æ ‡ï¼ˆæˆ–å…‰æ ‡ï¼‰"></a>4.1 ä»€ä¹ˆæ˜¯æ¸¸æ ‡ï¼ˆæˆ–å…‰æ ‡ï¼‰</h3><p>è™½ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ç­›é€‰æ¡ä»¶ WHERE å’Œ HAVINGï¼Œæˆ–è€…æ˜¯é™å®šè¿”å›è®°å½•çš„å…³é”®å­— LIMIT è¿”å›ä¸€æ¡è®°å½•ï¼Œä½†æ˜¯ï¼Œå´æ— æ³•åœ¨ç»“æœé›†ä¸­åƒæŒ‡é’ˆä¸€æ ·ï¼Œå‘å‰å®šä½ä¸€æ¡è®°å½•ã€å‘åå®šä½ä¸€æ¡è®°å½•ï¼Œæˆ–è€…æ˜¯<code>éšæ„å®šä½åˆ°æŸä¸€æ¡è®°å½•</code>ï¼Œå¹¶å¯¹è®°å½•çš„æ•°æ®è¿›è¡Œå¤„ç†ã€‚</p><p>è¿™ä¸ªæ—¶å€™ï¼Œå°±å¯ä»¥ç”¨åˆ°æ¸¸æ ‡ã€‚æ¸¸æ ‡ï¼Œæä¾›äº†ä¸€ç§çµæ´»çš„æ“ä½œæ–¹å¼ï¼Œè®©æˆ‘ä»¬èƒ½å¤Ÿå¯¹ç»“æœé›†ä¸­çš„æ¯ä¸€æ¡è®°å½•è¿›è¡Œå®šä½ï¼Œå¹¶å¯¹æŒ‡å‘çš„è®°å½•ä¸­çš„æ•°æ®è¿›è¡Œæ“ä½œçš„æ•°æ®ç»“æ„ã€‚<strong>æ¸¸æ ‡è®© SQL è¿™ç§é¢å‘é›†åˆçš„è¯­è¨€æœ‰äº†é¢å‘è¿‡ç¨‹å¼€å‘çš„èƒ½åŠ›ã€‚</strong></p><p>åœ¨ SQL ä¸­ï¼Œæ¸¸æ ‡æ˜¯ä¸€ç§ä¸´æ—¶çš„æ•°æ®åº“å¯¹è±¡ï¼Œå¯ä»¥æŒ‡å‘å­˜å‚¨åœ¨æ•°æ®åº“è¡¨ä¸­çš„æ•°æ®è¡ŒæŒ‡é’ˆã€‚è¿™é‡Œæ¸¸æ ‡<code>å……å½“äº†æŒ‡é’ˆçš„ä½œç”¨</code>ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ“ä½œæ¸¸æ ‡æ¥å¯¹æ•°æ®è¡Œè¿›è¡Œæ“ä½œã€‚</p><p>MySQLä¸­æ¸¸æ ‡å¯ä»¥åœ¨å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°ä¸­ä½¿ç”¨ã€‚</p><p>æ¯”å¦‚ï¼Œæˆ‘ä»¬æŸ¥è¯¢äº† employees æ•°æ®è¡¨ä¸­å·¥èµ„é«˜äº15000çš„å‘˜å·¥éƒ½æœ‰å“ªäº›ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT employee_id,last_name,salary FROM employees<br>WHERE salary &gt; 15000;<br></code></pre></td></tr></table></figure><p> <img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211111182656990.png"></p><p>è¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡æ¸¸æ ‡æ¥æ“ä½œæ•°æ®è¡Œï¼Œå¦‚å›¾æ‰€ç¤ºæ­¤æ—¶æ¸¸æ ‡æ‰€åœ¨çš„è¡Œæ˜¯â€œ108â€çš„è®°å½•ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ç»“æœé›†ä¸Šæ»šåŠ¨æ¸¸æ ‡ï¼ŒæŒ‡å‘ç»“æœé›†ä¸­çš„ä»»æ„ä¸€è¡Œã€‚</p><h3 id="4-2-ä½¿ç”¨æ¸¸æ ‡æ­¥éª¤"><a href="#4-2-ä½¿ç”¨æ¸¸æ ‡æ­¥éª¤" class="headerlink" title="4.2 ä½¿ç”¨æ¸¸æ ‡æ­¥éª¤"></a>4.2 ä½¿ç”¨æ¸¸æ ‡æ­¥éª¤</h3><p>æ¸¸æ ‡å¿…é¡»åœ¨å£°æ˜å¤„ç†ç¨‹åºä¹‹å‰è¢«å£°æ˜ï¼Œå¹¶ä¸”å˜é‡å’Œæ¡ä»¶è¿˜å¿…é¡»åœ¨å£°æ˜æ¸¸æ ‡æˆ–å¤„ç†ç¨‹åºä¹‹å‰è¢«å£°æ˜ã€‚<strong>ï¼ˆæ‰€ä»¥å£°æ˜çš„é¡ºåºåº”è¯¥æ˜¯ï¼š1.å±€éƒ¨å˜é‡ã€2.æ¡ä»¶ï¼ˆå¼‚å¸¸ï¼‰ã€3.æ¸¸æ ‡ã€4.å¤„ç†ç¨‹åºï¼‰</strong></p><p>å¦‚æœæˆ‘ä»¬æƒ³è¦ä½¿ç”¨æ¸¸æ ‡ï¼Œä¸€èˆ¬éœ€è¦ç»å†å››ä¸ªæ­¥éª¤ã€‚ä¸åŒçš„ DBMS ä¸­ï¼Œä½¿ç”¨æ¸¸æ ‡çš„è¯­æ³•å¯èƒ½ç•¥æœ‰ä¸åŒã€‚</p><p><strong>ç¬¬ä¸€æ­¥ï¼Œå£°æ˜æ¸¸æ ‡</strong></p><p>åœ¨MySQLä¸­ï¼Œä½¿ç”¨DECLAREå…³é”®å­—æ¥å£°æ˜æ¸¸æ ‡ï¼Œå…¶è¯­æ³•çš„åŸºæœ¬å½¢å¼å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DECLARE cursor_name CURSOR FOR select_statement; <br></code></pre></td></tr></table></figure><p>è¿™ä¸ªè¯­æ³•é€‚ç”¨äº MySQLï¼ŒSQL Serverï¼ŒDB2 å’Œ MariaDBã€‚å¦‚æœæ˜¯ç”¨ Oracle æˆ–è€… PostgreSQLï¼Œéœ€è¦å†™æˆï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DECLARE cursor_name CURSOR IS select_statement;<br></code></pre></td></tr></table></figure><p>è¦ä½¿ç”¨ SELECT è¯­å¥æ¥è·å–æ•°æ®ç»“æœé›†ï¼Œè€Œæ­¤æ—¶è¿˜æ²¡æœ‰å¼€å§‹éå†æ•°æ®ï¼Œè¿™é‡Œ select_statement ä»£è¡¨çš„æ˜¯ SELECT è¯­å¥ï¼Œè¿”å›ä¸€ä¸ªç”¨äºåˆ›å»ºæ¸¸æ ‡çš„ç»“æœé›†ã€‚</p><p>æ¯”å¦‚ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DECLARE cur_emp CURSOR FOR <br>SELECT employee_id,salary FROM employees;<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DECLARE cursor_fruit CURSOR FOR <br>SELECT f_name, f_price FROM fruits ;<br></code></pre></td></tr></table></figure><p><strong>ç¬¬äºŒæ­¥ï¼Œæ‰“å¼€æ¸¸æ ‡</strong></p><p>æ‰“å¼€æ¸¸æ ‡çš„è¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">OPEN cursor_name<br></code></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬å®šä¹‰å¥½æ¸¸æ ‡ä¹‹åï¼Œå¦‚æœæƒ³è¦ä½¿ç”¨æ¸¸æ ‡ï¼Œå¿…é¡»å…ˆæ‰“å¼€æ¸¸æ ‡ã€‚æ‰“å¼€æ¸¸æ ‡çš„æ—¶å€™ SELECT è¯­å¥çš„æŸ¥è¯¢ç»“æœé›†å°±ä¼šé€åˆ°æ¸¸æ ‡å·¥ä½œåŒºï¼Œä¸ºåé¢æ¸¸æ ‡çš„<code>é€æ¡è¯»å–</code>ç»“æœé›†ä¸­çš„è®°å½•åšå‡†å¤‡ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">OPENã€€cur_emp ;<br></code></pre></td></tr></table></figure><p><strong>ç¬¬ä¸‰æ­¥ï¼Œä½¿ç”¨æ¸¸æ ‡ï¼ˆä»æ¸¸æ ‡ä¸­å–å¾—æ•°æ®ï¼‰</strong></p><p>è¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">FETCH cursor_name INTO var_name [, var_name] ...<br></code></pre></td></tr></table></figure><p>è¿™å¥çš„ä½œç”¨æ˜¯ä½¿ç”¨ cursor_name è¿™ä¸ªæ¸¸æ ‡æ¥è¯»å–å½“å‰è¡Œï¼Œå¹¶ä¸”å°†æ•°æ®ä¿å­˜åˆ° var_name è¿™ä¸ªå˜é‡ä¸­ï¼Œæ¸¸æ ‡æŒ‡é’ˆæŒ‡åˆ°ä¸‹ä¸€è¡Œã€‚å¦‚æœæ¸¸æ ‡è¯»å–çš„æ•°æ®è¡Œæœ‰å¤šä¸ªåˆ—åï¼Œåˆ™åœ¨ INTO å…³é”®å­—åé¢èµ‹å€¼ç»™å¤šä¸ªå˜é‡åå³å¯ã€‚</p><p>æ³¨æ„ï¼švar_nameå¿…é¡»åœ¨å£°æ˜æ¸¸æ ‡ä¹‹å‰å°±å®šä¹‰å¥½ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">FETCHã€€cur_emp INTO emp_id, emp_sal ;<br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼š<strong>æ¸¸æ ‡çš„æŸ¥è¯¢ç»“æœé›†ä¸­çš„å­—æ®µæ•°ï¼Œå¿…é¡»è·Ÿ INTO åé¢çš„å˜é‡æ•°ä¸€è‡´</strong>ï¼Œå¦åˆ™ï¼Œåœ¨å­˜å‚¨è¿‡ç¨‹æ‰§è¡Œçš„æ—¶å€™ï¼ŒMySQL ä¼šæç¤ºé”™è¯¯ã€‚</p><p><strong>ç¬¬å››æ­¥ï¼Œå…³é—­æ¸¸æ ‡</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CLOSE cursor_name<br></code></pre></td></tr></table></figure><p>æœ‰ OPEN å°±ä¼šæœ‰ CLOSEï¼Œä¹Ÿå°±æ˜¯æ‰“å¼€å’Œå…³é—­æ¸¸æ ‡ã€‚å½“æˆ‘ä»¬ä½¿ç”¨å®Œæ¸¸æ ‡åéœ€è¦å…³é—­æ‰è¯¥æ¸¸æ ‡ã€‚å› ä¸ºæ¸¸æ ‡ä¼š<code>å ç”¨ç³»ç»Ÿèµ„æº</code>ï¼Œå¦‚æœä¸åŠæ—¶å…³é—­ï¼Œ<strong>æ¸¸æ ‡ä¼šä¸€ç›´ä¿æŒåˆ°å­˜å‚¨è¿‡ç¨‹ç»“æŸ</strong>ï¼Œå½±å“ç³»ç»Ÿè¿è¡Œçš„æ•ˆç‡ã€‚è€Œå…³é—­æ¸¸æ ‡çš„æ“ä½œï¼Œä¼šé‡Šæ”¾æ¸¸æ ‡å ç”¨çš„ç³»ç»Ÿèµ„æºã€‚</p><p>å…³é—­æ¸¸æ ‡ä¹‹åï¼Œæˆ‘ä»¬å°±ä¸èƒ½å†æ£€ç´¢æŸ¥è¯¢ç»“æœä¸­çš„æ•°æ®è¡Œï¼Œå¦‚æœéœ€è¦æ£€ç´¢åªèƒ½å†æ¬¡æ‰“å¼€æ¸¸æ ‡ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CLOSEã€€cur_emp;<br></code></pre></td></tr></table></figure><h3 id="4-3-ä¸¾ä¾‹"><a href="#4-3-ä¸¾ä¾‹" class="headerlink" title="4.3 ä¸¾ä¾‹"></a>4.3 ä¸¾ä¾‹</h3><p>åˆ›å»ºå­˜å‚¨è¿‡ç¨‹â€œget_count_by_limit_total_salary()â€ï¼Œå£°æ˜INå‚æ•° limit_total_salaryï¼ŒDOUBLEç±»å‹ï¼›å£°æ˜OUTå‚æ•°total_countï¼ŒINTç±»å‹ã€‚å‡½æ•°çš„åŠŸèƒ½å¯ä»¥å®ç°ç´¯åŠ è–ªèµ„æœ€é«˜çš„å‡ ä¸ªå‘˜å·¥çš„è–ªèµ„å€¼ï¼Œç›´åˆ°è–ªèµ„æ€»å’Œè¾¾åˆ°limit_total_salaryå‚æ•°çš„å€¼ï¼Œè¿”å›ç´¯åŠ çš„äººæ•°ç»™total_countã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DELIMITER //<br><br>CREATE PROCEDURE get_count_by_limit_total_salary(IN limit_total_salary DOUBLE,OUT total_count INT)<br><br>BEGIN<br>DECLARE sum_salary DOUBLE DEFAULT 0;  #è®°å½•ç´¯åŠ çš„æ€»å·¥èµ„<br>DECLARE cursor_salary DOUBLE DEFAULT 0; #è®°å½•æŸä¸€ä¸ªå·¥èµ„å€¼<br>DECLARE emp_count INT DEFAULT 0; #è®°å½•å¾ªç¯ä¸ªæ•°<br>#å®šä¹‰æ¸¸æ ‡<br>DECLARE emp_cursor CURSOR FOR SELECT salary FROM employees ORDER BY salary DESC;<br>#æ‰“å¼€æ¸¸æ ‡<br>OPEN emp_cursor;<br><br>REPEAT<br>#ä½¿ç”¨æ¸¸æ ‡ï¼ˆä»æ¸¸æ ‡ä¸­è·å–æ•°æ®ï¼‰<br>FETCH emp_cursor INTO cursor_salary;<br><br>SET sum_salary = sum_salary + cursor_salary;<br>SET emp_count = emp_count + 1;<br><br>UNTIL sum_salary &gt;= limit_total_salary<br>END REPEAT;<br><br>SET total_count = emp_count;<br>#å…³é—­æ¸¸æ ‡<br>CLOSE emp_cursor;<br><br>END //<br><br>DELIMITER ;<br></code></pre></td></tr></table></figure><h3 id="4-5-å°ç»“"><a href="#4-5-å°ç»“" class="headerlink" title="4.5 å°ç»“"></a>4.5 å°ç»“</h3><p>æ¸¸æ ‡æ˜¯ MySQL çš„ä¸€ä¸ªé‡è¦çš„åŠŸèƒ½ï¼Œä¸º<code>é€æ¡è¯»å–</code>ç»“æœé›†ä¸­çš„æ•°æ®ï¼Œæä¾›äº†å®Œç¾çš„è§£å†³æ–¹æ¡ˆã€‚è·Ÿåœ¨åº”ç”¨å±‚é¢å®ç°ç›¸åŒçš„åŠŸèƒ½ç›¸æ¯”ï¼Œæ¸¸æ ‡å¯ä»¥åœ¨å­˜å‚¨ç¨‹åºä¸­ä½¿ç”¨ï¼Œæ•ˆç‡é«˜ï¼Œç¨‹åºä¹Ÿæ›´åŠ ç®€æ´ã€‚</p><p>ä½†åŒæ—¶ä¹Ÿä¼šå¸¦æ¥ä¸€äº›æ€§èƒ½é—®é¢˜ï¼Œæ¯”å¦‚åœ¨ä½¿ç”¨æ¸¸æ ‡çš„è¿‡ç¨‹ä¸­ï¼Œä¼šå¯¹æ•°æ®è¡Œè¿›è¡Œ**<code>åŠ é”</code>**ï¼Œè¿™æ ·åœ¨ä¸šåŠ¡å¹¶å‘é‡å¤§çš„æ—¶å€™ï¼Œä¸ä»…ä¼šå½±å“ä¸šåŠ¡ä¹‹é—´çš„æ•ˆç‡ï¼Œè¿˜ä¼š<code>æ¶ˆè€—ç³»ç»Ÿèµ„æº</code>ï¼Œé€ æˆå†…å­˜ä¸è¶³ï¼Œè¿™æ˜¯å› ä¸ºæ¸¸æ ‡æ˜¯åœ¨å†…å­˜ä¸­è¿›è¡Œçš„å¤„ç†ã€‚</p><p>å»ºè®®ï¼šå…»æˆç”¨å®Œä¹‹åå°±å…³é—­çš„ä¹ æƒ¯ï¼Œè¿™æ ·æ‰èƒ½æé«˜ç³»ç»Ÿçš„æ•´ä½“æ•ˆç‡ã€‚</p><h2 id="è¡¥å……ï¼šMySQL-8-0çš„æ–°ç‰¹æ€§â€”å…¨å±€å˜é‡çš„æŒä¹…åŒ–"><a href="#è¡¥å……ï¼šMySQL-8-0çš„æ–°ç‰¹æ€§â€”å…¨å±€å˜é‡çš„æŒä¹…åŒ–" class="headerlink" title="è¡¥å……ï¼šMySQL 8.0çš„æ–°ç‰¹æ€§â€”å…¨å±€å˜é‡çš„æŒä¹…åŒ–"></a>è¡¥å……ï¼šMySQL 8.0çš„æ–°ç‰¹æ€§â€”å…¨å±€å˜é‡çš„æŒä¹…åŒ–</h2><p>åœ¨MySQLæ•°æ®åº“ä¸­ï¼Œå…¨å±€å˜é‡å¯ä»¥é€šè¿‡SET GLOBALè¯­å¥æ¥è®¾ç½®ã€‚ä¾‹å¦‚ï¼Œè®¾ç½®æœåŠ¡å™¨è¯­å¥è¶…æ—¶çš„é™åˆ¶ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®ç³»ç»Ÿå˜é‡max_execution_timeæ¥å®ç°ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SET GLOBAL MAX_EXECUTION_TIME=2000;<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨SET GLOBALè¯­å¥è®¾ç½®çš„å˜é‡å€¼åªä¼š<code>ä¸´æ—¶ç”Ÿæ•ˆ</code>ã€‚<code>æ•°æ®åº“é‡å¯</code>åï¼ŒæœåŠ¡å™¨åˆä¼šä»MySQLé…ç½®æ–‡ä»¶ä¸­è¯»å–å˜é‡çš„é»˜è®¤å€¼ã€‚<br>MySQL 8.0ç‰ˆæœ¬æ–°å¢äº†<code>SET PERSIST</code>å‘½ä»¤ã€‚ä¾‹å¦‚ï¼Œè®¾ç½®æœåŠ¡å™¨çš„æœ€å¤§è¿æ¥æ•°ä¸º1000ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SET PERSIST GLOBAL max_connections = 1000;<br>#æˆ–è€…<br>SET PERSIST max_connections = 1000;#PERSISTåªèƒ½æ˜¯å…¨å±€å˜é‡ï¼Œä½†æ˜¯è¿˜æ˜¯æ¨èå†™ä¸ŠGLOBAL<br></code></pre></td></tr></table></figure><p>MySQLä¼šå°†è¯¥å‘½ä»¤çš„é…ç½®ä¿å­˜åˆ°æ•°æ®ç›®å½•ä¸‹çš„<code>mysqld-auto.cnf</code>æ–‡ä»¶ä¸­ï¼Œä¸‹æ¬¡å¯åŠ¨æ—¶ä¼šè¯»å–è¯¥æ–‡ä»¶ï¼Œç”¨å…¶ä¸­çš„é…ç½®æ¥è¦†ç›–é»˜è®¤çš„é…ç½®æ–‡ä»¶ã€‚</p><p>ä¸¾ä¾‹ï¼š</p><p>æŸ¥çœ‹å…¨å±€å˜é‡max_connectionsçš„å€¼ï¼Œç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; show variables like &#x27;%max_connections%&#x27;;<br>+------------------------+-------+<br>| Variable_name          | Value |<br>+------------------------+-------+<br>| max_connections        | 151   |<br>| mysqlx_max_connections | 100   |<br>+------------------------+-------+<br>2 rows in set, 1 warning (0.00 sec)<br></code></pre></td></tr></table></figure><p>è®¾ç½®å…¨å±€å˜é‡max_connectionsçš„å€¼ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; set persist max_connections=1000;<br>Query OK, 0 rows affected (0.00 sec)<br></code></pre></td></tr></table></figure><p><code>é‡å¯MySQLæœåŠ¡å™¨</code>ï¼Œå†æ¬¡æŸ¥è¯¢max_connectionsçš„å€¼ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; show variables like &#x27;%max_connections%&#x27;;<br>+------------------------+-------+<br>| Variable_name          | Value |<br>+------------------------+-------+<br>| max_connections        | 1000  |<br>| mysqlx_max_connections | 100   |<br>+------------------------+-------+<br>2 rows in set, 1 warning (0.00 sec)<br></code></pre></td></tr></table></figure><h1 id="ç¬¬17ç« -è§¦å‘å™¨"><a href="#ç¬¬17ç« -è§¦å‘å™¨" class="headerlink" title="ç¬¬17ç« _è§¦å‘å™¨"></a>ç¬¬17ç« _è§¦å‘å™¨</h1><p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°è¿™æ ·çš„æƒ…å†µï¼šæœ‰ 2 ä¸ªæˆ–è€…å¤šä¸ªç›¸äº’å…³è”çš„è¡¨ï¼Œå¦‚<code>å•†å“ä¿¡æ¯</code>å’Œ<code>åº“å­˜ä¿¡æ¯</code>åˆ†åˆ«å­˜æ”¾åœ¨ 2 ä¸ªä¸åŒçš„æ•°æ®è¡¨ä¸­ï¼Œæˆ‘ä»¬åœ¨æ·»åŠ ä¸€æ¡æ–°å•†å“è®°å½•çš„æ—¶å€™ï¼Œä¸ºäº†ä¿è¯æ•°æ®çš„å®Œæ•´æ€§ï¼Œå¿…é¡»åŒæ—¶åœ¨åº“å­˜è¡¨ä¸­æ·»åŠ ä¸€æ¡åº“å­˜è®°å½•ã€‚</p><p>è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬å°±å¿…é¡»æŠŠè¿™ä¸¤ä¸ªå…³è”çš„æ“ä½œæ­¥éª¤å†™åˆ°ç¨‹åºé‡Œé¢ï¼Œè€Œä¸”è¦ç”¨<code>äº‹åŠ¡</code>åŒ…è£¹èµ·æ¥ï¼Œç¡®ä¿è¿™ä¸¤ä¸ªæ“ä½œæˆä¸ºä¸€ä¸ª<code>åŸå­æ“ä½œ</code>ï¼Œè¦ä¹ˆå…¨éƒ¨æ‰§è¡Œï¼Œè¦ä¹ˆå…¨éƒ¨ä¸æ‰§è¡Œã€‚å¦‚æœä¸ä½¿ç”¨åŸå­æ“ä½œï¼Œè¦æ˜¯é‡åˆ°ç‰¹æ®Šæƒ…å†µï¼Œå¯èƒ½è¿˜éœ€è¦å¯¹æ•°æ®è¿›è¡Œæ‰‹åŠ¨ç»´æŠ¤ï¼Œè¿™æ ·å°±å¾ˆ<code>å®¹æ˜“å¿˜è®°å…¶ä¸­çš„ä¸€æ­¥</code>ï¼Œå¯¼è‡´æ•°æ®ç¼ºå¤±ã€‚</p><p>è¿™ä¸ªæ—¶å€™ï¼Œå’±ä»¬å¯ä»¥ä½¿ç”¨è§¦å‘å™¨ã€‚<strong>ä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªè§¦å‘å™¨ï¼Œè®©å•†å“ä¿¡æ¯æ•°æ®çš„æ’å…¥æ“ä½œè‡ªåŠ¨è§¦å‘åº“å­˜æ•°æ®çš„æ’å…¥æ“ä½œã€‚</strong>è¿™æ ·ä¸€æ¥ï¼Œå°±ä¸ç”¨æ‹…å¿ƒå› ä¸ºå¿˜è®°æ·»åŠ åº“å­˜æ•°æ®è€Œå¯¼è‡´çš„æ•°æ®ç¼ºå¤±äº†ã€‚</p><h2 id="1-è§¦å‘å™¨æ¦‚è¿°"><a href="#1-è§¦å‘å™¨æ¦‚è¿°" class="headerlink" title="1. è§¦å‘å™¨æ¦‚è¿°"></a>1. è§¦å‘å™¨æ¦‚è¿°</h2><p>MySQLä»<code>5.0.2</code>ç‰ˆæœ¬å¼€å§‹æ”¯æŒè§¦å‘å™¨ã€‚MySQLçš„è§¦å‘å™¨å’Œå­˜å‚¨è¿‡ç¨‹ä¸€æ ·ï¼Œéƒ½æ˜¯åµŒå…¥åˆ°MySQLæœåŠ¡å™¨çš„ä¸€æ®µç¨‹åºã€‚</p><p>è§¦å‘å™¨æ˜¯ç”±<code>äº‹ä»¶æ¥è§¦å‘</code>æŸä¸ªæ“ä½œï¼Œè¿™äº›äº‹ä»¶åŒ…æ‹¬<code>INSERT</code>ã€<code>UPDATE</code>ã€<code>DELETE</code>äº‹ä»¶ã€‚æ‰€è°“äº‹ä»¶å°±æ˜¯æŒ‡ç”¨æˆ·çš„åŠ¨ä½œæˆ–è€…è§¦å‘æŸé¡¹è¡Œä¸ºã€‚å¦‚æœå®šä¹‰äº†è§¦å‘ç¨‹åºï¼Œå½“æ•°æ®åº“æ‰§è¡Œè¿™äº›è¯­å¥æ—¶å€™ï¼Œå°±ç›¸å½“äºäº‹ä»¶å‘ç”Ÿäº†ï¼Œå°±ä¼š<code>è‡ªåŠ¨</code>æ¿€å‘è§¦å‘å™¨æ‰§è¡Œç›¸åº”çš„æ“ä½œã€‚</p><p>å½“å¯¹æ•°æ®è¡¨ä¸­çš„æ•°æ®æ‰§è¡Œæ’å…¥ã€æ›´æ–°å’Œåˆ é™¤æ“ä½œï¼Œéœ€è¦è‡ªåŠ¨æ‰§è¡Œä¸€äº›æ•°æ®åº“é€»è¾‘æ—¶ï¼Œå¯ä»¥ä½¿ç”¨è§¦å‘å™¨æ¥å®ç°ã€‚</p><h2 id="2-è§¦å‘å™¨çš„åˆ›å»º"><a href="#2-è§¦å‘å™¨çš„åˆ›å»º" class="headerlink" title="2. è§¦å‘å™¨çš„åˆ›å»º"></a>2. è§¦å‘å™¨çš„åˆ›å»º</h2><h3 id="2-1-åˆ›å»ºè§¦å‘å™¨è¯­æ³•"><a href="#2-1-åˆ›å»ºè§¦å‘å™¨è¯­æ³•" class="headerlink" title="2.1 åˆ›å»ºè§¦å‘å™¨è¯­æ³•"></a>2.1 åˆ›å»ºè§¦å‘å™¨è¯­æ³•</h3><p>åˆ›å»ºè§¦å‘å™¨çš„è¯­æ³•ç»“æ„æ˜¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE TRIGGER è§¦å‘å™¨åç§° <br>&#123;BEFORE|AFTER&#125; &#123;INSERT|UPDATE|DELETE&#125; ON è¡¨å <br>FOR EACH ROW <br>è§¦å‘å™¨æ‰§è¡Œçš„è¯­å¥å—;<br></code></pre></td></tr></table></figure><p>è¯´æ˜ï¼š</p><ul><li><code>è¡¨å</code>ï¼šè¡¨ç¤ºè§¦å‘å™¨ç›‘æ§çš„å¯¹è±¡ã€‚</li><li><code>BEFORE|AFTER</code>ï¼šè¡¨ç¤ºè§¦å‘çš„æ—¶é—´ã€‚BEFORE è¡¨ç¤ºåœ¨äº‹ä»¶ä¹‹å‰è§¦å‘ï¼›AFTER è¡¨ç¤ºåœ¨äº‹ä»¶ä¹‹åè§¦å‘ã€‚</li><li><code>INSERT|UPDATE|DELETE</code>ï¼šè¡¨ç¤ºè§¦å‘çš„äº‹ä»¶ã€‚<ul><li>INSERT è¡¨ç¤ºæ’å…¥è®°å½•æ—¶è§¦å‘ï¼›</li><li>UPDATE è¡¨ç¤ºæ›´æ–°è®°å½•æ—¶è§¦å‘ï¼›</li><li>DELETE è¡¨ç¤ºåˆ é™¤è®°å½•æ—¶è§¦å‘ã€‚</li></ul></li></ul><ul><li><code>è§¦å‘å™¨æ‰§è¡Œçš„è¯­å¥å—</code>ï¼šå¯ä»¥æ˜¯å•æ¡SQLè¯­å¥ï¼Œä¹Ÿå¯ä»¥æ˜¯ç”±BEGINâ€¦ENDç»“æ„ç»„æˆçš„å¤åˆè¯­å¥å—**(å½“ç„¶ä½¿ç”¨BEGINâ€¦ENDè¦ä½¿ç”¨DELIMITER //ï¼Œé˜²æ­¢å¤åˆè¯­å¥å—ä¸­çš„ ; æå‰ç»ˆæ­¢BEGINè¯­å¥å—ï¼Œä½¿ç”¨END //æ¥ç»ˆæ­¢BEGINè¯­å¥å—ï¼‰**ã€‚</li></ul><h3 id="2-2-ä»£ç ä¸¾ä¾‹-1"><a href="#2-2-ä»£ç ä¸¾ä¾‹-1" class="headerlink" title="2.2 ä»£ç ä¸¾ä¾‹"></a>2.2 ä»£ç ä¸¾ä¾‹</h3><p><strong>ä¸¾ä¾‹1ï¼š</strong></p><p>1ã€åˆ›å»ºæ•°æ®è¡¨ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE TABLE test_trigger (<br>id INT PRIMARY KEY AUTO_INCREMENT,<br>t_note VARCHAR(30)<br>);<br><br><br>CREATE TABLE test_trigger_log (<br>id INT PRIMARY KEY AUTO_INCREMENT,<br>t_log VARCHAR(30)<br>);<br></code></pre></td></tr></table></figure><p>2ã€åˆ›å»ºè§¦å‘å™¨ï¼šåˆ›å»ºåç§°ä¸ºbefore_insertçš„è§¦å‘å™¨ï¼Œå‘test_triggeræ•°æ®è¡¨æ’å…¥æ•°æ®ä¹‹å‰ï¼Œå‘test_trigger_logæ•°æ®è¡¨ä¸­æ’å…¥before_insertçš„æ—¥å¿—ä¿¡æ¯ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DELIMITER //<br><br>CREATE TRIGGER before_insert<br>BEFORE INSERT ON test_trigger <br>FOR EACH ROW<br>BEGIN<br>INSERT INTO test_trigger_log (t_log)<br>VALUES(&#x27;before_insert&#x27;);<br><br>END //<br><br>DELIMITER ;<br></code></pre></td></tr></table></figure><p>3ã€å‘test_triggeræ•°æ®è¡¨ä¸­æ’å…¥æ•°æ®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">INSERT INTO test_trigger (t_note) VALUES (&#x27;æµ‹è¯• BEFORE INSERT è§¦å‘å™¨&#x27;);<br></code></pre></td></tr></table></figure><p>4ã€æŸ¥çœ‹test_trigger_logæ•°æ®è¡¨ä¸­çš„æ•°æ®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT * FROM test_trigger_log;<br>+----+---------------+<br>| id | t_log         |<br>+----+---------------+<br>|  1 | before_insert |<br>+----+---------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><p><strong>ä¸¾ä¾‹2ï¼š</strong></p><p>1ã€åˆ›å»ºåç§°ä¸ºafter_insertçš„è§¦å‘å™¨ï¼Œå‘test_triggeræ•°æ®è¡¨æ’å…¥æ•°æ®ä¹‹åï¼Œå‘test_trigger_logæ•°æ®è¡¨ä¸­æ’å…¥after_insertçš„æ—¥å¿—ä¿¡æ¯ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DELIMITER //<br><br>CREATE TRIGGER after_insert<br>AFTER INSERT ON test_trigger<br>FOR EACH ROW<br>BEGIN<br>INSERT INTO test_trigger_log (t_log)<br>VALUES(&#x27;after_insert&#x27;);<br>END //<br><br>DELIMITER ;<br></code></pre></td></tr></table></figure><p>2ã€å‘test_triggeræ•°æ®è¡¨ä¸­æ’å…¥æ•°æ®ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">INSERT INTO test_trigger (t_note) VALUES (&#x27;æµ‹è¯• AFTER INSERT è§¦å‘å™¨&#x27;);<br></code></pre></td></tr></table></figure><p>3ã€æŸ¥çœ‹test_trigger_logæ•°æ®è¡¨ä¸­çš„æ•°æ®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT * FROM test_trigger_log;<br>+----+---------------+<br>| id | t_log         |<br>+----+---------------+<br>|  1 | before_insert |<br>|  2 | before_insert |<br>|  3 | after_insert  |<br>+----+---------------+<br>3 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><p><strong>ä¸¾ä¾‹3ï¼š</strong>å®šä¹‰è§¦å‘å™¨â€œsalary_check_triggerâ€ï¼ŒåŸºäºå‘˜å·¥è¡¨â€œemployeesâ€çš„INSERTäº‹ä»¶ï¼Œåœ¨INSERTä¹‹å‰æ£€æŸ¥å°†è¦æ·»åŠ çš„æ–°å‘˜å·¥è–ªèµ„æ˜¯å¦å¤§äºä»–é¢†å¯¼çš„è–ªèµ„ï¼Œå¦‚æœå¤§äºé¢†å¯¼è–ªèµ„ï¼Œåˆ™æŠ¥sqlstate_valueä¸ºâ€™HY000â€™çš„é”™è¯¯ï¼Œä»è€Œä½¿å¾—æ·»åŠ å¤±è´¥ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DELIMITER //<br><br>CREATE TRIGGER salary_check_trigger<br>BEFORE INSERT ON employees <br>FOR EACH ROW<br>BEGIN<br>DECLARE mgrsalary DOUBLE;<br>SELECT salary INTO mgrsalary FROM employees WHERE employee_id = NEW.manager_id; #NEWä»£è¡¨INSERTè¯­å¥æ·»åŠ è¯­å¥çš„æ–°çºªå½•<br><br>IF NEW.salary &gt; mgrsalary THEN<br>SIGNAL SQLSTATE &#x27;HY000&#x27; SET MESSAGE_TEXT = &#x27;è–ªèµ„é«˜äºé¢†å¯¼è–ªèµ„é”™è¯¯&#x27;; #äººä¸ºæŠ›å¼‚å¸¸<br>END IF;<br>END //<br><br>DELIMITER ;<br></code></pre></td></tr></table></figure><p><strong>ä¸Šé¢è§¦å‘å™¨å£°æ˜è¿‡ç¨‹ä¸­çš„NEWå…³é”®å­—ä»£è¡¨INSERT / UPDATE  æ·»åŠ /æ›´æ–° è¯­å¥çš„æ–°è®°å½•ã€‚OLDå…³é”®å­—ä»£è¡¨DELETE / UPDATE åˆ é™¤/æ›´æ–°è¯­å¥çš„æ—§è®°å½•ã€‚ç”±äºè§¦å‘å™¨ä¸­FOR EACH ROWçš„å­˜åœ¨ï¼Œæ­¤å¤„è‹¥æœ‰å¤šæ¡è¯­å¥ï¼Œä¼šè¢«å¾ªç¯æ‰§è¡ŒNEW / OLD</strong></p><h2 id="3-æŸ¥çœ‹ã€åˆ é™¤è§¦å‘å™¨"><a href="#3-æŸ¥çœ‹ã€åˆ é™¤è§¦å‘å™¨" class="headerlink" title="3. æŸ¥çœ‹ã€åˆ é™¤è§¦å‘å™¨"></a>3. æŸ¥çœ‹ã€åˆ é™¤è§¦å‘å™¨</h2><h3 id="3-1-æŸ¥çœ‹è§¦å‘å™¨"><a href="#3-1-æŸ¥çœ‹è§¦å‘å™¨" class="headerlink" title="3.1 æŸ¥çœ‹è§¦å‘å™¨"></a>3.1 æŸ¥çœ‹è§¦å‘å™¨</h3><p>æŸ¥çœ‹è§¦å‘å™¨æ˜¯æŸ¥çœ‹æ•°æ®åº“ä¸­å·²ç»å­˜åœ¨çš„è§¦å‘å™¨çš„å®šä¹‰ã€çŠ¶æ€å’Œè¯­æ³•ä¿¡æ¯ç­‰ã€‚</p><p>æ–¹å¼1ï¼šæŸ¥çœ‹å½“å‰æ•°æ®åº“çš„æ‰€æœ‰è§¦å‘å™¨çš„å®šä¹‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SHOW TRIGGERS\G<br></code></pre></td></tr></table></figure><p>æ–¹å¼2ï¼šæŸ¥çœ‹å½“å‰æ•°æ®åº“ä¸­æŸä¸ªè§¦å‘å™¨çš„å®šä¹‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SHOW CREATE TRIGGER è§¦å‘å™¨å<br></code></pre></td></tr></table></figure><p>æ–¹å¼3ï¼šä»ç³»ç»Ÿåº“information_schemaçš„TRIGGERSè¡¨ä¸­æŸ¥è¯¢â€œsalary_check_triggerâ€è§¦å‘å™¨çš„ä¿¡æ¯ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT * FROM information_schema.TRIGGERS;<br></code></pre></td></tr></table></figure><h3 id="3-2-åˆ é™¤è§¦å‘å™¨"><a href="#3-2-åˆ é™¤è§¦å‘å™¨" class="headerlink" title="3.2 åˆ é™¤è§¦å‘å™¨"></a>3.2 åˆ é™¤è§¦å‘å™¨</h3><p>è§¦å‘å™¨ä¹Ÿæ˜¯æ•°æ®åº“å¯¹è±¡ï¼Œåˆ é™¤è§¦å‘å™¨ä¹Ÿç”¨DROPè¯­å¥ï¼Œè¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DROP TRIGGER  IF EXISTS è§¦å‘å™¨åç§°;<br></code></pre></td></tr></table></figure><h2 id="4-è§¦å‘å™¨çš„ä¼˜ç¼ºç‚¹"><a href="#4-è§¦å‘å™¨çš„ä¼˜ç¼ºç‚¹" class="headerlink" title="4. è§¦å‘å™¨çš„ä¼˜ç¼ºç‚¹"></a>4. è§¦å‘å™¨çš„ä¼˜ç¼ºç‚¹</h2><h3 id="4-1-ä¼˜ç‚¹"><a href="#4-1-ä¼˜ç‚¹" class="headerlink" title="4.1 ä¼˜ç‚¹"></a>4.1 ä¼˜ç‚¹</h3><p><strong>1ã€è§¦å‘å™¨å¯ä»¥ç¡®ä¿æ•°æ®çš„å®Œæ•´æ€§</strong>ã€‚</p><p>å‡è®¾æˆ‘ä»¬ç”¨<code>è¿›è´§å•å¤´è¡¨</code>ï¼ˆdemo.importheadï¼‰æ¥ä¿å­˜è¿›è´§å•çš„æ€»ä½“ä¿¡æ¯ï¼ŒåŒ…æ‹¬è¿›è´§å•ç¼–å·ã€ä¾›è´§å•†ç¼–å·ã€ä»“åº“ç¼–å·ã€æ€»è®¡è¿›è´§æ•°é‡ã€æ€»è®¡è¿›è´§é‡‘é¢å’ŒéªŒæ”¶æ—¥æœŸã€‚</p><p> <img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211010233336012.png"></p><p>ç”¨<code>è¿›è´§å•æ˜ç»†è¡¨</code>ï¼ˆdemo.importdetailsï¼‰æ¥ä¿å­˜è¿›è´§å•†å“çš„æ˜ç»†ï¼ŒåŒ…æ‹¬è¿›è´§å•ç¼–å·ã€å•†å“ç¼–å·ã€è¿›è´§æ•°é‡ã€è¿›è´§ä»·æ ¼å’Œè¿›è´§é‡‘é¢ã€‚</p><p> <img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211010233344125.png"></p><p>æ¯å½“æˆ‘ä»¬å½•å…¥ã€åˆ é™¤å’Œä¿®æ”¹ä¸€æ¡è¿›è´§å•æ˜ç»†æ•°æ®çš„æ—¶å€™ï¼Œè¿›è´§å•æ˜ç»†è¡¨é‡Œçš„æ•°æ®å°±ä¼šå‘ç”Ÿå˜åŠ¨ã€‚è¿™ä¸ªæ—¶å€™ï¼Œåœ¨è¿›è´§å•å¤´è¡¨ä¸­çš„æ€»è®¡æ•°é‡å’Œæ€»è®¡é‡‘é¢å°±å¿…é¡»é‡æ–°è®¡ç®—ï¼Œå¦åˆ™ï¼Œè¿›è´§å•å¤´è¡¨ä¸­çš„æ€»è®¡æ•°é‡å’Œæ€»è®¡é‡‘é¢å°±ä¸ç­‰äºè¿›è´§å•æ˜ç»†è¡¨ä¸­æ•°é‡åˆè®¡å’Œé‡‘é¢åˆè®¡äº†ï¼Œè¿™å°±æ˜¯æ•°æ®ä¸ä¸€è‡´ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨è§¦å‘å™¨ï¼Œ<strong>è§„å®šæ¯å½“è¿›è´§å•æ˜ç»†è¡¨æœ‰æ•°æ®æ’å…¥ã€ä¿®æ”¹å’Œåˆ é™¤çš„æ“ä½œæ—¶ï¼Œè‡ªåŠ¨è§¦å‘ 2 æ­¥æ“ä½œï¼š</strong></p><p>1ï¼‰é‡æ–°è®¡ç®—è¿›è´§å•æ˜ç»†è¡¨ä¸­çš„æ•°é‡åˆè®¡å’Œé‡‘é¢åˆè®¡ï¼›</p><p>2ï¼‰ç”¨ç¬¬ä¸€æ­¥ä¸­è®¡ç®—å‡ºæ¥çš„å€¼æ›´æ–°è¿›è´§å•å¤´è¡¨ä¸­çš„åˆè®¡æ•°é‡ä¸åˆè®¡é‡‘é¢ã€‚</p><p>è¿™æ ·ä¸€æ¥ï¼Œè¿›è´§å•å¤´è¡¨ä¸­çš„åˆè®¡æ•°é‡ä¸åˆè®¡é‡‘é¢çš„å€¼ï¼Œå°±å§‹ç»ˆä¸è¿›è´§å•æ˜ç»†è¡¨ä¸­è®¡ç®—å‡ºæ¥çš„åˆè®¡æ•°é‡ä¸åˆè®¡é‡‘é¢çš„å€¼ç›¸åŒï¼Œæ•°æ®å°±æ˜¯ä¸€è‡´çš„ï¼Œä¸ä¼šäº’ç›¸çŸ›ç›¾ã€‚</p><p><strong>2ã€è§¦å‘å™¨å¯ä»¥å¸®åŠ©æˆ‘ä»¬è®°å½•æ“ä½œæ—¥å¿—ã€‚</strong></p><p>åˆ©ç”¨è§¦å‘å™¨ï¼Œå¯ä»¥å…·ä½“è®°å½•ä»€ä¹ˆæ—¶é—´å‘ç”Ÿäº†ä»€ä¹ˆã€‚æ¯”å¦‚ï¼Œè®°å½•ä¿®æ”¹ä¼šå‘˜å‚¨å€¼é‡‘é¢çš„è§¦å‘å™¨ï¼Œå°±æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ã€‚è¿™å¯¹æˆ‘ä»¬è¿˜åŸæ“ä½œæ‰§è¡Œæ—¶çš„å…·ä½“åœºæ™¯ï¼Œæ›´å¥½åœ°å®šä½é—®é¢˜åŸå› å¾ˆæœ‰å¸®åŠ©ã€‚</p><p><strong>3ã€è§¦å‘å™¨è¿˜å¯ä»¥ç”¨åœ¨æ“ä½œæ•°æ®å‰ï¼Œå¯¹æ•°æ®è¿›è¡Œåˆæ³•æ€§æ£€æŸ¥ã€‚</strong></p><p>æ¯”å¦‚ï¼Œè¶…å¸‚è¿›è´§çš„æ—¶å€™ï¼Œéœ€è¦åº“ç®¡å½•å…¥è¿›è´§ä»·æ ¼ã€‚ä½†æ˜¯ï¼Œäººä¸ºæ“ä½œå¾ˆå®¹æ˜“çŠ¯é”™è¯¯ï¼Œæ¯”å¦‚è¯´åœ¨å½•å…¥æ•°é‡çš„æ—¶å€™ï¼ŒæŠŠæ¡å½¢ç æ‰«è¿›å»äº†ï¼›å½•å…¥é‡‘é¢çš„æ—¶å€™ï¼Œçœ‹ä¸²äº†è¡Œï¼Œå½•å…¥çš„ä»·æ ¼è¿œè¶…å”®ä»·ï¼Œå¯¼è‡´è´¦é¢ä¸Šçš„å·¨äºâ€¦â€¦è¿™äº›éƒ½å¯ä»¥é€šè¿‡è§¦å‘å™¨ï¼Œåœ¨å®é™…æ’å…¥æˆ–è€…æ›´æ–°æ“ä½œä¹‹å‰ï¼Œå¯¹ç›¸åº”çš„æ•°æ®è¿›è¡Œæ£€æŸ¥ï¼ŒåŠæ—¶æç¤ºé”™è¯¯ï¼Œé˜²æ­¢é”™è¯¯æ•°æ®è¿›å…¥ç³»ç»Ÿã€‚</p><h3 id="4-2-ç¼ºç‚¹"><a href="#4-2-ç¼ºç‚¹" class="headerlink" title="4.2 ç¼ºç‚¹"></a>4.2 ç¼ºç‚¹</h3><p><strong>1ã€è§¦å‘å™¨æœ€å¤§çš„ä¸€ä¸ªé—®é¢˜å°±æ˜¯å¯è¯»æ€§å·®ã€‚</strong></p><p>å› ä¸ºè§¦å‘å™¨å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œå¹¶ä¸”ç”±äº‹ä»¶é©±åŠ¨ï¼Œè¿™å°±æ„å‘³ç€è§¦å‘å™¨æœ‰å¯èƒ½<code>ä¸å—åº”ç”¨å±‚çš„æ§åˆ¶</code>ã€‚è¿™å¯¹ç³»ç»Ÿç»´æŠ¤æ˜¯éå¸¸æœ‰æŒ‘æˆ˜çš„ã€‚</p><p>æ¯”å¦‚ï¼Œåˆ›å»ºè§¦å‘å™¨ç”¨äºä¿®æ”¹ä¼šå‘˜å‚¨å€¼æ“ä½œã€‚å¦‚æœè§¦å‘å™¨ä¸­çš„æ“ä½œå‡ºäº†é—®é¢˜ï¼Œä¼šå¯¼è‡´ä¼šå‘˜å‚¨å€¼é‡‘é¢æ›´æ–°å¤±è´¥ã€‚æˆ‘ç”¨ä¸‹é¢çš„ä»£ç æ¼”ç¤ºä¸€ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; update demo.membermaster set memberdeposit=20 where memberid = 2;<br>ERROR 1054 (42S22): Unknown column &#x27;aa&#x27; in &#x27;field list&#x27;<br></code></pre></td></tr></table></figure><p>ç»“æœæ˜¾ç¤ºï¼Œç³»ç»Ÿæç¤ºé”™è¯¯ï¼Œå­—æ®µâ€œaaâ€ä¸å­˜åœ¨ã€‚</p><p>è¿™æ˜¯å› ä¸ºï¼Œè§¦å‘å™¨ä¸­çš„æ•°æ®æ’å…¥æ“ä½œå¤šäº†ä¸€ä¸ªå­—æ®µï¼Œç³»ç»Ÿæç¤ºé”™è¯¯ã€‚å¯æ˜¯ï¼Œå¦‚æœä½ ä¸äº†è§£è¿™ä¸ªè§¦å‘å™¨ï¼Œå¾ˆå¯èƒ½ä¼šè®¤ä¸ºæ˜¯æ›´æ–°è¯­å¥æœ¬èº«çš„é—®é¢˜ï¼Œæˆ–è€…æ˜¯ä¼šå‘˜ä¿¡æ¯è¡¨çš„ç»“æ„å‡ºäº†é—®é¢˜ã€‚è¯´ä¸å®šä½ è¿˜ä¼šç»™ä¼šå‘˜ä¿¡æ¯è¡¨æ·»åŠ ä¸€ä¸ªå«â€œaaâ€çš„å­—æ®µï¼Œè¯•å›¾è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œç»“æœåªèƒ½æ˜¯ç™½è´¹åŠ›ã€‚</p><p><strong>2ã€ç›¸å…³æ•°æ®çš„å˜æ›´ï¼Œå¯èƒ½ä¼šå¯¼è‡´è§¦å‘å™¨å‡ºé”™ã€‚</strong></p><p>ç‰¹åˆ«æ˜¯æ•°æ®è¡¨ç»“æ„çš„å˜æ›´ï¼Œéƒ½å¯èƒ½ä¼šå¯¼è‡´è§¦å‘å™¨å‡ºé”™ï¼Œè¿›è€Œå½±å“æ•°æ®æ“ä½œçš„æ­£å¸¸è¿è¡Œã€‚è¿™äº›éƒ½ä¼šç”±äºè§¦å‘å™¨æœ¬èº«çš„éšè”½æ€§ï¼Œå½±å“åˆ°åº”ç”¨ä¸­é”™è¯¯åŸå› æ’æŸ¥çš„æ•ˆç‡ã€‚</p><h3 id="4-3-æ³¨æ„ç‚¹"><a href="#4-3-æ³¨æ„ç‚¹" class="headerlink" title="4.3 æ³¨æ„ç‚¹"></a>4.3 æ³¨æ„ç‚¹</h3><p>æ³¨æ„ï¼Œå¦‚æœåœ¨å­è¡¨ä¸­å®šä¹‰äº†å¤–é”®çº¦æŸï¼Œå¹¶ä¸”å¤–é”®æŒ‡å®šäº†ON UPDATE/DELETE CASCADE/SET NULLå­å¥ï¼Œæ­¤æ—¶ä¿®æ”¹çˆ¶è¡¨è¢«å¼•ç”¨çš„é”®å€¼æˆ–åˆ é™¤çˆ¶è¡¨è¢«å¼•ç”¨çš„è®°å½•è¡Œæ—¶ï¼Œä¹Ÿä¼šå¼•èµ·å­è¡¨çš„ä¿®æ”¹å’Œåˆ é™¤æ“ä½œï¼Œæ­¤æ—¶åŸºäºå­è¡¨çš„UPDATEå’ŒDELETEè¯­å¥å®šä¹‰çš„è§¦å‘å™¨å¹¶ä¸ä¼šè¢«æ¿€æ´»ã€‚</p><p>ä¾‹å¦‚ï¼šåŸºäºå­è¡¨å‘˜å·¥è¡¨ï¼ˆt_employeeï¼‰çš„DELETEè¯­å¥å®šä¹‰äº†è§¦å‘å™¨t1ï¼Œè€Œå­è¡¨çš„éƒ¨é—¨ç¼–å·ï¼ˆdidï¼‰å­—æ®µå®šä¹‰äº†å¤–é”®çº¦æŸå¼•ç”¨äº†çˆ¶è¡¨éƒ¨é—¨è¡¨ï¼ˆt_departmentï¼‰çš„ä¸»é”®åˆ—éƒ¨é—¨ç¼–å·ï¼ˆdidï¼‰ï¼Œå¹¶ä¸”è¯¥å¤–é”®åŠ äº†â€œON DELETE SET NULLâ€å­å¥ï¼Œé‚£ä¹ˆå¦‚æœæ­¤æ—¶åˆ é™¤çˆ¶è¡¨éƒ¨é—¨è¡¨ï¼ˆt_departmentï¼‰åœ¨å­è¡¨å‘˜å·¥è¡¨ï¼ˆt_employeeï¼‰æœ‰åŒ¹é…è®°å½•çš„éƒ¨é—¨è®°å½•æ—¶ï¼Œä¼šå¼•èµ·å­è¡¨å‘˜å·¥è¡¨ï¼ˆt_employeeï¼‰åŒ¹é…è®°å½•çš„éƒ¨é—¨ç¼–å·ï¼ˆdidï¼‰ä¿®æ”¹ä¸ºNULLï¼Œä½†æ˜¯æ­¤æ—¶ä¸ä¼šæ¿€æ´»è§¦å‘å™¨t1ã€‚åªæœ‰ç›´æ¥å¯¹å­è¡¨å‘˜å·¥è¡¨ï¼ˆt_employeeï¼‰æ‰§è¡ŒDELETEè¯­å¥æ—¶æ‰ä¼šæ¿€æ´»è§¦å‘å™¨t1ã€‚</p><h1 id="ç¬¬18ç« -MySQL8å…¶å®ƒæ–°ç‰¹æ€§"><a href="#ç¬¬18ç« -MySQL8å…¶å®ƒæ–°ç‰¹æ€§" class="headerlink" title="ç¬¬18ç« _MySQL8å…¶å®ƒæ–°ç‰¹æ€§"></a>ç¬¬18ç« _MySQL8å…¶å®ƒæ–°ç‰¹æ€§</h1><h2 id="1-MySQL8æ–°ç‰¹æ€§æ¦‚è¿°"><a href="#1-MySQL8æ–°ç‰¹æ€§æ¦‚è¿°" class="headerlink" title="1. MySQL8æ–°ç‰¹æ€§æ¦‚è¿°"></a>1. MySQL8æ–°ç‰¹æ€§æ¦‚è¿°</h2><p><code>MySQLä»5.7ç‰ˆæœ¬ç›´æ¥è·³è·ƒå‘å¸ƒäº†8.0ç‰ˆæœ¬</code>ï¼Œå¯è§è¿™æ˜¯ä¸€ä¸ªä»¤äººå…´å¥‹çš„é‡Œç¨‹ç¢‘ç‰ˆæœ¬ã€‚MySQL 8ç‰ˆæœ¬åœ¨åŠŸèƒ½ä¸Šåšäº†æ˜¾è‘—çš„æ”¹è¿›ä¸å¢å¼ºï¼Œå¼€å‘è€…å¯¹MySQLçš„æºä»£ç è¿›è¡Œäº†é‡æ„ï¼Œæœ€çªå‡ºçš„ä¸€ç‚¹æ˜¯å¤šMySQL Optimizerä¼˜åŒ–å™¨è¿›è¡Œäº†æ”¹è¿›ã€‚ä¸ä»…åœ¨é€Ÿåº¦ä¸Šå¾—åˆ°äº†æ”¹å–„ï¼Œè¿˜ä¸ºç”¨æˆ·å¸¦æ¥äº†æ›´å¥½çš„æ€§èƒ½å’Œæ›´æ£’çš„ä½“éªŒã€‚</p><h3 id="1-1-MySQL8-0-æ–°å¢ç‰¹æ€§"><a href="#1-1-MySQL8-0-æ–°å¢ç‰¹æ€§" class="headerlink" title="1.1 MySQL8.0 æ–°å¢ç‰¹æ€§"></a>1.1 MySQL8.0 æ–°å¢ç‰¹æ€§</h3><p><strong>1. æ›´ç®€ä¾¿çš„NoSQLæ”¯æŒ</strong><br>NoSQLæ³›æŒ‡éå…³ç³»å‹æ•°æ®åº“å’Œæ•°æ®å­˜å‚¨ã€‚éšç€äº’è”ç½‘å¹³å°çš„è§„æ¨¡é£é€Ÿå‘å±•ï¼Œä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“å·²ç»è¶Šæ¥è¶Šä¸èƒ½æ»¡è¶³éœ€æ±‚ã€‚ä»5.6ç‰ˆæœ¬å¼€å§‹ï¼ŒMySQLå°±å¼€å§‹æ”¯æŒç®€å•çš„NoSQLå­˜å‚¨åŠŸèƒ½ã€‚MySQL 8å¯¹è¿™ä¸€åŠŸèƒ½åšäº†ä¼˜åŒ–ï¼Œä»¥æ›´çµæ´»çš„æ–¹å¼å®ç°NoSQLåŠŸèƒ½ï¼Œä¸å†ä¾èµ–æ¨¡å¼ï¼ˆschemaï¼‰ã€‚</p><p><strong>2. æ›´å¥½çš„ç´¢å¼•</strong><br>åœ¨æŸ¥è¯¢ä¸­ï¼Œæ­£ç¡®åœ°ä½¿ç”¨ç´¢å¼•å¯ä»¥æé«˜æŸ¥è¯¢çš„æ•ˆç‡ã€‚MySQL 8ä¸­æ–°å¢äº†<code>éšè—ç´¢å¼•</code>å’Œ<code>é™åºç´¢å¼•</code>ã€‚éšè—ç´¢å¼•å¯ä»¥ç”¨æ¥æµ‹è¯•å»æ‰ç´¢å¼•å¯¹æŸ¥è¯¢æ€§èƒ½çš„å½±å“ã€‚åœ¨æŸ¥è¯¢ä¸­æ··åˆå­˜åœ¨å¤šåˆ—ç´¢å¼•æ—¶ï¼Œä½¿ç”¨é™åºç´¢å¼•å¯ä»¥æé«˜æŸ¥è¯¢çš„æ€§èƒ½ã€‚</p><p><strong>3.æ›´å®Œå–„çš„JSONæ”¯æŒ</strong><br>MySQLä»5.7å¼€å§‹æ”¯æŒåŸç”ŸJSONæ•°æ®çš„å­˜å‚¨ï¼ŒMySQL 8å¯¹è¿™ä¸€åŠŸèƒ½åšäº†ä¼˜åŒ–ï¼Œå¢åŠ äº†èšåˆå‡½æ•°<code>JSON_ARRAYAGG()</code>å’Œ<code>JSON_OBJECTAGG()</code>ï¼Œå°†å‚æ•°èšåˆä¸ºJSONæ•°ç»„æˆ–å¯¹è±¡ï¼Œæ–°å¢äº†è¡Œå†…æ“ä½œç¬¦ -&gt;&gt;ï¼Œæ˜¯åˆ—è·¯å¾„è¿ç®—ç¬¦ -&gt;çš„å¢å¼ºï¼Œå¯¹JSONæ’åºåšäº†æå‡ï¼Œå¹¶ä¼˜åŒ–äº†JSONçš„æ›´æ–°æ“ä½œã€‚</p><p><strong>4.å®‰å…¨å’Œè´¦æˆ·ç®¡ç†</strong><br>MySQL 8ä¸­æ–°å¢äº†<code>caching_sha2_password</code> æˆæƒæ’ä»¶ã€è§’è‰²ã€å¯†ç å†å²è®°å½•å’ŒFIPSæ¨¡å¼æ”¯æŒï¼Œè¿™äº›ç‰¹æ€§æé«˜äº†æ•°æ®åº“çš„å®‰å…¨æ€§å’Œæ€§èƒ½ï¼Œä½¿æ•°æ®åº“ç®¡ç†å‘˜èƒ½å¤Ÿæ›´çµæ´»åœ°è¿›è¡Œè´¦æˆ·ç®¡ç†å·¥ä½œã€‚</p><p><strong>5.InnoDBçš„å˜åŒ–</strong><br><code>InnoDBæ˜¯MySQLé»˜è®¤çš„å­˜å‚¨å¼•æ“</code>ï¼Œæ˜¯äº‹åŠ¡å‹æ•°æ®åº“çš„é¦–é€‰å¼•æ“ï¼Œæ”¯æŒäº‹åŠ¡å®‰å…¨è¡¨ï¼ˆACIDï¼‰ï¼Œæ”¯æŒè¡Œé”å®šå’Œå¤–é”®ã€‚åœ¨MySQL 8 ç‰ˆæœ¬ä¸­ï¼ŒInnoDBåœ¨è‡ªå¢ã€ç´¢å¼•ã€åŠ å¯†ã€æ­»é”ã€å…±äº«é”ç­‰æ–¹é¢åšäº†å¤§é‡çš„<code>æ”¹è¿›å’Œä¼˜åŒ–</code>ï¼Œå¹¶ä¸”æ”¯æŒåŸå­æ•°æ®å®šä¹‰è¯­è¨€ï¼ˆDDLï¼‰ï¼Œæé«˜äº†æ•°æ®å®‰å…¨æ€§ï¼Œå¯¹äº‹åŠ¡æä¾›æ›´å¥½çš„æ”¯æŒã€‚</p><p><strong>6.æ•°æ®å­—å…¸</strong><br>åœ¨ä¹‹å‰çš„MySQLç‰ˆæœ¬ä¸­ï¼Œå­—å…¸æ•°æ®éƒ½å­˜å‚¨åœ¨å…ƒæ•°æ®æ–‡ä»¶å’Œéäº‹åŠ¡è¡¨ä¸­ã€‚ä»MySQL 8å¼€å§‹æ–°å¢äº†äº‹åŠ¡æ•°æ®å­—å…¸ï¼Œåœ¨è¿™ä¸ªå­—å…¸é‡Œå­˜å‚¨ç€æ•°æ®åº“å¯¹è±¡ä¿¡æ¯ï¼Œè¿™äº›æ•°æ®å­—å…¸å­˜å‚¨åœ¨å†…éƒ¨äº‹åŠ¡è¡¨ä¸­ã€‚</p><p><strong>7. åŸå­æ•°æ®å®šä¹‰è¯­å¥</strong><br>MySQL 8å¼€å§‹æ”¯æŒåŸå­æ•°æ®å®šä¹‰è¯­å¥ï¼ˆAutomic DDLï¼‰ï¼Œå³<code>åŸå­DDL</code>ã€‚ç›®å‰ï¼Œåªæœ‰InnoDBå­˜å‚¨å¼•æ“æ”¯æŒåŸå­DDLã€‚åŸå­æ•°æ®å®šä¹‰è¯­å¥ï¼ˆDDLï¼‰å°†ä¸DDLæ“ä½œç›¸å…³çš„æ•°æ®å­—å…¸æ›´æ–°ã€å­˜å‚¨å¼•æ“æ“ä½œã€äºŒè¿›åˆ¶æ—¥å¿—å†™å…¥ç»“åˆåˆ°ä¸€ä¸ªå•ç‹¬çš„åŸå­äº‹åŠ¡ä¸­ï¼Œè¿™ä½¿å¾—å³ä½¿æœåŠ¡å™¨å´©æºƒï¼Œäº‹åŠ¡ä¹Ÿä¼šæäº¤æˆ–å›æ»šã€‚<br>ä½¿ç”¨æ”¯æŒåŸå­æ“ä½œçš„å­˜å‚¨å¼•æ“æ‰€åˆ›å»ºçš„è¡¨ï¼Œåœ¨æ‰§è¡ŒDROP TABLEã€CREATE TABLEã€ALTER TABLEã€ RENAME TABLEã€TRUNCATE TABLEã€CREATE TABLESPACEã€DROP TABLESPACEç­‰æ“ä½œæ—¶ï¼Œéƒ½æ”¯æŒåŸå­æ“ä½œï¼Œå³äº‹åŠ¡è¦ä¹ˆå®Œå…¨æ“ä½œæˆåŠŸï¼Œè¦ä¹ˆå¤±è´¥åå›æ»šï¼Œä¸å†è¿›è¡Œéƒ¨åˆ†æäº¤ã€‚<br>å¯¹äºä»MySQL 5.7å¤åˆ¶åˆ°MySQL 8 ç‰ˆæœ¬ä¸­çš„è¯­å¥ï¼Œå¯ä»¥æ·»åŠ <code>IF EXISTS</code>æˆ–<code>IF NOT EXISTS</code>è¯­å¥æ¥é¿å…å‘ç”Ÿé”™è¯¯ã€‚</p><p><strong>8.èµ„æºç®¡ç†</strong><br>MySQL 8å¼€å§‹æ”¯æŒåˆ›å»ºå’Œç®¡ç†èµ„æºç»„ï¼Œå…è®¸å°†æœåŠ¡å™¨å†…è¿è¡Œçš„çº¿ç¨‹åˆ†é…ç»™ç‰¹å®šçš„åˆ†ç»„ï¼Œä»¥ä¾¿çº¿ç¨‹æ ¹æ®ç»„å†…å¯ç”¨èµ„æºæ‰§è¡Œã€‚ç»„å±æ€§èƒ½å¤Ÿæ§åˆ¶ç»„å†…èµ„æºï¼Œå¯ç”¨æˆ–é™åˆ¶ç»„å†…èµ„æºæ¶ˆè€—ã€‚æ•°æ®åº“ç®¡ç†å‘˜èƒ½å¤Ÿæ ¹æ®ä¸åŒçš„å·¥ä½œè´Ÿè½½é€‚å½“åœ°æ›´æ”¹è¿™äº›å±æ€§ã€‚<br>ç›®å‰ï¼ŒCPUæ—¶é—´æ˜¯å¯æ§èµ„æºï¼Œç”±â€œè™šæ‹ŸCPUâ€è¿™ä¸ªæ¦‚å¿µæ¥è¡¨ç¤ºï¼Œæ­¤æœ¯è¯­åŒ…å«CPUçš„æ ¸å¿ƒæ•°ï¼Œè¶…çº¿ç¨‹ï¼Œç¡¬ä»¶çº¿ç¨‹ç­‰ç­‰ã€‚æœåŠ¡å™¨åœ¨å¯åŠ¨æ—¶ç¡®å®šå¯ç”¨çš„è™šæ‹ŸCPUæ•°é‡ã€‚æ‹¥æœ‰å¯¹åº”æƒé™çš„æ•°æ®åº“ç®¡ç†å‘˜å¯ä»¥å°†è¿™äº›CPUä¸èµ„æºç»„å…³è”ï¼Œå¹¶ä¸ºèµ„æºç»„åˆ†é…çº¿ç¨‹ã€‚<br>èµ„æºç»„ç»„ä»¶ä¸ºMySQLä¸­çš„èµ„æºç»„ç®¡ç†æä¾›äº†SQLæ¥å£ã€‚èµ„æºç»„çš„å±æ€§ç”¨äºå®šä¹‰èµ„æºç»„ã€‚MySQLä¸­å­˜åœ¨ä¸¤ä¸ªé»˜è®¤ç»„ï¼Œç³»ç»Ÿç»„å’Œç”¨æˆ·ç»„ï¼Œé»˜è®¤çš„ç»„ä¸èƒ½è¢«åˆ é™¤ï¼Œå…¶å±æ€§ä¹Ÿä¸èƒ½è¢«æ›´æ”¹ã€‚å¯¹äºç”¨æˆ·è‡ªå®šä¹‰çš„ç»„ï¼Œèµ„æºç»„åˆ›å»ºæ—¶å¯åˆå§‹åŒ–æ‰€æœ‰çš„å±æ€§ï¼Œé™¤å»åå­—å’Œç±»å‹ï¼Œå…¶ä»–å±æ€§éƒ½å¯åœ¨åˆ›å»ºä¹‹åè¿›è¡Œæ›´æ”¹ã€‚<br>åœ¨ä¸€äº›å¹³å°ä¸‹ï¼Œæˆ–è¿›è¡Œäº†æŸäº›MySQLçš„é…ç½®æ—¶ï¼Œèµ„æºç®¡ç†çš„åŠŸèƒ½å°†å—åˆ°é™åˆ¶ï¼Œç”šè‡³ä¸å¯ç”¨ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå®‰è£…äº†çº¿ç¨‹æ± æ’ä»¶ï¼Œæˆ–è€…ä½¿ç”¨çš„æ˜¯macOSç³»ç»Ÿï¼Œèµ„æºç®¡ç†å°†å¤„äºä¸å¯ç”¨çŠ¶æ€ã€‚åœ¨FreeBSDå’ŒSolarisç³»ç»Ÿä¸­ï¼Œèµ„æºçº¿ç¨‹ä¼˜å…ˆçº§å°†å¤±æ•ˆã€‚åœ¨Linuxç³»ç»Ÿä¸­ï¼Œåªæœ‰é…ç½®äº†CAP_SYS_NICEå±æ€§ï¼Œèµ„æºç®¡ç†ä¼˜å…ˆçº§æ‰èƒ½å‘æŒ¥ä½œç”¨ã€‚</p><p><strong>9.å­—ç¬¦é›†æ”¯æŒ</strong><br>MySQL 8ä¸­é»˜è®¤çš„å­—ç¬¦é›†ç”±<code>latin1</code>æ›´æ”¹ä¸º<code>utf8mb4</code>ï¼ˆæœ€å¤šå››ä¸ªå­—èŠ‚è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ï¼Œå½“ç„¶æ±‰å­—è¿˜æ˜¯å ä¸‰ä¸ªå­—èŠ‚ï¼‰ï¼Œå¹¶é¦–æ¬¡å¢åŠ äº†æ—¥è¯­æ‰€ç‰¹å®šä½¿ç”¨çš„é›†åˆï¼Œutf8mb4_ja_0900_as_csã€‚</p><p><strong>10.ä¼˜åŒ–å™¨å¢å¼º</strong><br>MySQLä¼˜åŒ–å™¨å¼€å§‹æ”¯æŒéšè—ç´¢å¼•å’Œé™åºç´¢å¼•ã€‚éšè—ç´¢å¼•ä¸ä¼šè¢«ä¼˜åŒ–å™¨ä½¿ç”¨ï¼ŒéªŒè¯ç´¢å¼•çš„å¿…è¦æ€§æ—¶ä¸éœ€è¦åˆ é™¤ç´¢å¼•ï¼Œå…ˆå°†ç´¢å¼•éšè—ï¼Œå¦‚æœä¼˜åŒ–å™¨æ€§èƒ½æ— å½±å“å°±å¯ä»¥çœŸæ­£åœ°åˆ é™¤ç´¢å¼•ã€‚é™åºç´¢å¼•å…è®¸ä¼˜åŒ–å™¨å¯¹å¤šä¸ªåˆ—è¿›è¡Œæ’åºï¼Œå¹¶ä¸”å…è®¸æ’åºé¡ºåºä¸ä¸€è‡´ã€‚</p><p><strong>11.å…¬ç”¨è¡¨è¡¨è¾¾å¼</strong><br>å…¬ç”¨è¡¨è¡¨è¾¾å¼ï¼ˆCommon Table Expressionsï¼‰ç®€ç§°ä¸ºCTEï¼ŒMySQLç°åœ¨æ”¯æŒé€’å½’å’Œéé€’å½’ä¸¤ç§å½¢å¼çš„CTEã€‚CTEé€šè¿‡åœ¨SELECTè¯­å¥æˆ–å…¶ä»–ç‰¹å®šè¯­å¥å‰<code>ä½¿ç”¨WITHè¯­å¥å¯¹ä¸´æ—¶ç»“æœé›†</code>è¿›è¡Œå‘½åã€‚<strong>å…¬ç”¨è¡¨çš„ä½œç”¨åŸŸæ˜¯æ•´ä¸ªä¼šè¯</strong></p><p>åŸºç¡€è¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs oxygene"><span class="hljs-keyword">WITH</span> cte_name (col_name1,col_name2 ...) <span class="hljs-keyword">AS</span> (Subquery)<br><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> cte_name;<br></code></pre></td></tr></table></figure><p>Subqueryä»£è¡¨å­æŸ¥è¯¢ï¼Œå­æŸ¥è¯¢å‰ä½¿ç”¨WITHè¯­å¥å°†ç»“æœé›†å‘½åä¸ºcte_nameï¼Œåœ¨åç»­çš„æŸ¥è¯¢ä¸­å³å¯ä½¿ç”¨cte_nameè¿›è¡ŒæŸ¥è¯¢ã€‚</p><p><strong>12.çª—å£å‡½æ•°</strong><br>MySQL 8å¼€å§‹æ”¯æŒçª—å£å‡½æ•°ã€‚åœ¨ä¹‹å‰çš„ç‰ˆæœ¬ä¸­å·²å­˜åœ¨çš„å¤§éƒ¨åˆ†<code>èšåˆå‡½æ•°</code>åœ¨MySQL 8ä¸­ä¹Ÿå¯ä»¥ä½œä¸ºçª—å£å‡½æ•°æ¥ä½¿ç”¨ã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20210730165317542.png"></p><p><strong>13.æ­£åˆ™è¡¨è¾¾å¼æ”¯æŒ</strong><br>MySQLåœ¨8.0.4ä»¥åçš„ç‰ˆæœ¬ä¸­é‡‡ç”¨æ”¯æŒUnicodeçš„å›½é™…åŒ–ç»„ä»¶åº“å®ç°æ­£åˆ™è¡¨è¾¾å¼æ“ä½œï¼Œè¿™ç§æ–¹å¼ä¸ä»…èƒ½æä¾›å®Œå…¨çš„Unicodeæ”¯æŒï¼Œè€Œä¸”æ˜¯å¤šå­—èŠ‚å®‰å…¨ç¼–ç ã€‚MySQLå¢åŠ äº†REGEXP_LIKE()ã€EGEXP_INSTR()ã€REGEXP_REPLACE()å’Œ REGEXP_SUBSTR()ç­‰å‡½æ•°æ¥æå‡æ€§èƒ½ã€‚å¦å¤–ï¼Œregexp_stack_limitå’Œregexp_time_limit ç³»ç»Ÿå˜é‡èƒ½å¤Ÿé€šè¿‡åŒ¹é…å¼•æ“æ¥æ§åˆ¶èµ„æºæ¶ˆè€—ã€‚</p><p><strong>14.å†…éƒ¨ä¸´æ—¶è¡¨</strong><br><code>TempTableå­˜å‚¨å¼•æ“å–ä»£MEMORYå­˜å‚¨å¼•æ“æˆä¸ºå†…éƒ¨ä¸´æ—¶è¡¨çš„é»˜è®¤å­˜å‚¨å¼•æ“</code>ã€‚TempTableå­˜å‚¨å¼•æ“ä¸ºVARCHARå’ŒVARBINARYåˆ—æä¾›é«˜æ•ˆå­˜å‚¨ã€‚internal_tmp_mem_storage_engineä¼šè¯å˜é‡å®šä¹‰äº†å†…éƒ¨ä¸´æ—¶è¡¨çš„å­˜å‚¨å¼•æ“ï¼Œå¯é€‰çš„å€¼æœ‰ä¸¤ä¸ªï¼ŒTempTableå’ŒMEMORYï¼Œå…¶ä¸­TempTableä¸ºé»˜è®¤çš„å­˜å‚¨å¼•æ“ã€‚temptable_max_ramç³»ç»Ÿé…ç½®é¡¹å®šä¹‰äº†TempTableå­˜å‚¨å¼•æ“å¯ä½¿ç”¨çš„æœ€å¤§å†…å­˜æ•°é‡ã€‚</p><p><strong>15.æ—¥å¿—è®°å½•</strong><br>åœ¨MySQL 8ä¸­é”™è¯¯æ—¥å¿—å­ç³»ç»Ÿç”±ä¸€ç³»åˆ—MySQLç»„ä»¶æ„æˆã€‚è¿™äº›ç»„ä»¶çš„æ„æˆç”±ç³»ç»Ÿå˜é‡log_error_servicesæ¥é…ç½®ï¼Œèƒ½å¤Ÿå®ç°æ—¥å¿—äº‹ä»¶çš„è¿‡æ»¤å’Œå†™å…¥ã€‚</p><p><strong>16.å¤‡ä»½é”</strong><br>æ–°çš„å¤‡ä»½é”å…è®¸åœ¨çº¿å¤‡ä»½æœŸé—´æ‰§è¡Œæ•°æ®æ“ä½œè¯­å¥ï¼ŒåŒæ—¶é˜»æ­¢å¯èƒ½é€ æˆå¿«ç…§ä¸ä¸€è‡´çš„æ“ä½œã€‚æ–°å¤‡ä»½é”ç”± LOCK INSTANCE FOR BACKUP å’Œ UNLOCK INSTANCE è¯­æ³•æä¾›æ”¯æŒï¼Œæ‰§è¡Œè¿™äº›æ“ä½œéœ€è¦å¤‡ä»½ç®¡ç†å‘˜ç‰¹æƒã€‚</p><p><strong>17.å¢å¼ºçš„MySQLå¤åˆ¶</strong><br>MySQL 8å¤åˆ¶æ”¯æŒå¯¹<code>JSONæ–‡æ¡£</code>è¿›è¡Œéƒ¨åˆ†æ›´æ–°çš„<code>äºŒè¿›åˆ¶æ—¥å¿—è®°å½•</code>ï¼Œè¯¥è®°å½•<code>ä½¿ç”¨ç´§å‡‘çš„äºŒè¿›åˆ¶æ ¼å¼</code>ï¼Œä»è€ŒèŠ‚çœè®°å½•å®Œæ•´JSONæ–‡æ¡£çš„ç©ºé—´ã€‚å½“ä½¿ç”¨åŸºäºè¯­å¥çš„æ—¥å¿—è®°å½•æ—¶ï¼Œè¿™ç§ç´§å‡‘çš„æ—¥å¿—è®°å½•ä¼šè‡ªåŠ¨å®Œæˆï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡å°†æ–°çš„binlog_row_value_optionsç³»ç»Ÿå˜é‡å€¼è®¾ç½®ä¸ºPARTIAL_JSONæ¥å¯ç”¨ã€‚</p><h3 id="1-2-MySQL8-0ç§»é™¤çš„æ—§ç‰¹æ€§"><a href="#1-2-MySQL8-0ç§»é™¤çš„æ—§ç‰¹æ€§" class="headerlink" title="1.2 MySQL8.0ç§»é™¤çš„æ—§ç‰¹æ€§"></a>1.2 MySQL8.0ç§»é™¤çš„æ—§ç‰¹æ€§</h3><p>åœ¨MySQL 5.7ç‰ˆæœ¬ä¸Šå¼€å‘çš„åº”ç”¨ç¨‹åºå¦‚æœä½¿ç”¨äº†MySQL8.0 ç§»é™¤çš„ç‰¹æ€§ï¼Œè¯­å¥å¯èƒ½ä¼šå¤±è´¥ï¼Œæˆ–è€…äº§ç”Ÿä¸åŒçš„æ‰§è¡Œç»“æœã€‚ä¸ºäº†é¿å…è¿™äº›é—®é¢˜ï¼Œå¯¹äºä½¿ç”¨äº†ç§»é™¤ç‰¹æ€§çš„åº”ç”¨ï¼Œåº”å½“å°½åŠ›ä¿®æ­£é¿å…ä½¿ç”¨è¿™äº›ç‰¹æ€§ï¼Œå¹¶å°½å¯èƒ½ä½¿ç”¨æ›¿ä»£æ–¹æ³•ã€‚</p><p><strong>1. æŸ¥è¯¢ç¼“å­˜</strong><br><code>æŸ¥è¯¢ç¼“å­˜å·²è¢«ç§»é™¤</code>ï¼Œåˆ é™¤çš„é¡¹æœ‰ï¼š<br><strong>ï¼ˆ1ï¼‰è¯­å¥ï¼š</strong>FLUSH QUERY CACHEå’ŒRESET QUERY CACHEã€‚<br><strong>ï¼ˆ2ï¼‰ç³»ç»Ÿå˜é‡ï¼š</strong>query_cache_limitã€query_cache_min_res_unitã€query_cache_sizeã€query_cache_typeã€query_cache_wlock_invalidateã€‚<br><strong>ï¼ˆ3ï¼‰çŠ¶æ€å˜é‡ï¼š</strong>Qcache_free_blocksã€Qcache_free_memoryã€Qcache_hitsã€Qcache_insertsã€Qcache_lowmem_prunesã€Qcache_not_cachedã€Qcache_queries_in_cacheã€Qcache_total_blocksã€‚<br><strong>ï¼ˆ4ï¼‰çº¿ç¨‹çŠ¶æ€ï¼š</strong>checking privileges on cached queryã€checking query cache for queryã€invalidating query cache entriesã€sending cached result to clientã€storing result in query cacheã€waiting for query cache lockã€‚</p><p><strong>2.åŠ å¯†ç›¸å…³</strong><br>åˆ é™¤çš„åŠ å¯†ç›¸å…³çš„å†…å®¹æœ‰ï¼šENCODE()ã€DECODE()ã€ENCRYPT()ã€DES_ENCRYPT()å’ŒDES_DECRYPT()å‡½æ•°ï¼Œé…ç½®é¡¹des-key-fileï¼Œç³»ç»Ÿå˜é‡have_cryptï¼ŒFLUSHè¯­å¥çš„DES_KEY_FILEé€‰é¡¹ï¼ŒHAVE_CRYPT CMakeé€‰é¡¹ã€‚<br>å¯¹äºç§»é™¤çš„ENCRYPT()å‡½æ•°ï¼Œè€ƒè™‘ä½¿ç”¨SHA2()æ›¿ä»£ï¼Œå¯¹äºå…¶ä»–ç§»é™¤çš„å‡½æ•°ï¼Œä½¿ç”¨AES_ENCRYPT()å’ŒAES_DECRYPT()æ›¿ä»£ã€‚</p><p><strong>3.ç©ºé—´å‡½æ•°ç›¸å…³</strong><br>åœ¨MySQL 5.7ç‰ˆæœ¬ä¸­ï¼Œå¤šä¸ªç©ºé—´å‡½æ•°å·²è¢«æ ‡è®°ä¸ºè¿‡æ—¶ã€‚è¿™äº›è¿‡æ—¶å‡½æ•°åœ¨MySQL 8ä¸­éƒ½å·²è¢«ç§»é™¤ï¼Œåªä¿ç•™äº†å¯¹åº”çš„ST_å’ŒMBRå‡½æ•°ã€‚</p><p><strong>4.\Nå’ŒNULL</strong><br>åœ¨SQLè¯­å¥ä¸­ï¼Œè§£æå™¨ä¸å†å°†\Nè§†ä¸ºNULLï¼Œæ‰€ä»¥åœ¨SQLè¯­å¥ä¸­åº”ä½¿ç”¨NULLä»£æ›¿\Nã€‚è¿™é¡¹å˜åŒ–ä¸ä¼šå½±å“ä½¿ç”¨LOAD DATA INFILEæˆ–è€…SELECTâ€¦INTO OUTFILEæ“ä½œæ–‡ä»¶çš„å¯¼å…¥å’Œå¯¼å‡ºã€‚åœ¨è¿™ç±»æ“ä½œä¸­ï¼ŒNULLä»ç­‰åŒäº\Nã€‚</p><p><strong>5. mysql_install_db</strong><br>åœ¨MySQLåˆ†å¸ƒä¸­ï¼Œå·²ç§»é™¤äº†mysql_install_dbç¨‹åºï¼Œæ•°æ®å­—å…¸åˆå§‹åŒ–éœ€è¦è°ƒç”¨å¸¦ç€â€“initializeæˆ–è€…â€“initialize-insecureé€‰é¡¹çš„mysqldæ¥ä»£æ›¿å®ç°ã€‚å¦å¤–ï¼Œâ€“bootstrapå’ŒINSTALL_SCRIPTDIR CMakeä¹Ÿå·²è¢«åˆ é™¤ã€‚</p><p><strong>6.é€šç”¨åˆ†åŒºå¤„ç†ç¨‹åº</strong><br>é€šç”¨åˆ†åŒºå¤„ç†ç¨‹åºå·²ä»MySQLæœåŠ¡ä¸­è¢«ç§»é™¤ã€‚ä¸ºäº†å®ç°ç»™å®šè¡¨åˆ†åŒºï¼Œè¡¨æ‰€ä½¿ç”¨çš„å­˜å‚¨å¼•æ“éœ€è¦è‡ªæœ‰çš„åˆ†åŒºå¤„ç†ç¨‹åºã€‚<br>æä¾›æœ¬åœ°åˆ†åŒºæ”¯æŒçš„MySQLå­˜å‚¨å¼•æ“æœ‰ä¸¤ä¸ªï¼Œå³InnoDBå’ŒNDBï¼Œè€Œåœ¨MySQL 8ä¸­åªæ”¯æŒInnoDBã€‚</p><p><strong>7.ç³»ç»Ÿå’ŒçŠ¶æ€å˜é‡ä¿¡æ¯</strong><br>åœ¨INFORMATION_SCHEMAæ•°æ®åº“ä¸­ï¼Œå¯¹ç³»ç»Ÿå’ŒçŠ¶æ€å˜é‡ä¿¡æ¯ä¸å†è¿›è¡Œç»´æŠ¤ã€‚GLOBAL_VARIABLESã€SESSION_VARIABLESã€GLOBAL_STATUSã€SESSION_STATUSè¡¨éƒ½å·²è¢«åˆ é™¤ã€‚å¦å¤–ï¼Œç³»ç»Ÿå˜é‡show_compatibility_56ä¹Ÿå·²è¢«åˆ é™¤ã€‚è¢«åˆ é™¤çš„çŠ¶æ€å˜é‡æœ‰Slave_heartbeat_periodã€Slave_last_heartbeat,Slave_received_heartbeatsã€Slave_retried_transactionsã€Slave_runningã€‚ä»¥ä¸Šè¢«åˆ é™¤çš„å†…å®¹éƒ½å¯ä½¿ç”¨æ€§èƒ½æ¨¡å¼ä¸­å¯¹åº”çš„å†…å®¹è¿›è¡Œæ›¿ä»£ã€‚</p><p><strong>8.mysql_pluginå·¥å…·</strong><br>mysql_pluginå·¥å…·ç”¨æ¥é…ç½®MySQLæœåŠ¡å™¨æ’ä»¶ï¼Œç°å·²è¢«åˆ é™¤ï¼Œå¯ä½¿ç”¨â€“plugin-loadæˆ–â€“plugin-load-addé€‰é¡¹åœ¨æœåŠ¡å™¨å¯åŠ¨æ—¶åŠ è½½æ’ä»¶æˆ–è€…åœ¨è¿è¡Œæ—¶ä½¿ç”¨INSTALL PLUGINè¯­å¥åŠ è½½æ’ä»¶æ¥æ›¿ä»£è¯¥å·¥å…·ã€‚</p><h2 id="2-æ–°ç‰¹æ€§1ï¼šçª—å£å‡½æ•°"><a href="#2-æ–°ç‰¹æ€§1ï¼šçª—å£å‡½æ•°" class="headerlink" title="2. æ–°ç‰¹æ€§1ï¼šçª—å£å‡½æ•°"></a>2. æ–°ç‰¹æ€§1ï¼šçª—å£å‡½æ•°</h2><h3 id="2-1-ä½¿ç”¨çª—å£å‡½æ•°å‰åå¯¹æ¯”"><a href="#2-1-ä½¿ç”¨çª—å£å‡½æ•°å‰åå¯¹æ¯”" class="headerlink" title="2.1 ä½¿ç”¨çª—å£å‡½æ•°å‰åå¯¹æ¯”"></a>2.1 ä½¿ç”¨çª—å£å‡½æ•°å‰åå¯¹æ¯”</h3><p>å‡è®¾æˆ‘ç°åœ¨æœ‰è¿™æ ·ä¸€ä¸ªæ•°æ®è¡¨ï¼Œå®ƒæ˜¾ç¤ºäº†æŸè´­ç‰©ç½‘ç«™åœ¨æ¯ä¸ªåŸå¸‚æ¯ä¸ªåŒºçš„é”€å”®é¢ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE TABLE sales(<br>id INT PRIMARY KEY AUTO_INCREMENT,<br>city VARCHAR(15),<br>county VARCHAR(15),<br>sales_value DECIMAL<br><br>);<br><br>INSERT INTO sales(city,county,sales_value)<br>VALUES<br>(&#x27;åŒ—äº¬&#x27;,&#x27;æµ·æ·€&#x27;,10.00),<br>(&#x27;åŒ—äº¬&#x27;,&#x27;æœé˜³&#x27;,20.00),<br>(&#x27;ä¸Šæµ·&#x27;,&#x27;é»„åŸ”&#x27;,30.00),<br>(&#x27;ä¸Šæµ·&#x27;,&#x27;é•¿å®&#x27;,10.00);<br></code></pre></td></tr></table></figure><p>æŸ¥è¯¢ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT * FROM sales;<br>+----+------+--------+-------------+<br>| id | city | county | sales_value |<br>+----+------+--------+-------------+<br>|  1 | åŒ—äº¬ | æµ·æ·€    |          10 |<br>|  2 | åŒ—äº¬ | æœé˜³    |          20 |<br>|  3 | ä¸Šæµ· | é»„åŸ”    |          30 |<br>|  4 | ä¸Šæµ· | é•¿å®    |          10 |<br>+----+------+--------+-------------+<br>4 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><p><strong>éœ€æ±‚ï¼š</strong>ç°åœ¨è®¡ç®—è¿™ä¸ªç½‘ç«™åœ¨æ¯ä¸ªåŸå¸‚çš„é”€å”®æ€»é¢ã€åœ¨å…¨å›½çš„é”€å”®æ€»é¢ã€æ¯ä¸ªåŒºçš„é”€å”®é¢å æ‰€åœ¨åŸå¸‚é”€å”®é¢ä¸­çš„æ¯”ç‡ï¼Œä»¥åŠå æ€»é”€å”®é¢ä¸­çš„æ¯”ç‡ã€‚</p><p>å¦‚æœç”¨åˆ†ç»„å’Œèšåˆå‡½æ•°ï¼Œå°±éœ€è¦åˆ†å¥½å‡ æ­¥æ¥è®¡ç®—ã€‚</p><p>ç¬¬ä¸€æ­¥ï¼Œè®¡ç®—æ€»é”€å”®é‡‘é¢ï¼Œå¹¶å­˜å…¥ä¸´æ—¶è¡¨ aï¼š</p><p><strong>æ­¤å¤„æ¶‰åŠåˆ°äº†ä¸´æ—¶è¡¨çš„ä½¿ç”¨</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE TEMPORARY TABLE a       -- åˆ›å»ºä¸´æ—¶è¡¨<br>SELECT SUM(sales_value) AS sales_value -- è®¡ç®—æ€»è®¡é‡‘é¢<br>FROM sales;<br></code></pre></td></tr></table></figure><p>æŸ¥çœ‹ä¸€ä¸‹ä¸´æ—¶è¡¨ a ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT * FROM a;<br>+-------------+<br>| sales_value |<br>+-------------+<br>|          70 |<br>+-------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>ç¬¬äºŒæ­¥ï¼Œè®¡ç®—æ¯ä¸ªåŸå¸‚çš„é”€å”®æ€»é¢å¹¶å­˜å…¥ä¸´æ—¶è¡¨ bï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE TEMPORARY TABLE b    -- åˆ›å»ºä¸´æ—¶è¡¨<br>SELECT city,SUM(sales_value) AS sales_value  -- è®¡ç®—åŸå¸‚é”€å”®åˆè®¡<br>FROM sales<br>GROUP BY city;<br></code></pre></td></tr></table></figure><p>æŸ¥çœ‹ä¸´æ—¶è¡¨ b ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT * FROM b;<br>+------+-------------+<br>| city | sales_value |<br>+------+-------------+<br>| åŒ—äº¬ |          30 |<br>| ä¸Šæµ· |          40 |<br>+------+-------------+<br>2 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>ç¬¬ä¸‰æ­¥ï¼Œè®¡ç®—å„åŒºçš„é”€å”®å æ‰€åœ¨åŸå¸‚çš„æ€»è®¡é‡‘é¢çš„æ¯”ä¾‹ï¼Œå’Œå å…¨éƒ¨é”€å”®æ€»è®¡é‡‘é¢çš„æ¯”ä¾‹ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„è¿æ¥æŸ¥è¯¢è·å¾—éœ€è¦çš„ç»“æœï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT s.city AS åŸå¸‚,s.county AS åŒº,s.sales_value AS åŒºé”€å”®é¢,<br>    -&gt; b.sales_value AS å¸‚é”€å”®é¢,s.sales_value/b.sales_value AS å¸‚æ¯”ç‡,<br>    -&gt; a.sales_value AS æ€»é”€å”®é¢,s.sales_value/a.sales_value AS æ€»æ¯”ç‡<br>    -&gt; FROM sales s<br>    -&gt; JOIN b ON (s.city=b.city) -- è¿æ¥å¸‚ç»Ÿè®¡ç»“æœä¸´æ—¶è¡¨<br>    -&gt; JOIN a                   -- è¿æ¥æ€»è®¡é‡‘é¢ä¸´æ—¶è¡¨<br>    -&gt; ORDER BY s.city,s.county;<br>+------+------+----------+----------+--------+----------+--------+<br>| åŸå¸‚  | åŒº   | åŒºé”€å”®é¢  | å¸‚é”€å”®é¢   | å¸‚æ¯”ç‡  | æ€»é”€å”®é¢  | æ€»æ¯”ç‡  |<br>+------+------+----------+----------+--------+----------+--------+<br>| ä¸Šæµ·  | é•¿å® |       10 |       40 | 0.2500 |       70 | 0.1429 |<br>| ä¸Šæµ·  | é»„åŸ” |       30 |       40 | 0.7500 |       70 | 0.4286 |<br>| åŒ—äº¬  | æœé˜³ |       20 |       30 | 0.6667 |       70 | 0.2857 |<br>| åŒ—äº¬  | æµ·æ·€ |       10 |       30 | 0.3333 |       70 | 0.1429 |<br>+------+------+----------+----------+--------+----------+--------+<br>4 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>ç»“æœæ˜¾ç¤ºï¼šå¸‚é”€å”®é‡‘é¢ã€å¸‚é”€å”®å æ¯”ã€æ€»é”€å”®é‡‘é¢ã€æ€»é”€å”®å æ¯”éƒ½è®¡ç®—å‡ºæ¥äº†ã€‚</p><p>åŒæ ·çš„æŸ¥è¯¢ï¼Œå¦‚æœç”¨çª—å£å‡½æ•°ï¼Œå°±ç®€å•å¤šäº†ã€‚æˆ‘ä»¬å¯ä»¥ç”¨ä¸‹é¢çš„ä»£ç æ¥å®ç°ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT city AS åŸå¸‚,county AS åŒº,sales_value AS åŒºé”€å”®é¢,<br>    -&gt; SUM(sales_value) OVER(PARTITION BY city) AS å¸‚é”€å”®é¢,  -- è®¡ç®—å¸‚é”€å”®é¢<br>    -&gt; sales_value/SUM(sales_value) OVER(PARTITION BY city) AS å¸‚æ¯”ç‡,<br>    -&gt; SUM(sales_value) OVER() AS æ€»é”€å”®é¢,   -- è®¡ç®—æ€»é”€å”®é¢<br>    -&gt; sales_value/SUM(sales_value) OVER() AS æ€»æ¯”ç‡<br>    -&gt; FROM sales<br>    -&gt; ORDER BY city,county;<br>+------+------+----------+----------+--------+----------+--------+<br>| åŸå¸‚  | åŒº   | åŒºé”€å”®é¢  | å¸‚é”€å”®é¢   | å¸‚æ¯”ç‡  | æ€»é”€å”®é¢  | æ€»æ¯”ç‡  |<br>+------+------+----------+----------+--------+----------+--------+<br>| ä¸Šæµ·  | é•¿å® |       10 |       40  | 0.2500 |       70 | 0.1429 |<br>| ä¸Šæµ·  | é»„åŸ” |       30 |       40  | 0.7500 |       70 | 0.4286 |<br>| åŒ—äº¬  | æœé˜³ |       20 |       30  | 0.6667 |       70 | 0.2857 |<br>| åŒ—äº¬  | æµ·æ·€ |       10 |       30  | 0.3333 |       70 | 0.1429 |<br>+------+------+----------+-----------+--------+----------+--------+<br>4 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>ç»“æœæ˜¾ç¤ºï¼Œæˆ‘ä»¬å¾—åˆ°äº†ä¸ä¸Šé¢é‚£ç§æŸ¥è¯¢åŒæ ·çš„ç»“æœã€‚</p><p>ä½¿ç”¨çª—å£å‡½æ•°ï¼Œåªç”¨äº†ä¸€æ­¥å°±å®Œæˆäº†æŸ¥è¯¢ã€‚è€Œä¸”ï¼Œç”±äºæ²¡æœ‰ç”¨åˆ°ä¸´æ—¶è¡¨ï¼Œæ‰§è¡Œçš„æ•ˆç‡ä¹Ÿæ›´é«˜äº†ã€‚å¾ˆæ˜¾ç„¶ï¼Œ<strong>åœ¨è¿™ç§éœ€è¦ç”¨åˆ°åˆ†ç»„ç»Ÿè®¡çš„ç»“æœå¯¹æ¯ä¸€æ¡è®°å½•è¿›è¡Œè®¡ç®—çš„åœºæ™¯ä¸‹ï¼Œä½¿ç”¨çª—å£å‡½æ•°æ›´å¥½</strong>ã€‚</p><h3 id="2-2-çª—å£å‡½æ•°åˆ†ç±»"><a href="#2-2-çª—å£å‡½æ•°åˆ†ç±»" class="headerlink" title="2.2 çª—å£å‡½æ•°åˆ†ç±»"></a>2.2 çª—å£å‡½æ•°åˆ†ç±»</h3><p>MySQLä»8.0ç‰ˆæœ¬å¼€å§‹æ”¯æŒçª—å£å‡½æ•°ã€‚<strong>çª—å£å‡½æ•°çš„ä½œç”¨ç±»ä¼¼äºåœ¨æŸ¥è¯¢ä¸­å¯¹æ•°æ®è¿›è¡Œåˆ†ç»„ï¼Œä¸åŒçš„æ˜¯ï¼Œåˆ†ç»„æ“ä½œä¼šæŠŠåˆ†ç»„çš„ç»“æœèšåˆæˆä¸€æ¡è®°å½•ï¼Œè€Œçª—å£å‡½æ•°æ˜¯å°†ç»“æœç½®äºæ¯ä¸€æ¡æ•°æ®è®°å½•ä¸­ã€‚</strong>çª—å£å‡½æ•°ä»‹äºå•è¡Œå‡½æ•°å’Œèšåˆå‡½æ•°ä¹‹é—´ï¼Œæ—¢å®ç°äº†åˆ†ç»„åˆæ²¡æœ‰å‹ç¼©æ•°æ®è¡Œæ•°ã€‚</p><p>çª—å£å‡½æ•°å¯ä»¥åˆ†ä¸º<code>é™æ€çª—å£å‡½æ•°</code>å’Œ<code>åŠ¨æ€çª—å£å‡½æ•°</code>ã€‚</p><ul><li>é™æ€çª—å£å‡½æ•°çš„çª—å£å¤§å°æ˜¯å›ºå®šçš„ï¼Œä¸ä¼šå› ä¸ºè®°å½•çš„ä¸åŒè€Œä¸åŒï¼›</li><li>åŠ¨æ€çª—å£å‡½æ•°çš„çª—å£å¤§å°ä¼šéšç€è®°å½•çš„ä¸åŒè€Œå˜åŒ–ã€‚</li></ul><p>MySQLå®˜æ–¹ç½‘ç«™çª—å£å‡½æ•°çš„ç½‘å€ä¸º<a href="https://dev.mysql.com/doc/refman/8.0/en/window-function-descriptions.html#function_row-number%E3%80%82">https://dev.mysql.com/doc/refman/8.0/en/window-function-descriptions.html#function_row-numberã€‚</a></p><p>MySQLçš„çª—å£å‡½æ•°å¤§è‡´åˆ†ç±»å¦‚ä¸‹ï¼š</p><ul><li>ä¸“ç”¨çª—å£å‡½æ•°ï¼šrank()ï¼Œdense_rank()ï¼Œrow_number()</li><li>èšåˆå‡½æ•°ï¼šmax()ï¼Œmin()ï¼Œcount()ï¼Œsum()ï¼Œavg()ç­‰èšåˆå‡½æ•°</li></ul><p>çª—å£å‡½æ•°æ€»ä½“ä¸Šå¯ä»¥åˆ†ä¸ºåºå·å‡½æ•°ã€åˆ†å¸ƒå‡½æ•°ã€å‰åå‡½æ•°ã€é¦–å°¾å‡½æ•°å’Œå…¶ä»–å‡½æ•°ï¼Œå¦‚ä¸‹è¡¨ï¼š</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20211012162944536.png"></p><h3 id="2-3-è¯­æ³•ç»“æ„"><a href="#2-3-è¯­æ³•ç»“æ„" class="headerlink" title="2.3 è¯­æ³•ç»“æ„"></a>2.3 è¯­æ³•ç»“æ„</h3><p>çª—å£å‡½æ•°çš„è¯­æ³•ç»“æ„æ˜¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">å‡½æ•° OVERï¼ˆ[[PARTITION BY å­—æ®µå] [ORDER BY å­—æ®µå ASC|DESC]]ï¼‰<br></code></pre></td></tr></table></figure><p>æˆ–è€…æ˜¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">å‡½æ•° OVER çª—å£å â€¦ WINDOW çª—å£å AS ï¼ˆ[[PARTITION BY å­—æ®µå] [ORDER BY å­—æ®µå ASC|DESC]]ï¼‰<br></code></pre></td></tr></table></figure><ul><li>OVER å…³é”®å­—æŒ‡å®šå‡½æ•°çª—å£çš„èŒƒå›´ã€‚<ul><li>å¦‚æœçœç•¥åé¢æ‹¬å·ä¸­çš„å†…å®¹ï¼Œåˆ™çª—å£ä¼šåŒ…å«æ»¡è¶³WHEREæ¡ä»¶çš„æ‰€æœ‰è®°å½•ï¼Œçª—å£å‡½æ•°ä¼šåŸºäºæ‰€æœ‰æ»¡è¶³WHEREæ¡ä»¶çš„è®°å½•è¿›è¡Œè®¡ç®—ã€‚</li><li>å¦‚æœOVERå…³é”®å­—åé¢çš„æ‹¬å·ä¸ä¸ºç©ºï¼Œåˆ™å¯ä»¥ä½¿ç”¨å¦‚ä¸‹è¯­æ³•è®¾ç½®çª—å£ã€‚</li></ul></li><li>çª—å£åï¼šä¸ºçª—å£è®¾ç½®ä¸€ä¸ªåˆ«åï¼Œç”¨æ¥æ ‡è¯†çª—å£ã€‚</li><li>PARTITION BYå­å¥ï¼šæŒ‡å®šçª—å£å‡½æ•°æŒ‰ç…§å“ªäº›å­—æ®µè¿›è¡Œåˆ†ç»„ã€‚åˆ†ç»„åï¼Œçª—å£å‡½æ•°å¯ä»¥åœ¨æ¯ä¸ªåˆ†ç»„ä¸­åˆ†åˆ«æ‰§è¡Œã€‚</li><li>ORDER BYå­å¥ï¼šæŒ‡å®šçª—å£å‡½æ•°æŒ‰ç…§å“ªäº›å­—æ®µè¿›è¡Œæ’åºã€‚æ‰§è¡Œæ’åºæ“ä½œä½¿çª—å£å‡½æ•°æŒ‰ç…§æ’åºåçš„æ•°æ®è®°å½•çš„é¡ºåºè¿›è¡Œç¼–å·ã€‚</li><li>FRAMEå­å¥ï¼šä¸ºåˆ†åŒºä¸­çš„æŸä¸ªå­é›†å®šä¹‰è§„åˆ™ï¼Œå¯ä»¥ç”¨æ¥ä½œä¸ºæ»‘åŠ¨çª—å£ä½¿ç”¨ã€‚</li></ul><h3 id="2-4-åˆ†ç±»è®²è§£"><a href="#2-4-åˆ†ç±»è®²è§£" class="headerlink" title="2.4 åˆ†ç±»è®²è§£"></a>2.4 åˆ†ç±»è®²è§£</h3><p>åˆ›å»ºè¡¨ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE TABLE goods(<br>id INT PRIMARY KEY AUTO_INCREMENT,<br>category_id INT,<br>category VARCHAR(15),<br>NAME VARCHAR(30),<br>price DECIMAL(10,2),<br>stock INT,<br>upper_time DATETIME<br><br>);<br></code></pre></td></tr></table></figure><p>æ·»åŠ æ•°æ®ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs mysql">INSERT INTO goods(category_id,category,NAME,price,stock,upper_time)<br>VALUES<br>(1, &#x27;å¥³è£…/å¥³å£«ç²¾å“&#x27;, &#x27;Tæ¤&#x27;, 39.90, 1000, &#x27;2020-11-10 00:00:00&#x27;),<br>(1, &#x27;å¥³è£…/å¥³å£«ç²¾å“&#x27;, &#x27;è¿è¡£è£™&#x27;, 79.90, 2500, &#x27;2020-11-10 00:00:00&#x27;),<br>(1, &#x27;å¥³è£…/å¥³å£«ç²¾å“&#x27;, &#x27;å«è¡£&#x27;, 89.90, 1500, &#x27;2020-11-10 00:00:00&#x27;),<br>(1, &#x27;å¥³è£…/å¥³å£«ç²¾å“&#x27;, &#x27;ç‰›ä»”è£¤&#x27;, 89.90, 3500, &#x27;2020-11-10 00:00:00&#x27;),<br>(1, &#x27;å¥³è£…/å¥³å£«ç²¾å“&#x27;, &#x27;ç™¾è¤¶è£™&#x27;, 29.90, 500, &#x27;2020-11-10 00:00:00&#x27;),<br>(1, &#x27;å¥³è£…/å¥³å£«ç²¾å“&#x27;, &#x27;å‘¢ç»’å¤–å¥—&#x27;, 399.90, 1200, &#x27;2020-11-10 00:00:00&#x27;),<br>(2, &#x27;æˆ·å¤–è¿åŠ¨&#x27;, &#x27;è‡ªè¡Œè½¦&#x27;, 399.90, 1000, &#x27;2020-11-10 00:00:00&#x27;),<br>(2, &#x27;æˆ·å¤–è¿åŠ¨&#x27;, &#x27;å±±åœ°è‡ªè¡Œè½¦&#x27;, 1399.90, 2500, &#x27;2020-11-10 00:00:00&#x27;),<br>(2, &#x27;æˆ·å¤–è¿åŠ¨&#x27;, &#x27;ç™»å±±æ–&#x27;, 59.90, 1500, &#x27;2020-11-10 00:00:00&#x27;),<br>(2, &#x27;æˆ·å¤–è¿åŠ¨&#x27;, &#x27;éª‘è¡Œè£…å¤‡&#x27;, 399.90, 3500, &#x27;2020-11-10 00:00:00&#x27;),<br>(2, &#x27;æˆ·å¤–è¿åŠ¨&#x27;, &#x27;è¿åŠ¨å¤–å¥—&#x27;, 799.90, 500, &#x27;2020-11-10 00:00:00&#x27;),<br>(2, &#x27;æˆ·å¤–è¿åŠ¨&#x27;, &#x27;æ»‘æ¿&#x27;, 499.90, 1200, &#x27;2020-11-10 00:00:00&#x27;);<br></code></pre></td></tr></table></figure><p>ä¸‹é¢é’ˆå¯¹goodsè¡¨ä¸­çš„æ•°æ®æ¥éªŒè¯æ¯ä¸ªçª—å£å‡½æ•°çš„åŠŸèƒ½ã€‚</p><h4 id="1-åºå·å‡½æ•°"><a href="#1-åºå·å‡½æ•°" class="headerlink" title="1. åºå·å‡½æ•°"></a>1. åºå·å‡½æ•°</h4><p><strong>1ï¼ROW_NUMBER()å‡½æ•°</strong></p><p>ROW_NUMBER()å‡½æ•°èƒ½å¤Ÿå¯¹æ•°æ®ä¸­çš„åºå·è¿›è¡Œé¡ºåºæ˜¾ç¤ºã€‚</p><p>ä¸¾ä¾‹ï¼šæŸ¥è¯¢ goods æ•°æ®è¡¨ä¸­æ¯ä¸ªå•†å“åˆ†ç±»ä¸‹ä»·æ ¼é™åºæ’åˆ—çš„å„ä¸ªå•†å“ä¿¡æ¯ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT ROW_NUMBER() OVER(PARTITION BY category_id ORDER BY price DESC) AS row_num,<br>    -&gt; id, category_id, category, NAME, price, stock<br>    -&gt; FROM goods;<br>+---------+----+-------------+---------------+------------+---------+-------+<br>| row_num | id | category_id | category      | NAME       | price   | stock |<br>+---------+----+-------------+---------------+------------+---------+-------+<br>|       1 |  6 |           1 | å¥³è£…/å¥³å£«ç²¾å“   | å‘¢ç»’å¤–å¥—    |  399.90 |  1200 |<br>|       2 |  3 |           1 | å¥³è£…/å¥³å£«ç²¾å“   | å«è¡£        |   89.90 |  1500 |<br>|       3 |  4 |           1 | å¥³è£…/å¥³å£«ç²¾å“   | ç‰›ä»”è£¤      |   89.90 |  3500 |<br>|       4 |  2 |           1 | å¥³è£…/å¥³å£«ç²¾å“   | è¿è¡£è£™      |   79.90 |  2500 |<br>|       5 |  1 |           1 | å¥³è£…/å¥³å£«ç²¾å“   | Tæ¤        |   39.90 |  1000 |<br>|       6 |  5 |           1 | å¥³è£…/å¥³å£«ç²¾å“   | ç™¾è¤¶è£™      |   29.90 |   500 |<br>|       1 |  8 |           2 | æˆ·å¤–è¿åŠ¨       | å±±åœ°è‡ªè¡Œè½¦   | 1399.90 |  2500 |<br>|       2 | 11 |           2 | æˆ·å¤–è¿åŠ¨       | è¿åŠ¨å¤–å¥—     |  799.90 |   500 |<br>|       3 | 12 |           2 | æˆ·å¤–è¿åŠ¨       | æ»‘æ¿        |  499.90 |  1200 |<br>|       4 |  7 |           2 | æˆ·å¤–è¿åŠ¨       | è‡ªè¡Œè½¦      |  399.90 |  1000 |<br>|       5 | 10 |           2 | æˆ·å¤–è¿åŠ¨       | éª‘è¡Œè£…å¤‡    |  399.90 |  3500 |<br>|       6 |  9 |           2 | æˆ·å¤–è¿åŠ¨       | ç™»å±±æ–      |   59.90 |  1500 |<br>+---------+----+-------------+---------------+------------+---------+-------+<br>12 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>ä¸¾ä¾‹ï¼šæŸ¥è¯¢ goods æ•°æ®è¡¨ä¸­æ¯ä¸ªå•†å“åˆ†ç±»ä¸‹ä»·æ ¼æœ€é«˜çš„3ç§å•†å“ä¿¡æ¯ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT *<br>    -&gt; FROM (<br>    -&gt;  SELECT ROW_NUMBER() OVER(PARTITION BY category_id ORDER BY price DESC) AS row_num,<br>    -&gt;  id, category_id, category, NAME, price, stock<br>    -&gt;  FROM goods) t<br>    -&gt; WHERE row_num &lt;= 3;<br>+---------+----+-------------+---------------+------------+---------+-------+<br>| row_num | id | category_id | category      | NAME       | price   | stock |<br>+---------+----+-------------+---------------+------------+---------+-------+<br>|       1 |  6 |           1 | å¥³è£…/å¥³å£«ç²¾å“   | å‘¢ç»’å¤–å¥—    |  399.90  |  1200 |<br>|       2 |  3 |           1 | å¥³è£…/å¥³å£«ç²¾å“   | å«è¡£        |   89.90 |  1500 |<br>|       3 |  4 |           1 | å¥³è£…/å¥³å£«ç²¾å“   | ç‰›ä»”è£¤      |   89.90  |  3500 |<br>|       1 |  8 |           2 | æˆ·å¤–è¿åŠ¨       | å±±åœ°è‡ªè¡Œè½¦   | 1399.90  |  2500 |<br>|       2 | 11 |           2 | æˆ·å¤–è¿åŠ¨       | è¿åŠ¨å¤–å¥—     |  799.90  |   500 |<br>|       3 | 12 |           2 | æˆ·å¤–è¿åŠ¨       | æ»‘æ¿        |  499.90  |  1200 |<br>+---------+----+-------------+---------------+------------+----------+-------+<br>6 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>åœ¨åç§°ä¸ºâ€œå¥³è£…/å¥³å£«ç²¾å“â€çš„å•†å“ç±»åˆ«ä¸­ï¼Œæœ‰ä¸¤æ¬¾å•†å“çš„ä»·æ ¼ä¸º89.90å…ƒï¼Œåˆ†åˆ«æ˜¯å«è¡£å’Œç‰›ä»”è£¤ã€‚ä¸¤æ¬¾å•†å“çš„åºå·éƒ½åº”è¯¥ä¸º2ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªä¸º2ï¼Œå¦ä¸€ä¸ªä¸º3ã€‚æ­¤æ—¶ï¼Œå¯ä»¥ä½¿ç”¨RANK()å‡½æ•°å’ŒDENSE_RANK()å‡½æ•°è§£å†³ã€‚</p><p><strong>2ï¼RANK()å‡½æ•°</strong></p><p><strong>ä½¿ç”¨RANK()å‡½æ•°èƒ½å¤Ÿå¯¹åºå·è¿›è¡Œå¹¶åˆ—æ’åºï¼Œå¹¶ä¸”ä¼šè·³è¿‡é‡å¤çš„åºå·ï¼Œæ¯”å¦‚åºå·ä¸º1ã€1ã€3ï¼ˆç¬¬ä¸€ä¸ªå’Œç¬¬äºŒä¸ªç›¸ç­‰ï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªå’Œç¬¬äºŒä¸ªå¹¶åˆ—ç¬¬ä¸€ï¼‰ã€‚</strong></p><p>ä¸¾ä¾‹ï¼šä½¿ç”¨RANK()å‡½æ•°è·å– goods æ•°æ®è¡¨ä¸­å„ç±»åˆ«çš„ä»·æ ¼ä»é«˜åˆ°ä½æ’åºçš„å„å•†å“ä¿¡æ¯ã€‚</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">mysql&gt; SELECT RANK() OVER(PARTITION BY category_id ORDER BY price DESC) AS row_num,<br>    -&gt; id, category_id, category, NAME, price, stock<br>    -&gt; FROM goods;<br>+---------+----+-------------+---------------+------------+---------+-------+<br>|<span class="hljs-string"> row_num </span>|<span class="hljs-string"> id </span>|<span class="hljs-string"> category_id </span>|<span class="hljs-string"> category      </span>|<span class="hljs-string"> NAME       </span>|<span class="hljs-string"> price   </span>|<span class="hljs-string"> stock </span>|<br>+---------+----+-------------+---------------+------------+---------+-------+<br>|<span class="hljs-string">       1 </span>|<span class="hljs-string">  6 </span>|<span class="hljs-string">           1 </span>|<span class="hljs-string"> å¥³è£…/å¥³å£«ç²¾å“   </span>|<span class="hljs-string"> å‘¢ç»’å¤–å¥—    </span>|<span class="hljs-string">  399.90 </span>|<span class="hljs-string">  1200 </span>|<br>|<span class="hljs-string">       2 </span>|<span class="hljs-string">  3 </span>|<span class="hljs-string">           1 </span>|<span class="hljs-string"> å¥³è£…/å¥³å£«ç²¾å“   </span>|<span class="hljs-string"> å«è¡£        </span>|<span class="hljs-string">   89.90 </span>|<span class="hljs-string">  1500 </span>|<br>|<span class="hljs-string">       2 </span>|<span class="hljs-string">  4 </span>|<span class="hljs-string">           1 </span>|<span class="hljs-string"> å¥³è£…/å¥³å£«ç²¾å“   </span>|<span class="hljs-string"> ç‰›ä»”è£¤      </span>|<span class="hljs-string">   89.90 </span>|<span class="hljs-string">  3500 </span>|<br>|<span class="hljs-string">       4 </span>|<span class="hljs-string">  2 </span>|<span class="hljs-string">           1 </span>|<span class="hljs-string"> å¥³è£…/å¥³å£«ç²¾å“   </span>|<span class="hljs-string"> è¿è¡£è£™      </span>|<span class="hljs-string">   79.90 </span>|<span class="hljs-string">  2500 </span>|<br>|<span class="hljs-string">       5 </span>|<span class="hljs-string">  1 </span>|<span class="hljs-string">           1 </span>|<span class="hljs-string"> å¥³è£…/å¥³å£«ç²¾å“   </span>|<span class="hljs-string"> Tæ¤         </span>|<span class="hljs-string">   39.90 </span>|<span class="hljs-string">  1000 </span>|<br>|<span class="hljs-string">       6 </span>|<span class="hljs-string">  5 </span>|<span class="hljs-string">           1 </span>|<span class="hljs-string"> å¥³è£…/å¥³å£«ç²¾å“   </span>|<span class="hljs-string"> ç™¾è¤¶è£™      </span>|<span class="hljs-string">   29.90 </span>|<span class="hljs-string">   500 </span>|<br>|<span class="hljs-string">       1 </span>|<span class="hljs-string">  8 </span>|<span class="hljs-string">           2 </span>|<span class="hljs-string"> æˆ·å¤–è¿åŠ¨       </span>|<span class="hljs-string"> å±±åœ°è‡ªè¡Œè½¦   </span>|<span class="hljs-string"> 1399.90 </span>|<span class="hljs-string">  2500 </span>|<br>|<span class="hljs-string">       2 </span>|<span class="hljs-string"> 11 </span>|<span class="hljs-string">           2 </span>|<span class="hljs-string"> æˆ·å¤–è¿åŠ¨       </span>|<span class="hljs-string"> è¿åŠ¨å¤–å¥—     </span>|<span class="hljs-string">  799.90 </span>|<span class="hljs-string">   500 </span>|<br>|<span class="hljs-string">       3 </span>|<span class="hljs-string"> 12 </span>|<span class="hljs-string">           2 </span>|<span class="hljs-string"> æˆ·å¤–è¿åŠ¨       </span>|<span class="hljs-string"> æ»‘æ¿        </span>|<span class="hljs-string">  499.90 </span>|<span class="hljs-string">  1200 </span>|<br>|<span class="hljs-string">       4 </span>|<span class="hljs-string">  7 </span>|<span class="hljs-string">           2 </span>|<span class="hljs-string"> æˆ·å¤–è¿åŠ¨       </span>|<span class="hljs-string"> è‡ªè¡Œè½¦      </span>|<span class="hljs-string">  399.90 </span>|<span class="hljs-string">  1000 </span>|<br>|<span class="hljs-string">       4 </span>|<span class="hljs-string"> 10 </span>|<span class="hljs-string">           2 </span>|<span class="hljs-string"> æˆ·å¤–è¿åŠ¨       </span>|<span class="hljs-string"> éª‘è¡Œè£…å¤‡    </span>|<span class="hljs-string">  399.90 </span>|<span class="hljs-string">  3500 </span>|<br>|<span class="hljs-string">       6 </span>|<span class="hljs-string">  9 </span>|<span class="hljs-string">           2 </span>|<span class="hljs-string"> æˆ·å¤–è¿åŠ¨       </span>|<span class="hljs-string"> ç™»å±±æ–      </span>|<span class="hljs-string">   59.90 </span>|<span class="hljs-string">  1500 </span>|<br>+---------+----+-------------+---------------+------------+---------+-------+<br>12 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>ä¸¾ä¾‹ï¼šä½¿ç”¨RANK()å‡½æ•°è·å– goods æ•°æ®è¡¨ä¸­ç±»åˆ«ä¸ºâ€œå¥³è£…/å¥³å£«ç²¾å“â€çš„ä»·æ ¼æœ€é«˜çš„4æ¬¾å•†å“ä¿¡æ¯ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT *<br>    -&gt; FROM(<br>    -&gt;  SELECT RANK() OVER(PARTITION BY category_id ORDER BY price DESC) AS row_num,<br>    -&gt;  id, category_id, category, NAME, price, stock<br>    -&gt;  FROM goods) t<br>    -&gt; WHERE category_id = 1 AND row_num &lt;= 4;<br>+---------+----+-------------+---------------+----------+--------+-------+<br>| row_num | id | category_id | category      | NAME     | price  | stock |<br>+---------+----+-------------+---------------+----------+--------+-------+<br>|       1 |  6 |           1 | å¥³è£…/å¥³å£«ç²¾å“   | å‘¢ç»’å¤–å¥—  | 399.90 |  1200 |<br>|       2 |  3 |           1 | å¥³è£…/å¥³å£«ç²¾å“   | å«è¡£      |  89.90 |  1500 |<br>|       2 |  4 |           1 | å¥³è£…/å¥³å£«ç²¾å“   | ç‰›ä»”è£¤    |  89.90 |  3500 |<br>|       4 |  2 |           1 | å¥³è£…/å¥³å£«ç²¾å“   | è¿è¡£è£™    |  79.90 |  2500 |<br>+---------+----+-------------+---------------+----------+--------+-------+<br>4 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œä½¿ç”¨RANK()å‡½æ•°å¾—å‡ºçš„åºå·ä¸º1ã€2ã€2ã€4ï¼Œç›¸åŒä»·æ ¼çš„å•†å“åºå·ç›¸åŒï¼Œåé¢çš„å•†å“åºå·æ˜¯ä¸è¿ç»­çš„ï¼Œè·³è¿‡äº†é‡å¤çš„åºå·ã€‚</p><p><strong>3ï¼DENSE_RANK()å‡½æ•°</strong></p><p><strong>DENSE_RANK()å‡½æ•°å¯¹åºå·è¿›è¡Œå¹¶åˆ—æ’åºï¼Œå¹¶ä¸”ä¸ä¼šè·³è¿‡é‡å¤çš„åºå·ï¼Œæ¯”å¦‚åºå·ä¸º1ã€1ã€2ã€‚</strong></p><p>ä¸¾ä¾‹ï¼šä½¿ç”¨DENSE_RANK()å‡½æ•°è·å– goods æ•°æ®è¡¨ä¸­å„ç±»åˆ«çš„ä»·æ ¼ä»é«˜åˆ°ä½æ’åºçš„å„å•†å“ä¿¡æ¯ã€‚</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">mysql&gt; SELECT DENSE_RANK() OVER(PARTITION BY category_id ORDER BY price DESC) AS row_num,<br>    -&gt; id, category_id, category, NAME, price, stock<br>    -&gt; FROM goods;<br>+---------+----+-------------+---------------+------------+---------+-------+<br>|<span class="hljs-string"> row_num </span>|<span class="hljs-string"> id </span>|<span class="hljs-string"> category_id </span>|<span class="hljs-string"> category      </span>|<span class="hljs-string"> NAME       </span>|<span class="hljs-string"> price   </span>|<span class="hljs-string"> stock </span>|<br>+---------+----+-------------+---------------+------------+---------+-------+<br>|<span class="hljs-string">       1 </span>|<span class="hljs-string">  6 </span>|<span class="hljs-string">           1 </span>|<span class="hljs-string"> å¥³è£…/å¥³å£«ç²¾å“   </span>|<span class="hljs-string"> å‘¢ç»’å¤–å¥—    </span>|<span class="hljs-string">  399.90 </span>|<span class="hljs-string">  1200 </span>|<br>|<span class="hljs-string">       2 </span>|<span class="hljs-string">  3 </span>|<span class="hljs-string">           1 </span>|<span class="hljs-string"> å¥³è£…/å¥³å£«ç²¾å“   </span>|<span class="hljs-string"> å«è¡£        </span>|<span class="hljs-string">   89.90 </span>|<span class="hljs-string">  1500 </span>|<br>|<span class="hljs-string">       2 </span>|<span class="hljs-string">  4 </span>|<span class="hljs-string">           1 </span>|<span class="hljs-string"> å¥³è£…/å¥³å£«ç²¾å“   </span>|<span class="hljs-string"> ç‰›ä»”è£¤      </span>|<span class="hljs-string">   89.90 </span>|<span class="hljs-string">  3500 </span>|<br>|<span class="hljs-string">       3 </span>|<span class="hljs-string">  2 </span>|<span class="hljs-string">           1 </span>|<span class="hljs-string"> å¥³è£…/å¥³å£«ç²¾å“   </span>|<span class="hljs-string"> è¿è¡£è£™      </span>|<span class="hljs-string">   79.90 </span>|<span class="hljs-string">  2500 </span>|<br>|<span class="hljs-string">       4 </span>|<span class="hljs-string">  1 </span>|<span class="hljs-string">           1 </span>|<span class="hljs-string"> å¥³è£…/å¥³å£«ç²¾å“   </span>|<span class="hljs-string"> Tæ¤        </span>|<span class="hljs-string">   39.90 </span>|<span class="hljs-string">  1000 </span>|<br>|<span class="hljs-string">       5 </span>|<span class="hljs-string">  5 </span>|<span class="hljs-string">           1 </span>|<span class="hljs-string"> å¥³è£…/å¥³å£«ç²¾å“   </span>|<span class="hljs-string"> ç™¾è¤¶è£™      </span>|<span class="hljs-string">   29.90 </span>|<span class="hljs-string">   500 </span>|<br>|<span class="hljs-string">       1 </span>|<span class="hljs-string">  8 </span>|<span class="hljs-string">           2 </span>|<span class="hljs-string"> æˆ·å¤–è¿åŠ¨       </span>|<span class="hljs-string"> å±±åœ°è‡ªè¡Œè½¦   </span>|<span class="hljs-string"> 1399.90 </span>|<span class="hljs-string">  2500 </span>|<br>|<span class="hljs-string">       2 </span>|<span class="hljs-string"> 11 </span>|<span class="hljs-string">           2 </span>|<span class="hljs-string"> æˆ·å¤–è¿åŠ¨       </span>|<span class="hljs-string"> è¿åŠ¨å¤–å¥—     </span>|<span class="hljs-string">  799.90 </span>|<span class="hljs-string">   500 </span>|<br>|<span class="hljs-string">       3 </span>|<span class="hljs-string"> 12 </span>|<span class="hljs-string">           2 </span>|<span class="hljs-string"> æˆ·å¤–è¿åŠ¨       </span>|<span class="hljs-string"> æ»‘æ¿        </span>|<span class="hljs-string">  499.90 </span>|<span class="hljs-string">  1200 </span>|<br>|<span class="hljs-string">       4 </span>|<span class="hljs-string">  7 </span>|<span class="hljs-string">           2 </span>|<span class="hljs-string"> æˆ·å¤–è¿åŠ¨       </span>|<span class="hljs-string"> è‡ªè¡Œè½¦       </span>|<span class="hljs-string">  399.90 </span>|<span class="hljs-string">  1000 </span>|<br>|<span class="hljs-string">       4 </span>|<span class="hljs-string"> 10 </span>|<span class="hljs-string">           2 </span>|<span class="hljs-string"> æˆ·å¤–è¿åŠ¨       </span>|<span class="hljs-string"> éª‘è¡Œè£…å¤‡     </span>|<span class="hljs-string">  399.90 </span>|<span class="hljs-string">  3500 </span>|<br>|<span class="hljs-string">       5 </span>|<span class="hljs-string">  9 </span>|<span class="hljs-string">           2 </span>|<span class="hljs-string"> æˆ·å¤–è¿åŠ¨       </span>|<span class="hljs-string"> ç™»å±±æ–       </span>|<span class="hljs-string">   59.90 </span>|<span class="hljs-string">  1500 </span>|<br>+---------+----+-------------+---------------+------------+---------+-------+<br>12 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>ä¸¾ä¾‹ï¼šä½¿ç”¨DENSE_RANK()å‡½æ•°è·å– goods æ•°æ®è¡¨ä¸­ç±»åˆ«ä¸ºâ€œå¥³è£…/å¥³å£«ç²¾å“â€çš„ä»·æ ¼æœ€é«˜çš„4æ¬¾å•†å“ä¿¡æ¯ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT *<br>    -&gt; FROM(<br>    -&gt;  SELECT DENSE_RANK() OVER(PARTITION BY category_id ORDER BY price DESC) AS row_num,<br>    -&gt;  id, category_id, category, NAME, price, stock<br>    -&gt;  FROM goods) t<br>    -&gt; WHERE category_id = 1 AND row_num &lt;= 3;<br>+---------+----+-------------+---------------+----------+--------+-------+<br>| row_num | id | category_id | category      | NAME     | price  | stock |<br>+---------+----+-------------+---------------+----------+--------+-------+<br>|       1 |  6 |           1 | å¥³è£…/å¥³å£«ç²¾å“   | å‘¢ç»’å¤–å¥—  | 399.90 |  1200 |<br>|       2 |  3 |           1 | å¥³è£…/å¥³å£«ç²¾å“   | å«è¡£     |  89.90  |  1500 |<br>|       2 |  4 |           1 | å¥³è£…/å¥³å£«ç²¾å“   | ç‰›ä»”è£¤    |  89.90 |  3500 |<br>|       3 |  2 |           1 | å¥³è£…/å¥³å£«ç²¾å“   | è¿è¡£è£™    |  79.90 |  2500 |<br>+---------+----+-------------+---------------+----------+--------+-------+<br>4 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œä½¿ç”¨DENSE_RANK()å‡½æ•°å¾—å‡ºçš„è¡Œå·ä¸º1ã€2ã€2ã€3ï¼Œç›¸åŒä»·æ ¼çš„å•†å“åºå·ç›¸åŒï¼Œåé¢çš„å•†å“åºå·æ˜¯è¿ç»­çš„ï¼Œå¹¶ä¸”æ²¡æœ‰è·³è¿‡é‡å¤çš„åºå·ã€‚</p><h4 id="2-åˆ†å¸ƒå‡½æ•°"><a href="#2-åˆ†å¸ƒå‡½æ•°" class="headerlink" title="2. åˆ†å¸ƒå‡½æ•°"></a>2. åˆ†å¸ƒå‡½æ•°</h4><p><strong>1ï¼PERCENT_RANK()å‡½æ•°</strong></p><p>PERCENT_RANK()å‡½æ•°æ˜¯ç­‰çº§å€¼ç™¾åˆ†æ¯”å‡½æ•°ã€‚æŒ‰ç…§å¦‚ä¸‹æ–¹å¼è¿›è¡Œè®¡ç®—ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">æ³¨æ„ï¼šå¯¹äºé‡å¤å€¼ï¼Œè®¡ç®—çš„æ—¶å€™ï¼Œå–é‡å¤å€¼çš„ç¬¬ä¸€è¡Œçš„ä½<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">(rank - 1) / (rows - 1)<br></code></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œrankçš„å€¼ä¸ºä½¿ç”¨RANK()å‡½æ•°äº§ç”Ÿçš„åºå·ï¼Œrowsçš„å€¼ä¸ºå½“å‰çª—å£çš„æ€»è®°å½•æ•°ã€‚</p><p>ä¸¾ä¾‹ï¼šè®¡ç®— goods æ•°æ®è¡¨ä¸­åç§°ä¸ºâ€œå¥³è£…/å¥³å£«ç²¾å“â€çš„ç±»åˆ«ä¸‹çš„å•†å“çš„PERCENT_RANKå€¼ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#å†™æ³•ä¸€ï¼š<br>SELECT RANK() OVER (PARTITION BY category_id ORDER BY price DESC) AS r,<br>PERCENT_RANK() OVER (PARTITION BY category_id ORDER BY price DESC) AS pr,<br>id, category_id, category, NAME, price, stock<br>FROM goods<br>WHERE category_id = 1;<br><br>#å†™æ³•äºŒï¼š<br>mysql&gt; SELECT RANK() OVER w AS r,<br>    -&gt; PERCENT_RANK() OVER w AS pr,<br>    -&gt; id, category_id, category, NAME, price, stock<br>    -&gt; FROM goods<br>    -&gt; WHERE category_id = 1 WINDOW w AS (PARTITION BY category_id ORDER BY price DESC);<br>+---+-----+----+-------------+---------------+----------+--------+-------+<br>| r | pr  | id | category_id | category      | NAME     | price  | stock |<br>+---+-----+----+-------------+---------------+----------+--------+-------+<br>| 1 |   0 |  6 |           1 | å¥³è£…/å¥³å£«ç²¾å“   | å‘¢ç»’å¤–å¥—  | 399.90 |  1200 |<br>| 2 | 0.2 |  3 |           1 | å¥³è£…/å¥³å£«ç²¾å“   | å«è¡£     |  89.90 |  1500 |<br>| 2 | 0.2 |  4 |           1 | å¥³è£…/å¥³å£«ç²¾å“   | ç‰›ä»”è£¤   |  89.90 |  3500  |<br>| 4 | 0.6 |  2 |           1 | å¥³è£…/å¥³å£«ç²¾å“   | è¿è¡£è£™   |  79.90 |  2500  |<br>| 5 | 0.8 |  1 |           1 | å¥³è£…/å¥³å£«ç²¾å“   | Tæ¤      |  39.90 |  1000 |<br>| 6 |   1 |  5 |           1 | å¥³è£…/å¥³å£«ç²¾å“   | ç™¾è¤¶è£™   |  29.90  |   500 |<br>+---+-----+----+-------------+---------------+----------+--------+-------+<br>6 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><p><strong>2ï¼CUME_DIST()å‡½æ•°</strong></p><p>CUME_DIST()å‡½æ•°ä¸»è¦ç”¨äºæŸ¥è¯¢å°äºæˆ–ç­‰äºæŸä¸ªå€¼çš„æ¯”ä¾‹ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">è®¡ç®—ç»“æœä¸ºç›¸å¯¹ä½ç½®/æ€»è¡Œæ•°,è¿”å›å€¼ä¸º(0,1]<br>æ³¨æ„ï¼šå¯¹äºé‡å¤å€¼ï¼Œè®¡ç®—çš„æ—¶å€™ï¼Œå–é‡å¤å€¼çš„æœ€åä¸€è¡Œçš„ä½ç½®<br></code></pre></td></tr></table></figure><p>ä¸¾ä¾‹ï¼šæŸ¥è¯¢goodsæ•°æ®è¡¨ä¸­å°äºæˆ–ç­‰äºå½“å‰ä»·æ ¼çš„æ¯”ä¾‹ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT CUME_DIST() OVER(PARTITION BY category_id ORDER BY price ASC) AS cd,<br>    -&gt; id, category, NAME, price<br>    -&gt; FROM goods;<br>+---------------------+----+---------------+------------+---------+<br>| cd                  | id | category      | NAME       | price   |<br>+---------------------+----+---------------+------------+---------+<br>| 0.16666666666666666 |  5 | å¥³è£…/å¥³å£«ç²¾å“   | ç™¾è¤¶è£™      |   29.90 |<br>|  0.3333333333333333 |  1 | å¥³è£…/å¥³å£«ç²¾å“   | Tæ¤        |   39.90 |<br>|                 0.5 |  2 | å¥³è£…/å¥³å£«ç²¾å“   | è¿è¡£è£™      |   79.90 |<br>|  0.8333333333333334 |  3 | å¥³è£…/å¥³å£«ç²¾å“   | å«è¡£        |   89.90 |<br>|  0.8333333333333334 |  4 | å¥³è£…/å¥³å£«ç²¾å“   | ç‰›ä»”è£¤      |   89.90 |<br>|                   1 |  6 | å¥³è£…/å¥³å£«ç²¾å“   | å‘¢ç»’å¤–å¥—    |  399.90 |<br>| 0.16666666666666666 |  9 | æˆ·å¤–è¿åŠ¨       | ç™»å±±æ–      |   59.90 |<br>|                 0.5 |  7 | æˆ·å¤–è¿åŠ¨       | è‡ªè¡Œè½¦      |  399.90 |<br>|                 0.5 | 10 | æˆ·å¤–è¿åŠ¨       | éª‘è¡Œè£…å¤‡     |  399.90 |<br>|  0.6666666666666666 | 12 | æˆ·å¤–è¿åŠ¨       | æ»‘æ¿        |  499.90 |<br>|  0.8333333333333334 | 11 | æˆ·å¤–è¿åŠ¨       | è¿åŠ¨å¤–å¥—    |  799.90 |<br>|                   1 |  8 | æˆ·å¤–è¿åŠ¨       | å±±åœ°è‡ªè¡Œè½¦   | 1399.90 |<br>+---------------------+----+---------------+------------+---------+<br>12 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><h4 id="3-å‰åå‡½æ•°"><a href="#3-å‰åå‡½æ•°" class="headerlink" title="3. å‰åå‡½æ•°"></a>3. å‰åå‡½æ•°</h4><p><strong>1ï¼LAG(expr,n)å‡½æ•°</strong></p><p>LAG(expr,n)å‡½æ•°è¿”å›å½“å‰è¡Œçš„å‰nè¡Œçš„exprçš„å€¼ã€‚</p><p>ä¸¾ä¾‹ï¼šæŸ¥è¯¢goodsæ•°æ®è¡¨ä¸­å‰ä¸€ä¸ªå•†å“ä»·æ ¼ä¸å½“å‰å•†å“ä»·æ ¼çš„å·®å€¼ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT id, category, NAME, price, pre_price, price - pre_price AS diff_price<br>    -&gt; FROM (<br>    -&gt;  SELECT  id, category, NAME, price,LAG(price,1) OVER w AS pre_price<br>    -&gt;  FROM goods<br>    -&gt;  WINDOW w AS (PARTITION BY category_id ORDER BY price)) t;<br>+----+---------------+------------+---------+-----------+------------+<br>| id | category      | NAME       | price   | pre_price | diff_price |<br>+----+---------------+------------+---------+-----------+------------+<br>|  5 | å¥³è£…/å¥³å£«ç²¾å“   | ç™¾è¤¶è£™      |   29.90 |      NULL |       NULL |<br>|  1 | å¥³è£…/å¥³å£«ç²¾å“   | Tæ¤        |   39.90 |     29.90 |      10.00 |<br>|  2 | å¥³è£…/å¥³å£«ç²¾å“   | è¿è¡£è£™      |   79.90 |     39.90 |      40.00 |<br>|  3 | å¥³è£…/å¥³å£«ç²¾å“   | å«è¡£       |   89.90 |     79.90 |      10.00 |<br>|  4 | å¥³è£…/å¥³å£«ç²¾å“   | ç‰›ä»”è£¤      |   89.90 |     89.90 |       0.00 |<br>|  6 | å¥³è£…/å¥³å£«ç²¾å“   | å‘¢ç»’å¤–å¥—    |  399.90 |     89.90 |     310.00 |<br>|  9 | æˆ·å¤–è¿åŠ¨       | ç™»å±±æ–      |   59.90 |      NULL |       NULL |<br>|  7 | æˆ·å¤–è¿åŠ¨       | è‡ªè¡Œè½¦      |  399.90 |     59.90 |     340.00 |<br>| 10 | æˆ·å¤–è¿åŠ¨       | éª‘è¡Œè£…å¤‡    |  399.90 |    399.90 |       0.00 |<br>| 12 | æˆ·å¤–è¿åŠ¨       | æ»‘æ¿       |  499.90 |    399.90 |     100.00 |<br>| 11 | æˆ·å¤–è¿åŠ¨       | è¿åŠ¨å¤–å¥—    |  799.90 |    499.90 |     300.00 |<br>|  8 | æˆ·å¤–è¿åŠ¨       | å±±åœ°è‡ªè¡Œè½¦  | 1399.90 |    799.90 |     600.00 |<br>+----+---------------+------------+---------+-----------+------------+<br>12 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><p><strong>2ï¼LEAD(expr,n)å‡½æ•°</strong></p><p>LEAD(expr,n)å‡½æ•°è¿”å›å½“å‰è¡Œçš„ånè¡Œçš„exprçš„å€¼ã€‚</p><p>ä¸¾ä¾‹ï¼šæŸ¥è¯¢goodsæ•°æ®è¡¨ä¸­åä¸€ä¸ªå•†å“ä»·æ ¼ä¸å½“å‰å•†å“ä»·æ ¼çš„å·®å€¼ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT id, category, NAME, behind_price, price,behind_price - price AS diff_price<br>    -&gt; FROM(<br>    -&gt;  SELECT id, category, NAME, price,LEAD(price, 1) OVER w AS behind_price<br>    -&gt;  FROM goods WINDOW w AS (PARTITION BY category_id ORDER BY price)) t;<br>+----+---------------+------------+--------------+---------+------------+<br>| id | category      | NAME       | behind_price | price   | diff_price |<br>+----+---------------+------------+--------------+---------+------------+<br>|  5 | å¥³è£…/å¥³å£«ç²¾å“   | ç™¾è¤¶è£™      |        39.90 |   29.90 |      10.00 |<br>|  1 | å¥³è£…/å¥³å£«ç²¾å“   | Tæ¤        |        79.90 |   39.90 |      40.00 |<br>|  2 | å¥³è£…/å¥³å£«ç²¾å“   | è¿è¡£è£™      |        89.90 |   79.90 |      10.00 |<br>|  3 | å¥³è£…/å¥³å£«ç²¾å“   | å«è¡£        |        89.90 |   89.90 |       0.00 |<br>|  4 | å¥³è£…/å¥³å£«ç²¾å“   | ç‰›ä»”è£¤      |       399.90 |   89.90 |     310.00 |<br>|  6 | å¥³è£…/å¥³å£«ç²¾å“   | å‘¢ç»’å¤–å¥—     |         NULL |  399.90 |       NULL |<br>|  9 | æˆ·å¤–è¿åŠ¨       | ç™»å±±æ–       |       399.90 |   59.90 |     340.00 |<br>|  7 | æˆ·å¤–è¿åŠ¨       | è‡ªè¡Œè½¦       |       399.90 |  399.90 |       0.00 |<br>| 10 | æˆ·å¤–è¿åŠ¨       | éª‘è¡Œè£…å¤‡     |       499.90 |  399.90 |     100.00 |<br>| 12 | æˆ·å¤–è¿åŠ¨       | æ»‘æ¿        |       799.90 |  499.90 |     300.00 |<br>| 11 | æˆ·å¤–è¿åŠ¨       | è¿åŠ¨å¤–å¥—     |      1399.90 |  799.90 |     600.00 |<br>|  8 | æˆ·å¤–è¿åŠ¨       | å±±åœ°è‡ªè¡Œè½¦   |         NULL | 1399.90 |       NULL |<br>+----+---------------+------------+--------------+---------+------------+<br>12 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><h4 id="4-é¦–å°¾å‡½æ•°"><a href="#4-é¦–å°¾å‡½æ•°" class="headerlink" title="4. é¦–å°¾å‡½æ•°"></a>4. é¦–å°¾å‡½æ•°</h4><p><strong>1ï¼FIRST_VALUE(expr)å‡½æ•°</strong></p><p>FIRST_VALUE(expr)å‡½æ•°è¿”å›ç¬¬ä¸€ä¸ªexprçš„å€¼ã€‚</p><p>ä¸¾ä¾‹ï¼šæŒ‰ç…§ä»·æ ¼æ’åºï¼ŒæŸ¥è¯¢ç¬¬1ä¸ªå•†å“çš„ä»·æ ¼ä¿¡æ¯ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT id, category, NAME, price, stock,FIRST_VALUE(price) OVER w AS first_price<br>    -&gt; FROM goods WINDOW w AS (PARTITION BY category_id ORDER BY price);<br>+----+---------------+------------+---------+-------+-------------+<br>| id | category      | NAME       | price   | stock | first_price |<br>+----+---------------+------------+---------+-------+-------------+<br>|  5 | å¥³è£…/å¥³å£«ç²¾å“   | ç™¾è¤¶è£™      |   29.90 |   500 |       29.90 |<br>|  1 | å¥³è£…/å¥³å£«ç²¾å“   | Tæ¤        |   39.90 |  1000 |       29.90 |<br>|  2 | å¥³è£…/å¥³å£«ç²¾å“   | è¿è¡£è£™      |   79.90 |  2500 |       29.90 |<br>|  3 | å¥³è£…/å¥³å£«ç²¾å“   | å«è¡£       |   89.90 |  1500 |       29.90 |<br>|  4 | å¥³è£…/å¥³å£«ç²¾å“   | ç‰›ä»”è£¤      |   89.90 |  3500 |       29.90 |<br>|  6 | å¥³è£…/å¥³å£«ç²¾å“   | å‘¢ç»’å¤–å¥—    |  399.90 |  1200 |       29.90 |<br>|  9 | æˆ·å¤–è¿åŠ¨       | ç™»å±±æ–      |   59.90 |  1500 |       59.90 |<br>|  7 | æˆ·å¤–è¿åŠ¨       | è‡ªè¡Œè½¦      |  399.90 |  1000 |       59.90 |<br>| 10 | æˆ·å¤–è¿åŠ¨       | éª‘è¡Œè£…å¤‡    |  399.90 |  3500 |       59.90 |<br>| 12 | æˆ·å¤–è¿åŠ¨       | æ»‘æ¿       |  499.90 |  1200 |       59.90 |<br>| 11 | æˆ·å¤–è¿åŠ¨       | è¿åŠ¨å¤–å¥—    |  799.90 |   500 |       59.90 |<br>|  8 | æˆ·å¤–è¿åŠ¨       | å±±åœ°è‡ªè¡Œè½¦  | 1399.90 |  2500 |       59.90 |<br>+----+---------------+------------+---------+-------+-------------+<br>12 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><p><strong>2ï¼LAST_VALUE(expr)å‡½æ•°</strong></p><p>LAST_VALUE(expr)å‡½æ•°è¿”å›æœ€åä¸€ä¸ªexprçš„å€¼ã€‚</p><p>ä¸¾ä¾‹ï¼šæŒ‰ç…§ä»·æ ¼æ’åºï¼ŒæŸ¥è¯¢æœ€åä¸€ä¸ªå•†å“çš„ä»·æ ¼ä¿¡æ¯ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT id, category, NAME, price, stock,LAST_VALUE(price) OVER w AS last_price<br>    -&gt; FROM goods WINDOW w AS (PARTITION BY category_id ORDER BY price);<br>+----+---------------+------------+---------+-------+------------+<br>| id | category      | NAME       | price   | stock | last_price |<br>+----+---------------+------------+---------+-------+------------+<br>|  5 | å¥³è£…/å¥³å£«ç²¾å“   | ç™¾è¤¶è£™     |   29.90 |   500 |      29.90 |<br>|  1 | å¥³è£…/å¥³å£«ç²¾å“   | Tæ¤        |   39.90 |  1000 |      39.90 |<br>|  2 | å¥³è£…/å¥³å£«ç²¾å“   | è¿è¡£è£™     |   79.90 |  2500 |      79.90 |<br>|  3 | å¥³è£…/å¥³å£«ç²¾å“   | å«è¡£       |   89.90 |  1500 |      89.90 |<br>|  4 | å¥³è£…/å¥³å£«ç²¾å“   | ç‰›ä»”è£¤     |   89.90 |  3500 |      89.90 |<br>|  6 | å¥³è£…/å¥³å£«ç²¾å“   | å‘¢ç»’å¤–å¥—   |  399.90 |  1200 |     399.90 |<br>|  9 | æˆ·å¤–è¿åŠ¨       | ç™»å±±æ–     |   59.90 |  1500 |      59.90 |<br>|  7 | æˆ·å¤–è¿åŠ¨       | è‡ªè¡Œè½¦     |  399.90 |  1000 |     399.90 |<br>| 10 | æˆ·å¤–è¿åŠ¨       | éª‘è¡Œè£…å¤‡   |  399.90 |  3500 |     399.90 |<br>| 12 | æˆ·å¤–è¿åŠ¨       | æ»‘æ¿       |  499.90 |  1200 |     499.90 |<br>| 11 | æˆ·å¤–è¿åŠ¨       | è¿åŠ¨å¤–å¥—   |  799.90 |   500 |     799.90 |<br>|  8 | æˆ·å¤–è¿åŠ¨       | å±±åœ°è‡ªè¡Œè½¦ | 1399.90 |  2500 |    1399.90 |<br>+----+---------------+------------+---------+-------+------------+<br>12 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><h4 id="5-å…¶ä»–å‡½æ•°"><a href="#5-å…¶ä»–å‡½æ•°" class="headerlink" title="5. å…¶ä»–å‡½æ•°"></a>5. å…¶ä»–å‡½æ•°</h4><p><strong>1ï¼NTH_VALUE(expr,n)å‡½æ•°</strong></p><p>NTH_VALUE(expr,n)å‡½æ•°è¿”å›ç¬¬nä¸ªexprçš„å€¼ã€‚</p><p>ä¸¾ä¾‹ï¼šæŸ¥è¯¢goodsæ•°æ®è¡¨ä¸­æ’åç¬¬2å’Œç¬¬3çš„ä»·æ ¼ä¿¡æ¯ã€‚</p><p><strong>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç¬¬nä¸ªexprçš„å€¼æœªéå†åˆ°æ—¶ï¼Œæ˜¾ç¤ºNULLå€¼ï¼›å½“éå†åˆ°ï¼ˆè¿‡ï¼‰ç¬¬nä¸ªexprçš„å€¼ç›¸ç­‰çš„å€¼æ—¶ï¼Œæ˜¾ç¤ºç¬¬nä¸ªexprçš„å€¼</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT id, category, NAME, price,NTH_VALUE(price,2) OVER w AS second_price,<br>    -&gt; NTH_VALUE(price,3) OVER w AS third_price<br>    -&gt; FROM goods WINDOW w AS (PARTITION BY category_id ORDER BY price);<br>+----+---------------+------------+---------+--------------+-------------+<br>| id | category      | NAME       | price   | second_price | third_price |<br>+----+---------------+------------+---------+--------------+-------------+<br>|  5 | å¥³è£…/å¥³å£«ç²¾å“   | ç™¾è¤¶è£™     |   29.90 |         NULL |        NULL |<br>|  1 | å¥³è£…/å¥³å£«ç²¾å“   | Tæ¤        |   39.90 |        39.90 |        NULL |<br>|  2 | å¥³è£…/å¥³å£«ç²¾å“   | è¿è¡£è£™     |   79.90 |        39.90 |       79.90 |<br>|  3 | å¥³è£…/å¥³å£«ç²¾å“   | å«è¡£       |   89.90 |        39.90 |       79.90 |<br>|  4 | å¥³è£…/å¥³å£«ç²¾å“   | ç‰›ä»”è£¤     |   89.90 |        39.90 |       79.90 |<br>|  6 | å¥³è£…/å¥³å£«ç²¾å“   | å‘¢ç»’å¤–å¥—   |  399.90 |        39.90 |       79.90 |<br>|  9 | æˆ·å¤–è¿åŠ¨       | ç™»å±±æ–     |   59.90 |         NULL |        NULL |<br>|  7 | æˆ·å¤–è¿åŠ¨       | è‡ªè¡Œè½¦     |  399.90 |       399.90 |      399.90 |<br>| 10 | æˆ·å¤–è¿åŠ¨       | éª‘è¡Œè£…å¤‡   |  399.90 |       399.90 |      399.90 |<br>| 12 | æˆ·å¤–è¿åŠ¨       | æ»‘æ¿       |  499.90 |       399.90 |      399.90 |<br>| 11 | æˆ·å¤–è¿åŠ¨       | è¿åŠ¨å¤–å¥—   |  799.90 |       399.90 |      399.90 |<br>|  8 | æˆ·å¤–è¿åŠ¨       | å±±åœ°è‡ªè¡Œè½¦ | 1399.90 |       399.90 |      399.90 |<br>+----+---------------+------------+---------+--------------+-------------+<br>12 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><p><strong>2ï¼NTILE(n)å‡½æ•°</strong></p><p>NTILE(n)å‡½æ•°å°†åˆ†åŒºä¸­çš„æœ‰åºæ•°æ®åˆ†ä¸ºnä¸ªæ¡¶ï¼Œè®°å½•æ¡¶ç¼–å·ã€‚ï¼ˆnum / nä¸Šå–æ•´ï¼Œå…¶ä¸­numæ˜¯è¡Œæ•°ï¼Œnæ˜¯æ¡¶æ•°ï¼‰</p><p>ä¸¾ä¾‹ï¼šå°†goodsè¡¨ä¸­çš„å•†å“æŒ‰ç…§ä»·æ ¼åˆ†ä¸º3ç»„ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT NTILE(3) OVER w AS nt,id, category, NAME, price<br>    -&gt; FROM goods WINDOW w AS (PARTITION BY category_id ORDER BY price);<br>+----+----+---------------+------------+---------+<br>| nt | id | category      | NAME       | price   |<br>+----+----+---------------+------------+---------+<br>|  1 |  5 | å¥³è£…/å¥³å£«ç²¾å“ | ç™¾è¤¶è£™     |   29.90 |<br>|  1 |  1 | å¥³è£…/å¥³å£«ç²¾å“ | Tæ¤        |   39.90 |<br>|  2 |  2 | å¥³è£…/å¥³å£«ç²¾å“ | è¿è¡£è£™     |   79.90 |<br>|  2 |  3 | å¥³è£…/å¥³å£«ç²¾å“ | å«è¡£       |   89.90 |<br>|  3 |  4 | å¥³è£…/å¥³å£«ç²¾å“ | ç‰›ä»”è£¤     |   89.90 |<br>|  3 |  6 | å¥³è£…/å¥³å£«ç²¾å“ | å‘¢ç»’å¤–å¥—   |  399.90 |<br>|  1 |  9 | æˆ·å¤–è¿åŠ¨      | ç™»å±±æ–     |   59.90 |<br>|  1 |  7 | æˆ·å¤–è¿åŠ¨      | è‡ªè¡Œè½¦     |  399.90 |<br>|  2 | 10 | æˆ·å¤–è¿åŠ¨      | éª‘è¡Œè£…å¤‡   |  399.90 |<br>|  2 | 12 | æˆ·å¤–è¿åŠ¨      | æ»‘æ¿       |  499.90 |<br>|  3 | 11 | æˆ·å¤–è¿åŠ¨      | è¿åŠ¨å¤–å¥—   |  799.90 |<br>|  3 |  8 | æˆ·å¤–è¿åŠ¨      | å±±åœ°è‡ªè¡Œè½¦ | 1399.90 |<br>+----+----+---------------+------------+---------+<br>12 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><h3 id="2-5-å°-ç»“"><a href="#2-5-å°-ç»“" class="headerlink" title="2.5 å° ç»“"></a>2.5 å° ç»“</h3><p>çª—å£å‡½æ•°çš„ç‰¹ç‚¹æ˜¯å¯ä»¥åˆ†ç»„ï¼Œè€Œä¸”å¯ä»¥åœ¨åˆ†ç»„å†…æ’åºã€‚å¦å¤–ï¼Œçª—å£å‡½æ•°ä¸ä¼šå› ä¸ºåˆ†ç»„è€Œå‡å°‘åŸè¡¨ä¸­çš„è¡Œæ•°ï¼Œè¿™å¯¹æˆ‘ä»¬åœ¨åŸè¡¨æ•°æ®çš„åŸºç¡€ä¸Šè¿›è¡Œç»Ÿè®¡å’Œæ’åºéå¸¸æœ‰ç”¨ã€‚</p><h2 id="3-æ–°ç‰¹æ€§2ï¼šå…¬ç”¨è¡¨è¡¨è¾¾å¼"><a href="#3-æ–°ç‰¹æ€§2ï¼šå…¬ç”¨è¡¨è¡¨è¾¾å¼" class="headerlink" title="3. æ–°ç‰¹æ€§2ï¼šå…¬ç”¨è¡¨è¡¨è¾¾å¼"></a>3. æ–°ç‰¹æ€§2ï¼šå…¬ç”¨è¡¨è¡¨è¾¾å¼</h2><p>å…¬ç”¨è¡¨è¡¨è¾¾å¼ï¼ˆæˆ–é€šç”¨è¡¨è¡¨è¾¾å¼ï¼‰ç®€ç§°ä¸ºCTEï¼ˆCommon Table Expressionsï¼‰ã€‚<strong>CTEæ˜¯ä¸€ä¸ªå‘½åçš„ä¸´æ—¶ç»“æœé›†ï¼Œä½œç”¨èŒƒå›´æ˜¯å½“å‰è¯­å¥ã€‚</strong>CTEå¯ä»¥ç†è§£æˆä¸€ä¸ªå¯ä»¥å¤ç”¨çš„å­æŸ¥è¯¢ï¼Œå½“ç„¶è·Ÿå­æŸ¥è¯¢è¿˜æ˜¯æœ‰ç‚¹åŒºåˆ«çš„ï¼ŒCTEå¯ä»¥å¼•ç”¨å…¶ä»–CTEï¼Œä½†å­æŸ¥è¯¢ä¸èƒ½å¼•ç”¨å…¶ä»–å­æŸ¥è¯¢ã€‚æ‰€ä»¥ï¼Œå¯ä»¥è€ƒè™‘ä»£æ›¿å­æŸ¥è¯¢ã€‚</p><p>ä¾æ®è¯­æ³•ç»“æ„å’Œæ‰§è¡Œæ–¹å¼çš„ä¸åŒï¼Œå…¬ç”¨è¡¨è¡¨è¾¾å¼åˆ†ä¸º<code>æ™®é€šå…¬ç”¨è¡¨è¡¨è¾¾å¼</code>å’Œ<code>é€’å½’å…¬ç”¨è¡¨è¡¨è¾¾å¼</code> 2 ç§ã€‚</p><h3 id="3-1-æ™®é€šå…¬ç”¨è¡¨è¡¨è¾¾å¼"><a href="#3-1-æ™®é€šå…¬ç”¨è¡¨è¡¨è¾¾å¼" class="headerlink" title="3.1 æ™®é€šå…¬ç”¨è¡¨è¡¨è¾¾å¼"></a>3.1 æ™®é€šå…¬ç”¨è¡¨è¡¨è¾¾å¼</h3><p>æ™®é€šå…¬ç”¨è¡¨è¡¨è¾¾å¼çš„è¯­æ³•ç»“æ„æ˜¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">WITH CTEåç§° <br>AS ï¼ˆå­æŸ¥è¯¢ï¼‰<br>SELECT|DELETE|UPDATE è¯­å¥;<br></code></pre></td></tr></table></figure><p><strong>æ™®é€šå…¬ç”¨è¡¨è¡¨è¾¾å¼ç±»ä¼¼äºå­æŸ¥è¯¢ï¼Œä¸è¿‡ï¼Œè·Ÿå­æŸ¥è¯¢ä¸åŒçš„æ˜¯ï¼Œå®ƒå¯ä»¥è¢«å¤šæ¬¡å¼•ç”¨ï¼Œè€Œä¸”å¯ä»¥è¢«å…¶ä»–çš„æ™®é€šå…¬ç”¨è¡¨è¡¨è¾¾å¼æ‰€å¼•ç”¨ã€‚</strong></p><p>ä¸¾ä¾‹ï¼šæŸ¥è¯¢å‘˜å·¥æ‰€åœ¨çš„éƒ¨é—¨çš„è¯¦ç»†ä¿¡æ¯ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; SELECT * FROM departments<br>    -&gt; WHERE department_id IN (<br>    -&gt;                  SELECT DISTINCT department_id<br>    -&gt;                  FROM employees<br>    -&gt;                  );<br>+---------------+------------------+------------+-------------+<br>| department_id | department_name  | manager_id | location_id |<br>+---------------+------------------+------------+-------------+<br>|            10 | Administration   |        200 |        1700 |<br>|            20 | Marketing        |        201 |        1800 |<br>|            30 | Purchasing       |        114 |        1700 |<br>|            40 | Human Resources  |        203 |        2400 |<br>|            50 | Shipping         |        121 |        1500 |<br>|            60 | IT               |        103 |        1400 |<br>|            70 | Public Relations |        204 |        2700 |<br>|            80 | Sales            |        145 |        2500 |<br>|            90 | Executive        |        100 |        1700 |<br>|           100 | Finance          |        108 |        1700 |<br>|           110 | Accounting       |        205 |        1700 |<br>+---------------+------------------+------------+-------------+<br>11 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªæŸ¥è¯¢ä¹Ÿå¯ä»¥ç”¨æ™®é€šå…¬ç”¨è¡¨è¡¨è¾¾å¼çš„æ–¹å¼å®Œæˆï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; WITH emp_dept_id<br>    -&gt; AS (SELECT DISTINCT department_id FROM employees)<br>    -&gt; SELECT *<br>    -&gt; FROM departments d JOIN emp_dept_id e<br>    -&gt; ON d.department_id = e.department_id;<br>+---------------+------------------+------------+-------------+---------------+<br>| department_id | department_name  | manager_id | location_id | department_id |<br>+---------------+------------------+------------+-------------+---------------+<br>|            90 | Executive        |        100 |        1700 |            90 |<br>|            60 | IT               |        103 |        1400 |            60 |<br>|           100 | Finance          |        108 |        1700 |           100 |<br>|            30 | Purchasing       |        114 |        1700 |            30 |<br>|            50 | Shipping         |        121 |        1500 |            50 |<br>|            80 | Sales            |        145 |        2500 |            80 |<br>|            10 | Administration   |        200 |        1700 |            10 |<br>|            20 | Marketing        |        201 |        1800 |            20 |<br>|            40 | Human Resources  |        203 |        2400 |            40 |<br>|            70 | Public Relations |        204 |        2700 |            70 |<br>|           110 | Accounting       |        205 |        1700 |           110 |<br>+---------------+------------------+------------+-------------+---------------+<br>11 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>ä¾‹å­è¯´æ˜ï¼Œå…¬ç”¨è¡¨è¡¨è¾¾å¼å¯ä»¥èµ·åˆ°å­æŸ¥è¯¢çš„ä½œç”¨ã€‚ä»¥åå¦‚æœé‡åˆ°éœ€è¦ä½¿ç”¨å­æŸ¥è¯¢çš„åœºæ™¯ï¼Œä½ å¯ä»¥åœ¨æŸ¥è¯¢ä¹‹å‰ï¼Œå…ˆå®šä¹‰å…¬ç”¨è¡¨è¡¨è¾¾å¼ï¼Œç„¶ååœ¨æŸ¥è¯¢ä¸­ç”¨å®ƒæ¥ä»£æ›¿å­æŸ¥è¯¢ã€‚è€Œä¸”ï¼Œè·Ÿå­æŸ¥è¯¢ç›¸æ¯”ï¼Œå…¬ç”¨è¡¨è¡¨è¾¾å¼æœ‰ä¸€ä¸ªä¼˜ç‚¹ï¼Œå°±æ˜¯å®šä¹‰è¿‡å…¬ç”¨è¡¨è¡¨è¾¾å¼ä¹‹åçš„æŸ¥è¯¢ï¼Œå¯ä»¥åƒä¸€ä¸ªè¡¨ä¸€æ ·å¤šæ¬¡å¼•ç”¨å…¬ç”¨è¡¨è¡¨è¾¾å¼ï¼Œè€Œå­æŸ¥è¯¢åˆ™ä¸èƒ½ã€‚</p><h3 id="3-2-é€’å½’å…¬ç”¨è¡¨è¡¨è¾¾å¼"><a href="#3-2-é€’å½’å…¬ç”¨è¡¨è¡¨è¾¾å¼" class="headerlink" title="3.2 é€’å½’å…¬ç”¨è¡¨è¡¨è¾¾å¼"></a>3.2 é€’å½’å…¬ç”¨è¡¨è¡¨è¾¾å¼</h3><p>é€’å½’å…¬ç”¨è¡¨è¡¨è¾¾å¼ä¹Ÿæ˜¯ä¸€ç§å…¬ç”¨è¡¨è¡¨è¾¾å¼ï¼Œåªä¸è¿‡ï¼Œé™¤äº†æ™®é€šå…¬ç”¨è¡¨è¡¨è¾¾å¼çš„ç‰¹ç‚¹ä»¥å¤–ï¼Œå®ƒè¿˜æœ‰è‡ªå·±çš„ç‰¹ç‚¹ï¼Œå°±æ˜¯<strong>å¯ä»¥è°ƒç”¨è‡ªå·±</strong>ã€‚å®ƒçš„è¯­æ³•ç»“æ„æ˜¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">WITH RECURSIVE CTEåç§° <br>AS ï¼ˆå­æŸ¥è¯¢ï¼‰<br>SELECT|DELETE|UPDATE è¯­å¥;<br></code></pre></td></tr></table></figure><p>é€’å½’å…¬ç”¨è¡¨è¡¨è¾¾å¼ç”± 2 éƒ¨åˆ†ç»„æˆï¼Œåˆ†åˆ«æ˜¯ç§å­æŸ¥è¯¢å’Œé€’å½’æŸ¥è¯¢ï¼Œä¸­é—´é€šè¿‡å…³é”®å­— UNION  [ALL]è¿›è¡Œè¿æ¥ã€‚è¿™é‡Œçš„<strong>ç§å­æŸ¥è¯¢ï¼Œæ„æ€å°±æ˜¯è·å¾—é€’å½’çš„åˆå§‹å€¼</strong>ã€‚<strong>è¿™ä¸ªæŸ¥è¯¢åªä¼šè¿è¡Œä¸€æ¬¡ï¼Œä»¥åˆ›å»ºåˆå§‹æ•°æ®é›†ï¼Œä¹‹åé€’å½’æŸ¥è¯¢ä¼šä¸€ç›´æ‰§è¡Œï¼Œç›´åˆ°æ²¡æœ‰ä»»ä½•æ–°çš„æŸ¥è¯¢æ•°æ®äº§ç”Ÿï¼Œé€’å½’è¿”å›ã€‚</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">æœ€åçš„ç»“æœé›†ç­‰äºï¼Œåˆå§‹æ•°æ®é›†ï¼ŒåŠ ä¸Šæ¯æ¬¡çš„æŸ¥è¯¢ç»“æœï¼ˆå…¶ä¸­æ¯æ¬¡çš„æŸ¥è¯¢ç»“æœåˆä¼šä½œä¸ºä¸‹ä¸€æ¬¡æŸ¥è¯¢çš„è¾“å…¥å…¬ç”¨è¡¨ï¼Œç›´åˆ°æŸ¥è¯¢ç»“æœä¸ºç©ºï¼‰<br></code></pre></td></tr></table></figure><p><strong>æ¡ˆä¾‹ï¼š</strong>é’ˆå¯¹äºæˆ‘ä»¬å¸¸ç”¨çš„employeesè¡¨ï¼ŒåŒ…å«employee_idï¼Œlast_nameå’Œmanager_idä¸‰ä¸ªå­—æ®µã€‚å¦‚æœaæ˜¯bçš„ç®¡ç†è€…ï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥æŠŠbå«åšaçš„ä¸‹å±ï¼Œå¦‚æœåŒæ—¶båˆæ˜¯cçš„ç®¡ç†è€…ï¼Œé‚£ä¹ˆcå°±æ˜¯bçš„ä¸‹å±ï¼Œæ˜¯açš„ä¸‹ä¸‹å±ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬å°è¯•ç”¨æŸ¥è¯¢è¯­å¥åˆ—å‡ºæ‰€æœ‰å…·æœ‰ä¸‹ä¸‹å±èº«ä»½çš„äººå‘˜ä¿¡æ¯ã€‚</p><p>å¦‚æœç”¨æˆ‘ä»¬ä¹‹å‰å­¦è¿‡çš„çŸ¥è¯†æ¥è§£å†³ï¼Œä¼šæ¯”è¾ƒå¤æ‚ï¼Œè‡³å°‘è¦è¿›è¡Œ 4 æ¬¡æŸ¥è¯¢æ‰èƒ½æå®šï¼š</p><ul><li><p>ç¬¬ä¸€æ­¥ï¼Œå…ˆæ‰¾å‡ºåˆä»£ç®¡ç†è€…ï¼Œå°±æ˜¯ä¸ä»¥ä»»ä½•åˆ«äººä¸ºç®¡ç†è€…çš„äººï¼ŒæŠŠç»“æœå­˜å…¥ä¸´æ—¶è¡¨ï¼›</p></li><li><p>ç¬¬äºŒæ­¥ï¼Œæ‰¾å‡ºæ‰€æœ‰ä»¥åˆä»£ç®¡ç†è€…ä¸ºç®¡ç†è€…çš„äººï¼Œå¾—åˆ°ä¸€ä¸ªä¸‹å±é›†ï¼ŒæŠŠç»“æœå­˜å…¥ä¸´æ—¶è¡¨ï¼›</p></li><li><p>ç¬¬ä¸‰æ­¥ï¼Œæ‰¾å‡ºæ‰€æœ‰ä»¥ä¸‹å±ä¸ºç®¡ç†è€…çš„äººï¼Œå¾—åˆ°ä¸€ä¸ªä¸‹ä¸‹å±é›†ï¼ŒæŠŠç»“æœå­˜å…¥ä¸´æ—¶è¡¨ã€‚</p></li><li><p>ç¬¬å››æ­¥ï¼Œæ‰¾å‡ºæ‰€æœ‰ä»¥ä¸‹ä¸‹å±ä¸ºç®¡ç†è€…çš„äººï¼Œå¾—åˆ°ä¸€ä¸ªç»“æœé›†ã€‚</p></li></ul><p>å¦‚æœç¬¬å››æ­¥çš„ç»“æœé›†ä¸ºç©ºï¼Œåˆ™è®¡ç®—ç»“æŸï¼Œç¬¬ä¸‰æ­¥çš„ç»“æœé›†å°±æ˜¯æˆ‘ä»¬éœ€è¦çš„ä¸‹ä¸‹å±é›†äº†ï¼Œå¦åˆ™å°±å¿…é¡»ç»§ç»­è¿›è¡Œç¬¬å››æ­¥ï¼Œä¸€ç›´åˆ°ç»“æœé›†ä¸ºç©ºä¸ºæ­¢ã€‚æ¯”å¦‚ä¸Šé¢çš„è¿™ä¸ªæ•°æ®è¡¨ï¼Œå°±éœ€è¦åˆ°ç¬¬äº”æ­¥ï¼Œæ‰èƒ½å¾—åˆ°ç©ºç»“æœé›†ã€‚è€Œä¸”ï¼Œæœ€åè¿˜è¦è¿›è¡Œç¬¬å…­æ­¥ï¼šæŠŠç¬¬ä¸‰æ­¥å’Œç¬¬å››æ­¥çš„ç»“æœé›†åˆå¹¶ï¼Œè¿™æ ·æ‰èƒ½æœ€ç»ˆè·å¾—æˆ‘ä»¬éœ€è¦çš„ç»“æœé›†ã€‚</p><p>å¦‚æœç”¨é€’å½’å…¬ç”¨è¡¨è¡¨è¾¾å¼ï¼Œå°±éå¸¸ç®€å•äº†ã€‚æˆ‘ä»‹ç»ä¸‹å…·ä½“çš„æ€è·¯ã€‚</p><ul><li><p>ç”¨é€’å½’å…¬ç”¨è¡¨è¡¨è¾¾å¼ä¸­çš„ç§å­æŸ¥è¯¢ï¼Œæ‰¾å‡ºåˆä»£ç®¡ç†è€…ã€‚å­—æ®µ n è¡¨ç¤ºä»£æ¬¡ï¼Œåˆå§‹å€¼ä¸º 1ï¼Œè¡¨ç¤ºæ˜¯ç¬¬ä¸€ä»£ç®¡ç†è€…ã€‚</p></li><li><p>ç”¨é€’å½’å…¬ç”¨è¡¨è¡¨è¾¾å¼ä¸­çš„é€’å½’æŸ¥è¯¢ï¼ŒæŸ¥å‡ºä»¥è¿™ä¸ªé€’å½’å…¬ç”¨è¡¨è¡¨è¾¾å¼ä¸­çš„äººä¸ºç®¡ç†è€…çš„äººï¼Œå¹¶ä¸”ä»£æ¬¡çš„å€¼åŠ  1ã€‚ç›´åˆ°æ²¡æœ‰äººä»¥è¿™ä¸ªé€’å½’å…¬ç”¨è¡¨è¡¨è¾¾å¼ä¸­çš„äººä¸ºç®¡ç†è€…äº†ï¼Œé€’å½’è¿”å›ã€‚</p></li><li><p>åœ¨æœ€åçš„æŸ¥è¯¢ä¸­ï¼Œé€‰å‡ºæ‰€æœ‰ä»£æ¬¡å¤§äºç­‰äº 3 çš„äººï¼Œä»–ä»¬è‚¯å®šæ˜¯ç¬¬ä¸‰ä»£åŠä»¥ä¸Šä»£æ¬¡çš„ä¸‹å±äº†ï¼Œä¹Ÿå°±æ˜¯ä¸‹ä¸‹å±äº†ã€‚è¿™æ ·å°±å¾—åˆ°äº†æˆ‘ä»¬éœ€è¦çš„ç»“æœé›†ã€‚</p></li></ul><p>è¿™é‡Œçœ‹ä¼¼ä¹Ÿæ˜¯ 3 æ­¥ï¼Œå®é™…ä¸Šæ˜¯ä¸€ä¸ªæŸ¥è¯¢çš„ 3 ä¸ªéƒ¨åˆ†ï¼Œåªéœ€è¦æ‰§è¡Œä¸€æ¬¡å°±å¯ä»¥äº†ã€‚è€Œä¸”ä¹Ÿä¸éœ€è¦ç”¨ä¸´æ—¶è¡¨ä¿å­˜ä¸­é—´ç»“æœï¼Œæ¯”åˆšåˆšçš„æ–¹æ³•ç®€å•å¤šäº†ã€‚</p><p><strong>ä»£ç å®ç°ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs mysql">WITH RECURSIVE cte <br>AS <br>(<br>SELECT employee_id,last_name,manager_id,1 AS n FROM employees WHERE employee_id = 100 -- ç§å­æŸ¥è¯¢ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä»£é¢†å¯¼<br>UNION ALL<br>SELECT a.employee_id,a.last_name,a.manager_id,n+1 FROM employees AS a JOIN cte<br>ON (a.manager_id = cte.employee_id) -- é€’å½’æŸ¥è¯¢ï¼Œæ‰¾å‡ºä»¥é€’å½’å…¬ç”¨è¡¨è¡¨è¾¾å¼çš„äººä¸ºé¢†å¯¼çš„äºº<br>)<br>SELECT employee_id,last_name FROM cte WHERE n &gt;= 3; <br></code></pre></td></tr></table></figure><p>æ€»ä¹‹ï¼Œé€’å½’å…¬ç”¨è¡¨è¡¨è¾¾å¼å¯¹äºæŸ¥è¯¢ä¸€ä¸ªæœ‰å…±åŒçš„æ ¹èŠ‚ç‚¹çš„æ ‘å½¢ç»“æ„æ•°æ®ï¼Œéå¸¸æœ‰ç”¨ã€‚å®ƒå¯ä»¥ä¸å—å±‚çº§çš„é™åˆ¶ï¼Œè½»æ¾æŸ¥å‡ºæ‰€æœ‰èŠ‚ç‚¹çš„æ•°æ®ã€‚å¦‚æœç”¨å…¶ä»–çš„æŸ¥è¯¢æ–¹å¼ï¼Œå°±æ¯”è¾ƒå¤æ‚äº†ã€‚</p><h3 id="3-3-å°-ç»“"><a href="#3-3-å°-ç»“" class="headerlink" title="3.3 å° ç»“"></a>3.3 å° ç»“</h3><p>å…¬ç”¨è¡¨è¡¨è¾¾å¼çš„ä½œç”¨æ˜¯å¯ä»¥æ›¿ä»£å­æŸ¥è¯¢ï¼Œè€Œä¸”å¯ä»¥è¢«å¤šæ¬¡å¼•ç”¨ã€‚é€’å½’å…¬ç”¨è¡¨è¡¨è¾¾å¼å¯¹æŸ¥è¯¢æœ‰ä¸€ä¸ªå…±åŒæ ¹èŠ‚ç‚¹çš„æ ‘å½¢ç»“æ„æ•°æ®éå¸¸é«˜æ•ˆï¼Œå¯ä»¥è½»æ¾æå®šå…¶ä»–æŸ¥è¯¢æ–¹å¼éš¾ä»¥å¤„ç†çš„æŸ¥è¯¢ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>MySQL</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MySQL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Linuxå­¦ä¹ ç¬”è®°</title>
    <link href="/2022/02/27/Linux%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    <url>/2022/02/27/Linux%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<h1 id="Linuxå­¦ä¹ ç¬”è®°"><a href="#Linuxå­¦ä¹ ç¬”è®°" class="headerlink" title="Linuxå­¦ä¹ ç¬”è®°"></a>Linuxå­¦ä¹ ç¬”è®°</h1><h2 id="ä¸€ã€LinuxåŸºæœ¬ç®€ä»‹"><a href="#ä¸€ã€LinuxåŸºæœ¬ç®€ä»‹" class="headerlink" title="ä¸€ã€LinuxåŸºæœ¬ç®€ä»‹"></a>ä¸€ã€LinuxåŸºæœ¬ç®€ä»‹</h2><h3 id="1-1-Linuxçš„åº”ç”¨é¢†åŸŸ"><a href="#1-1-Linuxçš„åº”ç”¨é¢†åŸŸ" class="headerlink" title="1.1 Linuxçš„åº”ç”¨é¢†åŸŸ"></a>1.1 Linuxçš„åº”ç”¨é¢†åŸŸ</h3><h4 id="1-1-1-ä¸ªäººæ¡Œé¢åº”ç”¨é¢†åŸŸ"><a href="#1-1-1-ä¸ªäººæ¡Œé¢åº”ç”¨é¢†åŸŸ" class="headerlink" title="1.1.1 ä¸ªäººæ¡Œé¢åº”ç”¨é¢†åŸŸ"></a>1.1.1 ä¸ªäººæ¡Œé¢åº”ç”¨é¢†åŸŸ</h4><p>æ­¤é¢†åŸŸæ˜¯ä¼ ç»Ÿlinuxåº”ç”¨æœ€è–„å¼±çš„ç¯èŠ‚ï¼Œä¼ ç»Ÿlinuxç”±äºç•Œé¢ç®€å•ã€æ“ä½œå¤æ‚ã€åº”ç”¨è½¯ä»¶å°‘çš„ç¼ºç‚¹ï¼Œä¸€ç›´è¢«windowsæ‰€å‹åˆ¶ï¼Œä½†è¿‘äº›å¹´æ¥éšç€ubuntuã€fedora[fÉªËˆdÉ”:rÉ™] ç­‰ä¼˜ç§€æ¡Œé¢ç¯å¢ƒçš„å…´èµ·ï¼ŒåŒæ—¶å„å¤§ç¡¬ä»¶å‚å•†å¯¹å…¶æ”¯æŒçš„åŠ å¤§ï¼Œlinuxåœ¨ä¸ªäººæ¡Œé¢é¢†åŸŸçš„å æœ‰ç‡åœ¨é€æ¸çš„æé«˜ã€‚</p><h4 id="1-1-2-æœåŠ¡å™¨åº”ç”¨é¢†åŸŸ"><a href="#1-1-2-æœåŠ¡å™¨åº”ç”¨é¢†åŸŸ" class="headerlink" title="1.1.2 æœåŠ¡å™¨åº”ç”¨é¢†åŸŸ"></a>1.1.2 æœåŠ¡å™¨åº”ç”¨é¢†åŸŸ</h4><p>linuxåœ¨æœåŠ¡å™¨é¢†åŸŸçš„åº”ç”¨æ˜¯æœ€å¼ºçš„ã€‚<br>linuxå…è´¹ã€ç¨³å®šã€é«˜æ•ˆç­‰ç‰¹ç‚¹åœ¨è¿™é‡Œå¾—åˆ°äº†å¾ˆå¥½çš„ä½“ç°ï¼Œè¿‘äº›å¹´æ¥linuxæœåŠ¡å™¨å¸‚åœºå¾—åˆ°äº†é£é€Ÿçš„æå‡ï¼Œå°¤å…¶åœ¨ä¸€äº›é«˜ç«¯é¢†åŸŸå°¤ä¸ºå¹¿æ³›ã€‚</p><h4 id="1-1-3-åµŒå…¥å¼åº”ç”¨é¢†åŸŸ"><a href="#1-1-3-åµŒå…¥å¼åº”ç”¨é¢†åŸŸ" class="headerlink" title="1.1.3 åµŒå…¥å¼åº”ç”¨é¢†åŸŸ"></a>1.1.3 åµŒå…¥å¼åº”ç”¨é¢†åŸŸ</h4><p>linuxè¿è¡Œç¨³å®šã€å¯¹ç½‘ç»œçš„è‰¯å¥½æ”¯æŒæ€§ã€ä½æˆæœ¬ï¼Œä¸”å¯ä»¥æ ¹æ®éœ€è¦è¿›è¡Œè½¯ä»¶è£å‰ªï¼Œå†…æ ¸æœ€å°å¯ä»¥è¾¾åˆ°å‡ ç™¾KBç­‰ç‰¹ç‚¹ï¼Œä½¿å…¶è¿‘äº›å¹´æ¥åœ¨åµŒå…¥å¼é¢†åŸŸçš„åº”ç”¨å¾—åˆ°éå¸¸å¤§çš„æé«˜ã€‚</p><p>ä¸»è¦åº”ç”¨ï¼šæœºé¡¶ç›’ã€æ•°å­—ç”µè§†ã€ç½‘ç»œç”µè¯ã€ç¨‹æ§äº¤æ¢æœºã€æ‰‹æœºã€PDAã€æ™ºèƒ½å®¶å±…ã€æ™ºèƒ½ç¡¬ä»¶ç­‰éƒ½æ˜¯å…¶åº”ç”¨é¢†åŸŸã€‚ä»¥ååœ¨<strong>ç‰©è”ç½‘</strong>ä¸­åº”ç”¨ä¼šæ›´åŠ å¹¿æ³›ã€‚</p><h3 id="1-2-å­¦ä¹ LINUXçš„é˜¶æ®µ"><a href="#1-2-å­¦ä¹ LINUXçš„é˜¶æ®µ" class="headerlink" title="1.2 å­¦ä¹ LINUXçš„é˜¶æ®µ"></a>1.2 å­¦ä¹ LINUXçš„é˜¶æ®µ</h3><p>linuxæ˜¯ä¸€ä¸ªå¼€æºã€å…è´¹çš„æ“ä½œç³»ç»Ÿï¼Œå…¶ç¨³å®šæ€§ã€å®‰å…¨æ€§ã€å¤„ç†å¤šå¹¶å‘å·²ç»å¾—åˆ°ä¸šç•Œçš„è®¤å¯ï¼Œç›®å‰å¾ˆå¤šä¸­å‹ï¼Œå¤§å‹ç”šè‡³æ˜¯é›†ç¾¤é¡¹ç›®éƒ½åœ¨ä½¿ç”¨linux,å¾ˆå¤šè½¯ä»¶å…¬å¸è€ƒè™‘åˆ°å¼€å‘æˆæœ¬éƒ½é¦–é€‰linux,åœ¨ä¸­å›½è½¯ä»¶å…¬å¸å¾—åˆ°å¹¿æ³›çš„ä½¿ç”¨ã€‚</p><p>æˆ‘ä¸ªäººè®¤ä¸ºå­¦ä¹ linuxæµç¨‹ä¸º:<br>ç¬¬ 1 é˜¶æ®µï¼šlinuxç¯å¢ƒä¸‹çš„åŸºæœ¬æ“ä½œå‘½ä»¤ï¼ŒåŒ…æ‹¬ æ–‡ä»¶æ“ä½œå‘½ä»¤(rmmkdirchmod,chown) ç¼–è¾‘å·¥å…·ä½¿ç”¨ï¼ˆvivimï¼‰linuxç”¨æˆ·ç®¡ç†(useradduserdelusermod)ç­‰<br>ç¬¬ 2 é˜¶æ®µï¼šlinuxçš„å„ç§é…ç½®ï¼ˆç¯å¢ƒå˜é‡é…ç½®ï¼Œç½‘ç»œé…ç½®ï¼ŒæœåŠ¡é…ç½®ï¼‰<br>ç¬¬ 3 é˜¶æ®µï¼šlinuxä¸‹å¦‚ä½•æ­å»ºå¯¹åº”è¯­è¨€çš„å¼€å‘ç¯å¢ƒï¼ˆå¤§æ•°æ®ï¼ŒJavaEE,Pythonç­‰ï¼‰<br>ç¬¬ 4 é˜¶æ®µï¼šèƒ½ç¼–å†™shellè„šæœ¬ï¼Œå¯¹LinuxæœåŠ¡å™¨è¿›è¡Œç»´æŠ¤ã€‚<br>ç¬¬ 5 é˜¶æ®µï¼šèƒ½è¿›è¡Œå®‰å…¨è®¾ç½®ï¼Œé˜²æ­¢æ”»å‡»ï¼Œä¿éšœæœåŠ¡å™¨æ­£å¸¸è¿è¡Œï¼Œèƒ½å¯¹ç³»ç»Ÿè°ƒä¼˜ã€‚<br>ç¬¬ 6 é˜¶æ®µï¼šæ·±å…¥ç†è§£Linuxç³»ç»Ÿï¼ˆå¯¹å†…æ ¸æœ‰ç ”ç©¶ï¼‰ï¼Œç†Ÿç»ƒæŒæ¡å¤§å‹ç½‘ç«™åº”ç”¨æ¶æ„ç»„æˆã€å¹¶ç†Ÿæ‚‰å„ä¸ªç¯èŠ‚çš„éƒ¨ç½²å’Œç»´æŠ¤æ–¹æ³•ã€‚</p><h3 id="1-3-LINUXçš„å­¦ä¹ æ–¹æ³•å’Œå»ºè®®"><a href="#1-3-LINUXçš„å­¦ä¹ æ–¹æ³•å’Œå»ºè®®" class="headerlink" title="1.3 LINUXçš„å­¦ä¹ æ–¹æ³•å’Œå»ºè®®"></a>1.3 LINUXçš„å­¦ä¹ æ–¹æ³•å’Œå»ºè®®</h3><figure class="highlight basic"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">1 </span>) é«˜æ•ˆè€Œæ„‰å¿«çš„å­¦ä¹ <br><span class="hljs-symbol">2 </span>) å…ˆå»ºç«‹ä¸€ä¸ªæ•´ä½“æ¡†æ¶ï¼Œç„¶åç»†èŠ‚<br><span class="hljs-symbol">3 </span>) ä¸éœ€è¦æŒæ¡æ‰€æœ‰çš„LinuxæŒ‡ä»¤ï¼Œè¦å­¦ä¼šæŸ¥è¯¢æ‰‹å†Œå’Œç™¾åº¦<br><span class="hljs-symbol">4 </span>) å…ˆknowhow,å†knowwhy<br><span class="hljs-symbol">5 </span>) è®¡ç®—æœºæ˜¯ä¸€é—¨â€åšä¸­å­¦â€ çš„å­¦ç§‘ ,ä¸æ˜¯ä¼šäº†å†åšï¼Œè€Œæ˜¯åšäº†æ‰ä¼š.<br><span class="hljs-symbol">6 </span>) é€‚å½“çš„å›«å›µåæ£<br><span class="hljs-symbol">7 </span>) Linuxä¸æ˜¯ç¼–ç¨‹ï¼Œé‡ç‚¹æ˜¯å®é™…æ“ä½œï¼Œå„ç§å¸¸ç”¨æŒ‡ä»¤è¦ç©çš„æºœ<br></code></pre></td></tr></table></figure><h2 id="äºŒã€LINUX-å…¥é—¨"><a href="#äºŒã€LINUX-å…¥é—¨" class="headerlink" title="äºŒã€LINUX å…¥é—¨"></a>äºŒã€LINUX å…¥é—¨</h2><h3 id="2-1-LINUXä»‹ç»"><a href="#2-1-LINUXä»‹ç»" class="headerlink" title="2.1 LINUXä»‹ç»"></a>2.1 LINUXä»‹ç»</h3><p>1 ) Linuxæ€ä¹ˆè¯» ã€é‡Œçº½å…‹æ–¯ï¼Œåˆ©å°¼å…‹æ–¯ï¼Œé‡Œçº³å…‹æ–¯ã€‘<br>2 ) Linuxæ˜¯ä¸€æ¬¾æ“ä½œç³»ç»Ÿï¼Œå…è´¹ï¼Œå¼€æºï¼Œå®‰å…¨ï¼Œé«˜æ•ˆï¼Œç¨³å®šï¼Œ å¤„ç†é«˜å¹¶å‘éå¸¸å¼ºæ‚ï¼Œç°åœ¨å¾ˆå¤šçš„ä¼ä¸šçº§çš„é¡¹ç›®éƒ½éƒ¨ç½²åˆ°Linux/unixæœåŠ¡å™¨è¿è¡Œã€‚<br>3 ) Linuxåˆ›å§‹äºº </p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20220221172406244.png" alt="linus"></p><p>4 ) Linuxçš„å‰ç¥¥ç‰©</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20220221172234551.png" alt="Tux"></p><p>5 ) Linuxçš„ä¸»è¦çš„å‘è¡Œç‰ˆ:Ubuntuã€RedHatã€CentOSç­‰ï¼Œ<a href="https://www.kernel.org/">Linuxå†…æ ¸æºç ä¸‹è½½åœ°å€</a>ï¼Œå¯ä»¥å°†æºç ä¸‹è½½ä¸‹æ¥æŸ¥çœ‹ã€‚</p><h3 id="2-2Unixä¸Linuxçš„å…³ç³»"><a href="#2-2Unixä¸Linuxçš„å…³ç³»" class="headerlink" title="2.2Unixä¸Linuxçš„å…³ç³»"></a>2.2Unixä¸Linuxçš„å…³ç³»</h3><h4 id="2-2-1-Unixæ¥æº"><a href="#2-2-1-Unixæ¥æº" class="headerlink" title="2.2.1 Unixæ¥æº"></a>2.2.1 Unixæ¥æº</h4><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/unix%E6%9D%A5%E6%BA%90.jpg" alt="Unixæ¥æº"></p><h4 id="2-2-2-Linuxæ¥æº"><a href="#2-2-2-Linuxæ¥æº" class="headerlink" title="2.2.2 Linuxæ¥æº"></a>2.2.2 Linuxæ¥æº</h4><p>Richardæå‡ºäº†ä¼Ÿå¤§çš„GNUè®¡åˆ’ï¼Œå¤§å¤§ä¿ƒè¿›äº†å¼€æºäº‹ä¸šã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/Linux%E6%9D%A5%E6%BA%90.jpg" alt="Linuxæ¥æº"></p><h4 id="2-2-3-Linuxä¸Unixå…³ç³»"><a href="#2-2-3-Linuxä¸Unixå…³ç³»" class="headerlink" title="2.2.3 Linuxä¸Unixå…³ç³»"></a>2.2.3 Linuxä¸Unixå…³ç³»</h4><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/Linux%E4%B8%8EUnix%E5%85%B3%E7%B3%BB.jpg" alt="Linuxä¸Unixå…³ç³»"></p><h4 id="2-2-4-Linuxä¸Windowså…³ç³»"><a href="#2-2-4-Linuxä¸Windowså…³ç³»" class="headerlink" title="2.2.4 Linuxä¸Windowså…³ç³»"></a>2.2.4 Linuxä¸Windowså…³ç³»</h4><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/Linux%E4%B8%8EWindows%E5%85%B3%E7%B3%BB.jpg" alt="Linuxä¸Windowså…³ç³»"></p><h2 id="ä¸‰ã€VM-å’Œ-LINUX-ç³»ç»Ÿ-CENTOS-å®‰è£…"><a href="#ä¸‰ã€VM-å’Œ-LINUX-ç³»ç»Ÿ-CENTOS-å®‰è£…" class="headerlink" title="ä¸‰ã€VM å’Œ LINUX ç³»ç»Ÿ (CENTOS) å®‰è£…"></a>ä¸‰ã€VM å’Œ LINUX ç³»ç»Ÿ (CENTOS) å®‰è£…</h2><h3 id="3-1-å®‰è£…VMå’ŒCENTOS"><a href="#3-1-å®‰è£…VMå’ŒCENTOS" class="headerlink" title="3.1 å®‰è£…VMå’ŒCENTOS"></a>3.1 å®‰è£…VMå’ŒCENTOS</h3><p>å­¦ä¹ Linuxéœ€è¦ä¸€ä¸ªç¯å¢ƒï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿæœºï¼Œç„¶ååœ¨è™šæ‹Ÿæœºä¸Šå®‰è£…ä¸€ä¸ªCentosç³»ç»Ÿæ¥å­¦ä¹ ã€‚</p><p>1 )å…ˆå®‰è£…virtual machine 15.5<br>2 )å†å®‰è£…Linux(CentOS 7.6 \ CentOS 8.1)<br>3 )åŸç†ç¤ºæ„å›¾ï¼Œè¿™é‡Œæˆ‘ä»¬ç”»å›¾è¯´æ˜ä¸€ä¸‹ VM å’Œ CentOSçš„å…³ç³»ã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20220221184653303.png"></p><h3 id="3-2-å®‰è£…æ­¥éª¤"><a href="#3-2-å®‰è£…æ­¥éª¤" class="headerlink" title="3.2 å®‰è£…æ­¥éª¤"></a>3.2 å®‰è£…æ­¥éª¤</h3><p>1 ) å»BIOSé‡Œä¿®æ”¹è®¾ç½®å¼€å¯è™šæ‹ŸåŒ–è®¾å¤‡æ”¯æŒ<br>2 ) å®‰è£…è™šæ‹Ÿæœºè½¯ä»¶(VM 15.5)<br>3 ) åˆ›å»ºè™šæ‹Ÿæœº(ç©ºé—´)<br>4 ) å®‰è£…ç³»ç»Ÿ(CentOS 6.8 )</p><h3 id="3-3-è™šæ‹Ÿæœºç½‘ç»œè¿æ¥ä¸‰ç§æ–¹å¼"><a href="#3-3-è™šæ‹Ÿæœºç½‘ç»œè¿æ¥ä¸‰ç§æ–¹å¼" class="headerlink" title="3.3 è™šæ‹Ÿæœºç½‘ç»œè¿æ¥ä¸‰ç§æ–¹å¼"></a>3.3 è™šæ‹Ÿæœºç½‘ç»œè¿æ¥ä¸‰ç§æ–¹å¼</h3><p>è™šæ‹Ÿæœºç½‘ç»œè¿æ¥æœ‰ä¸‰ç§æ–¹å¼ï¼šæ¡¥æ¥æ¨¡å¼ã€NATæ¨¡å¼å’Œä¸»æœºæ¨¡å¼ã€‚</p><p>1.æ¡¥æ¥æ¨¡å¼ï¼šè™šæ‹Ÿæœºç³»ç»Ÿå¯ä»¥ä¸å¤–éƒ¨ç³»ç»Ÿäº’ç›¸é€šè®¯ï¼Œä½†æ˜¯ç”±äºæ¡¥æ¥æ¨¡å¼å ç”¨ä¸ç‰©ç†æœºåŒä¸€çº§çš„ipåœ°å€ï¼Œæ‰€ä»¥å¦‚æœå½“å‰å±€åŸŸç½‘ipåœ°å€è€—å°½ï¼Œå®¹æ˜“é€ æˆipå†²çª</p><p>2.NATæ¨¡å¼ï¼šç½‘ç»œåœ°å€è½¬æ¢æ¨¡å¼ï¼Œè™šæ‹Ÿæœºç³»ç»Ÿå¯ä»¥å‘å¤–éƒ¨ç³»ç»Ÿå‘æ¶ˆæ¯ï¼Œä½†æ˜¯å¤–éƒ¨ç³»ç»Ÿä¸å¯ä»¥å‘è™šæ‹Ÿæœºç³»ç»Ÿå‘æ¶ˆæ¯ï¼ˆå¦‚æœæ²¡æœ‰å†…ç½‘ç©¿é€ç›¸å…³åŠŸèƒ½çš„è¯ï¼‰ï¼ŒNATæ¨¡å¼ä¸ä¼šé€ æˆipå†²çªã€‚</p><p>3.ä¸»æœºæ¨¡å¼ï¼šå¯ä»¥æˆä¸ºå•æœºæ¨¡å¼ï¼Œä¸ä¸å¤–éƒ¨ç³»ç»Ÿè¿æ¥ç½‘ç»œï¼Œæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ç³»ç»Ÿã€‚</p><h3 id="3-4-è™šæ‹Ÿæœºå…‹éš†"><a href="#3-4-è™šæ‹Ÿæœºå…‹éš†" class="headerlink" title="3.4 è™šæ‹Ÿæœºå…‹éš†"></a>3.4 è™šæ‹Ÿæœºå…‹éš†</h3><p>å¦‚æœå·²ç»å®‰è£…äº†ä¸€å°Linuxæ“ä½œç³»ç»Ÿï¼Œæ­¤æ—¶è¿˜éœ€è¦æ›´å¤šï¼Œè¿™æ—¶å¯ä»¥ä½¿ç”¨è™šæ‹Ÿæœºå…‹éš†æ“ä½œï¼Œæœ‰ä»¥ä¸‹ä¸¤ç§æ–¹å¼ï¼š</p><p>æ–¹å¼1ï¼šç›´æ¥æ‹·è´ä¸€ä»½å®‰è£…å¥½çš„è™šæ‹Ÿæœºæ–‡ä»¶</p><p>æ–¹å¼2ï¼šä½¿ç”¨vmwareçš„å…‹éš†æ“ä½œ(éœ€è¦å…ˆå…³é—­Linuxç³»ç»Ÿ)</p><h3 id="3-5-è™šæ‹Ÿæœºå¿«ç…§"><a href="#3-5-è™šæ‹Ÿæœºå¿«ç…§" class="headerlink" title="3.5 è™šæ‹Ÿæœºå¿«ç…§"></a>3.5 è™šæ‹Ÿæœºå¿«ç…§</h3><p>å¦‚æœåœ¨ä½¿ç”¨è™šæ‹Ÿæœºç³»ç»Ÿçš„æ—¶å€™ï¼ˆæ¯”å¦‚Linuxï¼‰ï¼Œå¦‚æœä½ æƒ³å›åˆ°åŸå…ˆçš„æŸä¸€ä¸ªçŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯è¯´ä½ æ‹…å¿ƒå¯èƒ½æœ‰äº›è¯¯æ“ä½œé€ æˆç³»ç»Ÿå¼‚å¸¸ï¼Œéœ€è¦å›åˆ°åŸå…ˆæŸä¸ªæ­£å¸¸è¿è¡Œçš„çŠ¶æ€ï¼Œvmwareç‰¹æä¾›äº†è¿™æ ·çš„åŠŸèƒ½ï¼Œå«å¿«ç…§ç®¡ç†ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">åº”ç”¨å®ä¾‹ï¼š<br>1.å®‰è£…å¥½ç³»ç»Ÿä»¥åï¼Œå…ˆåšä¸€ä¸ªå¿«ç…§A<br>2.è¿›å…¥ç³»ç»Ÿï¼Œåˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œåœ¨ä¿å­˜ä¸€ä¸ªå¿«ç…§B<br>3.å›åˆ°ç³»ç»Ÿåˆšåˆšå®‰è£…å¥½çš„çŠ¶æ€ï¼Œå³å¿«ç…§A<br>4Aè¯•è¯•çœ‹ï¼Œæ˜¯å¦è¿˜èƒ½å†æ¬¡å›åˆ°å¿«ç…§Bï¼ˆç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼‰<br></code></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¿«ç…§åº•å±‚æ˜¯ä½¿ç”¨æŒ‡é’ˆå®ç°çš„ã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20220221193015812.png"></p><h3 id="3-6-è™šæ‹Ÿæœºè¿ç§»åˆ é™¤"><a href="#3-6-è™šæ‹Ÿæœºè¿ç§»åˆ é™¤" class="headerlink" title="3.6 è™šæ‹Ÿæœºè¿ç§»åˆ é™¤"></a>3.6 è™šæ‹Ÿæœºè¿ç§»åˆ é™¤</h3><p>è™šæ‹Ÿæœºç³»ç»Ÿçš„æœ¬è´¨å°±æ˜¯æ–‡ä»¶ã€‚å› æ­¤è™šæ‹Ÿæœºç³»ç»Ÿçš„è¿ç§»å¾ˆæ–¹ä¾¿ï¼Œå¯ä»¥æŠŠå®‰è£…å¥½çš„è™šæ‹Ÿæœºç³»ç»Ÿè¿™ä¸ªæ–‡ä»¶å¤¹æ•´ä½“<strong>æ‹·è´æˆ–è€…å‰ªåˆ‡</strong>åˆ°å¦å¤–ä½ç½®ä½¿ç”¨ã€‚åŒæ ·åœ°ï¼Œè™šæ‹Ÿæœºç³»ç»Ÿåˆ é™¤ä¹Ÿå¾ˆç®€å•ï¼Œç”¨vmwareè¿›è¡Œç§»é™¤ï¼ˆèœå• -&gt; ä»ç£ç›˜åˆ é™¤ï¼‰ï¼Œæˆ–è€…ç›´æ¥æ‰‹åŠ¨åˆ é™¤è™šæ‹Ÿç³»ç»Ÿå¯¹åº”çš„æ–‡ä»¶å¤¹å³å¯ã€‚</p><h3 id="3-7-vmtools"><a href="#3-7-vmtools" class="headerlink" title="3.7 vmtools"></a>3.7 vmtools</h3><h4 id="3-7-1-vmtoolsä½œç”¨"><a href="#3-7-1-vmtoolsä½œç”¨" class="headerlink" title="3.7.1 vmtoolsä½œç”¨"></a>3.7.1 vmtoolsä½œç”¨</h4><ol><li>vmtoolså®‰è£…åï¼Œå¯ä»¥è®©æˆ‘ä»¬åœ¨windowsä¸‹è·Ÿå¥½çš„ç®¡ç†vmè™šæ‹Ÿæœº</li><li>å¯ä»¥è®¾ç½®windowså’Œcentosçš„å…±äº«æ–‡ä»¶å¤¹</li></ol><h4 id="3-7-2-vmtoolsçš„å®‰è£…æ­¥éª¤"><a href="#3-7-2-vmtoolsçš„å®‰è£…æ­¥éª¤" class="headerlink" title="3.7.2 vmtoolsçš„å®‰è£…æ­¥éª¤"></a>3.7.2 vmtoolsçš„å®‰è£…æ­¥éª¤</h4><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-number">1</span>.è¿›å…¥centos<br><span class="hljs-number">2</span>.ç‚¹å‡»vmèœå•çš„ -&gt; install vmwaretools<br><span class="hljs-number">3</span>.centosä¼šå‡ºç°ä¸€ä¸ªvmçš„å®‰è£…åŒ…ï¼Œxx<span class="hljs-selector-class">.tar</span><span class="hljs-selector-class">.gz</span><br><span class="hljs-number">4</span>.æ‹·è´åˆ°/opt,ä½¿ç”¨è§£å‹å‘½ä»¤tar -zxvf xx<span class="hljs-selector-class">.tar</span><span class="hljs-selector-class">.gz</span>, å¾—åˆ°ä¸€ä¸ªå®‰è£…æ–‡ä»¶<br><span class="hljs-number">5</span>.è¿›å…¥è¯¥vmè§£å‹çš„ç›®å½• ï¼Œè¯¥æ–‡ä»¶åœ¨/optç›®å½•ä¸‹<br><span class="hljs-number">6</span>.å®‰è£… ./vmware-install<span class="hljs-selector-class">.pl</span><br><span class="hljs-number">7</span>.å…¨éƒ¨ä½¿ç”¨é»˜è®¤è®¾ç½®å³å¯<br><span class="hljs-number">8</span>.éœ€è¦rebooté‡æ–°å¯åŠ¨å³å¯ç”Ÿæ•ˆ<br><span class="hljs-number">9</span>.æ³¨æ„ï¼šå®‰è£…vmtoolsï¼Œéœ€è¦æœ‰gcc<br></code></pre></td></tr></table></figure><h4 id="3-7-3-ä½¿ç”¨vmtoolsæ¥è®¾ç½®windowså’Œlinuxçš„å…±äº«æ–‡ä»¶å¤¹"><a href="#3-7-3-ä½¿ç”¨vmtoolsæ¥è®¾ç½®windowså’Œlinuxçš„å…±äº«æ–‡ä»¶å¤¹" class="headerlink" title="3.7.3 ä½¿ç”¨vmtoolsæ¥è®¾ç½®windowså’Œlinuxçš„å…±äº«æ–‡ä»¶å¤¹"></a>3.7.3 ä½¿ç”¨vmtoolsæ¥è®¾ç½®windowså’Œlinuxçš„å…±äº«æ–‡ä»¶å¤¹</h4><p>1.åœ¨windowsä¸­æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹</p><p>2.åœ¨vmwareä¸­è®¾ç½®å…±äº«æ–‡ä»¶å¤¹</p><p>3.åœ¨Centosçš„/mnt/hgfs/ä¸‹å¯ä»¥æ‰¾åˆ°å…±äº«æ–‡ä»¶å¤¹</p><h2 id="å››ã€Linux-çš„ç›®å½•ç»“æ„"><a href="#å››ã€Linux-çš„ç›®å½•ç»“æ„" class="headerlink" title="å››ã€Linux çš„ç›®å½•ç»“æ„"></a>å››ã€Linux çš„ç›®å½•ç»“æ„</h2><h3 id="4-1-åŸºæœ¬ä»‹ç»"><a href="#4-1-åŸºæœ¬ä»‹ç»" class="headerlink" title="4.1 åŸºæœ¬ä»‹ç»"></a>4.1 åŸºæœ¬ä»‹ç»</h3><p>linuxçš„æ–‡ä»¶ç³»ç»Ÿæ˜¯é‡‡ç”¨çº§å±‚å¼çš„æ ‘çŠ¶ç›®å½•ç»“æ„ï¼Œåœ¨æ­¤ç»“æ„ä¸­çš„æœ€ä¸Šå±‚æ˜¯æ ¹ç›®å½•â€œ/â€ï¼Œç„¶ååœ¨æ­¤ç›®å½•ä¸‹å†åˆ›å»ºå…¶ä»–çš„ç›®å½•ã€‚</p><p>æ·±åˆ»ç†è§£linuxæ ‘çŠ¶æ–‡ä»¶ç›®å½•æ˜¯éå¸¸é‡è¦çš„ï¼Œè¿™é‡Œæˆ‘ç»™å¤§å®¶è¯´æ˜ä¸€ä¸‹ï¼Œè®°ä½ä¸€å¥ç»å…¸çš„è¯ï¼š<strong>åœ¨Linuxä¸–ç•Œé‡Œï¼Œä¸€åˆ‡çš†æ–‡ä»¶ã€‚</strong>ç¡¬ä»¶éƒ½å½“åšæ–‡ä»¶æ¥ç®¡ç†ã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20220221203356156.png"></p><h3 id="4-2-ç›®å½•ç»“æ„çš„å…·ä½“ä»‹ç»"><a href="#4-2-ç›®å½•ç»“æ„çš„å…·ä½“ä»‹ç»" class="headerlink" title="4.2 ç›®å½•ç»“æ„çš„å…·ä½“ä»‹ç»"></a>4.2 ç›®å½•ç»“æ„çš„å…·ä½“ä»‹ç»</h3><ul><li><code>/binï¼š</code> æ˜¯Binaryçš„ç¼©å†™ï¼Œè¿™ä¸ªç›®å½•å­˜æ”¾ç€æœ€ç»å¸¸ä½¿ç”¨çš„å‘½ä»¤(å‘½ä»¤å…¶å®å°±æ˜¯ä¸€ä¸ªä¸ªå¯æ‰§è¡Œæ–‡ä»¶)ã€‚</li><li><code>/sbin</code>ï¼šså°±æ˜¯Super Userçš„æ„æ€ï¼Œè¿™é‡Œå­˜æ”¾çš„æ˜¯ç³»ç»Ÿç®¡ç†å‘˜ä½¿ç”¨çš„ç³»ç»Ÿç®¡ç†ç¨‹åºã€‚</li><li><code>/homeï¼š</code>å­˜æ”¾æ™®é€šç”¨æˆ·çš„ä¸»ç›®å½•ï¼Œåœ¨Linuxä¸­æ¯ä¸ªç”¨æˆ·éƒ½æœ‰ä¸€ä¸ªè‡ªå·±çš„ç›®å½•ï¼Œä¸€èˆ¬è¯¥ç›®å½•åæ˜¯ä»¥ç”¨æˆ·çš„è´¦å·å‘½åçš„ã€‚(å¯¹åº”MacOSä¸­çš„<code>/Users</code>ç›®å½•)</li><li><code>/rootï¼š</code>è¯¥ç›®å½•ä¸ºç³»ç»Ÿç®¡ç†å‘˜ï¼Œä¹Ÿç§°ä½œè¶…çº§æƒé™è€…çš„ç”¨æˆ·ä¸»ç›®å½•ã€‚</li><li><code>/lib</code>ï¼šç³»ç»Ÿå¼€æœºæ‰€éœ€è¦æœ€åŸºæœ¬çš„åŠ¨æ€è¿æ¥å…±äº«åº“ï¼Œå…¶ä½œç”¨ç±»ä¼¼äºWindowsé‡Œçš„DLLæ–‡ä»¶ã€‚å‡ ä¹æ‰€æœ‰çš„åº”ç”¨ç¨‹åºéƒ½éœ€è¦ç”¨åˆ°è¿™äº›å…±äº«åº“ã€‚</li><li><code>/lost+found</code>ï¼šè¿™ä¸ªç›®å½•ä¸€èˆ¬æƒ…å†µä¸‹æ˜¯ç©ºçš„ï¼Œå½“ç³»ç»Ÿéæ³•å…³æœºåï¼Œè¿™é‡Œå°±å­˜æ”¾äº†ä¸€äº›æ–‡ä»¶ã€‚</li><li><code>/etc</code>ï¼šæ‰€æœ‰çš„ç³»ç»Ÿç®¡ç†æ‰€éœ€è¦çš„é…ç½®æ–‡ä»¶å’Œå­ç›®å½•ï¼Œæ¯”å¦‚å®‰è£…mysqlæ•°æ®åº“ my.confã€‚</li><li><code>/boot</code>:å­˜æ”¾çš„æ˜¯å¯åŠ¨Linuxæ—¶ä½¿ç”¨çš„ä¸€äº›æ ¸å¿ƒæ–‡ä»¶ï¼ŒåŒ…æ‹¬ä¸€äº›è¿æ¥æ–‡ä»¶ä»¥åŠé•œåƒæ–‡ä»¶ã€‚</li><li><code>/proc</code>ï¼šè¿™ä¸ªç›®å½•æ˜¯ä¸€ä¸ªè™šæ‹Ÿçš„ç›®å½•ï¼Œå®ƒæ˜¯ç³»ç»Ÿå†…å­˜çš„æ˜ å°„ï¼Œè®¿é—®è¿™ä¸ªç›®å½•æ¥è·å–ç³»ç»Ÿä¿¡æ¯ã€‚è¯¥ç›®å½•ä¸è¦åŠ¨ã€‚</li><li><code>/srv</code>ï¼šserviceçš„ç¼©å†™ï¼Œè¯¥ç›®å½•å­˜æ”¾ä¸€äº›æœåŠ¡å¯åŠ¨ä¹‹åéœ€è¦æä¾›çš„æ•°æ®ã€‚è¯¥ç›®å½•ä¸è¦åŠ¨ã€‚</li><li><code>/sys</code>ï¼šè¿™æ˜¯linux2.6å†…æ ¸çš„ä¸€ä¸ªå¾ˆå¤§çš„å˜åŒ–ã€‚è¯¥ç›®å½•ä¸‹å®‰è£…äº†2.6å†…æ ¸ä¸­æ–°å‡ºç°çš„ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿsysfsã€‚è¯¥ç›®å½•ä¸è¦åŠ¨ã€‚</li><li><code>/tmp</code>ï¼šè¿™ä¸ªç›®å½•æ˜¯ç”¨æ¥å­˜æ”¾ä¸€äº›ä¸´æ—¶æ–‡ä»¶çš„ã€‚</li><li><code>/dev</code>ï¼šç±»ä¼¼windowsçš„è®¾å¤‡ç®¡ç†å™¨ï¼ŒæŠŠæ‰€æœ‰çš„<strong>ç¡¬ä»¶</strong>ç”¨<strong>æ–‡ä»¶çš„å½¢å¼å­˜å‚¨</strong>ã€‚</li><li><code>/media</code>:linuxç³»ç»Ÿä¼šè‡ªåŠ¨è¯†åˆ«ä¸€äº›è®¾å¤‡ï¼Œä¾‹å¦‚Uç›˜å…‰é©±ç­‰ç­‰ï¼Œå½“è¯†åˆ«åï¼Œlinuxä¼šæŠŠè¯†åˆ«çš„è®¾å¤‡æŒ‚è½½åˆ°è¿™ä¸ªç›®å½•ä¸‹(LinuxæŠŠè¿™äº›è®¾å¤‡æ˜ å°„æˆæ–‡ä»¶è¿›è¡Œç®¡ç†)ã€‚</li><li><code>/mnt</code>:ç³»ç»Ÿæä¾›è¯¥ç›®å½•æ˜¯ä¸ºäº†è®©ç”¨æˆ·ä¸´æ—¶æŒ‚è½½åˆ«çš„æ–‡ä»¶ç³»ç»Ÿçš„ï¼Œæˆ‘ä»¬å¯ä»¥å°†å¤–éƒ¨çš„å­˜å‚¨æŒ‚è½½åœ¨/mnt/ä¸Šï¼Œç„¶åè¿›å…¥è¯¥ç›®å½•å°±å¯ä»¥æŸ¥çœ‹é‡Œé¢çš„å†…å®¹äº†ã€‚</li><li><code>/opt</code>:è¿™æ˜¯ç»™ä¸»æœºé¢å¤–å®‰è£…è½¯ä»¶æ‰€<strong>æ‘†æ”¾</strong>çš„ç›®å½•ï¼Œå¦‚å®‰è£…ORACLEæ•°æ®åº“å°±å¯æ”¾åˆ°è¯¥ç›®å½•ä¸‹ã€‚é»˜è®¤ä¸ºç©ºã€‚</li><li><code>/usr/local</code>ï¼šè¿™æ˜¯å¦ä¸€ä¸ªç»™ä¸»æœºé¢å¤–å®‰è£…è½¯ä»¶æ‰€å®‰è£…çš„ç›®å½•ï¼Œä¸€èˆ¬æ˜¯é€šè¿‡ç¼–è¯‘æºç çš„æ–¹å¼å®‰è£…çš„ç¨‹åºã€‚</li><li><code>/var</code>:è¿™ä¸ªç›®å½•ä¸­å­˜æ”¾ç€åœ¨ä¸æ–­æ‰©å……ç€çš„ä¸œè¥¿ï¼Œä¹ æƒ¯å°†ç»å¸¸è¢«ä¿®æ”¹çš„ç›®å½•æ”¾åœ¨è¿™ä¸ªç›®å½•ä¸‹ï¼ŒåŒ…æ‹¬å„ç§æ—¥å¿—æ–‡ä»¶ã€‚</li><li><code>/selinux</code>ï¼šSELinuxæ˜¯ä¸€ç§å®‰å…¨å­ç³»ç»Ÿï¼Œå®ƒèƒ½æ§åˆ¶ç¨‹åºåªèƒ½è®¿é—®ç‰¹å®šæ–‡ä»¶ã€‚</li></ul><h4 id="4-2-1-opt-amp-usr-local-amp-usr-åŒºåˆ«"><a href="#4-2-1-opt-amp-usr-local-amp-usr-åŒºåˆ«" class="headerlink" title="4.2.1 /opt &amp; /usr/local &amp; /usr åŒºåˆ«"></a>4.2.1 /opt &amp; /usr/local &amp; /usr åŒºåˆ«</h4><p><code>/opt</code>è¿™é‡Œä¸»è¦å­˜æ”¾é‚£äº›å¯é€‰çš„ç¨‹åºã€‚ä½ æƒ³å°è¯•æœ€æ–°çš„firefoxæµ‹è¯•ç‰ˆå—?é‚£å°±è£…åˆ°/optç›®å½•ä¸‹å§ï¼Œè¿™æ ·ï¼Œå½“ä½ å°è¯•å®Œï¼Œæƒ³åˆ æ‰firefoxçš„æ—¶å€™ï¼Œä½ å°±å¯ä»¥ç›´æ¥åˆ é™¤å®ƒï¼Œè€Œä¸å½±å“ç³»ç»Ÿå…¶ä»–ä»»ä½•è®¾ç½®ã€‚å®‰è£…åˆ°/optç›®å½•ä¸‹çš„ç¨‹åºï¼Œå®ƒæ‰€æœ‰çš„æ•°æ®ã€åº“æ–‡ä»¶ç­‰ç­‰éƒ½æ˜¯æ”¾åœ¨åŒä¸ªç›®å½•ä¸‹é¢ã€‚<strong>ç›¸å½“äºwindowsä¸­çš„D:/Softwareã€‚</strong></p><p><code>/usr/local</code>è¿™é‡Œä¸»è¦å­˜æ”¾é‚£äº›æ‰‹åŠ¨å®‰è£…çš„è½¯ä»¶ï¼Œå³ä¸æ˜¯é€šè¿‡apt-getç­‰è‡ªåŠ¨å®‰è£…çš„è½¯ä»¶ï¼Œ/usr/localç›®å½•ä¸‹çš„ä¸€äº›å­ç›®å½•å¾€å¾€éƒ½æ˜¯è¢«åŠ å…¥åˆ°PATHç¯å¢ƒå˜é‡ä¸­çš„ã€‚ <strong>ç›¸å½“äºwindowsä¸­çš„C:/Program Files</strong>ã€‚</p><p><code>/usr</code>ï¼šç³»ç»Ÿçº§çš„ç›®å½•ï¼Œå¯ä»¥ç†è§£ä¸ºC:/Windows/ï¼Œ<code>/usr/lib</code>ç†è§£ä¸ºC:/Windows/System32ã€‚</p><p><code>/usr/src</code>ï¼šç³»ç»Ÿçº§çš„æºç ç›®å½•ã€‚<code>/usr/local/src</code>ï¼šç”¨æˆ·çº§çš„æºç ç›®å½•ã€‚</p><h3 id="4-3-Linuxç›®å½•æ€»ç»“ä¸€ä¸‹"><a href="#4-3-Linuxç›®å½•æ€»ç»“ä¸€ä¸‹" class="headerlink" title="4.3 Linuxç›®å½•æ€»ç»“ä¸€ä¸‹"></a>4.3 Linuxç›®å½•æ€»ç»“ä¸€ä¸‹</h3><ol><li>linuxçš„ç›®å½•ä¸­æœ‰ä¸”åªè¦ä¸€ä¸ªæ ¹ç›®å½• /</li><li>linuxçš„å„ä¸ªç›®å½•å­˜æ”¾çš„å†…å®¹æ˜¯è§„åˆ’å¥½ï¼Œä¸ç”¨ä¹±æ”¾æ–‡ä»¶ã€‚</li><li>linuxæ˜¯ä»¥æ–‡ä»¶çš„å½¢å¼ç®¡ç†æˆ‘ä»¬çš„è®¾å¤‡ï¼Œå› æ­¤linuxç³»ç»Ÿï¼Œä¸€åˆ‡çš†ä¸ºæ–‡ä»¶ã€‚</li></ol><p>linuxçš„å„ä¸ªæ–‡ä»¶ç›®å½•ä¸‹å­˜æ”¾ä»€ä¹ˆå†…å®¹ï¼Œå¿…é¡»æœ‰ä¸€ä¸ªè®¤è¯†ï¼Œä½ è„‘æµ·ä¸­åº”è¯¥æœ‰ä¸€é¢—linuxç›®å½•æ ‘</p><h2 id="äº”ã€è¿œç¨‹ç™»å½•Linuxç³»ç»Ÿ"><a href="#äº”ã€è¿œç¨‹ç™»å½•Linuxç³»ç»Ÿ" class="headerlink" title="äº”ã€è¿œç¨‹ç™»å½•Linuxç³»ç»Ÿ"></a>äº”ã€è¿œç¨‹ç™»å½•Linuxç³»ç»Ÿ</h2><h3 id="5-1-SSH-ä¸‰æ­¥è§£å†³å…å¯†ç™»å½•"><a href="#5-1-SSH-ä¸‰æ­¥è§£å†³å…å¯†ç™»å½•" class="headerlink" title="5.1 SSH ä¸‰æ­¥è§£å†³å…å¯†ç™»å½•"></a>5.1 SSH ä¸‰æ­¥è§£å†³å…å¯†ç™»å½•</h3><h4 id="5-1-1-å®¢æˆ·ç«¯ç”Ÿæˆå…¬ç§é’¥"><a href="#5-1-1-å®¢æˆ·ç«¯ç”Ÿæˆå…¬ç§é’¥" class="headerlink" title="5.1.1 å®¢æˆ·ç«¯ç”Ÿæˆå…¬ç§é’¥"></a>5.1.1 å®¢æˆ·ç«¯ç”Ÿæˆå…¬ç§é’¥</h4><p>æœ¬åœ°å®¢æˆ·ç«¯ç”Ÿæˆå…¬ç§é’¥ï¼šï¼ˆä¸€è·¯å›è½¦é»˜è®¤å³å¯ï¼‰</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">ssh-keygen -t rsa</span><br></code></pre></td></tr></table></figure><p>ä¸Šé¢è¿™ä¸ªå‘½ä»¤ä¼šåœ¨ç”¨æˆ·ç›®å½•. ssh æ–‡ä»¶å¤¹ä¸‹åˆ›å»ºå…¬ç§é’¥</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli"><span class="hljs-keyword">cd</span> ~<span class="hljs-string">/.ssh</span><br></code></pre></td></tr></table></figure><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">ls</span><br></code></pre></td></tr></table></figure><p>ä¸‹åˆ›å»ºä¸¤ä¸ªå¯†é’¥ï¼š</p><ol><li> id_rsa ï¼ˆç§é’¥ï¼‰</li><li> id_rsa.pub (å…¬é’¥)</li></ol><h4 id="5-1-2-ä¸Šä¼ å…¬é’¥åˆ°æœåŠ¡å™¨"><a href="#5-1-2-ä¸Šä¼ å…¬é’¥åˆ°æœåŠ¡å™¨" class="headerlink" title="5.1.2 ä¸Šä¼ å…¬é’¥åˆ°æœåŠ¡å™¨"></a>5.1.2 ä¸Šä¼ å…¬é’¥åˆ°æœåŠ¡å™¨</h4><p>è¿™é‡Œæµ‹è¯•ç”¨çš„æœåŠ¡å™¨åœ°å€ä¸ºï¼š192.168.235.22<br>ç”¨æˆ·ä¸ºï¼šroot</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gradle">ssh-<span class="hljs-keyword">copy</span>-id -i ~<span class="hljs-regexp">/.ssh/i</span>d_rsa.pub root@<span class="hljs-number">192.168</span>.<span class="hljs-number">235.22</span><br></code></pre></td></tr></table></figure><p>ä¸Šé¢è¿™æ¡å‘½ä»¤æ˜¯å†™åˆ°æœåŠ¡å™¨ä¸Šçš„ ssh ç›®å½•ä¸‹å»äº†</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli"><span class="hljs-keyword">cd</span> ~<span class="hljs-string">/.ssh</span><br></code></pre></td></tr></table></figure><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">cat authorized_keys</span><br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°å®¢æˆ·ç«¯å†™å…¥åˆ°æœåŠ¡å™¨çš„ id_rsa.pub ï¼ˆå…¬é’¥ï¼‰å†…å®¹ã€‚</p><h4 id="5-1-3-æµ‹è¯•å…å¯†ç™»å½•"><a href="#5-1-3-æµ‹è¯•å…å¯†ç™»å½•" class="headerlink" title="5.1.3 æµ‹è¯•å…å¯†ç™»å½•"></a>5.1.3 æµ‹è¯•å…å¯†ç™»å½•</h4><p>å®¢æˆ·ç«¯é€šè¿‡ ssh è¿æ¥è¿œç¨‹æœåŠ¡å™¨ï¼Œå°±å¯ä»¥å…å¯†ç™»å½•äº†ã€‚</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">ssh</span> root@<span class="hljs-number">192.168.235.22</span><br></code></pre></td></tr></table></figure><h3 id="5-2-ç®¡ç†å¤šä¸ªç§é’¥"><a href="#5-2-ç®¡ç†å¤šä¸ªç§é’¥" class="headerlink" title="5.2 ç®¡ç†å¤šä¸ªç§é’¥"></a>5.2 ç®¡ç†å¤šä¸ªç§é’¥</h3><p>åœ¨<code>~/.ssh/config</code>ä¸­è¿›è¡Œé…ç½®ï¼Œé…ç½®åŸåˆ™å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20220221210809219.png"></p><p><code>Host</code>æ˜¯åˆ«å</p><p><code>HostName</code>æ˜¯ipåœ°å€æˆ–è€…åŸŸå</p><p><code>User</code>æ˜¯ç™»å½•ç”¨æˆ·å</p><p><code>IdentityFile</code>æ˜¯ç§é’¥åœ°å€</p><p><code>PerferredAuthentications</code>æ˜¯é¦–é€‰èº«ä»½éªŒè¯æ–¹å¼</p><h2 id="å…­ã€Vi-å’Œ-Vim-ç¼–è¾‘å™¨"><a href="#å…­ã€Vi-å’Œ-Vim-ç¼–è¾‘å™¨" class="headerlink" title="å…­ã€Vi å’Œ Vim ç¼–è¾‘å™¨"></a>å…­ã€Vi å’Œ Vim ç¼–è¾‘å™¨</h2><h3 id="6-1-Viå’ŒVimçš„åŸºæœ¬ä»‹ç»"><a href="#6-1-Viå’ŒVimçš„åŸºæœ¬ä»‹ç»" class="headerlink" title="6.1 Viå’ŒVimçš„åŸºæœ¬ä»‹ç»"></a>6.1 Viå’ŒVimçš„åŸºæœ¬ä»‹ç»</h3><p>æ‰€æœ‰çš„ Linux ç³»ç»Ÿéƒ½ä¼šå†…å»º vi æ–‡æœ¬ç¼–è¾‘å™¨ã€‚</p><p>Vim å…·æœ‰ç¨‹åºç¼–è¾‘çš„èƒ½åŠ›ï¼Œå¯ä»¥çœ‹åšæ˜¯Viçš„å¢å¼ºç‰ˆæœ¬ï¼Œå¯ä»¥ä¸»åŠ¨çš„ä»¥å­—ä½“é¢œè‰²è¾¨åˆ«è¯­æ³•çš„æ­£ç¡®æ€§ï¼Œæ–¹ä¾¿ç¨‹åºè®¾è®¡ã€‚ä»£ç è¡¥å®Œã€ç¼–è¯‘åŠé”™è¯¯è·³è½¬ç­‰æ–¹ä¾¿ç¼–ç¨‹çš„åŠŸèƒ½ç‰¹åˆ«ä¸°å¯Œï¼Œåœ¨ç¨‹åºå‘˜ä¸­è¢«å¹¿æ³›ä½¿ç”¨ã€‚</p><h3 id="6-2-Viå’ŒVimçš„ä¸‰ç§å¸¸è§æ¨¡å¼"><a href="#6-2-Viå’ŒVimçš„ä¸‰ç§å¸¸è§æ¨¡å¼" class="headerlink" title="6.2 Viå’ŒVimçš„ä¸‰ç§å¸¸è§æ¨¡å¼"></a>6.2 Viå’ŒVimçš„ä¸‰ç§å¸¸è§æ¨¡å¼</h3><h4 id="6-2-1-æ­£å¸¸æ¨¡å¼"><a href="#6-2-1-æ­£å¸¸æ¨¡å¼" class="headerlink" title="6.2.1 æ­£å¸¸æ¨¡å¼"></a>6.2.1 æ­£å¸¸æ¨¡å¼</h4><p>åœ¨æ­£å¸¸æ¨¡å¼ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¿«æ·é”®ã€‚<br>ä»¥ vim æ‰“å¼€ä¸€ä¸ªæ¡£æ¡ˆå°±ç›´æ¥è¿›å…¥ä¸€èˆ¬æ¨¡å¼äº†(è¿™æ˜¯é»˜è®¤çš„æ¨¡å¼)ã€‚åœ¨è¿™ä¸ªæ¨¡å¼ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ã€ä¸Šä¸‹å·¦å³ã€æŒ‰é”®æ¥ç§»åŠ¨å…‰æ ‡ï¼Œä½ å¯ä»¥ä½¿ç”¨ã€åˆ é™¤å­—ç¬¦ã€æˆ–ã€åˆ é™¤æ•´è¡Œã€æ¥å¤„ç†æ¡£æ¡ˆå†…å®¹ï¼Œ ä¹Ÿå¯ä»¥ä½¿ç”¨ã€å¤åˆ¶ã€è´´ä¸Šã€æ¥å¤„ç†ä½ çš„æ–‡ä»¶æ•°æ®ã€‚</p><h4 id="6-2-2-æ’å…¥æ¨¡å¼-ç¼–è¾‘æ¨¡å¼"><a href="#6-2-2-æ’å…¥æ¨¡å¼-ç¼–è¾‘æ¨¡å¼" class="headerlink" title="6.2.2 æ’å…¥æ¨¡å¼/ç¼–è¾‘æ¨¡å¼"></a>6.2.2 æ’å…¥æ¨¡å¼/ç¼–è¾‘æ¨¡å¼</h4><p>åœ¨æ¨¡å¼ä¸‹ï¼Œç¨‹åºå‘˜å¯ä»¥è¾“å…¥å†…å®¹ã€‚æŒ‰ä¸‹i,I,o,O,a,A,r,Rç­‰ä»»ä½•ä¸€ä¸ªå­—æ¯ä¹‹åæ‰ä¼šè¿›å…¥ç¼–è¾‘æ¨¡å¼, ä¸€èˆ¬æ¥è¯´æŒ‰iå³å¯ã€‚</p><h4 id="6-2-3-å‘½ä»¤è¡Œæ¨¡å¼"><a href="#6-2-3-å‘½ä»¤è¡Œæ¨¡å¼" class="headerlink" title="6.2.3 å‘½ä»¤è¡Œæ¨¡å¼"></a>6.2.3 å‘½ä»¤è¡Œæ¨¡å¼</h4><p>åœ¨è¿™ä¸ªæ¨¡å¼å½“ä¸­ï¼Œå¯ä»¥æä¾›ä½ ç›¸å…³æŒ‡ä»¤ï¼Œå®Œæˆè¯»å–ã€å­˜ç›˜ã€æ›¿æ¢ã€ç¦»å¼€ vim ã€æ˜¾ç¤ºè¡Œå·ç­‰çš„åŠ¨ä½œåˆ™æ˜¯åœ¨æ­¤æ¨¡å¼ä¸­è¾¾æˆçš„ï¼</p><h3 id="6-4-Viå’ŒVimä¸‰ç§æ¨¡å¼çš„ç›¸äº’è½¬åŒ–å›¾"><a href="#6-4-Viå’ŒVimä¸‰ç§æ¨¡å¼çš„ç›¸äº’è½¬åŒ–å›¾" class="headerlink" title="6.4 Viå’ŒVimä¸‰ç§æ¨¡å¼çš„ç›¸äº’è½¬åŒ–å›¾"></a>6.4 Viå’ŒVimä¸‰ç§æ¨¡å¼çš„ç›¸äº’è½¬åŒ–å›¾</h3><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20220221212631089.png" alt="Viå’ŒVimä¸‰ç§æ¨¡å¼çš„äº’ç›¸è½¬æ¢å›¾"></p><h3 id="6-5-Viå’ŒVimçš„å¿«æ·é”®é”®ç›˜ä¸€è§ˆå›¾"><a href="#6-5-Viå’ŒVimçš„å¿«æ·é”®é”®ç›˜ä¸€è§ˆå›¾" class="headerlink" title="6.5 Viå’ŒVimçš„å¿«æ·é”®é”®ç›˜ä¸€è§ˆå›¾"></a>6.5 Viå’ŒVimçš„å¿«æ·é”®é”®ç›˜ä¸€è§ˆå›¾</h3><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20220221213558671.png" alt="Viå’ŒVimçš„å¿«æ·é”®é”®ç›˜ä¸€è§ˆå›¾"></p><p>Viå’ŒVimçš„å¿«é”®é”®åŒ…ç½—ä¸‡è±¡ï¼Œé‡åˆ°å…·ä½“éœ€æ±‚å¯ä»¥æŸ¥çœ‹<a href="https://vim.rtorr.com/lang/zh_cn">Vim Cheat Sheet</a>æˆ–è€…åœ¨linuxå‘½ä»¤è¡Œè¾“å…¥<code>vimtutor</code>æŸ¥çœ‹vimå®˜æ–¹æ•™ç¨‹ã€‚</p><h2 id="ä¸ƒã€å…³æœºã€é‡å¯å’Œç”¨æˆ·ç™»å½•æ³¨é”€"><a href="#ä¸ƒã€å…³æœºã€é‡å¯å’Œç”¨æˆ·ç™»å½•æ³¨é”€" class="headerlink" title="ä¸ƒã€å…³æœºã€é‡å¯å’Œç”¨æˆ·ç™»å½•æ³¨é”€"></a>ä¸ƒã€å…³æœºã€é‡å¯å’Œç”¨æˆ·ç™»å½•æ³¨é”€</h2><h3 id="7-1-å…³æœº-amp-é‡å¯å‘½ä»¤"><a href="#7-1-å…³æœº-amp-é‡å¯å‘½ä»¤" class="headerlink" title="7.1 å…³æœº&amp;é‡å¯å‘½ä»¤"></a>7.1 å…³æœº&amp;é‡å¯å‘½ä»¤</h3><figure class="highlight ldif"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs ldif"><span class="hljs-attribute">shutdown      </span>: ç›¸å½“äº shutdown -h 1<br><span class="hljs-attribute">shutdown-h now</span>: è¡¨ç¤ºç«‹å³å…³æœº<br><span class="hljs-attribute">shutdown-h 1  </span>: è¡¨ç¤º 1 åˆ†é’Ÿåå…³æœº<br><span class="hljs-attribute">shutdown-r now</span>: ç«‹å³é‡å¯<br><span class="hljs-attribute">halt          </span>: æ•ˆæœç­‰ä»·äºå…³æœº<br><span class="hljs-attribute">reboot        </span>: å°±æ˜¯é‡å¯ç³»ç»Ÿã€‚<br><span class="hljs-attribute">sync          :æŠŠå†…å­˜çš„æ•°æ®åŒæ­¥åˆ°ç£ç›˜</span><br></code></pre></td></tr></table></figure><p>æ³¨æ„ç»†èŠ‚ï¼š</p><p>1.å½“æˆ‘ä»¬å…³æœºæˆ–è€…é‡å¯æ—¶ï¼Œéƒ½åº”è¯¥å…ˆæ‰§è¡Œä»¥ä¸‹syncæŒ‡ä»¤ï¼ŒæŠŠå†…å­˜çš„æ•°æ®å†™å…¥ç£ç›˜ï¼Œé˜²æ­¢æ•°æ®ä¸¢å¤±ã€‚</p><p>2.ç›®å‰çš„shutdown/reboot/haltç­‰å‘½ä»¤å›å·²ç»åœ¨å…³æœºå‰è¿›è¡Œäº†syncã€‚</p><h3 id="7-2-ç”¨æˆ·ç™»å½•å’Œæ³¨é”€"><a href="#7-2-ç”¨æˆ·ç™»å½•å’Œæ³¨é”€" class="headerlink" title="7.2 ç”¨æˆ·ç™»å½•å’Œæ³¨é”€"></a>7.2 ç”¨æˆ·ç™»å½•å’Œæ³¨é”€</h3><p>1 ) ç™»å½•æ—¶å°½é‡å°‘ç”¨rootå¸å·ç™»å½•ï¼Œå› ä¸ºå®ƒæ˜¯ç³»ç»Ÿç®¡ç†å‘˜ï¼Œæœ€å¤§çš„æƒé™ï¼Œé¿å…æ“ä½œå¤±è¯¯ã€‚å¯ä»¥åˆ©ç”¨æ™®é€šç”¨æˆ·ç™»å½•ï¼Œç™»å½•åå†ç”¨<code>su -s</code>å‘½ä»¤æ¥åˆ‡æ¢æˆç³»ç»Ÿç®¡ç†å‘˜èº«ä»½ã€‚</p><p>2 ) åœ¨æç¤ºç¬¦ä¸‹è¾“å…¥<code> logout</code> å³å¯æ³¨é”€ç”¨æˆ·ã€‚(åœ¨<code>root</code>ç”¨æˆ·ä¸‹ä½¿ç”¨ä¼šé€€å›åˆ°ä¸Šæ¬¡çš„æ™®é€šç”¨æˆ·ä¸Šï¼Œåœ¨æ™®é€šç”¨æˆ·ä¸Šä½¿ç”¨ä¼šé€€å‡ºç³»ç»Ÿ)</p><p>ä½¿ç”¨ç»†èŠ‚:<br>    1.logout æ³¨é”€æŒ‡ä»¤åœ¨å›¾å½¢è¿è¡Œçº§åˆ«æ— æ•ˆï¼Œåœ¨ è¿è¡Œçº§åˆ« 3 ä¸‹æœ‰æ•ˆ.<br>    2.è¿è¡Œçº§åˆ«è¿™ä¸ªæ¦‚å¿µï¼Œåé¢ç»™å¤§å®¶ä»‹ç»</p><h2 id="å…«ã€ç”¨æˆ·ç®¡ç†"><a href="#å…«ã€ç”¨æˆ·ç®¡ç†" class="headerlink" title="å…«ã€ç”¨æˆ·ç®¡ç†"></a>å…«ã€ç”¨æˆ·ç®¡ç†</h2><h3 id="8-1-åŸºæœ¬ä»‹ç»"><a href="#8-1-åŸºæœ¬ä»‹ç»" class="headerlink" title="8.1 åŸºæœ¬ä»‹ç»"></a>8.1 åŸºæœ¬ä»‹ç»</h3><p>Linuxç³»ç»Ÿæ˜¯ä¸€ä¸ªå¤šç”¨æˆ·å¤šä»»åŠ¡çš„æ“ä½œç³»ç»Ÿï¼Œä»»ä½•ä¸€ä¸ªè¦ä½¿ç”¨ç³»ç»Ÿèµ„æºçš„ç”¨æˆ·ï¼Œéƒ½å¿…é¡»é¦–å…ˆå‘ç³»ç»Ÿç®¡ç†å‘˜ç”³è¯·ä¸€ä¸ªè´¦å·ï¼Œç„¶åä»¥è¿™ä¸ªè´¦å·çš„èº«ä»½è¿›å…¥ç³»ç»Ÿã€‚å¹¶ä¸”<strong>Linuxçš„ç”¨æˆ·éœ€è¦è‡³å°‘è¦å±äºä¸€ä¸ªç»„</strong>ï¼Œæ¯ä¸€ä¸ªç”¨æˆ·éƒ½å¯¹åº”ä¸€ä¸ªè‡ªå·±çš„å®¶ç›®å½•ã€‚</p><h3 id="8-2-æ·»åŠ ç”¨æˆ·"><a href="#8-2-æ·»åŠ ç”¨æˆ·" class="headerlink" title="8.2 æ·»åŠ ç”¨æˆ·"></a>8.2 æ·»åŠ ç”¨æˆ·</h3><h4 id="8-2-1-åŸºæœ¬è¯­æ³•"><a href="#8-2-1-åŸºæœ¬è¯­æ³•" class="headerlink" title="8.2.1 åŸºæœ¬è¯­æ³•"></a>8.2.1 åŸºæœ¬è¯­æ³•</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">useradd [é€‰é¡¹] ç”¨æˆ·å<br></code></pre></td></tr></table></figure><h4 id="8-2-2-å®é™…æ¡ˆä¾‹"><a href="#8-2-2-å®é™…æ¡ˆä¾‹" class="headerlink" title="8.2.2 å®é™…æ¡ˆä¾‹"></a>8.2.2 å®é™…æ¡ˆä¾‹</h4><p>æ·»åŠ ä¸€ä¸ªç”¨æˆ·<code>jyg</code>,<code>useradd jyg</code>,å¹¶ä¸”é»˜è®¤è¯¥ç”¨æˆ·çš„å®¶ç›®å½•åœ¨<code>/home/jyg</code>ã€‚</p><h4 id="8-2-3-ç»†èŠ‚è¯´æ˜"><a href="#8-2-3-ç»†èŠ‚è¯´æ˜" class="headerlink" title="8.2.3 ç»†èŠ‚è¯´æ˜"></a>8.2.3 ç»†èŠ‚è¯´æ˜</h4><ol><li>å½“åˆ›å»ºç”¨æˆ·æˆåŠŸåï¼Œä¼šè‡ªåŠ¨çš„åˆ›å»ºå’Œç”¨æˆ·åŒåçš„å®¶ç›®å½•</li><li>ä¹Ÿå¯ä»¥é€šè¿‡ <code>useradd -d æŒ‡å®šç›®å½• æ–°çš„ç”¨æˆ·å</code>ï¼Œç»™æ–°åˆ›å»ºçš„ç”¨æˆ·æŒ‡å®šå®¶ç›®å½•</li><li>ä»¥ä»€ä¹ˆç”¨æˆ·èº«ä»½ç™»å½•ï¼Œåˆå§‹ç›®å½•å°±åœ¨è¯¥ç”¨æˆ·çš„å®¶ç›®å½•ä¸‹</li></ol><h3 id="8-3-ç»™ç”¨æˆ·æŒ‡å®šæˆ–è€…ä¿®æ”¹å¯†ç "><a href="#8-3-ç»™ç”¨æˆ·æŒ‡å®šæˆ–è€…ä¿®æ”¹å¯†ç " class="headerlink" title="8.3 ç»™ç”¨æˆ·æŒ‡å®šæˆ–è€…ä¿®æ”¹å¯†ç "></a>8.3 ç»™ç”¨æˆ·æŒ‡å®šæˆ–è€…ä¿®æ”¹å¯†ç </h3><h4 id="8-3-1-åŸºæœ¬è¯­æ³•"><a href="#8-3-1-åŸºæœ¬è¯­æ³•" class="headerlink" title="8.3.1 åŸºæœ¬è¯­æ³•"></a>8.3.1 åŸºæœ¬è¯­æ³•</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">passwd ç”¨æˆ·å #å¦‚æœç¼ºçœç”¨æˆ·åï¼Œåˆ™ä¿®æ”¹å½“å‰ç”¨æˆ·å¯†ç <br></code></pre></td></tr></table></figure><h4 id="8-2-2-å®é™…æ¡ˆä¾‹-1"><a href="#8-2-2-å®é™…æ¡ˆä¾‹-1" class="headerlink" title="8.2.2 å®é™…æ¡ˆä¾‹"></a>8.2.2 å®é™…æ¡ˆä¾‹</h4><p>ç»™ç”¨æˆ·<code>jyg</code>æ›´æ”¹å¯†ç ï¼Œ<code># passwd jyg</code></p><h3 id="8-4-åˆ é™¤ç”¨æˆ·"><a href="#8-4-åˆ é™¤ç”¨æˆ·" class="headerlink" title="8.4 åˆ é™¤ç”¨æˆ·"></a>8.4 åˆ é™¤ç”¨æˆ·</h3><h4 id="8-4-1-åŸºæœ¬è¯­æ³•"><a href="#8-4-1-åŸºæœ¬è¯­æ³•" class="headerlink" title="8.4.1 åŸºæœ¬è¯­æ³•"></a>8.4.1 åŸºæœ¬è¯­æ³•</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">userdel ç”¨æˆ·å<br></code></pre></td></tr></table></figure><h4 id="8-4-2-åº”ç”¨æ¡ˆä¾‹"><a href="#8-4-2-åº”ç”¨æ¡ˆä¾‹" class="headerlink" title="8.4.2 åº”ç”¨æ¡ˆä¾‹"></a>8.4.2 åº”ç”¨æ¡ˆä¾‹</h4><ol><li><p>åˆ é™¤ç”¨æˆ·<code>jyg</code>ï¼Œä½†æ˜¯è¦ä¿ç•™å®¶ç›®å½• <code>userdel jyg</code></p></li><li><p>åˆ é™¤ç”¨æˆ·<code>jyg</code>ä»¥åŠç”¨æˆ·ä¸»ç›®å½• <code>userdel -r jyg</code></p></li></ol><p>ä¸»è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨åˆ é™¤ç”¨æˆ·æ—¶ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¸ä¼šå°†å®¶ç›®å½•åˆ é™¤ã€‚</p><h3 id="8-5-æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯"><a href="#8-5-æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯" class="headerlink" title="8.5 æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯"></a>8.5 æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯</h3><h4 id="8-5-1-åŸºæœ¬è¯­æ³•"><a href="#8-5-1-åŸºæœ¬è¯­æ³•" class="headerlink" title="8.5.1 åŸºæœ¬è¯­æ³•"></a>8.5.1 åŸºæœ¬è¯­æ³•</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">id ç”¨æˆ·å<br></code></pre></td></tr></table></figure><h4 id="8-5-2-åº”ç”¨å®ä¾‹"><a href="#8-5-2-åº”ç”¨å®ä¾‹" class="headerlink" title="8.5.2 åº”ç”¨å®ä¾‹"></a>8.5.2 åº”ç”¨å®ä¾‹</h4><p>è¯·æŸ¥è¯¢root ä¿¡æ¯ <code>id root</code></p><h4 id="8-5-3-ç»†èŠ‚è¯´æ˜"><a href="#8-5-3-ç»†èŠ‚è¯´æ˜" class="headerlink" title="8.5.3 ç»†èŠ‚è¯´æ˜"></a>8.5.3 ç»†èŠ‚è¯´æ˜</h4><p>å½“ç”¨æˆ·ä¸å­˜åœ¨æ—¶ï¼Œè¿”å›<code>no such user</code></p><h3 id="8-6-åˆ‡æ¢ç”¨æˆ·"><a href="#8-6-åˆ‡æ¢ç”¨æˆ·" class="headerlink" title="8.6 åˆ‡æ¢ç”¨æˆ·"></a>8.6 åˆ‡æ¢ç”¨æˆ·</h3><h4 id="8-6-1-ä»‹ç»"><a href="#8-6-1-ä»‹ç»" class="headerlink" title="8.6.1 ä»‹ç»"></a>8.6.1 ä»‹ç»</h4><p>åœ¨æ“ä½œLinuxä¸­ï¼Œå¦‚æœå½“å‰ç”¨æˆ·çš„æƒé™ä¸å¤Ÿï¼Œå¯ä»¥é€šè¿‡ <code>su - ç”¨æˆ·å</code> æŒ‡ä»¤ï¼Œåˆ‡æ¢åˆ°é«˜æƒé™ç”¨æˆ·ï¼Œæ¯”å¦‚root</p><h4 id="8-6-2-åŸºæœ¬è¯­æ³•"><a href="#8-6-2-åŸºæœ¬è¯­æ³•" class="headerlink" title="8.6.2 åŸºæœ¬è¯­æ³•"></a>8.6.2 åŸºæœ¬è¯­æ³•</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">su - ç”¨æˆ·å<br></code></pre></td></tr></table></figure><h4 id="8-6-3-ç»†èŠ‚è¯´æ˜"><a href="#8-6-3-ç»†èŠ‚è¯´æ˜" class="headerlink" title="8.6.3 ç»†èŠ‚è¯´æ˜"></a>8.6.3 ç»†èŠ‚è¯´æ˜</h4><ol><li><p>ä»æƒé™é«˜çš„ç”¨æˆ·åˆ‡æ¢åˆ°æƒé™ä½çš„ç”¨æˆ·ï¼Œä¸éœ€è¦è¾“å…¥å¯†ç ï¼Œåä¹‹éœ€è¦ã€‚</p></li><li><p>å½“éœ€è¦è¿”å›åˆ°åŸæ¥ç”¨æˆ·æ—¶ï¼Œä½¿ç”¨exitæŒ‡ä»¤</p></li></ol><h3 id="8-7-æŸ¥çœ‹å½“å‰ç”¨æˆ·-amp-ç™»å½•ä¿¡æ¯"><a href="#8-7-æŸ¥çœ‹å½“å‰ç”¨æˆ·-amp-ç™»å½•ä¿¡æ¯" class="headerlink" title="8.7 æŸ¥çœ‹å½“å‰ç”¨æˆ· &amp; ç™»å½•ä¿¡æ¯"></a>8.7 æŸ¥çœ‹å½“å‰ç”¨æˆ· &amp; ç™»å½•ä¿¡æ¯</h3><h4 id="8-7-1-åŸºæœ¬è¯­æ³•"><a href="#8-7-1-åŸºæœ¬è¯­æ³•" class="headerlink" title="8.7.1 åŸºæœ¬è¯­æ³•"></a>8.7.1 åŸºæœ¬è¯­æ³•</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">whoami / who am i #ä¸¤è€…ä¸åŒï¼Œwhoamiæ˜¯æŒ‡å½“å‰ç”¨æˆ·ï¼Œwho am iæ˜¯æŒ‡ç™»å½•ä¿¡æ¯ï¼ˆç™»å½•ç”¨æˆ·ï¼Œç™»å½•ä¿¡æ¯ï¼Œç™»å½•ipï¼‰<br></code></pre></td></tr></table></figure><h3 id="8-8-ç”¨æˆ·ç»„"><a href="#8-8-ç”¨æˆ·ç»„" class="headerlink" title="8.8 ç”¨æˆ·ç»„"></a>8.8 ç”¨æˆ·ç»„</h3><h4 id="8-8-1-ä»‹ç»"><a href="#8-8-1-ä»‹ç»" class="headerlink" title="8.8.1 ä»‹ç»"></a>8.8.1 ä»‹ç»</h4><p>ç±»ä¼¼äºè§’è‰²ï¼Œç³»ç»Ÿå¯ä»¥å¯¹æœ‰å…±æ€§çš„å¤šä¸ªç”¨æˆ·è¿›è¡Œç»Ÿä¸€çš„ç®¡ç†ã€‚</p><h4 id="8-8-2-å¢åŠ ç»„"><a href="#8-8-2-å¢åŠ ç»„" class="headerlink" title="8.8.2 å¢åŠ ç»„"></a>8.8.2 å¢åŠ ç»„</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">groupadd ç»„å<br></code></pre></td></tr></table></figure><h4 id="8-8-3-åˆ é™¤ç»„"><a href="#8-8-3-åˆ é™¤ç»„" class="headerlink" title="8.8.3 åˆ é™¤ç»„"></a>8.8.3 åˆ é™¤ç»„</h4><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">groupdel</span> ç»„å<br></code></pre></td></tr></table></figure><h3 id="8-9-å¢åŠ ç”¨æˆ·æ—¶ç›´æ¥åŠ ä¸Šç»„"><a href="#8-9-å¢åŠ ç”¨æˆ·æ—¶ç›´æ¥åŠ ä¸Šç»„" class="headerlink" title="8.9 å¢åŠ ç”¨æˆ·æ—¶ç›´æ¥åŠ ä¸Šç»„"></a>8.9 å¢åŠ ç”¨æˆ·æ—¶ç›´æ¥åŠ ä¸Šç»„</h3><h4 id="8-9-1-åŸºæœ¬è¯­æ³•"><a href="#8-9-1-åŸºæœ¬è¯­æ³•" class="headerlink" title="8.9.1 åŸºæœ¬è¯­æ³•"></a>8.9.1 åŸºæœ¬è¯­æ³•</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">useradd -g ç”¨æˆ·ç»„ ç”¨æˆ·å<br></code></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœå¢åŠ ç”¨æˆ·ï¼Œä½†æ˜¯æ²¡æœ‰æŒ‡å®šç”¨æˆ·ç»„ï¼Œé‚£ä¹ˆç³»ç»Ÿä¼šç”Ÿæˆä¸€ä¸ªå’Œè¯¥ç”¨æˆ·åŒåçš„ç”¨æˆ·ç»„ï¼Œå¹¶æŠŠè¯¥ç”¨æˆ·æ”¾å…¥åŒåç”¨æˆ·ç»„ä¸­ã€‚</p><h4 id="8-9-2-æ¡ˆä¾‹æ¼”ç¤º"><a href="#8-9-2-æ¡ˆä¾‹æ¼”ç¤º" class="headerlink" title="8.9.2 æ¡ˆä¾‹æ¼”ç¤º"></a>8.9.2 æ¡ˆä¾‹æ¼”ç¤º</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs">å¢åŠ ä¸€ä¸ªç”¨æˆ· zwj, ç›´æ¥å°†ä»–æŒ‡å®šåˆ° wudang<br>useradd -g wudang zwj<br></code></pre></td></tr></table></figure><h3 id="8-10-ä¿®æ”¹ç”¨æˆ·çš„ç»„"><a href="#8-10-ä¿®æ”¹ç”¨æˆ·çš„ç»„" class="headerlink" title="8.10 ä¿®æ”¹ç”¨æˆ·çš„ç»„"></a>8.10 ä¿®æ”¹ç”¨æˆ·çš„ç»„</h3><h4 id="8-10-1-åŸºæœ¬è¯­æ³•"><a href="#8-10-1-åŸºæœ¬è¯­æ³•" class="headerlink" title="8.10.1 åŸºæœ¬è¯­æ³•"></a>8.10.1 åŸºæœ¬è¯­æ³•</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">usermod -g ç”¨æˆ·ç»„ ç”¨æˆ·å<br></code></pre></td></tr></table></figure><h4 id="8-10-2-æ¡ˆä¾‹æ¼”ç¤º"><a href="#8-10-2-æ¡ˆä¾‹æ¼”ç¤º" class="headerlink" title="8.10.2 æ¡ˆä¾‹æ¼”ç¤º"></a>8.10.2 æ¡ˆä¾‹æ¼”ç¤º</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">åˆ›å»ºä¸€ä¸ªshaolinç»„ï¼Œè®©å°†zwj ç”¨æˆ·ä¿®æ”¹åˆ°shaolin<br>gourpadd shaolin<br>usermod -g shaolin zwj<br></code></pre></td></tr></table></figure><h3 id="8-11-ç”¨æˆ·å’Œç»„ç›¸å…³æ–‡ä»¶"><a href="#8-11-ç”¨æˆ·å’Œç»„ç›¸å…³æ–‡ä»¶" class="headerlink" title="8.11 ç”¨æˆ·å’Œç»„ç›¸å…³æ–‡ä»¶"></a>8.11 ç”¨æˆ·å’Œç»„ç›¸å…³æ–‡ä»¶</h3><h4 id="8-11-1-ETC-PASSWD-æ–‡ä»¶"><a href="#8-11-1-ETC-PASSWD-æ–‡ä»¶" class="headerlink" title="8.11.1 /ETC/PASSWD æ–‡ä»¶"></a>8.11.1 /ETC/PASSWD æ–‡ä»¶</h4><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile">ç”¨æˆ·ï¼ˆ<span class="hljs-keyword">user</span>ï¼‰çš„é…ç½®æ–‡ä»¶ï¼Œè®°å½•ç”¨æˆ·çš„å„ç§ä¿¡æ¯<br>æ¯è¡Œçš„å«ä¹‰ï¼šç”¨æˆ·å:å£ä»¤ï¼ˆè¢«åŠ å¯†ï¼‰:ç”¨æˆ·æ ‡è¯†å·:ç»„æ ‡è¯†å·:æ³¨é‡Šæ€§æè¿°:ä¸»ç›®å½•:ç™»å½•<span class="hljs-keyword">Shell</span><br></code></pre></td></tr></table></figure><h4 id="8-11-2-ETC-SHADOWæ–‡ä»¶"><a href="#8-11-2-ETC-SHADOWæ–‡ä»¶" class="headerlink" title="8.11.2 /ETC/SHADOWæ–‡ä»¶"></a>8.11.2 /ETC/SHADOWæ–‡ä»¶</h4><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs makefile">å£ä»¤çš„é…ç½®æ–‡ä»¶<br><span class="hljs-section">æ¯è¡Œçš„å«ä¹‰ï¼šç™»å½•å:åŠ å¯†å£ä»¤:æœ€åä¸€æ¬¡ä¿®æ”¹æ—¶é—´:æœ€å°æ—¶é—´é—´éš”:æœ€å¤§æ—¶é—´é—´éš”:è­¦å‘Šæ—¶é—´:ä¸æ´»åŠ¨æ—¶é—´:å¤±æ•ˆæ—¶é—´:æ ‡å¿—</span><br></code></pre></td></tr></table></figure><h4 id="8-11-3-ETC-GROUPæ–‡ä»¶"><a href="#8-11-3-ETC-GROUPæ–‡ä»¶" class="headerlink" title="8.11.3 /ETC/GROUPæ–‡ä»¶"></a>8.11.3 /ETC/GROUPæ–‡ä»¶</h4><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs axapta">ç»„(<span class="hljs-keyword">group</span>)çš„é…ç½®æ–‡ä»¶ï¼Œè®°å½•LinuxåŒ…å«çš„ç»„çš„ä¿¡æ¯<br>æ¯è¡Œå«ä¹‰ï¼šç»„å:å£ä»¤:ç»„æ ‡è¯†å·:ç»„å†…ç”¨æˆ·åˆ—è¡¨<br></code></pre></td></tr></table></figure><p>ç»„å¯†ç çš„ä½œç”¨ï¼šéæœ¬ç”¨æˆ·ç»„çš„ç”¨æˆ·æƒ³åˆ‡æ¢åˆ°æœ¬ç”¨æˆ·ç»„èº«ä»½æ—¶ï¼Œå¯ä»¥é€šè¿‡å¯†ç ä¿è¯å®‰å…¨æ€§ã€‚å¦‚æœæ²¡æœ‰è®¾ç½®ç»„å¯†ç ï¼Œåˆ™åªæœ‰å±äºæœ¬ç”¨æˆ·ç»„çš„ç”¨æˆ·èƒ½å¤Ÿåˆ‡æ¢åˆ°æœ¬ç”¨æˆ·ç»„çš„èº«ä»½ã€‚</p><h2 id="ä¹ã€å®ç”¨æŒ‡ä»¤"><a href="#ä¹ã€å®ç”¨æŒ‡ä»¤" class="headerlink" title="ä¹ã€å®ç”¨æŒ‡ä»¤"></a>ä¹ã€å®ç”¨æŒ‡ä»¤</h2><h3 id="9-1-æŒ‡å®šè¿è¡Œçº§åˆ«"><a href="#9-1-æŒ‡å®šè¿è¡Œçº§åˆ«" class="headerlink" title="9.1 æŒ‡å®šè¿è¡Œçº§åˆ«"></a>9.1 æŒ‡å®šè¿è¡Œçº§åˆ«</h3><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs tap">è¿è¡Œçº§åˆ«è¯´æ˜ï¼š<br>0 ï¼šå…³æœº<br>1 ï¼šå•ç”¨æˆ·ã€æ‰¾å›ä¸¢å¤±å¯†ç ã€‘<br>2 ï¼šå¤šç”¨æˆ·çŠ¶æ€æ²¡æœ‰ç½‘ç»œæœåŠ¡<br>3 ï¼šå¤šç”¨æˆ·çŠ¶æ€æœ‰ç½‘ç»œæœåŠ¡<br>4 ï¼šç³»ç»Ÿæœªä½¿ç”¨ä¿ç•™ç»™ç”¨æˆ·<br>5 ï¼šå›¾å½¢ç•Œé¢<br>6 ï¼šç³»ç»Ÿé‡å¯<br>å¸¸ç”¨è¿è¡Œçº§åˆ«æ˜¯<span class="hljs-number"> 3 </span>å’Œ<span class="hljs-number"> 5 </span><br></code></pre></td></tr></table></figure><p>è¦ä¿®æ”¹é»˜è®¤çš„è¿è¡Œçº§åˆ«:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs shell">åœ¨centos7ä»¥å‰ï¼Œå¯æ”¹æ–‡ä»¶/etc/inittabçš„id: 5 :initdefault:è¿™ä¸€è¡Œä¸­çš„æ•°å­—<br><br>åœ¨Centos7ä»¥åï¼Œåœ¨/etc/inittabæ–‡ä»¶ä¸­ï¼Œè¿›è¡Œäº†ç®€åŒ–ï¼Œå¦‚ä¸‹ï¼š<br>muti-user.target: analogous to runlevel 3<br>graphical.target: analogous to runlevel 5<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> To view current default target, run:</span><br>systemctl get-default<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> To <span class="hljs-built_in">set</span> a default target, run:</span><br>systemctl set-default [TARGET.target] # ä¾‹å¦‚ï¼šsystemctl set-default graphical.target<br></code></pre></td></tr></table></figure><h3 id="9-2-åˆ‡æ¢åˆ°æŒ‡å®šè¿è¡Œçº§åˆ«çš„æŒ‡ä»¤"><a href="#9-2-åˆ‡æ¢åˆ°æŒ‡å®šè¿è¡Œçº§åˆ«çš„æŒ‡ä»¤" class="headerlink" title="9.2 åˆ‡æ¢åˆ°æŒ‡å®šè¿è¡Œçº§åˆ«çš„æŒ‡ä»¤"></a>9.2 åˆ‡æ¢åˆ°æŒ‡å®šè¿è¡Œçº§åˆ«çš„æŒ‡ä»¤</h3><h4 id="9-2-1-åŸºæœ¬è¯­æ³•"><a href="#9-2-1-åŸºæœ¬è¯­æ³•" class="headerlink" title="9.2.1 åŸºæœ¬è¯­æ³•"></a>9.2.1 åŸºæœ¬è¯­æ³•</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">init [012356]<br></code></pre></td></tr></table></figure><h4 id="9-2-2-åº”ç”¨å®ä¾‹"><a href="#9-2-2-åº”ç”¨å®ä¾‹" class="headerlink" title="9.2.2 åº”ç”¨å®ä¾‹"></a>9.2.2 åº”ç”¨å®ä¾‹</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs csharp">æ¡ˆä¾‹ <span class="hljs-number">1</span> ï¼š é€šè¿‡<span class="hljs-keyword">init</span> æ¥åˆ‡æ¢ä¸åŒçš„è¿è¡Œçº§åˆ«ï¼Œæ¯”å¦‚åŠ¨ <span class="hljs-number">5</span> - &gt; <span class="hljs-number">3</span> ï¼Œ ç„¶åå…³æœº<br><span class="hljs-keyword">init</span> <span class="hljs-number">3</span><br><span class="hljs-keyword">init</span> <span class="hljs-number">5</span><br><span class="hljs-keyword">init</span> <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><h4 id="9-2-3-é¢è¯•é¢˜"><a href="#9-2-3-é¢è¯•é¢˜" class="headerlink" title="9.2.3 é¢è¯•é¢˜"></a>9.2.3 é¢è¯•é¢˜</h4><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xquery">å¦‚ä½•æ‰¾<span class="hljs-built_in">å›root</span>å¯†ç ï¼Œå¦‚æœæˆ‘ä»¬ä¸å°å¿ƒï¼Œå¿˜<span class="hljs-built_in">è®°root</span>å¯†ç ï¼Œæ€ä¹ˆæ‰¾å›ã€‚<br>æ€è·¯ï¼š è¿›å…¥åˆ°å•ç”¨æˆ·æ¨¡å¼ï¼Œç„¶åä¿®<span class="hljs-built_in">æ”¹root</span>å¯†ç ã€‚å› ä¸ºè¿›å…¥å•ç”¨æˆ·æ¨¡å¼<span class="hljs-built_in">ï¼Œroot</span>ä¸éœ€è¦å¯†ç å°±å¯ä»¥ç™»å½•ï¼Œéšåä½¿ç”¨passwdæŒ‡ä»¤ä¿®<span class="hljs-built_in">æ”¹root</span>å¯†ç ã€‚<br></code></pre></td></tr></table></figure><h3 id="9-3-å¸®åŠ©æŒ‡ä»¤"><a href="#9-3-å¸®åŠ©æŒ‡ä»¤" class="headerlink" title="9.3 å¸®åŠ©æŒ‡ä»¤"></a>9.3 å¸®åŠ©æŒ‡ä»¤</h3><h4 id="9-3-1-ä»‹ç»"><a href="#9-3-1-ä»‹ç»" class="headerlink" title="9.3.1 ä»‹ç»"></a>9.3.1 ä»‹ç»</h4><p>å½“æˆ‘ä»¬å¯¹æŸä¸ªæŒ‡ä»¤ä¸ç†Ÿæ‚‰æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Linuxæä¾›çš„å¸®åŠ©æŒ‡ä»¤æ¥äº†è§£è¿™ä¸ªæŒ‡ä»¤çš„ä½¿ç”¨æ–¹æ³•ã€‚</p><h4 id="9-3-2-man-å‘½ä»¤"><a href="#9-3-2-man-å‘½ä»¤" class="headerlink" title="9.3.2 man å‘½ä»¤"></a>9.3.2 man å‘½ä»¤</h4><p>åŸºæœ¬è¯­æ³•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">man [å‘½ä»¤æˆ–é…ç½®æ–‡ä»¶]ï¼ˆåŠŸèƒ½æè¿°ï¼šè·å¾—å¸®åŠ©ä¿¡æ¯ï¼‰<br></code></pre></td></tr></table></figure><p>åº”ç”¨å®ä¾‹</p><p>æ¡ˆä¾‹ï¼šæŸ¥çœ‹lså‘½ä»¤çš„å¸®åŠ©ä¿¡æ¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">man ls<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20220222125127245.png"></p><p><code>-a : ä¸å¿½ç•¥ä»¥ . å¼€å¤´çš„æ–‡ä»¶</code></p><p>ä¸»è¦æ³¨æ„çš„æ˜¯ï¼Œ[]æ˜¯å¯é€‰é¡¹çš„æ„æ€ï¼Œè€Œä¸”å¯ä»¥ç»„åˆä½¿ç”¨ä¸”æ— é¡ºåºè¦æ±‚</p><h4 id="9-3-3-helpæŒ‡ä»¤"><a href="#9-3-3-helpæŒ‡ä»¤" class="headerlink" title="9.3.3 helpæŒ‡ä»¤"></a>9.3.3 helpæŒ‡ä»¤</h4><p>åŸºæœ¬è¯­æ³•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">help å‘½ä»¤ ï¼ˆåŠŸèƒ½æè¿°ï¼šè·å¾—shellå†…ç½®å‘½ä»¤çš„å¸®åŠ©ä¿¡æ¯,åªèƒ½ç”¨äºå†…éƒ¨å‘½ä»¤ï¼Œä¸èƒ½ç”¨äºå¤–éƒ¨å‘½ä»¤ï¼‰<br></code></pre></td></tr></table></figure><p>åº”ç”¨å®ä¾‹</p><p>æ¡ˆä¾‹ï¼šæŸ¥çœ‹cdå‘½ä»¤çš„å¸®åŠ©ä¿¡æ¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">help cd<br></code></pre></td></tr></table></figure><h3 id="9-3-4-infoå‘½ä»¤"><a href="#9-3-4-infoå‘½ä»¤" class="headerlink" title="9.3.4 infoå‘½ä»¤"></a>9.3.4 infoå‘½ä»¤</h3><p>åŸºæœ¬è¯­æ³•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs SHELL">info å‘½ä»¤ # info å¾—åˆ°çš„ä¿¡æ¯æ¯” man è¿˜è¦å¤š<br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼šç”±äºhelpæ”¯æŒå‘½ä»¤å°‘ï¼Œæ¨èä½¿ç”¨manæˆ–è€…infoå‘½ä»¤ã€‚</p><h3 id="9-4-æ–‡ä»¶ç›®å½•ç±»"><a href="#9-4-æ–‡ä»¶ç›®å½•ç±»" class="headerlink" title="9.4 æ–‡ä»¶ç›®å½•ç±»"></a>9.4 æ–‡ä»¶ç›®å½•ç±»</h3><h4 id="9-4-1-pwd-æŒ‡ä»¤"><a href="#9-4-1-pwd-æŒ‡ä»¤" class="headerlink" title="9.4.1 pwd æŒ‡ä»¤"></a>9.4.1 pwd æŒ‡ä»¤</h4><p>åŸºæœ¬è¯­æ³•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">pwd (åŠŸèƒ½æè¿°ï¼šæ˜¾ç¤ºå½“å‰å·¥ä½œç›®å½•çš„ç»å¯¹è·¯å¾„)<br></code></pre></td></tr></table></figure><h4 id="9-4-2-lsæŒ‡ä»¤"><a href="#9-4-2-lsæŒ‡ä»¤" class="headerlink" title="9.4.2 lsæŒ‡ä»¤"></a>9.4.2 lsæŒ‡ä»¤</h4><p>åŸºæœ¬è¯­æ³•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ls [é€‰é¡¹] [ç›®å½•æˆ–æ˜¯æ–‡ä»¶]<br></code></pre></td></tr></table></figure><p>å¸¸ç”¨é€‰é¡¹</p><ul><li>a ï¼šæ˜¾ç¤ºå½“å‰ç›®å½•æ‰€æœ‰çš„æ–‡ä»¶å’Œç›®å½•ï¼ŒåŒ…æ‹¬éšè—çš„ã€‚</li><li>l ï¼šä»¥åˆ—è¡¨çš„æ–¹å¼æ˜¾ç¤ºä¿¡æ¯</li></ul><h4 id="9-4-3-cd-æŒ‡ä»¤"><a href="#9-4-3-cd-æŒ‡ä»¤" class="headerlink" title="9.4.3 cd æŒ‡ä»¤"></a>9.4.3 cd æŒ‡ä»¤</h4><p>åŸºæœ¬è¯­æ³•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd [å‚æ•°] (åŠŸèƒ½æè¿°ï¼šåˆ‡æ¢åˆ°æŒ‡å®šç›®å½•)<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span>~ / <span class="hljs-built_in">cd</span> :å›åˆ°è‡ªå·±çš„å®¶ç›®å½•<br><span class="hljs-built_in">cd</span>..     :å›åˆ°å½“å‰ç›®å½•çš„ä¸Šä¸€çº§ç›®å½•<br></code></pre></td></tr></table></figure><h4 id="9-4-4-mkdiræŒ‡ä»¤"><a href="#9-4-4-mkdiræŒ‡ä»¤" class="headerlink" title="9.4.4 mkdiræŒ‡ä»¤"></a>9.4.4 mkdiræŒ‡ä»¤</h4><p>åŸºæœ¬è¯­æ³•ï¼š</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arduino">mkdir [é€‰é¡¹] è¦åˆ›å»ºçš„ç›®å½•<br></code></pre></td></tr></table></figure><p>å¸¸ç”¨é€‰é¡¹ï¼š</p><ul><li>p ï¼šåˆ›å»ºå¤šçº§ç›®å½•</li></ul><h4 id="9-4-5-rmdiræŒ‡ä»¤"><a href="#9-4-5-rmdiræŒ‡ä»¤" class="headerlink" title="9.4.5 rmdiræŒ‡ä»¤"></a>9.4.5 rmdiræŒ‡ä»¤</h4><p>rmdiræŒ‡ä»¤åˆ é™¤ç©ºç›®å½•</p><p>åŸºæœ¬è¯­æ³•ï¼š</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arduino">rmdir [é€‰é¡¹] è¦åˆ é™¤çš„ç©ºç›®å½•<br></code></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼šrmdiræŒ‡ä»¤åªèƒ½åˆ é™¤ç©ºç›®å½•ï¼Œåªèƒ½ä½¿ç”¨<code>rm -rf</code></p><h4 id="9-4-6-touchæŒ‡ä»¤"><a href="#9-4-6-touchæŒ‡ä»¤" class="headerlink" title="9.4.6 touchæŒ‡ä»¤"></a>9.4.6 touchæŒ‡ä»¤</h4><p>touchæŒ‡ä»¤åˆ›å»ºç©ºæ–‡ä»¶</p><p>åŸºæœ¬è¯­æ³•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">touch æ–‡ä»¶å<br></code></pre></td></tr></table></figure><h4 id="9-4-7-cpæŒ‡ä»¤"><a href="#9-4-7-cpæŒ‡ä»¤" class="headerlink" title="9.4.7 cpæŒ‡ä»¤"></a>9.4.7 cpæŒ‡ä»¤</h4><p>cp æŒ‡ä»¤æ‹·è´æ–‡ä»¶åˆ°æŒ‡å®šç›®å½•</p><p>åŸºæœ¬è¯­æ³•ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">cp [é€‰é¡¹] source dest # sourceã€destå¯ä»¥æ˜¯æ–‡ä»¶ä¹Ÿå¯ä»¥æ˜¯æ–‡ä»¶å¤¹<br>\cp [é€‰é¡¹] source dest # ç›´æ¥è¦†ç›–ï¼Œä¸æç¤ºæ˜¯å¦è¦†ç›–<br></code></pre></td></tr></table></figure><p>å¸¸ç”¨é€‰é¡¹:</p><ul><li>r ï¼šé€’å½’å¤åˆ¶æ•´ä¸ªæ–‡ä»¶å¤¹</li></ul><h4 id="9-4-8-rmæŒ‡ä»¤"><a href="#9-4-8-rmæŒ‡ä»¤" class="headerlink" title="9.4.8 rmæŒ‡ä»¤"></a>9.4.8 rmæŒ‡ä»¤</h4><p>rm æŒ‡ä»¤ç§»é™¤æ–‡ä»¶æˆ–ç›®å½•</p><p>åŸºæœ¬è¯­æ³•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">rm [é€‰é¡¹] è¦åˆ é™¤çš„æ–‡ä»¶æˆ–ç›®å½•<br></code></pre></td></tr></table></figure><p>å¸¸ç”¨é€‰é¡¹</p><ul><li>r ï¼šé€’å½’åˆ é™¤æ•´ä¸ªæ–‡ä»¶å¤¹</li><li>f ï¼š å¼ºåˆ¶åˆ é™¤ä¸æç¤º</li></ul><h4 id="9-4-9-mvæŒ‡ä»¤"><a href="#9-4-9-mvæŒ‡ä»¤" class="headerlink" title="9.4.9 mvæŒ‡ä»¤"></a>9.4.9 mvæŒ‡ä»¤</h4><p>mv <strong>ç§»åŠ¨</strong>æ–‡ä»¶ä¸ç›®å½•æˆ–<strong>é‡å‘½å</strong></p><p>åŸºæœ¬è¯­æ³•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">mv oldNameFile           newNameFile          (åŠŸèƒ½æè¿°ï¼šé‡å‘½å)<br>mv /oldFolder/movefile  /targetFolder         (åŠŸèƒ½æè¿°ï¼šç§»åŠ¨æ–‡ä»¶)<br></code></pre></td></tr></table></figure><p>æ¡ˆä¾‹ç§»åŠ¨æ•´ä¸ªç›®å½•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">mv oldFolder /targetFolder<br></code></pre></td></tr></table></figure><h4 id="9-4-10-catæŒ‡ä»¤"><a href="#9-4-10-catæŒ‡ä»¤" class="headerlink" title="9.4.10 catæŒ‡ä»¤"></a>9.4.10 catæŒ‡ä»¤</h4><p>cat æŸ¥çœ‹æ–‡ä»¶å†…å®¹ï¼Œæ˜¯ä»¥åªè¯»çš„æ–¹å¼æ‰“å¼€ã€‚</p><p>åŸºæœ¬è¯­æ³•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">cat [é€‰é¡¹] è¦æŸ¥çœ‹çš„æ–‡ä»¶<br></code></pre></td></tr></table></figure><p>å¸¸ç”¨é€‰é¡¹</p><ul><li>n ï¼šæ˜¾ç¤ºè¡Œå·</li></ul><p>ä½¿ç”¨ç»†èŠ‚<br>cat åªèƒ½æµè§ˆæ–‡ä»¶ï¼Œè€Œä¸èƒ½ä¿®æ”¹æ–‡ä»¶ï¼Œä¸ºäº†æµè§ˆæ–¹ä¾¿ï¼Œä¸€èˆ¬ä¼šå¸¦ä¸Š ç®¡é“å‘½ä»¤ | more</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">cat æ–‡ä»¶å | more<br></code></pre></td></tr></table></figure><h4 id="9-4-11-moreæŒ‡ä»¤"><a href="#9-4-11-moreæŒ‡ä»¤" class="headerlink" title="9.4.11 moreæŒ‡ä»¤"></a>9.4.11 moreæŒ‡ä»¤</h4><p>moreæŒ‡ä»¤æ˜¯ä¸€ä¸ªåŸºäºVIç¼–è¾‘å™¨çš„æ–‡æœ¬è¿‡æ»¤å™¨ï¼Œå®ƒä»¥å…¨å±å¹•çš„æ–¹å¼æŒ‰é¡µæ˜¾ç¤ºæ–‡æœ¬æ–‡ä»¶çš„å†…å®¹ã€‚moreæŒ‡ä»¤ä¸­å†…ç½®äº†è‹¥å¹²å¿«æ·é”®ï¼Œè¯¦è§æ“ä½œè¯´æ˜ã€‚</p><p>åŸºæœ¬è¯­æ³•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">more è¦æŸ¥çœ‹çš„æ–‡ä»¶<br></code></pre></td></tr></table></figure><p>æ“ä½œè¯´æ˜</p><table><thead><tr><th>å¿«æ·é”®</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td>space</td><td>å‘ä¸‹ç¿»ä¸€é¡µ</td></tr><tr><td>return</td><td>å‘ä¸‹ç¿»ä¸€è¡Œ</td></tr><tr><td>q</td><td>é€€å‡º</td></tr><tr><td>b</td><td>å‘ä¸Šç¿»ä¸€é¡µ</td></tr><tr><td>z</td><td>å‘ä¸‹ç¿»ä¸€é¡µ</td></tr><tr><td>=</td><td>è¾“å‡ºå½“å‰è¡Œå·</td></tr><tr><td>ï¼šf</td><td>è¾“å‡ºæ–‡ä»¶åå’Œå½“å‰è¡Œå·</td></tr></tbody></table><h4 id="9-4-12-lessæŒ‡ä»¤"><a href="#9-4-12-lessæŒ‡ä»¤" class="headerlink" title="9.4.12 lessæŒ‡ä»¤"></a>9.4.12 lessæŒ‡ä»¤</h4><p>lessæŒ‡ä»¤ç”¨æ¥åˆ†å±æŸ¥çœ‹æ–‡ä»¶å†…å®¹ï¼Œå®ƒçš„åŠŸèƒ½ä¸moreæŒ‡ä»¤ç±»ä¼¼ï¼Œä½†æ˜¯æ¯”moreæŒ‡ä»¤æ›´åŠ å¼ºå¤§ï¼Œæ”¯æŒå„ç§æ˜¾ç¤ºç»ˆç«¯ã€‚lessæŒ‡ä»¤åœ¨æ˜¾ç¤ºæ–‡ä»¶å†…å®¹æ—¶ï¼Œå¹¶ä¸æ˜¯ä¸€æ¬¡å°†æ•´ä¸ªæ–‡ä»¶åŠ è½½ä¹‹åæ‰æ˜¾ç¤ºï¼Œè€Œæ˜¯æ ¹æ®æ˜¾ç¤ºéœ€è¦åŠ è½½å†…å®¹ï¼Œå¯¹äºæ˜¾ç¤ºå¤§å‹æ–‡ä»¶å…·æœ‰è¾ƒé«˜çš„æ•ˆç‡ã€‚</p><p>åŸºæœ¬è¯­æ³•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">less æ–‡ä»¶<br></code></pre></td></tr></table></figure><p>æ“ä½œè¯´æ˜</p><table><thead><tr><th>å¿«æ·é”®</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td>space</td><td>å‘ä¸‹ç¿»ä¸€é¡µ</td></tr><tr><td>return</td><td>å‘ä¸‹ç¿»ä¸€è¡Œ</td></tr><tr><td>q</td><td>é€€å‡º</td></tr><tr><td>b</td><td>å‘ä¸Šç¿»ä¸€é¡µ</td></tr><tr><td>z</td><td>å‘ä¸‹ç¿»ä¸€é¡µ</td></tr><tr><td>=</td><td>æ˜¾ç¤ºå½“å‰é¡µé¢è¡Œå·èŒƒå›´</td></tr><tr><td>:f</td><td>æ˜¾ç¤ºå½“å‰é¡µé¢è¡Œå·èŒƒå›´</td></tr></tbody></table><p>æ¨èä½¿ç”¨<code>less</code>è€Œä¸æ˜¯<code>more</code></p><h4 id="9-4-13-gt-æŒ‡ä»¤-å’Œ-gt-gt-æŒ‡ä»¤"><a href="#9-4-13-gt-æŒ‡ä»¤-å’Œ-gt-gt-æŒ‡ä»¤" class="headerlink" title="9.4.13 &gt;æŒ‡ä»¤ å’Œ &gt;&gt;æŒ‡ä»¤"></a>9.4.13 &gt;æŒ‡ä»¤ å’Œ &gt;&gt;æŒ‡ä»¤</h4><p><code>&gt;</code>å‘½ä»¤æ˜¯è¾“å‡ºé‡å®šå‘ï¼šä¼šå°†åŸæ¥çš„æ–‡ä»¶å†…å®¹è¦†ç›–</p><p><code>&gt;&gt;</code>å‘½ä»¤æ˜¯è¿½åŠ ï¼šä¸ä¼šè¦†ç›–åŸæ¥æ–‡ä»¶çš„å†…å®¹ï¼Œè€Œæ˜¯è¿½åŠ åˆ°æ–‡ä»¶çš„å°¾éƒ¨ã€‚</p><p>åŸºæœ¬è¯­æ³•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">ls -l &gt; æ–‡ä»¶      ï¼ˆåŠŸèƒ½æè¿°ï¼šåˆ—è¡¨çš„å†…å®¹å†™å…¥æ–‡ä»¶a.txtä¸­ï¼ˆè¦†ç›–å†™ï¼‰ï¼‰<br>  è¯´æ˜ï¼šls-l&gt;a.txt, å°†ls-l çš„æ˜¾ç¤ºçš„å†…å®¹è¦†ç›–å†™å…¥åˆ°a.txtæ–‡ä»¶ï¼Œå¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œå°±åˆ›å»ºè¯¥æ–‡ä»¶ã€‚<br>ls -al &gt;&gt; æ–‡ä»¶   ï¼ˆåŠŸèƒ½æè¿°ï¼šåˆ—è¡¨çš„å†…å®¹è¿½åŠ åˆ°æ–‡ä»¶aa.txtçš„æœ«å°¾ï¼‰<br>cat æ–‡ä»¶1 &gt; æ–‡ä»¶2 ï¼ˆåŠŸèƒ½æè¿°ï¼šå°†æ–‡ä»¶ 1 çš„å†…å®¹è¦†ç›–åˆ°æ–‡ä»¶ 2 ï¼‰<br>echo &quot;å†…å®¹&quot; &gt;&gt; æ–‡ä»¶<br></code></pre></td></tr></table></figure><h4 id="9-4-14-echoæŒ‡ä»¤"><a href="#9-4-14-echoæŒ‡ä»¤" class="headerlink" title="9.4.14 echoæŒ‡ä»¤"></a>9.4.14 echoæŒ‡ä»¤</h4><p>echoè¾“å‡ºå†…å®¹åˆ°æ§åˆ¶å°ã€‚</p><p>åŸºæœ¬è¯­æ³•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">echo [é€‰é¡¹] [è¾“å‡ºå†…å®¹]<br></code></pre></td></tr></table></figure><p>åº”ç”¨å®ä¾‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">echo $PATH        #è¾“å‡ºç¯å¢ƒå˜é‡<br>echo $HOSTNAME    #è¾“å‡ºä¸»æœºå<br>echo hello world  #è¾“å‡ºhello world<br></code></pre></td></tr></table></figure><h4 id="9-4-15-headæŒ‡ä»¤"><a href="#9-4-15-headæŒ‡ä»¤" class="headerlink" title="9.4.15 headæŒ‡ä»¤"></a>9.4.15 headæŒ‡ä»¤</h4><p>headç”¨äºæ˜¾ç¤ºæ–‡ä»¶çš„å¼€å¤´éƒ¨åˆ†å†…å®¹ï¼Œé»˜è®¤æƒ…å†µä¸‹headæŒ‡ä»¤æ˜¾ç¤ºæ–‡ä»¶çš„å‰ 10 è¡Œå†…å®¹</p><p>åŸºæœ¬è¯­æ³•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">head æ–‡ä»¶ (åŠŸèƒ½æè¿°ï¼šæŸ¥çœ‹æ–‡ä»¶å¤´ 10 è¡Œå†…å®¹)<br>head-n 5 æ–‡ä»¶ (åŠŸèƒ½æè¿°ï¼šæŸ¥çœ‹æ–‡ä»¶å¤´ 5 è¡Œå†…å®¹ï¼Œ 5 å¯ä»¥æ˜¯ä»»æ„è¡Œæ•°)<br></code></pre></td></tr></table></figure><h4 id="9-4-16-tailæŒ‡ä»¤"><a href="#9-4-16-tailæŒ‡ä»¤" class="headerlink" title="9.4.16 tailæŒ‡ä»¤"></a>9.4.16 tailæŒ‡ä»¤</h4><p>tailç”¨äºè¾“å‡ºæ–‡ä»¶ä¸­å°¾éƒ¨çš„å†…å®¹ï¼Œé»˜è®¤æƒ…å†µä¸‹tailæŒ‡ä»¤æ˜¾ç¤ºæ–‡ä»¶çš„å 10 è¡Œå†…å®¹ã€‚</p><p>åŸºæœ¬è¯­æ³•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">tail æ–‡ä»¶       (åŠŸèƒ½æè¿°ï¼šæŸ¥çœ‹æ–‡ä»¶å 10 è¡Œå†…å®¹ï¼‰<br>tail -n 5 æ–‡ä»¶ ï¼ˆåŠŸèƒ½æè¿°ï¼šæŸ¥çœ‹æ–‡ä»¶å 5 è¡Œå†…å®¹ï¼Œ 5 å¯ä»¥æ˜¯ä»»æ„è¡Œæ•°ï¼‰<br>tail -f æ–‡ä»¶   ï¼ˆåŠŸèƒ½æè¿°ï¼šå®æ—¶è¿½è¸ªè¯¥æ–‡æ¡£çš„æ‰€æœ‰æ›´æ–°ï¼Œå·¥ä½œç»å¸¸ä½¿ç”¨ï¼‰<br></code></pre></td></tr></table></figure><h4 id="9-4-17-lnæŒ‡ä»¤"><a href="#9-4-17-lnæŒ‡ä»¤" class="headerlink" title="9.4.17 lnæŒ‡ä»¤"></a>9.4.17 lnæŒ‡ä»¤</h4><p>è½¯é“¾æ¥ä¹Ÿå«ç¬¦å·é“¾æ¥ï¼Œç±»ä¼¼äºwindowsé‡Œçš„å¿«æ·æ–¹å¼ï¼Œä¸»è¦å­˜æ”¾äº†é“¾æ¥å…¶ä»–æ–‡ä»¶çš„è·¯å¾„</p><p>åŸºæœ¬è¯­æ³•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ln -s  [åŸæ–‡ä»¶æˆ–ç›®å½•] [è½¯é“¾æ¥å] ï¼ˆåŠŸèƒ½æè¿°ï¼šç»™åŸæ–‡ä»¶åˆ›å»ºä¸€ä¸ªè½¯é“¾æ¥ï¼‰<br></code></pre></td></tr></table></figure><p>åº”ç”¨å®ä¾‹<br>æ¡ˆä¾‹ 1 : åœ¨/home ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªè½¯è¿æ¥ linkToRootï¼Œè¿æ¥åˆ° /root ç›®å½•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ln -s /root ./linkToRoot<br></code></pre></td></tr></table></figure><p>æ¡ˆä¾‹ 2 : åˆ é™¤è½¯è¿æ¥ linkToRoot</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">rm ./linkToRoot<br></code></pre></td></tr></table></figure><p>ç»†èŠ‚è¯´æ˜<br>å½“æˆ‘ä»¬ä½¿ç”¨pwdæŒ‡ä»¤æŸ¥çœ‹ç›®å½•æ—¶ï¼Œä»ç„¶çœ‹åˆ°çš„æ˜¯è½¯é“¾æ¥æ‰€åœ¨ç›®å½•ã€‚</p><h4 id="9-4-18-historyæŒ‡ä»¤"><a href="#9-4-18-historyæŒ‡ä»¤" class="headerlink" title="9.4.18 historyæŒ‡ä»¤"></a>9.4.18 historyæŒ‡ä»¤</h4><p>æŸ¥çœ‹å·²ç»æ‰§è¡Œè¿‡å†å²å‘½ä»¤,ä¹Ÿå¯ä»¥æ‰§è¡Œå†å²æŒ‡ä»¤</p><p>åŸºæœ¬è¯­æ³•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">history ï¼ˆåŠŸèƒ½æè¿°ï¼šæŸ¥çœ‹å·²ç»æ‰§è¡Œè¿‡å†å²å‘½ä»¤ï¼‰<br></code></pre></td></tr></table></figure><p>åº”ç”¨å®ä¾‹<br>æ¡ˆä¾‹ 1 : æ˜¾ç¤ºæ‰€æœ‰çš„å†å²å‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">history<br></code></pre></td></tr></table></figure><p>æ¡ˆä¾‹ 2 : æ˜¾ç¤ºæœ€è¿‘ä½¿ç”¨è¿‡çš„ 10 ä¸ªæŒ‡ä»¤ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">history 10<br></code></pre></td></tr></table></figure><p>æ¡ˆä¾‹ 3 ï¼šæ‰§è¡Œå†å²ç¼–å·ä¸º 5 çš„æŒ‡ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">!5<br></code></pre></td></tr></table></figure><h3 id="9-5-æ—¶é—´æ—¥æœŸç±»"><a href="#9-5-æ—¶é—´æ—¥æœŸç±»" class="headerlink" title="9.5 æ—¶é—´æ—¥æœŸç±»"></a>9.5 æ—¶é—´æ—¥æœŸç±»</h3><h4 id="9-5-1-dateæŒ‡ä»¤-æ˜¾ç¤ºå½“å‰æ—¥æœŸ"><a href="#9-5-1-dateæŒ‡ä»¤-æ˜¾ç¤ºå½“å‰æ—¥æœŸ" class="headerlink" title="9.5.1 dateæŒ‡ä»¤-æ˜¾ç¤ºå½“å‰æ—¥æœŸ"></a>9.5.1 dateæŒ‡ä»¤-æ˜¾ç¤ºå½“å‰æ—¥æœŸ</h4><p>åŸºæœ¬è¯­æ³•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">date     ï¼ˆåŠŸèƒ½æè¿°ï¼šæ˜¾ç¤ºå½“å‰æ—¶é—´ï¼‰<br>date +%Y ï¼ˆåŠŸèƒ½æè¿°ï¼šæ˜¾ç¤ºå½“å‰å¹´ä»½ï¼‰<br>date +%m ï¼ˆåŠŸèƒ½æè¿°ï¼šæ˜¾ç¤ºå½“å‰æœˆä»½ï¼‰<br>date +%d ï¼ˆåŠŸèƒ½æè¿°ï¼šæ˜¾ç¤ºå½“å‰æ˜¯å“ªä¸€å¤©ï¼‰<br>date &quot;+%Y-%m-%d%H:%M:%S&quot;ï¼ˆåŠŸèƒ½æè¿°ï¼šæ˜¾ç¤ºå¹´æœˆæ—¥æ—¶åˆ†ç§’ï¼‰<br></code></pre></td></tr></table></figure><h4 id="9-5-2-dateæŒ‡ä»¤-è®¾ç½®æ—¥æœŸ"><a href="#9-5-2-dateæŒ‡ä»¤-è®¾ç½®æ—¥æœŸ" class="headerlink" title="9.5.2 dateæŒ‡ä»¤-è®¾ç½®æ—¥æœŸ"></a>9.5.2 dateæŒ‡ä»¤-è®¾ç½®æ—¥æœŸ</h4><p>åŸºæœ¬è¯­æ³•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">date -s å­—ç¬¦ä¸²æ—¶é—´     (å­—ç¬¦ä¸²æ—¶é—´æ ¼å¼ä¸ºï¼šâ€œ2018-10-10 11:22:22â€ï¼Œæ­¤æ—¶æ—¥æœŸå’Œæ—¶é—´ç”¨åŒå¼•å·å¼•èµ·æ¥)<br>date -s 14:31:00     (è®¾ç½®æ—¶é—´)<br>date -s 20100405    ï¼ˆè®¾ç½®æ—¥æœŸï¼‰<br></code></pre></td></tr></table></figure><h4 id="9-5-3-calæŒ‡ä»¤"><a href="#9-5-3-calæŒ‡ä»¤" class="headerlink" title="9.5.3 calæŒ‡ä»¤"></a>9.5.3 calæŒ‡ä»¤</h4><p>æŸ¥çœ‹æ—¥å†æŒ‡ä»¤</p><p>åŸºæœ¬è¯­æ³•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">cal [é€‰é¡¹] ï¼ˆåŠŸèƒ½æè¿°ï¼šä¸åŠ é€‰é¡¹ï¼Œæ˜¾ç¤ºæœ¬æœˆæ—¥å†ï¼‰<br>cal 2020   (åŠŸèƒ½æè¿°ï¼šæ˜¾ç¤º2020å¹´æ—¥å†)<br></code></pre></td></tr></table></figure><h3 id="9-6-æœç´¢æŸ¥æ‰¾ç±»"><a href="#9-6-æœç´¢æŸ¥æ‰¾ç±»" class="headerlink" title="9.6 æœç´¢æŸ¥æ‰¾ç±»"></a>9.6 æœç´¢æŸ¥æ‰¾ç±»</h3><h4 id="9-6-1-findæŒ‡ä»¤"><a href="#9-6-1-findæŒ‡ä»¤" class="headerlink" title="9.6.1 findæŒ‡ä»¤"></a>9.6.1 findæŒ‡ä»¤</h4><p>findæŒ‡ä»¤å°†ä»æŒ‡å®šç›®å½•å‘ä¸‹é€’å½’åœ°éå†å…¶å„ä¸ªå­ç›®å½•ï¼Œå°†æ»¡è¶³æ¡ä»¶çš„æ–‡ä»¶æˆ–è€…ç›®å½•æ˜¾ç¤ºåœ¨ç»ˆç«¯ã€‚</p><p>åŸºæœ¬è¯­æ³•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">find [æœç´¢èŒƒå›´] [é€‰é¡¹]<br></code></pre></td></tr></table></figure><p>é€‰é¡¹</p><table><thead><tr><th>é€‰é¡¹</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td>-name &lt;æ–‡ä»¶å&gt;</td><td>æŒ‰ç…§æŒ‡å®šçš„æ–‡ä»¶åæŸ¥æ‰¾æ¨¡å¼æŸ¥æ‰¾æ–‡ä»¶</td></tr><tr><td>-user &lt;ç”¨æˆ·å&gt;</td><td>æŸ¥æ‰¾å±äºæŒ‡å®šç”¨æˆ·åæ‰€æœ‰æ–‡ä»¶</td></tr><tr><td>-size &lt;æ–‡ä»¶å¤§å°&gt;</td><td>æŒ‰ç…§æŒ‡å®šçš„æ–‡ä»¶å¤§å°æŸ¥æ‰¾æ–‡ä»¶</td></tr></tbody></table><p>åº”ç”¨å®ä¾‹<br>æ¡ˆä¾‹ 1 : æŒ‰æ–‡ä»¶åï¼šæ ¹æ®åç§°æŸ¥æ‰¾/home ç›®å½•ä¸‹çš„hello.txtæ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">find /home -name hello.txt<br></code></pre></td></tr></table></figure><p>æ¡ˆä¾‹ 2 ï¼šæŒ‰æ‹¥æœ‰è€…ï¼šæŸ¥æ‰¾/optç›®å½•ä¸‹ï¼Œå±äºnobodyçš„æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">find /opt -user nobody<br></code></pre></td></tr></table></figure><p>æ¡ˆä¾‹ 3 ï¼šæŸ¥æ‰¾æ•´ä¸ªlinuxç³»ç»Ÿä¸‹å¤§äº 20 mçš„æ–‡ä»¶ï¼ˆ+n å¤§äº -nå°äº nç­‰äºï¼‰</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">find / -size +200M<br></code></pre></td></tr></table></figure><p>æ¡ˆä¾‹ 4ï¼šæŸ¥è¯¢ / ç›®å½•ä¸‹ï¼Œæ‰€æœ‰ .txtçš„æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">find / -name *.txt<br></code></pre></td></tr></table></figure><h4 id="9-6-2-locateæŒ‡ä»¤"><a href="#9-6-2-locateæŒ‡ä»¤" class="headerlink" title="9.6.2 locateæŒ‡ä»¤"></a>9.6.2 locateæŒ‡ä»¤</h4><p>locateæŒ‡ä»¤å¯ä»¥å¿«é€Ÿå®šä½æ–‡ä»¶è·¯å¾„ã€‚locateæŒ‡ä»¤åˆ©ç”¨äº‹å…ˆå»ºç«‹çš„ç³»ç»Ÿä¸­æ‰€æœ‰æ–‡ä»¶åç§°åŠè·¯å¾„çš„locateæ•°æ®åº“å®ç°å¿«é€Ÿå®šä½ç»™å®šçš„æ–‡ä»¶ã€‚LocateæŒ‡ä»¤æ— éœ€éå†æ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼ŒæŸ¥è¯¢é€Ÿåº¦è¾ƒå¿«ã€‚ä¸ºäº†ä¿è¯æŸ¥è¯¢ç»“æœçš„å‡†ç¡®åº¦ï¼Œç®¡ç†å‘˜å¿…é¡»å®šæœŸæ›´æ–°locateæ—¶åˆ»ã€‚</p><p>åŸºæœ¬è¯­æ³•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">locate æœç´¢æ–‡ä»¶<br></code></pre></td></tr></table></figure><p>ç‰¹åˆ«è¯´æ˜<br>ç”±äºlocateæŒ‡ä»¤åŸºäºæ•°æ®åº“è¿›è¡ŒæŸ¥è¯¢ï¼Œæ‰€ä»¥ç¬¬ä¸€æ¬¡è¿è¡Œå‰ï¼Œ<strong>å¿…é¡»ä½¿ç”¨<code>updatedb</code>æŒ‡ä»¤åˆ›å»ºlocateæ•°æ®åº“</strong>ã€‚</p><p>åº”ç”¨å®ä¾‹<br>æ¡ˆä¾‹ 1 : è¯·ä½¿ç”¨locate æŒ‡ä»¤å¿«é€Ÿå®šä½ hello.txt æ–‡ä»¶æ‰€åœ¨ç›®å½•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">updatedb<br>locate hello.txt<br></code></pre></td></tr></table></figure><h4 id="9-6-3-whichæŒ‡ä»¤"><a href="#9-6-3-whichæŒ‡ä»¤" class="headerlink" title="9.6.3 whichæŒ‡ä»¤"></a>9.6.3 whichæŒ‡ä»¤</h4><p>whichæŒ‡ä»¤å¯ä»¥æŸ¥çœ‹æŸä¸ªæŒ‡ä»¤åœ¨å“ªä¸ªç›®å½•ä¸‹ã€‚</p><p>åŸºæœ¬è¯­æ³•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">which æŒ‡ä»¤<br></code></pre></td></tr></table></figure><h4 id="9-6-4-grepæŒ‡ä»¤-å’Œ-ç®¡é“ç¬¦å·"><a href="#9-6-4-grepæŒ‡ä»¤-å’Œ-ç®¡é“ç¬¦å·" class="headerlink" title="9.6.4 grepæŒ‡ä»¤ å’Œ ç®¡é“ç¬¦å· |"></a>9.6.4 grepæŒ‡ä»¤ å’Œ ç®¡é“ç¬¦å· |</h4><p>grep è¿‡æ»¤æŸ¥æ‰¾ ï¼Œ ç®¡é“ç¬¦â€œ|â€ï¼Œè¡¨ç¤ºå°†å‰ä¸€ä¸ªå‘½ä»¤çš„å¤„ç†ç»“æœè¾“å‡ºä¼ é€’ç»™åé¢çš„å‘½ä»¤å¤„ç†ã€‚</p><p>åŸºæœ¬è¯­æ³•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">grep [é€‰é¡¹] æŸ¥æ‰¾å†…å®¹ æºæ–‡ä»¶<br></code></pre></td></tr></table></figure><p>å¸¸ç”¨é€‰é¡¹</p><ul><li>-n : æ˜¾ç¤ºåŒ¹é…è¡ŒåŠè¡Œå·</li><li>-i ï¼šå¿½ç•¥å­—æ¯å¤§å°å†™</li></ul><p>åº”ç”¨å®ä¾‹<br>æ¡ˆä¾‹ 1 : è¯·åœ¨ hello.txt æ–‡ä»¶ä¸­ï¼ŒæŸ¥æ‰¾ â€œyesâ€ æ‰€åœ¨è¡Œï¼Œå¹¶ä¸”æ˜¾ç¤ºè¡Œå·</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">cat /home/hello.txt | grep -n yes<br>grep -n yes hello.txt<br></code></pre></td></tr></table></figure><h3 id="9-7-å‹ç¼©å’Œè§£å‹ç±»"><a href="#9-7-å‹ç¼©å’Œè§£å‹ç±»" class="headerlink" title="9.7 å‹ç¼©å’Œè§£å‹ç±»"></a>9.7 å‹ç¼©å’Œè§£å‹ç±»</h3><h4 id="9-7-1-gzip-gunzip-æŒ‡ä»¤"><a href="#9-7-1-gzip-gunzip-æŒ‡ä»¤" class="headerlink" title="9.7.1 gzip/gunzip æŒ‡ä»¤"></a>9.7.1 gzip/gunzip æŒ‡ä»¤</h4><p>gzip ç”¨äºå‹ç¼©æ–‡ä»¶ï¼Œ gunzip ç”¨äºè§£å‹çš„</p><p>åŸºæœ¬è¯­æ³•</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">gzip æ–‡ä»¶      ï¼ˆåŠŸèƒ½æè¿°ï¼šå‹ç¼©æ–‡ä»¶ï¼Œåªèƒ½å°†æ–‡ä»¶å‹ç¼©ä¸º*<span class="hljs-string">.gz</span>æ–‡ä»¶ï¼‰<br>gunzip æ–‡ä»¶<span class="hljs-string">.gz</span> ï¼ˆåŠŸèƒ½æè¿°ï¼šè§£å‹ç¼©æ–‡ä»¶å‘½ä»¤ï¼‰<br></code></pre></td></tr></table></figure><p>ç»†èŠ‚è¯´æ˜<br>å½“æˆ‘ä»¬ä½¿ç”¨gzip å¯¹æ–‡ä»¶è¿›è¡Œå‹ç¼©åï¼Œä¸ä¼šä¿ç•™åŸæ¥çš„æ–‡ä»¶ã€‚</p><h4 id="9-7-2-zip-unzip-æŒ‡ä»¤"><a href="#9-7-2-zip-unzip-æŒ‡ä»¤" class="headerlink" title="9.7.2 zip/unzip æŒ‡ä»¤"></a>9.7.2 zip/unzip æŒ‡ä»¤</h4><p>zip ç”¨äºå‹ç¼©æ–‡ä»¶ï¼Œ unzip ç”¨äºè§£å‹çš„ï¼Œè¿™ä¸ªåœ¨é¡¹ç›®æ‰“åŒ…å‘å¸ƒä¸­å¾ˆæœ‰ç”¨çš„</p><p>åŸºæœ¬è¯­æ³•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">zip   [é€‰é¡¹] XXX.zip å°†è¦å‹ç¼©çš„å†…å®¹ï¼ˆåŠŸèƒ½æè¿°ï¼šå‹ç¼©æ–‡ä»¶å’Œç›®å½•çš„å‘½ä»¤ï¼‰<br>unzip [é€‰é¡¹] XXX.zipï¼ˆåŠŸèƒ½æè¿°ï¼šè§£å‹ç¼©æ–‡ä»¶ï¼‰<br></code></pre></td></tr></table></figure><p>zipå¸¸ç”¨é€‰é¡¹</p><ul><li>rï¼šé€’å½’å‹ç¼©ï¼Œå³å‹ç¼©ç›®å½•</li></ul><p>unzipçš„å¸¸ç”¨é€‰é¡¹</p><ul><li>d&lt;ç›®å½•&gt;ï¼šæŒ‡å®šè§£å‹åæ–‡ä»¶çš„å­˜æ”¾ç›®å½•</li></ul><p>åº”ç”¨å®ä¾‹<br>æ¡ˆä¾‹ 1 : å°† /homeæœ¬èº«åŠä¸‹çš„æ‰€æœ‰æ–‡ä»¶è¿›è¡Œå‹ç¼©æˆ mypackage.zip</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">zip -r mypackage.zip /home<br></code></pre></td></tr></table></figure><p>æ¡ˆä¾‹ 2 : å°† mypackage.zip è§£å‹åˆ° /opt/tmp ç›®å½•ä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">unzip -d /opt/tmp mypackage.zip<br></code></pre></td></tr></table></figure><h4 id="9-7-3-tar-æŒ‡ä»¤"><a href="#9-7-3-tar-æŒ‡ä»¤" class="headerlink" title="9.7.3 tar æŒ‡ä»¤"></a>9.7.3 tar æŒ‡ä»¤</h4><p>tar æŒ‡ä»¤ æ˜¯æ‰“åŒ…æŒ‡ä»¤ï¼Œæœ€åæ‰“åŒ…åçš„æ–‡ä»¶æ˜¯ .tar.gz çš„æ–‡ä»¶ã€‚</p><p>åŸºæœ¬è¯­æ³•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">tar [é€‰é¡¹] XXX.tar.gz æ‰“åŒ…çš„å†…å®¹ (åŠŸèƒ½æè¿°ï¼šæ‰“åŒ…ç›®å½•ï¼Œå‹ç¼©åçš„æ–‡ä»¶æ ¼å¼.tar.gz)<br></code></pre></td></tr></table></figure><p>é€‰é¡¹è¯´æ˜</p><table><thead><tr><th>é€‰é¡¹</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td>-c</td><td>äº§ç”Ÿ.taræ‰“åŒ…æ–‡ä»¶</td></tr><tr><td>-v</td><td>æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯</td></tr><tr><td>-f</td><td>æŒ‡å®šå‹ç¼©åçš„æ–‡ä»¶å</td></tr><tr><td>-z</td><td>æ‰“åŒ…åŒæ—¶å‹ç¼© (å‹ç¼©æˆ.gzæ–‡ä»¶éœ€è¦åŠ ä¸Šï¼ŒåŒæ—¶è§£å‹.gzæ–‡ä»¶ä¹Ÿéœ€è¦åŠ ä¸Šã€‚å¦‚æœæ–‡ä»¶æ˜¯.tarç»“å°¾ï¼Œä¸èƒ½åŠ zé€‰é¡¹)</td></tr><tr><td>-x</td><td>è§£åŒ….taræ–‡ä»¶</td></tr></tbody></table><p>åº”ç”¨å®ä¾‹</p><p>æ¡ˆä¾‹ 1 : å‹ç¼©å¤šä¸ªæ–‡ä»¶ï¼Œå°† /home/pig.txt å’Œ /home/cat.txt å‹ç¼©æˆ pc.tar.gz</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">tar -zcvf pc.tar.gz /home/pig.txt /home/cat.txt<br></code></pre></td></tr></table></figure><p>æ¡ˆä¾‹ 2 : å°†/home çš„æ–‡ä»¶å¤¹ å‹ç¼©æˆ myhome.tar.gz</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">tar -zcvf myhome.tar.gz /home<br></code></pre></td></tr></table></figure><p>æ¡ˆä¾‹ 3 : å°† pc.tar.gz è§£å‹åˆ°å½“å‰ç›®å½•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">tar -zxvf pc.tar.gz<br></code></pre></td></tr></table></figure><p>æ¡ˆä¾‹ 4 : å°†myhome.tar.gz è§£å‹åˆ° /opt/ ç›®å½•ä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">tar -zxvf myhome.tar.gz -C /opt # -C é€‰é¡¹ä»£è¡¨è§£å‹åˆ°æŒ‡å®šç›®å½•ï¼ŒæŒ‡å®šè§£å‹åˆ°çš„é‚£ä¸ªç›®å½•ï¼Œäº‹å…ˆè¦å­˜åœ¨æ‰èƒ½æˆåŠŸï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚<br></code></pre></td></tr></table></figure><h2 id="åã€ç»„ç®¡ç†å’Œæƒé™ç®¡ç†"><a href="#åã€ç»„ç®¡ç†å’Œæƒé™ç®¡ç†" class="headerlink" title="åã€ç»„ç®¡ç†å’Œæƒé™ç®¡ç†"></a>åã€ç»„ç®¡ç†å’Œæƒé™ç®¡ç†</h2><h3 id="10-1-Linuxç»„åŸºæœ¬ä»‹ç»"><a href="#10-1-Linuxç»„åŸºæœ¬ä»‹ç»" class="headerlink" title="10.1 Linuxç»„åŸºæœ¬ä»‹ç»"></a>10.1 Linuxç»„åŸºæœ¬ä»‹ç»</h3><p>åœ¨linuxä¸­çš„æ¯ä¸ªç”¨æˆ·å¿…é¡»å±äºä¸€ä¸ªç»„ï¼Œä¸èƒ½ç‹¬ç«‹äºç»„å¤–ã€‚åœ¨linuxä¸­æ¯ä¸ªæ–‡ä»¶æœ‰æ‰€æœ‰è€…ã€æ‰€åœ¨ç»„ã€å…¶å®ƒç»„çš„æ¦‚å¿µã€‚</p><h3 id="10-2-æ–‡ä»¶-ç›®å½•æ‰€æœ‰è€…"><a href="#10-2-æ–‡ä»¶-ç›®å½•æ‰€æœ‰è€…" class="headerlink" title="10.2 æ–‡ä»¶/ç›®å½•æ‰€æœ‰è€…"></a>10.2 æ–‡ä»¶/ç›®å½•æ‰€æœ‰è€…</h3><p>ä¸€èˆ¬ä¸ºæ–‡ä»¶çš„åˆ›å»ºè€…,è°åˆ›å»ºäº†è¯¥æ–‡ä»¶ï¼Œå°±è‡ªç„¶çš„æˆä¸ºè¯¥æ–‡ä»¶çš„æ‰€æœ‰è€…ï¼ˆå½“ç„¶éšåå¯ä»¥æ›´æ”¹æ–‡ä»¶çš„æ‰€æœ‰è€…ï¼‰ã€‚</p><h4 id="10-2-1-æŸ¥çœ‹æ–‡ä»¶çš„æ‰€æœ‰è€…"><a href="#10-2-1-æŸ¥çœ‹æ–‡ä»¶çš„æ‰€æœ‰è€…" class="headerlink" title="10.2.1 æŸ¥çœ‹æ–‡ä»¶çš„æ‰€æœ‰è€…"></a>10.2.1 æŸ¥çœ‹æ–‡ä»¶çš„æ‰€æœ‰è€…</h4><p>åŸºæœ¬è¯­æ³•</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli"><span class="hljs-keyword">ls</span> -ahl  <span class="hljs-comment"># -a æ˜¾ç¤ºæ‰€æœ‰æ–‡ä»¶</span><br> <span class="hljs-comment"># -l æ˜¾ç¤ºæ–‡ä»¶è¯¦ç»†ä¿¡æ¯ï¼Œä»¥è¡Œçš„å½¢å¼æ˜¾ç¤º</span><br> <span class="hljs-comment"># -h ä»¥äººç±»çš„ä¹ æƒ¯ï¼Œæ˜¾ç¤ºæ–‡ä»¶å¤§å°</span><br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20220222161844053.png"></p><h4 id="10-2-2-ä¿®æ”¹æ–‡ä»¶æ‰€æœ‰è€…"><a href="#10-2-2-ä¿®æ”¹æ–‡ä»¶æ‰€æœ‰è€…" class="headerlink" title="10.2.2 ä¿®æ”¹æ–‡ä»¶æ‰€æœ‰è€…"></a>10.2.2 ä¿®æ”¹æ–‡ä»¶æ‰€æœ‰è€…</h4><p>åŸºæœ¬è¯­æ³•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">chown ç”¨æˆ·å æ–‡ä»¶å<br></code></pre></td></tr></table></figure><p>åº”ç”¨æ¡ˆä¾‹</p><p>æ¡ˆä¾‹ï¼šä½¿ç”¨root åˆ›å»ºä¸€ä¸ªæ–‡ä»¶apple.txt ï¼Œç„¶åå°†å…¶æ‰€æœ‰è€…ä¿®æ”¹æˆ tom</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">chown tom apple.txt<br></code></pre></td></tr></table></figure><h3 id="10-3-æ–‡ä»¶-ç›®å½•-æ‰€åœ¨ç»„"><a href="#10-3-æ–‡ä»¶-ç›®å½•-æ‰€åœ¨ç»„" class="headerlink" title="10.3 æ–‡ä»¶/ç›®å½• æ‰€åœ¨ç»„"></a>10.3 æ–‡ä»¶/ç›®å½• æ‰€åœ¨ç»„</h3><p>å½“æŸä¸ªç”¨æˆ·åˆ›å»ºäº†ä¸€ä¸ªæ–‡ä»¶åï¼Œé»˜è®¤è¿™ä¸ªæ–‡ä»¶çš„æ‰€åœ¨ç»„å°±æ˜¯è¯¥ç”¨æˆ·æ‰€åœ¨çš„ç»„ã€‚</p><h4 id="10-3-1-æŸ¥çœ‹æ–‡ä»¶-ç›®å½•æ‰€åœ¨ç»„"><a href="#10-3-1-æŸ¥çœ‹æ–‡ä»¶-ç›®å½•æ‰€åœ¨ç»„" class="headerlink" title="10.3.1 æŸ¥çœ‹æ–‡ä»¶/ç›®å½•æ‰€åœ¨ç»„"></a>10.3.1 æŸ¥çœ‹æ–‡ä»¶/ç›®å½•æ‰€åœ¨ç»„</h4><p>åŸºæœ¬è¯­æ³•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ls -lah<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20220222161945221.png"></p><h4 id="10-3-2-ä¿®æ”¹æ–‡ä»¶-ç›®å½•æ‰€åœ¨çš„ç»„"><a href="#10-3-2-ä¿®æ”¹æ–‡ä»¶-ç›®å½•æ‰€åœ¨çš„ç»„" class="headerlink" title="10.3.2 ä¿®æ”¹æ–‡ä»¶/ç›®å½•æ‰€åœ¨çš„ç»„"></a>10.3.2 ä¿®æ”¹æ–‡ä»¶/ç›®å½•æ‰€åœ¨çš„ç»„</h4><p>åŸºæœ¬è¯­æ³•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">chgrp ç»„å æ–‡ä»¶å/ç›®å½•<br></code></pre></td></tr></table></figure><p>åº”ç”¨å®ä¾‹<br>å®ä¾‹ï¼šä½¿ç”¨rootç”¨æˆ·åˆ›å»ºæ–‡ä»¶ orange.txt,çœ‹çœ‹å½“å‰è¿™ä¸ªæ–‡ä»¶å±äºå“ªä¸ªç»„ï¼Œç„¶åå°†è¿™ä¸ªæ–‡ä»¶æ‰€åœ¨ç»„ï¼Œä¿®æ”¹åˆ°fruitç»„ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">chgrp fruit orange.txt<br></code></pre></td></tr></table></figure><h3 id="10-4-å…¶å®ƒç»„"><a href="#10-4-å…¶å®ƒç»„" class="headerlink" title="10.4 å…¶å®ƒç»„"></a>10.4 å…¶å®ƒç»„</h3><p>é™¤æ–‡ä»¶æ‰€åœ¨ç»„å¤–ï¼Œç³»ç»Ÿå…¶ä»–ç»„éƒ½æ˜¯æ–‡ä»¶çš„å…¶å®ƒç»„.</p><h3 id="10-5-æ”¹å˜ç”¨æˆ·æ‰€åœ¨ç»„"><a href="#10-5-æ”¹å˜ç”¨æˆ·æ‰€åœ¨ç»„" class="headerlink" title="10.5 æ”¹å˜ç”¨æˆ·æ‰€åœ¨ç»„"></a>10.5 æ”¹å˜ç”¨æˆ·æ‰€åœ¨ç»„</h3><p>åœ¨æ·»åŠ ç”¨æˆ·æ—¶ï¼Œå¯ä»¥æŒ‡å®šå°†è¯¥ç”¨æˆ·æ·»åŠ åˆ°å“ªä¸ªç»„ä¸­ï¼ŒåŒæ ·çš„ç”¨rootçš„ç®¡ç†æƒé™å¯ä»¥æ”¹å˜æŸä¸ªç”¨æˆ·æ‰€åœ¨çš„ç»„ã€‚</p><h4 id="10-5-1-æ”¹å˜ç”¨æˆ·æ‰€åœ¨ç»„"><a href="#10-5-1-æ”¹å˜ç”¨æˆ·æ‰€åœ¨ç»„" class="headerlink" title="10.5.1 æ”¹å˜ç”¨æˆ·æ‰€åœ¨ç»„"></a>10.5.1 æ”¹å˜ç”¨æˆ·æ‰€åœ¨ç»„</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">usermod â€“g ç»„å ç”¨æˆ·å<br>usermod â€“d ç›®å½•å ç”¨æˆ·å # æ”¹å˜è¯¥ç”¨æˆ·ç™»é™†çš„åˆå§‹ç›®å½•ï¼Œå½“ç„¶è¯¥ç”¨æˆ·å¿…é¡»æœ‰è¿›å…¥è¯¥ç›®å½•çš„æƒé™<br></code></pre></td></tr></table></figure><p>åº”ç”¨å®ä¾‹</p><p>å®ä¾‹ï¼šåˆ›å»ºä¸€ä¸ªåœŸåŒªç»„ï¼ˆbanditï¼‰å°† tom è¿™ä¸ªç”¨æˆ·ä»åŸæ¥æ‰€åœ¨çš„policeç»„ï¼Œä¿®æ”¹åˆ° bandit(åœŸåŒª) ç»„</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">groupadd bandit<br>usermod -g bandit tom<br></code></pre></td></tr></table></figure><h3 id="10-6-æƒé™çš„åŸºæœ¬ä»‹ç»"><a href="#10-6-æƒé™çš„åŸºæœ¬ä»‹ç»" class="headerlink" title="10.6 æƒé™çš„åŸºæœ¬ä»‹ç»"></a>10.6 æƒé™çš„åŸºæœ¬ä»‹ç»</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">ls -l ä¸­æ˜¾ç¤ºçš„å†…å®¹å¦‚ä¸‹ï¼š<br>-rwxrw-r-- 1 root root 1213 Feb 2 09:39 abc<br></code></pre></td></tr></table></figure><p>0 - 9 ä½è¯´æ˜</p><ul><li><p>ç¬¬ 0 ä½ç¡®å®šæ–‡ä»¶ç±»å‹(d,-,l,c,b)</p><ul><li>læ˜¯è¿æ¥ï¼Œç›¸å½“äºwindowsçš„å¿«æ·æ–¹å¼</li><li>dæ˜¯ç›®å½•ï¼Œç›¸å½“äºwindowsçš„æ–‡ä»¶å¤¹</li><li>cæ˜¯å­—ç¬¦è®¾å¤‡æ–‡ä»¶ï¼Œæ¯”å¦‚é¼ æ ‡ã€é”®ç›˜ç­‰</li><li>bæ˜¯å—è®¾å¤‡ï¼Œæ¯”å¦‚ç¡¬ç›˜ </li><li><code>-</code>æ˜¯æ–‡ä»¶</li></ul></li><li><p>ç¬¬ 1 - 3 ä½ç¡®å®šæ‰€æœ‰è€…ï¼ˆè¯¥æ–‡ä»¶çš„æ‰€æœ‰è€…ï¼‰æ‹¥æœ‰è¯¥æ–‡ä»¶çš„æƒé™ã€‚â€”User</p></li><li><p>ç¬¬ 4 - 6 ä½ç¡®å®šæ‰€å±ç»„ï¼ˆåŒç”¨æˆ·ç»„çš„ï¼‰æ‹¥æœ‰è¯¥æ–‡ä»¶çš„æƒé™ï¼Œâ€”Group</p></li><li><p>ç¬¬ 7 - 9 ä½ç¡®å®šå…¶ä»–ç”¨æˆ·æ‹¥æœ‰è¯¥æ–‡ä»¶çš„æƒé™ â€”Other</p></li></ul><h3 id="10-7-RWXæƒé™è¯¦è§£"><a href="#10-7-RWXæƒé™è¯¦è§£" class="headerlink" title="10.7 RWXæƒé™è¯¦è§£"></a>10.7 RWXæƒé™è¯¦è§£</h3><h4 id="10-7-1-rwxä½œç”¨åˆ°æ–‡ä»¶"><a href="#10-7-1-rwxä½œç”¨åˆ°æ–‡ä»¶" class="headerlink" title="10.7.1 rwxä½œç”¨åˆ°æ–‡ä»¶"></a>10.7.1 rwxä½œç”¨åˆ°æ–‡ä»¶</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">[r]ä»£è¡¨å¯è¯»(read): å¯ä»¥è¯»å–,æŸ¥çœ‹<br>[w]ä»£è¡¨å¯å†™(write): å¯ä»¥ä¿®æ”¹,ä½†æ˜¯ä¸ä»£è¡¨å¯ä»¥åˆ é™¤è¯¥æ–‡ä»¶,åˆ é™¤ä¸€ä¸ªæ–‡ä»¶çš„å‰ææ¡ä»¶æ˜¯å¯¹è¯¥æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•æœ‰å†™æƒé™ï¼Œæ‰èƒ½åˆ é™¤è¯¥æ–‡ä»¶.<br>[x]ä»£è¡¨å¯æ‰§è¡Œ(execute):å¯ä»¥è¢«æ‰§è¡Œ<br></code></pre></td></tr></table></figure><h4 id="10-7-2-rwxä½œç”¨åˆ°ç›®å½•"><a href="#10-7-2-rwxä½œç”¨åˆ°ç›®å½•" class="headerlink" title="10.7.2 rwxä½œç”¨åˆ°ç›®å½•"></a>10.7.2 rwxä½œç”¨åˆ°ç›®å½•</h4><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-selector-attr">[r]</span>ä»£è¡¨å¯è¯»(read): å¯ä»¥è¯»å–ï¼Œ<span class="hljs-selector-tag">ls</span>æŸ¥çœ‹ç›®å½•å†…å®¹<br><span class="hljs-selector-attr">[w]</span>ä»£è¡¨å¯å†™(write): å¯ä»¥ä¿®æ”¹,ç›®å½•å†…åˆ›å»º+åˆ é™¤+é‡å‘½åç›®å½•<br><span class="hljs-selector-attr">[x]</span>ä»£è¡¨å¯æ‰§è¡Œ(execute):å¯ä»¥è¿›å…¥è¯¥ç›®å½•<br></code></pre></td></tr></table></figure><h3 id="10-8-æ–‡ä»¶åŠç›®å½•æƒé™å®é™…æ¡ˆä¾‹"><a href="#10-8-æ–‡ä»¶åŠç›®å½•æƒé™å®é™…æ¡ˆä¾‹" class="headerlink" title="10.8 æ–‡ä»¶åŠç›®å½•æƒé™å®é™…æ¡ˆä¾‹"></a>10.8 æ–‡ä»¶åŠç›®å½•æƒé™å®é™…æ¡ˆä¾‹</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">ls -l <br>-rwxrw-r-- 1 rootroot 1213 Feb 2 09 : 39 abc<br></code></pre></td></tr></table></figure><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs gcode">-rwxrw-r-- <span class="hljs-number">10</span>ä¸ªå­—ç¬¦ç¡®å®šä¸åŒç”¨æˆ·èƒ½å¯¹æ–‡ä»¶å¹²ä»€ä¹ˆ<br>ç¬¬ä¸€ä¸ªå­—ç¬¦ä»£è¡¨æ–‡ä»¶ç±»å‹ï¼šæ–‡ä»¶ <span class="hljs-comment">(-)</span>,ç›®å½•<span class="hljs-comment">(d)</span>,é“¾æ¥<span class="hljs-comment">(l)</span>,å­—ç¬¦è®¾å¤‡æ–‡ä»¶<span class="hljs-comment">(c)</span>,å—è®¾å¤‡<span class="hljs-comment">(b)</span><br>å…¶ä½™å­—ç¬¦æ¯ <span class="hljs-number">3</span> ä¸ªä¸€ç»„<span class="hljs-comment">(rwx)</span> è¯»<span class="hljs-comment">(r)</span> å†™<span class="hljs-comment">(w)</span> æ‰§è¡Œ<span class="hljs-comment">(x)</span><br>ç¬¬ä¸€ç»„rwx: æ–‡ä»¶æ‹¥æœ‰è€…çš„æƒé™æ˜¯è¯»ã€å†™å’Œæ‰§è¡Œ<br>ç¬¬äºŒç»„rw-: ä¸æ–‡ä»¶æ‹¥æœ‰è€…åŒä¸€ç»„çš„ç”¨æˆ·çš„æƒé™æ˜¯è¯»ã€å†™ä½†ä¸èƒ½æ‰§è¡Œ<br>ç¬¬ä¸‰ç»„r--: ä¸ä¸æ–‡ä»¶æ‹¥æœ‰è€…åŒç»„çš„å…¶ä»–ç”¨æˆ·çš„æƒé™æ˜¯è¯»ä¸èƒ½å†™å’Œæ‰§è¡Œ<br>å¯ç”¨æ•°å­—è¡¨ç¤ºä¸º:r= <span class="hljs-number">4</span> ,w= <span class="hljs-number">2</span> ,x= <span class="hljs-number">1</span> å› æ­¤rwx= <span class="hljs-number">4</span> + <span class="hljs-number">2</span> + <span class="hljs-number">1</span> = <span class="hljs-number">7</span><br><br><span class="hljs-number">1</span>           æ–‡ä»¶ï¼šç¡¬è¿æ¥æ•°æˆ– ç›®å½•ï¼šå­ç›®å½•æ•°ï¼ˆè¯¥ç›®å½•ä¸‹ä¸€çº§çš„å­ç›®å½•æ•°,æ³¨æ„ç©ºç›®å½•ä¸‹ä¹Ÿæœ‰ . å’Œ .. ä»£è¡¨å½“å‰ç›®å½•å’Œä¸Šä¸€çº§ç›®å½•ï¼‰<br>root æ‰€å±ç”¨æˆ·<br>root        æ‰€å±ç»„<br><span class="hljs-number">1213</span> æ–‡ä»¶å¤§å°<span class="hljs-comment">(å­—èŠ‚)</span>ï¼Œå¦‚æœæ˜¯æ–‡ä»¶å¤¹ï¼Œæ˜¾ç¤º <span class="hljs-number">4096</span> å­—èŠ‚<br>Feb <span class="hljs-number">2</span> <span class="hljs-number">09</span>:<span class="hljs-number">39</span> æœ€åä¿®æ”¹æ—¥æœŸ<br>abc         æ–‡ä»¶å<br></code></pre></td></tr></table></figure><h3 id="10-9-ä¿®æ”¹æƒé™"><a href="#10-9-ä¿®æ”¹æƒé™" class="headerlink" title="10.9 ä¿®æ”¹æƒé™"></a>10.9 ä¿®æ”¹æƒé™</h3><p>åŸºæœ¬è¯´æ˜ï¼šé€šè¿‡chmodæŒ‡ä»¤ï¼Œå¯ä»¥ä¿®æ”¹æ–‡ä»¶æˆ–è€…ç›®å½•çš„æƒé™</p><h4 id="10-9-1-ç¬¬ä¸€ç§æ–¹å¼ï¼š-ã€-ã€-å˜æ›´æƒé™"><a href="#10-9-1-ç¬¬ä¸€ç§æ–¹å¼ï¼š-ã€-ã€-å˜æ›´æƒé™" class="headerlink" title="10.9.1 ç¬¬ä¸€ç§æ–¹å¼ï¼š+ã€-ã€=å˜æ›´æƒé™"></a>10.9.1 ç¬¬ä¸€ç§æ–¹å¼ï¼š+ã€-ã€=å˜æ›´æƒé™</h4><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs perl">u:æ‰€æœ‰è€… g:æ‰€æœ‰ç»„ o:å…¶ä»–äºº a:æ‰€æœ‰äºº(uã€gã€oçš„æ€»å’Œ)<br><span class="hljs-number">1</span> )<span class="hljs-keyword">chmod</span> u=rwx,g=rx,o=<span class="hljs-keyword">x</span> æ–‡ä»¶ç›®å½•å<br><span class="hljs-number">2</span> )<span class="hljs-keyword">chmod</span> o+w æ–‡ä»¶ç›®å½•å<br><span class="hljs-number">3</span> )<span class="hljs-keyword">chmod</span> a-<span class="hljs-keyword">x</span> æ–‡ä»¶ç›®å½•å<br></code></pre></td></tr></table></figure><p>æ¡ˆä¾‹æ¼”ç¤º<br>æ¡ˆä¾‹1ï¼š ç»™abcæ–‡ä»¶ çš„æ‰€æœ‰è€…è¯»å†™æ‰§è¡Œçš„æƒé™ï¼Œç»™æ‰€åœ¨ç»„è¯»æ‰§è¡Œæƒé™ï¼Œç»™å…¶å®ƒç»„è¯»æ‰§è¡Œæƒé™ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">chmod u=rwx,g=rx,o=rx abc<br></code></pre></td></tr></table></figure><p>æ¡ˆä¾‹2ï¼š ç»™abcæ–‡ä»¶çš„æ‰€æœ‰è€…é™¤å»æ‰§è¡Œçš„æƒé™ï¼Œå¢åŠ ç»„å†™çš„æƒé™</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">chmod u-x,g+w abc<br></code></pre></td></tr></table></figure><p>æ¡ˆä¾‹3ï¼š ç»™abcæ–‡ä»¶çš„æ‰€æœ‰ç”¨æˆ·æ·»åŠ è¯»çš„æƒé™</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">chmod a+r abc<br></code></pre></td></tr></table></figure><h4 id="10-9-2-ç¬¬äºŒç§æ–¹å¼ï¼šé€šè¿‡æ•°å­—å˜æ›´æƒé™"><a href="#10-9-2-ç¬¬äºŒç§æ–¹å¼ï¼šé€šè¿‡æ•°å­—å˜æ›´æƒé™" class="headerlink" title="10.9.2 ç¬¬äºŒç§æ–¹å¼ï¼šé€šè¿‡æ•°å­—å˜æ›´æƒé™"></a>10.9.2 ç¬¬äºŒç§æ–¹å¼ï¼šé€šè¿‡æ•°å­—å˜æ›´æƒé™</h4><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs tap">è§„åˆ™ï¼šr=<span class="hljs-number"> 4 </span>w=<span class="hljs-number"> 2 </span>x=<span class="hljs-number"> 1 </span>,rwx=<span class="hljs-number"> 4 </span>+<span class="hljs-number"> 2 </span>+<span class="hljs-number"> 1 </span>= 7<br>chmodu=rwx,g=rx,o=x æ–‡ä»¶ç›®å½•å<br>ç›¸å½“äº chmod<span class="hljs-number"> 751 </span>æ–‡ä»¶ç›®å½•å<br></code></pre></td></tr></table></figure><p>æ¡ˆä¾‹æ¼”ç¤º</p><p>æ¡ˆä¾‹ï¼šå°† /home/abc.txt æ–‡ä»¶çš„æƒé™ä¿®æ”¹æˆ rwxr-xr-x, ä½¿ç”¨ç»™æ•°å­—çš„æ–¹å¼å®ç°ï¼š<br>            rwx= 4 + 2 + 1 = 7<br>            r-x= 4 + 1 = 5<br>            r-x= 4 + 1 = 5</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">chmod 755 /home/abc.txt<br></code></pre></td></tr></table></figure><h3 id="10-10-ä¿®æ”¹æ–‡ä»¶-ç›®å½•æ‰€æœ‰è€…"><a href="#10-10-ä¿®æ”¹æ–‡ä»¶-ç›®å½•æ‰€æœ‰è€…" class="headerlink" title="10.10 ä¿®æ”¹æ–‡ä»¶/ç›®å½•æ‰€æœ‰è€…"></a>10.10 ä¿®æ”¹æ–‡ä»¶/ç›®å½•æ‰€æœ‰è€…</h3><p>åŸºæœ¬è¯­æ³•ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">chown newowner file           #æ”¹å˜æ–‡ä»¶/ç›®å½•çš„æ‰€æœ‰è€…<br>chown newowner:newgroup file  #æ”¹å˜æ–‡ä»¶/ç›®å½•çš„æ‰€æœ‰è€…å’Œæ‰€æœ‰ç»„<br></code></pre></td></tr></table></figure><p>å¸¸ç”¨é€‰é¡¹ï¼š</p><ul><li>-R å¦‚æœæ˜¯ç›®å½• åˆ™ä½¿å…¶ä¸‹æ‰€æœ‰å­æ–‡ä»¶æˆ–ç›®å½•é€’å½’ç”Ÿæ•ˆ</li></ul><p>æ¡ˆä¾‹æ¼”ç¤ºï¼š</p><p>æ¡ˆä¾‹1ï¼šè¯·å°† /home/abc.txt æ–‡ä»¶çš„æ‰€æœ‰è€…ä¿®æ”¹æˆ tom</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">chmod tom abc.txt<br></code></pre></td></tr></table></figure><p>æ¡ˆä¾‹2ï¼šè¯·å°† /home/kkk ç›®å½•ä¸‹æ‰€æœ‰çš„æ–‡ä»¶å’Œç›®å½•çš„æ‰€æœ‰è€…éƒ½ä¿®æ”¹æˆtomï¼Œé¦–é€‰æˆ‘ä»¬åº”è¯¥ä½¿ç”¨rootæ“ä½œã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">chmod -R tom /home/kkk<br></code></pre></td></tr></table></figure><h3 id="10-11-ä¿®æ”¹æ–‡ä»¶-ç›®å½•æ‰€åœ¨ç»„"><a href="#10-11-ä¿®æ”¹æ–‡ä»¶-ç›®å½•æ‰€åœ¨ç»„" class="headerlink" title="10.11 ä¿®æ”¹æ–‡ä»¶/ç›®å½•æ‰€åœ¨ç»„"></a>10.11 ä¿®æ”¹æ–‡ä»¶/ç›®å½•æ‰€åœ¨ç»„</h3><p>åŸºæœ¬è¯­æ³•ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">chgrp newgroup file æ”¹å˜æ–‡ä»¶/ç›®å½•çš„æ‰€åœ¨ç»„<br></code></pre></td></tr></table></figure><p>æ¡ˆä¾‹æ¼”ç¤ºï¼š</p><p>æ¡ˆä¾‹1ï¼šè¯·å°† /home/abc.txt æ–‡ä»¶çš„æ‰€åœ¨ç»„ä¿®æ”¹æˆ bandit(åœŸåŒª)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">chgrp bandit /home/abc.txt<br></code></pre></td></tr></table></figure><p>æ¡ˆä¾‹2ï¼šè¯·å°† /home/kkk ç›®å½•ä¸‹æ‰€æœ‰çš„æ–‡ä»¶å’Œç›®å½•çš„æ‰€åœ¨ç»„éƒ½ä¿®æ”¹æˆ bandit(åœŸåŒª)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">chgrp -R bandit /home/kkk<br></code></pre></td></tr></table></figure><h3 id="10-12-æœ€ä½³å®è·µ-è­¦å¯Ÿå’ŒåœŸåŒªæ¸¸æˆ"><a href="#10-12-æœ€ä½³å®è·µ-è­¦å¯Ÿå’ŒåœŸåŒªæ¸¸æˆ" class="headerlink" title="10.12 æœ€ä½³å®è·µ-è­¦å¯Ÿå’ŒåœŸåŒªæ¸¸æˆ"></a>10.12 æœ€ä½³å®è·µ-è­¦å¯Ÿå’ŒåœŸåŒªæ¸¸æˆ</h3><p>police ,bandit<br>jack,jerry: è­¦å¯Ÿ<br>xh,xq: åœŸåŒª<br>( 1 )åˆ›å»ºç»„</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">groupadd police<br>groupadd bandit<br></code></pre></td></tr></table></figure><p>( 2 )åˆ›å»ºç”¨æˆ·</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">useradd -g police jack<br>useradd -g police jerry<br>useradd -g bandit xh<br>useradd -g bandit xq<br></code></pre></td></tr></table></figure><p>( 3 ) jack åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œè‡ªå·±å¯ä»¥è¯»å†™ï¼Œæœ¬ç»„äººå¯ä»¥è¯»ï¼Œå…¶å®ƒç»„æ²¡äººä»»ä½•æƒé™</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">su - jack<br>touch jack.txt<br>chmod 640 jack.txt<br></code></pre></td></tr></table></figure><p>( 4 )jack ä¿®æ”¹è¯¥æ–‡ä»¶ï¼Œè®©å…¶å®ƒç»„äººå¯ä»¥è¯», æœ¬ç»„äººå¯ä»¥è¯»å†™</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">chmod 664 jack.txt<br></code></pre></td></tr></table></figure><p>( 5 )xh æŠ•é è­¦å¯Ÿï¼Œçœ‹çœ‹æ˜¯å¦å¯ä»¥è¯»å†™</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">usermod -g police xh<br></code></pre></td></tr></table></figure><h3 id="10-13-è¯¾åç»ƒä¹ "><a href="#10-13-è¯¾åç»ƒä¹ " class="headerlink" title="10.13 è¯¾åç»ƒä¹ "></a>10.13 è¯¾åç»ƒä¹ </h3><p>å»ºç«‹ä¸¤ä¸ªç»„ï¼ˆç¥ä»™,å¦–æ€ªï¼‰</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">groupadd shenxian <br>groupadd yaoguai<br></code></pre></td></tr></table></figure><p>å»ºç«‹å››ä¸ªç”¨æˆ·(å”åƒ§,æ‚Ÿç©ºï¼Œå…«æˆ’ï¼Œæ²™åƒ§)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">useradd tang<br>useradd wu<br>useradd ba<br>useradd sha<br></code></pre></td></tr></table></figure><p>è®¾ç½®å¯†ç </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">passwd tang<br>passwd wu<br>passwd ba<br>passwd sha<br></code></pre></td></tr></table></figure><p>æŠŠæ‚Ÿç©ºï¼Œå…«æˆ’æ”¾å…¥å¦–æ€ª å”åƒ§ æ²™åƒ§ åœ¨ç¥ä»™</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">usermod -g yaoguai wu<br>usermod -g yaoguai ba<br>usermod -g shenxian tang<br>usermod -g shenxian sha<br></code></pre></td></tr></table></figure><p>ç”¨æ‚Ÿç©ºå»ºç«‹ä¸€ä¸ªæ–‡ä»¶ ï¼ˆmonkey.java è¯¥æ–‡ä»¶è¦è¾“å‡º iammonkeyï¼‰</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">su - wu<br>touch monkey.java<br>echo ianmonkey &gt; monkey.java<br></code></pre></td></tr></table></figure><p>ç»™å…«æˆ’ä¸€ä¸ªå¯ä»¥rw çš„æƒé™</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">chmod 760 monkey.java<br>chmod 777 /home/wu<br></code></pre></td></tr></table></figure><p>å…«æˆ’ä¿®æ”¹monkey.java åŠ å…¥ä¸€å¥è¯(iampig)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">echo iampig &gt;&gt; monkey.java<br></code></pre></td></tr></table></figure><p>å”åƒ§ æ²™åƒ§ å¯¹è¯¥æ–‡ä»¶æ²¡æœ‰æƒé™,æŠŠ æ²™åƒ§ æ”¾å…¥å¦–æ€ªç»„</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">usermod -g yaoguai sha<br>reboot #é‡æ–°ç™»å½•ï¼Œåˆ·æ–°ç™»å½•ä¿¡æ¯<br></code></pre></td></tr></table></figure><p>è®©æ²™åƒ§ ä¿®æ”¹ è¯¥æ–‡ä»¶ monkey, åŠ å…¥ä¸€å¥è¯ (â€œæˆ‘æ˜¯æ²™åƒ§ï¼Œæˆ‘æ˜¯å¦–æ€ª!â€);</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">echo &quot;æˆ‘æ˜¯æ²™åƒ§ï¼Œæˆ‘æ˜¯å¦–æ€ªï¼&quot; &gt;&gt; monkey.java<br></code></pre></td></tr></table></figure><h2 id="åä¸€ã€crond-ä»»åŠ¡è°ƒåº¦"><a href="#åä¸€ã€crond-ä»»åŠ¡è°ƒåº¦" class="headerlink" title="åä¸€ã€crond ä»»åŠ¡è°ƒåº¦"></a>åä¸€ã€crond ä»»åŠ¡è°ƒåº¦</h2><h3 id="11-1-åŸç†ç¤ºæ„å›¾"><a href="#11-1-åŸç†ç¤ºæ„å›¾" class="headerlink" title="11.1 åŸç†ç¤ºæ„å›¾"></a>11.1 åŸç†ç¤ºæ„å›¾</h3><p>crontab è¿›è¡Œå®šæ—¶ä»»åŠ¡çš„è®¾ç½®ã€‚</p><p>ä»»åŠ¡è°ƒåº¦ï¼šæ˜¯æŒ‡ç³»ç»Ÿåœ¨æŸä¸ªæ—¶é—´æ‰§è¡Œçš„ç‰¹å®šçš„å‘½ä»¤æˆ–ç¨‹åºã€‚<br>ä»»åŠ¡è°ƒåº¦åˆ†ç±»ï¼š</p><p>1 .ç³»ç»Ÿå·¥ä½œï¼šæœ‰äº›é‡è¦çš„å·¥ä½œå¿…é¡»å‘¨è€Œå¤å§‹åœ°æ‰§è¡Œã€‚å¦‚ç—…æ¯’æ‰«æç­‰</p><p>2 .ä¸ªåˆ«ç”¨æˆ·å·¥ä½œï¼šä¸ªåˆ«ç”¨æˆ·å¯èƒ½å¸Œæœ›æ‰§è¡ŒæŸäº›ç¨‹åºï¼Œæ¯”å¦‚å¯¹mysqlæ•°æ®åº“çš„å¤‡ä»½ã€‚</p><p>åŸºæœ¬è¯­æ³•:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">crontab [é€‰é¡¹]<br></code></pre></td></tr></table></figure><p>å¸¸ç”¨é€‰é¡¹:</p><ul><li>-e: ç¼–è¾‘crontabå®šæ—¶ä»»åŠ¡</li><li>-l: æŸ¥è¯¢crontabä»»åŠ¡</li><li>-r: åˆ é™¤å½“å‰ç”¨æˆ·æ‰€æœ‰çš„crontabä»»åŠ¡</li></ul><h3 id="11-2-å¿«é€Ÿå…¥é—¨"><a href="#11-2-å¿«é€Ÿå…¥é—¨" class="headerlink" title="11.2 å¿«é€Ÿå…¥é—¨"></a>11.2 å¿«é€Ÿå…¥é—¨</h3><h4 id="11-2-1-ä»»åŠ¡çš„è¦æ±‚"><a href="#11-2-1-ä»»åŠ¡çš„è¦æ±‚" class="headerlink" title="11.2.1 ä»»åŠ¡çš„è¦æ±‚"></a>11.2.1 ä»»åŠ¡çš„è¦æ±‚</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs awk">è®¾ç½®ä»»åŠ¡è°ƒåº¦æ–‡ä»¶ï¼š<span class="hljs-regexp">/etc/</span>crontab<br>è®¾ç½®ä¸ªäººä»»åŠ¡è°ƒåº¦ã€‚æ‰§è¡Œcrontab â€“eå‘½ä»¤ã€‚<br>æ¥ç€è¾“å…¥ä»»åŠ¡åˆ°è°ƒåº¦æ–‡ä»¶<br>å¦‚ï¼šls â€“l <span class="hljs-regexp">/etc/</span> &gt; <span class="hljs-regexp">/tmp/</span>to.txt<br>æ„æ€è¯´æ¯å°æ—¶çš„æ¯åˆ†é’Ÿæ‰§è¡Œls â€“l<span class="hljs-regexp">/etc &gt; /</span>tmp/to.txtå‘½ä»¤<br></code></pre></td></tr></table></figure><h4 id="11-2-2-æ­¥éª¤å¦‚ä¸‹"><a href="#11-2-2-æ­¥éª¤å¦‚ä¸‹" class="headerlink" title="11.2.2 æ­¥éª¤å¦‚ä¸‹"></a>11.2.2 æ­¥éª¤å¦‚ä¸‹</h4><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">1 </span>) crontab -e<br><span class="hljs-symbol">2 </span>) */ <span class="hljs-number">1</span> * * * * ls -l /etc &gt; /tmp/<span class="hljs-keyword">to</span>.txt<br><span class="hljs-symbol">3 </span>) å½“ä¿å­˜é€€å‡ºåå°±ç¨‹åºã€‚<br><span class="hljs-symbol">4 </span>) åœ¨æ¯ä¸€åˆ†é’Ÿéƒ½ä¼šè‡ªåŠ¨çš„è°ƒç”¨ ls -l /etc &gt; /tmp/<span class="hljs-keyword">to</span>.txt<br></code></pre></td></tr></table></figure><h4 id="11-2-3-å‚æ•°ç»†èŠ‚è¯´æ˜"><a href="#11-2-3-å‚æ•°ç»†èŠ‚è¯´æ˜" class="headerlink" title="11.2.3 å‚æ•°ç»†èŠ‚è¯´æ˜"></a>11.2.3 å‚æ•°ç»†èŠ‚è¯´æ˜</h4><table><thead><tr><th>é¡¹ç›®</th><th>å«ä¹‰</th><th>èŒƒå›´</th></tr></thead><tbody><tr><td>ç¬¬ä¸€ä¸ª â€œ*â€</td><td>ä¸€ä¸ªå°æ—¶å½“ä¸­çš„ç¬¬å‡ åˆ†é’Ÿ</td><td>0-59</td></tr><tr><td>ç¬¬äºŒä¸ª â€*â€œ</td><td>ä¸€å¤©å½“ä¸­çš„ç¬¬å‡ å°æ—¶</td><td>0-23</td></tr><tr><td>ç¬¬ä¸‰ä¸ª â€*â€œ</td><td>ä¸€ä¸ªæœˆå½“ä¸­çš„ç¬¬å‡ å¤©</td><td>1-31</td></tr><tr><td>ç¬¬å››ä¸ª â€*â€œ</td><td>ä¸€å¹´å½“ä¸­çš„ç¬¬å‡ æœˆ</td><td>1-12</td></tr><tr><td>ç¬¬äº”ä¸ª â€*â€œ</td><td>ä¸€å‘¨å½“ä¸­çš„æ˜ŸæœŸå‡ </td><td>0-7ï¼ˆ0å’Œ7ä»£è¡¨æ˜ŸæœŸæ—¥ï¼‰</td></tr></tbody></table><h4 id="11-2-4-ç‰¹æ®Šç¬¦å·çš„è¯´æ˜"><a href="#11-2-4-ç‰¹æ®Šç¬¦å·çš„è¯´æ˜" class="headerlink" title="11.2.4 ç‰¹æ®Šç¬¦å·çš„è¯´æ˜"></a>11.2.4 ç‰¹æ®Šç¬¦å·çš„è¯´æ˜</h4><table><thead><tr><th>ç‰¹æ®Šç¬¦å·</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>*</td><td>ä»£è¡¨ä»»ä½•æ—¶é—´ã€‚æ¯”å¦‚ç¬¬ä¸€ä¸ªâ€*â€œå°±ä»£è¡¨ä¸€å°æ—¶ä¸­æ¯åˆ†é’Ÿéƒ½æ‰§è¡Œä¸€æ¬¡çš„æ„æ€</td></tr><tr><td>,</td><td>ä»£è¡¨ä¸è¿ç»­çš„æ—¶é—´ã€‚æ¯”å¦‚<code>0 8,12,16 * * * </code>å‘½ä»¤ï¼Œå°±ä»£è¡¨åœ¨æ¯å¤©çš„8ç‚¹0åˆ†ï¼Œ12ç‚¹0åˆ†ï¼Œ16ç‚¹0åˆ†éƒ½æ‰§è¡Œä¸€æ¬¡å‘½ä»¤</td></tr><tr><td>-</td><td>ä»£è¡¨è¿ç»­çš„æ—¶é—´èŒƒå›´ã€‚æ¯”å¦‚<code>0 5 * * 1-6</code>å‘½ä»¤ï¼Œä»£è¡¨åœ¨å‘¨ä¸€åˆ°å‘¨å…­çš„å‡Œæ™¨5ç‚¹0åˆ†æ‰§è¡Œå‘½ä»¤</td></tr><tr><td>*/n</td><td>ä»£è¡¨æ¯ä¸ªå¤šä¹…æ‰§è¡Œä¸€æ¬¡ã€‚æ¯”å¦‚<code>*/10 * * * *</code>å‘½ä»¤ï¼Œä»£è¡¨æ¯ä¸ª10åˆ†é’Ÿå°±æ‰§è¡Œä¸€éå‘½ä»¤</td></tr></tbody></table><h4 id="11-2-5-ç‰¹å®šæ—¶é—´æ‰§è¡Œä»»åŠ¡æ¡ˆä¾‹"><a href="#11-2-5-ç‰¹å®šæ—¶é—´æ‰§è¡Œä»»åŠ¡æ¡ˆä¾‹" class="headerlink" title="11.2.5 ç‰¹å®šæ—¶é—´æ‰§è¡Œä»»åŠ¡æ¡ˆä¾‹"></a>11.2.5 ç‰¹å®šæ—¶é—´æ‰§è¡Œä»»åŠ¡æ¡ˆä¾‹</h4><table><thead><tr><th>å‘½ä»¤</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td><code>45 22 * * * </code></td><td>æ¯å¤©22ç‚¹45åˆ†æ‰§è¡Œä»»åŠ¡</td></tr><tr><td><code>0 17 * * 1</code></td><td>æ¯å‘¨æ˜ŸæœŸä¸€0ç‚¹17åˆ†æ‰§è¡Œä»»åŠ¡</td></tr><tr><td><code>0 5 1,15 * * </code></td><td>æ¯æœˆ1å·å’Œ15å·çš„5ç‚¹0åˆ†æ‰§è¡Œä»»åŠ¡</td></tr><tr><td><code>40 4 * * 1-5</code></td><td>æ¯å‘¨ä¸€åˆ°å‘¨äº”çš„4ç‚¹40åˆ†æ‰§è¡Œä»»åŠ¡</td></tr><tr><td><code>*/10 4 * * * </code></td><td>æ¯å¤©4ç‚¹æ¯éš”10åˆ†é’Ÿæ‰§è¡Œä»»åŠ¡</td></tr><tr><td><code>0 0 1,15 * 1</code></td><td>æ¯æœˆ1å·å’Œ5å·ï¼Œæ¯å‘¨ä¸€çš„0ç‚¹0åˆ†æ‰§è¡Œä»»åŠ¡ã€‚ï¼ˆè¿™é‡Œ1å·15å·ä¸å‘¨ä¸€å–å¹¶é›†ï¼‰</td></tr></tbody></table><p>æ³¨æ„ï¼šæ˜ŸæœŸå‡ å’Œå‡ å·æœ€å¥½ä¸è¦åŒæ—¶å‡ºç°ï¼Œå› ä¸ºä»–ä»¬å®šä¹‰çš„éƒ½æ˜¯å¤©ï¼Œéå¸¸å®¹æ˜“è®©ç®¡ç†å‘˜æ··ä¹±ã€‚</p><p><a href="https://tool.lu/crontab/">crontabå®šæ—¶ä»»åŠ¡è§£æç½‘ç«™</a></p><h4 id="11-2-4-ä»»åŠ¡è°ƒåº¦çš„å‡ ä¸ªåº”ç”¨å®ä¾‹"><a href="#11-2-4-ä»»åŠ¡è°ƒåº¦çš„å‡ ä¸ªåº”ç”¨å®ä¾‹" class="headerlink" title="11.2.4 ä»»åŠ¡è°ƒåº¦çš„å‡ ä¸ªåº”ç”¨å®ä¾‹"></a>11.2.4 ä»»åŠ¡è°ƒåº¦çš„å‡ ä¸ªåº”ç”¨å®ä¾‹</h4><p>æ¡ˆä¾‹ 1 ï¼šæ¯éš” 1 åˆ†é’Ÿï¼Œå°±å°†å½“å‰çš„æ—¥æœŸä¿¡æ¯ï¼Œè¿½åŠ åˆ° /tmp/mydateæ–‡ä»¶ä¸­</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs arcade">crontab -e<br>*<span class="hljs-regexp">/1 * * * * date &gt;&gt; /</span>tmp/mydate<br></code></pre></td></tr></table></figure><p>æ¡ˆä¾‹ 2 ï¼šæ¯éš” 1 åˆ†é’Ÿï¼Œ å°†å½“å‰æ—¥æœŸå’Œæ—¥å†éƒ½è¿½åŠ åˆ° /home/mycalæ–‡ä»¶ä¸­</p><figure class="highlight qml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs qml">vim my.sh<br><span class="hljs-built_in">date</span> &gt;&gt; <span class="hljs-regexp">/home/my</span>cal<br>cal &gt;&gt; <span class="hljs-regexp">/home/my</span>cal<br><br>chmod <span class="hljs-number">777</span> home/my.sh<br><br>crontab -e<br>*<span class="hljs-regexp">/1 * * * * home/my</span>.sh<br></code></pre></td></tr></table></figure><p>æ¡ˆä¾‹ 3 : æ¯å¤©å‡Œæ™¨ 2 : 00 å°†mysqlæ•°æ®åº“testdb ï¼Œå¤‡ä»½åˆ°æ–‡ä»¶ä¸­ mydb.bakã€‚æç¤ºï¼šæŒ‡ä»¤ä¸º<code>mysqldump -u root -på¯†ç  æ•°æ®åº“ &gt; /home/db.bak</code></p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs arcade">crontab -e<br><span class="hljs-number">0</span> <span class="hljs-number">2</span> * * * mysqldump -u root -proot testdb &gt; <span class="hljs-regexp">/home/</span>db.bak<br></code></pre></td></tr></table></figure><h3 id="11-3-crond-ç›¸å…³æŒ‡ä»¤"><a href="#11-3-crond-ç›¸å…³æŒ‡ä»¤" class="headerlink" title="11.3 crond ç›¸å…³æŒ‡ä»¤"></a>11.3 crond ç›¸å…³æŒ‡ä»¤</h3><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">1 </span>) conrtab â€“rï¼šç»ˆæ­¢ä»»åŠ¡è°ƒåº¦(å°±æ˜¯åˆ é™¤ä»»åŠ¡ï¼‰ã€‚<br><span class="hljs-symbol">2 </span>) crontab â€“lï¼šåˆ—å‡ºå½“å‰æœ‰é‚£äº›ä»»åŠ¡è°ƒåº¦<br><span class="hljs-symbol">3 </span>) service crond restart   [é‡å¯ä»»åŠ¡è°ƒåº¦]<br></code></pre></td></tr></table></figure><h3 id="11-4-atå®šæ—¶ä»»åŠ¡"><a href="#11-4-atå®šæ—¶ä»»åŠ¡" class="headerlink" title="11.4 atå®šæ—¶ä»»åŠ¡"></a>11.4 atå®šæ—¶ä»»åŠ¡</h3><p>åŸºæœ¬ä»‹ç»ï¼š</p><ol><li>atå‘½ä»¤æ˜¯ä¸€æ¬¡æ€§å®šæ—¶è®¡åˆ’ä»»åŠ¡ï¼Œatçš„å®ˆæŠ¤è¿›è¡Œatdä¼šä»¥åå°æ¨¡å¼è¿è¡Œï¼Œæ£€æŸ¥ä½œä¸šé˜Ÿåˆ—æ¥è¿è¡Œã€‚</li><li>é»˜è®¤æƒ…å†µä¸‹ï¼Œatdå®ˆæŠ¤è¿›è¡Œæ¯60ç§’æ£€æŸ¥<strong>ä½œä¸šé˜Ÿåˆ—</strong>ï¼Œæœ‰ä½œä¸šæ—¶ï¼Œä¼šæ£€æŸ¥ä½œä¸šè¿è¡Œæ—¶é—´ï¼Œå¦‚æœæ—¶é—´ä¸å½“å‰æ—¶é—´åŒ¹é…ï¼Œåˆ™è¿è¡Œæ­¤ä½œä¸šã€‚</li><li>atå‘½ä»¤æ˜¯ä¸€æ¬¡æ€§å®šæ—¶è®¡åˆ’ä»»åŠ¡ï¼Œæ‰§è¡Œå®Œä¸€ä¸ªä»»åŠ¡åä¸å†æ‰§è¡Œæ­¤ä»»åŠ¡äº†</li><li>åœ¨ä½¿ç”¨atå‘½ä»¤çš„æ—¶å€™ï¼Œä¸€å®šè¦ä¿è¯atdè¿›ç¨‹çš„å¯åŠ¨ï¼Œå¯ä»¥ä½¿ç”¨ç›¸å…³æŒ‡ä»¤æ¥æŸ¥çœ‹ã€‚<code>ps -ef | grep atd</code>å¯ä»¥æ£€æµ‹atdæ˜¯å¦åœ¨è¿è¡Œã€‚</li></ol><p>åŸºæœ¬è¯­æ³•ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">at [é€‰é¡¹] [æ—¶é—´]<br>Ctrl + D ç»“æŸatå‘½ä»¤çš„è¾“å…¥(ä¸¤æ¬¡æŒ‰Ctrl + D)<br></code></pre></td></tr></table></figure><p>é€‰é¡¹è¯´æ˜ï¼š</p><table><thead><tr><th>é€‰é¡¹</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>-m</td><td>å½“æŒ‡å®šçš„ä»»åŠ¡è¢«å®Œæˆåï¼Œå°†ç»™ç”¨æˆ·å‘é€é‚®ä»¶ï¼Œå³ä½¿æ²¡æœ‰æ ‡å‡†è¾“å‡º</td></tr><tr><td><code>-I</code></td><td>atqçš„åˆ«åï¼ˆæŸ¥è¯¢ï¼‰</td></tr><tr><td>-d</td><td>atrmçš„åˆ«åï¼ˆåˆ é™¤ï¼‰</td></tr><tr><td>-v</td><td>æ˜¾ç¤ºä»»åŠ¡å°†è¢«æ‰§è¡Œçš„æ—¶é—´</td></tr><tr><td>-c</td><td>æ‰“å°ä»»åŠ¡çš„å†…å®¹åˆ°æ ‡å‡†è¾“å‡º</td></tr><tr><td>-V</td><td>æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯</td></tr><tr><td>-q &lt;é˜Ÿåˆ—&gt;</td><td>ä½¿ç”¨æŒ‡å®šçš„é˜Ÿåˆ—</td></tr><tr><td>-f &lt;æ–‡ä»¶&gt;</td><td>ä»æŒ‡å®šæ–‡ä»¶è¯»å…¥ä»»åŠ¡è€Œä¸æ˜¯ä»æ ‡å‡†è¾“å…¥è¯»å…¥</td></tr><tr><td>-t &lt;æ—¶é—´å‚æ•°&gt;</td><td>ä»¥æ—¶é—´å‚æ•°çš„å½¢å¼æäº¤è¦è¿è¡Œçš„ä»»åŠ¡</td></tr></tbody></table><p>atæ—¶é—´å®šä¹‰ï¼š</p><ol><li>æ¥å—åœ¨å½“å¤©hh:mmï¼ˆå°æ—¶ï¼šåˆ†é’Ÿï¼‰å¼çš„æ—¶é—´æŒ‡å®šã€‚å‡å¦‚è¯¥æ—¶é—´å·²ç»è¿‡å»ï¼Œé‚£ä¹ˆå°±æ”¾åœ¨ç¬¬äºŒå¤©æ‰§è¡Œã€‚ä¾‹å¦‚ï¼š04:00</li><li>ä½¿ç”¨midnightï¼ˆæ·±å¤œ)ï¼Œnoonï¼ˆä¸­åˆï¼‰ï¼Œteatimeï¼ˆé¥®èŒ¶æ—¶é—´ï¼Œä¸€èˆ¬æ˜¯ä¸‹åˆ4ç‚¹ï¼‰ç­‰æ¯”è¾ƒæ¨¡ç³Šçš„è¯è¯­æ¥æŒ‡å®šæ—¶é—´ã€‚</li><li>é‡‡ç”¨12å°æ—¶è®¡æ—¶åˆ¶ï¼Œå³åœ¨æ—¶é—´åé¢åŠ ä¸ŠAMï¼ˆä¸Šåˆï¼‰æˆ–è€…PMï¼ˆä¸‹åˆï¼‰æ¥è¯´æ˜æ˜¯ä¸Šåˆè¿˜æ˜¯ä¸‹åˆã€‚ä¾‹å¦‚12PM</li><li>æŒ‡å®šå‘½ä»¤æ‰§è¡Œçš„å…·ä½“æ—¥æœŸï¼ŒæŒ‡å®šæ ¼å¼ä¸ºmonth day ï¼ˆæœˆ æ—¥ï¼‰æˆ–è€… mm/dd/yyï¼ˆæœˆ/æ—¥/å¹´ï¼‰ æˆ–è€… dd.mm.yyï¼ˆæ—¥.æœˆ.å¹´ï¼‰ï¼ŒæŒ‡å®šçš„æ—¥æœŸå¿…é¡»è·Ÿåœ¨æŒ‡å®šæ—¶é—´çš„åé¢ã€‚ä¾‹å¦‚ï¼š04:00 2021-03-01</li><li>ä½¿ç”¨ç›¸å¯¹è®¡æ—¶æ³•ã€‚æŒ‡å®šæ ¼å¼ä¸ºï¼š now + count time-unitsï¼Œnowå°±æ˜¯å½“å‰æ—¶é—´ï¼Œtime-unitsæ˜¯æ—¶é—´å•ä½ï¼Œå‡ å¤©ï¼Œå‡ å°æ—¶ã€‚ä¾‹å¦‚ï¼šnow + 5 minutes</li><li>ç›´æ¥ä½¿ç”¨todayï¼ˆä»Šå¤©ï¼‰ã€tomorrowï¼ˆæ˜å¤©ï¼‰æ¥åˆ¶å®šå®Œæˆå‘½ä»¤çš„æ—¶é—´ã€‚</li></ol><p>åº”ç”¨å®ä¾‹ï¼š</p><p>å®ä¾‹1:2å¤©åçš„ä¸‹åˆ5ç‚¹æ‰§è¡Œ /bin/ls /home</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">at 5pm + 2 days<br><span class="hljs-meta">at&gt;</span><span class="bash"> /bin/ls /home</span><br></code></pre></td></tr></table></figure><p>æ¡ˆä¾‹2ï¼šatqå‘½ä»¤æ¥æŸ¥çœ‹ç³»ç»Ÿä¸­æ²¡æœ‰æ‰§è¡Œçš„å·¥ä½œä»»åŠ¡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">atq<br></code></pre></td></tr></table></figure><p>æ¡ˆä¾‹3ï¼šæ˜å¤©17ç‚¹é’Ÿï¼Œè¾“å‡ºæ—¶é—´åˆ°æŒ‡å®šæ–‡ä»¶å†…ï¼Œæ¯”å¦‚/root/date100.log</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">at 5pm tomorrow<br>date &gt;&gt; /root/date100.log<br></code></pre></td></tr></table></figure><p>æ¡ˆä¾‹4ï¼š2åˆ†é’Ÿåï¼Œè¾“å‡ºæ—¶é—´åˆ°æŒ‡å®šæ–‡ä»¶å†…ï¼Œæ¯”å¦‚/root/date200.log</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">at now + 2 minutes<br>date &gt;&gt; /root/date200.log<br></code></pre></td></tr></table></figure><p>æ¡ˆä¾‹5ï¼šåˆ é™¤å·²ç»è®¾ç½®çš„ä»»åŠ¡ï¼Œartmç¼–å·</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">atrm 1<br></code></pre></td></tr></table></figure><h2 id="åäºŒã€Linux-ç£ç›˜åˆ†åŒºã€æŒ‚è½½"><a href="#åäºŒã€Linux-ç£ç›˜åˆ†åŒºã€æŒ‚è½½" class="headerlink" title="åäºŒã€Linux ç£ç›˜åˆ†åŒºã€æŒ‚è½½"></a>åäºŒã€Linux ç£ç›˜åˆ†åŒºã€æŒ‚è½½</h2><h3 id="12-1-LINUXåˆ†åŒº"><a href="#12-1-LINUXåˆ†åŒº" class="headerlink" title="12.1 LINUXåˆ†åŒº"></a>12.1 LINUXåˆ†åŒº</h3><h4 id="12-1-1-åŸç†ä»‹ç»"><a href="#12-1-1-åŸç†ä»‹ç»" class="headerlink" title="12.1.1 åŸç†ä»‹ç»"></a>12.1.1 åŸç†ä»‹ç»</h4><ol><li><p>Linuxæ¥è¯´æ— è®ºæœ‰å‡ ä¸ªåˆ†åŒºï¼Œåˆ†ç»™å“ªä¸€ç›®å½•ä½¿ç”¨ï¼Œå®ƒå½’æ ¹ç»“åº•å°±åªæœ‰ä¸€ä¸ªæ ¹ç›®å½•ï¼Œä¸€ä¸ªç‹¬ç«‹ä¸”å”¯ä¸€çš„æ–‡ä»¶ç»“æ„ ,Linuxä¸­æ¯ä¸ªåˆ†åŒºéƒ½æ˜¯ç”¨æ¥ç»„æˆæ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†ã€‚</p></li><li><p>Linuxé‡‡ç”¨äº†ä¸€ç§å«â€œè½½å…¥â€çš„å¤„ç†æ–¹æ³•ï¼Œå®ƒçš„æ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿä¸­åŒ…å«äº†ä¸€æ•´å¥—çš„æ–‡ä»¶å’Œç›®å½•ï¼Œä¸”å°†ä¸€ä¸ªåˆ†åŒºå’Œä¸€ä¸ªç›®å½•è”ç³»èµ·æ¥ã€‚è¿™æ—¶è¦è½½å…¥çš„ä¸€ä¸ªåˆ†åŒºå°†ä½¿å®ƒçš„å­˜å‚¨ç©ºé—´åœ¨ä¸€ä¸ªç›®å½•ä¸‹è·å¾—ã€‚</p></li><li><p>ç¤ºæ„å›¾ï¼š</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20220223162138373.png"></p></li></ol><h4 id="12-1-2-ç¡¬ç›˜è¯´æ˜"><a href="#12-1-2-ç¡¬ç›˜è¯´æ˜" class="headerlink" title="12.1.2 ç¡¬ç›˜è¯´æ˜"></a>12.1.2 ç¡¬ç›˜è¯´æ˜</h4><ol><li>Linuxç¡¬ç›˜åˆ†IDEç¡¬ç›˜å’ŒSCSIç¡¬ç›˜ï¼Œç›®å‰åŸºæœ¬ä¸Šæ˜¯SCSIç¡¬ç›˜</li><li>å¯¹äºIDEç¡¬ç›˜ï¼Œé©±åŠ¨å™¨æ ‡è¯†ç¬¦ä¸ºâ€œhdx<del>â€,å…¶ä¸­â€œhdâ€è¡¨æ˜åˆ†åŒºæ‰€åœ¨è®¾å¤‡çš„ç±»å‹ï¼Œè¿™é‡Œæ˜¯æŒ‡IDEç¡¬ç›˜äº†ã€‚â€œxâ€ä¸ºç›˜å·ï¼ˆaä¸ºåŸºæœ¬ç›˜ï¼Œbä¸ºåŸºæœ¬ä»å±ç›˜ï¼Œcä¸ºè¾…åŠ©ä¸»ç›˜ï¼Œdä¸ºè¾…åŠ©ä»å±ç›˜ï¼‰,â€œ</del>â€ä»£è¡¨åˆ†åŒºï¼Œå‰å››ä¸ªåˆ†åŒºç”¨æ•°å­— 1 åˆ° 4 è¡¨ç¤ºï¼Œå®ƒä»¬æ˜¯ä¸»åˆ†åŒºæˆ–æ‰©å±•åˆ†åŒºï¼Œä» 5 å¼€å§‹å°±æ˜¯é€»è¾‘åˆ†åŒºã€‚ä¾‹ï¼Œhda 3 è¡¨ç¤ºä¸ºç¬¬ä¸€ä¸ªIDEç¡¬ç›˜ä¸Šçš„ç¬¬ä¸‰ä¸ªä¸»åˆ†åŒºæˆ–æ‰©å±•åˆ†åŒº,hdb 2 è¡¨ç¤ºä¸ºç¬¬äºŒä¸ªIDEç¡¬ç›˜ä¸Šçš„ç¬¬äºŒä¸ªä¸»åˆ†åŒºæˆ–æ‰©å±•åˆ†åŒºã€‚</li><li>å¯¹äºSCSIç¡¬ç›˜åˆ™æ ‡è¯†ä¸ºâ€œsdx~â€ï¼ŒSCSIç¡¬ç›˜æ˜¯ç”¨â€œsdâ€æ¥è¡¨ç¤ºåˆ†åŒºæ‰€åœ¨è®¾å¤‡çš„ç±»å‹çš„ï¼Œå…¶ä½™åˆ™å’ŒIDEç¡¬ç›˜çš„è¡¨ç¤ºæ–¹æ³•ä¸€æ ·ã€‚</li></ol><p>åˆ†åŒºçš„æ–¹å¼ï¼š</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">1 </span>)mbråˆ†åŒº:<br><span class="hljs-symbol">1 </span>.æœ€å¤šæ”¯æŒå››ä¸ªä¸»åˆ†åŒº<br><span class="hljs-symbol">2 </span>.ç³»ç»Ÿåªèƒ½å®‰è£…åœ¨ä¸»åˆ†åŒº<br><span class="hljs-symbol">3 </span>.æ‰©å±•åˆ†åŒºè¦å ä¸€ä¸ªä¸»åˆ†åŒº<br><span class="hljs-symbol">4 </span>.MBRæœ€å¤§åªæ”¯æŒ <span class="hljs-number">2</span> TBï¼Œä½†æ‹¥æœ‰æœ€å¥½çš„å…¼å®¹æ€§<br></code></pre></td></tr></table></figure><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">2 </span>)gtpåˆ†åŒº:<br><span class="hljs-symbol">1 </span>.æ”¯æŒæ— é™å¤šä¸ªä¸»åˆ†åŒºï¼ˆä½†æ“ä½œç³»ç»Ÿå¯èƒ½é™åˆ¶ï¼Œæ¯”å¦‚ windowsä¸‹æœ€å¤š <span class="hljs-number">128</span> ä¸ªåˆ†åŒºï¼‰<br><span class="hljs-symbol">2 </span>.æœ€å¤§æ”¯æŒ <span class="hljs-number">18</span> EBçš„å¤§å®¹é‡ï¼ˆ <span class="hljs-number">1</span> EB= <span class="hljs-number">1024</span> PBï¼Œ <span class="hljs-number">1</span> PB= <span class="hljs-number">1024</span> TB ï¼‰<br><span class="hljs-symbol">3 </span>.windows <span class="hljs-number">7</span> <span class="hljs-number">64</span> ä½ä»¥åæ”¯æŒgtp<br></code></pre></td></tr></table></figure><h4 id="12-1-3-ä½¿ç”¨lsblkæŒ‡ä»¤æŸ¥çœ‹å½“å‰ç³»ç»Ÿçš„åˆ†åŒºæƒ…å†µ"><a href="#12-1-3-ä½¿ç”¨lsblkæŒ‡ä»¤æŸ¥çœ‹å½“å‰ç³»ç»Ÿçš„åˆ†åŒºæƒ…å†µ" class="headerlink" title="12.1.3 ä½¿ç”¨lsblkæŒ‡ä»¤æŸ¥çœ‹å½“å‰ç³»ç»Ÿçš„åˆ†åŒºæƒ…å†µ"></a>12.1.3 ä½¿ç”¨lsblkæŒ‡ä»¤æŸ¥çœ‹å½“å‰ç³»ç»Ÿçš„åˆ†åŒºæƒ…å†µ</h4><p>åŸºæœ¬è¯­æ³•ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">lsblk æˆ–è€… lsblk -f<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20220223163636480.png"></p><h3 id="12-2-æŒ‚è½½çš„ç»å…¸æ¡ˆä¾‹"><a href="#12-2-æŒ‚è½½çš„ç»å…¸æ¡ˆä¾‹" class="headerlink" title="12.2 æŒ‚è½½çš„ç»å…¸æ¡ˆä¾‹"></a>12.2 æŒ‚è½½çš„ç»å…¸æ¡ˆä¾‹</h3><p>éœ€æ±‚æ˜¯ç»™æˆ‘ä»¬çš„Linuxç³»ç»Ÿå¢åŠ ä¸€ä¸ªæ–°çš„ç¡¬ç›˜ï¼Œå¹¶ä¸”æŒ‚è½½åˆ°/home/newdisk</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-number">1</span> )è™šæ‹Ÿæœºæ·»åŠ ç¡¬ç›˜<br><span class="hljs-number">2</span> )åˆ†åŒº fdisk<span class="hljs-regexp">/dev/</span>sdb<br><span class="hljs-number">3</span> )æ ¼å¼åŒ– mkfs -text <span class="hljs-number">4</span> <span class="hljs-regexp">/dev/</span>sdb <span class="hljs-number">1</span><br><span class="hljs-number">4</span> )æŒ‚è½½ å…ˆåˆ›å»ºä¸€ä¸ª <span class="hljs-regexp">/home/</span>newdisk , æŒ‚è½½ mount <span class="hljs-regexp">/dev/</span>sdb <span class="hljs-number">1</span> <span class="hljs-regexp">/home/</span>newdisk<br><span class="hljs-number">5</span> )è®¾ç½®å¯ä»¥è‡ªåŠ¨æŒ‚è½½(æ°¸ä¹…æŒ‚è½½ï¼Œå½“ä½ é‡å¯ç³»ç»Ÿï¼Œä»ç„¶å¯ä»¥æŒ‚è½½åˆ° <span class="hljs-regexp">/home/</span>newdisk) ã€‚<br>vim <span class="hljs-regexp">/etc/</span>fstab<br><span class="hljs-regexp">/dev/</span>sdb <span class="hljs-number">1</span> <span class="hljs-regexp">/home/</span>newdisk ext <span class="hljs-number">4</span> defaults <span class="hljs-number">00</span><br></code></pre></td></tr></table></figure><h4 id="12-2-1-è™šæ‹Ÿæœºå¢åŠ ç¡¬ç›˜æ­¥éª¤-1"><a href="#12-2-1-è™šæ‹Ÿæœºå¢åŠ ç¡¬ç›˜æ­¥éª¤-1" class="headerlink" title="12.2.1 è™šæ‹Ÿæœºå¢åŠ ç¡¬ç›˜æ­¥éª¤ 1"></a>12.2.1 è™šæ‹Ÿæœºå¢åŠ ç¡¬ç›˜æ­¥éª¤ 1</h4><p>åœ¨ã€è™šæ‹Ÿæœºã€‘èœå•ä¸­ï¼Œé€‰æ‹©ã€è®¾ç½®ã€‘ï¼Œç„¶åè®¾å¤‡åˆ—è¡¨é‡Œæ·»åŠ ç¡¬ç›˜ï¼Œç„¶åä¸€è·¯ã€ä¸‹ä¸€æ­¥ã€‘ï¼Œä¸­é—´åªæœ‰é€‰æ‹©ç£ç›˜å¤§å°çš„åœ°æ–¹éœ€è¦ä¿®æ”¹ï¼Œè‡³åˆ°å®Œæˆã€‚ç„¶åé‡å¯ç³»ç»Ÿï¼ˆæ‰èƒ½è¯†åˆ«ï¼‰ï¼</p><h4 id="12-2-2-è™šæ‹Ÿæœºå¢åŠ ç¡¬ç›˜æ­¥éª¤-2"><a href="#12-2-2-è™šæ‹Ÿæœºå¢åŠ ç¡¬ç›˜æ­¥éª¤-2" class="headerlink" title="12.2.2 è™šæ‹Ÿæœºå¢åŠ ç¡¬ç›˜æ­¥éª¤ 2"></a>12.2.2 è™šæ‹Ÿæœºå¢åŠ ç¡¬ç›˜æ­¥éª¤ 2</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">åˆ†åŒºå‘½ä»¤ fdisk <span class="hljs-regexp">/dev/</span>sdb<br>å¼€å§‹å¯¹/sdbåˆ†åŒº<br></code></pre></td></tr></table></figure><ul><li>m æ˜¾ç¤ºå‘½ä»¤åˆ—è¡¨</li><li>p æ˜¾ç¤ºç£ç›˜åˆ†åŒº åŒ <code>fdisk â€“l</code></li><li>n æ–°å¢åˆ†åŒº</li><li>d åˆ é™¤åˆ†åŒº</li><li>w å†™å…¥å¹¶é€€å‡º<br>è¯´æ˜ï¼š å¼€å§‹åˆ†åŒºåè¾“å…¥nï¼Œæ–°å¢åˆ†åŒºï¼Œç„¶åé€‰æ‹©p ï¼Œåˆ†åŒºç±»å‹ä¸ºä¸»åˆ†åŒºã€‚ä¸¤æ¬¡å›è½¦é»˜è®¤å‰©ä½™å…¨éƒ¨ç©ºé—´ã€‚æœ€åè¾“å…¥wå†™å…¥åˆ†åŒºå¹¶é€€å‡ºï¼Œè‹¥ä¸ä¿å­˜é€€å‡ºè¾“å…¥qã€‚</li></ul><h4 id="12-2-3-è™šæ‹Ÿæœºå¢åŠ ç¡¬ç›˜æ­¥éª¤-3"><a href="#12-2-3-è™šæ‹Ÿæœºå¢åŠ ç¡¬ç›˜æ­¥éª¤-3" class="headerlink" title="12.2.3 è™šæ‹Ÿæœºå¢åŠ ç¡¬ç›˜æ­¥éª¤ 3"></a>12.2.3 è™šæ‹Ÿæœºå¢åŠ ç¡¬ç›˜æ­¥éª¤ 3</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">æ ¼å¼åŒ–ç£ç›˜<br>åˆ†åŒºå‘½ä»¤:mkfs -t ext4 <span class="hljs-regexp">/dev/</span>sdb1<br>å…¶ä¸­ ext4 æ˜¯åˆ†åŒºç±»å‹<br></code></pre></td></tr></table></figure><h4 id="12-2-4-è™šæ‹Ÿæœºå¢åŠ ç¡¬ç›˜æ­¥éª¤-4"><a href="#12-2-4-è™šæ‹Ÿæœºå¢åŠ ç¡¬ç›˜æ­¥éª¤-4" class="headerlink" title="12.2.4 è™šæ‹Ÿæœºå¢åŠ ç¡¬ç›˜æ­¥éª¤ 4"></a>12.2.4 è™šæ‹Ÿæœºå¢åŠ ç¡¬ç›˜æ­¥éª¤ 4</h4><p>æŒ‚è½½: å°†ä¸€ä¸ªåˆ†åŒºä¸ä¸€ä¸ªç›®å½•è”ç³»èµ·æ¥ã€‚</p><p>æŒ‚è½½åŸºæœ¬è¯­æ³•ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">mount è®¾å¤‡åç§° æŒ‚è½½ç›®å½•<br>ä¾‹å¦‚ï¼š mount /dev/sdb1 /newdisk<br></code></pre></td></tr></table></figure><p>å¸è½½åŸºæœ¬è¯­æ³•ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">umount è®¾å¤‡åç§° æˆ–è€… æŒ‚è½½ç›®å½•<br>ä¾‹å¦‚ï¼š umount /dev/sdb1 æˆ–è€… umount /newdisk<br></code></pre></td></tr></table></figure><p><strong>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨å‘½ä»¤è¡ŒæŒ‚è½½ï¼Œåœ¨é‡å¯åä¼šå¤±æ•ˆã€‚</strong></p><h4 id="12-2-5-è™šæ‹Ÿæœºå¢åŠ ç¡¬ç›˜æ­¥éª¤-5"><a href="#12-2-5-è™šæ‹Ÿæœºå¢åŠ ç¡¬ç›˜æ­¥éª¤-5" class="headerlink" title="12.2.5 è™šæ‹Ÿæœºå¢åŠ ç¡¬ç›˜æ­¥éª¤ 5"></a>12.2.5 è™šæ‹Ÿæœºå¢åŠ ç¡¬ç›˜æ­¥éª¤ 5</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">æ°¸ä¹…æŒ‚è½½: é€šè¿‡ä¿®æ”¹ <span class="hljs-regexp">/etc/</span>fstab å®ç°æŒ‚è½½<br>æ·»åŠ å®Œæˆå æ‰§è¡Œ mount â€“a å³åˆ»ç”Ÿæ•ˆ<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20220223170740749.png"></p><p>å­—æ®µè§£é‡Š</p><p><strong>/etc/fstabæ–‡ä»¶ä¸»è¦åŒ…æ‹¬6æ®µï¼Œä¾æ¬¡æ˜¯ï¼š</strong></p><p><strong><file system>ã€€ã€€<dir>ã€€ã€€<type>ã€€ã€€<options>ã€€ã€€<dump>ã€€ã€€<pass></strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs shell">&lt;file system&gt; è¦æŒ‚è½½çš„åˆ†åŒºæˆ–å­˜å‚¨è®¾å¤‡<br>&lt;dir&gt;  æŒ‚è½½çš„ç›®å½•ä½ç½®<br>&lt;type&gt; æŒ‚è½½åˆ†åŒºçš„æ–‡ä»¶ç³»ç»Ÿç±»å‹ï¼Œæ¯”å¦‚ï¼šext3ã€ext4ã€xfsã€swap<br>&lt;options&gt; æŒ‚è½½ä½¿ç”¨çš„å‚æ•°æœ‰å“ªäº›ã€‚ä¸¾ä¾‹å¦‚ä¸‹ï¼š<br>auto - åœ¨å¯åŠ¨æ—¶æˆ–é”®å…¥äº† mount -a å‘½ä»¤æ—¶è‡ªåŠ¨æŒ‚è½½ã€‚<br>noauto - åªåœ¨ä½ çš„å‘½ä»¤ä¸‹è¢«æŒ‚è½½ã€‚<br>exec - å…è®¸æ‰§è¡Œæ­¤åˆ†åŒºçš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚<br>noexec - ä¸å…è®¸æ‰§è¡Œæ­¤æ–‡ä»¶ç³»ç»Ÿä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚<br>ro - ä»¥åªè¯»æ¨¡å¼æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿã€‚<br>rw - ä»¥è¯»å†™æ¨¡å¼æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿã€‚<br>user - å…è®¸ä»»æ„ç”¨æˆ·æŒ‚è½½æ­¤æ–‡ä»¶ç³»ç»Ÿï¼Œè‹¥æ— æ˜¾ç¤ºå®šä¹‰ï¼Œéšå«å¯ç”¨ noexec, nosuid, nodev å‚æ•°ã€‚<br>users - å…è®¸æ‰€æœ‰ users ç»„ä¸­çš„ç”¨æˆ·æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿ.<br>nouser - åªèƒ½è¢« root æŒ‚è½½ã€‚<br>owner - å…è®¸è®¾å¤‡æ‰€æœ‰è€…æŒ‚è½½.<br>sync - I/O åŒæ­¥è¿›è¡Œã€‚<br>async - I/O å¼‚æ­¥è¿›è¡Œã€‚<br>dev - è§£ææ–‡ä»¶ç³»ç»Ÿä¸Šçš„å—ç‰¹æ®Šè®¾å¤‡ã€‚<br>nodev - ä¸è§£ææ–‡ä»¶ç³»ç»Ÿä¸Šçš„å—ç‰¹æ®Šè®¾å¤‡ã€‚<br>suid - å…è®¸ suid æ“ä½œå’Œè®¾å®š sgid ä½ã€‚è¿™ä¸€å‚æ•°é€šå¸¸ç”¨äºä¸€äº›ç‰¹æ®Šä»»åŠ¡ï¼Œä½¿ä¸€èˆ¬ç”¨æˆ·è¿è¡Œç¨‹åºæ—¶ä¸´æ—¶æå‡æƒé™ã€‚<br>nosuid - ç¦æ­¢ suid æ“ä½œå’Œè®¾å®š sgid ä½ã€‚<br>noatime - ä¸æ›´æ–°æ–‡ä»¶ç³»ç»Ÿä¸Š inode è®¿é—®è®°å½•ï¼Œå¯ä»¥æå‡æ€§èƒ½ã€‚<br>nodiratime - ä¸æ›´æ–°æ–‡ä»¶ç³»ç»Ÿä¸Šçš„ç›®å½• inode è®¿é—®è®°å½•ï¼Œå¯ä»¥æå‡æ€§èƒ½(å‚è§ atime å‚æ•°)ã€‚<br>relatime - å®æ—¶æ›´æ–° inode access è®°å½•ã€‚åªæœ‰åœ¨è®°å½•ä¸­çš„è®¿é—®æ—¶é—´æ—©äºå½“å‰è®¿é—®æ‰ä¼šè¢«æ›´æ–°ã€‚ï¼ˆä¸ noatime ç›¸ä¼¼ï¼Œä½†ä¸ä¼šæ‰“æ–­å¦‚ mutt æˆ–å…¶å®ƒç¨‹åºæ¢æµ‹æ–‡ä»¶åœ¨ä¸Šæ¬¡è®¿é—®åæ˜¯å¦è¢«ä¿®æ”¹çš„è¿›ç¨‹ã€‚ï¼‰ï¼Œå¯ä»¥æå‡æ€§èƒ½ã€‚<br>flush - vfat çš„é€‰é¡¹ï¼Œæ›´é¢‘ç¹çš„åˆ·æ–°æ•°æ®ï¼Œå¤åˆ¶å¯¹è¯æ¡†æˆ–è¿›åº¦æ¡åœ¨å…¨éƒ¨æ•°æ®éƒ½å†™å…¥åæ‰æ¶ˆå¤±ã€‚<br>defaults - ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿçš„é»˜è®¤æŒ‚è½½å‚æ•°ï¼Œä¾‹å¦‚ ext4 çš„é»˜è®¤å‚æ•°ä¸º:rw, suid, dev, exec, auto, nouser, async.<br><br>&lt;dump&gt;  dump å·¥å…·é€šè¿‡å®ƒå†³å®šä½•æ—¶ä½œå¤‡ä»½. dump ä¼šæ£€æŸ¥å…¶å†…å®¹ï¼Œå¹¶ç”¨æ•°å­—æ¥å†³å®šæ˜¯å¦å¯¹è¿™ä¸ªæ–‡ä»¶ç³»ç»Ÿè¿›è¡Œå¤‡ä»½ã€‚ å…è®¸çš„æ•°å­—æ˜¯ 0 å’Œ 1 ã€‚0 è¡¨ç¤ºå¿½ç•¥ï¼Œ 1 åˆ™è¿›è¡Œå¤‡ä»½ã€‚å¤§éƒ¨åˆ†çš„ç”¨æˆ·æ˜¯æ²¡æœ‰å®‰è£… dump çš„ ï¼Œå¯¹ä»–ä»¬è€Œè¨€ &lt;dump&gt; åº”è®¾ä¸º 0ã€‚<br><br>&lt;pass&gt; fsck è¯»å– &lt;pass&gt; çš„æ•°å€¼æ¥å†³å®šéœ€è¦æ£€æŸ¥çš„æ–‡ä»¶ç³»ç»Ÿçš„æ£€æŸ¥é¡ºåºã€‚å…è®¸çš„æ•°å­—æ˜¯0, 1, å’Œ2ã€‚ æ ¹ç›®å½•åº”å½“è·å¾—æœ€é«˜çš„ä¼˜å…ˆæƒ 1, å…¶å®ƒæ‰€æœ‰éœ€è¦è¢«æ£€æŸ¥çš„è®¾å¤‡è®¾ç½®ä¸º 2. 0 è¡¨ç¤ºè®¾å¤‡ä¸ä¼šè¢« fsck æ‰€æ£€æŸ¥ã€‚<br></code></pre></td></tr></table></figure><h3 id="12-3-ç£ç›˜æƒ…å†µæŸ¥è¯¢"><a href="#12-3-ç£ç›˜æƒ…å†µæŸ¥è¯¢" class="headerlink" title="12.3 ç£ç›˜æƒ…å†µæŸ¥è¯¢"></a>12.3 ç£ç›˜æƒ…å†µæŸ¥è¯¢</h3><h4 id="12-3-1-æŸ¥è¯¢ç³»ç»Ÿæ•´ä½“ç£ç›˜ä½¿ç”¨æƒ…å†µ"><a href="#12-3-1-æŸ¥è¯¢ç³»ç»Ÿæ•´ä½“ç£ç›˜ä½¿ç”¨æƒ…å†µ" class="headerlink" title="12.3.1 æŸ¥è¯¢ç³»ç»Ÿæ•´ä½“ç£ç›˜ä½¿ç”¨æƒ…å†µ"></a>12.3.1 æŸ¥è¯¢ç³»ç»Ÿæ•´ä½“ç£ç›˜ä½¿ç”¨æƒ…å†µ</h4><p>åŸºæœ¬è¯­æ³•</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">df -h</span><br></code></pre></td></tr></table></figure><p>åº”ç”¨å®ä¾‹<br>å®ä¾‹1ï¼šæŸ¥è¯¢ç³»ç»Ÿæ•´ä½“ç£ç›˜ä½¿ç”¨æƒ…å†µ</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20220223171558366.png"></p><h4 id="12-3-2-æŸ¥è¯¢æŒ‡å®šç›®å½•çš„ç£ç›˜å ç”¨æƒ…å†µ"><a href="#12-3-2-æŸ¥è¯¢æŒ‡å®šç›®å½•çš„ç£ç›˜å ç”¨æƒ…å†µ" class="headerlink" title="12.3.2 æŸ¥è¯¢æŒ‡å®šç›®å½•çš„ç£ç›˜å ç”¨æƒ…å†µ"></a>12.3.2 æŸ¥è¯¢æŒ‡å®šç›®å½•çš„ç£ç›˜å ç”¨æƒ…å†µ</h4><p>åŸºæœ¬è¯­æ³•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">du -h ç›®å½•   #æŸ¥è¯¢æŒ‡å®šç›®å½•çš„ç£ç›˜å ç”¨æƒ…å†µï¼Œé»˜è®¤ä¸ºå½“å‰ç›®å½•<br></code></pre></td></tr></table></figure><p>é€‰é¡¹è¯´æ˜ï¼š</p><ul><li>-s æŒ‡å®šç›®å½•å ç”¨å¤§å°æ±‡æ€»</li><li>-h å¸¦è®¡é‡å•ä½</li><li>-a å«æ–‡ä»¶</li><li>â€“max-depth=1 å­ç›®å½•æ·±åº¦ä¸º1</li></ul><ul><li>-c åˆ—å‡ºæ˜ç»†çš„åŒæ—¶ï¼Œå¢åŠ æ±‡æ€»å€¼</li></ul><p>åº”ç”¨å®ä¾‹<br>æ¡ˆä¾‹1ï¼šæŸ¥è¯¢ /opt ç›®å½•çš„ç£ç›˜å ç”¨æƒ…å†µï¼Œæ·±åº¦ä¸º 2</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20220223172209906.png"></p><h3 id="12-4-ç£ç›˜æƒ…å†µ-å·¥ä½œå®ç”¨æŒ‡ä»¤"><a href="#12-4-ç£ç›˜æƒ…å†µ-å·¥ä½œå®ç”¨æŒ‡ä»¤" class="headerlink" title="12.4 ç£ç›˜æƒ…å†µ-å·¥ä½œå®ç”¨æŒ‡ä»¤"></a>12.4 ç£ç›˜æƒ…å†µ-å·¥ä½œå®ç”¨æŒ‡ä»¤</h3><ol><li>ç»Ÿè®¡/homeæ–‡ä»¶å¤¹ä¸‹æ–‡ä»¶çš„ä¸ªæ•°</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ls -l /home | grep &quot;^-&quot; | wc -l<br></code></pre></td></tr></table></figure><ol start="2"><li>ç»Ÿè®¡/homeæ–‡ä»¶å¤¹ä¸‹ç›®å½•çš„ä¸ªæ•°</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ls -l /home | grep &quot;^d&quot; | wc -l<br></code></pre></td></tr></table></figure><p>3 ç»Ÿè®¡/homeæ–‡ä»¶å¤¹ä¸‹æ–‡ä»¶çš„ä¸ªæ•°ï¼ŒåŒ…æ‹¬å­æ–‡ä»¶å¤¹é‡Œçš„</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ls -lR /home | grep &quot;^-&quot; | wc -l<br></code></pre></td></tr></table></figure><p>4 ) ç»Ÿè®¡æ–‡ä»¶å¤¹ä¸‹ç›®å½•çš„ä¸ªæ•°ï¼ŒåŒ…æ‹¬å­æ–‡ä»¶å¤¹é‡Œçš„</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ls -lR /home | grep &quot;^-&quot; | wc -l<br></code></pre></td></tr></table></figure><p>5 ) ä»¥æ ‘çŠ¶æ˜¾ç¤º/homeç›®å½•ç»“æ„</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">tree /home<br></code></pre></td></tr></table></figure><h2 id="åä¸‰ã€ç½‘ç»œé…ç½®"><a href="#åä¸‰ã€ç½‘ç»œé…ç½®" class="headerlink" title="åä¸‰ã€ç½‘ç»œé…ç½®"></a>åä¸‰ã€ç½‘ç»œé…ç½®</h2><h3 id="13-1-Linuxç½‘ç»œé…ç½®åŸç†å›¾-å«è™šæ‹Ÿæœº"><a href="#13-1-Linuxç½‘ç»œé…ç½®åŸç†å›¾-å«è™šæ‹Ÿæœº" class="headerlink" title="13.1 Linuxç½‘ç»œé…ç½®åŸç†å›¾(å«è™šæ‹Ÿæœº)"></a>13.1 Linuxç½‘ç»œé…ç½®åŸç†å›¾(å«è™šæ‹Ÿæœº)</h3><p>ç›®å‰æˆ‘ä»¬çš„ç½‘ç»œé…ç½®é‡‡ç”¨çš„æ˜¯NATã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20220223193808182.png"></p><h3 id="13-2-æŸ¥çœ‹ç½‘ç»œIPå’Œç½‘å…³"><a href="#13-2-æŸ¥çœ‹ç½‘ç»œIPå’Œç½‘å…³" class="headerlink" title="13.2 æŸ¥çœ‹ç½‘ç»œIPå’Œç½‘å…³"></a>13.2 æŸ¥çœ‹ç½‘ç»œIPå’Œç½‘å…³</h3><p> åœ¨windowsç¯å¢ƒä¸‹ï¼ŒæŸ¥çœ‹ipé…ç½®ï¼ŒåŸºæœ¬è¯­æ³•ï¼š</p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dos"><span class="hljs-built_in">ipconfig</span><br></code></pre></td></tr></table></figure><p>åœ¨linuxç¯å¢ƒä¸‹ï¼ŒæŸ¥çœ‹ipé…ç½®ï¼ŒåŸºæœ¬è¯­æ³•ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ifconfig<br></code></pre></td></tr></table></figure><h3 id="13-3-Pingæµ‹è¯•ä¸»æœºä¹‹é—´ç½‘ç»œè¿é€š"><a href="#13-3-Pingæµ‹è¯•ä¸»æœºä¹‹é—´ç½‘ç»œè¿é€š" class="headerlink" title="13.3 Pingæµ‹è¯•ä¸»æœºä¹‹é—´ç½‘ç»œè¿é€š"></a>13.3 Pingæµ‹è¯•ä¸»æœºä¹‹é—´ç½‘ç»œè¿é€š</h3><p>åŸºæœ¬è¯­æ³•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ping ç›®çš„ä¸»æœº ï¼ˆåŠŸèƒ½æè¿°ï¼šæµ‹è¯•å½“å‰æœåŠ¡å™¨æ˜¯å¦å¯ä»¥è¿æ¥ç›®çš„ä¸»æœºï¼‰<br></code></pre></td></tr></table></figure><p>åº”ç”¨å®ä¾‹</p><p>æ¡ˆä¾‹1ï¼šæµ‹è¯•å½“å‰æœåŠ¡å™¨æ˜¯å¦å¯ä»¥è¿æ¥ç™¾åº¦</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autoit"><span class="hljs-built_in">ping</span> www.baidu.com<br></code></pre></td></tr></table></figure><h3 id="13-4-Linuxç½‘ç»œç¯å¢ƒé…ç½®"><a href="#13-4-Linuxç½‘ç»œç¯å¢ƒé…ç½®" class="headerlink" title="13.4 Linuxç½‘ç»œç¯å¢ƒé…ç½®"></a>13.4 Linuxç½‘ç»œç¯å¢ƒé…ç½®</h3><h4 id="13-4-1-ç¬¬ä¸€ç§æ–¹æ³•-è‡ªåŠ¨è·å–"><a href="#13-4-1-ç¬¬ä¸€ç§æ–¹æ³•-è‡ªåŠ¨è·å–" class="headerlink" title="13.4.1 ç¬¬ä¸€ç§æ–¹æ³•(è‡ªåŠ¨è·å–)"></a>13.4.1 ç¬¬ä¸€ç§æ–¹æ³•(è‡ªåŠ¨è·å–)</h4><p>è¯´æ˜ï¼šç™»å½•ä»¥åï¼Œé€šè¿‡ç•Œé¢æ¥è®¾ç½®è‡ªåŠ¨è·å–ipï¼Œç‰¹ç‚¹ï¼šlinuxå¯åŠ¨åä¼šè‡ªåŠ¨è·å–ipã€‚</p><p>ç¼ºç‚¹:linuxå¯åŠ¨åä¼šè‡ªåŠ¨è·å–IP,ç¼ºç‚¹æ˜¯æ¯æ¬¡è‡ªåŠ¨è·å–çš„ipåœ°å€å¯èƒ½ä¸ä¸€æ ·ã€‚è¿™ä¸ªä¸é€‚ç”¨äºåšæœåŠ¡å™¨ï¼Œå› ä¸ºæˆ‘ä»¬çš„æœåŠ¡å™¨çš„ ipéœ€è¦æ—¶å›ºå®šçš„ã€‚</p><p>å¯ä»¥å¤šäº†è§£ä¸€äº›<strong>DHCP</strong>ï¼ˆåŠ¨æ€è·¯ç”±é€‰æ‹©åè®®ï¼‰ã€‚</p><h4 id="13-4-2-ç¬¬äºŒç§æ–¹æ³•-æŒ‡å®šå›ºå®šçš„ip"><a href="#13-4-2-ç¬¬äºŒç§æ–¹æ³•-æŒ‡å®šå›ºå®šçš„ip" class="headerlink" title="13.4.2 ç¬¬äºŒç§æ–¹æ³•(æŒ‡å®šå›ºå®šçš„ip)"></a>13.4.2 ç¬¬äºŒç§æ–¹æ³•(æŒ‡å®šå›ºå®šçš„ip)</h4><p>è¯´æ˜ï¼šç›´æ¥ä¿®æ”¹é…ç½®æ–‡ä»¶æ¥æŒ‡å®šipï¼Œå¹¶å¯ä»¥è¿æ¥åˆ°å¤–ç½‘(ç¨‹åºå‘˜æ¨è)ï¼Œè¦æ±‚ï¼šå°†ipåœ°å€é…ç½®çš„é™æ€çš„ï¼Œipåœ°å€ä¸º 192.168.184.130</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">vi /etc/sysconfig/network-scripts/ifcfg-ens33<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20220223200552506.png"></p><p>ä¿®æ”¹åï¼Œä¸€å®šè¦é‡å¯æœåŠ¡/é‡å¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">service network restart<br>reboot <br></code></pre></td></tr></table></figure><h3 id="13-5-è®¾ç½®ä¸»æœºåå’Œhostsæ˜ å°„"><a href="#13-5-è®¾ç½®ä¸»æœºåå’Œhostsæ˜ å°„" class="headerlink" title="13.5 è®¾ç½®ä¸»æœºåå’Œhostsæ˜ å°„"></a>13.5 è®¾ç½®ä¸»æœºåå’Œhostsæ˜ å°„</h3><h4 id="13-5-1-è®¾ç½®ä¸»æœºå"><a href="#13-5-1-è®¾ç½®ä¸»æœºå" class="headerlink" title="13.5.1 è®¾ç½®ä¸»æœºå"></a>13.5.1 è®¾ç½®ä¸»æœºå</h4><ol><li>ä¸ºäº†æ–¹ä¾¿è®°å¿†ï¼Œå¯ä»¥ç»™linuxç³»ç»Ÿè®¾ç½®<strong>ä¸»æœºå</strong>ï¼Œä¹Ÿå¯ä»¥æ ¹æ®éœ€è¦ä¿®æ”¹ä¸»æœºå</li><li>æŒ‡ä»¤ <code>hostname</code>:æŸ¥çœ‹ä¸»æœºå</li><li>ä¿®æ”¹æ–‡ä»¶åœ¨<code>/etc/hostname</code>æŒ‡å®š</li><li>ä¿®æ”¹åï¼Œé‡å¯ç”Ÿæ•ˆ</li></ol><h4 id="13-5-2-è®¾ç½®hostsæ˜ å°„"><a href="#13-5-2-è®¾ç½®hostsæ˜ å°„" class="headerlink" title="13.5.2 è®¾ç½®hostsæ˜ å°„"></a>13.5.2 è®¾ç½®hostsæ˜ å°„</h4><p>é€šè¿‡ <strong>ä¸»æœºå</strong> èƒ½å¤Ÿæ‰¾åˆ°ï¼ˆæ¯”å¦‚pingï¼‰æŸä¸ªlinuxç³»ç»Ÿã€‚</p><p>åœ¨windowsç³»ç»Ÿä¸‹ï¼Œä¿®æ”¹<code>C:\Windows\System32\drivers\etc\hosts</code>æ–‡ä»¶æŒ‡å®šå³å¯ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">192.168.200.130 jyg<br></code></pre></td></tr></table></figure><p>åœ¨linuxç³»ç»Ÿä¸‹ï¼Œä¿®æ”¹<code>/etc/hosts</code>æ–‡ä»¶æŒ‡å®šå³å¯ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">192.168.200.1 jyg<br></code></pre></td></tr></table></figure><h3 id="13-6-ä¸»æœºåè§£æè¿‡ç¨‹åˆ†æï¼ˆHostsã€DNSï¼‰"><a href="#13-6-ä¸»æœºåè§£æè¿‡ç¨‹åˆ†æï¼ˆHostsã€DNSï¼‰" class="headerlink" title="13.6 ä¸»æœºåè§£æè¿‡ç¨‹åˆ†æï¼ˆHostsã€DNSï¼‰"></a>13.6 ä¸»æœºåè§£æè¿‡ç¨‹åˆ†æï¼ˆHostsã€DNSï¼‰</h3><h4 id="13-6-1-Hostsæ˜¯ä»€ä¹ˆ"><a href="#13-6-1-Hostsæ˜¯ä»€ä¹ˆ" class="headerlink" title="13.6.1 Hostsæ˜¯ä»€ä¹ˆ"></a>13.6.1 Hostsæ˜¯ä»€ä¹ˆ</h4><p>ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œç”¨æ¥è®°å½•ipå’ŒHostnameï¼ˆä¸»æœºåï¼‰çš„æ˜ å°„å…³ç³»</p><h4 id="13-6-2-DNS"><a href="#13-6-2-DNS" class="headerlink" title="13.6.2 DNS"></a>13.6.2 DNS</h4><ol><li>DNSï¼Œå°±æ˜¯Domain Name Systemçš„ç¼©å†™ï¼Œç¿»è¯‘è¿‡æ¥å°±æ˜¯åŸŸåç³»ç»Ÿ</li><li>DNSæ˜¯äº’è”ç½‘ä¸Šä½œä¸ºåŸŸåå’Œipåœ°å€ç›¸äº’æ˜ å°„çš„ä¸€ä¸ªåˆ†å¸ƒå¼æ•°æ®åº“</li></ol><h4 id="13-6-3-å½“ç”¨æˆ·åœ¨æµè§ˆå™¨è¾“å…¥www-baidu-comï¼Œç³»ç»Ÿå¦‚ä½•è§£æçš„ipåœ°å€"><a href="#13-6-3-å½“ç”¨æˆ·åœ¨æµè§ˆå™¨è¾“å…¥www-baidu-comï¼Œç³»ç»Ÿå¦‚ä½•è§£æçš„ipåœ°å€" class="headerlink" title="13.6.3 å½“ç”¨æˆ·åœ¨æµè§ˆå™¨è¾“å…¥www.baidu.comï¼Œç³»ç»Ÿå¦‚ä½•è§£æçš„ipåœ°å€"></a>13.6.3 å½“ç”¨æˆ·åœ¨æµè§ˆå™¨è¾“å…¥<a href="http://www.baidu.com,ç³»ç»Ÿå¦‚ä½•è§£æçš„ipåœ°å€/">www.baidu.comï¼Œç³»ç»Ÿå¦‚ä½•è§£æçš„ipåœ°å€</a></h4><ol><li><p>æµè§ˆå™¨å…ˆæ£€æŸ¥æµè§ˆå™¨ç¼“å­˜ä¸­æœ‰æ²¡æœ‰è¯¥åŸŸåè§£æIPåœ°å€ï¼Œå¦‚æœæœ‰å°±å…ˆè¿”å›è¿™ä¸ªIPå®Œæˆè§£æï¼›å¦‚æœæ²¡æœ‰ï¼Œå°±æ£€æŸ¥æ“ä½œç³»ç»ŸDNSè§£æå™¨ç¼“å­˜ï¼Œå¦‚æœæœ‰å°±ç›´æ¥è¿”å›è¿™ä¸ªIPå®Œæˆè§£æã€‚è¿™ä¸¤ä¸ªç¼“å­˜ï¼Œå¯ä»¥ç†è§£ä¸ºæœ¬åœ°è§£æå™¨ç¼“å­˜ã€‚</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œå½“ç”µè„‘ç¬¬ä¸€æ¬¡æˆåŠŸè®¿é—®æŸä¸€ç½‘ç«™åï¼Œåœ¨ä¸€å®šæ—¶é—´å†…ï¼Œæµè§ˆå™¨æˆ–æ“ä½œç³»ç»Ÿä¼šç¼“å­˜è¯¥åŸŸåçš„IPåœ°å€ï¼ˆDNSè§£æè®°å½•ï¼‰ï¼Œä¾‹å¦‚åœ¨cmdçª—å£ä¸­è¾“å…¥ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">ipconfig /displaydns   #DNSåŸŸåè§£æç¼“å­˜<br>ipconfig /flushdns     #æ‰‹åŠ¨æ¸…ç†DNSç¼“å­˜<br></code></pre></td></tr></table></figure></li><li><p>å¦‚æœæœ¬åœ°è§£æå™¨ç¼“å­˜æ²¡æœ‰æ‰¾åˆ°å¯¹åº”æ˜ å°„ï¼Œæ£€æŸ¥ç³»ç»Ÿä¸­hostsæ–‡ä»¶ä¸­ï¼Œæœ‰æ²¡æœ‰é…ç½®å¯¹åº”çš„åŸŸåIPæ˜ å°„ï¼Œå¦‚æœæœ‰ï¼Œåˆ™å®Œæˆè§£æç—…è¿”å›è¯¥IP</p><p><strong>æ‰€ä»¥ï¼Œä¿®æ”¹ç³»ç»Ÿ<code>hosts</code>æ–‡ä»¶ï¼Œå¯ä»¥åšåˆ°åŸŸååŠ«æŒã€‚</strong></p></li><li><p>å¦‚æœæœ¬åœ°DNSè§£æå™¨ç¼“å­˜å’Œhostsæ–‡ä»¶ä¸­å‡æ²¡æœ‰æ‰¾åˆ°å“¦å•Šå¯¹åº”çš„IPï¼Œåˆ™åˆ°åŸŸåæœåŠ¡å™¨DNSè¿›è¡Œè§£æåŸŸåã€‚</p></li></ol><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20220223203658890.png"></p><h2 id="åå››ã€è¿›ç¨‹ç®¡ç†"><a href="#åå››ã€è¿›ç¨‹ç®¡ç†" class="headerlink" title="åå››ã€è¿›ç¨‹ç®¡ç†"></a>åå››ã€è¿›ç¨‹ç®¡ç†</h2><h3 id="14-1-è¿›ç¨‹çš„åŸºæœ¬ä»‹ç»"><a href="#14-1-è¿›ç¨‹çš„åŸºæœ¬ä»‹ç»" class="headerlink" title="14.1 è¿›ç¨‹çš„åŸºæœ¬ä»‹ç»"></a>14.1 è¿›ç¨‹çš„åŸºæœ¬ä»‹ç»</h3><figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs tcl"><span class="hljs-number">1</span>)åœ¨LINUXä¸­ï¼Œæ¯ä¸ªæ‰§è¡Œçš„ç¨‹åºï¼ˆä»£ç ï¼‰éƒ½ç§°ä¸ºä¸€ä¸ªè¿›ç¨‹ã€‚æ¯ä¸€ä¸ªè¿›ç¨‹éƒ½åˆ†é…ä¸€ä¸ªIDå·ï¼ˆ<span class="hljs-keyword">pid</span>ï¼Œè¿›ç¨‹å·ï¼‰ã€‚<br><span class="hljs-number">2</span>)æ¯ä¸€ä¸ªè¿›ç¨‹ï¼Œéƒ½ä¼šå¯¹åº”ä¸€ä¸ªçˆ¶è¿›ç¨‹ï¼Œè€Œè¿™ä¸ªçˆ¶è¿›ç¨‹å¯ä»¥å¤åˆ¶å¤šä¸ªå­è¿›ç¨‹ã€‚ä¾‹å¦‚wwwæœåŠ¡å™¨ã€‚<br><span class="hljs-number">3</span>)æ¯ä¸ªè¿›ç¨‹éƒ½å¯èƒ½ä»¥ä¸¤ç§æ–¹å¼å­˜åœ¨çš„ã€‚å‰å°ä¸åå°ï¼Œæ‰€è°“å‰å°è¿›ç¨‹å°±æ˜¯ç”¨æˆ·ç›®å‰çš„å±å¹•ä¸Šå¯ä»¥è¿›è¡Œæ“ä½œçš„ã€‚åå°è¿›ç¨‹åˆ™æ˜¯å®é™…åœ¨æ“ä½œï¼Œä½†ç”±äºå±å¹•ä¸Šæ— æ³•çœ‹åˆ°çš„è¿›ç¨‹ï¼Œé€šå¸¸ä½¿ç”¨åå°æ–¹å¼æ‰§è¡Œã€‚<br><span class="hljs-number">4</span>)ä¸€èˆ¬ç³»ç»Ÿçš„æœåŠ¡éƒ½æ˜¯ä»¥åå°è¿›ç¨‹çš„æ–¹å¼å­˜åœ¨ï¼Œè€Œä¸”éƒ½ä¼šå¸¸é©»åœ¨ç³»ç»Ÿä¸­ã€‚ç›´åˆ°å…³æœºæ‰æ‰ç»“æŸã€‚<br></code></pre></td></tr></table></figure><h3 id="14-2-æ˜¾ç¤ºç³»ç»Ÿæ‰§è¡Œçš„è¿›ç¨‹"><a href="#14-2-æ˜¾ç¤ºç³»ç»Ÿæ‰§è¡Œçš„è¿›ç¨‹" class="headerlink" title="14.2 æ˜¾ç¤ºç³»ç»Ÿæ‰§è¡Œçš„è¿›ç¨‹"></a>14.2 æ˜¾ç¤ºç³»ç»Ÿæ‰§è¡Œçš„è¿›ç¨‹</h3><h4 id="14-2-1-pså‘½ä»¤åŸºæœ¬ä»‹ç»"><a href="#14-2-1-pså‘½ä»¤åŸºæœ¬ä»‹ç»" class="headerlink" title="14.2.1 pså‘½ä»¤åŸºæœ¬ä»‹ç»"></a>14.2.1 pså‘½ä»¤åŸºæœ¬ä»‹ç»</h4><p><code>ps</code>å‘½ä»¤æ˜¯ç”¨æ¥æŸ¥çœ‹ç›®å‰ç³»ç»Ÿä¸­ï¼Œæœ‰å“ªäº›æ­£åœ¨æ‰§è¡Œï¼Œä»¥åŠå®ƒä»¬æ‰§è¡Œçš„çŠ¶å†µã€‚å¯ä»¥åŠ ä»»ä½•å‚æ•°ã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20220223211635045.png"></p><h4 id="14-2-2-psç°å®çš„ä¿¡æ¯é€‰é¡¹ï¼š"><a href="#14-2-2-psç°å®çš„ä¿¡æ¯é€‰é¡¹ï¼š" class="headerlink" title="14.2.2 psç°å®çš„ä¿¡æ¯é€‰é¡¹ï¼š"></a>14.2.2 psç°å®çš„ä¿¡æ¯é€‰é¡¹ï¼š</h4><table><thead><tr><th>å­—æ®µ</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>PID</td><td>è¿›ç¨‹è¯†åˆ«å·</td></tr><tr><td>TTY</td><td>ç»ˆç«¯æœºå·</td></tr><tr><td>TIME</td><td>æ­¤è¿›ç¨‹æ‰€æ¶ˆè€—CPUæ—¶é—´</td></tr><tr><td>CMD</td><td>æ­£åœ¨æ‰§è¡Œçš„å‘½ä»¤æˆ–è¿›ç¨‹å</td></tr></tbody></table><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">ps -a #æ˜¾ç¤ºå½“å‰ç»ˆç«¯çš„æ‰€æœ‰è¿›ç¨‹ä¿¡æ¯<br>ps -u #ä»¥ç”¨æˆ·æ ¼å¼æ˜¾ç¤ºè¿›ç¨‹ä¿¡æ¯<br>ps -x #æ˜¾ç¤ºåå°è¿›ç¨‹è¿è¡Œçš„å‚æ•°<br></code></pre></td></tr></table></figure><p>ä¸€èˆ¬ç»„åˆä½¿ç”¨<code>ps -aux</code></p><h4 id="14-2-3-psæŒ‡ä»¤è¯¦è§£"><a href="#14-2-3-psæŒ‡ä»¤è¯¦è§£" class="headerlink" title="14.2.3 psæŒ‡ä»¤è¯¦è§£"></a>14.2.3 psæŒ‡ä»¤è¯¦è§£</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ps -aux<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20220223212209393.png"></p><p>å„å­—æ®µè§£é‡Šï¼š</p><ul><li><p>USERï¼š    ç”¨æˆ·åç§°</p></li><li><p>PIDï¼šè¿›ç¨‹å·</p></li><li><p>%CPUï¼šè¿›ç¨‹å ç”¨CPUçš„ç™¾åˆ†æ¯”</p></li><li><p>%MEMï¼šè¿›ç¨‹å ç”¨ç‰©ç†å†…å­˜çš„ç™¾åˆ†æ¯”</p></li><li><p>VSZï¼šè¿›ç¨‹å ç”¨çš„è™šæ‹Ÿå†…å­˜å¤§å°ï¼ˆå•ä½ï¼šKBï¼‰</p></li><li><p>RSSï¼šè¿›ç¨‹å ç”¨çš„ç‰©ç†å†…å­˜å¤§å°ï¼ˆå•ä½ï¼šKBï¼‰</p></li><li><p>TTYï¼šç»ˆç«¯åç§°,å¤ªé•¿å°±ç¼©å†™ä¸º<code>?</code>.</p></li><li><p>STATï¼šè¿›ç¨‹çŠ¶æ€ï¼Œå…¶ä¸­S-ç¡çœ ï¼Œs-è¡¨ç¤ºè¯¥è¿›ç¨‹æ˜¯ä¼šè¯çš„å…ˆå¯¼è¿›ç¨‹ï¼ŒN-è¡¨ç¤ºè¿›ç¨‹æ‹¥æœ‰æ¯”æ™®é€šä¼˜å…ˆçº§æ›´ä½çš„ä¼˜å…ˆçº§ï¼ŒR-æ­£åœ¨è¿è¡Œï¼ŒD-çŸ­æœŸç­‰å¾…ï¼ŒZ-åƒµæ­»è¿›ç¨‹ï¼ŒT-è¢«è·Ÿè¸ªæˆ–è€…è¢«åœæ­¢ç­‰ç­‰</p></li><li><p>STARTï¼šè¿›ç¨‹çš„å¯åŠ¨æ—¶é—´</p></li><li><p>TIMEï¼šCPUæ—¶é—´ï¼Œå³è¿›ç¨‹ä½¿ç”¨CPUçš„æ€»æ—¶é—´</p></li><li><p>COMMANDï¼šè¿›ç¨‹åæˆ–è€…æ‰§è¡Œè¿›ç¨‹æ‰€ç”¨çš„å‘½ä»¤å’Œå‚æ•°ï¼Œå¦‚æœè¿‡é•¿ä¼šè¢«æˆªæ–­æ˜¾ç¤º</p></li></ul><p>åº”ç”¨å®ä¾‹ï¼š</p><p>å®ä¾‹1ï¼šæŸ¥çœ‹æœ‰æ²¡æœ‰sshdæœåŠ¡è¿›ç¨‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ps -aux | grep sshd<br></code></pre></td></tr></table></figure><p>å®ä¾‹2ï¼šä»¥å…¨æ ¼å¼æ˜¾ç¤ºå½“å‰æ‰€æœ‰çš„è¿›ç¨‹ï¼ŒæŸ¥çœ‹sshdè¿›ç¨‹çš„çˆ¶è¿›ç¨‹ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ps -ef | grep sshd #ä»¥å…¨æ ¼å¼æ˜¾ç¤ºå½“å‰æ‰€æœ‰çš„è¿›ç¨‹<br></code></pre></td></tr></table></figure><p>é€‰é¡¹è§£é‡Šï¼š</p><ul><li>-e:æ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹</li><li>-f:å…¨æ ¼å¼</li></ul><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20220223213643683.png"></p><p>å„å­—æ®µè§£é‡Šï¼š</p><ul><li><p>UIDï¼šç”¨æˆ·ID</p></li><li><p>PIDï¼šè¿›ç¨‹ID</p></li><li><p>PPIDï¼šçˆ¶è¿›ç¨‹ID</p></li><li><p>Cï¼šCPUç”¨äºè®¡ç®—æ‰§è¡Œä¼˜å…ˆçº§çš„å› å­ã€‚æ•°å€¼è¶Šå¤§ï¼Œè¡¨æ˜è¿›ç¨‹æ˜¯CPUå¯†é›†å‹è¿ç®—ï¼Œæ‰§è¡Œä¼˜å…ˆçº§ä¼šé™ä½ï¼›æ•°å€¼è¶Šå°ï¼Œè¡¨æ˜è¿›ç¨‹æ˜¯I/Oå¯†é›†å‹è¿ç®—ï¼Œæ‰§è¡Œä¼˜å…ˆçº§ä¼šæé«˜</p></li><li><p>STIMEï¼šè¿›ç¨‹å¯åŠ¨çš„æ—¶é—´</p></li><li><p>TTYï¼šå®Œæ•´çš„ç»ˆç«¯åç§°</p></li><li><p>TIMEï¼šCPUæ—¶é—´</p></li><li><p>CMDï¼šå¯åŠ¨è¿›ç¨‹æ‰€ç”¨çš„å‘½ä»¤å’Œå‚æ•°<br>æ€è€ƒé¢˜ï¼Œå¦‚æœæˆ‘ä»¬å¸Œæœ›æŸ¥çœ‹ sshdè¿›ç¨‹çš„çˆ¶è¿›ç¨‹å·æ˜¯å¤šå°‘ï¼Œåº”è¯¥æ€æ ·æŸ¥è¯¢ ï¼Ÿ</p></li></ul><h3 id="14-3-ç»ˆæ­¢è¿›ç¨‹killå’Œkillall"><a href="#14-3-ç»ˆæ­¢è¿›ç¨‹killå’Œkillall" class="headerlink" title="14.3 ç»ˆæ­¢è¿›ç¨‹killå’Œkillall"></a>14.3 ç»ˆæ­¢è¿›ç¨‹killå’Œkillall</h3><p>è‹¥æ˜¯æŸä¸ªè¿›ç¨‹æ‰§è¡Œä¸€åŠéœ€è¦åœæ­¢æ—¶ï¼Œæˆ–æ˜¯å·²æ¶ˆäº†å¾ˆå¤§çš„ç³»ç»Ÿèµ„æºæ—¶ï¼Œæ­¤æ—¶å¯ä»¥è€ƒè™‘åœæ­¢è¯¥è¿›ç¨‹ã€‚ä½¿ç”¨killå‘½ä»¤æ¥å®Œæˆæ­¤é¡¹ä»»åŠ¡ã€‚</p><p>åŸºæœ¬è¯­æ³•:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">kill</span> [é€‰é¡¹] è¿›ç¨‹å· ï¼ˆåŠŸèƒ½æè¿°ï¼šé€šè¿‡è¿›ç¨‹å·æ€æ­»è¿›ç¨‹ï¼‰<br>killall è¿›ç¨‹åç§° ï¼ˆåŠŸèƒ½æè¿°ï¼šé€šè¿‡è¿›ç¨‹åç§°æ€æ­»è¿›ç¨‹ï¼Œä¹Ÿæ”¯æŒé€šé…ç¬¦ï¼Œè¿™åœ¨ç³»ç»Ÿå› è´Ÿè½½è¿‡å¤§è€Œå˜å¾—å¾ˆæ…¢æ—¶å¾ˆæœ‰ç”¨ï¼‰<br></code></pre></td></tr></table></figure><p>å¸¸ç”¨é€‰é¡¹:</p><ul><li>-9 :è¡¨ç¤ºå¼ºè¿«è¿›ç¨‹ç«‹å³åœæ­¢</li></ul><p>åº”ç”¨å®è·µï¼š</p><p>æ¡ˆä¾‹ 1 ï¼šè¸¢æ‰æŸä¸ªéæ³•ç™»å½•ç”¨æˆ·<code>tom</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">ps -ef | grep sshd #æŸ¥è¯¢tomç™»å½•çš„PID<br>kill [tomç”¨æˆ·ç™»å½•å¯¹åº”çš„è¿›ç¨‹å·]<br></code></pre></td></tr></table></figure><p>æ¡ˆä¾‹ 2 : ç»ˆæ­¢è¿œç¨‹ç™»å½•æœåŠ¡sshd, åœ¨é€‚å½“æ—¶å€™å†æ¬¡é‡å¯sshdæœåŠ¡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">ps -ef | grep sshd #æŸ¥è¯¢sshdæœåŠ¡çš„PID<br>kill [sshdæœåŠ¡çš„PID]<br>/bin/systemctl start sshd.service #é‡å¯sshdæœåŠ¡<br></code></pre></td></tr></table></figure><p>æ¡ˆä¾‹ 3 : ç»ˆæ­¢å¤šä¸ªgedit ç¼–è¾‘å™¨ ã€killall, é€šè¿‡è¿›ç¨‹åç§°æ¥ç»ˆæ­¢è¿›ç¨‹ã€‘</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">killall gedit<br></code></pre></td></tr></table></figure><p>æ¡ˆä¾‹ 4 ï¼šå¼ºåˆ¶æ€æ‰ä¸€ä¸ªç»ˆç«¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">ps -ef | grep bash<br>kill [bashçš„PID] #è¿™ç§æƒ…å†µç³»ç»Ÿæœ‰ä¿æŠ¤ï¼Œä¸èƒ½æ€æ‰<br>kill -9 [bashçš„PID] #å¼ºåˆ¶æ€æ‰<br></code></pre></td></tr></table></figure><h3 id="14-4-æŸ¥çœ‹è¿›ç¨‹æ ‘pstree"><a href="#14-4-æŸ¥çœ‹è¿›ç¨‹æ ‘pstree" class="headerlink" title="14.4 æŸ¥çœ‹è¿›ç¨‹æ ‘pstree"></a>14.4 æŸ¥çœ‹è¿›ç¨‹æ ‘pstree</h3><p>åŸºæœ¬è¯­æ³•ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">pstree [é€‰é¡¹] #å¯ä»¥æ›´åŠ ç›´è§‚çš„æ¥çœ‹è¿›ç¨‹ä¿¡æ¯<br></code></pre></td></tr></table></figure><p>å¸¸ç”¨é€‰é¡¹ï¼š</p><ul><li>-p:æ˜¾ç¤ºè¿›ç¨‹çš„PID</li><li>-u:æ˜¾ç¤ºè¿›ç¨‹çš„æ‰€å±ç”¨æˆ·</li></ul><p>åº”ç”¨å®ä¾‹ï¼š</p><p>æ¡ˆä¾‹ 1 ï¼šè¯·ä½ æ ‘çŠ¶çš„å½¢å¼æ˜¾ç¤ºè¿›ç¨‹çš„pid</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">pstree -p<br></code></pre></td></tr></table></figure><p>æ¡ˆä¾‹ 2 ï¼šè¯·ä½ æ ‘çŠ¶çš„å½¢å¼è¿›ç¨‹çš„ç”¨æˆ·</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">pstree -u</span><br></code></pre></td></tr></table></figure><h3 id="14-5-æœåŠ¡-service-ç®¡ç†"><a href="#14-5-æœåŠ¡-service-ç®¡ç†" class="headerlink" title="14.5 æœåŠ¡(service)ç®¡ç†"></a>14.5 æœåŠ¡(service)ç®¡ç†</h3><p>æœåŠ¡(service) æœ¬è´¨å°±æ˜¯è¿›ç¨‹ï¼Œä½†æ˜¯æ˜¯è¿è¡Œåœ¨åå°çš„ï¼Œé€šå¸¸éƒ½ä¼šç›‘å¬æŸä¸ªç«¯å£ï¼Œç­‰å¾…å…¶å®ƒç¨‹åºçš„è¯·æ±‚ï¼Œæ¯”å¦‚(mysqld,sshd,é˜²ç«å¢™ç­‰)ï¼Œå› æ­¤æˆ‘ä»¬åˆç§°ä¸ºå®ˆæŠ¤è¿›ç¨‹ï¼Œæ˜¯Linuxä¸­éå¸¸é‡è¦çš„çŸ¥è¯†ç‚¹ã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20220224193420932.png"></p><h4 id="14-5-1-serviceç®¡ç†æŒ‡ä»¤"><a href="#14-5-1-serviceç®¡ç†æŒ‡ä»¤" class="headerlink" title="14.5.1 serviceç®¡ç†æŒ‡ä»¤"></a>14.5.1 serviceç®¡ç†æŒ‡ä»¤</h4><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs coq">service æœåŠ¡å [start|<span class="hljs-type">stop</span>|<span class="hljs-type">restart</span>|<span class="hljs-type">reload</span>|<span class="hljs-type">status</span>]<br>åœ¨CentOS <span class="hljs-number">7.0</span> å,ä¸å†ä½¿ç”¨service,è€Œæ˜¯ systemctl(ubuntuä¹Ÿæ˜¯ä½¿ç”¨systemctl)<br></code></pre></td></tr></table></figure><p>åœ¨<code>/etc/init.d</code>ä¸‹ï¼Œå¯ä»¥æŸ¥çœ‹serviceæŒ‡ä»¤ç®¡ç†çš„æœåŠ¡ã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20220224193758012.png"></p><p>ä½¿ç”¨å®ä¾‹ï¼š</p><p>å®ä¾‹1ï¼šä½¿ç”¨<code>service</code>æŒ‡ä»¤ï¼ŒæŸ¥çœ‹ã€å…³é—­ã€å¯åŠ¨networkã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">service network status<br>service network stop<br>service network start  <br></code></pre></td></tr></table></figure><h4 id="14-5-2-æŸ¥çœ‹æœåŠ¡å"><a href="#14-5-2-æŸ¥çœ‹æœåŠ¡å" class="headerlink" title="14.5.2 æŸ¥çœ‹æœåŠ¡å"></a>14.5.2 æŸ¥çœ‹æœåŠ¡å</h4><p>æ–¹å¼ 1 ï¼šä½¿ç”¨setup-&gt; ç³»ç»ŸæœåŠ¡ å°±å¯ä»¥çœ‹åˆ°ï¼ˆå¯ä»¥æŸ¥çœ‹å…¨éƒ¨æœåŠ¡ï¼Œè®¸å¤šå‘è¡Œç‰ˆä¸æ”¯æŒäº†ï¼‰</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">setup<br></code></pre></td></tr></table></figure><p>æ–¹å¼ 2 : /etc/init.d/æœåŠ¡åç§°ï¼ˆåªèƒ½æŸ¥çœ‹ä¸€éƒ¨åˆ†ï¼‰</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ls -l /etc/init.d<br></code></pre></td></tr></table></figure><h4 id="14-5-3-æœåŠ¡çš„è¿è¡Œçº§åˆ«-runlevel"><a href="#14-5-3-æœåŠ¡çš„è¿è¡Œçº§åˆ«-runlevel" class="headerlink" title="14.5.3 æœåŠ¡çš„è¿è¡Œçº§åˆ«(runlevel)"></a>14.5.3 æœåŠ¡çš„è¿è¡Œçº§åˆ«(runlevel)</h4><p>Linuxç³»ç»Ÿæœ‰ 7 ç§è¿è¡Œçº§åˆ«(runlevel)ï¼šå¸¸ç”¨çš„æ˜¯çº§åˆ« 3 å’Œ 5</p><ul><li>è¿è¡Œçº§åˆ« 0 ï¼šç³»ç»ŸåœæœºçŠ¶æ€ï¼Œç³»ç»Ÿé»˜è®¤è¿è¡Œçº§åˆ«ä¸èƒ½è®¾ä¸º 0 ï¼Œå¦åˆ™ä¸èƒ½æ­£å¸¸å¯åŠ¨</li><li>è¿è¡Œçº§åˆ« 1 ï¼šå•ç”¨æˆ·å·¥ä½œçŠ¶æ€ï¼Œrootæƒé™ï¼Œç”¨äºç³»ç»Ÿç»´æŠ¤ï¼Œç¦æ­¢è¿œç¨‹ç™»é™†</li><li>è¿è¡Œçº§åˆ« 2 ï¼šå¤šç”¨æˆ·çŠ¶æ€(æ²¡æœ‰NFS)ï¼Œä¸æ”¯æŒç½‘ç»œ</li><li>è¿è¡Œçº§åˆ« 3 ï¼šå®Œå…¨çš„å¤šç”¨æˆ·çŠ¶æ€(æœ‰NFS)ï¼Œç™»é™†åè¿›å…¥æ§åˆ¶å°å‘½ä»¤è¡Œæ¨¡å¼</li><li>è¿è¡Œçº§åˆ« 4 ï¼šç³»ç»Ÿæœªä½¿ç”¨ï¼Œä¿ç•™</li><li>è¿è¡Œçº§åˆ« 5 ï¼šX 11 æ§åˆ¶å°ï¼Œç™»é™†åè¿›å…¥å›¾å½¢GUIæ¨¡å¼</li><li>è¿è¡Œçº§åˆ« 6 ï¼šç³»ç»Ÿæ­£å¸¸å…³é—­å¹¶é‡å¯ï¼Œé»˜è®¤è¿è¡Œçº§åˆ«ä¸èƒ½è®¾ä¸º 6 ï¼Œå¦åˆ™ä¸èƒ½æ­£å¸¸å¯åŠ¨</li></ul><h4 id="14-5-4-Linuxå¼€æœºçš„æµç¨‹è¯´æ˜"><a href="#14-5-4-Linuxå¼€æœºçš„æµç¨‹è¯´æ˜" class="headerlink" title="14.5.4 Linuxå¼€æœºçš„æµç¨‹è¯´æ˜"></a>14.5.4 Linuxå¼€æœºçš„æµç¨‹è¯´æ˜</h4><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20220224194756970.png"></p><h4 id="14-5-5-chkconfigæŒ‡ä»¤"><a href="#14-5-5-chkconfigæŒ‡ä»¤" class="headerlink" title="14.5.5 chkconfigæŒ‡ä»¤"></a>14.5.5 chkconfigæŒ‡ä»¤</h4><p>ä»‹ç»ï¼š</p><ol><li>é€šè¿‡chkconfigå‘½ä»¤å¯ä»¥ç»™æœåŠ¡çš„å„ä¸ªè¿è¡Œçº§åˆ«è®¾ç½®è‡ª å¯åŠ¨/å…³é—­</li><li>chkconfigå‘½ä»¤ç®¡ç†çš„æœåŠ¡åœ¨<code>/etc/init.d</code>æŸ¥çœ‹</li><li>æ³¨æ„ï¼šcentos7.0åï¼Œå¾ˆå¤šæœåŠ¡ä½¿ç”¨<code>systemctl</code>ç®¡ç†</li></ol><p>åŸºæœ¬è¯­æ³•ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">chkconfig --list [| grep xxx] #æŸ¥çœ‹chkconfigç®¡ç†çš„æœåŠ¡ä»¥åŠå„ä¸ªè¿è¡Œçº§åˆ«ä¸‹è‡ªå¯åŠ¨æƒ…å†µ<br>chkconfig --level 5 æœåŠ¡å on/off   #å°†æŸä¸ªæœåŠ¡åœ¨è¿è¡Œçº§åˆ«5ä¸‹ï¼Œè‡ªå¯åŠ¨onè¿˜æ˜¯off<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨ç»†èŠ‚ï¼šchkconfigé‡æ–°è®¾ç½®æœåŠ¡åè‡ªåŠ¨å¯åŠ¨æˆ–å…³é—­ï¼Œéœ€è¦é‡å¯æœºå™¨ç”Ÿæ•ˆã€‚</p><h4 id="14-5-6-systemctlç®¡ç†æŒ‡ä»¤"><a href="#14-5-6-systemctlç®¡ç†æŒ‡ä»¤" class="headerlink" title="14.5.6 systemctlç®¡ç†æŒ‡ä»¤"></a>14.5.6 systemctlç®¡ç†æŒ‡ä»¤</h4><p>åŸºæœ¬è¯­æ³•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">systemctl [start | stop | restart | status] æœåŠ¡å<br></code></pre></td></tr></table></figure><p>systemctlæŒ‡ä»¤ç®¡ç†çš„æœåŠ¡åœ¨<code>/usr/lib/systemd/system</code>æŸ¥çœ‹ã€‚</p><p>systemctlè®¾ç½®æœåŠ¡çš„è‡ªå¯åŠ¨çŠ¶æ€</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">systemctl list-unit-files [ | grep æœåŠ¡å] #æŸ¥çœ‹æ‰€æœ‰æœåŠ¡ä»¥åŠå…¶è‡ªå¯åŠ¨çŠ¶æ€,grepå¯ä»¥è¿›è¡Œè¿‡æ»¤<br>systemctl enable æœåŠ¡å #è®¾ç½®æœåŠ¡å¼€æœºå¯åŠ¨<br>systemctl disable æœåŠ¡å #å…³é—­æœåŠ¡å¼€æœºå¯åŠ¨<br>systemctl is-enable æœåŠ¡å #æŸ¥è¯¢æŸä¸ªæœåŠ¡æ˜¯å¦æ˜¯è‡ªå¯åŠ¨çš„<br>è¿™é‡Œä¸æŒ‡å®šè¿è¡Œçº§åˆ«ï¼Œæ˜¯å› ä¸ºCentoså°†è¿è¡Œçº§åˆ«ç®€åŒ–ä¸ºäº†3å’Œ5ï¼Œè¿™é‡Œéƒ½æ˜¯é’ˆå¯¹3å’Œ5è¯´çš„<br></code></pre></td></tr></table></figure><p>åº”ç”¨æ¡ˆä¾‹</p><p>æ¡ˆä¾‹1ï¼šæŸ¥çœ‹é˜²ç«å¢™å½“å‰çŠ¶æ€ï¼Œå…³é—­é˜²ç«å¢™å’Œé‡å¯é˜²ç«å¢™</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">systemctl status firewalld<br>systemctl stop firewalld<br>systemtl restart firewalld<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20220224202132630.png"></p><p>ç»†èŠ‚è®¨è®ºï¼š</p><ol><li><p>å…³é—­æˆ–è€…å¯åŠ¨é˜²ç«å¢™åï¼Œç«‹å³ç”Ÿæ•ˆã€‚ä½¿ç”¨telnetæŸ¥çœ‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">telnet ip:port<br></code></pre></td></tr></table></figure></li><li><p>è¿™ç§æ–¹å¼åªæ˜¯ä¸´æ—¶ç”Ÿæ•ˆï¼Œå½“é‡å¯ç³»ç»Ÿåï¼Œè¿˜æ˜¯å›å½’ä»¥å‰å¯¹æœåŠ¡çš„è®¾ç½®ã€‚</p></li><li><p>å¦‚æœå¸Œæœ›è®¾ç½®æŸä¸ªæœåŠ¡è‡ªå¯åŠ¨æˆ–å…³é—­æ°¸ä¹…ç”Ÿæ•ˆï¼Œè¦ä½¿ç”¨<code>systemctl [enable | disable] æœåŠ¡å</code></p></li></ol><h4 id="14-5-7-telnetå‘½ä»¤"><a href="#14-5-7-telnetå‘½ä»¤" class="headerlink" title="14.5.7 telnetå‘½ä»¤"></a>14.5.7 telnetå‘½ä»¤</h4><p>Linux telnetå‘½ä»¤ç”¨äºè¿œç«¯ç™»å…¥ã€‚æ‰§è¡ŒtelnetæŒ‡ä»¤å¼€å¯ç»ˆç«¯æœºé˜¶æ®µä½œä¸šï¼Œå¹¶ç™»å…¥è¿œç«¯ä¸»æœºã€‚</p><p>åŸºæœ¬è¯­æ³•ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">telnet ä¸»æœºåç§°|ip<br>æˆ–è€…<br>telnet ä¸»æœºåç§°|ip:port<br></code></pre></td></tr></table></figure><h4 id="14-5-8-firewallå‘½ä»¤"><a href="#14-5-8-firewallå‘½ä»¤" class="headerlink" title="14.5.8 firewallå‘½ä»¤"></a>14.5.8 firewallå‘½ä»¤</h4><p>åœ¨çœŸæ­£çš„ç”Ÿäº§ç¯å¢ƒï¼Œå¾€å¾€éœ€è¦å°†é˜²ç«å¢™æ‰“å¼€ï¼Œä½†é—®é¢˜æ¥äº†ï¼Œå¦‚æœæˆ‘ä»¬æŠŠé˜²ç«å¢™æ‰“å¼€ï¼Œé‚£ä¹ˆå¤–éƒ¨è¯·æ±‚æ•°æ®åŒ…å°±ä¸èƒ½è·ŸæœåŠ¡å™¨ç›‘å¬ç«¯å£é€šè®¯ã€‚è¿™æ—¶ï¼Œéœ€è¦æ‰“å¼€æŒ‡å®šçš„ç«¯å£ã€‚</p><p>åŸºæœ¬è¯­æ³•ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">firewall-cmd --permanent --add-port=ç«¯å£å·/åè®®   #æ‰“å¼€ç«¯å£<br>firewall-cmd --permanent --remove-port=ç«¯å£å·/åè®® #å…³é—­ç«¯å£<br>firewall-cmd --reload#é‡æ–°è½½å…¥ï¼Œæ‰èƒ½ç”Ÿæ•ˆ<br>firewall-cmd --query-port=ç«¯å£å·/åè®®#æŸ¥è¯¢ç«¯å£æ˜¯å¦å¼€æ”¾<br></code></pre></td></tr></table></figure><p>åº”ç”¨å®ä¾‹ï¼š</p><p>æ¡ˆä¾‹1ï¼šå¼€æ”¾111ç«¯å£</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">firewall-cmd --permanent --add-port=111/tcp<br>firewall-cmd --reload<br></code></pre></td></tr></table></figure><p>æ¡ˆä¾‹2ï¼šå…³é—­111ç«¯å£</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">firewall-cmd --permanent --remove-port=111/tcp<br>firewall-cmd --reload<br></code></pre></td></tr></table></figure><h3 id="14-6-åŠ¨æ€ç›‘æ§è¿›ç¨‹"><a href="#14-6-åŠ¨æ€ç›‘æ§è¿›ç¨‹" class="headerlink" title="14.6 åŠ¨æ€ç›‘æ§è¿›ç¨‹"></a>14.6 åŠ¨æ€ç›‘æ§è¿›ç¨‹</h3><p>ä»‹ç»ï¼š</p><p>topä¸pså‘½ä»¤å¾ˆç›¸ä¼¼ã€‚å®ƒä»¬éƒ½ç”¨æ¥æ˜¾ç¤ºæ­£åœ¨æ‰§è¡Œçš„è¿›ç¨‹ã€‚topä¸psæœ€å¤§çš„ä¸åŒä¹‹å¤„ï¼Œåœ¨äºtopåœ¨æ‰§è¡Œä¸€æ®µæ—¶é—´å¯ä»¥æ›´æ–°æ­£åœ¨è¿è¡Œçš„çš„è¿›ç¨‹ã€‚</p><p>åŸºæœ¬è¯­æ³•ï¼š </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">top [é€‰é¡¹]<br></code></pre></td></tr></table></figure><p>é€‰é¡¹è¯´æ˜ï¼š</p><table><thead><tr><th>é€‰é¡¹</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td>-d ç§’æ•°</td><td>æŒ‡å®štopå‘½ä»¤æ¯éš”å‡ ç§’æ›´æ–°ï¼Œé»˜è®¤æ˜¯3ç§’ã€‚</td></tr><tr><td>-i</td><td>æ˜¯topä¸æ˜¾ç¤ºä»»ä½•é—²ç½®æˆ–è€…åƒµæ­»è¿›ç¨‹</td></tr><tr><td>-p</td><td>é€šè¿‡æŒ‡å®šç›‘æ§è¿›ç¨‹idæ¥ä»…ä»…é‡‘æ§æŸä¸ªè¿›ç¨‹çš„çŠ¶æ€</td></tr></tbody></table><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20220224205016495.png"></p><p>å„é¡¹è§£é‡Šï¼š</p><p>topï¼šç³»ç»Ÿæ—¶é—´ï¼›upï¼šç™»å½•ç”¨æˆ·æ•°ï¼›load averageï¼šè´Ÿè½½å‡è¡¡</p><p>Tasksï¼šè¿›ç¨‹æ•°ï¼›runningï¼šè¿è¡Œè¿›ç¨‹æ•°ï¼›sleepingï¼šç¡çœ è¿›ç¨‹æ•°ï¼›stoppedï¼šåœæ­¢è¿›ç¨‹ï¼›zombieï¼šåƒµæ­»è¿›ç¨‹æ•°(è¿›ç¨‹å·²æ­»ï¼Œå†…å­˜æœªé‡Šæ”¾)</p><p>%Cpuï¼ˆsï¼‰ï¼šusï¼šç”¨æˆ·å ç”¨Cpuæ¯”ç‡ï¼›syï¼šç³»ç»Ÿå ç”¨Cpuæ¯”ç‡ï¼›ni:ç”¨æˆ·è¿›ç¨‹ç©ºé—´å†…æ”¹å˜è¿‡ä¼˜å…ˆçº§çš„è¿›ç¨‹å ç”¨Cpuæ¯”ç‡ï¼›idï¼šç©ºé—²Cpuæ¯”ç‡ï¼›waï¼šç­‰å¾…è¾“å…¥è¾“å‡ºçš„cpuæ—¶é—´å æ¯”ï¼›siï¼šè½¯ç»ˆç«¯å ç”¨ç™¾åˆ†æ¯”ï¼›stï¼šè™šæ‹Ÿæœºå ç”¨ç™¾åˆ†æ¯”</p><p>KiB Memï¼štotalï¼šç‰©ç†å†…å­˜æ€»é‡ï¼›usedï¼šä½¿ç”¨çš„ç‰©ç†å†…å­˜æ€»é‡ï¼›freeï¼šç©ºé—²å†…å­˜æ€»é‡ï¼›buffersï¼šç”¨ä½œå†…æ ¸ç¼“å†²çš„å†…å­˜é‡</p><p>KiB Swapï¼štotalï¼šäº¤æ¢åŒºæ€»é‡ï¼›usedï¼šä½¿ç”¨çš„äº¤æ¢åŒºæ€»é‡ï¼›freeï¼šç©ºé—²äº¤æ¢åŒºæ€»é‡ï¼›cachedï¼šç¼“å†²çš„äº¤æ¢åŒºæ€»é‡ï¼Œå†…å­˜ä¸­çš„å†…å®¹è¢«æ¢å‡ºåˆ°äº¤æ¢åŒºï¼Œè€Œååˆè¢«æ¢å…¥åˆ°å†…å­˜ï¼Œä½†ä½¿ç”¨è¿‡å¾—äº¤æ¢åŒºå°šæœªè¢«è¦†ç›–ï¼Œè¯¥æ•°å€¼å³ä¸ºè¿™äº›å†…å®¹å·²å­˜åœ¨äºå†…å­˜ä¸­çš„äº¤æ¢åŒºçš„å¤§å°ï¼Œç›¸åº”çš„å†…å­˜å†æ¬¡è¢«æ¢å‡ºæ˜¯å¯ä¸å¿…å†å¯¹äº¤æ¢åŒºå†™å…¥ã€‚</p><p>PR:ä¼˜å…ˆçº§;NI:niceå€¼ã€‚è´Ÿå€¼ä»£è¡¨é«˜ä¼˜å…ˆçº§ï¼Œæ­£å€¼ä»£è¡¨ä½ä¼˜å…ˆçº§;VIRT:è¿›ç¨‹ä½¿ç”¨çš„è™šæ‹Ÿå†…å­˜æ€»é‡ï¼Œå•ä½kbã€‚VIRT = SWAP + RES;RES:è¿›ç¨‹ä½¿ç”¨çš„ã€æœªè¢«æ¢å‡ºçš„ç‰©ç†å†…å­˜å¤§å°ï¼Œå•ä½kbã€‚RES = CODE + DATA;SHR:å…±äº«å†…å­˜å¤§å°ï¼Œå•ä½kb;S:è¿›ç¨‹çŠ¶æ€ï¼ˆD=ä¸å¯ä¸­æ–­çš„ç¡çœ çŠ¶æ€ï¼ŒR=è¿è¡Œï¼ŒS=ç¡çœ ï¼ŒT=è·Ÿè¸ª/é€šçŸ¥ï¼ŒZ=åƒµå°¸è¿›ç¨‹ï¼‰</p><p>äº¤äº’æ“ä½œè¯´æ˜ï¼š</p><table><thead><tr><th>æ“ä½œ</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td>P</td><td>ä»¥CPUä½¿ç”¨ç‡æ’åºï¼Œé»˜è®¤å°±æ˜¯æ­¤é¡¹</td></tr><tr><td>M</td><td>ä»¥å†…å­˜ä½¿ç”¨ç‡æ’åº</td></tr><tr><td>N</td><td>ä»¥PIDæ’åº</td></tr><tr><td>q</td><td>é€€å‡ºtop</td></tr></tbody></table><p>åº”ç”¨å®ä¾‹ï¼š</p><p>æ¡ˆä¾‹1ï¼šç›‘è§†ç‰¹å®šç”¨æˆ·</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">top <br>u ç”¨æˆ·å<br></code></pre></td></tr></table></figure><p>topï¼šè¾“å…¥æ­¤å‘½ä»¤ï¼ŒæŒ‰å›è½¦é”®ï¼ŒæŸ¥çœ‹æ‰§è¡Œçš„è¿›ç¨‹ã€‚<br>uï¼šç„¶åè¾“å…¥â€œuâ€å›è½¦ï¼Œå†è¾“å…¥ç”¨æˆ·åï¼Œå³å¯ã€‚</p><p>æ¡ˆä¾‹ 2 ï¼šç»ˆæ­¢æŒ‡å®šçš„è¿›ç¨‹ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">top<br>k PID<br></code></pre></td></tr></table></figure><p>topï¼šè¾“å…¥æ­¤å‘½ä»¤ï¼ŒæŒ‰å›è½¦é”®ï¼ŒæŸ¥çœ‹æ‰§è¡Œçš„è¿›ç¨‹ã€‚</p><p>kï¼šç„¶åè¾“å…¥â€œkâ€å›è½¦ï¼Œå†è¾“å…¥è¦ç»“æŸçš„è¿›ç¨‹IDå·</p><p>æ¡ˆä¾‹ 3 :æŒ‡å®šç³»ç»ŸçŠ¶æ€æ›´æ–°çš„æ—¶é—´(æ¯éš” 10 ç§’è‡ªåŠ¨æ›´æ–°ï¼Œ é»˜è®¤æ˜¯ 3 ç§’)ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs SHELL">top -d 10<br></code></pre></td></tr></table></figure><h3 id="14-7-æŸ¥çœ‹ç³»ç»Ÿç½‘ç»œæƒ…å†µnetstat-é‡è¦"><a href="#14-7-æŸ¥çœ‹ç³»ç»Ÿç½‘ç»œæƒ…å†µnetstat-é‡è¦" class="headerlink" title="14.7 æŸ¥çœ‹ç³»ç»Ÿç½‘ç»œæƒ…å†µnetstat(é‡è¦)"></a>14.7 æŸ¥çœ‹ç³»ç»Ÿç½‘ç»œæƒ…å†µnetstat(é‡è¦)</h3><p>åŸºæœ¬è¯­æ³•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">netstat [é€‰é¡¹]<br>netstat -anp<br></code></pre></td></tr></table></figure><p>é€‰é¡¹è¯´æ˜</p><p>â€‹    -a (all)æ˜¾ç¤ºæ‰€æœ‰é€‰é¡¹ï¼Œé»˜è®¤ä¸æ˜¾ç¤ºLISTENç›¸å…³<br>â€‹    -t (tcp)ä»…æ˜¾ç¤ºtcpç›¸å…³é€‰é¡¹<br>â€‹    -u (udp)ä»…æ˜¾ç¤ºudpç›¸å…³é€‰é¡¹<br>â€‹    -n æ‹’ç»æ˜¾ç¤ºåˆ«åï¼Œèƒ½æ˜¾ç¤ºæ•°å­—çš„å…¨éƒ¨è½¬åŒ–æˆæ•°å­—ã€‚<br>â€‹    -l ä»…åˆ—å‡ºæœ‰åœ¨ Listen (ç›‘å¬) çš„æœå‹™çŠ¶æ€</p><p>â€‹    -p æ˜¾ç¤ºå»ºç«‹ç›¸å…³é“¾æ¥çš„è¿›ç¨‹<br>â€‹    -r æ˜¾ç¤ºè·¯ç”±ä¿¡æ¯ï¼Œè·¯ç”±è¡¨<br>â€‹    -e æ˜¾ç¤ºæ‰©å±•ä¿¡æ¯ï¼Œä¾‹å¦‚uidç­‰<br>â€‹    -s æŒ‰å„ä¸ªåè®®è¿›è¡Œç»Ÿè®¡<br>â€‹    -c æ¯éš”ä¸€ä¸ªå›ºå®šæ—¶é—´ï¼Œæ‰§è¡Œè¯¥netstatå‘½ä»¤ã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20220225131410928.png"></p><p>åº”ç”¨æ¡ˆä¾‹<br>æ¡ˆä¾‹1ï¼šæŸ¥çœ‹ç³»ç»Ÿæ‰€æœ‰çš„ç½‘ç»œæœåŠ¡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">netstat -anp<br></code></pre></td></tr></table></figure><p>æ¡ˆä¾‹2ï¼šè¯·æŸ¥çœ‹æœåŠ¡åä¸º sshd çš„æœåŠ¡çš„ä¿¡æ¯ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">netstat -anp | grep sshd<br></code></pre></td></tr></table></figure><h2 id="åäº”ã€RPM-å’Œ-YUM"><a href="#åäº”ã€RPM-å’Œ-YUM" class="headerlink" title="åäº”ã€RPM å’Œ YUM"></a>åäº”ã€RPM å’Œ YUM</h2><h3 id="15-1-RPMåŒ…çš„ç®¡ç†"><a href="#15-1-RPMåŒ…çš„ç®¡ç†" class="headerlink" title="15.1 RPMåŒ…çš„ç®¡ç†"></a>15.1 RPMåŒ…çš„ç®¡ç†</h3><h4 id="15-1-1ä»‹ç»"><a href="#15-1-1ä»‹ç»" class="headerlink" title="15.1.1ä»‹ç»"></a>15.1.1ä»‹ç»</h4><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs arduino">rmpä¸€ç§ç”¨äºäº’è”ç½‘ä¸‹è½½åŒ…çš„æ‰“åŒ…åŠå®‰è£…å·¥å…·ï¼Œå®ƒåŒ…å«åœ¨æŸäº›Linuxåˆ†å‘ç‰ˆä¸­ã€‚<br>å®ƒç”Ÿæˆå…·æœ‰.RPMæ‰©å±•åçš„æ–‡ä»¶ã€‚RPMæ˜¯RedHatPackageManagerï¼ˆRedHatè½¯ä»¶åŒ…ç®¡ç†å·¥å…·ï¼‰çš„ç¼©å†™ï¼Œç±»ä¼¼windowsçš„setup.exeï¼Œè¿™ä¸€æ–‡ä»¶æ ¼å¼åç§°è™½ç„¶æ‰“ä¸Šäº†RedHatçš„æ ‡å¿—ï¼Œä½†ç†å¿µæ˜¯é€šç”¨çš„ã€‚<br>Linuxçš„åˆ†å‘ç‰ˆæœ¬éƒ½æœ‰é‡‡ç”¨ï¼ˆsuse,redhat,centosç­‰ç­‰ï¼‰ï¼Œå¯ä»¥ç®—æ˜¯å…¬è®¤çš„è¡Œä¸šæ ‡å‡†äº†ã€‚<br></code></pre></td></tr></table></figure><h4 id="15-1-2-rpmåŒ…çš„ç®€å•æŸ¥è¯¢æŒ‡ä»¤"><a href="#15-1-2-rpmåŒ…çš„ç®€å•æŸ¥è¯¢æŒ‡ä»¤" class="headerlink" title="15.1.2 rpmåŒ…çš„ç®€å•æŸ¥è¯¢æŒ‡ä»¤"></a>15.1.2 rpmåŒ…çš„ç®€å•æŸ¥è¯¢æŒ‡ä»¤</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">æŸ¥è¯¢å·²å®‰è£…çš„rpmåˆ—è¡¨</span> <br>rpm â€“qa | grep xx<br></code></pre></td></tr></table></figure><p>åº”ç”¨å®ä¾‹ï¼š</p><p>æ¡ˆä¾‹1ï¼šè¯·æŸ¥è¯¢çœ‹ä¸€ä¸‹ï¼Œå½“å‰çš„Linuxæœ‰æ²¡æœ‰å®‰è£… firefox.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">rpm -qa | grep firefox<br></code></pre></td></tr></table></figure><h4 id="15-1-3-rpmåŒ…ååŸºæœ¬æ ¼å¼"><a href="#15-1-3-rpmåŒ…ååŸºæœ¬æ ¼å¼" class="headerlink" title="15.1.3 rpmåŒ…ååŸºæœ¬æ ¼å¼"></a>15.1.3 rpmåŒ…ååŸºæœ¬æ ¼å¼</h4><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs stylus">ä¸€ä¸ªrpmåŒ…åï¼šfirefox-<span class="hljs-number">45.0</span>.<span class="hljs-number">1</span>-<span class="hljs-number">1</span><span class="hljs-selector-class">.el6</span><span class="hljs-selector-class">.centos</span><span class="hljs-selector-class">.x86_64</span><span class="hljs-selector-class">.rpm</span><br>åç§°:         firefox<br>ç‰ˆæœ¬å·ï¼š        <span class="hljs-number">45.0</span>.<span class="hljs-number">1</span>-<span class="hljs-number">1</span><br>é€‚ç”¨æ“ä½œç³»ç»Ÿ:    el6<span class="hljs-selector-class">.centos</span><span class="hljs-selector-class">.x86_64</span><br>è¡¨ç¤ºcentos <span class="hljs-number">6</span>.xçš„<span class="hljs-number">64</span>ä½ç³»ç»Ÿ<br>å¦‚æœæ˜¯i686 ã€i386 è¡¨ç¤º <span class="hljs-number">32</span> ä½ç³»ç»Ÿï¼Œnoarchè¡¨ç¤ºé€šç”¨ã€‚<br></code></pre></td></tr></table></figure><h4 id="15-1-4-rpmåŒ…çš„å…¶å®ƒæŸ¥è¯¢æŒ‡ä»¤ï¼š"><a href="#15-1-4-rpmåŒ…çš„å…¶å®ƒæŸ¥è¯¢æŒ‡ä»¤ï¼š" class="headerlink" title="15.1.4 rpmåŒ…çš„å…¶å®ƒæŸ¥è¯¢æŒ‡ä»¤ï¼š"></a>15.1.4 rpmåŒ…çš„å…¶å®ƒæŸ¥è¯¢æŒ‡ä»¤ï¼š</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">rpm -qa #æŸ¥è¯¢æ‰€å®‰è£…çš„æ‰€æœ‰rpmè½¯ä»¶åŒ…<br>rpm -qa | more#[åˆ†é¡µæ˜¾ç¤º]<br>rpm -qa | grep X[rpm-qa|grepfirefox]<br>rpm -q è½¯ä»¶åŒ…å  #æŸ¥è¯¢è½¯ä»¶åŒ…æ˜¯å¦å®‰è£…ï¼Œä¾‹å¦‚ï¼šrpm -q firefox<br>rpm -qi è½¯ä»¶åŒ…å  #æŸ¥è¯¢è½¯ä»¶åŒ…ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼šrpm -qi firefox<br>rpm -ql è½¯ä»¶æŠ¥å #æŸ¥è¯¢è½¯ä»¶åŒ…ä¸­çš„æ–‡ä»¶ï¼Œä¾‹å¦‚rpm -ql firefox<br>rpm -qf æ–‡ä»¶å…¨è·¯å¾„å   #æŸ¥è¯¢æ–‡ä»¶æ‰€å±è½¯ä»¶åŒ…,ä¾‹å¦‚rpm -qf /etc/passwd;rpm -qf /root/install.log<br></code></pre></td></tr></table></figure><h4 id="15-1-5-å¸è½½rpmåŒ…ï¼š"><a href="#15-1-5-å¸è½½rpmåŒ…ï¼š" class="headerlink" title="15.1.5 å¸è½½rpmåŒ…ï¼š"></a>15.1.5 å¸è½½rpmåŒ…ï¼š</h4><p>åŸºæœ¬è¯­æ³•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">rpm -e RPMåŒ…çš„åç§°  #eæ˜¯eraseåˆ é™¤çš„æ„æ€<br></code></pre></td></tr></table></figure><p>åº”ç”¨æ¡ˆä¾‹<br>æ¡ˆä¾‹1ï¼š åˆ é™¤firefox è½¯ä»¶åŒ…</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">rpm -e firefox<br></code></pre></td></tr></table></figure><p>ç»†èŠ‚é—®é¢˜</p><ol><li><p>å¦‚æœå…¶å®ƒè½¯ä»¶åŒ…ä¾èµ–äºæ‚¨è¦å¸è½½çš„è½¯ä»¶åŒ…ï¼Œå¸è½½æ—¶åˆ™ä¼šäº§ç”Ÿé”™è¯¯ä¿¡æ¯ã€‚å¦‚ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">rpm -e foo<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">error:<br>removing these packages would break dependencies: foo is needed by bar-1.0-1<br></code></pre></td></tr></table></figure></li><li><p>å¦‚æœæˆ‘ä»¬å°±æ˜¯è¦åˆ é™¤ fooè¿™ä¸ªrpm åŒ…ï¼Œå¯ä»¥å¢åŠ å‚æ•° â€“nodeps,å°±å¯ä»¥å¼ºåˆ¶åˆ é™¤ï¼Œä½†æ˜¯ä¸€èˆ¬ä¸æ¨èè¿™æ ·åšï¼Œå› ä¸ºä¾èµ–äºè¯¥è½¯ä»¶åŒ…çš„ç¨‹åºå¯èƒ½æ— æ³•è¿è¡Œã€‚å¦‚ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">rpm -e --nodeps foo #å¸¦ä¸Š --nodeps å°±æ˜¯å¼ºåˆ¶åˆ é™¤ã€‚<br></code></pre></td></tr></table></figure></li></ol><h4 id="15-1-6-å®‰è£…rpmåŒ…ï¼š"><a href="#15-1-6-å®‰è£…rpmåŒ…ï¼š" class="headerlink" title="15.1.6 å®‰è£…rpmåŒ…ï¼š"></a>15.1.6 å®‰è£…rpmåŒ…ï¼š</h4><p>åŸºæœ¬è¯­æ³•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">rpm -ivh RPMåŒ…å…¨è·¯å¾„åç§°<br></code></pre></td></tr></table></figure><p>å‚æ•°è¯´æ˜<br>    i=install å®‰è£…<br>    v=verbose æç¤º<br>    h=hash è¿›åº¦æ¡</p><p>åº”ç”¨å®ä¾‹<br>å®ä¾‹1ï¼š æ¼”ç¤ºå®‰è£…firefoxæµè§ˆå™¨<br>æ­¥éª¤å…ˆæ‰¾åˆ°firefoxçš„å®‰è£…rpm åŒ…,ä½ éœ€è¦æŒ‚è½½ä¸Šæˆ‘ä»¬å®‰è£…centosçš„isoæ–‡ä»¶ï¼Œç„¶ååˆ°/media/ä¸‹å»æ‰¾rpm æ‰¾ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">rpm -ivh firefox-45.0.1-1.el6.centos.x86_64.rpm<br></code></pre></td></tr></table></figure><h3 id="15-2-YUM"><a href="#15-2-YUM" class="headerlink" title="15.2 YUM"></a>15.2 YUM</h3><h4 id="15-2-1-ä»‹ç»ï¼š"><a href="#15-2-1-ä»‹ç»ï¼š" class="headerlink" title="15.2.1 ä»‹ç»ï¼š"></a>15.2.1 ä»‹ç»ï¼š</h4><p>Yum æ˜¯ä¸€ä¸ªShellå‰ç«¯è½¯ä»¶åŒ…ç®¡ç†å™¨ã€‚åŸºäºRPMåŒ…ç®¡ç†ï¼Œèƒ½å¤Ÿä»æŒ‡å®šçš„æœåŠ¡å™¨è‡ªåŠ¨ä¸‹è½½RPMåŒ…å¹¶ä¸”å®‰è£…ï¼Œå¯ä»¥<strong>è‡ªåŠ¨å¤„ç†ä¾èµ–æ€§å…³ç³»ï¼Œå¹¶ä¸”ä¸€æ¬¡å®‰è£…æ‰€æœ‰ä¾èµ–çš„è½¯ä»¶åŒ…</strong>ã€‚ä½¿ç”¨yumçš„å‰ææ˜¯å¯ä»¥è”ç½‘ã€‚</p><h4 id="15-2-2-yumçš„åŸºæœ¬æŒ‡ä»¤"><a href="#15-2-2-yumçš„åŸºæœ¬æŒ‡ä»¤" class="headerlink" title="15.2.2 yumçš„åŸºæœ¬æŒ‡ä»¤"></a>15.2.2 yumçš„åŸºæœ¬æŒ‡ä»¤</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">yum list | grep xx #æŸ¥è¯¢yumæœåŠ¡å™¨æ˜¯å¦æœ‰éœ€è¦å®‰è£…çš„è½¯ä»¶<br>yum install xx     #å®‰è£…æŒ‡å®šçš„yumåŒ…<br></code></pre></td></tr></table></figure><h4 id="15-2-3-yumåº”ç”¨å®ä¾‹"><a href="#15-2-3-yumåº”ç”¨å®ä¾‹" class="headerlink" title="15.2.3 yumåº”ç”¨å®ä¾‹"></a>15.2.3 yumåº”ç”¨å®ä¾‹</h4><p>æ¡ˆä¾‹1ï¼šè¯·ä½¿ç”¨yumçš„æ–¹å¼æ¥å®‰è£…firefox</p><ol><li><p>å…ˆæŸ¥çœ‹ä¸€ä¸‹ firefox rpm åœ¨yumæœåŠ¡å™¨æœ‰æ²¡æœ‰</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">yum list | grep firefox<br></code></pre></td></tr></table></figure></li><li><p>å®‰è£…yuminstallfirefoxä¼šå®‰è£…æœ€æ–°ç‰ˆæœ¬çš„è½¯ä»¶ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">yum install firefox<br></code></pre></td></tr></table></figure></li></ol><h2 id="åå…­ã€æ­å»º-JAVAEE-ç¯å¢ƒ"><a href="#åå…­ã€æ­å»º-JAVAEE-ç¯å¢ƒ" class="headerlink" title="åå…­ã€æ­å»º JAVAEE ç¯å¢ƒ"></a>åå…­ã€æ­å»º JAVAEE ç¯å¢ƒ</h2><h3 id="16-1-æ¦‚è¿°"><a href="#16-1-æ¦‚è¿°" class="headerlink" title="16.1 æ¦‚è¿°"></a>16.1 æ¦‚è¿°</h3><p>å¦‚æœéœ€è¦åœ¨Linuxä¸‹è¿›è¡ŒJavaEEçš„å¼€å‘ï¼Œæˆ‘ä»¬éœ€è¦å®‰è£…å¦‚ä¸‹è½¯ä»¶ï¼š</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20220225150900800.png"></p><h3 id="16-2-å®‰è£…JDK"><a href="#16-2-å®‰è£…JDK" class="headerlink" title="16.2 å®‰è£…JDK"></a>16.2 å®‰è£…JDK</h3><h4 id="16-2-1-å®‰è£…æ­¥éª¤"><a href="#16-2-1-å®‰è£…æ­¥éª¤" class="headerlink" title="16.2.1 å®‰è£…æ­¥éª¤"></a>16.2.1 å®‰è£…æ­¥éª¤</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs awk">mkdir <span class="hljs-regexp">/opt/</span>jdk<br>wget [ä¸‹è½½é“¾æ¥]  <span class="hljs-comment">#ä¸‹è½½JKDå®‰è£…åŒ…</span><br>tar -zxvf å®‰è£…åŒ…<br>mkdir <span class="hljs-regexp">/usr/</span>local/java<br>mv æ–‡ä»¶å¤¹ <span class="hljs-regexp">/usr/</span>local/java<br><br>è€Œé…ç½®ç¯å¢ƒå˜é‡,vim <span class="hljs-regexp">/etc/</span>profile<br>export JAVA_HOME=<span class="hljs-regexp">/opt/</span>jdk1.<span class="hljs-number">7.0</span>_79<br>export PATH=<span class="hljs-variable">$JAVA_HOME</span>/bin:<span class="hljs-variable">$PATH</span><br><br>éœ€è¦æ³¨é”€ç”¨æˆ·ï¼Œç¯å¢ƒå˜é‡æ‰èƒ½ç”Ÿæ•ˆã€‚<br>å¦‚æœæ˜¯åœ¨ <span class="hljs-number">3</span> è¿è¡Œçº§åˆ«ï¼Œ logout<br>å¦‚æœæ˜¯åœ¨ <span class="hljs-number">5</span> è¿è¡Œçº§åˆ«ï¼Œ source <span class="hljs-regexp">/etc/</span>profile<br></code></pre></td></tr></table></figure><h4 id="16-2-1-æµ‹è¯•æ˜¯å¦å®‰è£…æˆåŠŸ"><a href="#16-2-1-æµ‹è¯•æ˜¯å¦å®‰è£…æˆåŠŸ" class="headerlink" title="16.2.1 æµ‹è¯•æ˜¯å¦å®‰è£…æˆåŠŸ"></a>16.2.1 æµ‹è¯•æ˜¯å¦å®‰è£…æˆåŠŸ</h4><p>éšæ„æ‰¾ä¸€ä¸ªç›®å½•ï¼Œè¾“å…¥<code>javac --version &amp; java --version</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">javac --version<br>java --version<br></code></pre></td></tr></table></figure><h3 id="16-3-å®‰è£…TOMCAT"><a href="#16-3-å®‰è£…TOMCAT" class="headerlink" title="16.3 å®‰è£…TOMCAT"></a>16.3 å®‰è£…TOMCAT</h3><h4 id="16-3-1-æ­¥éª¤"><a href="#16-3-1-æ­¥éª¤" class="headerlink" title="16.3.1 æ­¥éª¤"></a>16.3.1 æ­¥éª¤</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">1.ä¸Šä¼ å®‰è£…æ–‡ä»¶ï¼Œå¹¶è§£å‹ç¼©åˆ°/opt/tomcat<br>2.è¿›å…¥è§£å‹ç›®å½•/bin,å¯åŠ¨tomcatï¼ˆ./startup.sh)<br>3.å¼€æ”¾8080ç«¯å£<br></code></pre></td></tr></table></figure><h4 id="16-3-2-æµ‹è¯•æ˜¯å¦å®‰è£…æˆåŠŸ"><a href="#16-3-2-æµ‹è¯•æ˜¯å¦å®‰è£…æˆåŠŸ" class="headerlink" title="16.3.2 æµ‹è¯•æ˜¯å¦å®‰è£…æˆåŠŸ"></a>16.3.2 æµ‹è¯•æ˜¯å¦å®‰è£…æˆåŠŸ</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">åœ¨windowsã€Linuxä¸‹è®¿é—® http://ip:8080<br></code></pre></td></tr></table></figure><h3 id="16-4-å®‰è£…IDEA"><a href="#16-4-å®‰è£…IDEA" class="headerlink" title="16.4 å®‰è£…IDEA"></a>16.4 å®‰è£…IDEA</h3><h4 id="16-4-1-æ­¥éª¤"><a href="#16-4-1-æ­¥éª¤" class="headerlink" title="16.4.1 æ­¥éª¤"></a>16.4.1 æ­¥éª¤</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">1. wget https://download.jetbrains.com/idea/ideaIU-2021.3.2.tar.gz?_gl=1*empi04*_ga*MTg0OTIyNTYuMTY0MzI1OTQ0Mw..*_ga_V0XZL7QHEB*MTY0NTc3NDI2OC40LjEuMTY0NTc3NDMwMy4w&amp;_ga=2.141732210.1541181338.1645774269-18492256.1643259443<br>2. tar -zxvf å®‰è£…åŒ… #è§£å‹ç¼©åˆ°/opt/idea<br>3. cd /opt/idea/bin<br>4. ./idea.sh<br>5. é…ç½®jdk<br></code></pre></td></tr></table></figure><h3 id="16-5-MYSQL5-7çš„å®‰è£…å’Œé…ç½®"><a href="#16-5-MYSQL5-7çš„å®‰è£…å’Œé…ç½®" class="headerlink" title="16.5 MYSQL5.7çš„å®‰è£…å’Œé…ç½®"></a>16.5 MYSQL5.7çš„å®‰è£…å’Œé…ç½®</h3><h4 id="16-5-1-å®‰è£…çš„æ­¥éª¤å’Œæ–‡æ¡£"><a href="#16-5-1-å®‰è£…çš„æ­¥éª¤å’Œæ–‡æ¡£" class="headerlink" title="16.5.1 å®‰è£…çš„æ­¥éª¤å’Œæ–‡æ¡£"></a>16.5.1 å®‰è£…çš„æ­¥éª¤å’Œæ–‡æ¡£</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs linux">1. mkdir /opt/mysql<br>2. wget http://dev.mysql.com/get/mysql-5.7.26-1.el7.x86_64.rpm-bundle.tar<br>3. tar -zxvf mysql-5.7.26-1.el7.x86-64.rpm-bundle.tar<br>4. rpm -qa | grep mari<br>5. rpm -e --nodep mariadb-libs #Centos7.6è‡ªå¸¦mariadbæ•°æ®åº“ï¼Œä¼šä¸mysqlå†²çªï¼Œéœ€è¦å…ˆåˆ é™¤<br>6. æŒ‰é¡ºåºæ‰§è¡Œï¼š<br>rpm -ivh mysql-community-common-5.7.26-1.el7.x86_64.rpm<br>rpm -ivh mysql-community-libs-5.7.26-1.el7.x86_64.rpm<br>rpm -ivh mysql-community-client-5.7.26-1.el7.x86_64.rpm<br>rpm -ivh mysql-community-server-5.7.26-1.el7.x86_64.rpm<br>7. systemctl start mysqld.service<br>8. grep &quot;password&quot; /var/log/mysqld.log #æŸ¥çœ‹å½“å‰å¯†ç <br>9. mysql -u root -p#rootç”¨æˆ·ç™»å½•<br>10. set global validate_password_policy=0; #æç¤ºå¯†ç è®¾ç½®ç­–ç•¥<br>11. set password for &#x27;root&#x27;@&#x27;localhost&#x27;=password(&#x27;mimamima&#x27;); #è®¾ç½®å¯†ç mimamima<br>12. flush privilegesï¼› #ä½¿å¯†ç è®¾ç½®ç”Ÿæ•ˆ<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20220225155613228.png"></p><h2 id="åä¸ƒã€Shell-ç¼–ç¨‹"><a href="#åä¸ƒã€Shell-ç¼–ç¨‹" class="headerlink" title="åä¸ƒã€Shell ç¼–ç¨‹"></a>åä¸ƒã€Shell ç¼–ç¨‹</h2><p>ä¸ºä»€ä¹ˆè¦å­¦ä¹ SHELLç¼–ç¨‹</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-number">1</span>.Linuxè¿ç»´å·¥ç¨‹å¸ˆåœ¨è¿›è¡ŒæœåŠ¡å™¨é›†ç¾¤ç®¡ç†æ—¶ï¼Œéœ€è¦ç¼–å†™<span class="hljs-keyword">Shell</span>ç¨‹åºæ¥è¿›è¡ŒæœåŠ¡å™¨ç®¡ç†ã€‚<br><span class="hljs-number">2</span>.å¯¹äºJavaEEå’ŒPythonç¨‹åºå‘˜æ¥è¯´ï¼Œå·¥ä½œçš„éœ€è¦ï¼Œä½ çš„è€å¤§ä¼šè¦æ±‚ä½ ç¼–å†™ä¸€äº›<span class="hljs-keyword">Shell</span>è„šæœ¬è¿›è¡Œç¨‹åºæˆ–è€…æ˜¯æœåŠ¡å™¨çš„ç»´æŠ¤ï¼Œæ¯”å¦‚ç¼–å†™ä¸€ä¸ªå®šæ—¶å¤‡ä»½æ•°æ®åº“çš„è„šæœ¬ã€‚<br><span class="hljs-number">3</span>.å¯¹äºå¤§æ•°æ®ç¨‹åºå‘˜æ¥è¯´ï¼Œéœ€è¦ç¼–å†™<span class="hljs-keyword">Shell</span>ç¨‹åºæ¥ç®¡ç†é›†ç¾¤ã€‚<br></code></pre></td></tr></table></figure><p>SHELLæ˜¯ä»€ä¹ˆ?</p><p>Shellæ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œè§£é‡Šå™¨ï¼Œå®ƒä¸ºç”¨æˆ·æä¾›äº†ä¸€ä¸ªå‘Linuxå†…æ ¸å‘é€è¯·æ±‚ä»¥ä¾¿è¿è¡Œç¨‹åºçš„ç•Œé¢ç³»ç»Ÿçº§ç¨‹åºï¼Œç”¨æˆ·å¯ä»¥ç”¨Shellæ¥å¯åŠ¨ã€æŒ‚èµ·ã€åœæ­¢ç”šè‡³æ˜¯ç¼–å†™ä¸€äº›ç¨‹åº.</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20220225202923215.png"></p><h3 id="17-1-SHELLè„šæœ¬çš„æ‰§è¡Œæ–¹å¼"><a href="#17-1-SHELLè„šæœ¬çš„æ‰§è¡Œæ–¹å¼" class="headerlink" title="17.1 SHELLè„šæœ¬çš„æ‰§è¡Œæ–¹å¼"></a>17.1 SHELLè„šæœ¬çš„æ‰§è¡Œæ–¹å¼</h3><h4 id="17-1-1-è„šæœ¬æ ¼å¼è¦æ±‚"><a href="#17-1-1-è„šæœ¬æ ¼å¼è¦æ±‚" class="headerlink" title="17.1.1 è„šæœ¬æ ¼å¼è¦æ±‚"></a>17.1.1 è„šæœ¬æ ¼å¼è¦æ±‚</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">1.è„šæœ¬ä»¥#!/bin/bashå¼€å¤´ (æˆ–è€…ä¸ç”¨æŒ‡å®šè§£é‡Šå™¨ï¼Œç›´æ¥ä½¿ç”¨bash xxx.shæ‰§è¡Œ)<br>2.è„šæœ¬éœ€è¦æœ‰å¯æ‰§è¡Œæƒé™<br></code></pre></td></tr></table></figure><h4 id="17-1-2-ç¼–å†™ç¬¬ä¸€ä¸ªShellè„šæœ¬"><a href="#17-1-2-ç¼–å†™ç¬¬ä¸€ä¸ªShellè„šæœ¬" class="headerlink" title="17.1.2 ç¼–å†™ç¬¬ä¸€ä¸ªShellè„šæœ¬"></a>17.1.2 ç¼–å†™ç¬¬ä¸€ä¸ªShellè„šæœ¬</h4><p>éœ€æ±‚è¯´æ˜ï¼šåˆ›å»ºä¸€ä¸ªShellè„šæœ¬ï¼Œè¾“å‡ºhelloworld!</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">vim helloworld.sh #(ä¹Ÿå¯ä»¥ä¸ä»¥.shä¸ºç»“å°¾ï¼Œä½†æ˜¯ä¸ºäº†è§„èŒƒå»ºè®®ä»¥.shä¸ºç»“å°¾)<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash">!/bin/bash</span><br>echo helloworld<br><br>chmod u+x helloworld.sh<br>./helloworld.sh<br></code></pre></td></tr></table></figure><h4 id="17-1-3-è„šæœ¬çš„å¸¸ç”¨æ‰§è¡Œæ–¹å¼"><a href="#17-1-3-è„šæœ¬çš„å¸¸ç”¨æ‰§è¡Œæ–¹å¼" class="headerlink" title="17.1.3 è„šæœ¬çš„å¸¸ç”¨æ‰§è¡Œæ–¹å¼"></a>17.1.3 è„šæœ¬çš„å¸¸ç”¨æ‰§è¡Œæ–¹å¼</h4><p>æ–¹å¼ 1 (è¾“å…¥è„šæœ¬çš„ç»å¯¹è·¯å¾„æˆ–ç›¸å¯¹è·¯å¾„)<br>1 )é¦–å…ˆè¦èµ‹äºˆhelloworld.sh è„šæœ¬çš„+xæƒé™<br>2 )æ‰§è¡Œè„šæœ¬</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">chomd u+x helloworld.sh<br>./helloworld.sh #æˆ–è€… ~/shcode/helloworld.sh<br></code></pre></td></tr></table></figure><p>æ–¹å¼ 2 (sh+è„šæœ¬çš„ç»å¯¹è·¯å¾„æˆ–è€…ç›¸å¯¹è·¯å¾„)ï¼Œä¸æ¨è<br>è¯´æ˜ï¼šä¸ç”¨èµ‹äºˆè„šæœ¬+xæƒé™ï¼Œç›´æ¥æ‰§è¡Œå³å¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">bash helloworld.sh<br></code></pre></td></tr></table></figure><h3 id="17-2-Shellçš„å˜é‡"><a href="#17-2-Shellçš„å˜é‡" class="headerlink" title="17.2 Shellçš„å˜é‡"></a>17.2 Shellçš„å˜é‡</h3><p>Shellçš„å˜é‡çš„ä»‹ç»</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">1 </span>ï¼‰LinuxShellä¸­çš„å˜é‡åˆ†ä¸ºï¼Œç³»ç»Ÿå˜é‡å’Œç”¨æˆ·è‡ªå®šä¹‰å˜é‡ã€‚<br><span class="hljs-symbol">2 </span>ï¼‰ç³»ç»Ÿå˜é‡ï¼š$HOMEã€$PWDã€$<span class="hljs-keyword">SHELL</span>ã€$USERç­‰ç­‰ã€‚æ¯”å¦‚ï¼šecho$HOME ç­‰ç­‰..<br><span class="hljs-symbol">3 </span>ï¼‰æ˜¾ç¤ºå½“å‰<span class="hljs-keyword">shell</span>ä¸­æ‰€æœ‰å˜é‡ï¼šä½¿ç”¨å‘½ä»¤setæ¥æŸ¥çœ‹<br></code></pre></td></tr></table></figure><h4 id="17-2-1-shellå˜é‡çš„å®šä¹‰"><a href="#17-2-1-shellå˜é‡çš„å®šä¹‰" class="headerlink" title="17.2.1 shellå˜é‡çš„å®šä¹‰"></a>17.2.1 shellå˜é‡çš„å®šä¹‰</h4><p>åŸºæœ¬è¯­æ³•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">1 )å®šä¹‰å˜é‡ï¼šå˜é‡=å€¼<br>2 )æ’¤é”€å˜é‡ï¼šunset å˜é‡<br>3 ) å£°æ˜é™æ€å˜é‡ï¼šreadonlyå˜é‡ï¼Œæ³¨æ„ï¼šä¸èƒ½unset<br></code></pre></td></tr></table></figure><p>åº”ç”¨æ¡ˆä¾‹ï¼š</p><p>æ¡ˆä¾‹ 1 ï¼šå®šä¹‰å˜é‡A</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">!/bin/bash</span><br>A=100<br>echo A = $A<br>echo &quot;A = %A&quot;<br></code></pre></td></tr></table></figure><p>æ¡ˆä¾‹ 2 ï¼šæ’¤é”€å˜é‡A</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">!/bin/bash</span><br>A=100<br>unset A<br></code></pre></td></tr></table></figure><p>æ¡ˆä¾‹ 3 ï¼šå£°æ˜é™æ€çš„å˜é‡B= 2 ï¼Œä¸èƒ½unset</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">!/bin/bash</span><br>readonly B=200<br>echo &quot;B = $B&quot;<br></code></pre></td></tr></table></figure><p>æ¡ˆä¾‹ 4 ï¼šå¯æŠŠå˜é‡æå‡ä¸ºå…¨å±€ç¯å¢ƒå˜é‡ï¼Œå¯ä¾›å…¶ä»–shellç¨‹åºä½¿ç”¨ã€ä¸€ä¼šä¸¾ä¾‹ã€‚ã€‘</p><h4 id="17-2-2å®šä¹‰å˜é‡çš„è§„åˆ™"><a href="#17-2-2å®šä¹‰å˜é‡çš„è§„åˆ™" class="headerlink" title="17.2.2å®šä¹‰å˜é‡çš„è§„åˆ™"></a>17.2.2å®šä¹‰å˜é‡çš„è§„åˆ™</h4><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-bullet">1.</span> å˜é‡åç§°å¯ä»¥ç”±å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿ç»„æˆï¼Œä½†æ˜¯ä¸èƒ½ä»¥æ•°å­—å¼€å¤´ã€‚<br><span class="hljs-bullet">2.</span> ç­‰å·ä¸¤ä¾§ä¸èƒ½æœ‰ç©ºæ ¼<br><span class="hljs-bullet">3.</span> å˜é‡åç§°ä¸€èˆ¬ä¹ æƒ¯ä¸ºå¤§å†™,å½“ç„¶å°å†™ä¸å‡ºé”™ï¼Œä½†æ˜¯å¤§å†™æ˜¯è§„èŒƒ<br></code></pre></td></tr></table></figure><h4 id="17-2-3-å°†å‘½ä»¤çš„è¿”å›å€¼èµ‹ç»™å˜é‡ï¼ˆé‡ç‚¹ï¼‰"><a href="#17-2-3-å°†å‘½ä»¤çš„è¿”å›å€¼èµ‹ç»™å˜é‡ï¼ˆé‡ç‚¹ï¼‰" class="headerlink" title="17.2.3 å°†å‘½ä»¤çš„è¿”å›å€¼èµ‹ç»™å˜é‡ï¼ˆé‡ç‚¹ï¼‰"></a>17.2.3 å°†å‘½ä»¤çš„è¿”å›å€¼èµ‹ç»™å˜é‡ï¼ˆé‡ç‚¹ï¼‰</h4><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs routeros">1. <span class="hljs-attribute">A</span>=`ls-la` åå¼•å·ï¼Œè¿è¡Œé‡Œé¢çš„å‘½ä»¤ï¼Œå¹¶æŠŠç»“æœè¿”å›ç»™å˜é‡A<br>2. <span class="hljs-attribute">A</span>=$(ls-la) ç­‰ä»·äºåå¼•å·<br>å¦åˆ™ï¼Œå°±æ˜¯å°†å­—ç¬¦ä¸²èµ‹å€¼ç»™å˜é‡<br></code></pre></td></tr></table></figure><h3 id="17-3-è®¾ç½®ç¯å¢ƒå˜é‡"><a href="#17-3-è®¾ç½®ç¯å¢ƒå˜é‡" class="headerlink" title="17.3 è®¾ç½®ç¯å¢ƒå˜é‡"></a>17.3 è®¾ç½®ç¯å¢ƒå˜é‡</h3><p>åŸºæœ¬è¯­æ³•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">1. <span class="hljs-built_in">export</span> å˜é‡å=å˜é‡å€¼ ï¼ˆåŠŸèƒ½æè¿°ï¼šå°†shellå˜é‡è¾“å‡ºä¸ºç¯å¢ƒå˜é‡/å…¨å±€å˜é‡ï¼‰<br>2. <span class="hljs-built_in">source</span> é…ç½®æ–‡ä»¶ ï¼ˆåŠŸèƒ½æè¿°ï¼šè®©ä¿®æ”¹åçš„é…ç½®ä¿¡æ¯ç«‹å³ç”Ÿæ•ˆï¼‰<br>3. <span class="hljs-built_in">echo</span> $å˜é‡å ï¼ˆåŠŸèƒ½æè¿°ï¼šæŸ¥è¯¢ç¯å¢ƒå˜é‡çš„å€¼ï¼‰<br></code></pre></td></tr></table></figure><p>åº”ç”¨æ¡ˆä¾‹ï¼š</p><p>æ¡ˆä¾‹1ï¼šåœ¨/etc/profileæ–‡ä»¶ä¸­å®šä¹‰TOMCAT_HOMEç¯å¢ƒå˜é‡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">vim /etc/profile<br><br>export TOMCAT_HOME=/opt/tomcat<br></code></pre></td></tr></table></figure><p>æ¡ˆä¾‹2ï¼šæŸ¥çœ‹ç¯å¢ƒå˜é‡TOMCAT_HOMEçš„å€¼</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">echo $TOMCAT_HOME<br></code></pre></td></tr></table></figure><p>æ¡ˆä¾‹3ï¼šåœ¨å¦å¤–ä¸€ä¸ªshellç¨‹åºä¸­ä½¿ç”¨TOMCAT_HOMEã€‚æ³¨æ„ï¼šåœ¨è¾“å‡ºTOMCAT_HOME ç¯å¢ƒå˜é‡å‰ï¼Œéœ€è¦è®©å…¶ç”Ÿæ•ˆ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">source /etc/profile<br></code></pre></td></tr></table></figure><h3 id="17-4-Shellçš„æ³¨é‡Š"><a href="#17-4-Shellçš„æ³¨é‡Š" class="headerlink" title="17.4 Shellçš„æ³¨é‡Š"></a>17.4 Shellçš„æ³¨é‡Š</h3><p>å•è¡Œæ³¨é‡Šï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><br></code></pre></td></tr></table></figure><p>å¤šè¡Œæ³¨é‡Š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs shell">:&lt;&lt;[å­—ç¬¦]  #è¿™é‡Œçš„å­—ç¬¦å¯ä»¥æ˜¯æ•°å­—æˆ–è€…æ˜¯å­—ç¬¦éƒ½å¯ä»¥<br>è¯­å¥1<br>è¯­å¥2<br>[å­—ç¬¦]<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash">æ¯”å¦‚</span><br>:&lt;&lt;!<br>è¯­å¥1<br>è¯­å¥2<br>!<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash">æˆ–è€…</span><br>:&lt;&lt;0<br>è¯­å¥1<br>è¯­å¥2<br>0<br></code></pre></td></tr></table></figure><h3 id="17-5-ä½ç½®å‚æ•°å˜é‡"><a href="#17-5-ä½ç½®å‚æ•°å˜é‡" class="headerlink" title="17.5 ä½ç½®å‚æ•°å˜é‡"></a>17.5 ä½ç½®å‚æ•°å˜é‡</h3><p>ä»‹ç»ï¼š</p><p>å½“æˆ‘ä»¬æ‰§è¡Œä¸€ä¸ªshellè„šæœ¬æ—¶ï¼Œå¦‚æœå¸Œæœ›è·å–åˆ°å‘½ä»¤è¡Œçš„å‚æ•°ä¿¡æ¯ï¼Œå°±å¯ä»¥ä½¿ç”¨åˆ°ä½ç½®å‚æ•°å˜é‡ï¼Œæ¯”å¦‚ ï¼š<code>./myshell.sh 100 200</code> , è¿™ä¸ªå°±æ˜¯ä¸€ä¸ªæ‰§è¡Œshellçš„å‘½ä»¤è¡Œï¼Œå¯ä»¥åœ¨myshell è„šæœ¬ä¸­è·å–åˆ°</p><p>åŸºæœ¬è¯­æ³•ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-variable">$n</span> ï¼ˆåŠŸèƒ½æè¿°ï¼šnä¸ºæ•°å­—ï¼Œ<span class="hljs-variable">$0</span> ä»£è¡¨å‘½ä»¤æœ¬èº«ï¼Œ<span class="hljs-variable">$1</span>-<span class="hljs-variable">$9</span> ä»£è¡¨ç¬¬ä¸€åˆ°ç¬¬ä¹ä¸ªå‚æ•°ï¼Œåä»¥ä¸Šçš„å‚æ•°ï¼Œåä»¥ä¸Šçš„å‚æ•°éœ€è¦ç”¨å¤§æ‹¬å·åŒ…å«ï¼Œå¦‚<span class="hljs-variable">$</span>&#123;<span class="hljs-number">10</span>&#125;ï¼‰<br><span class="hljs-variable">$</span>* ï¼ˆåŠŸèƒ½æè¿°ï¼šè¿™ä¸ªå˜é‡ä»£è¡¨å‘½ä»¤è¡Œä¸­æ‰€æœ‰çš„å‚æ•°ï¼Œ<span class="hljs-variable">$</span>*æŠŠæ‰€æœ‰çš„å‚æ•°çœ‹æˆä¸€ä¸ªæ•´ä½“ï¼‰<br><span class="hljs-variable">$</span><span class="hljs-selector-tag">@</span> ï¼ˆåŠŸèƒ½æè¿°ï¼šè¿™ä¸ªå˜é‡ä¹Ÿä»£è¡¨å‘½ä»¤è¡Œä¸­æ‰€æœ‰çš„å‚æ•°ï¼Œä¸è¿‡<span class="hljs-variable">$</span><span class="hljs-selector-tag">@</span>æŠŠæ¯ä¸ªå‚æ•°åŒºåˆ†å¯¹å¾…ï¼‰<br><span class="hljs-variable">$</span><span class="hljs-comment"># ï¼ˆåŠŸèƒ½æè¿°ï¼šè¿™ä¸ªå˜é‡ä»£è¡¨å‘½ä»¤è¡Œä¸­æ‰€æœ‰å‚æ•°çš„ä¸ªæ•°ï¼‰</span><br></code></pre></td></tr></table></figure><p>åº”ç”¨å®ä¾‹ï¼š</p><p>æ¡ˆä¾‹1ï¼šç¼–å†™ä¸€ä¸ªshellè„šæœ¬ positionPara.sh ï¼Œ åœ¨è„šæœ¬ä¸­è·å–åˆ°å‘½ä»¤è¡Œçš„å„ä¸ªå‚æ•°ä¿¡æ¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">vim myshell.sh<br><br>echo ç¬¬ä¸€ä¸ªå‚æ•° = $1 ç¬¬äºŒä¸ªå‚æ•° = $2<br></code></pre></td></tr></table></figure><h3 id="17-6-é¢„å®šä¹‰å˜é‡"><a href="#17-6-é¢„å®šä¹‰å˜é‡" class="headerlink" title="17.6 é¢„å®šä¹‰å˜é‡"></a>17.6 é¢„å®šä¹‰å˜é‡</h3><p>åŸºæœ¬ä»‹ç»</p><p>é¢„å®šä¹‰å˜é‡å°±æ˜¯shellè®¾è®¡è€…äº‹å…ˆå·²ç»å®šä¹‰å¥½çš„å˜é‡ï¼Œå¯ä»¥ç›´æ¥åœ¨shellè„šæœ¬ä¸­ä½¿ç”¨ã€‚</p><p>åŸºæœ¬è¯­æ³•</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs gams"><span class="hljs-symbol">$</span><span class="hljs-symbol">$</span> ï¼ˆåŠŸèƒ½æè¿°ï¼šå½“å‰è¿›ç¨‹çš„è¿›ç¨‹å·ï¼ˆPIDï¼‰ï¼‰<br><span class="hljs-symbol">$</span>! ï¼ˆåŠŸèƒ½æè¿°ï¼šåå°è¿è¡Œçš„æœ€åä¸€ä¸ªè¿›ç¨‹çš„è¿›ç¨‹å·ï¼ˆPIDï¼‰ï¼‰<br><span class="hljs-symbol">$</span>ï¼Ÿï¼ˆåŠŸèƒ½æè¿°ï¼šæœ€åä¸€æ¬¡æ‰§è¡Œçš„å‘½ä»¤çš„è¿”å›çŠ¶æ€ã€‚å¦‚æœè¿™ä¸ªå˜é‡çš„å€¼ä¸º <span class="hljs-number">0</span> ï¼Œè¯æ˜ä¸Šä¸€ä¸ªå‘½ä»¤æ­£ç¡®æ‰§è¡Œï¼›å¦‚æœè¿™ä¸ªå˜é‡çš„å€¼ä¸ºé <span class="hljs-number">0</span> ï¼ˆå…·ä½“æ˜¯å“ªä¸ªæ•°ï¼Œç”±å‘½ä»¤è‡ªå·±æ¥å†³å®šï¼‰ï¼Œåˆ™è¯æ˜ä¸Šä¸€ä¸ªå‘½ä»¤æ‰§è¡Œä¸æ­£ç¡®äº†ã€‚ï¼‰<br></code></pre></td></tr></table></figure><p>åº”ç”¨å®ä¾‹</p><p>æ¡ˆä¾‹1ï¼šåœ¨ä¸€ä¸ªshellè„šæœ¬ä¸­ç®€å•ä½¿ç”¨ä¸€ä¸‹é¢„å®šä¹‰å˜é‡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">!/bin/bash</span><br>echo å½“å‰è¿›ç¨‹çš„è¿›ç¨‹å·$$<br>bash ~/shcode/myshell.sh &amp; #æ¬¡æ•°åŠ ä¸Š&amp;ï¼Œè¯´æ˜è®©è¯¥å‘½ä»¤åå°è¿è¡Œ<br>echo æœ€åä¸€ä¸ªåå°è¿è¡Œçš„è¿›ç¨‹ID$!<br>echo æœ€åä¸€æ¬¡æ‰§è¡Œçš„å‘½ä»¤çš„è¿”å›çŠ¶æ€$?<br></code></pre></td></tr></table></figure><h3 id="17-7-è¿ç®—ç¬¦"><a href="#17-7-è¿ç®—ç¬¦" class="headerlink" title="17.7 è¿ç®—ç¬¦"></a>17.7 è¿ç®—ç¬¦</h3><p>åŸºæœ¬ä»‹ç»</p><p>å­¦ä¹ å¦‚ä½•åœ¨shellä¸­è¿›è¡Œå„ç§è¿ç®—æ“ä½œã€‚</p><p>åŸºæœ¬è¯­æ³•ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">â€œ$((è¿ç®—å¼))â€ æˆ–è€… â€œ$[è¿ç®—å¼]â€  #*ä¸éœ€è¦è½¬ä¹‰ï¼Œè¿ç®—ç¬¦é—´ä¹Ÿä¸éœ€è¦ç©ºæ ¼<br>expr m + n #æ³¨æ„exprè¿ç®—ç¬¦é—´è¦æœ‰ç©ºæ ¼ï¼Œå¦‚æœå¸Œæœ›å°†exprç»“æœèµ‹å€¼ç»™æŸä¸ªå˜é‡ï¼Œéœ€è¦ä½¿ç”¨â€˜â€™å¼•èµ·æ¥ï¼Œä¾‹å¦‚`expr m + n`<br>expr \*,/,% ä¹˜ï¼Œé™¤ï¼Œå–ä½™ #éœ€è¦æ³¨æ„çš„æ˜¯*ï¼Œéœ€è¦è½¬ä¹‰<br></code></pre></td></tr></table></figure><p>åº”ç”¨å®ä¾‹</p><p>æ¡ˆä¾‹ 1 ï¼šè®¡ç®—ï¼ˆ 2 + 3 ï¼‰X 4 çš„å€¼</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">A=$(((2 + 3) * 4)) #æ³¨æ„åªæœ‰exprè¿ç®—ç¬¦æ‰éœ€è¦å°†*è½¬ä¹‰<br>A=$[(2 + 3) * 4]<br>A=`expr (2 + 3) \* 4` #è¿™ç§åšæ³•æ˜¯é”™è¯¯çš„ï¼Œåº”è¯¥åˆ†æ­¥èµ°<br>A=`expr 2 + 3`<br>A=`expr 4 \* $A`<br></code></pre></td></tr></table></figure><p>æ¡ˆä¾‹ 2 ï¼šè¯·æ±‚å‡ºå‘½ä»¤è¡Œçš„ä¸¤ä¸ªå‚æ•°[æ•´æ•°]çš„å’Œ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">A=$[$1 + $2]<br>echo å’Œä¸º $A<br></code></pre></td></tr></table></figure><h3 id="17-8-æ¡ä»¶åˆ¤æ–­"><a href="#17-8-æ¡ä»¶åˆ¤æ–­" class="headerlink" title="17.8 æ¡ä»¶åˆ¤æ–­"></a>17.8 æ¡ä»¶åˆ¤æ–­</h3><p>åŸºæœ¬è¯­æ³•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">[ condition ]   #æ³¨æ„conditionå‰åè¦æœ‰ç©ºæ ¼<br>  #éç©ºè¿”å›trueï¼Œå¯ä½¿ç”¨$?éªŒè¯ï¼ˆ 0 ä¸ºtrueï¼Œ&gt; 1 ä¸ºfalseï¼‰<br></code></pre></td></tr></table></figure><p>åº”ç”¨å®ä¾‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">[ atguigu ] è¿”å›true<br>[ ] è¿”å›false<br>[ condition ] &amp;&amp; echo OK || echo notok #æ¡ä»¶æ»¡è¶³ï¼Œæ‰§è¡Œåé¢çš„è¯­å¥ï¼Œç›¸å½“äºä¸‰ç›®è¿ç®—<br></code></pre></td></tr></table></figure><p>å¸¸ç”¨åˆ¤æ–­</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs shell">= å­—ç¬¦ä¸²æ¯”è¾ƒ<br><span class="hljs-meta">#</span><span class="bash">ä¸¤ä¸ªæ•´æ•°çš„æ¯”è¾ƒ</span><br>- lt å°äº<br>- le å°äºç­‰äº<br>- eq ç­‰äº<br>- gt å¤§äº<br>- ge å¤§äºç­‰äº<br>- ne ä¸ç­‰äº<br><span class="hljs-meta">#</span><span class="bash">æŒ‰ç…§æ–‡ä»¶æƒé™è¿›è¡Œåˆ¤æ–­</span><br>- r æœ‰è¯»çš„æƒé™ [-r æ–‡ä»¶ ]<br>- w æœ‰å†™çš„æƒé™<br>- x æœ‰æ‰§è¡Œçš„æƒé™<br><span class="hljs-meta">#</span><span class="bash">æŒ‰ç…§æ–‡ä»¶ç±»å‹è¿›è¡Œåˆ¤æ–­</span><br>- f æ–‡ä»¶å­˜åœ¨å¹¶ä¸”æ˜¯ä¸€ä¸ªå¸¸è§„çš„æ–‡ä»¶<br>- e æ–‡ä»¶å­˜åœ¨<br>- d æ–‡ä»¶å­˜åœ¨å¹¶æ˜¯ä¸€ä¸ªç›®å½•<br></code></pre></td></tr></table></figure><p>åº”ç”¨å®ä¾‹</p><p>æ¡ˆä¾‹1ï¼šâ€okâ€æ˜¯å¦ç­‰äºâ€okâ€</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ok = ok<br></code></pre></td></tr></table></figure><p>æ¡ˆä¾‹2ï¼š 23 æ˜¯å¦å¤§äºç­‰äº 22</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">23 -ge 22<br></code></pre></td></tr></table></figure><p>æ¡ˆä¾‹ 3 ï¼š/root/install.logç›®å½•ä¸­çš„æ–‡ä»¶æ˜¯å¦å­˜åœ¨</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">-f <span class="hljs-regexp">/root/i</span>nstall.log<br></code></pre></td></tr></table></figure><h3 id="17-9-æµç¨‹æ§åˆ¶"><a href="#17-9-æµç¨‹æ§åˆ¶" class="headerlink" title="17.9 æµç¨‹æ§åˆ¶"></a>17.9 æµç¨‹æ§åˆ¶</h3><h4 id="17-9-1-if-åˆ¤æ–­"><a href="#17-9-1-if-åˆ¤æ–­" class="headerlink" title="17.9.1 if åˆ¤æ–­"></a>17.9.1 if åˆ¤æ–­</h4><p>åŸºæœ¬è¯­æ³•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs sehll">if [ æ¡ä»¶åˆ¤æ–­å¼ ]<br>then<br>  ç¨‹åº<br>fi<br><br>æˆ–è€…<br><br>if [ æ¡ä»¶åˆ¤æ–­å¼ ]<br>then<br>     ç¨‹åº<br>elif [ æ¡ä»¶åˆ¤æ–­å¼ ]<br>then<br>ç¨‹åº<br>fi<br><br>æˆ–è€…<br><br>if [ æ¡ä»¶åˆ¤æ–­å¼ ]<br>then<br>ç¨‹åº<br>else<br>ç¨‹åº<br>fi<br></code></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">æ³¨æ„äº‹é¡¹ï¼š<span class="hljs-selector-attr">[ æ¡ä»¶åˆ¤æ–­å¼ ]</span>ä¸­æ‹¬å·å’Œæ¡ä»¶åˆ¤æ–­å¼ä¹‹é—´å¿…é¡»æœ‰ç©ºæ ¼<br></code></pre></td></tr></table></figure><p>åº”ç”¨å®ä¾‹<br>æ¡ˆä¾‹1ï¼šè¯·ç¼–å†™ä¸€ä¸ªshellç¨‹åºï¼Œå¦‚æœè¾“å…¥çš„å‚æ•°ï¼Œå¤§äºç­‰äº 60 ï¼Œåˆ™è¾“å‡º â€œåŠæ ¼äº†â€ï¼Œå¦‚æœå°äº 60 ,åˆ™è¾“å‡º â€œä¸åŠæ ¼â€</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">!/bin/bash</span><br><br>if [ $1 -ge 60 ]<br>then<br>        echo åŠæ ¼äº†<br>elif [ $1 -lt 60 ]<br>then<br>        echo ä¸åŠæ ¼<br>fi<br></code></pre></td></tr></table></figure><h4 id="17-9-2-caseè¯­å¥"><a href="#17-9-2-caseè¯­å¥" class="headerlink" title="17.9.2 caseè¯­å¥"></a>17.9.2 caseè¯­å¥</h4><p>åŸºæœ¬è¯­æ³•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs shell">case $å˜é‡å in<br>&quot;å€¼ 1 &quot;ï¼‰<br>å¦‚æœå˜é‡çš„å€¼ç­‰äºå€¼ 1 ï¼Œåˆ™æ‰§è¡Œç¨‹åº 1<br>;;<br>&quot;å€¼ 2 &quot;ï¼‰<br>å¦‚æœå˜é‡çš„å€¼ç­‰äºå€¼ 2 ï¼Œåˆ™æ‰§è¡Œç¨‹åº 2<br>;;<br>*ï¼‰<br>å¦‚æœå˜é‡çš„å€¼éƒ½ä¸æ˜¯ä»¥ä¸Šçš„å€¼ï¼Œåˆ™æ‰§è¡Œæ­¤ç¨‹åº<br>;;<br>esac<br></code></pre></td></tr></table></figure><p>åº”ç”¨å®ä¾‹<br>æ¡ˆä¾‹ 1 ï¼šå½“å‘½ä»¤è¡Œå‚æ•°æ˜¯ 1 æ—¶ï¼Œè¾“å‡º â€œå‘¨ä¸€â€, æ˜¯ 2 æ—¶ï¼Œå°±è¾“å‡ºâ€å‘¨äºŒâ€ï¼Œå…¶å®ƒæƒ…å†µè¾“å‡º â€œotherâ€</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">!/bin/bash</span><br><br>case $1 in<br>&quot;1&quot;)<br>echo å‘¨ä¸€<br>;;<br>&quot;2&quot;)<br>echo å‘¨äºŒ<br>;;<br>*)<br>echo other...<br>;;<br>esac<br></code></pre></td></tr></table></figure><h3 id="17-9-3-forå¾ªç¯"><a href="#17-9-3-forå¾ªç¯" class="headerlink" title="17.9.3 forå¾ªç¯"></a>17.9.3 forå¾ªç¯</h3><p>åŸºæœ¬è¯­æ³• </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">for å˜é‡ in å€¼1 å€¼2 å€¼3 ...<br>do<br>ç¨‹åº/ä»£ç <br>done<br></code></pre></td></tr></table></figure><p>åº”ç”¨å®ä¾‹<br>æ¡ˆä¾‹ 1 ï¼šæ‰“å°å‘½ä»¤è¡Œè¾“å…¥çš„å‚æ•° ã€ä¼šä½¿ç”¨åˆ°$*  $@ï¼Œä½“ä¼š$* ä¸ $@çš„åŒºåˆ«ã€‘</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">!/bin/bash</span><br>for i in &quot;$*&quot;<br>do<br>        echo num is $i<br>done<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">bash for.sh 1 2 3 4 5<br>è¾“å‡ºï¼š<br>num is 1 2 3 4 5<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">!/bin/bash</span><br>for i in &quot;$@&quot;<br>do<br>        echo num is $i<br>done<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">bash for.sh 1 2 3 4 5<br>è¾“å‡ºï¼š<br>num is 1<br>num is 2<br>num is 3<br>num is 4<br>num is 5<br></code></pre></td></tr></table></figure><p>åŸºæœ¬è¯­æ³• </p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs gcode">for<span class="hljs-comment">(( åˆå§‹å€¼ ; å¾ªç¯æ§åˆ¶æ¡ä»¶ ; å˜é‡å˜åŒ– )</span>)<br><span class="hljs-keyword">do</span><br>ç¨‹åº<br><span class="hljs-keyword">do</span><span class="hljs-symbol">ne</span><br></code></pre></td></tr></table></figure><p>åº”ç”¨å®ä¾‹</p><p>æ¡ˆä¾‹ 1 ï¼šä» 1 åŠ åˆ° 100 çš„å€¼è¾“å‡ºæ˜¾ç¤º</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">!/bin/bash</span><br>SUM=0<br>for (( i=1; i&lt;=100; i++))<br>do<br>        SUM=$[$SUM+$i]<br>done<br>echo $SUM<br></code></pre></td></tr></table></figure><h4 id="17-9-4-whileå¾ªç¯"><a href="#17-9-4-whileå¾ªç¯" class="headerlink" title="17.9.4 whileå¾ªç¯"></a>17.9.4 whileå¾ªç¯</h4><p>åŸºæœ¬è¯­æ³• </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">while[ æ¡ä»¶åˆ¤æ–­å¼ ]<br>do<br>      ç¨‹åº<br>done<br><span class="hljs-meta">#</span><span class="bash">æ³¨æ„ï¼š<span class="hljs-keyword">while</span>å’Œ[æœ‰ç©ºæ ¼ï¼Œæ¡ä»¶åˆ¤æ–­å¼å’Œ[ä¹Ÿæœ‰ç©ºæ ¼</span><br></code></pre></td></tr></table></figure><p>åº”ç”¨å®ä¾‹<br>æ¡ˆä¾‹ 1 ï¼šä»å‘½ä»¤è¡Œè¾“å…¥ä¸€ä¸ªæ•°nï¼Œç»Ÿè®¡ä» 1 +..+n çš„å€¼æ˜¯å¤šå°‘ï¼Ÿ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">!/bin/bash</span><br><br>SUM=0<br>i=0<br>while [ $i -le $1 ]<br>do<br>        SUM=$[$SUM+$i]<br>        i=$[$i+1]<br>done<br>echo $SUM<br></code></pre></td></tr></table></figure><h3 id="17-10-READè¯»å–æ§åˆ¶å°è¾“å…¥"><a href="#17-10-READè¯»å–æ§åˆ¶å°è¾“å…¥" class="headerlink" title="17.10 READè¯»å–æ§åˆ¶å°è¾“å…¥"></a>17.10 READè¯»å–æ§åˆ¶å°è¾“å…¥</h3><p>åŸºæœ¬è¯­æ³•</p><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs erlang"><span class="hljs-function"><span class="hljs-title">read</span> <span class="hljs-params">(é€‰é¡¹)</span><span class="hljs-params">(å‚æ•°)</span></span><br></code></pre></td></tr></table></figure><p>é€‰é¡¹ï¼š</p><ul><li>-pï¼šæŒ‡å®šè¯»å–å€¼æ—¶çš„æç¤ºç¬¦ï¼›</li><li>-tï¼šæŒ‡å®šè¯»å–å€¼æ—¶ç­‰å¾…çš„æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œå¦‚æœæ²¡æœ‰åœ¨æŒ‡å®šçš„æ—¶é—´å†…è¾“å…¥ï¼Œå°±ä¸å†ç­‰å¾…äº†ã€‚ã€‚<br>å‚æ•°<br>å˜é‡ï¼šæŒ‡å®šè¯»å–å€¼çš„å˜é‡å</li></ul><p>åº”ç”¨å®ä¾‹</p><p>æ¡ˆä¾‹ 1 ï¼šè¯»å–æ§åˆ¶å°è¾“å…¥ä¸€ä¸ªnumå€¼</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">!/bin/bash</span><br>read -p è¯·è¾“å…¥ä¸€ä¸ªæ•° NUM<br>echo $NUM<br></code></pre></td></tr></table></figure><p>æ¡ˆä¾‹ 2 ï¼šè¯»å–æ§åˆ¶å°è¾“å…¥ä¸€ä¸ªnumå€¼ï¼Œåœ¨ 10 ç§’å†…è¾“å…¥ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">!/bin/bash</span><br>read -t 10 -p è¾“å…¥ä¸€ä¸ªæ•° NUM<br>echo $NUM<br></code></pre></td></tr></table></figure><h3 id="17-11-å‡½æ•°"><a href="#17-11-å‡½æ•°" class="headerlink" title="17.11 å‡½æ•°"></a>17.11 å‡½æ•°</h3><p>å‡½æ•°ä»‹ç»ï¼š</p><p>shellç¼–ç¨‹å’Œå…¶å®ƒç¼–ç¨‹è¯­è¨€ä¸€æ ·ï¼Œæœ‰ç³»ç»Ÿå‡½æ•°ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰å‡½æ•°ã€‚ç³»ç»Ÿå‡½æ•°ä¸­ï¼Œæˆ‘ä»¬è¿™é‡Œå°±ä»‹ç»ä¸¤ä¸ªã€‚</p><h4 id="17-11-1-ç³»ç»Ÿå‡½æ•°"><a href="#17-11-1-ç³»ç»Ÿå‡½æ•°" class="headerlink" title="17.11.1 ç³»ç»Ÿå‡½æ•°"></a>17.11.1 ç³»ç»Ÿå‡½æ•°</h4><p>basenameåŸºæœ¬è¯­æ³•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">basename [pathname] [suffix] #åŠŸèƒ½ï¼šè¿”å›å®Œæ•´è·¯å¾„æœ€å / çš„éƒ¨åˆ†ï¼Œå¸¸ç”¨äºè·å–æ–‡ä»¶å<br></code></pre></td></tr></table></figure><p>é€‰é¡¹ï¼š</p><p>suffixä¸ºåç¼€ï¼Œå¦‚æœsuffixè¢«æŒ‡å®šäº†ï¼Œbasenameä¼šå°†pathnameæˆ–stringä¸­çš„suffixå»æ‰ã€‚</p><p>æ¡ˆä¾‹ 1 ï¼šè¯·è¿”å› /home/aaa/test.txt çš„ â€œtest.txtâ€ éƒ¨åˆ†</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">basename /home/aaa/test.txt<br>basename /home/aaa/test.txt .txt<br></code></pre></td></tr></table></figure><p>dirnameåŸºæœ¬è¯­æ³•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">dirname æ–‡ä»¶ç»å¯¹è·¯å¾„ #ï¼ˆåŠŸèƒ½æè¿°ï¼šä»ç»™å®šçš„åŒ…å«ç»å¯¹è·¯å¾„çš„æ–‡ä»¶åä¸­å»é™¤æ–‡ä»¶åï¼ˆéç›®å½•çš„éƒ¨åˆ†ï¼‰ï¼Œç„¶åè¿”å›å‰©ä¸‹çš„è·¯å¾„ï¼ˆç›®å½•çš„éƒ¨åˆ†ï¼‰ï¼‰<br></code></pre></td></tr></table></figure><p>æ¡ˆä¾‹ 2 ï¼šè¯·è¿”å› /home/aaa/test.txt çš„ /home/aaa</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">dirname /home/aaa/test.txt<br></code></pre></td></tr></table></figure><h4 id="17-11-2-è‡ªå®šä¹‰å‡½æ•°"><a href="#17-11-2-è‡ªå®šä¹‰å‡½æ•°" class="headerlink" title="17.11.2 è‡ªå®šä¹‰å‡½æ•°"></a>17.11.2 è‡ªå®šä¹‰å‡½æ•°</h4><p>åŸºæœ¬è¯­æ³•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">[function]funname[()]<br>&#123;<br>Action;<br>[return int;]<br>&#125;<br><span class="hljs-meta">#</span><span class="bash">åœ¨Shellä¸­ï¼Œè°ƒç”¨å‡½æ•°æ—¶å¯ä»¥å‘å…¶ä¼ é€’å‚æ•°ã€‚åœ¨å‡½æ•°ä½“å†…éƒ¨ï¼Œé€šè¿‡ <span class="hljs-variable">$n</span> çš„å½¢å¼æ¥è·å–å‚æ•°çš„å€¼ï¼Œä¾‹å¦‚ï¼Œ<span class="hljs-variable">$1</span>è¡¨ç¤ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œ<span class="hljs-variable">$2</span>è¡¨ç¤ºç¬¬äºŒä¸ªå‚æ•°...</span><br></code></pre></td></tr></table></figure><p>è°ƒç”¨ç›´æ¥å†™å‡½æ•°åï¼šfunname [å€¼]</p><p>åº”ç”¨å®ä¾‹<br>æ¡ˆä¾‹ 1 ï¼šè®¡ç®—è¾“å…¥ä¸¤ä¸ªå‚æ•°çš„å’Œï¼ˆreadï¼‰ï¼Œ getSum</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">function getSum() &#123;<br>        SUM=$[$n1+$n2]<br>        echo å’Œæ˜¯$SUM<br>&#125;<br>read -p è¾“å…¥ä¸¤ä¸ªå€¼ n1 n2<br>getSum <br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">Shell å˜é‡çš„ä½œç”¨åŸŸå¯ä»¥åˆ†ä¸ºä¸‰ç§ï¼š<br>æœ‰çš„å˜é‡åªèƒ½åœ¨å‡½æ•°å†…éƒ¨ä½¿ç”¨ï¼Œè¿™å«åšå±€éƒ¨å˜é‡ï¼ˆlocal variableï¼‰ï¼›é™¤éå®šä¹‰æ—¶ä½¿ç”¨localé™å®šï¼Œå¦åˆ™éƒ½æ˜¯å…¨å±€å˜é‡<br>æœ‰çš„å˜é‡å¯ä»¥åœ¨å½“å‰ Shell è¿›ç¨‹ä¸­ä½¿ç”¨ï¼Œè¿™å«åšå…¨å±€å˜é‡ï¼ˆglobal variableï¼‰ï¼›æ­£å¸¸å®šä¹‰éƒ½æ˜¯å…¨å±€å˜é‡<br>è€Œæœ‰çš„å˜é‡è¿˜å¯ä»¥åœ¨å­è¿›ç¨‹ä¸­ä½¿ç”¨ï¼Œè¿™å«åšç¯å¢ƒå˜é‡ï¼ˆenvironment variableï¼‰ã€‚éœ€è¦ä½¿ç”¨exportå¯¼å‡ºç¯å¢ƒå˜é‡ã€‚<br><br></code></pre></td></tr></table></figure><p><a href="http://c.biancheng.net/view/773.html">Shellä½œç”¨åŸŸç»†èŠ‚</a></p><h3 id="17-12-SHELLç¼–ç¨‹ç»¼åˆæ¡ˆä¾‹"><a href="#17-12-SHELLç¼–ç¨‹ç»¼åˆæ¡ˆä¾‹" class="headerlink" title="17.12 SHELLç¼–ç¨‹ç»¼åˆæ¡ˆä¾‹"></a>17.12 SHELLç¼–ç¨‹ç»¼åˆæ¡ˆä¾‹</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs stylus">éœ€æ±‚åˆ†æ<br><span class="hljs-number">1</span> )æ¯å¤©å‡Œæ™¨ <span class="hljs-number">2</span> : <span class="hljs-number">10</span> å¤‡ä»½ æ•°æ®åº“ atguiguDB åˆ° /data/backup/db<br><span class="hljs-number">2</span> )å¤‡ä»½å¼€å§‹å’Œå¤‡ä»½ç»“æŸèƒ½å¤Ÿç»™å‡ºç›¸åº”çš„æç¤ºä¿¡æ¯<br><span class="hljs-number">3</span> )å¤‡ä»½åçš„æ–‡ä»¶è¦æ±‚ä»¥å¤‡ä»½æ—¶é—´ä¸ºæ–‡ä»¶åï¼Œå¹¶æ‰“åŒ…æˆ <span class="hljs-selector-class">.tar</span><span class="hljs-selector-class">.gz</span> çš„å½¢å¼ï¼Œæ¯”å¦‚ï¼š<span class="hljs-number">2018</span>-<span class="hljs-number">03</span>-<span class="hljs-number">12</span>_230201<span class="hljs-selector-class">.tar</span><span class="hljs-selector-class">.gz</span><br><span class="hljs-number">4</span> ) åœ¨å¤‡ä»½çš„åŒæ—¶ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰ <span class="hljs-number">10</span> å¤©å‰å¤‡ä»½çš„æ•°æ®åº“æ–‡ä»¶ï¼Œå¦‚æœæœ‰å°±å°†å…¶åˆ é™¤ã€‚<br></code></pre></td></tr></table></figure><p>ä»£ç å®ç°ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs shell">1. cd/usr/sbin #rootç”¨æˆ·çš„ç³»ç»Ÿç®¡ç†ç¨‹åº<br>vim mysqlbd_backup.sh<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash">!/bin/bash</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash">å¤‡ä»½ç›®å½•</span><br>BACKUP=/data/backup/bd<br><span class="hljs-meta">#</span><span class="bash">å½“å‰æ—¶é—´</span><br>DATETIME=$(date +%Y-%m-%d_%H%M%S)<br>echo $DATETIME<br><span class="hljs-meta">#</span><span class="bash">æ•°æ®åº“åœ°å€</span><br>HOST=localhost<br><span class="hljs-meta">#</span><span class="bash">æ•°æ®åº“ç”¨æˆ·å</span><br>DB_USER=root<br><span class="hljs-meta">#</span><span class="bash">æ•°æ®åº“å¯†ç </span><br>DB_PW=hspedu100<br><span class="hljs-meta">#</span><span class="bash">å¤‡ä»½çš„æ•°æ®åº“å</span><br>DATABASE=hspedu<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash">åˆ›å»ºå¤‡ä»½ç›®å½•ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œå°±åˆ›å»º</span><br>[ ! -d &quot;$&#123;BACKUP&#125;/$&#123;DATETIME&#125;&quot; ] &amp;&amp; mkdir -p &quot;$&#123;BACKUP&#125;/$&#123;DATETIME&#125;&quot;<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash">å¤‡ä»½æ•°æ®åº“</span><br>mysqldump -u$&#123;DB_USER&#125; -p$&#123;DB_PW&#125; --host$&#123;HOST&#125; -q -R --databases $&#123;DATABASE&#125; | gzip &gt; $&#123;BACKUP&#125;/$&#123;DATETIME&#125;/$&#123;DATETIME&#125;.sql.gz<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash">å°†æ–‡ä»¶å¤„ç†æˆ.tar.gz</span><br>cd $&#123;BACKUP&#125;<br>tar -zcvf $DATETIME.tar.gz $&#123;DATETIME&#125;<br><span class="hljs-meta">#</span><span class="bash">åˆ é™¤å¯¹åº”çš„å¤‡ä»½ç›®å½•</span><br>rm -rf $&#123;BACKUP&#125;/$&#123;DATETIME&#125;<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash">åˆ é™¤åå¤©å‰å¤‡ä»½æ–‡ä»¶</span><br>find $&#123;BACKUP&#125; -atime + 10 -name &quot;*.tar.gz&quot; -exec rm -rf &#123;&#125; \;<br>echo &quot;å¤‡ä»½æ•°æ®åº“$&#123;DATABASE&#125;&quot;<br><br><br>crond -e<br>30 2 * * * /usr/sbin/mysqlbd_backup.sh<br></code></pre></td></tr></table></figure><h2 id="åå…«ã€Ubuntu"><a href="#åå…«ã€Ubuntu" class="headerlink" title="åå…«ã€Ubuntu"></a>åå…«ã€Ubuntu</h2><p>Ubuntuä»‹ç»</p><p>Ubuntuï¼ˆå‹å¸®æ‹“ã€ä¼˜èˆ¬å›¾ã€ä¹Œç­å›¾ï¼‰æ˜¯ä¸€ä¸ªä»¥æ¡Œé¢åº”ç”¨ä¸ºä¸»çš„å¼€æºGNU/Linuxæ“ä½œç³»ç»Ÿï¼ŒUbuntuæ˜¯åŸºäºGNU/Linuxï¼Œæ”¯æŒx 86 ã€amd 64 ï¼ˆå³x 64 ï¼‰å’Œppcæ¶æ„ï¼Œç”±å…¨çƒåŒ–çš„ä¸“ä¸šå¼€å‘å›¢é˜Ÿï¼ˆCanonicalLtdï¼‰æ‰“é€ çš„ã€‚</p><p>ä¸“ä¸šçš„Pythonå¼€å‘è€…ä¸€èˆ¬ä¼šé€‰æ‹© Ubuntu è¿™æ¬¾Linuxç³»ç»Ÿä½œä¸ºç”Ÿäº§å¹³å°.<br>æ¸©é¦¨æç¤ºï¼š<br>Ubuntu å’Œ Centos éƒ½æ˜¯åŸºäº GNU/Linux å†…æ ¸çš„ï¼Œå› æ­¤åŸºæœ¬ä½¿ç”¨å’ŒCentosæ˜¯å‡ ä¹ä¸€æ ·çš„ï¼Œå®ƒä»¬çš„å„ç§æŒ‡ä»¤å¯ä»¥é€šç”¨ï¼ŒåŒå­¦ä»¬åœ¨å­¦ä¹ å’Œä½¿ç”¨Ubuntuçš„è¿‡ç¨‹ä¸­ï¼Œä¼šå‘ç°å„ç§æ“ä½œæŒ‡ä»¤åœ¨å‰é¢å­¦ä¹ CentOSéƒ½ä½¿ç”¨è¿‡ã€‚åªæ˜¯ç•Œé¢å’Œé¢„å®‰è£…çš„è½¯ä»¶æœ‰æ‰€å·®åˆ«ã€‚</p><p>Ubuntuä¸‹è½½åœ°å€ï¼š<a href="http://cn.ubuntu.com/download/">http://cn.ubuntu.com/download/</a></p><h3 id="18-1-è®¾ç½®Ubuntuæ”¯æŒä¸­æ–‡"><a href="#18-1-è®¾ç½®Ubuntuæ”¯æŒä¸­æ–‡" class="headerlink" title="18.1 è®¾ç½®Ubuntuæ”¯æŒä¸­æ–‡"></a>18.1 è®¾ç½®Ubuntuæ”¯æŒä¸­æ–‡</h3><p>é»˜è®¤å®‰è£…çš„ubuntu ä¸­åªæœ‰è‹±æ–‡è¯­è¨€ï¼Œå› æ­¤æ˜¯ä¸èƒ½æ˜¾ç¤ºæ±‰å­—çš„ã€‚è¦æ­£ç¡®æ˜¾ç¤ºæ±‰å­—ï¼Œéœ€è¦å®‰è£…ä¸­æ–‡è¯­è¨€åŒ…ã€‚</p><p>å®‰è£…ä¸­æ–‡æ”¯æŒæ­¥éª¤ï¼š</p><p>1 .å•å‡»å·¦ä¾§å›¾æ ‡æ æ‰“å¼€ SystemSettingsï¼ˆç³»ç»Ÿè®¾ç½®ï¼‰èœå•ï¼Œç‚¹å‡»æ‰“å¼€ LanguageSupportï¼ˆè¯­è¨€æ”¯æŒï¼‰é€‰é¡¹å¡ã€‚</p><p>2 .ç‚¹å‡» Install/RemoveLanguagesï¼Œåœ¨å¼¹å‡ºçš„é€‰é¡¹å¡ä¸­ä¸‹æ‹‰æ‰¾åˆ°Chinese(Simplified)ï¼Œå³ä¸­æ–‡ç®€ä½“ï¼Œåœ¨åé¢çš„é€‰é¡¹æ¡†ä¸­æ‰“å‹¾ã€‚ç„¶åç‚¹å‡»ApplyChanges æäº¤ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è”ç½‘ä¸‹è½½ä¸­æ–‡è¯­è¨€åŒ…ã€‚ï¼ˆä¿è¯ubuntu æ˜¯è”ç½‘çš„ï¼‰ã€‚</p><p>3 .è¿™æ—¶â€œæ±‰è¯­ï¼ˆä¸­å›½ï¼‰â€åœ¨æœ€åä¸€ä½å› ä¸ºå½“å‰ç¬¬ä¸€ä½æ˜¯â€Englishâ€ï¼Œæ‰€ä»¥é»˜è®¤æ˜¾ç¤ºéƒ½æ˜¯è‹±æ–‡ã€‚æˆ‘ä»¬å¦‚æœå¸Œæœ›é»˜è®¤æ˜¾ç¤ºç”¨ä¸­æ–‡ï¼Œåˆ™åº”è¯¥å°†â€œæ±‰è¯­ï¼ˆä¸­å›½ï¼‰â€è®¾ç½®ä¸ºç¬¬ä¸€ä½ã€‚è®¾ç½®æ–¹æ³•æ˜¯æ‹–åŠ¨ï¼Œé¼ æ ‡å•å‡»â€œæ±‰è¯­ï¼ˆä¸­å›½ï¼‰â€ï¼Œå½“åº•è‰²å˜åŒ–ï¼ˆè¡¨ç¤ºé€‰ä¸­äº†ï¼‰åï¼ŒæŒ‰ä½é¼ æ ‡å·¦é”®ä¸æ¾æ‰‹ï¼Œå‘ä¸Šæ‹–åŠ¨æ”¾ç½®åˆ°ç¬¬ä¸€ä½ã€‚</p><p>4 .è®¾ç½®åä¸ä¼šå³åˆ»ç”Ÿæ•ˆï¼Œéœ€è¦ä¸‹ä¸€æ¬¡ç™»å½•æ—¶æ‰ä¼šç”Ÿæ•ˆã€‚</p><h3 id="18-2-Ubuntuçš„rootç”¨æˆ·"><a href="#18-2-Ubuntuçš„rootç”¨æˆ·" class="headerlink" title="18.2 Ubuntuçš„rootç”¨æˆ·"></a>18.2 Ubuntuçš„rootç”¨æˆ·</h3><p>å®‰è£…ubuntuæˆåŠŸåï¼Œéƒ½æ˜¯æ™®é€šç”¨æˆ·æƒé™ï¼Œå¹¶æ²¡æœ‰æœ€é«˜rootæƒé™ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨rootæƒé™çš„æ—¶å€™ï¼Œé€šå¸¸éƒ½ä¼šåœ¨å‘½ä»¤å‰é¢åŠ ä¸Š sudo ã€‚æœ‰çš„æ—¶å€™æ„Ÿè§‰å¾ˆéº»çƒ¦ã€‚</p><p>æˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨suå‘½ä»¤æ¥ç›´æ¥åˆ‡æ¢åˆ°rootç”¨æˆ·çš„ï¼Œä½†æ˜¯å¦‚æœæ²¡æœ‰ç»™rootè®¾ç½®åˆå§‹å¯†ç ï¼Œå°±ä¼šæŠ›å‡º su:Authenticationfailure è¿™æ ·çš„é—®é¢˜ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬åªè¦ç»™rootç”¨æˆ·è®¾ç½®ä¸€ä¸ªåˆå§‹å¯†ç å°±å¥½äº†ã€‚</p><h4 id="18-2-1-ç»™rootç”¨æˆ·è®¾ç½®å¯†ç å¹¶ä½¿ç”¨"><a href="#18-2-1-ç»™rootç”¨æˆ·è®¾ç½®å¯†ç å¹¶ä½¿ç”¨" class="headerlink" title="18.2.1 ç»™rootç”¨æˆ·è®¾ç½®å¯†ç å¹¶ä½¿ç”¨"></a>18.2.1 ç»™rootç”¨æˆ·è®¾ç½®å¯†ç å¹¶ä½¿ç”¨</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">1 ) è¾“å…¥ sudo passwd å‘½ä»¤ï¼Œè¾“å…¥ä¸€èˆ¬ç”¨æˆ·å¯†ç å¹¶è®¾å®šrootç”¨æˆ·å¯†ç ã€‚<br>2 ) è®¾å®šrootå¯†ç æˆåŠŸåï¼Œè¾“å…¥ su å‘½ä»¤ï¼Œå¹¶è¾“å…¥åˆšæ‰è®¾å®šçš„rootå¯†ç ï¼Œå°±å¯ä»¥åˆ‡æ¢æˆrootäº†ã€‚# æç¤ºç¬¦$ä»£è¡¨ä¸€èˆ¬ç”¨æˆ·ï¼Œæç¤ºç¬¦#ä»£è¡¨rootç”¨æˆ·ã€‚<br>3 ) è¾“å…¥ exit å‘½ä»¤ï¼Œé€€å‡ºrootå¹¶è¿”å›ä¸€èˆ¬ç”¨æˆ·<br>4 ) ä»¥åå°±å¯ä»¥ä½¿ç”¨rootç”¨æˆ·äº† <br></code></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>sudo</code>æ˜¯å…è®¸å½“å‰ç”¨æˆ·ä»¥rootèº«ä»½æ‰§è¡Œå‘½ä»¤ï¼Œä½†æ˜¯æœ¬èº«è¿˜æ˜¯æ™®é€šç”¨æˆ·ï¼›è€Œ<code>su root</code>æ˜¯åˆ‡æ¢åˆ°rootç”¨æˆ·ï¼Œå®¶ç›®å½•å˜æˆ<code>/root</code>ã€‚</p><h2 id="åä¹ã€Ubuntu-è½¯ä»¶ç®¡ç†å’Œè¿œç¨‹ç™»å½•"><a href="#åä¹ã€Ubuntu-è½¯ä»¶ç®¡ç†å’Œè¿œç¨‹ç™»å½•" class="headerlink" title="åä¹ã€Ubuntu è½¯ä»¶ç®¡ç†å’Œè¿œç¨‹ç™»å½•"></a>åä¹ã€Ubuntu è½¯ä»¶ç®¡ç†å’Œè¿œç¨‹ç™»å½•</h2><p>APTä»‹ç»</p><p>aptæ˜¯AdvancedPackagingToolçš„ç®€ç§°ï¼Œæ˜¯ä¸€æ¬¾å®‰è£…åŒ…ç®¡ç†å·¥å…·ã€‚åœ¨Ubuntuä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨aptå‘½ä»¤å¯ç”¨äºè½¯ä»¶åŒ…çš„å®‰è£…ã€åˆ é™¤ã€æ¸…ç†ç­‰ï¼Œç±»ä¼¼äºWindowsä¸­çš„è½¯ä»¶ç®¡ç†å·¥å…·ã€‚</p><p>ubuntu è½¯ä»¶ç®¡ç†çš„åŸç†ç¤ºæ„å›¾ï¼š</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20220227150334400.png"></p><h3 id="19-1-Ubuntuè½¯ä»¶æ“ä½œçš„ç›¸å…³å‘½ä»¤"><a href="#19-1-Ubuntuè½¯ä»¶æ“ä½œçš„ç›¸å…³å‘½ä»¤" class="headerlink" title="19.1 Ubuntuè½¯ä»¶æ“ä½œçš„ç›¸å…³å‘½ä»¤"></a>19.1 Ubuntuè½¯ä»¶æ“ä½œçš„ç›¸å…³å‘½ä»¤</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs routeros">sudo apt-<span class="hljs-builtin-name">get</span> update æ›´æ–°æº<br>sudo apt-<span class="hljs-builtin-name">get</span> install package å®‰è£…åŒ…<br>sudo apt-<span class="hljs-builtin-name">get</span> <span class="hljs-builtin-name">remove</span> package åˆ é™¤åŒ…<br></code></pre></td></tr></table></figure><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ada">sudo apt-cache search <span class="hljs-keyword">package</span> <span class="hljs-title">æœç´¢è½¯ä»¶åŒ…</span><br>sudo apt-cache show <span class="hljs-keyword">package</span> <span class="hljs-title">è·å–åŒ…çš„ç›¸å…³ä¿¡æ¯ï¼Œå¦‚è¯´æ˜ã€å¤§å°ã€ç‰ˆæœ¬ç­‰</span><br>sudo apt-get install <span class="hljs-keyword">package</span> <span class="hljs-title">--reinstall é‡æ–°å®‰è£…åŒ…</span><br></code></pre></td></tr></table></figure><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs routeros">sudo apt-<span class="hljs-builtin-name">get</span> -f install ä¿®å¤å®‰è£…<br>sudo apt-<span class="hljs-builtin-name">get</span> <span class="hljs-builtin-name">remove</span> package --purge åˆ é™¤åŒ…ï¼ŒåŒ…æ‹¬é…ç½®æ–‡ä»¶ç­‰<br>sudo apt-<span class="hljs-builtin-name">get</span> build-dep package å®‰è£…ç›¸å…³çš„ç¼–è¯‘ç¯å¢ƒ<br></code></pre></td></tr></table></figure><figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs processing">sudo apt-<span class="hljs-built_in">get</span> upgrade æ›´æ–°å·²å®‰è£…çš„åŒ…<br>sudo apt-<span class="hljs-built_in">get</span> <span class="hljs-built_in">dist</span>-upgrade å‡çº§ç³»ç»Ÿ<br>sudo apt-cache depends <span class="hljs-keyword">package</span> äº†è§£ä½¿ç”¨è¯¥åŒ…ä¾èµ–é‚£äº›åŒ…<br>sudo apt-cache rdepends <span class="hljs-keyword">package</span> æŸ¥çœ‹è¯¥åŒ…è¢«å“ªäº›åŒ…ä¾èµ–<br>sudo apt-<span class="hljs-built_in">get</span> source <span class="hljs-keyword">package</span> ä¸‹è½½è¯¥åŒ…çš„æºä»£ç <br></code></pre></td></tr></table></figure><h3 id="19-2-æ›´æ–°UBUNTUè½¯ä»¶ä¸‹è½½åœ°å€"><a href="#19-2-æ›´æ–°UBUNTUè½¯ä»¶ä¸‹è½½åœ°å€" class="headerlink" title="19.2 æ›´æ–°UBUNTUè½¯ä»¶ä¸‹è½½åœ°å€"></a>19.2 æ›´æ–°UBUNTUè½¯ä»¶ä¸‹è½½åœ°å€</h3><h4 id="19-2-1-å¯»æ‰¾å›½å†…é•œåƒæº"><a href="#19-2-1-å¯»æ‰¾å›½å†…é•œåƒæº" class="headerlink" title="19.2.1 å¯»æ‰¾å›½å†…é•œåƒæº"></a>19.2.1 å¯»æ‰¾å›½å†…é•œåƒæº</h4><p><a href="https://mirrors.tuna.tsinghua.edu.cn/">https://mirrors.tuna.tsinghua.edu.cn/</a></p><p>æ‰€è°“çš„é•œåƒæºï¼šå¯ä»¥ç†è§£ä¸ºæä¾›ä¸‹è½½è½¯ä»¶çš„åœ°æ–¹ï¼Œæ¯”å¦‚Androidæ‰‹æœºä¸Šå¯ä»¥ä¸‹è½½è½¯ä»¶çš„å®‰å“å¸‚åœºï¼›iOSæ‰‹æœºä¸Šå¯ä»¥ä¸‹è½½è½¯ä»¶çš„AppStore</p><h4 id="19-2-2-å¤‡ä»½Ubuntué»˜è®¤çš„æºåœ°å€"><a href="#19-2-2-å¤‡ä»½Ubuntué»˜è®¤çš„æºåœ°å€" class="headerlink" title="19.2.2 å¤‡ä»½Ubuntué»˜è®¤çš„æºåœ°å€"></a>19.2.2 å¤‡ä»½Ubuntué»˜è®¤çš„æºåœ°å€</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo cp /etc/apt/sources.list /etc/apt/sources.list.backup<br></code></pre></td></tr></table></figure><h4 id="19-2-3-æ›´æ–°æºæœåŠ¡å™¨åˆ—è¡¨"><a href="#19-2-3-æ›´æ–°æºæœåŠ¡å™¨åˆ—è¡¨" class="headerlink" title="19.2.3 æ›´æ–°æºæœåŠ¡å™¨åˆ—è¡¨"></a>19.2.3 æ›´æ–°æºæœåŠ¡å™¨åˆ—è¡¨</h4><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20220227151112006.png"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">vim /etc/apt/souces.list #æ›´æ–°é•œåƒæºåœ°å€æ–‡ä»¶<br>sudo apt-get update #æ›´æ–°æºåœ°å€<br></code></pre></td></tr></table></figure><h3 id="19-3-Ubuntuè½¯ä»¶å®‰è£…ä¸å¸è½½"><a href="#19-3-Ubuntuè½¯ä»¶å®‰è£…ä¸å¸è½½" class="headerlink" title="19.3 Ubuntuè½¯ä»¶å®‰è£…ä¸å¸è½½"></a>19.3 Ubuntuè½¯ä»¶å®‰è£…ä¸å¸è½½</h3><p>ä½¿ç”¨aptå®Œæˆå®‰è£…å’Œå¸è½½vim è½¯ä»¶ï¼Œå¹¶æŸ¥è¯¢ vimè½¯ä»¶çš„ä¿¡æ¯ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo apt-get remove vim<br>sudo apt-get install vim<br>sudo apt-cache show vim<br></code></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç°åœ¨å®˜æ–¹ä¸»æ¨aptå‘½ä»¤ï¼Œaptç›¸å½“äºapt-get + apt-cache + apt-config</p><h3 id="19-4-ä½¿ç”¨SSHè¿œç¨‹ç™»å½•Ubuntu"><a href="#19-4-ä½¿ç”¨SSHè¿œç¨‹ç™»å½•Ubuntu" class="headerlink" title="19.4 ä½¿ç”¨SSHè¿œç¨‹ç™»å½•Ubuntu"></a>19.4 ä½¿ç”¨SSHè¿œç¨‹ç™»å½•Ubuntu</h3><p>sshä»‹ç»</p><p>SSHä¸ºSecureShellçš„ç¼©å†™ï¼Œç”± IETF çš„ç½‘ç»œå·¥ä½œå°ç»„ï¼ˆNetworkWorkingGroupï¼‰æ‰€åˆ¶å®šï¼›SSHä¸ºå»ºç«‹åœ¨åº”ç”¨å±‚å’Œä¼ è¾“å±‚åŸºç¡€ä¸Šçš„å®‰å…¨åè®®ã€‚</p><p>SSHæ˜¯ç›®å‰è¾ƒå¯é ï¼Œä¸“ä¸ºè¿œç¨‹ç™»å½•ä¼šè¯å’Œå…¶ä»–ç½‘ç»œæœåŠ¡æä¾›å®‰å…¨æ€§çš„åè®®ã€‚å¸¸ç”¨äºè¿œç¨‹ç™»å½•ï¼Œä»¥åŠç”¨æˆ·ä¹‹é—´è¿›è¡Œèµ„æ–™æ‹·è´ã€‚å‡ ä¹æ‰€æœ‰ UNIX å¹³å°â€”åŒ…æ‹¬ HP-UXã€Linuxã€AIXã€Solarisã€DigitalUNIXã€Irixï¼Œä»¥åŠå…¶ä»–å¹³å°ï¼Œéƒ½å¯è¿è¡ŒSSHã€‚</p><p>ä½¿ç”¨SSHæœåŠ¡ï¼Œéœ€è¦å®‰è£…ç›¸åº”çš„æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨çš„å…³ç³»ï¼šå¦‚æœï¼ŒAæœºå™¨æƒ³è¢«Bæœºå™¨è¿œç¨‹æ§åˆ¶ï¼Œé‚£ä¹ˆï¼ŒAæœºå™¨éœ€è¦å®‰è£…SSHæœåŠ¡å™¨ï¼ŒBæœºå™¨éœ€è¦å®‰è£…SSHå®¢æˆ·ç«¯ã€‚å’ŒCentOSä¸ä¸€æ ·ï¼ŒUbuntué»˜è®¤æ²¡æœ‰å®‰è£…SSHDæœåŠ¡(netstat -anp æŸ¥çœ‹æ˜¯å¦æœ‰è¿›ç¨‹ç›‘å¬22å·ç«¯å£ï¼Œå¦‚æœè¿netstatå‘½ä»¤éƒ½æ²¡æœ‰å®‰è£…ï¼Œå¯ä»¥ä½¿ç”¨apt install net-toolså…ˆå®‰è£…netstatå‘½ä»¤)ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬ä¸èƒ½è¿›è¡Œè¿œç¨‹ç™»å½•ã€‚</p><h4 id="19-4-1-åŸç†ç¤ºæ„å›¾"><a href="#19-4-1-åŸç†ç¤ºæ„å›¾" class="headerlink" title="19.4.1 åŸç†ç¤ºæ„å›¾"></a>19.4.1 åŸç†ç¤ºæ„å›¾</h4><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20220227152239100.png"></p><h3 id="19-5-ä½¿ç”¨SSHè¿œç¨‹ç™»å½•Ubuntu"><a href="#19-5-ä½¿ç”¨SSHè¿œç¨‹ç™»å½•Ubuntu" class="headerlink" title="19.5 ä½¿ç”¨SSHè¿œç¨‹ç™»å½•Ubuntu"></a>19.5 ä½¿ç”¨SSHè¿œç¨‹ç™»å½•Ubuntu</h3><h4 id="19-5-1-å®‰è£…SSHå’Œå¯ç”¨"><a href="#19-5-1-å®‰è£…SSHå’Œå¯ç”¨" class="headerlink" title="19.5.1 å®‰è£…SSHå’Œå¯ç”¨"></a>19.5.1 å®‰è£…SSHå’Œå¯ç”¨</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo apt-get install openssh-server #æ‰§è¡Œä¸Šé¢æŒ‡ä»¤åï¼Œåœ¨å½“å‰è¿™å°Linuxä¸Šå°±å®‰è£…äº†SSHæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ã€‚<br>service sshd restart #æ‰§è¡Œä¸Šé¢çš„æŒ‡ä»¤ï¼Œå°±å¯åŠ¨äº† sshd æœåŠ¡ã€‚ä¼šç›‘å¬ç«¯å£ 22<br></code></pre></td></tr></table></figure><h4 id="19-5-2-ä»linuxç³»ç»Ÿå®¢æˆ·æœºè¿œç¨‹ç™»é™†linuxç³»ç»ŸæœåŠ¡æœº"><a href="#19-5-2-ä»linuxç³»ç»Ÿå®¢æˆ·æœºè¿œç¨‹ç™»é™†linuxç³»ç»ŸæœåŠ¡æœº" class="headerlink" title="19.5.2 ä»linuxç³»ç»Ÿå®¢æˆ·æœºè¿œç¨‹ç™»é™†linuxç³»ç»ŸæœåŠ¡æœº"></a>19.5.2 ä»linuxç³»ç»Ÿå®¢æˆ·æœºè¿œç¨‹ç™»é™†linuxç³»ç»ŸæœåŠ¡æœº</h4><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åœ¨linuxçš„ç³»ç»Ÿå®¢æˆ·æœºä¹Ÿè¦å®‰è£…<code>openssh-server</code></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20220227152741432.png"></p><p>åŸºæœ¬è¯­æ³•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">ssh ç”¨æˆ·å@IP<br><span class="hljs-meta">#</span><span class="bash">ä¾‹å¦‚ï¼šsshatguigu@192.168.188.131</span><br><span class="hljs-meta">#</span><span class="bash">ä½¿ç”¨sshè®¿é—®ï¼Œå¦‚è®¿é—®å‡ºç°é”™è¯¯ã€‚å¯æŸ¥çœ‹æ˜¯å¦æœ‰è¯¥æ–‡ä»¶ ï½/.ssh/known_ssh å°è¯•åˆ é™¤è¯¥æ–‡ä»¶è§£å†³ã€‚</span><br></code></pre></td></tr></table></figure><p>ç™»å‡º</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">exit<br><span class="hljs-meta">#</span><span class="bash">æˆ–è€…</span><br>logout<br></code></pre></td></tr></table></figure><h2 id="äºŒåã€CentOS8-0-Vs-CentOS7-0"><a href="#äºŒåã€CentOS8-0-Vs-CentOS7-0" class="headerlink" title="äºŒåã€CentOS8.0 Vs CentOS7.0"></a>äºŒåã€CentOS8.0 Vs CentOS7.0</h2><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20220227180614734.png"></p><p>å¯æƒœï¼Œç”±äºçº¢å¸½çš„æ”¿ç­–ï¼ŒCentosä¼šé€æ¸å˜æˆä¸Šæ¸¸ä¸ç¨³å®šç‰ˆæœ¬ï¼Œè€Œä¸”Centos7å’ŒCentos8ä¹Ÿä¼šå¾ˆå¿«ä¸è¢«ç»´æŠ¤ã€‚</p><h2 id="äºŒåä¸€ã€æ—¥å¿—ç®¡ç†"><a href="#äºŒåä¸€ã€æ—¥å¿—ç®¡ç†" class="headerlink" title="äºŒåä¸€ã€æ—¥å¿—ç®¡ç†"></a>äºŒåä¸€ã€æ—¥å¿—ç®¡ç†</h2><p>åŸºæœ¬ä»‹ç»</p><ol><li>æ—¥å¿—æ–‡ä»¶æ˜¯é‡è¦çš„ç³»ç»Ÿä¿¡æ¯æ–‡ä»¶ï¼Œå…¶ä¸­è®°å½•äº†è®¸å¤šé‡è¦çš„ç³»ç»Ÿäº‹ä»¶ï¼ŒåŒ…æ‹¬ç”¨æˆ·çš„ç™»å½•ä¿¡æ¯ã€ç³»ç»Ÿçš„å¯åŠ¨ä¿¡æ¯ã€ç³»ç»Ÿçš„å®‰å…¨ä¿¡æ¯ã€é‚®ä»¶ç›¸å…³ä¿¡æ¯ã€å„ç§æœåŠ¡ç›¸å…³ä¿¡æ¯ç­‰ã€‚</li><li>æ—¥å¿—å¯¹äºå®‰å…¨æ¥è¯´ä¹Ÿå¾ˆé‡è¦ï¼Œå®ƒè®°å½•äº†ç³»ç»Ÿæ¯å¤©å‘ç”Ÿçš„å„ç§äº‹æƒ…ï¼Œé€šè¿‡æ—¥å¿—æ¥æ£€æŸ¥é”™è¯¯å‘ç”Ÿçš„åŸå› ï¼Œæˆ–è€…å—åˆ°æ”»å‡»æ—¶æ”»å‡»è€…ç•™ä¸‹çš„ç—•è¿¹ã€‚</li><li>å¯ä»¥è¿™æ ·ç†è§£æ—¥å¿—æ˜¯ç”¨æ¥è®°å½•é‡å¤§äº‹ä»¶çš„å·¥å…·</li></ol><h3 id="21-1-ç³»ç»Ÿå¸¸ç”¨æ—¥å¿—"><a href="#21-1-ç³»ç»Ÿå¸¸ç”¨æ—¥å¿—" class="headerlink" title="21.1 ç³»ç»Ÿå¸¸ç”¨æ—¥å¿—"></a>21.1 ç³»ç»Ÿå¸¸ç”¨æ—¥å¿—</h3><p><code>/var/log</code>ç›®å½•å°±æ˜¯ç³»ç»Ÿæ—¥å¿—æ–‡ä»¶çš„ä¿å­˜ä½ç½®ï¼š</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20220227181515157.png"></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20220227182650989.png"></p><p>åº”ç”¨æ¡ˆä¾‹</p><p>æ¡ˆä¾‹1ï¼šä½¿ç”¨rootç”¨æˆ·é€šè¿‡xshell6ç™»é™†,ç¬¬ä¸€æ¬¡ä½¿ç”¨é”™è¯¯çš„å¯†ç ï¼Œç¬¬äºŒæ¬¡ä½¿ç”¨æ­£ç¡®çš„å¯†ç ç™»å½•æˆåŠŸçœ‹çœ‹åœ¨æ—¥å¿—æ–‡ä»¶/var/log/secureé‡Œæœ‰æ²¡æœ‰è®°å½•ç›¸å…³ä¿¡æ¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">cat /var/log/secure<br></code></pre></td></tr></table></figure><h3 id="21-2-æ—¥å¿—ç®¡ç†æœåŠ¡rsyslogd"><a href="#21-2-æ—¥å¿—ç®¡ç†æœåŠ¡rsyslogd" class="headerlink" title="21.2 æ—¥å¿—ç®¡ç†æœåŠ¡rsyslogd"></a>21.2 æ—¥å¿—ç®¡ç†æœåŠ¡rsyslogd</h3><p>â€‹        CentOS7.6æ—¥å¿—æœåŠ¡æ˜¯rsyslogdï¼ŒCentOS6.xæ—¥å¿—æœåŠ¡æ˜¯syslogdã€‚rsyslogdåŠŸèƒ½æ›´å¼ºå¤§ã€‚rsyslogdçš„ä½¿ç”¨ã€æ—¥å¿—æ–‡ä»¶çš„æ ¼å¼ï¼Œå’ŒsyslogdæœåŠ¡å…¼å®¹çš„ã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20220227183859819.png"></p><p><code>/etc/rsyslog.conf</code>ä¸­è®°å½•äº†ï¼Œå„ç§æœåŠ¡åº”è¯¥å†™å…¥æ—¥å¿—çš„ç›®å½•ã€‚</p><p>åº”ç”¨æ¡ˆä¾‹</p><p>æ¡ˆä¾‹1ï¼šæŸ¥è¯¢Linuxä¸­çš„rsyslogdæœåŠ¡æ˜¯å¦å¯åŠ¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ps -aux | grep rsyslogd | grep -v grep  # grep -v æ˜¯æŒ‡é€‰æ‹©ä¸å«åŒ¹é…ä¸²çš„è¡Œ<br></code></pre></td></tr></table></figure><p>æ¡ˆä¾‹2ï¼šæŸ¥è¯¢rsyslogdæœåŠ¡çš„è‡ªå¯åŠ¨çŠ¶æ€</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">systemctl list-unit-files | grep rsyslogd<br></code></pre></td></tr></table></figure><h4 id="21-2-1-é…ç½®æ–‡ä»¶-etc-rsyslog-conf"><a href="#21-2-1-é…ç½®æ–‡ä»¶-etc-rsyslog-conf" class="headerlink" title="21.2.1 é…ç½®æ–‡ä»¶ /etc/rsyslog.conf"></a>21.2.1 é…ç½®æ–‡ä»¶ /etc/rsyslog.conf</h4><p>ç¼–è¾‘æ–‡ä»¶æ—¶çš„æ ¼å¼ä¸ºï¼š*.*, å­˜æ”¾æ—¥å¿—æ–‡ä»¶</p><p>å…¶ä¸­ç¬¬ä¸€ä¸ª*ä»£è¡¨æ—¥å¿—ç±»å‹ï¼Œç¬¬äºŒä¸ª*ä»£è¡¨æ—¥å¿—çº§åˆ«</p><ol><li><p>æ—¥å¿—ç±»å‹åˆ†ä¸ºï¼š</p><p>authï¼špamäº§ç”Ÿçš„æ—¥å¿—</p><p>authprivï¼šsshã€ftpç­‰ç™»å½•ä¿¡æ¯çš„éªŒè¯ä¿¡æ¯</p><p>cornï¼šæ—¶é—´ä»»åŠ¡ç›¸å…³</p><p>kernï¼šå†…æ ¸</p><p>lprï¼šæ‰“å°</p><p>mailï¼šé‚®ä»¶</p><p>mark(syslog)-rsyslog:æœåŠ¡å†…éƒ¨çš„ä¿¡æ¯ï¼Œæ—¶é—´æ ‡è¯†</p><p>newsï¼šæ–°é—»ç»„</p><p>userï¼šç”¨æˆ·ç¨‹åºäº§ç”Ÿçš„ç›¸å…³ä¿¡æ¯</p><p>uucpï¼šunix to unix copyä¸»æœºä¹‹é—´ç›¸å…³çš„é€šä¿¡</p><p>local 1-7ï¼šè‡ªå®šä¹‰çš„æ—¥å¿—è®¾å¤‡</p></li><li><p>æ—¥å¿—çº§åˆ«ï¼š</p><p>debugï¼šæœ‰è°ƒè¯•ä¿¡æ¯çš„ï¼Œæ—¥å¿—é€šä¿¡æœ€å¤š</p><p>infoï¼šä¸€èˆ¬ä¿¡æ¯æ—¥å¿—ï¼Œæœ€å¸¸ç”¨</p><p>noticeï¼šæœ€å…·æœ‰é‡è¦æ€§çš„æ™®é€šæ¡ä»¶çš„ä¿¡æ¯</p><p>warningï¼šè­¦å‘Šçº§åˆ«</p><p>errï¼šé”™è¯¯çº§åˆ«ï¼Œé˜»æ­¢æŸä¸ªåŠŸèƒ½æˆ–è€…æ¨¡å—ä¸èƒ½æ­£å¸¸å·¥ä½œçš„ä¿¡æ¯</p><p>critï¼šä¸¥é‡çº§åˆ«ï¼Œé˜»æ­¢æ•´ä¸ªç³»ç»Ÿæˆ–è€…æ•´ä¸ªè½¯ä»¶ä¸èƒ½æ­£å¸¸å·¥ä½œçš„ä¿¡æ¯</p><p>alertï¼šéœ€è¦ç«‹åˆ»ä¿®æ”¹çš„ä¿¡æ¯</p><p>emergï¼šå†…æ ¸å´©æºƒç­‰é‡è¦ä¿¡æ¯</p><p>noneï¼šä»€ä¹ˆéƒ½ä¸è®°å½•</p><p>æ³¨æ„ï¼šä»ä¸Šåˆ°ä¸‹ï¼Œçº§åˆ«ä»ä½åˆ°é«˜ï¼Œè®°å½•ä¿¡æ¯è¶Šæ¥è¶Šå°‘</p></li></ol><p>ç”±æ—¥å¿—æœåŠ¡rsyslogdè®°å½•çš„æ—¥å¿—æ–‡ä»¶ï¼Œæ—¥å¿—æ–‡ä»¶çš„æ ¼å¼åŒ…å«ä»¥ä¸‹4åˆ—ï¼š</p><ol><li><p>äº‹ä»¶äº§ç”Ÿçš„æ—¶é—´</p></li><li><p>äº§ç”Ÿäº‹ä»¶çš„æœåŠ¡å™¨çš„ä¸»æœºå</p></li><li><p>äº§ç”Ÿäº‹ä»¶çš„æœåŠ¡åæˆ–ç¨‹åºå</p></li><li><p>äº‹ä»¶çš„å…·ä½“ä¿¡æ¯</p></li></ol><p>åº”ç”¨æ¡ˆä¾‹</p><p>æ¡ˆä¾‹1ï¼šæŸ¥çœ‹ä¸€ä¸‹/var/log/secureæ—¥å¿—ï¼Œè¿™ä¸ªæ—¥å¿—ä¸­è®°å½•çš„æ˜¯ç”¨æˆ·éªŒè¯å’Œæˆæƒæ–¹é¢çš„ä¿¡æ¯ï¼Œæ¥åˆ†æå¦‚ä½•æŸ¥çœ‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">cat /var/log/secure<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20220227185605784.png"></p><p>æ¡ˆä¾‹2ï¼šåœ¨/etc/rsyslog.confä¸­æ·»åŠ ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶/var/log/hsp.log,å½“æœ‰äº‹ä»¶å‘é€æ—¶(æ¯”å¦‚sshdæœåŠ¡ç›¸å…³äº‹ä»¶)ï¼Œè¯¥æ–‡ä»¶ä¼šæ¥æ”¶åˆ°ä¿¡æ¯å¹¶ä¿å­˜.ç»™å°ä¼™ä¼´æ¼”ç¤ºé‡å¯ï¼Œç™»å½•çš„æƒ…å†µï¼Œçœ‹çœ‹æ˜¯å¦æœ‰æ—¥å¿—ä¿å­˜ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">vim /etc/rsyslog.conf<br><br>*.*/var/log/hsp.log<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">cat /var/log/hsp.log #å°±å¯ä»¥çœ‹åˆ°ç›¸å…³æœåŠ¡æ—¶é—´çš„æ—¥å¿—<br></code></pre></td></tr></table></figure><h3 id="21-3-æ—¥å¿—è½®æ›¿"><a href="#21-3-æ—¥å¿—è½®æ›¿" class="headerlink" title="21.3 æ—¥å¿—è½®æ›¿"></a>21.3 æ—¥å¿—è½®æ›¿</h3><p>åŸºæœ¬ä»‹ç»</p><p>æ—¥å¿—è½®æ›¿å°±æ˜¯æŠŠæ—§çš„æ—¥å¿—æ–‡ä»¶ç§»åŠ¨å¹¶æ”¹åï¼ŒåŒæ—¶å»ºç«‹æ–°çš„ç©ºæ—¥å¿—æ–‡ä»¶ï¼Œå½“æ—§æ—¥å¿—æ–‡ä»¶è¶…å‡ºä¿å­˜çš„èŒƒå›´ä¹‹åï¼Œå°±ä¼šè¿›è¡Œåˆ é™¤ã€‚</p><h4 id="21-3-1-æ—¥å¿—è½®æ›¿æ–‡ä»¶å‘½å"><a href="#21-3-1-æ—¥å¿—è½®æ›¿æ–‡ä»¶å‘½å" class="headerlink" title="21.3.1 æ—¥å¿—è½®æ›¿æ–‡ä»¶å‘½å"></a>21.3.1 æ—¥å¿—è½®æ›¿æ–‡ä»¶å‘½å</h4><ol><li>centos7ä½¿ç”¨logrotateè¿›è¡Œæ—¥å¿—è½®æ›¿ç®¡ç†ï¼Œè¦æƒ³æ”¹å˜æ—¥å¿—è½®æ›¿æ–‡ä»¶åå­—ï¼Œé€šè¿‡/etc/logrotate.confé…ç½®æ–‡ä»¶ä¸­â€œdateextâ€å‚æ•°</li><li>å¦‚æœé…ç½®æ–‡ä»¶ä¸­æœ‰â€œdateextâ€å‚æ•°ï¼Œé‚£ä¹ˆæ—¥å¿—ä¼šç”¨æ—¥æœŸæ¥ä½œä¸ºæ—¥å¿—æ–‡ä»¶çš„åç¼€ï¼Œä¾‹å¦‚â€œsecure-20201010â€ã€‚è¿™æ ·æ—¥å¿—æ–‡ä»¶åä¸ä¼šé‡å ï¼Œä¹Ÿå°±ä¸éœ€è¦æ—¥å¿—æ–‡ä»¶çš„æ”¹åï¼Œåªéœ€è¦æŒ‡å®šä¿å­˜æ—¥å¿—ä¸ªæ•°ï¼Œåˆ é™¤å¤šä½™çš„æ—¥å¿—æ–‡ä»¶å³å¯ã€‚</li><li> å¦‚æœé…ç½®æ–‡ä»¶ä¸­æ²¡æœ‰â€œdateextâ€å‚æ•°ï¼Œæ—¥å¿—æ–‡ä»¶å°±éœ€è¦è¿›è¡Œæ”¹åäº†ã€‚å½“ç¬¬ä¸€æ¬¡è¿›è¡Œæ—¥å¿—è½®æ›¿æ—¶ï¼Œå½“å‰çš„â€œsecureâ€æ—¥å¿—ä¼šè‡ªåŠ¨æ”¹åä¸ºâ€œsecure.1â€ï¼Œç„¶åæ–°å»ºâ€œsecureâ€æ—¥å¿—ï¼Œç”¨æ¥ä¿å­˜æ–°çš„æ—¥å¿—ã€‚å½“ç¬¬äºŒæ¬¡è¿›è¡Œæ—¥å¿—è½®æ›¿æ—¶ï¼Œâ€œsecure.1â€ä¼šè‡ªåŠ¨æ”¹åä¸ºâ€œsecure.2â€ï¼Œå½“å‰çš„â€œsecureâ€æ—¥å¿—ä¼šè‡ªåŠ¨æ”¹åä¸ºâ€œsecure.1â€ï¼Œç„¶åä¹Ÿä¼šæ–°å»ºâ€œsecureâ€æ—¥å¿—ï¼Œç”¨æ¥ä¿å­˜æ–°çš„æ—¥å¿—ï¼Œä»¥æ­¤ç±»æ¨ã€‚</li></ol><h4 id="21-3-2-logrotateé…ç½®æ–‡ä»¶"><a href="#21-3-2-logrotateé…ç½®æ–‡ä»¶" class="headerlink" title="21.3.2 logrotateé…ç½®æ–‡ä»¶"></a>21.3.2 logrotateé…ç½®æ–‡ä»¶</h4><p><code>/etc/logrotate.conf</code>ä¸ºlogrotateçš„å…¨å±€é…ç½®æ–‡ä»¶</p><p>#rotate log files weekly,æ¯å‘¨å¯¹æ—¥å¿—æ–‡ä»¶è¿›è¡Œä¸€æ¬¡è½®æ›¿</p><p>weekly</p><p>#keep 4 weeks worth of backlogs,å…±ä¿å­˜4ä»½æ—¥å¿—æ–‡ä»¶ï¼Œå½“å»ºç«‹æ–°çš„æ—¥å¿—æ–‡ä»¶æ—¶ï¼Œæ—§çš„å°†ä¼šè¢«åˆ é™¤</p><p>rotate4</p><p>#create new (empty) log files after rotating old ones,åˆ›å»ºæ–°çš„ç©ºçš„æ—¥å¿—æ–‡ä»¶ï¼Œåœ¨æ—¥å¿—è½®æ›¿å</p><p>create</p><p>#use date as a suffix of the rotated file,ä½¿ç”¨æ—¥æœŸä½œä¸ºæ—¥å¿—è½®æ›¿æ–‡ä»¶çš„åç¼€</p><p>dateext</p><p>#uncomment this if you want your log files compressed,æ—¥å¿—æ–‡ä»¶æ˜¯å¦å‹ç¼©ã€‚å¦‚æœå–æ¶ˆæ³¨é‡Šï¼Œåˆ™æ—¥å¿—ä¼šåœ¨è½¬å‚¨çš„åŒæ—¶è¿›è¡Œå‹ç¼©#compress</p><p>#RPM packages drop log rotation information into this directory </p><p>include /etc/logrotate.d/</p><p>#åŒ…å«/etc/logrotate.d/ç›®å½•ä¸­æ‰€æœ‰çš„å­é…ç½®æ–‡ä»¶ã€‚ä¹Ÿå°±æ˜¯è¯´ä¼šæŠŠè¿™ä¸ªç›®å½•ä¸­æ‰€æœ‰å­é…ç½®æ–‡ä»¶è¯»å–è¿›æ¥ï¼Œ</p><p>#ä¸‹é¢æ˜¯å•ç‹¬è®¾ç½®ï¼Œä¼˜å…ˆçº§æ›´é«˜ã€‚</p><p>#no packages own wtmp and btmp â€“ weâ€™ll rotate them here</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">/var/log/wtmp &#123;<br><span class="hljs-meta">monthly#</span><span class="bash">æ¯æœˆå¯¹æ—¥å¿—æ–‡ä»¶è¿›è¡Œä¸€æ¬¡è½®æ›¿</span><br>create 0664 root utmp #å»ºç«‹çš„æ–°æ—¥å¿—æ–‡ä»¶ï¼Œæƒé™æ˜¯0664ï¼Œæ‰€æœ‰è€…æ˜¯rootï¼Œæ‰€å±ç»„æ˜¯utmpç»„<br>minsize 1M #æ—¥å¿—æ–‡ä»¶æœ€å°è½®æ›¿å¤§å°æ˜¯1MBï¼Œä¹Ÿå°±æ˜¯æ—¥å¿—ä¸€å®šè¦è¶…è¿‡1MBæ‰ä¼šè¢«è½®æ›¿ï¼Œå¦åˆ™å°±ç®—æ—¶é—´è¾¾åˆ°ä¸€ä¸ªæœˆï¼Œä¹Ÿä¸è¿›è¡Œæ—¥å¿—è½¬å‚¨<br>rotate 1 #ä»…ä¿ç•™ä¸€ä¸ªæ—¥å¿—å¤‡ä»½ã€‚ä¹Ÿå°±æ˜¯åªæœ‰wtmpå’Œwtmp.1æ—¥å¿—ä¿ç•™è€Œå·²<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">/var/log/btmp &#123;<br>missingok #å¦‚æœæ—¥å¿—ä¸å­˜åœ¨ï¼Œåˆ™å¿½ç•¥è¯¥æ—¥å¿—çš„è­¦å‘Šä¿¡æ¯<br>monthly<br>create 0600 root utmp<br>rotate 1<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="21-3-3-logroateé…ç½®æ–‡ä»¶çš„å‚æ•°è¯´æ˜"><a href="#21-3-3-logroateé…ç½®æ–‡ä»¶çš„å‚æ•°è¯´æ˜" class="headerlink" title="21.3.3 logroateé…ç½®æ–‡ä»¶çš„å‚æ•°è¯´æ˜"></a>21.3.3 logroateé…ç½®æ–‡ä»¶çš„å‚æ•°è¯´æ˜</h4><table><thead><tr><th>daily</th><th>æ—¥å¿—çš„è½®æ›¿å‘¨æœŸæ˜¯æ¯å¤©</th></tr></thead><tbody><tr><td>weekly</td><td>æ—¥å¿—çš„è½®æ›¿å‘¨æœŸæ˜¯æ¯å‘¨</td></tr><tr><td>monthly</td><td>æ—¥ååœ¨çš„è½®æ›¿å‘¨æœŸæ˜¯æ¯æœˆ</td></tr><tr><td>rotate æ•°å­—</td><td>ä¿ç•™çš„æ—¥å¿—æ–‡ä»¶ä¸ªæ•°ã€‚0æŒ‡æ¯æœˆå¤‡ä»½</td></tr><tr><td>compress</td><td>æ—¥å¿—è½®æ›¿æ˜¯ï¼Œæ—§çš„æ—¥å¿—è¿›è¡Œå‹ç¼©</td></tr><tr><td>create mode owner group</td><td>å»ºç«‹æ–°æ—¥å¿—ï¼ŒåŒæ—¶æŒ‡å®šæ–°æ—¥å¿—çš„æƒé™ä¸æ‰€æœ‰è€…å’Œæ‰€å±ç»„</td></tr><tr><td>mail address</td><td>å½“æ—¥å¿—è½®æ›¿æ˜¯ï¼Œè¾“å‡ºå†…å®¹é€šè¿‡é‚®ä»¶å‘é€åˆ°æŒ‡å®šçš„é‚®ä»¶åœ°å€</td></tr><tr><td>missingok</td><td>å¦‚æœæ—¥å¿—ä¸å­˜åœ¨ï¼Œåˆ™å¿½ç•¥è¯¥æ—¥å¿—çš„è­¦å‘Šä¿¡æ¯</td></tr><tr><td>notifempty</td><td>å¦‚æœæ—¥å¿—ä¸ºç©ºæ–‡ä»¶ï¼Œåˆ™ä¸è¿›è¡Œæ—¥å¿—è½®æ›¿</td></tr><tr><td>minsize å¤§å°</td><td>æ—¥å¿—è½®æ›¿çš„æœ€å°å€¼ï¼Œä¹Ÿå°±æ˜¯æ—¥å¿—ä¸€å®šè¦è¾¾åˆ°è¿™ä¸ªæœ€å°å€¼æ‰ä¼šè½®æ›¿ï¼Œå¦åˆ™å°±ç®—æ—¶é—´è¾¾åˆ°ä¹Ÿä¸è½®æ›¿</td></tr><tr><td>size å¤§å°</td><td>æ—¥å¿—åªæœ‰å¤§äºæŒ‡å®šå¤§å°æ‰è¿›è¡Œæ—¥å¿—è½®æ›¿ï¼Œè€Œä¸æ˜¯æŒ‰ç…§æ—¶é—´è½®æ›¿</td></tr><tr><td>dateext</td><td>ä½¿ç”¨æ—¥æœŸä½œä¸ºæ—¥å¿—è½®æ›¿æ–‡ä»¶çš„åç¼€</td></tr><tr><td>sharedscripts</td><td>å†æ¬¡å…³é”®å­—ä¹‹åçš„ç›‘æœ¬åªæ‰§è¡Œä¸€æ¬¡</td></tr><tr><td>prerotate/endscript</td><td>åœ¨æ—¥å¿—è½®æ›¿å‰æ‰§è¡Œè„šæœ¬å‘½ä»¤</td></tr><tr><td>postroate/endscript</td><td>åœ¨æ—¥å¿—è½®æ›¿åæ‰§è¡Œè„šæœ¬å‘½ä»¤</td></tr></tbody></table><p>åº”ç”¨æ¡ˆä¾‹</p><p>æ¡ˆä¾‹1ï¼šæŠŠè‡ªå·±çš„æ—¥å¿—åŠ å…¥æ—¥å¿—è½®æ›¿</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell">å¯ä»¥å†™å…¥åˆ°/etc/logrotate.d/ä¸‹ï¼Œvim hsp<br><br>/var/log/hsp.log &#123;<br>missingok<br>daily<br>copytruncate<br>rotate 7<br>notifempty<br>&#125;<br><span class="hljs-meta">#</span><span class="bash">åŒæ ·ä¹Ÿå¯ä»¥ç›´æ¥å†™å…¥åˆ°ä¸»é…ç½®æ–‡ä»¶ä¸­ï¼Œ/etc/logrotate.confä¸­</span><br></code></pre></td></tr></table></figure><h4 id="21-3-4-æ—¥å¿—è½®æ›¿æœºåˆ¶åŸç†"><a href="#21-3-4-æ—¥å¿—è½®æ›¿æœºåˆ¶åŸç†" class="headerlink" title="21.3.4 æ—¥å¿—è½®æ›¿æœºåˆ¶åŸç†"></a>21.3.4 æ—¥å¿—è½®æ›¿æœºåˆ¶åŸç†</h4><p>æ—¥å¿—è½®æ›¿ä¹‹æ‰€ä»¥å¯ä»¥åœ¨æŒ‡å®šçš„æ—¶é—´å¤‡ä»½æ—¥å¿—ï¼Œæ˜¯ä¾èµ–ç³»ç»Ÿå®šæ—¶ä»»åŠ¡ã€‚åœ¨/etc/cron.daily/ç›®å½•ï¼Œå°±ä¼šå‘ç°è¿™ä¸ªç›®å½•ä¸­æ˜¯æœ‰logrotateæ–‡ä»¶(å¯æ‰§è¡Œ)ï¼Œlogrotateé€šè¿‡è¿™ä¸ªæ–‡ä»¶ä¾èµ–å®šæ—¶ä»»åŠ¡æ‰§è¡Œçš„ã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20220227183859819.png"></p><h3 id="21-4-æŸ¥çœ‹å†…å­˜æ—¥å¿—"><a href="#21-4-æŸ¥çœ‹å†…å­˜æ—¥å¿—" class="headerlink" title="21.4 æŸ¥çœ‹å†…å­˜æ—¥å¿—"></a>21.4 æŸ¥çœ‹å†…å­˜æ—¥å¿—</h3><p>journalctlå¯ä»¥æŸ¥çœ‹å†…å­˜æ—¥å¿—ï¼Œè¿™é‡Œæˆ‘ä»¬çœ‹çœ‹å¸¸ç”¨çš„æŒ‡ä»¤ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">journalctl #æŸ¥çœ‹å…¨éƒ¨<br>journalctl -n 3 #æŸ¥çœ‹æœ€æ–°3æ¡<br>journalctl --since 19:00 --until 19:10:10 #æŸ¥çœ‹èµ·å§‹æ—¶é—´åˆ°ç»“æŸæ—¶é—´çš„æ—¥å¿—å¯åŠ æ—¥æœŸ<br>journalctl -p err #æŠ¥é”™æ—¥å¿—<br>journalctl -o varbose #æ—¥å¿—è¯¦ç»†å†…å®¹<br>journalctl _PID=1245 _COMM=sshd #æŸ¥çœ‹åŒ…å«è¿™äº›å‚æ•°çš„æ—¥å¿—<br>æˆ–è€… journalctl | grep sshd<br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼šjournalctlæŸ¥çœ‹çš„äº‹å†…å­˜æ—¥å¿—ï¼Œé‡å¯æ¸…ç©º</p><p>åº”ç”¨æ¡ˆä¾‹ï¼š</p><p>æ¡ˆä¾‹1ï¼šä½¿ç”¨ journalctl | grep sshdæ¥çœ‹çœ‹ç”¨æˆ·ç™»å½•æ¸…ç©º,é‡å¯ç³»ç»Ÿï¼Œå†æ¬¡æŸ¥è¯¢ï¼Œçœ‹çœ‹æ—¥å¿—æœ‰ä»€ä¹ˆå˜åŒ–æ²¡æœ‰</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">journalctl | grep sshd<br></code></pre></td></tr></table></figure><h2 id="äºŒåäºŒã€å®šåˆ¶è‡ªå·±çš„Linuxç³»ç»Ÿ"><a href="#äºŒåäºŒã€å®šåˆ¶è‡ªå·±çš„Linuxç³»ç»Ÿ" class="headerlink" title="äºŒåäºŒã€å®šåˆ¶è‡ªå·±çš„Linuxç³»ç»Ÿ"></a>äºŒåäºŒã€å®šåˆ¶è‡ªå·±çš„Linuxç³»ç»Ÿ</h2><h3 id="22-1-åŸºæœ¬ä»‹ç»"><a href="#22-1-åŸºæœ¬ä»‹ç»" class="headerlink" title="22.1 åŸºæœ¬ä»‹ç»"></a>22.1 åŸºæœ¬ä»‹ç»</h3><p>é€šè¿‡è£å‰ªç°æœ‰Linuxç³»ç»Ÿ(CentOS7.6)ï¼Œåˆ›å»ºå±äºè‡ªå·±çš„minLinuxå°ç³»ç»Ÿï¼Œå¯ä»¥åŠ æ·±æˆ‘ä»¬å¯¹linuxçš„ç†è§£ã€‚</p><h3 id="22-2-å¯åŠ¨æµç¨‹ä»‹ç»"><a href="#22-2-å¯åŠ¨æµç¨‹ä»‹ç»" class="headerlink" title="22.2 å¯åŠ¨æµç¨‹ä»‹ç»"></a>22.2 å¯åŠ¨æµç¨‹ä»‹ç»</h3><p>åˆ¶ä½œLinuxå°ç³»ç»Ÿä¹‹å‰ï¼Œå†äº†è§£ä¸€ä¸‹Linuxçš„å¯åŠ¨æµç¨‹ï¼š</p><p>1ã€é¦–å…ˆLinuxè¦é€šè¿‡è‡ªæ£€ï¼Œæ£€æŸ¥ç¡¬ä»¶è®¾å¤‡æœ‰æ²¡æœ‰æ•…éšœ</p><p>2ã€å¦‚æœæœ‰å¤šå—å¯åŠ¨ç›˜çš„è¯ï¼Œéœ€è¦åœ¨BIOSä¸­é€‰æ‹©å¯åŠ¨ç£ç›˜</p><p>3ã€å¯åŠ¨MBRä¸­çš„bootloaderå¼•å¯¼ç¨‹åº</p><p>4ã€åŠ è½½å†…æ ¸æ–‡ä»¶</p><p>5ã€æ‰§è¡Œæ‰€æœ‰è¿›ç¨‹çš„çˆ¶è¿›ç¨‹ã€è€ç¥–å®—systemd</p><p>6ã€æ¬¢è¿ç•Œé¢</p><p>åœ¨Linuxçš„å¯åŠ¨æµç¨‹ä¸­ï¼ŒåŠ è½½å†…æ ¸æ–‡ä»¶æ—¶å…³é”®æ–‡ä»¶ï¼š</p><p>1ï¼‰kernelæ–‡ä»¶:vmlinuz-3.10.0-957.el7.x86_64</p><p>2ï¼‰initrdæ–‡ä»¶:initramfs-3.10.0-957.el7.x86_64.img</p><h3 id="22-3-åˆ¶ä½œminlinuxæ€è·¯åˆ†æ"><a href="#22-3-åˆ¶ä½œminlinuxæ€è·¯åˆ†æ" class="headerlink" title="22.3 åˆ¶ä½œminlinuxæ€è·¯åˆ†æ"></a>22.3 åˆ¶ä½œminlinuxæ€è·¯åˆ†æ</h3><p>1)åœ¨ç°æœ‰çš„Linuxç³»ç»Ÿ(centos7.6)ä¸ŠåŠ ä¸€å—ç¡¬ç›˜/dev/sdbï¼Œåœ¨ç¡¬ç›˜ä¸Šåˆ†ä¸¤ä¸ªåˆ†åŒºï¼Œä¸€ä¸ªæ˜¯/bootï¼Œä¸€ä¸ªæ˜¯/ï¼Œå¹¶å°†å…¶æ ¼å¼åŒ–ã€‚éœ€è¦æ˜ç¡®çš„æ˜¯ï¼Œç°åœ¨åŠ çš„è¿™ä¸ªç¡¬ç›˜åœ¨ç°æœ‰çš„Linuxç³»ç»Ÿä¸­æ˜¯/dev/sdbï¼Œä½†æ˜¯ï¼Œå½“æˆ‘ä»¬æŠŠä¸œè¥¿å…¨éƒ¨è®¾ç½®å¥½æ—¶ï¼Œè¦æŠŠè¿™ä¸ªç¡¬ç›˜æ‹”é™¤ï¼Œæ”¾åœ¨æ–°ç³»ç»Ÿä¸Šï¼Œæ­¤æ—¶ï¼Œå°±æ˜¯/dev/sda</p><p>2)åœ¨/dev/sdbç¡¬ç›˜ä¸Šï¼Œå°†å…¶æ‰“é€ æˆç‹¬ç«‹çš„Linuxç³»ç»Ÿï¼Œé‡Œé¢çš„æ‰€æœ‰æ–‡ä»¶æ˜¯éœ€è¦æ‹·è´è¿›å»çš„</p><p>3)ä½œä¸ºèƒ½ç‹¬ç«‹è¿è¡Œçš„Linuxç³»ç»Ÿï¼Œå†…æ ¸æ˜¯ä¸€å®šä¸èƒ½å°‘ï¼Œè¦æŠŠå†…æ ¸æ–‡ä»¶å’Œinitramfsæ–‡ä»¶ä¹Ÿä¸€èµ·æ‹·åˆ°/dev/sdbä¸Š</p><p>4)ä»¥ä¸Šæ­¥éª¤å®Œæˆï¼Œæˆ‘ä»¬çš„è‡ªåˆ¶Linuxå°±å®Œæˆ,åˆ›å»ºä¸€ä¸ªæ–°çš„linuxè™šæ‹Ÿæœºï¼Œå°†å…¶ç¡¬ç›˜æŒ‡å‘æˆ‘ä»¬åˆ›å»ºçš„ç¡¬ç›˜ï¼Œå¯åŠ¨å³å¯</p><h2 id="äºŒåä¸‰ã€Linuxå†…æ ¸æºç ä»‹ç»-amp-å†…æ ¸å‡çº§"><a href="#äºŒåä¸‰ã€Linuxå†…æ ¸æºç ä»‹ç»-amp-å†…æ ¸å‡çº§" class="headerlink" title="äºŒåä¸‰ã€Linuxå†…æ ¸æºç ä»‹ç»&amp;å†…æ ¸å‡çº§"></a>äºŒåä¸‰ã€Linuxå†…æ ¸æºç ä»‹ç»&amp;å†…æ ¸å‡çº§</h2><p>ä¸ºä»€ä¹ˆè¦é˜…è¯»linuxå†…æ ¸?</p><p>1)çˆ±å¥½ï¼Œå°±æ˜¯å–œæ¬¢linux(é»‘å®¢ç²¾ç¥)</p><p>2)æƒ³æ·±å…¥ç†è§£linuxåº•å±‚è¿è¡Œæœºåˆ¶ï¼Œå¯¹æ“ä½œç³»ç»Ÿæœ‰æ·±å…¥ç†è§£</p><p>3)é˜…è¯»Linuxå†…æ ¸ï¼Œä½ ä¼šå¯¹æ•´ä¸ªè®¡ç®—æœºä½“ç³»æœ‰ä¸€ä¸ªæ›´æ·±åˆ»çš„è®¤è¯†ã€‚ä½œä¸ºå¼€å‘è€…ï¼Œä¸ç®¡ä½ ä»äº‹çš„æ˜¯é©±åŠ¨å¼€å‘ï¼Œåº”ç”¨å¼€å‘è¿˜æ˜¯åå°å¼€å‘ï¼Œä½ éƒ½éœ€è¦äº†è§£æ“ä½œç³»ç»Ÿå†…æ ¸çš„è¿è¡Œæœºåˆ¶ï¼Œè¿™æ ·æ‰èƒ½å†™å‡ºæ›´å¥½çš„ä»£ç ã€‚</p><p>4)ä½œä¸ºå¼€å‘äººå‘˜ä¸åº”è¯¥åªå±€é™åœ¨è‡ªå·±çš„é¢†åŸŸï¼Œä½ è®¾è®¡çš„æ¨¡å—çœ‹èµ·æ¥å°ï¼Œä½†æ˜¯ä½ ä¸äº†è§£è¿›ç¨‹çš„è°ƒç”¨æœºåˆ¶ï¼Œä½ ä¸çŸ¥é“è¿›ç¨‹ä¸ºä»€ä¹ˆä¼šé˜»å¡ã€å°±ç»ªã€æ‰§è¡Œå‡ ä¸ªçŠ¶æ€ã€‚é‚£ä¹ˆå¾ˆéš¾å†™å‡ºä¼˜è´¨çš„ä»£ç ã€‚</p><p>5)ä½œä¸ºæœ‰è¿½æ±‚çš„ç¨‹åºå‘˜ï¼Œè¿˜æ˜¯åº”è¯¥æ·±å…¥çš„äº†è§£ä¸€ä¸ªæ“ä½œç³»ç»Ÿçš„åº•å±‚æœºåˆ¶,(æ¯”å¦‚linux/unix)æœ€å¥½æ˜¯æºç çº§åˆ«çš„ï¼Œè¿™æ ·ä½ å†™å¤šçº¿ç¨‹é«˜å¹¶å‘ç¨‹åºï¼ŒåŒ…æ‹¬æ¶æ„ï¼Œä¼˜åŒ–ï¼Œç®—æ³•ç­‰ï¼Œé«˜åº¦ä¸ä¸€æ ·çš„ï¼Œå½“ç„¶è€éŸ©ä¹Ÿä¸æ˜¯è¦æ±‚å°ä¼™ä¼´å„¿æŠŠä¸€ä¸ªéå¸¸åºå¤§çš„Linuxå†…æ ¸æ¯ä¸€è¡Œéƒ½è¯»æ‡‚ã€‚æˆ‘è§‰å¾—ã€‚ä½ è‡³å°‘èƒ½çœ‹å‡ ä¸ªæ ¸å¿ƒçš„æ¨¡å—ã€‚</p><h4 id="23-1-linux0-01å†…æ ¸æºç "><a href="#23-1-linux0-01å†…æ ¸æºç " class="headerlink" title="23.1 linux0.01å†…æ ¸æºç "></a>23.1 linux0.01å†…æ ¸æºç </h4><p>Linuxçš„å†…æ ¸æºä»£ç å¯ä»¥ä»ç½‘ä¸Šä¸‹è½½,è§£å‹ç¼©åæ–‡ä»¶ä¸€èˆ¬ä¹Ÿéƒ½ä½äºlinuxç›®å½•ä¸‹ã€‚å†…æ ¸æºä»£ç æœ‰å¾ˆå¤šç‰ˆæœ¬ï¼Œå¯ä»¥ä»linux0.01å†…æ ¸å…¥æ‰‹ï¼Œæ€»å…±çš„ä»£ç 1wè¡Œå·¦å³ï¼Œæœ€æ–°ç‰ˆæœ¬5.9.8æ€»å…±ä»£ç è¶…è¿‡700wè¡Œï¼Œéå¸¸åºå¤§.<a href="https://www.kernel.org/">Linuxå†…æ ¸ä¸‹è½½åœ°å€</a></p><h4 id="23-1-1-å†…æ ¸æºç é˜…è¯»æŠ€å·§"><a href="#23-1-1-å†…æ ¸æºç é˜…è¯»æŠ€å·§" class="headerlink" title="23.1.1 å†…æ ¸æºç é˜…è¯»æŠ€å·§"></a>23.1.1 å†…æ ¸æºç é˜…è¯»æŠ€å·§</h4><p>1)linux0.01çš„é˜…è¯»éœ€è¦æ‡‚cè¯­è¨€</p><p>2)é˜…è¯»æºç å‰ï¼Œåº”çŸ¥é“Linuxå†…æ ¸æºç çš„æ•´ä½“åˆ†å¸ƒæƒ…å†µã€‚ç°ä»£çš„æ“ä½œç³»ç»Ÿä¸€èˆ¬ç”±è¿›ç¨‹ç®¡ç†ã€å†…å­˜ç®¡ç†ã€æ–‡ä»¶ç³»ç»Ÿã€é©±åŠ¨ç¨‹åºå’Œç½‘ç»œç­‰ç»„æˆã€‚Linuxå†…æ ¸æºç çš„å„ä¸ªç›®å½•å¤§è‡´ä¸æ­¤ç›¸å¯¹åº”.</p><p>3)åœ¨é˜…è¯»æ–¹æ³•æˆ–é¡ºåºä¸Šï¼Œæœ‰çºµå‘ä¸æ¨ªå‘ä¹‹åˆ†ã€‚æ‰€è°“çºµå‘å°±æ˜¯é¡ºç€ç¨‹åºçš„æ‰§è¡Œé¡ºåºé€æ­¥è¿›è¡Œï¼›æ‰€è°“æ¨ªå‘ï¼Œå°±æ˜¯æŒ‰æ¨¡å—è¿›è¡Œã€‚å®ƒä»¬ç»å¸¸ç»“åˆåœ¨ä¸€èµ·è¿›è¡Œ</p><p>4)å¯¹äºLinuxå¯åŠ¨çš„ä»£ç å¯é¡ºç€Linuxçš„å¯åŠ¨é¡ºåºä¸€æ­¥æ­¥æ¥é˜…è¯»ï¼›å¯¹äºåƒå†…å­˜ç®¡ç†éƒ¨åˆ†ï¼Œå¯ä»¥å•ç‹¬æ‹¿å‡ºæ¥è¿›è¡Œé˜…è¯»åˆ†æã€‚å®é™…ä¸Šè¿™æ˜¯ä¸€ä¸ªåå¤çš„è¿‡ç¨‹ï¼Œä¸å¯èƒ½è¯»ä¸€éå°±ç†è§£</p><h4 id="23-1-2-linuxç›®å½•è¯´æ˜"><a href="#23-1-2-linuxç›®å½•è¯´æ˜" class="headerlink" title="23.1.2 linuxç›®å½•è¯´æ˜"></a>23.1.2 linuxç›®å½•è¯´æ˜</h4><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20220227214906739.png"></p><h4 id="23-1-3-main-cåˆæ¢"><a href="#23-1-3-main-cåˆæ¢" class="headerlink" title="23.1.3 main.cåˆæ¢"></a>23.1.3 main.cåˆæ¢</h4><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20220227215620318.png"></p><h3 id="23-2-å†…æ ¸å‡çº§"><a href="#23-2-å†…æ ¸å‡çº§" class="headerlink" title="23.2 å†…æ ¸å‡çº§"></a>23.2 å†…æ ¸å‡çº§</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">uname -a #æŸ¥çœ‹å½“å‰çš„å†…æ ¸ç‰ˆæœ¬<br>yum info kernel -q #æ£€æµ‹å†…æ ¸ç‰ˆæœ¬ï¼Œæ˜¾ç¤ºå¯ä»¥å‡çº§çš„å†…æ ¸<br>yum update kernel #å‡çº§å†…æ ¸<br>yum list kernel -q #æŸ¥çœ‹å·²ç»å®‰è£…çš„å†…æ ¸<br></code></pre></td></tr></table></figure><h3 id="äºŒåå››ã€å¤‡ä»½ä¸æ¢å¤"><a href="#äºŒåå››ã€å¤‡ä»½ä¸æ¢å¤" class="headerlink" title="äºŒåå››ã€å¤‡ä»½ä¸æ¢å¤"></a>äºŒåå››ã€å¤‡ä»½ä¸æ¢å¤</h3><p>åŸºæœ¬ä»‹ç»ï¼š</p><p>å®ä½“æœºæ— æ³•åšå¿«ç…§ï¼Œå¦‚æœç³»ç»Ÿå‡ºç°å¼‚å¸¸æˆ–è€…æ•°æ®æŸåï¼Œåæœä¸¥é‡ï¼Œè¦é‡åšç³»ç»Ÿï¼Œè¿˜ä¼šé€ æˆæ•°æ®ä¸¢å¤±ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¤‡ä»½å’Œæ¢å¤æŠ€æœ¯linuxçš„å¤‡ä»½å’Œæ¢å¤å¾ˆç®€å•ï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼š</p><p>1)æŠŠéœ€è¦çš„æ–‡ä»¶(æˆ–è€…åˆ†åŒº)ç”¨<code>tar</code>æ‰“åŒ…å°±è¡Œï¼Œä¸‹æ¬¡éœ€è¦æ¢å¤çš„æ—¶å€™ï¼Œå†è§£å‹å¼€è¦†ç›–å³å¯</p><p>2)ä½¿ç”¨dumpå’Œrestoreå‘½ä»¤</p><h4 id="24-1-å®‰è£…dumpå’Œrestore"><a href="#24-1-å®‰è£…dumpå’Œrestore" class="headerlink" title="24.1 å®‰è£…dumpå’Œrestore"></a>24.1 å®‰è£…dumpå’Œrestore</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">yum -y install dump<br>yum -y install restore<br></code></pre></td></tr></table></figure><h3 id="24-2-ä½¿ç”¨dumpå®Œæˆå¤‡ä»½"><a href="#24-2-ä½¿ç”¨dumpå®Œæˆå¤‡ä»½" class="headerlink" title="24.2 ä½¿ç”¨dumpå®Œæˆå¤‡ä»½"></a>24.2 ä½¿ç”¨dumpå®Œæˆå¤‡ä»½</h3><p>åŸºæœ¬ä»‹ç»</p><p>dumpæ”¯æŒåˆ†å·å’Œå¢é‡å¤‡ä»½ï¼ˆæ‰€è°“å¢é‡å¤‡ä»½æ˜¯æŒ‡å¤‡ä»½ä¸Šæ¬¡å¤‡ä»½åä¿®æ”¹/å¢åŠ è¿‡çš„æ–‡ä»¶ï¼Œä¹Ÿç§°å·®å¼‚å¤‡ä»½ï¼‰ã€‚</p><p>åŸºæœ¬è¯­æ³•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">dump [-cu] [-f &lt;å¤‡ä»½åæ–‡ä»¶å&gt;] [-T &lt;æ—¥æœŸ&gt;] [ç›®å½•æˆ–æ–‡ä»¶ç³»ç»Ÿ]<br>dump [-wW]<br></code></pre></td></tr></table></figure><p>é€‰é¡¹è§£é‡Š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell">-c :åˆ›å»ºæ–°çš„å½’æ¡£æ–‡ä»¶ï¼Œå¹¶å°†ç”±ä¸€ä¸ªæˆ–å¤šä¸ªæ–‡ä»¶å‚æ•°æ‰€æŒ‡å®šçš„å†…å®¹å†™å…¥å½’æ¡£æ–‡ä»¶çš„å¼€å¤´ï¼ˆcå°±æ˜¯ä¸‹é¢0-9çš„æ•°å­—)<br>-0123456789ï¼š å¤‡ä»½çš„å±‚çº§ã€‚0ä¸ºæœ€å®Œæ•´å¤‡ä»½ï¼Œä¼šè¢«åˆ†æ‰€æœ‰æ–‡ä»¶ã€‚è‹¥æŒ‡å®š0ä»¥ä¸Šçš„å±‚çº§ï¼Œåˆ™å¤‡ä»½è‡³ä¸Šä¸€æ¬¡å¤‡ä»½ä»¥æ¥ä¿®æ”¹æˆ–æ–°å¢çš„æ–‡ä»¶ï¼Œåˆ°9åï¼Œå¯ä»¥å†æ¬¡è½®æ›¿<br>-f &lt;å¤‡ä»½åæ–‡ä»¶å&gt;: æŒ‡å®šå¤‡ä»½åæ–‡ä»¶å<br>-j: è°ƒç”¨bzlibåº“å‹ç¼©å¤‡ä»½æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯å°†å¤‡ä»½åçš„æ–‡ä»¶å‹ç¼©æˆbz2æ ¼å¼ï¼Œè®©æ–‡ä»¶æ›´å°<br>-T &lt;æ—¥æœŸ&gt;: æŒ‡å®šå¼€å§‹å¤‡ä»½çš„æ—¶é—´ä¸æ—¥æœŸ<br>-u: å¤‡ä»½å®Œæ¯•åï¼Œåœ¨/etc/dumpdaresä¸­è®°å½•å¤‡ä»½çš„æ–‡ä»¶ç³»ç»Ÿï¼Œå±‚çº§ï¼Œæ—¥æœŸä¸æ—¶é—´ç­‰ã€‚<br>-t: æŒ‡å®šæ–‡ä»¶è‹¥æ”¹æ–‡ä»¶å·²å­˜åœ¨å¤‡ä»½æ–‡ä»¶ä¸­ï¼Œåˆ™åˆ—å‡ºåç§°<br>-W: æ˜¾ç¤ºéœ€è¦å¤‡ä»½çš„æ–‡ä»¶åŠå…¶æœ€åä¸€æ¬¡å¤‡ä»½çš„å±‚çº§ï¼Œæ—¶é—´ï¼Œæ—¥æœŸ<br>-wï¼šä¸-Wç±»ä¼¼ï¼Œä½†ä»…æ˜¾ç¤ºéœ€è¦å¤‡ä»½çš„æ–‡ä»¶ã€‚<br></code></pre></td></tr></table></figure><p>åº”ç”¨æ¡ˆä¾‹</p><p>æ¡ˆä¾‹1ï¼šå°†/bootåˆ†åŒºæ‰€æœ‰å†…å®¹å¤‡ä»½åˆ°/opt/boot.bak0.bz2æ–‡ä»¶ä¸­ï¼Œå¤‡ä»½å±‚çº§ä¸ºâ€œ0â€</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">dump -0uj -f /opt/book.bak0.bz2 /boot<br></code></pre></td></tr></table></figure><p>æ¡ˆä¾‹2ï¼šåœ¨/bootç›®å½•ä¸‹å¢åŠ æ–°æ–‡ä»¶ï¼Œå¤‡ä»½å±‚çº§ä¸ºâ€œ1â€(åªå¤‡ä»½ä¸Šæ¬¡ä½¿ç”¨å±‚æ¬¡â€œ0â€å¤‡ä»½åå‘ç”Ÿè¿‡æ”¹å˜çš„æ•°æ®),æ³¨æ„æ¯”è¾ƒçœ‹çœ‹è¿™æ¬¡ç”Ÿæˆçš„å¤‡ä»½æ–‡ä»¶boot1.bakæœ‰å¤šå¤§</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">dump -1uj -f /opt/boot.bak1.bz2 /boot<br></code></pre></td></tr></table></figure><p>é€šè¿‡dumpå‘½ä»¤åœ¨é…åˆcrontabå¯ä»¥å®ç°æ— äººå€¼å®ˆå¤‡ä»½</p><p>æ¡ˆä¾‹3ï¼šæ˜¾ç¤ºéœ€è¦å¤‡ä»½çš„æ–‡ä»¶åŠå…¶æœ€åä¸€æ¬¡å¤‡ä»½çš„å±‚çº§ï¼Œæ—¶é—´ï¼Œæ—¥æœŸ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">dump -W<br></code></pre></td></tr></table></figure><p>æ¡ˆä¾‹4ï¼šæŸ¥çœ‹å¤‡ä»½æ—¶é—´æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">cat /etc/dumpdates<br></code></pre></td></tr></table></figure><p><strong>dumpå¤‡ä»½æ–‡ä»¶æˆ–è€…ç›®å½•å‰é¢æˆ‘ä»¬åœ¨å¤‡ä»½åˆ†åŒºæ—¶ï¼Œæ˜¯å¯ä»¥æ”¯æŒå¢é‡å¤‡ä»½çš„ï¼Œå¦‚æœå¤‡ä»½æ–‡ä»¶æˆ–è€…ç›®å½•ï¼Œä¸å†æ”¯æŒå¢é‡å¤‡ä»½,å³åªèƒ½ä½¿ç”¨0çº§åˆ«å¤‡ä»½æ¡ˆä¾‹</strong>,ä¹Ÿä¸æ”¯æŒ-ué€‰é¡¹ã€‚</p><p>ä½¿ç”¨dumpå¤‡ä»½/etcæ•´ä¸ªç›®å½•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">dump -0j -f /opt/etc.bak.bz2 /etc/#ä¸‹é¢è¿™æ¡è¯­å¥ä¼šæŠ¥é”™ï¼Œæç¤ºDUMP:Only level 0 dumps are allowed on a subdirectory dump -1j -f /opt/etc.bak.bz2 /etc/<br></code></pre></td></tr></table></figure><h3 id="24-3-ä½¿ç”¨restoreå®Œæˆæ¢å¤"><a href="#24-3-ä½¿ç”¨restoreå®Œæˆæ¢å¤" class="headerlink" title="24.3 ä½¿ç”¨restoreå®Œæˆæ¢å¤"></a>24.3 ä½¿ç”¨restoreå®Œæˆæ¢å¤</h3><p>åŸºæœ¬ä»‹ç»</p><p>restoreå‘½ä»¤ç”¨æ¥æ¢å¤å·²å¤‡ä»½çš„æ–‡ä»¶ï¼Œå¯ä»¥ä»dumpç”Ÿæˆçš„å¤‡ä»½æ–‡ä»¶ä¸­æ¢å¤åŸæ–‡ä»¶ï¼Œä¸€èˆ¬æ˜¯æ¢å¤åˆ°å½“å‰ç›®å½•</p><p>åŸºæœ¬è¯­æ³•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">restore [æ¨¡å¼é€‰é¡¹] [é€‰é¡¹]<br></code></pre></td></tr></table></figure><p>è¯´æ˜ä¸‹é¢å››ä¸ªæ¨¡å¼ï¼Œä¸èƒ½æ··ç”¨ï¼Œå†ä¸€æ¬¡å‘½ä»¤ä¸­ï¼Œåªèƒ½æŒ‡å®šä¸€ç§ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">-C: ä½¿ç”¨å¯¹æ¯”æ¨¡å¼ï¼Œå°†å¤‡ä»½çš„æ–‡ä»¶ä¸å·²å­˜åœ¨çš„æ–‡ä»¶ç›¸äº’å¯¹æ¯”ã€‚<br>-i: ä½¿ç”¨äº¤äº’æ¨¡å¼ï¼Œåœ¨è¿›è¡Œè¿˜åŸæ“ä½œæ—¶ï¼ŒrestoreæŒ‡ä»¤å°†ä¾åºè¯¢é—®ç”¨æˆ·<br>-r: è¿›è¡Œè¿˜åŸæ¨¡å¼<br>-t: æŸ¥çœ‹æ¨¡å¼ï¼Œçœ‹å¤‡ä»½æ–‡ä»¶æœ‰å“ªäº›æ–‡ä»¶<br></code></pre></td></tr></table></figure><p>é€‰é¡¹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">-f &lt;å¤‡ä»½è®¾å¤‡&gt;: ä»æŒ‡å®šçš„æ–‡ä»¶ä¸­è¯»å–å¤‡ä»½æ•°æ®ï¼Œè¿›è¡Œè¿˜åŸæ“ä½œ<br></code></pre></td></tr></table></figure><p>åº”ç”¨æ¡ˆä¾‹</p><p>æ¡ˆä¾‹1ï¼šrestoreå‘½ä»¤æ¯”è¾ƒæ¨¡å¼ï¼Œæ¯”è¾ƒå¤‡ä»½æ–‡ä»¶å’ŒåŸæ–‡ä»¶çš„åŒºåˆ«</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">mv /boot/hello.java /boot/hello100.java<br>restore -C -f boot.bak1.bz2 #æ³¨æ„å’Œæœ€æ–°çš„æ–‡ä»¶æ¯”è¾ƒ<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20220228164134772.png"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">mv /boot/hello100.java /boot/hello.java<br>restore -C -f boot.bak1.bz2<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20220228164214084.png"></p><p>æ¡ˆä¾‹2ï¼šrestoreå‘½ä»¤æŸ¥çœ‹æ¨¡å¼ï¼Œçœ‹å¤‡ä»½æ–‡ä»¶æœ‰å“ªäº›æ•°æ®/æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">restore -t -f boot.bak0.bz2<br></code></pre></td></tr></table></figure><p>æ¡ˆä¾‹3ï¼šrestoreå‘½ä»¤è¿˜åŸæ¨¡å¼,æ³¨æ„ç»†èŠ‚ï¼šå¦‚æœä½ æœ‰å¢é‡å¤‡ä»½ï¼Œéœ€è¦æŠŠå¢é‡å¤‡ä»½æ–‡ä»¶ä¹Ÿè¿›è¡Œæ¢å¤ï¼Œæœ‰å‡ ä¸ªå¢é‡å¤‡ä»½æ–‡ä»¶ï¼Œå°±è¦æ¢å¤å‡ ä¸ªï¼ŒæŒ‰é¡ºåºæ¥æ¢å¤å³å¯ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">restore -r -f /opt/boot.bak0.bz2 #æ¢å¤åˆ°ç¬¬ä¸€æ¬¡å®Œå…¨å¤‡ä»½çŠ¶æ€<br>restore -r -f /opt/boot.bak1.bz2 #æ¢å¤åˆ°ç¬¬äºŒæ¬¡å®Œå…¨å¤‡ä»½çŠ¶æ€<br></code></pre></td></tr></table></figure><p>æ¡ˆä¾‹4ï¼šrestoreå‘½ä»¤æ¢å¤å¤‡ä»½çš„æ–‡ä»¶ï¼Œæˆ–è€…æ•´ä¸ªç›®å½•çš„æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">restore -r -f å¤‡ä»½å¥½çš„æ–‡ä»¶<br></code></pre></td></tr></table></figure><h2 id="äºŒåäº”ã€Linuxå¯è§†åŒ–ç®¡ç†"><a href="#äºŒåäº”ã€Linuxå¯è§†åŒ–ç®¡ç†" class="headerlink" title="äºŒåäº”ã€Linuxå¯è§†åŒ–ç®¡ç†"></a>äºŒåäº”ã€Linuxå¯è§†åŒ–ç®¡ç†</h2><h3 id="25-1-webmin"><a href="#25-1-webmin" class="headerlink" title="25.1 webmin"></a>25.1 webmin</h3><h4 id="25-1-1-åŸºæœ¬ä»‹ç»"><a href="#25-1-1-åŸºæœ¬ä»‹ç»" class="headerlink" title="25.1.1 åŸºæœ¬ä»‹ç»"></a>25.1.1 åŸºæœ¬ä»‹ç»</h4><p>Webminæ˜¯åŠŸèƒ½å¼ºå¤§çš„åŸºäºWebçš„Unix/linuxç³»ç»Ÿç®¡ç†å·¥å…·ã€‚ç®¡ç†å‘˜é€šè¿‡æµè§ˆå™¨è®¿é—®Webminçš„å„ç§ç®¡ç†åŠŸèƒ½å¹¶å®Œæˆç›¸åº”çš„ç®¡ç†æ“ä½œã€‚é™¤äº†å„ç‰ˆæœ¬çš„linuxä»¥å¤–è¿˜å¯ç”¨äºï¼šAIXã€HPUXã€Solarisã€Unixwareã€Irixå’ŒFreeBSDç­‰ç³»ç»Ÿ</p><h4 id="25-1-2-å®‰è£…webmin-amp-é…ç½®"><a href="#25-1-2-å®‰è£…webmin-amp-é…ç½®" class="headerlink" title="25.1.2 å®‰è£…webmin&amp;é…ç½®"></a>25.1.2 å®‰è£…webmin&amp;é…ç½®</h4><p>1)ä¸‹è½½åœ°å€:<a href="http://download.webmin.com/download/yum/,%E7%94%A8%E4%B8%8B%E8%BD%BD%E5%B7%A5%E5%85%B7%E4%B8%8B%E8%BD%BD%E5%8D%B3%E5%8F%AF">http://download.webmin.com/download/yum/,ç”¨ä¸‹è½½å·¥å…·ä¸‹è½½å³å¯</a></p><p>æˆ–è€…<code>wgethttp://download.webmin.com/download/yum/webmin-1.700-1.noarch.rpm</code></p><p>2)å®‰è£…ï¼š<code>rpm -ivh webmin-1.700-1.noarch.rpm</code></p><p>3)é‡ç½®å¯†ç :<code>/usr/libexec/webmin/changepass.pl /etc/webminroot test root</code>æ˜¯webminçš„ç”¨æˆ·åï¼Œä¸æ˜¯OSçš„,è¿™é‡Œå°±æ˜¯æŠŠwebminçš„rootç”¨æˆ·å¯†ç æ”¹æˆäº†test</p><p>4)ä¿®æ”¹webminæœåŠ¡çš„ç«¯å£å·ï¼ˆé»˜è®¤æ˜¯10000å‡ºäºå®‰å…¨ç›®çš„ï¼‰</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">vim /etc/webmin/miniserv.conf#ä¿®æ”¹ç«¯å£<br><br>å°†port=10000ä¿®æ”¹ä¸ºå…¶ä»–ç«¯å£å·ï¼Œå¦‚port=6666<br>å°†listen=10000ä¿®æ”¹ä¸ºlisten=6666<br></code></pre></td></tr></table></figure><p>5)é‡å¯webmin</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">/etc/webmin/restart#</span><span class="bash">é‡å¯</span><br><span class="hljs-meta">/etc/webmin/start#</span><span class="bash">å¯åŠ¨</span><br><span class="hljs-meta">/etc/webmin/stop#</span><span class="bash">åœæ­¢</span><br></code></pre></td></tr></table></figure><p>6)é˜²ç«å¢™æ”¾å¼€6666ç«¯å£</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">firewall -cmd--zone=public --add-port=6666/tcp --permanent#é…ç½®é˜²ç«å¢™å¼€æ”¾6666ç«¯å£<br>firewall -cmd--reload#æ›´æ–°é˜²ç«å¢™é…ç½®<br>firewall -cmd--zone=public --list-ports#æŸ¥çœ‹å·²ç»å¼€æ”¾çš„ç«¯å£å·<br></code></pre></td></tr></table></figure><p>7)ç™»å½•webmin</p><p><a href="http://ip:6666å¯ä»¥è®¿é—®äº†">http://ip:6666å¯ä»¥è®¿é—®äº†</a></p><p>ç”¨rootè´¦å·å’Œé‡ç½®çš„æ–°å¯†ç test</p><h3 id="25-2-bt-å®å¡”"><a href="#25-2-bt-å®å¡”" class="headerlink" title="25.2 bt(å®å¡”)"></a>25.2 bt(å®å¡”)</h3><h4 id="25-2-1åŸºæœ¬ä»‹ç»"><a href="#25-2-1åŸºæœ¬ä»‹ç»" class="headerlink" title="25.2.1åŸºæœ¬ä»‹ç»"></a>25.2.1åŸºæœ¬ä»‹ç»</h4><p>btå®å¡”Linuxé¢æ¿æ˜¯æå‡è¿ç»´æ•ˆç‡çš„æœåŠ¡å™¨ç®¡ç†è½¯ä»¶ï¼Œæ”¯æŒä¸€é”®LAMP/LNMP/é›†ç¾¤/ç›‘æ§/ç½‘ç«™/FTP/æ•°æ®åº“/JAVAç­‰å¤šé¡¹æœåŠ¡å™¨ç®¡ç†åŠŸèƒ½ã€‚</p><h4 id="25-2-2-å®‰è£…ä½¿ç”¨"><a href="#25-2-2-å®‰è£…ä½¿ç”¨" class="headerlink" title="25.2.2 å®‰è£…ä½¿ç”¨"></a>25.2.2 å®‰è£…ä½¿ç”¨</h4><p>1)å®‰è£…</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">yum install -y wget &amp;&amp; wget -O install.sh http://download.bt.cn/install/install_6.0.sh &amp;&amp; sh install.sh<br></code></pre></td></tr></table></figure><p>&amp;&amp;ä»£è¡¨å…ˆæ‰§è¡Œå‰é¢çš„å‘½ä»¤ï¼Œåœ¨æ‰§è¡Œåé¢çš„å‘½ä»¤ã€‚</p><p>2)å®‰è£…æˆåŠŸåæ§åˆ¶å°ä¼šæ˜¾ç¤ºç™»å½•åœ°å€ï¼Œè´¦æˆ·å¯†ç ï¼Œå¤åˆ¶æµè§ˆå™¨æ‰“å¼€ç™»å½•ï¼Œ</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20220228180112466.png"></p><h4 id="25-2-3-å¦‚æœbtçš„ç”¨æˆ·åï¼Œå¯†ç å¿˜è®°äº†ï¼Œä½¿ç”¨btdefaultå¯ä»¥æŸ¥çœ‹"><a href="#25-2-3-å¦‚æœbtçš„ç”¨æˆ·åï¼Œå¯†ç å¿˜è®°äº†ï¼Œä½¿ç”¨btdefaultå¯ä»¥æŸ¥çœ‹" class="headerlink" title="25.2.3 å¦‚æœbtçš„ç”¨æˆ·åï¼Œå¯†ç å¿˜è®°äº†ï¼Œä½¿ç”¨btdefaultå¯ä»¥æŸ¥çœ‹"></a>25.2.3 å¦‚æœbtçš„ç”¨æˆ·åï¼Œå¯†ç å¿˜è®°äº†ï¼Œä½¿ç”¨btdefaultå¯ä»¥æŸ¥çœ‹</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">by default<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20220228180222987.png"></p><h2 id="äºŒåå…­ã€Linuxåº”ç”¨å®ä¾‹"><a href="#äºŒåå…­ã€Linuxåº”ç”¨å®ä¾‹" class="headerlink" title="äºŒåå…­ã€Linuxåº”ç”¨å®ä¾‹"></a>äºŒåå…­ã€Linuxåº”ç”¨å®ä¾‹</h2><p>æ¡ˆä¾‹1ï¼šåˆ†ææ—¥å¿—t.log(è®¿é—®é‡)ï¼Œå°†å„ä¸ªipåœ°å€æˆªå–ï¼Œå¹¶ç»Ÿè®¡å‡ºç°æ¬¡æ•°,å¹¶æŒ‰ä»å¤§åˆ°å°æ’åº</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell">t.txt<br>http://192.168.200.10/index1.html<br>http://192.168.200.10/index2.html<br>http://192.168.200.20/index1.html<br>http://192.168.200.30/index1.html<br>http://192.168.200.40/index1.html<br>http://192.168.200.30/order.html<br>http://192.168.200.10/order.html<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">cat t.txt | cut -d &#x27;/&#x27; -f 3 | sort | uniq -c | sort -nr<br></code></pre></td></tr></table></figure><p><strong>cutæ˜¯splitå‘½ä»¤ï¼Œ-dæ˜¯æŒ‡å®šåˆ†å‰²ç¬¦å·(ä¸å¯ä»¥æ˜¯ç©ºæ ¼ï¼‰ï¼Œ-fæ˜¯å–å‡ºç¬¬å‡ åˆ—</strong>,<strong>uniq -c ç»Ÿè®¡å‘½ä»¤æ˜¯ç»Ÿè®¡ç›¸é‚»è¡Œç›¸åŒçš„æ•°é‡</strong></p><p>æ¡ˆä¾‹2ï¼šç»Ÿè®¡è¿æ¥åˆ°æœåŠ¡å™¨çš„å„ä¸ªipæƒ…å†µï¼Œå¹¶æŒ‰è¿æ¥æ•°ä»å¤§åˆ°å°æ’åº</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">netstat -an | grep ESTABLISHED | awk -F &quot; &quot; &#x27;&#123;print $5&#125;&#x27; | awk -F &quot;:&quot; &#x27;&#123;print $1&#125;&#x27; | sort | uniq -c | sort -nr<br></code></pre></td></tr></table></figure><p>æ¡ˆä¾‹3ï¼šå¦‚å¿˜è®°äº†mysql5.7æ•°æ®åº“çš„ROOTç”¨æˆ·çš„å¯†ç ï¼Œå¦‚ä½•æ‰¾å›?</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell">vim /etc/my.cnf<br><br>skip-grant-tables #åŠ ä¸Šä¸€è¡Œï¼Œè·³è¿‡å¯†ç <br><br>service mysqld.service #é‡å¯mysqldæœåŠ¡<br>mysql -u root -p #ç™»å½•<br>show databases;<br>use mysql;<br>show tables;<br>desc users;<br>update user set authentication_string=password(&quot;xinmima&quot;) where user=&#x27;root&#x27;;<br>flush privileges;<br></code></pre></td></tr></table></figure><p>æ¡ˆä¾‹4ï¼šç»Ÿè®¡ipè®¿é—®æƒ…å†µï¼Œè¦æ±‚åˆ†ænginxè®¿é—®æ—¥å¿—(access.log)ï¼Œæ‰¾å‡ºè®¿é—®é¡µé¢æ•°é‡åœ¨å‰2ä½çš„ip</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">cat access.log | awk -F &quot; &quot; &#x27;&#123;print $1&#125;&#x27; | sort | uniq -c | sort -nr | head -2<br></code></pre></td></tr></table></figure><p>æ¡ˆä¾‹5ï¼šä½¿ç”¨tcpdumpç›‘å¬æœ¬æœº,å°†æ¥è‡ªip192.168.200.1ï¼Œtcpç«¯å£ä¸º22çš„æ•°æ®ï¼Œä¿å­˜è¾“å‡ºåˆ°tcpdump.log,ç”¨åšå°†æ¥æ•°æ®åˆ†æ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">tcpdump -i ens33 host 192.168.200.1 and port 22 &gt;&gt; /opt/tcpdump.log<br></code></pre></td></tr></table></figure><p>ç›‘å¬ç½‘ç»œè®¾å¤‡ens33</p><p>æ¡ˆä¾‹6ï¼šå¸¸ç”¨çš„Nginxæ¨¡å—ï¼Œç”¨æ¥åšä»€ä¹ˆ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">rewriteæ¨¡å—ï¼Œå®ç°é‡å†™åŠŸèƒ½<br>accessæ¨¡å—ï¼šæ¥æºæ§åˆ¶<br>sslæ¨¡å—ï¼šå®‰å…¨åŠ å¯†<br>ngx_http_gzip_moduleï¼šç½‘ç»œä¼ è¾“å‹ç¼©æ¨¡å—<br>ngx_http_proxy_module:æ¨¡å—å®ç°ä»£ç†<br>ngx_http_upstream_module:æ¨¡å—å®ç°å®šä¹‰åç«¯æœåŠ¡å™¨åˆ—è¡¨<br>ngx_cache_purge:å®ç°ç¼“å­˜æ¸…é™¤åŠŸèƒ½<br></code></pre></td></tr></table></figure><p>æ¡ˆä¾‹7ï¼šå¦‚æœä½ æ˜¯ç³»ç»Ÿç®¡ç†å‘˜ï¼Œåœ¨è¿›è¡ŒLinuxç³»ç»Ÿæƒé™åˆ’åˆ†æ—¶,åº”è€ƒè™‘å“ªäº›å› ç´ ?</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/image-20220228193525894.png"></p><ol><li><p>æ³¨æ„æƒé™åˆ†ç¦»ï¼Œæ¯”å¦‚:å·¥ä½œä¸­ï¼ŒLinuxç³»ç»Ÿæƒé™å’Œæ•°æ®åº“æƒé™ä¸è¦åœ¨åŒä¸€ä¸ªéƒ¨é—¨</p></li><li><p>æƒé™æœ€å°åŸåˆ™(å³:åœ¨æ»¡è¶³ä½¿ç”¨çš„æƒ…å†µä¸‹æœ€å°‘ä¼˜å…ˆ)</p></li><li><p>å‡å°‘ä½¿ç”¨rootç”¨æˆ·ï¼Œå°½é‡ç”¨æ™®é€šç”¨æˆ·+sudoææƒè¿›è¡Œæ—¥å¸¸æ“ä½œã€‚</p></li><li><p>é‡è¦çš„ç³»ç»Ÿæ–‡ä»¶ï¼Œæ¯”å¦‚/etc/passwd,/etc/shadowetc/fstabï¼Œ/etc/sudoersç­‰,æ—¥å¸¸å»ºè®®ä½¿ç”¨chattr(change attribute)é”å®š,éœ€è¦æ“ä½œæ—¶å†æ‰“å¼€ã€‚ã€æ¼”ç¤ºæ¯”å¦‚:é”å®š/etc/passwdè®©ä»»ä½•ç”¨æˆ·éƒ½ä¸èƒ½éšæ„useradd,é™¤éè§£é™¤é”å®šã€‘</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">chattr +i /etc/passwd #é”å®šæ–‡ä»¶<br></code></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨SUID,SGID,Stickyè®¾ç½®ç‰¹æ®Šæƒé™ã€‚</p></li><li><p>å¯ä»¥åˆ©ç”¨å·¥å…·ï¼Œæ¯”å¦‚chkrootkitæˆ–è€…rootkit hunteræ£€æµ‹rootkitè„šæœ¬ï¼ˆrootkitæ˜¯å…¥ä¾µè€…ä½¿ç”¨å·¥å…·,åœ¨ä¸å¯Ÿè§‰çš„å»ºç«‹äº†å…¥ä¾µç³»ç»Ÿé€”å¾„ï¼‰[æ¼”ç¤ºä½¿ç”¨wget <a href="ftp://ftp.pangeia.com.br/pub/seg/pac/chkrootkit.tar.gz]">ftp://ftp.pangeia.com.br/pub/seg/pac/chkrootkit.tar.gz]</a></p></li><li><p>åˆ©ç”¨å·¥å…·Tripwireæ£€æµ‹æ–‡ä»¶ç³»ç»Ÿå®Œæ•´æ€§</p></li></ol><p>æ¡ˆä¾‹8ï¼šæƒé™æ“ä½œæ€è€ƒé¢˜</p><p>ï¼ˆ1ï¼‰ç”¨æˆ·tomå¯¹ç›®å½•/home/testæœ‰æ‰§è¡Œxå’Œè¯»rå†™wæƒé™ï¼Œ/home/test/hello.javaæ˜¯åªè¯»æ–‡ä»¶ï¼Œé—®tomå¯¹hello.javaæ–‡ä»¶èƒ½è¯»å—(ok)?èƒ½ä¿®æ”¹å—(no)ï¼Ÿèƒ½åˆ é™¤å—?(ok)</p><p>ï¼ˆ2ï¼‰ç”¨æˆ·tomå¯¹ç›®å½•/home/teståªæœ‰è¯»å†™æƒé™ï¼Œ/home/test/hello.javaæ˜¯åªè¯»æ–‡ä»¶ï¼Œé—®tomå¯¹hello.javaæ–‡ä»¶èƒ½è¯»å—(no)?èƒ½ä¿®æ”¹å—(no)ï¼Ÿèƒ½åˆ é™¤å—(no)?</p><p>ï¼ˆ3ï¼‰ç”¨æˆ·tomå¯¹ç›®å½•/home/teståªæœ‰æ‰§è¡Œæƒé™xï¼Œ/home/test/hello.javaæ˜¯åªè¯»æ–‡ä»¶ï¼Œé—®tomå¯¹hello.javaæ–‡ä»¶èƒ½è¯»å—(ok)?èƒ½ä¿®æ”¹å—(no)ï¼Ÿèƒ½åˆ é™¤å—(no)?</p><p>ï¼ˆ4ï¼‰ç”¨æˆ·tomå¯¹ç›®å½•/home/teståªæœ‰æ‰§è¡Œxå’Œå†™wæƒé™ï¼Œ/home/test/hello.javaæ˜¯åªè¯»æ–‡ä»¶ï¼Œé—®tomå¯¹hello.javaæ–‡ä»¶èƒ½è¯»å—(ok)?èƒ½ä¿®æ”¹å—(no)ï¼Ÿèƒ½åˆ é™¤å—(ok)?</p><p>æ¡ˆä¾‹9ï¼šåˆ—ä¸¾Linuxé«˜çº§å‘½ä»¤ï¼Œè‡³å°‘6ä¸ª</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">netstat #ç½‘ç»œçŠ¶æ€ç›‘æ§<br>top #ç³»ç»Ÿè¿è¡ŒçŠ¶æ€<br>lsblk #æŸ¥çœ‹ç¡¬ç›˜åˆ†åŒº<br>find<br>ps -aux #æŸ¥çœ‹è¿è¡Œè¿›ç¨‹<br>chkconfig #æŸ¥çœ‹æœåŠ¡å¯åŠ¨çŠ¶æ€<br>systemctl #ç®¡ç†ç³»ç»ŸæœåŠ¡å™¨<br></code></pre></td></tr></table></figure><p>æ¡ˆä¾‹10ï¼šLinuxæŸ¥çœ‹å†…å­˜ã€ioè¯»å†™ã€ç£ç›˜å­˜å‚¨ã€ç«¯å£å ç”¨ã€è¿›ç¨‹æŸ¥çœ‹å‘½ä»¤æ˜¯ä»€ä¹ˆ?</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">top,iotop,df -lh,netstat -tunlp,ps -aux | grep å…³å¿ƒçš„è¿›ç¨‹<br></code></pre></td></tr></table></figure><p>æ¡ˆä¾‹11ï¼šä½¿ç”¨Linuxå‘½ä»¤è®¡ç®—t2.txtç¬¬äºŒåˆ—çš„å’Œå¹¶è¾“å‡º</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">cat t2.txt | awk -F &quot; &quot; &#x27;&#123;sum+=$2&#125; END &#123;print sum&#125;&#x27;<br></code></pre></td></tr></table></figure><p>æ¡ˆä¾‹12ï¼šShellè„šæœ¬é‡Œå¦‚ä½•æ£€æŸ¥ä¸€ä¸ªæ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Ÿ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">if [ -f æ–‡ä»¶å ] then echo &quot;å­˜åœ¨&quot; else echo &quot;ä¸å­˜åœ¨&quot; fi<br></code></pre></td></tr></table></figure><p>æ¡ˆä¾‹13ï¼šç”¨shellå†™ä¸€ä¸ªè„šæœ¬ï¼Œå¯¹æ–‡æœ¬t3.txtä¸­æ— åºçš„ä¸€åˆ—æ•°å­—æ’åº,å¹¶å°†æ€»å’Œè¾“å‡º</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sort -nr t3.txt | awk &#x27;&#123;sum+=$0; print $0&#125; END &#123;print &quot;å’Œ=&quot;sum&#125;&#x27;<br></code></pre></td></tr></table></figure><p>æ¡ˆä¾‹14ï¼šè¯·ç”¨æŒ‡ä»¤å†™å‡ºæŸ¥æ‰¾å½“å‰æ–‡ä»¶å¤¹ï¼ˆ/homeï¼‰ä¸‹æ‰€æœ‰çš„æ–‡æœ¬æ–‡ä»¶å†…å®¹ä¸­åŒ…å«æœ‰å­—ç¬¦â€œcatâ€çš„æ–‡ä»¶åç§°</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">grep -r &quot;cat&quot; /home | cut -d &quot;:&quot; -f 1<br></code></pre></td></tr></table></figure><p>æ¡ˆä¾‹15ï¼šè¯·å†™å‡ºç»Ÿè®¡/homeç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶ä¸ªæ•°å’Œæ‰€æœ‰æ–‡ä»¶æ€»è¡Œæ•°çš„æŒ‡ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">find /home -name &quot;*.*&quot; | wc -l<br>find /home -name &quot;*.*&quot; | xargs wc -l<br></code></pre></td></tr></table></figure><p>æ¡ˆä¾‹16ï¼šæ¯å¤©æ™šä¸Š10ç‚¹30åˆ†ï¼Œæ‰“åŒ…ç«™ç‚¹ç›®å½•/var/spool/mailå¤‡ä»½åˆ°/homeç›®å½•ä¸‹ï¼ˆæ¯æ¬¡å¤‡ä»½æŒ‰æ—¶é—´ç”Ÿæˆä¸åŒçš„å¤‡ä»½åŒ…æ¯”å¦‚æŒ‰ç…§å¹´æœˆæ—¥æ—¶åˆ†ç§’ï¼‰</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell">crontab -e<br><br>30 22 * * * test.sh<br><br>vim test.sh<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash">!/bin/bash</span><br>cd /var/spool/ &amp;&amp; /bin/tar zcf /home/mail-`date +%Y-%m-%d_%H%M%S`.tar.gz mail<br><br>chomd 777 test.sh<br></code></pre></td></tr></table></figure><p>æ¡ˆä¾‹17ï¼šå¦‚ä½•ä¼˜åŒ–Linuxç³»ç»Ÿï¼Œè¯´å‡ºä½ çš„æ–¹æ³•</p><p>(1)ä¸ç”¨root,ä½¿ç”¨sudoæç¤ºæƒé™</p><p>(2)å®šæ—¶çš„è‡ªåŠ¨æ›´æ–°æœåŠ¡æ—¶é—´,ä½¿ç”¨nptdate npt1.aliyun.com,è®©croudå®šæ—¶æ›´æ–°</p><p>(3)é…ç½®yumæºï¼ŒæŒ‡å‘å›½å†…é•œåƒ(æ¸…åï¼Œ163)</p><p>(4)é…ç½®åˆç†çš„é˜²ç«å¢™ç­–ç•¥,æ‰“å¼€å¿…è¦çš„ç«¯å£ï¼Œå…³é—­ä¸å¿…è¦çš„ç«¯å£</p><p>(5)æ‰“å¼€æœ€å¤§æ–‡ä»¶æ•°(è°ƒæ•´æ–‡ä»¶çš„æè¿°çš„æ•°é‡)vim /etc/profile ulimit -SHn 65535</p><p>(6)é…ç½®åˆç†çš„ç›‘æ§ç­–ç•¥</p><p>(7)é…ç½®åˆç†çš„ç³»ç»Ÿé‡è¦æ–‡ä»¶çš„å¤‡ä»½ç­–ç•¥</p><p>(8)å¯¹å®‰è£…çš„è½¯ä»¶è¿›è¡Œä¼˜åŒ–ï¼Œæ¯”å¦‚nginx,apache</p><p>(9)å†…æ ¸å‚æ•°è¿›è¡Œä¼˜åŒ–/etc/sysctl.conf</p><p>(10)é”å®šä¸€äº›é‡è¦çš„ç³»ç»Ÿæ–‡ä»¶chattr/etc/passwd /ect/shadow /etc/inittab</p><p>(11)ç¦ç”¨ä¸å¿…è¦çš„æœåŠ¡setup,ntsysv</p>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Git å­¦ä¹ ç¬”è®°</title>
    <link href="/2022/01/25/Git-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    <url>/2022/01/25/Git-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<h1 id="Gitå­¦ä¹ "><a href="#Gitå­¦ä¹ " class="headerlink" title="Gitå­¦ä¹ "></a>Gitå­¦ä¹ </h1><h2 id="ä¸€ã€GitåŸºç¡€å­¦ä¹ "><a href="#ä¸€ã€GitåŸºç¡€å­¦ä¹ " class="headerlink" title="ä¸€ã€GitåŸºç¡€å­¦ä¹ "></a>ä¸€ã€GitåŸºç¡€å­¦ä¹ </h2><h3 id="1-Gitå¸¸ç”¨å‘½ä»¤"><a href="#1-Gitå¸¸ç”¨å‘½ä»¤" class="headerlink" title="1. Gitå¸¸ç”¨å‘½ä»¤"></a>1. Gitå¸¸ç”¨å‘½ä»¤</h3><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/9a628594255e4d238d24b4a1276dbbf8tplv-k3u1fbpfcp-watermark.awebp"></p><table><thead><tr><th align="left">å‘½ä»¤</th><th align="left">è¯´æ˜</th></tr></thead><tbody><tr><td align="left"><strong>å®‰è£…ä¸é…ç½®</strong></td><td align="left"></td></tr><tr><td align="left">sudo apt-get install git</td><td align="left">Ubuntu ä¸Šå®‰è£… Git å‘½ä»¤</td></tr><tr><td align="left">git config --global user.name ç”¨æˆ·å</td><td align="left">è®¾ç½®ç”¨æˆ·ç­¾å<br>ï¼ˆå®‰è£… Git ååŠ¡å¿…è®¾ç½®ï¼‰</td></tr><tr><td align="left">git config --global user.email email åœ°å€</td><td align="left">è®¾ç½®ç”¨æˆ· email åœ°å€<br>ï¼ˆå®‰è£… Git ååŠ¡å¿…è®¾ç½®ï¼‰</td></tr><tr><td align="left"><strong>è·å–ä¸åˆ›å»ºé¡¹ç›®</strong></td><td align="left"></td></tr><tr><td align="left">git init</td><td align="left">åˆå§‹åŒ–æœ¬åœ°åº“</td></tr><tr><td align="left">git clone è¿œç¨‹åº“åœ°å€</td><td align="left">ä»è¿œç¨‹åº“å…‹éš†åˆ°æœ¬åœ°</td></tr><tr><td align="left"><strong>åŸºæœ¬å¿«ç…§</strong></td><td align="left"></td></tr><tr><td align="left">git status</td><td align="left">æŸ¥çœ‹æœ¬åœ°åº“çŠ¶æ€</td></tr><tr><td align="left">git add æ–‡ä»¶å</td><td align="left">æ·»åŠ å˜åŠ¨æ–‡ä»¶åˆ°æš‚å­˜åŒº</td></tr><tr><td align="left">git add .</td><td align="left">æ·»åŠ å½“å‰ç›®å½•ä¸‹æ‰€æœ‰å˜åŠ¨æ–‡ä»¶åˆ°æš‚å­˜åŒº</td></tr><tr><td align="left">git restore --staged æ–‡ä»¶å</td><td align="left">å¤ä½åœ¨æš‚å­˜åŒºçš„æ–‡ä»¶ï¼ˆadd åæ‚”è¯ï¼‰</td></tr><tr><td align="left">git rm --cached æ–‡ä»¶å</td><td align="left">ç§»é™¤åœ¨æš‚å­˜åŒºçš„æ–‡ä»¶ï¼ˆadd åæ‚”è¯ï¼‰ï¼ˆåŒä¸Šä¸€æ¡ï¼‰</td></tr><tr><td align="left">git commit -m â€œå¤‡æ³¨æ–‡æœ¬â€ æ–‡ä»¶å</td><td align="left">æäº¤æš‚å­˜åŒºæ–‡ä»¶åˆ°æœ¬åœ°åº“<br>ï¼ˆæ–‡ä»¶åç¼ºçœæ—¶ï¼Œå°†æš‚å­˜åŒºæ‰€æœ‰æ–‡ä»¶æäº¤ï¼‰</td></tr><tr><td align="left">git commit --amend</td><td align="left">ä¿®æ”¹ä¸Šæ¬¡æäº¤çš„å¤‡æ³¨æ–‡æœ¬</td></tr><tr><td align="left">git revert ç‰ˆæœ¬å· (7 ä½)</td><td align="left">æ’¤é”€æŒ‡å®šçš„æäº¤ï¼ˆcommit åæ‚”è¯ï¼‰(æ…ç”¨)</td></tr><tr><td align="left">git reset --hard ç‰ˆæœ¬å· (7 ä½)</td><td align="left">ç‰ˆæœ¬é—´ç©¿æ¢­ï¼ˆé…åˆ git reflog ä½¿ç”¨ï¼‰</td></tr><tr><td align="left">git reset --hard HEAD^</td><td align="left">ç©¿æ¢­åˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬</td></tr><tr><td align="left"><strong>åˆ†æ”¯ä¸åˆå¹¶</strong></td><td align="left"></td></tr><tr><td align="left">git branch</td><td align="left">åˆ—å‡ºæ‰€æœ‰åˆ†æ”¯</td></tr><tr><td align="left">git branch åˆ†æ”¯å</td><td align="left">åˆ›å»ºåˆ†æ”¯</td></tr><tr><td align="left">git checkout åˆ†æ”¯å</td><td align="left">åˆ‡æ¢åˆ†æ”¯</td></tr><tr><td align="left">git merge åˆ†æ”¯å B</td><td align="left">åˆ†æ”¯ B åˆå¹¶åˆ° A<br>ï¼ˆA ä¸ºå½“å‰å·¥ä½œç›®å½•æ‰€å¤„åˆ†æ”¯ï¼‰</td></tr><tr><td align="left">git branch -d åˆ†æ”¯å</td><td align="left">åˆ é™¤åˆ†æ”¯</td></tr><tr><td align="left">git tag</td><td align="left">åˆ—å‡ºæ‰€æœ‰æœ¬åœ°æ ‡ç­¾</td></tr><tr><td align="left">git tag -l é€šé…æ¨¡å¼æ–‡æœ¬ (*)</td><td align="left">æ ¹æ®ç¬¦åˆé€šé…æ¨¡å¼æ–‡æœ¬ï¼Œåˆ—å‡ºæ‰€æœ‰æœ¬åœ°æ ‡ç­¾</td></tr><tr><td align="left">git tag æ ‡ç­¾å</td><td align="left">ä¸ºæœ€æ–°æäº¤åˆ›å»º<strong>è½»é‡</strong>æ ‡ç­¾</td></tr><tr><td align="left">git tag æ ‡ç­¾å ç‰ˆæœ¬å· (7 ä½)</td><td align="left">ä¸ºå¯¹åº”ç‰ˆæœ¬å·æäº¤åˆ›å»º<strong>è½»é‡</strong>æ ‡ç­¾ï¼ˆåœ¨åæœŸæ‰“æ ‡ç­¾ï¼‰</td></tr><tr><td align="left">git tag -a æ ‡ç­¾å -m å¤‡æ³¨æ–‡æœ¬</td><td align="left">ä¸ºæœ€æ–°æäº¤åˆ›å»º<strong>é™„æ³¨</strong>æ ‡ç­¾</td></tr><tr><td align="left">git tag -d æ ‡ç­¾å</td><td align="left">åˆ é™¤æŒ‡å®šæ ‡ç­¾</td></tr><tr><td align="left"><strong>å…±äº«ä¸æ›´æ–°é¡¹ç›®</strong></td><td align="left"></td></tr><tr><td align="left">git remote add åˆ«å è¿œç¨‹ä»“åº“åœ°å€</td><td align="left">æ·»åŠ è¿œç¨‹åº“</td></tr><tr><td align="left">git remote -v</td><td align="left">æŸ¥çœ‹æ·»åŠ è¿‡çš„è¿œç¨‹åº“</td></tr><tr><td align="left">git push è¿œç¨‹åº“åœ°å€æˆ–å…¶åˆ«å åˆ†æ”¯å</td><td align="left">æ¨é€åˆ°è¿œç¨‹åº“</td></tr><tr><td align="left">git push è¿œç¨‹åº“åœ°å€æˆ–å…¶åˆ«å --tags</td><td align="left">æ¨é€æ‰€æœ‰æ ‡ç­¾åˆ°è¿œç¨‹åº“</td></tr><tr><td align="left">git fetch</td><td align="left">å°†è¿œç¨‹åº“çš„æœ€æ–°å†…å®¹æ‹‰åˆ°æœ¬åœ°</td></tr><tr><td align="left">git pull è¿œç¨‹åº“åœ°å€æˆ–å…¶åˆ«å åˆ†æ”¯å</td><td align="left">å°†è¿œç¨‹ä»“åº“å¯¹äºåˆ†æ”¯æœ€æ–°å†…å®¹æ‹‰ä¸‹æ¥åä¸å½“å‰æœ¬åœ°åˆ†æ”¯ç›´æ¥åˆå¹¶ï¼Œ<br>ç›¸å½“äº git fetch + git mergeï¼Œè¿™æ ·å¯èƒ½ä¼šäº§ç”Ÿå†²çªï¼Œéœ€è¦æ‰‹åŠ¨è§£å†³</td></tr><tr><td align="left"><strong>æ£€æŸ¥ä¸æ¯”è¾ƒ</strong></td><td align="left"></td></tr><tr><td align="left">git show æ ‡ç­¾å</td><td align="left">æ˜¾ç¤ºæ ‡ç­¾ä¿¡æ¯å’Œä¸ä¹‹å¯¹åº”çš„æäº¤ä¿¡æ¯</td></tr><tr><td align="left">git show ç‰ˆæœ¬å· (7 ä½)</td><td align="left">æ˜¾ç¤ºå¯¹åº”ç‰ˆæœ¬å¯¹åº”çš„æäº¤ä¿¡æ¯</td></tr><tr><td align="left">git log</td><td align="left">æ˜¾ç¤ºå½“å‰åˆ†æ”¯æ‰€æœ‰æäº¤è¿‡çš„ç‰ˆæœ¬ä¿¡æ¯</td></tr><tr><td align="left">git log --follow æ–‡ä»¶å</td><td align="left">æ˜¾ç¤ºå½“å‰åˆ†æ”¯æ‰€æœ‰æäº¤è¿‡çš„å…³äºæŒ‡å®šæ–‡ä»¶ç‰ˆæœ¬ä¿¡æ¯</td></tr><tr><td align="left">git log --pretty=oneline</td><td align="left">æ˜¾ç¤ºå½“å‰åˆ†æ”¯æ‰€æœ‰æäº¤è¿‡çš„ç‰ˆæœ¬ä¿¡æ¯ï¼ˆç²¾ç®€ï¼‰</td></tr><tr><td align="left">git log --graph</td><td align="left">æ˜¾ç¤ºå½“å‰åˆ†æ”¯æ‰€æœ‰æäº¤è¿‡çš„ç‰ˆæœ¬ä¿¡æ¯ï¼ˆé™„æœ‰åˆ†æ”¯åˆå¹¶å›¾ï¼‰</td></tr><tr><td align="left">git diff åˆ†æ”¯ä¸€ åˆ†æ”¯äºŒ</td><td align="left">æ˜¾ç¤ºä¸¤åˆ†æ”¯å·®å¼‚</td></tr><tr><td align="left">git diff ç‰ˆæœ¬å·ä¸€ (7 ä½) ç‰ˆæœ¬å·äºŒ (7 ä½)</td><td align="left">æ˜¾ç¤ºåŒä¸€åˆ†æ”¯ä¸¤ç‰ˆæœ¬å·®å¼‚</td></tr><tr><td align="left"><strong>ç®¡ç†</strong></td><td align="left"></td></tr><tr><td align="left">git reflog</td><td align="left">å¯ä»¥æŸ¥çœ‹æ‰€æœ‰åˆ†æ”¯çš„æ‰€æœ‰æ“ä½œè®°å½•<br>ï¼ˆåŒ…æ‹¬å·²è¢«åˆ é™¤çš„ commit è®°å½•å’Œ reset çš„æ“ä½œï¼Œgit log æ‰€ä¸èƒ½ï¼‰</td></tr></tbody></table><h3 id="2-å®˜ç½‘ä»‹ç»"><a href="#2-å®˜ç½‘ä»‹ç»" class="headerlink" title="2. å®˜ç½‘ä»‹ç»"></a>2. å®˜ç½‘ä»‹ç»</h3><p><a href="https://git-scm.com/">Git å®˜ç½‘</a></p><p><a href="http://git-scm.com/docs">Git å®˜æ–¹æ–‡æ¡£</a></p><p><a href="https://git-scm.com/book/zh/v2">Git å®˜æ–¹ä¹¦</a></p><p><a href="https://git-scm.com/downloads">Git ä¸‹è½½é¡µé¢</a></p><p><a href="https://training.github.com/downloads/zh_CN/github-git-cheat-sheet/">Github Git Cheat Sheets - ä¸­æ–‡ç‰ˆ</a></p><p>Git æ˜¯ä¸€ä¸ªå…è´¹çš„ã€å¼€æºçš„<strong>åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ</strong>ï¼Œå¯ä»¥å¿«é€Ÿé«˜æ•ˆåœ°å¤„ç†ä»å°å‹åˆ°å¤§å‹çš„å„ç§é¡¹ç›®ã€‚</p><p>Git æ˜“äºå­¦ä¹ ï¼Œå åœ°é¢ç§¯å°ï¼Œæ€§èƒ½æå¿«ã€‚ å®ƒå…·æœ‰å»‰ä»·çš„æœ¬åœ°åº“ï¼Œæ–¹ä¾¿çš„æš‚å­˜åŒºåŸŸå’Œå¤šä¸ªå·¥ä½œæµåˆ†æ”¯ç­‰ç‰¹æ€§ã€‚ å…¶æ€§èƒ½ä¼˜äº Subversionã€ CVSã€ Perforce å’Œ ClearCase ç­‰ç‰ˆæœ¬æ§åˆ¶å·¥å…·ã€‚</p><h3 id="3-ç‰ˆæœ¬æ§åˆ¶ä»‹ç»"><a href="#3-ç‰ˆæœ¬æ§åˆ¶ä»‹ç»" class="headerlink" title="3. ç‰ˆæœ¬æ§åˆ¶ä»‹ç»"></a>3. ç‰ˆæœ¬æ§åˆ¶ä»‹ç»</h3><p>ç‰ˆæœ¬æ§åˆ¶æ˜¯ä¸€ç§è®°å½•æ–‡ä»¶å†…å®¹å˜åŒ–ï¼Œä»¥ä¾¿å°†æ¥æŸ¥é˜…ç‰¹å®šç‰ˆæœ¬ä¿®è®¢æƒ…å†µçš„ç³»ç»Ÿã€‚</p><p>ç‰ˆæœ¬æ§åˆ¶å…¶å®æœ€é‡è¦çš„æ˜¯å¯ä»¥è®°å½•æ–‡ä»¶ä¿®æ”¹å†å²è®°å½•ï¼Œä»è€Œè®©ç”¨æˆ·èƒ½å¤ŸæŸ¥çœ‹å†å²ç‰ˆæœ¬ï¼Œæ–¹ä¾¿ç‰ˆæœ¬åˆ‡æ¢ã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/2abc5f18d46afc2d50cee7db484a460f.png"></p><p>ä¸ºä»€ä¹ˆéœ€è¦ç‰ˆæœ¬æ§åˆ¶ï¼Ÿå› ä¸ºè¦ä»ä¸ªäººå¼€å‘è¿‡æ¸¡åˆ°å›¢é˜Ÿåä½œã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/2bcf55bc8f1e6cda16fc048ed30e12fc.png"></p><h3 id="4-åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶-VS-é›†ä¸­å¼ç‰ˆæœ¬æ§åˆ¶"><a href="#4-åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶-VS-é›†ä¸­å¼ç‰ˆæœ¬æ§åˆ¶" class="headerlink" title="4. åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ VS é›†ä¸­å¼ç‰ˆæœ¬æ§åˆ¶"></a>4. åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ VS é›†ä¸­å¼ç‰ˆæœ¬æ§åˆ¶</h3><h4 id="4-1-é›†ä¸­å¼ç‰ˆæœ¬æ§åˆ¶å·¥å…·"><a href="#4-1-é›†ä¸­å¼ç‰ˆæœ¬æ§åˆ¶å·¥å…·" class="headerlink" title="4.1  é›†ä¸­å¼ç‰ˆæœ¬æ§åˆ¶å·¥å…·"></a>4.1  é›†ä¸­å¼ç‰ˆæœ¬æ§åˆ¶å·¥å…·</h4><p>é›†ä¸­åŒ–çš„ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿè¯¸å¦‚ CVSã€ SVN ç­‰ï¼Œéƒ½æœ‰ä¸€ä¸ªå•ä¸€çš„é›†ä¸­ç®¡ç†çš„æœåŠ¡å™¨ï¼Œä¿å­˜æ‰€æœ‰æ–‡ä»¶çš„ä¿®è®¢ç‰ˆæœ¬ï¼Œè€ŒååŒå·¥ä½œçš„äººä»¬éƒ½é€šè¿‡å®¢æˆ·ç«¯è¿åˆ°è¿™å°æœåŠ¡å™¨ï¼Œå–å‡ºæœ€æ–°çš„æ–‡ä»¶æˆ–è€…æäº¤æ›´æ–°ã€‚å¤šå¹´ä»¥æ¥ï¼Œè¿™å·²æˆä¸ºç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿçš„æ ‡å‡†åšæ³•ã€‚</p><p>è¿™ç§åšæ³•å¸¦æ¥äº†è®¸å¤šå¥½å¤„ï¼Œæ¯ä¸ªäººéƒ½å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šçœ‹åˆ°é¡¹ç›®ä¸­çš„å…¶ä»–äººæ­£åœ¨åšäº›ä»€ä¹ˆã€‚è€Œç®¡ç†å‘˜ä¹Ÿå¯ä»¥è½»æ¾æŒæ§æ¯ä¸ªå¼€å‘è€…çš„æƒé™ï¼Œå¹¶ä¸”ç®¡ç†ä¸€ä¸ªé›†ä¸­åŒ–çš„ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œ è¦è¿œæ¯”åœ¨å„ä¸ªå®¢æˆ·ç«¯ä¸Šç»´æŠ¤æœ¬åœ°æ•°æ®åº“æ¥å¾—è½»æ¾å®¹æ˜“ã€‚</p><p>äº‹åˆ†ä¸¤é¢ï¼Œæœ‰å¥½æœ‰åã€‚è¿™ä¹ˆåšæ˜¾è€Œæ˜“è§çš„<strong>ç¼ºç‚¹</strong>æ˜¯ä¸­å¤®æœåŠ¡å™¨çš„å•ç‚¹æ•…éšœã€‚å¦‚æœæœåŠ¡å™¨å®•æœºä¸€å°æ—¶ï¼Œé‚£ä¹ˆåœ¨è¿™ä¸€å°æ—¶å†…ï¼Œè°éƒ½æ— æ³•æäº¤æ›´æ–°ï¼Œä¹Ÿå°±æ— æ³•ååŒå·¥ä½œã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/f0cc7f6f1eb57316f7f8fce8e2f03f45.png"></p><h4 id="4-2-åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶å·¥å…·"><a href="#4-2-åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶å·¥å…·" class="headerlink" title="4.2 åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶å·¥å…·"></a>4.2 åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶å·¥å…·</h4><p>Gitã€ Mercurialã€ Bazaarã€ Darcsâ€¦â€¦</p><p>åƒ Git è¿™ç§åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶å·¥å…·ï¼Œå®¢æˆ·ç«¯æå–çš„ä¸æ˜¯æœ€æ–°ç‰ˆæœ¬çš„æ–‡ä»¶å¿«ç…§ï¼Œè€Œæ˜¯æŠŠä»£ç ä»“åº“å®Œæ•´åœ°é•œåƒä¸‹æ¥ï¼ˆæœ¬åœ°åº“ï¼‰ã€‚è¿™æ ·ä»»ä½•ä¸€å¤„ååŒå·¥ä½œç”¨çš„æ–‡ä»¶å‘ç”Ÿæ•…éšœï¼Œäº‹åéƒ½å¯ä»¥ç”¨å…¶ä»–å®¢æˆ·ç«¯çš„æœ¬åœ°ä»“åº“è¿›è¡Œæ¢å¤ã€‚å› ä¸ºæ¯ä¸ªå®¢æˆ·ç«¯çš„æ¯ä¸€æ¬¡æ–‡ä»¶æå–æ“ä½œï¼Œå®é™…ä¸Šéƒ½æ˜¯ä¸€æ¬¡å¯¹æ•´ä¸ªæ–‡ä»¶ä»“åº“çš„å®Œæ•´å¤‡ä»½ã€‚</p><p>åˆ†å¸ƒå¼çš„ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿå‡ºç°ä¹‹å, è§£å†³äº†é›†ä¸­å¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿçš„ç¼ºé™·ï¼š</p><ol><li> æœåŠ¡å™¨æ–­ç½‘çš„æƒ…å†µä¸‹ä¹Ÿå¯ä»¥è¿›è¡Œå¼€å‘ï¼ˆå› ä¸ºç‰ˆæœ¬æ§åˆ¶æ˜¯åœ¨<strong>æœ¬åœ°</strong>è¿›è¡Œçš„ï¼‰</li><li> æ¯ä¸ªå®¢æˆ·ç«¯ä¿å­˜çš„ä¹Ÿéƒ½æ˜¯æ•´ä¸ª<strong>å®Œæ•´çš„é¡¹ç›®</strong>ï¼ˆåŒ…å«å†å²è®°å½•ï¼Œ æ›´åŠ å®‰å…¨ï¼‰</li></ol><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/340e9b3bc50013b61f0e83e96b99f86a.png"></p><h3 id="5-Gitå‘å±•å†å²"><a href="#5-Gitå‘å±•å†å²" class="headerlink" title="5. Gitå‘å±•å†å²"></a>5. Gitå‘å±•å†å²</h3><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/3f25cba01665ab8dcb63fcc79d05f04f.png"></p><h3 id="6-å·¥ä½œæœºåˆ¶å’Œä»£ç æ‰˜ç®¡ä¸­å¿ƒ"><a href="#6-å·¥ä½œæœºåˆ¶å’Œä»£ç æ‰˜ç®¡ä¸­å¿ƒ" class="headerlink" title="6. å·¥ä½œæœºåˆ¶å’Œä»£ç æ‰˜ç®¡ä¸­å¿ƒ"></a>6. å·¥ä½œæœºåˆ¶å’Œä»£ç æ‰˜ç®¡ä¸­å¿ƒ</h3><h4 id="6-1-Git-å·¥ä½œæœºåˆ¶"><a href="#6-1-Git-å·¥ä½œæœºåˆ¶" class="headerlink" title="6.1 Git å·¥ä½œæœºåˆ¶"></a>6.1 Git å·¥ä½œæœºåˆ¶</h4><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/1706b3553447ac9f8d95377d965d4fd2.png"></p><h4 id="6-2-Git-ä»£ç æ‰˜ç®¡ä¸­å¿ƒ"><a href="#6-2-Git-ä»£ç æ‰˜ç®¡ä¸­å¿ƒ" class="headerlink" title="6.2 Git ä»£ç æ‰˜ç®¡ä¸­å¿ƒ"></a>6.2 Git ä»£ç æ‰˜ç®¡ä¸­å¿ƒ</h4><p>ä»£ç æ‰˜ç®¡ä¸­å¿ƒæ˜¯åŸºäºç½‘ç»œæœåŠ¡å™¨çš„è¿œç¨‹ä»£ç ä»“åº“ï¼Œä¸€èˆ¬æˆ‘ä»¬ç®€å•ç§°ä¸º<strong>è¿œç¨‹åº“</strong>ã€‚</p><ul><li>å±€åŸŸç½‘<ul><li>  GitLab</li></ul></li><li>äº’è”ç½‘<ul><li>  GitHubï¼ˆå¤–ç½‘ï¼‰</li><li>  Gitee ç äº‘ï¼ˆå›½å†…ç½‘ç«™ï¼‰</li></ul></li></ul><h3 id="7-Gitå®‰è£…å’Œå®¢æˆ·ç«¯çš„ä½¿ç”¨"><a href="#7-Gitå®‰è£…å’Œå®¢æˆ·ç«¯çš„ä½¿ç”¨" class="headerlink" title="7. Gitå®‰è£…å’Œå®¢æˆ·ç«¯çš„ä½¿ç”¨"></a>7. Gitå®‰è£…å’Œå®¢æˆ·ç«¯çš„ä½¿ç”¨</h3><p>åœ¨ <a href="https://git-scm.com/downloads">Git ä¸‹è½½é¡µé¢</a>ï¼Œé€‰æ‹©ä¸‹è½½ Windows 64 ä½ç‰ˆçš„ Git å®‰è£…è½¯ä»¶ã€‚</p><p>å®‰è£…æ­¥éª¤æŒ‰ç…§å®‰è£…è½¯ä»¶çš„å®‰è£…å‘å¯¼å®‰è£…å³å¯ï¼Œæ— éœ€è¿‡å¤šé…ç½®ã€‚</p><p>å®‰è£…æˆåŠŸåï¼Œé€šå¸¸åœ¨æ–‡ä»¶æµè§ˆå™¨ç©ºç™½å¤„å•å‡»å‡»é¼ æ ‡å³é”®ï¼Œå¼¹å‡ºèœå•æ æœ‰ Git çš„é€‰é¡¹ã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/72adc78acc2344ab51285dae2c4776ad.png"></p><h2 id="äºŒã€Git-åŸºæœ¬ä½¿ç”¨"><a href="#äºŒã€Git-åŸºæœ¬ä½¿ç”¨" class="headerlink" title="äºŒã€Git åŸºæœ¬ä½¿ç”¨"></a>äºŒã€Git åŸºæœ¬ä½¿ç”¨</h2><table><thead><tr><th>å‘½ä»¤åç§°</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>git config --global user.name ç”¨æˆ·å</td><td>è®¾ç½®ç”¨æˆ·ç­¾å</td></tr><tr><td>git config --global user.email é‚®ç®±</td><td>è®¾ç½®ç”¨æˆ· email åœ°å€</td></tr><tr><td>git init</td><td>åˆå§‹åŒ–æœ¬åœ°åº“</td></tr><tr><td>git status</td><td>æŸ¥çœ‹æœ¬åœ°åº“çŠ¶æ€</td></tr><tr><td>git add æ–‡ä»¶å</td><td>æ·»åŠ åˆ°æš‚å­˜åŒº</td></tr><tr><td>git commit -m â€œæ—¥å¿—ä¿¡æ¯â€ æ–‡ä»¶å</td><td>æäº¤åˆ°æœ¬åœ°åº“</td></tr><tr><td>git reflog</td><td>æŸ¥çœ‹å†å²è®°å½•</td></tr><tr><td>git reset --hard ç‰ˆæœ¬å·</td><td>ç‰ˆæœ¬ç©¿æ¢­</td></tr></tbody></table><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/1352126739_7909.jpg"></p><p>æˆ‘ä»¬å…ˆæ¥ç†è§£ä¸‹ Git å·¥ä½œåŒºã€æš‚å­˜åŒºå’Œç‰ˆæœ¬åº“æ¦‚å¿µï¼š</p><ul><li><strong>å·¥ä½œåŒºï¼š</strong>å°±æ˜¯ä½ åœ¨ç”µè„‘é‡Œèƒ½çœ‹åˆ°çš„ç›®å½•ã€‚</li><li><strong>æš‚å­˜åŒºï¼š</strong>è‹±æ–‡å« stage æˆ– indexã€‚ä¸€èˆ¬å­˜æ”¾åœ¨ <strong>.git</strong> ç›®å½•ä¸‹çš„ index æ–‡ä»¶ï¼ˆ.git/indexï¼‰ä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬æŠŠæš‚å­˜åŒºæœ‰æ—¶ä¹Ÿå«ä½œç´¢å¼•ï¼ˆindexï¼‰ã€‚</li><li><strong>ç‰ˆæœ¬åº“ï¼š</strong>å·¥ä½œåŒºæœ‰ä¸€ä¸ªéšè—ç›®å½• <strong>.git</strong>ï¼Œè¿™ä¸ªä¸ç®—å·¥ä½œåŒºï¼Œè€Œæ˜¯ Git çš„ç‰ˆæœ¬åº“ã€‚</li><li>å›¾ä¸­å·¦ä¾§ä¸ºå·¥ä½œåŒºï¼Œå³ä¾§ä¸ºç‰ˆæœ¬åº“ã€‚åœ¨ç‰ˆæœ¬åº“ä¸­æ ‡è®°ä¸º â€œindexâ€ çš„åŒºåŸŸæ˜¯æš‚å­˜åŒºï¼ˆstage/indexï¼‰ï¼Œæ ‡è®°ä¸º â€œmasterâ€ çš„æ˜¯ master åˆ†æ”¯æ‰€ä»£è¡¨çš„ç›®å½•æ ‘ã€‚</li><li>å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºæ­¤æ—¶ â€œHEADâ€ å®é™…æ˜¯æŒ‡å‘ master åˆ†æ”¯çš„ä¸€ä¸ªâ€æ¸¸æ ‡â€ã€‚æ‰€ä»¥å›¾ç¤ºçš„å‘½ä»¤ä¸­å‡ºç° HEAD çš„åœ°æ–¹å¯ä»¥ç”¨ master æ¥æ›¿æ¢ã€‚</li><li>å›¾ä¸­çš„ objects æ ‡è¯†çš„åŒºåŸŸä¸º Git çš„å¯¹è±¡åº“ï¼Œå®é™…ä½äº â€œ.git/objectsâ€ ç›®å½•ä¸‹ï¼Œé‡Œé¢åŒ…å«äº†åˆ›å»ºçš„å„ç§å¯¹è±¡åŠå†…å®¹ã€‚</li><li>å½“æ‰§è¡Œ <strong>git rm â€“cached &lt;file&gt;</strong> å‘½ä»¤æ—¶ï¼Œä¼šç›´æ¥ä»æš‚å­˜åŒºåˆ é™¤æ–‡ä»¶ï¼Œå·¥ä½œåŒºåˆ™ä¸åšå‡ºæ”¹å˜ã€‚</li><li>å½“å¯¹å·¥ä½œåŒºä¿®æ”¹ï¼ˆæˆ–æ–°å¢ï¼‰çš„æ–‡ä»¶æ‰§è¡Œ <strong>git add</strong> å‘½ä»¤æ—¶ï¼Œæš‚å­˜åŒºçš„ç›®å½•æ ‘è¢«æ›´æ–°ï¼ŒåŒæ—¶å·¥ä½œåŒºä¿®æ”¹ï¼ˆæˆ–æ–°å¢ï¼‰çš„æ–‡ä»¶å†…å®¹è¢«å†™å…¥åˆ°å¯¹è±¡åº“ä¸­çš„ä¸€ä¸ªæ–°çš„å¯¹è±¡ä¸­ï¼Œè€Œè¯¥å¯¹è±¡çš„IDè¢«è®°å½•åœ¨æš‚å­˜åŒºçš„æ–‡ä»¶ç´¢å¼•ä¸­ã€‚</li><li>å½“æ‰§è¡Œæäº¤æ“ä½œï¼ˆ<strong>git commit</strong>ï¼‰æ—¶ï¼Œæš‚å­˜åŒºçš„ç›®å½•æ ‘å†™åˆ°ç‰ˆæœ¬åº“ï¼ˆå¯¹è±¡åº“ï¼‰ä¸­ï¼Œmaster åˆ†æ”¯ä¼šåšç›¸åº”çš„æ›´æ–°ã€‚å³ master æŒ‡å‘çš„ç›®å½•æ ‘å°±æ˜¯æäº¤æ—¶æš‚å­˜åŒºçš„ç›®å½•æ ‘ã€‚</li><li>å½“æ‰§è¡Œ <strong>git reset HEAD</strong> å‘½ä»¤æ—¶ï¼Œæš‚å­˜åŒºçš„ç›®å½•æ ‘ä¼šè¢«é‡å†™ï¼Œè¢« master åˆ†æ”¯æŒ‡å‘çš„ç›®å½•æ ‘æ‰€æ›¿æ¢ï¼Œä½†æ˜¯å·¥ä½œåŒºä¸å—å½±å“ã€‚<strong>ç‰ˆæœ¬åº“ -&gt; æš‚å­˜åŒº</strong></li><li>å½“æ‰§è¡Œ<strong>git reset HEAD â€“hard</strong>ï¼Œæš‚å­˜åŒºå’Œå·¥ä½œåŒºéƒ½ä¼šè¢«ç‰ˆæœ¬åº“é‡å†™ï¼Œç›¸å½“äºHEADæŒ‡é’ˆç§»åŠ¨ã€‚<strong>ç‰ˆæœ¬åº“ -&gt; æš‚å­˜åŒº &amp; å·¥ä½œåŒº</strong></li><li>å½“æ‰§è¡Œ <strong>git checkout .</strong> æˆ–è€… <strong>git checkout â€“ &lt;file&gt;</strong> å‘½ä»¤æ—¶ï¼Œä¼šç”¨æš‚å­˜åŒºå…¨éƒ¨æˆ–æŒ‡å®šçš„æ–‡ä»¶æ›¿æ¢å·¥ä½œåŒºçš„æ–‡ä»¶ã€‚è¿™ä¸ªæ“ä½œå¾ˆå±é™©ï¼Œä¼šæ¸…é™¤å·¥ä½œåŒºä¸­æœªæ·»åŠ åˆ°æš‚å­˜åŒºä¸­çš„æ”¹åŠ¨ã€‚<strong>æš‚å­˜åŒº -&gt; å·¥ä½œåŒº</strong></li><li>å½“æ‰§è¡Œ <strong>git checkout HEAD .</strong> æˆ–è€… <strong>git checkout HEAD &lt;file&gt;</strong> å‘½ä»¤æ—¶ï¼Œä¼šç”¨ HEAD æŒ‡å‘çš„ master åˆ†æ”¯ä¸­çš„å…¨éƒ¨æˆ–è€…éƒ¨åˆ†æ–‡ä»¶æ›¿æ¢æš‚å­˜åŒºå’Œä»¥åŠå·¥ä½œåŒºä¸­çš„æ–‡ä»¶ã€‚è¿™ä¸ªå‘½ä»¤ä¹Ÿæ˜¯æå…·å±é™©æ€§çš„ï¼Œå› ä¸ºä¸ä½†ä¼šæ¸…é™¤å·¥ä½œåŒºä¸­æœªæäº¤çš„æ”¹åŠ¨ï¼Œä¹Ÿä¼šæ¸…é™¤æš‚å­˜åŒºä¸­æœªæäº¤çš„æ”¹åŠ¨ã€‚<strong>ç‰ˆæœ¬åº“ -&gt; æš‚å­˜åŒº &amp; å·¥ä½œåŒº</strong></li></ul><h3 id="1-è®¾ç½®ç”¨æˆ·ç­¾å"><a href="#1-è®¾ç½®ç”¨æˆ·ç­¾å" class="headerlink" title="1. è®¾ç½®ç”¨æˆ·ç­¾å"></a>1. è®¾ç½®ç”¨æˆ·ç­¾å</h3><h4 id="1-1-è®¾ç½®ç³»ç»Ÿçº§ç”¨æˆ·ç­¾å"><a href="#1-1-è®¾ç½®ç³»ç»Ÿçº§ç”¨æˆ·ç­¾å" class="headerlink" title="1.1  è®¾ç½®ç³»ç»Ÿçº§ç”¨æˆ·ç­¾å"></a>1.1  è®¾ç½®ç³»ç»Ÿçº§ç”¨æˆ·ç­¾å</h4><figure class="highlight autoit"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><pre><code class="hljs autoit">git config --<span class="hljs-keyword">global</span> user.name abc <span class="hljs-meta">#ç”¨æˆ·å</span><br>git config --<span class="hljs-keyword">global</span> user.email abc<span class="hljs-symbol">@123</span>.com<br></code></pre></td></tr></table></figure><p>è¯´æ˜ï¼š<strong>ç­¾åçš„ä½œç”¨æ˜¯åŒºåˆ†ä¸åŒæ“ä½œè€…èº«ï¼Œç­¾åé‚®ç®±å¯ä»¥æ˜¯ä¸å­˜åœ¨çš„ï¼ŒGitä¹Ÿä¸ä¼šå»éªŒè¯é‚®ç®±æ˜¯å¦çœŸå®å­˜åœ¨</strong>ã€‚ç”¨æˆ·çš„ç­¾åä¿¡æ¯åœ¨æ¯ä¸€ä¸ªç‰ˆæœ¬çš„æäº¤ä¿¡æ¯ä¸­èƒ½å¤Ÿçœ‹åˆ°ï¼Œä»¥æ­¤ç¡®è®¤æœ¬æ¬¡æäº¤æ˜¯è°åšçš„ã€‚ <strong>Git é¦–æ¬¡å®‰è£…å¿…é¡»è®¾ç½®ä¸€ä¸‹ç”¨æˆ·ç­¾åï¼Œå¦åˆ™æ— æ³•æäº¤ä»£ç </strong>ã€‚</p><p><strong>æ³¨æ„</strong>ï¼š <strong>è¿™é‡Œè®¾ç½®ç”¨æˆ·ç­¾åå’Œå°†æ¥ç™»å½• GitHubï¼ˆæˆ–å…¶ä»–ä»£ç æ‰˜ç®¡ä¸­å¿ƒï¼‰çš„è´¦å·æ²¡æœ‰ä»»ä½•å…³ç³»ã€‚</strong></p><p>åœ¨ç”¨æˆ·ç›®å½•ä¸‹çš„<code>./gitconfig</code>ä¸­æŸ¥çœ‹è®¾ç½®è¿‡ç”¨æˆ·ç­¾å</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-symbol">abc@</span>DESKTOP-R85C9HV MINGW64 ~/Desktop<br>$ cat ~/.gitconfig<br><span class="hljs-string">[user]</span><br>        name = abc<br>        email = <span class="hljs-symbol">abc@</span><span class="hljs-number">123.</span>com<br><span class="hljs-string">[core]</span><br>        quotepath = <span class="hljs-literal">false</span><br><br></code></pre></td></tr></table></figure><h4 id="1-2-è®¾ç½®ä»“åº“çº§ç”¨æˆ·ç­¾å"><a href="#1-2-è®¾ç½®ä»“åº“çº§ç”¨æˆ·ç­¾å" class="headerlink" title="1.2 è®¾ç½®ä»“åº“çº§ç”¨æˆ·ç­¾å"></a>1.2 è®¾ç½®ä»“åº“çº§ç”¨æˆ·ç­¾å</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git config user.name abc</span><br><span class="hljs-meta">$</span><span class="bash"> git config user.email abc@163.com</span><br></code></pre></td></tr></table></figure><p>è¯´æ˜ï¼š<strong>ç­¾åçš„ä½œç”¨æ˜¯åŒºåˆ†ä¸åŒæ“ä½œè€…èº«ä»½ï¼Œç­¾åé‚®ç®±å¯ä»¥æ˜¯ä¸å­˜åœ¨çš„ï¼ŒGitä¹Ÿä¸ä¼šå»éªŒè¯é‚®ç®±æ˜¯å¦çœŸå®å­˜åœ¨</strong>ã€‚ç”¨æˆ·çš„ç­¾åä¿¡æ¯åœ¨æ¯ä¸€ä¸ªç‰ˆæœ¬çš„æäº¤ä¿¡æ¯ä¸­èƒ½å¤Ÿçœ‹åˆ°ï¼Œä»¥æ­¤ç¡®è®¤æœ¬æ¬¡æäº¤æ˜¯è°åšçš„ã€‚ <strong>Git é¦–æ¬¡å®‰è£…å¿…é¡»è®¾ç½®ä¸€ä¸‹ç”¨æˆ·ç­¾åï¼Œå¦åˆ™æ— æ³•æäº¤ä»£ç </strong>ã€‚</p><p><strong>æ³¨æ„</strong>ï¼š <strong>è¿™é‡Œè®¾ç½®ç”¨æˆ·ç­¾åå’Œå°†æ¥ç™»å½• GitHubï¼ˆæˆ–å…¶ä»–ä»£ç æ‰˜ç®¡ä¸­å¿ƒï¼‰çš„è´¦å·æ²¡æœ‰ä»»ä½•å…³ç³»ã€‚</strong></p><p>åˆ›å»ºæˆåŠŸï¼Œç”¨æˆ·ç­¾åä¿¡æ¯ä¼šä¿å­˜åœ¨æœ¬åœ°å·¥ä½œåŒº <code>./.git/config</code> æ–‡ä»¶ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>cat</code> å‘½ä»¤æŸ¥çœ‹ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs shell">Administrator@DESKTOP-4054V76 MINGW32 /e/ç¬”è®° (master)<br><span class="hljs-meta">$</span><span class="bash"> cat .git/config</span><br>[core]<br>        repositoryformatversion = 0<br>        filemode = false<br>        bare = false<br>        logallrefupdates = true<br>        symlinks = false<br>        ignorecase = true<br>[remote &quot;origin&quot;]<br>        url = git@github.com:JYGQAQ/Notebook.git<br>        fetch = +refs/heads/*:refs/remotes/origin/*<br>[user]<br>        name = JYGQAQ<br>        email = 604713431@qq.com<br></code></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç­¾åçš„ä½œç”¨æ˜¯åŒºåˆ†ä¸åŒçš„ä¸åŒçš„æ“ä½œè€…èº«ä»½ï¼Œæ‰€ä»¥ä¸€èˆ¬åªç”¨è®¾ç½®ç³»ç»Ÿçº§çš„ç”¨æˆ·ç­¾åã€‚å¦‚æœä¸¤ä¸ªçº§åˆ«åŒæ—¶å­˜åœ¨ï¼Œé‚£ä¹ˆä¾ç…§å°±è¿‘åŸåˆ™ï¼Œä»“åº“çº§åˆ«è¦å¤§äºç³»ç»Ÿçº§åˆ«ã€‚å¦‚æœä¸¤ä¸ªçº§åˆ«éƒ½ä¸å­˜åœ¨ï¼Œåˆ™æ— æ³•å®Œæˆ Git ä¸€äº›å‘½ä»¤ï¼Œä¼šæç¤ºéªŒè¯èº«ä»½ã€‚</p><h3 id="2-åˆå§‹åŒ–æœ¬åœ°åº“"><a href="#2-åˆå§‹åŒ–æœ¬åœ°åº“" class="headerlink" title="2. åˆå§‹åŒ–æœ¬åœ°åº“"></a>2. åˆå§‹åŒ–æœ¬åœ°åº“</h3><p>åŸºæœ¬è¯­æ³•ï¼š<code>git init</code></p><p>æ¡ˆä¾‹å®æ“ï¼š</p><ul><li>åˆ›å»ºé¡¹ç›®ç›®å½•</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">mkdir gitLearn<br></code></pre></td></tr></table></figure><ul><li>è¿›å…¥é¡¹ç›®ç›®å½•</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd gitLearn/<br></code></pre></td></tr></table></figure><ul><li>åˆå§‹åŒ–æœ¬åœ°åº“</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git init</span><br>Initialized empty Git repository in E:/gitLearn/.git/<br></code></pre></td></tr></table></figure><p>Gitè‡ªåŠ¨åˆ›å»ºäº†ä¸€ä¸ªåä¸º. git éç©ºéšè—æ–‡ä»¶å¤¹ã€‚</p><h3 id="3-æŸ¥çœ‹æœ¬åœ°åº“çŠ¶æ€"><a href="#3-æŸ¥çœ‹æœ¬åœ°åº“çŠ¶æ€" class="headerlink" title="3. æŸ¥çœ‹æœ¬åœ°åº“çŠ¶æ€"></a>3. æŸ¥çœ‹æœ¬åœ°åº“çŠ¶æ€</h3><p>åŸºæœ¬è¯­æ³•ï¼š<code>git status</code></p><p>æ¡ˆä¾‹å®æ“ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">Administrator@DESKTOP-4054V76 MINGW32 /e/gitLearn (master)<br><span class="hljs-meta">$</span><span class="bash"> git status</span><br>On branch master <br><br>No commits yet<br><br>nothing to commit (create/copy files and use &quot;git add&quot; to track)<br></code></pre></td></tr></table></figure><p>ç¬¬ä¸€è¡Œï¼šç›®å‰å¤„äºå“ªä¸ªæœ¬åœ°åˆ†æ”¯</p><p>ç¬¬äºŒè¡Œï¼šä»æ¥æ²¡æœ‰<code>commit</code>è¿‡ï¼Œæœ¬åœ°åº“æ²¡æœ‰ç‰ˆæœ¬ä¿¡æ¯ã€‚</p><p>ç¬¬ä¸‰è¡Œï¼šæ²¡æœ‰æ›´æ”¹éœ€è¦<code>commit</code></p><ul><li>æ–°å»ºæ–‡ä»¶åï¼ŒæŸ¥çœ‹æœ¬åœ°åº“çŠ¶æ€</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell">Administrator@DESKTOP-4054V76 MINGW32 /e/gitLearn (master)<br><span class="hljs-meta">$</span><span class="bash"> git status</span><br>On branch master<br><br>No commits yet<br><br>Untracked files:<br>  (use &quot;git add &lt;file&gt;...&quot; to include in what will be committed)<br><br>        newfile.txt<br><br>nothing added to commit but untracked files present (use &quot;git add&quot; to track)<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/image-20220121000221864.png"></p><p>æ­¤å¤„ï¼Œæœ‰ä¸€ä¸ªæœªè¢«è¿½è¸ªçš„æ–‡ä»¶<code>newfile.txt</code>ï¼ˆ<strong>è¢«æ ‡çº¢</strong>ï¼‰ï¼Œæ„æ€æ˜¯éœ€è¦<code>git add</code>æ¥æäº¤åˆ°æš‚å­˜åŒºè¿½è¸ªã€‚</p><p>æœ‰è¢«<strong>æ ‡çº¢</strong>çš„æ–‡ä»¶ï¼Œè¯´æ˜è¯¥æ–‡ä»¶<strong>æ–°åˆ›å»ºæˆ–è€…å’Œç›¸å¯¹äºæš‚å­˜åŒºæœ‰æ›´æ”¹</strong>éœ€è¦è¢«<code>git add</code>æäº¤åˆ°æš‚å­˜åŒºè¿½è¸ªã€‚</p><h3 id="4-æ·»åŠ åˆ°æš‚å­˜åŒº"><a href="#4-æ·»åŠ åˆ°æš‚å­˜åŒº" class="headerlink" title="4.æ·»åŠ åˆ°æš‚å­˜åŒº"></a>4.æ·»åŠ åˆ°æš‚å­˜åŒº</h3><p>åŸºæœ¬è¯­æ³•ï¼š<code>git add æ–‡ä»¶å</code> æˆ–è€… <code>git add .</code>ä»£è¡¨æ·»åŠ æ‰€æœ‰æœ‰æ›´æ”¹çš„æ–‡ä»¶åˆ°æš‚å­˜åŒº</p><p>æ¡ˆä¾‹å®æ“ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">git add newfile.txt<br>æˆ–è€…<br>git add .<br></code></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ä½¿ç”¨<code>git status</code>æŸ¥çœ‹æœ¬åœ°åº“çŠ¶æ€</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/e666e7de96c9def5042f595dd04805e.png"></p><p>æ³¨æ„ä¸Šé¢çš„æç¤ºï¼š</p><p>å¯ä»¥ä½¿ç”¨<code>git rm --cached newfile.txt</code>æ¥ä»ç´¢å¼•ä¸­åˆ é™¤æ–‡ä»¶ã€‚ä½†æ˜¯æœ¬åœ°æ–‡ä»¶è¿˜å­˜åœ¨ï¼Œ åªæ˜¯ä¸å¸Œæœ›è¿™ä¸ªæ–‡ä»¶è¢«ç‰ˆæœ¬æ§åˆ¶ï¼Œæ„æ€æ˜¯ä»æš‚å­˜åŒºä¸­åˆ é™¤<code>newfile.txt</code>ã€‚</p><p>è‹¥ä½¿ç”¨<code>git rm newfile.txt</code>åŒæ—¶ä»å·¥ä½œåŒºå’Œç´¢å¼•ä¸­åˆ é™¤æ–‡ä»¶ã€‚å³æœ¬åœ°çš„æ–‡ä»¶ä¹Ÿè¢«åˆ é™¤äº†ã€‚</p><p>æ­¤å¤„ï¼Œæœ‰ä¸€ä¸ªæœªè¢«è¿½è¸ªçš„æ–‡ä»¶<code>newfile.txt</code>ï¼ˆ<strong>è¢«æ ‡ç»¿</strong>ï¼‰ï¼Œæ„æ€æ˜¯éœ€è¦<code>git commit</code>æ¥æäº¤åˆ°æœ¬åœ°åº“ï¼Œæ¥è¿›è¡Œç‰ˆæœ¬æ§åˆ¶ã€‚</p><p>æœ‰è¢«<strong>æ ‡ç»¿</strong>çš„æ–‡ä»¶ï¼Œè¯´æ˜è¯¥æ–‡ä»¶<strong>æœªè¢«æäº¤åˆ°æœ¬åœ°åº“æˆ–è€…æœ¬æ–‡ä»¶ç›¸å¯¹äºæœ¬åœ°åº“æœ‰æ›´æ”¹</strong>éœ€è¦è¢«<code>git commit</code>æ¥æäº¤åˆ°æœ¬åœ°åº“ï¼Œæ¥è¿›è¡Œç‰ˆæœ¬æ§åˆ¶ã€‚</p><p> <code> git commit -a -m â€œmassageâ€œ</code></p><p>â€‹      å…¶ä»–åŠŸèƒ½å¦‚-må‚æ•°ï¼ŒåŠ çš„-aå‚æ•°å¯ä»¥å°†æ‰€æœ‰å·²è·Ÿè¸ªæ–‡ä»¶ä¸­çš„æ‰§è¡Œä¿®æ”¹æˆ–åˆ é™¤æ“ä½œçš„æ–‡ä»¶éƒ½æäº¤åˆ°æœ¬åœ°ä»“åº“ï¼Œå³ä½¿å®ƒä»¬æ²¡æœ‰ç»è¿‡git addæ·»åŠ åˆ°æš‚å­˜åŒºï¼Œæ³¨æ„ï¼Œæ–°åŠ çš„æ–‡ä»¶ï¼ˆå³æ²¡æœ‰è¢«gitç³»ç»Ÿç®¡ç†çš„æ–‡ä»¶ï¼‰æ˜¯ä¸èƒ½è¢«æäº¤åˆ°æœ¬åœ°ä»“åº“çš„ã€‚å»ºè®®ä¸€èˆ¬ä¸è¦ä½¿ç”¨-aå‚æ•°ï¼Œæ­£å¸¸çš„æäº¤è¿˜æ˜¯ä½¿ç”¨git addå…ˆå°†è¦æ”¹åŠ¨çš„æ–‡ä»¶æ·»åŠ åˆ°æš‚å­˜åŒºï¼Œå†ç”¨git commit æäº¤åˆ°æœ¬åœ°ç‰ˆæœ¬åº“ã€‚</p><p>  <code>git commit --amend</code></p><p>â€‹      å¦‚æœæˆ‘ä»¬ä¸å°å¿ƒæäº¤äº†ä¸€ç‰ˆæˆ‘ä»¬ä¸æ»¡æ„çš„ä»£ç ï¼Œå¹¶ä¸”ç»™å®ƒæ¨é€åˆ°æœåŠ¡å™¨äº†ï¼Œåœ¨ä»£ç æ²¡è¢«mergeä¹‹å‰æˆ‘ä»¬å¸Œæœ›å†ä¿®æ”¹ä¸€ç‰ˆæ»¡æ„çš„ï¼Œè€Œå¦‚æœæˆ‘ä»¬ä¸æƒ³åœ¨æœåŠ¡å™¨ä¸Šabondonï¼Œé‚£ä¹ˆæˆ‘ä»¬æ€ä¹ˆåšå‘¢ï¼Ÿgit commit â€“amend //ä¹Ÿå«è¿½åŠ æäº¤ï¼Œå®ƒå¯ä»¥åœ¨ä¸å¢åŠ ä¸€ä¸ªæ–°çš„commit-idçš„æƒ…å†µä¸‹å°†æ–°ä¿®æ”¹çš„ä»£ç è¿½åŠ åˆ°å‰ä¸€æ¬¡çš„commit-idä¸­ï¼Œä½¿å¾—ç‰ˆæœ¬åº“æ›´åŠ æ¸…çˆ½ã€‚</p><h3 id="5-æäº¤æœ¬åœ°åº“"><a href="#5-æäº¤æœ¬åœ°åº“" class="headerlink" title="5. æäº¤æœ¬åœ°åº“"></a>5. æäº¤æœ¬åœ°åº“</h3><p>åŸºæœ¬è¯­æ³•ï¼š<code>git commit -m &quot;æ—¥å¿—ä¿¡æ¯&quot; æ–‡ä»¶å</code> æˆ–è€… <code>git commit -m &quot;message&quot;</code>æäº¤æ‰€æœ‰æš‚å­˜åŒºå†…å®¹åˆ°æœ¬åœ°åº“ã€‚</p><p>git commit ä¸»è¦æ˜¯å°†æš‚å­˜åŒºé‡Œçš„æ”¹åŠ¨ç»™æäº¤åˆ°æœ¬åœ°çš„ç‰ˆæœ¬åº“ã€‚æ¯æ¬¡ä½¿ç”¨git commit å‘½ä»¤æˆ‘ä»¬éƒ½ä¼šåœ¨æœ¬åœ°ç‰ˆæœ¬åº“ç”Ÿæˆä¸€ä¸ª40ä½çš„å“ˆå¸Œå€¼ï¼Œè¿™ä¸ªå“ˆå¸Œå€¼ä¹Ÿå«<strong>commit-id</strong>ï¼Œcommit-idåœ¨ç‰ˆæœ¬å›é€€çš„æ—¶å€™æ˜¯éå¸¸æœ‰ç”¨çš„ï¼Œå®ƒç›¸å½“äºä¸€ä¸ªå¿«ç…§,å¯ä»¥åœ¨æœªæ¥çš„ä»»ä½•æ—¶å€™é€šè¿‡ä¸git resetçš„ç»„åˆå‘½ä»¤å›åˆ°è¿™é‡Œã€‚</p><p>æ¡ˆä¾‹å®æ“ï¼š</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/bbc4110ceb47c9dba34e612aef1167f.png"></p><p>æŸ¥çœ‹æœ¬åœ°åº“çŠ¶æ€ï¼š</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/139f25276d55d99e9197b2570a65bff.png"></p><p>å‘ç°æ²¡æœ‰<strong>ç»¿å</strong>å’Œ<strong>çº¢å</strong>æ–‡ä»¶è¢«æ ‡æ³¨ï¼Œè¯´æ˜æ²¡æœ‰æ–‡ä»¶éœ€è¦è¢«<strong>commit</strong>å’Œ<strong>add</strong>ã€‚</p><h4 id="5-1-æŸ¥çœ‹æœ¬åœ°åº“ç‰ˆæœ¬ä¿¡æ¯"><a href="#5-1-æŸ¥çœ‹æœ¬åœ°åº“ç‰ˆæœ¬ä¿¡æ¯" class="headerlink" title="5.1 æŸ¥çœ‹æœ¬åœ°åº“ç‰ˆæœ¬ä¿¡æ¯"></a>5.1 æŸ¥çœ‹æœ¬åœ°åº“ç‰ˆæœ¬ä¿¡æ¯</h4><p>æŸ¥çœ‹æœ¬åœ°åº“ç‰ˆæœ¬ä¿¡æ¯ï¼Œä½¿ç”¨<code>git reflog</code>æŸ¥çœ‹å¼•ç”¨æ—¥å¿—ä¿¡æ¯ã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/a09103f44b288329021af4dd79da2df.png"></p><p>è¯´æ˜ï¼šå¼€å¤´æ˜¯çš„å“ˆå¸Œå€¼æ˜¯<strong>commit-id</strong>ï¼Œæœ€åæ˜¯<strong>commit</strong>çš„messageä¿¡æ¯ã€‚<code>HEAD</code>æ˜¯æŒ‡é’ˆï¼ŒæŒ‡å‘äº†<code>master</code>åˆ†æ”¯ã€‚</p><p>æŸ¥çœ‹æœ¬åœ°åº“ç‰ˆæœ¬çš„è¯¦ç»†ä¿¡æ¯ï¼Œä½¿ç”¨<code>git log</code>ã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/dba0007b3c4df902e87585dd7b38769.png"></p><p>è¯´æ˜ï¼šç¬¬ä¸€è¡Œæ˜¯<strong>commit-id</strong>çš„å‡†ç¡®å€¼ï¼Œç¬¬äºŒè¡Œæ˜¯æäº¤è€…çš„ç”¨æˆ·ç­¾åï¼Œç¬¬ä¸‰è¡Œæ˜¯æäº¤æ—¶é—´ï¼Œç¬¬å››è¡Œæ˜¯<code>commit</code>çš„<code>message</code>ã€‚</p><h4 id="5-2-Commit-Message-è§„èŒƒ"><a href="#5-2-Commit-Message-è§„èŒƒ" class="headerlink" title="5.2 Commit Message è§„èŒƒ"></a>5.2 Commit Message è§„èŒƒ</h4><p><code>git commit</code>å‘½ä»¤è¦æ±‚ç¼–å†™<code>commit message</code>ï¼Œä¸ç„¶æ— æ³•æäº¤ï¼Œå…³äº<code>commit message</code>çš„ç¼–å†™ï¼Œæˆ‘ä»¬å¾€å¾€å®¹æ˜“å¿½ç•¥è§„èŒƒï¼Œæ•´ä½“æ¥è®²ï¼Œ<code>commit message</code>åº”è¯¥æ¸…æ™°ç®€æ´ï¼Œèƒ½å¤Ÿæç°æœ¬æ¬¡æäº¤ç›®çš„ã€‚</p><p>å…³äº<code>commit message</code>çš„ç¼–å†™è§„èŒƒï¼Œç¤¾åŒºæœ‰å¾ˆå¤šç§ï¼Œ<code>Angularè§„èŒƒ</code>æ˜¯ç›®å‰ä½¿ç”¨æœ€å¹¿çš„å†™æ³•ï¼Œæœ¬æ–‡å°±ç®€å•ä»‹ç»ä¸€ä¸‹ã€‚</p><p><code>commit message</code>çš„æ„æˆåŒ…æ‹¬ä¸‰éƒ¨åˆ†ï¼š <code>Header, Body å’Œ Footer</code></p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-params">&lt;type&gt;</span> (<span class="hljs-params">&lt;scope&gt;</span>): <span class="hljs-params">&lt;subject&gt;</span><br><span class="hljs-comment">// ç©ºè¡Œ</span><br><span class="hljs-params">&lt;body&gt;</span><br><span class="hljs-comment">// ç©ºè¡Œ</span><br><span class="hljs-params">&lt;footer&gt;</span><br>å¤åˆ¶ä»£ç <br><br></code></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œ<code>Header</code>æ˜¯å¿…éœ€çš„ï¼Œ<code>Body</code>å’Œ<code>Footer</code>å¯ä»¥çœç•¥ã€‚</p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs gcode">æ³¨æ„ï¼šä»»ä½•ä¸€å¸ƒè¡Œéƒ½ä¸å¾—è¶…è¿‡ <span class="hljs-number">72</span><span class="hljs-comment">(æˆ–100)</span> ä¸ªå­—ç¬¦ï¼Œé¿å…è‡ªåŠ¨æ¢è¡Œå½±å“ç¾è§‚<br>å¤åˆ¶ä»£ç <br><br></code></pre></td></tr></table></figure><h5 id="5-2-1Header"><a href="#5-2-1Header" class="headerlink" title="5.2.1Header"></a>5.2.1Header</h5><p><code>Header</code>å ä¸€è¡Œï¼ŒåŒ…æ‹¬ä¸‰ä¸ªå­—æ®µï¼š<code>type, scope, subject</code></p><p><strong>(1) type</strong></p><p><code>type</code> ç”¨äºè¯´æ˜ <code>commit</code>ç±»åˆ«ï¼Œåªå…è®¸ä»¥ä¸‹ 7 ä¸ªæ ‡è¯†ï¼š</p><ul><li>  feat: æ–°åŠŸèƒ½ (feature)</li><li>  fix: ä¿®è¡¥ bug</li><li>  docs: æ–‡æ¡£ (documentation)</li><li>  style: æ ¼å¼ (æ¯”å¦‚å»é™¤ç©ºè¡Œ)</li><li>  refactor: é‡æ„ (ä¸æ˜¯æ–°å¢åŠŸèƒ½ï¼Œä¹Ÿä¸æ˜¯ä¿®è¡¥ bug)</li><li>  test: å¢åŠ æµ‹è¯•</li><li>  chore: æ„å»ºè¿‡ç¨‹æˆ–è¾…åŠ©å·¥å…·çš„å˜åŠ¨</li></ul><p><strong>(2) scope</strong></p><p><code>scope</code> ç”¨äºè¯´æ˜ <code>commit</code> å½±å“çš„èŒƒå›´ï¼Œæ¯”å¦‚æ•°æ®å±‚ã€æ§åˆ¶å±‚ã€è§†å›¾å±‚ç­‰ç­‰ (å¾ˆå°‘ç”¨åˆ°)</p><p><strong>(3) subject</strong></p><p>æè¿°æœ¬æ¬¡æäº¤çš„ç›®çš„ï¼Œä¸è¶…è¿‡ 50 ä¸ªå­—ç¬¦</p><ul><li>  ä»¥åŠ¨è¯å¼€å¤´ï¼Œä½¿ç”¨ç¬¬ä¸€äººç§°ç°åœ¨æ—¶ï¼Œæ¯”å¦‚ changeï¼Œè€Œä¸æ˜¯ changed æˆ– changes</li><li>  ç¬¬ä¸€ä¸ªå­—æ¯å°å†™</li><li>  ç»“å°¾ä¸åŠ å¥å·</li></ul><h5 id="5-2-2-Body"><a href="#5-2-2-Body" class="headerlink" title="5.2.2 Body"></a>5.2.2 Body</h5><p><code>Body</code>éƒ¨åˆ†æ˜¯å¯¹æœ¬æ¬¡ <code>commit</code> çš„è¯¦ç»†æè¿°ï¼Œå¯ä»¥åˆ†ä¸ºå¤šè¡Œæè¿°ï¼Œè¦æ±‚ä½¿ç”¨ç¬¬ä¸€äººç§°ç°åœ¨æ—¶ï¼Œè¯´æ˜ä»£ç å˜åŠ¨åŸå› ä»¥åŠå‰åè¡Œä¸ºå¯¹æ¯”ã€‚</p><h5 id="5-2-3-Footer"><a href="#5-2-3-Footer" class="headerlink" title="5.2.3 Footer"></a>5.2.3 Footer</h5><p><code>Footer</code> åªé€‚ç”¨äºä¸¤ç§æƒ…å†µï¼š</p><ul><li>  (1) ä¸å…¼å®¹å˜åŠ¨</li></ul><p>å½“å‰ä»£ç ä¸ä¸Šä¸€ä¸ªç‰ˆæœ¬ä¸å…¼å®¹ï¼Œåˆ™ <code>Footer</code> éƒ¨åˆ†ä»¥ <code>BREAKING CHANGE</code> å¼€å¤´ï¼Œåé¢æ˜¯å¯¹å˜åŠ¨çš„æè¿°ã€å˜åŠ¨ç†ç”±å’Œè¿ç§»æ–¹æ³•</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">BREAKING CHANGE:</span> <span class="hljs-string">isolate</span> <span class="hljs-string">scope</span> <span class="hljs-string">bindings</span> <span class="hljs-string">definition</span> <span class="hljs-string">has</span> <span class="hljs-string">changed.</span><br><br>    <span class="hljs-attr">To migrate the code follow the example below:</span><br><br>    <span class="hljs-attr">Before:</span><br><br>    <span class="hljs-attr">scope:</span> &#123;<br>      <span class="hljs-attr">myAttr:</span> <span class="hljs-string">&#x27;attribute&#x27;</span>,<br>    &#125;<br><br>    <span class="hljs-attr">After:</span><br><br>    <span class="hljs-attr">scope:</span> &#123;<br>      <span class="hljs-attr">myAttr:</span> <span class="hljs-string">&#x27;@&#x27;</span>,<br>    &#125;<br><br>    <span class="hljs-string">The</span> <span class="hljs-string">removed</span> <span class="hljs-string">`inject`</span> <span class="hljs-string">wasn&#x27;t</span> <span class="hljs-string">generaly</span> <span class="hljs-string">useful</span> <span class="hljs-string">for</span> <span class="hljs-string">directives</span> <span class="hljs-string">so</span> <span class="hljs-string">there</span> <span class="hljs-string">should</span> <span class="hljs-string">be</span> <span class="hljs-literal">no</span> <span class="hljs-string">code</span> <span class="hljs-string">using</span> <span class="hljs-string">it.</span><br></code></pre></td></tr></table></figure><ul><li>  (2) å…³é—­ <code>Issue</code></li></ul><p>å¦‚æœå½“å‰ <code>commit</code> é’ˆå¯¹æŸä¸ª <code>issue</code>ï¼Œé‚£ä¹ˆå¯ä»¥åœ¨ <code>Footer</code> éƒ¨åˆ†å…³é—­è¿™ä¸ª <code>issue</code></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">Closes</span> #<span class="hljs-number">123</span>, #<span class="hljs-number">234</span>, #<span class="hljs-number">345</span><br></code></pre></td></tr></table></figure><h3 id="6-ä¿®æ”¹æ–‡ä»¶"><a href="#6-ä¿®æ”¹æ–‡ä»¶" class="headerlink" title="6. ä¿®æ”¹æ–‡ä»¶"></a>6. ä¿®æ”¹æ–‡ä»¶</h3><p>ä¿®æ”¹ <code>newfile.txt</code> å†…å®¹ï¼Œ<code>git status</code>ä¼šæç¤ºè¯¥æ–‡ä»¶ä¿®æ”¹è¿‡ï¼ˆä¼šè¢«<strong>æ ‡çº¢</strong>ï¼Œè·Ÿæš‚å­˜åŒºç›¸æ¯”æœ‰æ›´æ”¹ï¼‰ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/8bf87fdbd981c5d3e8d12843be4647e.png"></p><p><code>git checkout -- file</code>æ˜¯æŒ‡æ ¹æ®æš‚å­˜åŒºçš„<code>file</code>æ–‡ä»¶æ¥è¦†ç›–å·¥ä½œåŒºçš„<code>file</code>æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯æ”¾å¼ƒæ›´æ”¹ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒGitæ˜¯ä»¥<strong>è¡Œ</strong>æ¥ç®¡ç†æ–‡ä»¶çš„ï¼Œæœ€å°å•ä½æ˜¯è¡Œã€‚</p><h3 id="7-æŸ¥çœ‹ç‰ˆæœ¬ä¹‹é—´çš„ä¸åŒ"><a href="#7-æŸ¥çœ‹ç‰ˆæœ¬ä¹‹é—´çš„ä¸åŒ" class="headerlink" title="7. æŸ¥çœ‹ç‰ˆæœ¬ä¹‹é—´çš„ä¸åŒ"></a>7. æŸ¥çœ‹ç‰ˆæœ¬ä¹‹é—´çš„ä¸åŒ</h3><h4 id="7-1-æ¯”è¾ƒå·¥ä½œåŒºä¸æš‚å­˜åŒº"><a href="#7-1-æ¯”è¾ƒå·¥ä½œåŒºä¸æš‚å­˜åŒº" class="headerlink" title="7.1 æ¯”è¾ƒå·¥ä½œåŒºä¸æš‚å­˜åŒº"></a>7.1 æ¯”è¾ƒå·¥ä½œåŒºä¸æš‚å­˜åŒº</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git diff<br></code></pre></td></tr></table></figure><p>git diff ä¸åŠ å‚æ•°å³é»˜è®¤æ¯”è¾ƒå·¥ä½œåŒºä¸æš‚å­˜åŒº</p><h4 id="7-2-æ¯”è¾ƒæš‚å­˜åŒºä¸æœ€æ–°æœ¬åœ°ç‰ˆæœ¬åº“ï¼ˆæœ¬åœ°åº“ä¸­æœ€è¿‘ä¸€æ¬¡commitçš„å†…å®¹ï¼‰"><a href="#7-2-æ¯”è¾ƒæš‚å­˜åŒºä¸æœ€æ–°æœ¬åœ°ç‰ˆæœ¬åº“ï¼ˆæœ¬åœ°åº“ä¸­æœ€è¿‘ä¸€æ¬¡commitçš„å†…å®¹ï¼‰" class="headerlink" title="7.2 æ¯”è¾ƒæš‚å­˜åŒºä¸æœ€æ–°æœ¬åœ°ç‰ˆæœ¬åº“ï¼ˆæœ¬åœ°åº“ä¸­æœ€è¿‘ä¸€æ¬¡commitçš„å†…å®¹ï¼‰"></a>7.2 æ¯”è¾ƒæš‚å­˜åŒºä¸æœ€æ–°æœ¬åœ°ç‰ˆæœ¬åº“ï¼ˆæœ¬åœ°åº“ä¸­æœ€è¿‘ä¸€æ¬¡commitçš„å†…å®¹ï¼‰</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git diff --cached [&lt;path&gt;...] <br></code></pre></td></tr></table></figure><p>git diff ä¸åŠ å‚æ•°å³é»˜è®¤æ¯”è¾ƒå·¥ä½œåŒºä¸æš‚å­˜åŒº2.7.1æ¯”è¾ƒå·¥ä½œåŒºä¸æš‚å­˜åŒº</p><h4 id="7-3-æ¯”è¾ƒå·¥ä½œåŒºä¸æœ€æ–°æœ¬åœ°ç‰ˆæœ¬åº“"><a href="#7-3-æ¯”è¾ƒå·¥ä½œåŒºä¸æœ€æ–°æœ¬åœ°ç‰ˆæœ¬åº“" class="headerlink" title="7.3 æ¯”è¾ƒå·¥ä½œåŒºä¸æœ€æ–°æœ¬åœ°ç‰ˆæœ¬åº“"></a>7.3 æ¯”è¾ƒå·¥ä½œåŒºä¸æœ€æ–°æœ¬åœ°ç‰ˆæœ¬åº“</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git diff HEAD [&lt;path&gt;...] #å¦‚æœHEADæŒ‡å‘çš„æ˜¯masteråˆ†æ”¯ï¼Œé‚£ä¹ˆHEADè¿˜å¯ä»¥æ¢æˆmaster<br></code></pre></td></tr></table></figure><h4 id="7-4-æ¯”è¾ƒå·¥ä½œåŒºåŸŸæŒ‡å®šcommit-idçš„å·®å¼‚"><a href="#7-4-æ¯”è¾ƒå·¥ä½œåŒºåŸŸæŒ‡å®šcommit-idçš„å·®å¼‚" class="headerlink" title="7.4 æ¯”è¾ƒå·¥ä½œåŒºåŸŸæŒ‡å®šcommit-idçš„å·®å¼‚"></a>7.4 æ¯”è¾ƒå·¥ä½œåŒºåŸŸæŒ‡å®šcommit-idçš„å·®å¼‚</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git diff commit-id [&lt;path&gt; ...]<br></code></pre></td></tr></table></figure><h4 id="7-5-æ¯”è¾ƒæš‚å­˜åŒºä¸æŒ‡å®šcommit-idçš„å·®å¼‚"><a href="#7-5-æ¯”è¾ƒæš‚å­˜åŒºä¸æŒ‡å®šcommit-idçš„å·®å¼‚" class="headerlink" title="7.5 æ¯”è¾ƒæš‚å­˜åŒºä¸æŒ‡å®šcommit-idçš„å·®å¼‚"></a>7.5 æ¯”è¾ƒæš‚å­˜åŒºä¸æŒ‡å®šcommit-idçš„å·®å¼‚</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git diff --cached [&lt;commit-id&gt;][&lt;path&gt;...]<br></code></pre></td></tr></table></figure><h4 id="7-6-æ¯”è¾ƒä¸¤ä¸ªcommit-idä¹‹é—´çš„å·®å¼‚"><a href="#7-6-æ¯”è¾ƒä¸¤ä¸ªcommit-idä¹‹é—´çš„å·®å¼‚" class="headerlink" title="7.6 æ¯”è¾ƒä¸¤ä¸ªcommit-idä¹‹é—´çš„å·®å¼‚"></a>7.6 æ¯”è¾ƒä¸¤ä¸ªcommit-idä¹‹é—´çš„å·®å¼‚</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git diff [&lt;commit-id&gt;] [&lt;commit-id&gt;]<br></code></pre></td></tr></table></figure><h3 id="8-ç‰ˆæœ¬ç©¿æ¢­"><a href="#8-ç‰ˆæœ¬ç©¿æ¢­" class="headerlink" title="8. ç‰ˆæœ¬ç©¿æ¢­"></a>8. ç‰ˆæœ¬ç©¿æ¢­</h3><h4 id="8-1-æŸ¥çœ‹å†å²ç‰ˆæœ¬"><a href="#8-1-æŸ¥çœ‹å†å²ç‰ˆæœ¬" class="headerlink" title="8.1 æŸ¥çœ‹å†å²ç‰ˆæœ¬"></a>8.1 æŸ¥çœ‹å†å²ç‰ˆæœ¬</h4><p>åŸºæœ¬è¯­æ³•ï¼š</p><ul><li>  <code>git reflog</code> æŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯</li><li>  <code>git log</code> æŸ¥çœ‹ç‰ˆæœ¬è¯¦ç»†ä¿¡æ¯         åŠ ä¸Š<code>--graph</code>æœ‰å›¾å½¢è¡¨ç¤ºã€‚</li></ul><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/dba0007b3c4df902e87585dd7b38769.png"></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/a09103f44b288329021af4dd79da2df.png"></p><p><strong>git log ä¸ git reflog åŒºåˆ«</strong></p><p><code>git log</code> å‘½ä»¤å¯ä»¥æ˜¾ç¤ºæ‰€æœ‰æäº¤è¿‡çš„ç‰ˆæœ¬ä¿¡æ¯ï¼Œå¦‚æœæ„Ÿè§‰å¤ªç¹çï¼Œå¯ä»¥åŠ ä¸Šå‚æ•° <code>--pretty=oneline</code>ï¼Œåªä¼šæ˜¾ç¤ºç‰ˆæœ¬å·å’Œæäº¤æ—¶çš„å¤‡æ³¨ä¿¡æ¯ã€‚</p><p><code>git reflog</code> å¯ä»¥æŸ¥çœ‹æ‰€æœ‰åˆ†æ”¯çš„æ‰€æœ‰æ“ä½œè®°å½•ï¼ˆåŒ…æ‹¬å·²ç»è¢«åˆ é™¤çš„ commit è®°å½•å’Œ reset çš„æ“ä½œï¼‰ã€‚ä¾‹å¦‚ï¼Œæ‰§è¡Œ <code>git reset --hard HEAD~1</code>ï¼Œé€€å›åˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬ï¼Œç”¨<code>git log</code>åˆ™æ˜¯çœ‹ä¸å‡ºæ¥è¢«åˆ é™¤çš„ commitidï¼Œç”¨<code>git reflog</code>åˆ™å¯ä»¥çœ‹åˆ°è¢«åˆ é™¤çš„ commitidï¼Œæˆ‘ä»¬å°±å¯ä»¥ä¹°åæ‚”è¯ï¼Œæ¢å¤åˆ°è¢«åˆ é™¤çš„é‚£ä¸ªç‰ˆæœ¬ã€‚<a href="https://blog.csdn.net/u013252047/article/details/80230781">link</a></p><h4 id="8-2-ç‰ˆæœ¬ç©¿æ¢­"><a href="#8-2-ç‰ˆæœ¬ç©¿æ¢­" class="headerlink" title="8.2 ç‰ˆæœ¬ç©¿æ¢­"></a>8.2 ç‰ˆæœ¬ç©¿æ¢­</h4><p>åŸºæœ¬è¯­æ³•ï¼š</p><p><code>git reset --hard ç‰ˆæœ¬å·</code>ï¼Œ**â€“hard** å‚æ•°æ’¤é”€å·¥ä½œåŒºä¸­æ‰€æœ‰æœªæäº¤çš„ä¿®æ”¹å†…å®¹ï¼Œå°†æš‚å­˜åŒºä¸å·¥ä½œåŒºéƒ½å›åˆ°ä¸Šä¸€æ¬¡ç‰ˆæœ¬ï¼Œå¹¶åˆ é™¤ä¹‹å‰çš„æ‰€æœ‰ä¿¡æ¯æäº¤ã€‚</p><p><code>git reset HEAD</code> ã€<code>git reset</code> ã€<code>git reset --soft HEAD</code>æˆ–è€…<code>git reset --mixed</code><strong>â€“mixed</strong> ä¸ºé»˜è®¤ï¼Œå¯ä»¥ä¸ç”¨å¸¦è¯¥å‚æ•°ï¼Œç”¨äºé‡ç½®æš‚å­˜åŒºçš„æ–‡ä»¶ä¸ä¸Šä¸€æ¬¡çš„æäº¤(commit)ä¿æŒä¸€è‡´ï¼Œå·¥ä½œåŒºæ–‡ä»¶å†…å®¹ä¿æŒä¸å˜ã€‚</p><p><strong>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸Šé¢ä¸¤ç§ç”¨æ³•ï¼Œéƒ½å¯ä»¥å¡«<code>ç‰ˆæœ¬å·</code>å’Œ<code>HEAD ... HEAD^^</code>ï¼Œå”¯ä¸€ä¸åŒçš„æ˜¯ï¼Œâ€“hardé‡å†™å·¥ä½œåŒºå’Œæš‚å­˜åŒºï¼Œå…¶ä»–åªé‡å†™æš‚å­˜åŒºã€‚</strong></p><p><strong>Git åˆ‡æ¢ç‰ˆæœ¬ï¼Œ åº•å±‚å…¶å®æ˜¯ç§»åŠ¨çš„ HEAD æŒ‡é’ˆï¼Œä¸ä¼šäº§ç”Ÿæ–°çš„ç‰ˆæœ¬ã€‚</strong></p><h2 id="ä¸‰ã€Gitåˆ†æ”¯ç”¨æ³•"><a href="#ä¸‰ã€Gitåˆ†æ”¯ç”¨æ³•" class="headerlink" title="ä¸‰ã€Gitåˆ†æ”¯ç”¨æ³•"></a>ä¸‰ã€Gitåˆ†æ”¯ç”¨æ³•</h2><h3 id="1-åˆ†æ”¯æ¦‚è¿°å’Œä¼˜ç‚¹"><a href="#1-åˆ†æ”¯æ¦‚è¿°å’Œä¼˜ç‚¹" class="headerlink" title="1. åˆ†æ”¯æ¦‚è¿°å’Œä¼˜ç‚¹"></a>1. åˆ†æ”¯æ¦‚è¿°å’Œä¼˜ç‚¹</h3><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/bcad650a512a72097b3391e00ecb8bbe.png"></p><h4 id="1-1-ä»€ä¹ˆæ˜¯åˆ†æ”¯"><a href="#1-1-ä»€ä¹ˆæ˜¯åˆ†æ”¯" class="headerlink" title="1.1 ä»€ä¹ˆæ˜¯åˆ†æ”¯"></a>1.1 ä»€ä¹ˆæ˜¯åˆ†æ”¯</h4><p>åœ¨ç‰ˆæœ¬æ§åˆ¶è¿‡ç¨‹ä¸­ï¼ŒåŒæ—¶æ¨è¿›å¤šä¸ªä»»åŠ¡ï¼Œä¸ºæ¯ä¸ªä»»åŠ¡ï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ›å»ºæ¯ä¸ªä»»åŠ¡çš„å•ç‹¬åˆ†æ”¯ã€‚ä½¿ç”¨åˆ†æ”¯æ„å‘³ç€ç¨‹åºå‘˜å¯ä»¥æŠŠè‡ªå·±çš„å·¥ä½œä»å¼€å‘ä¸»çº¿ä¸Šåˆ†ç¦»å¼€æ¥ï¼Œ å¼€å‘è‡ªå·±åˆ†æ”¯çš„æ—¶å€™ï¼Œä¸ä¼šå½±å“ä¸»çº¿åˆ†æ”¯çš„è¿è¡Œã€‚å¯¹äºåˆå­¦è€…è€Œè¨€ï¼Œåˆ†æ”¯å¯ä»¥ç®€å•ç†è§£ä¸ºå‰¯æœ¬ï¼Œä¸€ä¸ªåˆ†æ”¯å°±æ˜¯ä¸€ä¸ªå•ç‹¬çš„å‰¯æœ¬ã€‚ï¼ˆåˆ†æ”¯åº•å±‚å…¶å®ä¹Ÿæ˜¯æŒ‡é’ˆçš„å¼•ç”¨ï¼‰</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/f1d0659ed000e9dfa295fc696a58cf74.png"></p><h4 id="1-2åˆ†æ”¯çš„å¥½å¤„"><a href="#1-2åˆ†æ”¯çš„å¥½å¤„" class="headerlink" title="1.2åˆ†æ”¯çš„å¥½å¤„"></a>1.2åˆ†æ”¯çš„å¥½å¤„</h4><p>åŒæ—¶<strong>å¹¶è¡Œ</strong>æ¨è¿›å¤šä¸ªåŠŸèƒ½å¼€å‘ï¼Œæé«˜å¼€å‘æ•ˆç‡ã€‚</p><p>å„ä¸ªåˆ†æ”¯åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¦‚æœæŸä¸€ä¸ªåˆ†æ”¯å¼€å‘å¤±è´¥ï¼Œä¸ä¼šå¯¹å…¶ä»–åˆ†æ”¯æœ‰ä»»ä½•å½±å“ã€‚å¤±è´¥çš„åˆ†æ”¯åˆ é™¤é‡æ–°å¼€å§‹å³å¯ã€‚</p><h3 id="2-åˆ†æ”¯åŸºæœ¬æ“ä½œ"><a href="#2-åˆ†æ”¯åŸºæœ¬æ“ä½œ" class="headerlink" title="2. åˆ†æ”¯åŸºæœ¬æ“ä½œ"></a>2. åˆ†æ”¯åŸºæœ¬æ“ä½œ</h3><table><thead><tr><th>å‘½ä»¤åç§°</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>git branch åˆ†æ”¯å</td><td>åˆ›å»ºåˆ†æ”¯</td></tr><tr><td>git branch -v</td><td>æŸ¥çœ‹åˆ†æ”¯</td></tr><tr><td>git checkout åˆ†æ”¯å</td><td>åˆ‡æ¢åˆ†æ”¯</td></tr><tr><td>git merge åˆ†æ”¯å</td><td>æŠŠæŒ‡å®šçš„åˆ†æ”¯åˆå¹¶åˆ°å½“å‰åˆ†æ”¯ä¸Š</td></tr></tbody></table><h4 id="2-1-æŸ¥çœ‹åˆ†æ”¯"><a href="#2-1-æŸ¥çœ‹åˆ†æ”¯" class="headerlink" title="2.1 æŸ¥çœ‹åˆ†æ”¯"></a>2.1 æŸ¥çœ‹åˆ†æ”¯</h4><p>åŸºæœ¬è¯­æ³•ï¼š<code>git branch -v</code></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/fab3df037a60224caf0f127e53de4b1.png"></p><p><code>*</code>ä»£è¡¨å½“å‰æ‰€åœ¨çš„åˆ†æ”¯</p><h4 id="2-2-åˆ›å»ºåˆ†æ”¯"><a href="#2-2-åˆ›å»ºåˆ†æ”¯" class="headerlink" title="2.2 åˆ›å»ºåˆ†æ”¯"></a>2.2 åˆ›å»ºåˆ†æ”¯</h4><p>åŸºæœ¬è¯­æ³•ï¼š<code>git branch åˆ†æ”¯å</code></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/47e47992b7ff1da878bbbfe9b87559c.png"></p><p><strong>åˆšåˆ›å»ºçš„æ–°çš„åˆ†æ”¯ï¼Œå¹¶å°†ä¸»åˆ†æ”¯ master çš„å†…å®¹å¤åˆ¶äº†ä¸€ä»½</strong>ã€‚</p><h4 id="2-3-åˆ‡æ¢åˆ†æ”¯"><a href="#2-3-åˆ‡æ¢åˆ†æ”¯" class="headerlink" title="2.3 åˆ‡æ¢åˆ†æ”¯"></a>2.3 åˆ‡æ¢åˆ†æ”¯</h4><p>åŸºæœ¬è¯­æ³•ï¼š<code>git checkout åˆ†æ”¯å</code></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/f6a55ec01908aa4b7a06b59b51bc26f.png"></p><h3 id="3-åˆå¹¶åˆ†æ”¯-æ­£å¸¸åˆå¹¶"><a href="#3-åˆå¹¶åˆ†æ”¯-æ­£å¸¸åˆå¹¶" class="headerlink" title="3. åˆå¹¶åˆ†æ”¯ (æ­£å¸¸åˆå¹¶)"></a>3. åˆå¹¶åˆ†æ”¯ (æ­£å¸¸åˆå¹¶)</h3><p>åŸºæœ¬è¯­æ³•ï¼š<code>git merge åˆ†æ”¯å</code></p><p>å°†<code>åˆ†æ”¯å</code>åˆå¹¶åˆ°å½“å‰åˆ†æ”¯ã€‚</p><p>åœ¨ master åˆ†æ”¯ä¸Šåˆå¹¶ hot-fix åˆ†æ”¯ï¼ˆå°† hot-fix çš„åˆå¹¶åˆ° masterï¼‰ã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/1e50945d4aa000d22dfca989fc7b0d2.png"></p><h3 id="4-åˆå¹¶åˆ†æ”¯-å†²çªåˆå¹¶"><a href="#4-åˆå¹¶åˆ†æ”¯-å†²çªåˆå¹¶" class="headerlink" title="4. åˆå¹¶åˆ†æ”¯ (å†²çªåˆå¹¶)"></a>4. åˆå¹¶åˆ†æ”¯ (å†²çªåˆå¹¶)</h3><h4 id="4-1-å†²çªäº§ç”Ÿçš„åŸå› "><a href="#4-1-å†²çªäº§ç”Ÿçš„åŸå› " class="headerlink" title="4.1 å†²çªäº§ç”Ÿçš„åŸå› "></a>4.1 å†²çªäº§ç”Ÿçš„åŸå› </h4><p>å¹¶åˆ†æ”¯æ—¶ï¼Œ<strong>å¤šä¸ªåˆ†æ”¯ä¿®æ”¹äº†åŒä¸€ä¸ªæ–‡ä»¶(ä»»ä½•åœ°æ–¹)æˆ–è€…å¤šä¸ªåˆ†æ”¯ä¿®æ”¹äº†åŒä¸€ä¸ªæ–‡ä»¶çš„åç§°</strong>ï¼ˆä»è¯¥æ–‡ä»¶ç¬¬ä¸€è¡Œå¼€å§‹ï¼Œæœ€å…ˆå¼€å§‹ä¸åŒçš„è¡Œåˆ°æœ€åä¸åŒçš„è¡Œä¼šæ‹¬èµ·æ¥ï¼‰ã€‚ Git æ— æ³•æ›¿æˆ‘ä»¬å†³å®šä½¿ç”¨å“ªä¸€ä¸ªï¼Œå› æ­¤ï¼Œå¿…é¡»<strong>äººä¸ºå†³å®š</strong>æ–°ä»£ç å†…å®¹ã€‚</p><p>å¦‚æœä¸¤ä¸ªåˆ†æ”¯ä¸­åˆ†åˆ«ä¿®æ”¹äº†ä¸åŒæ–‡ä»¶ä¸­çš„éƒ¨åˆ†ï¼Œæ˜¯ä¸ä¼šäº§ç”Ÿå†²çªï¼Œç›´æ¥åˆå¹¶å³å¯ã€‚</p><h4 id="4-2-äº§ç”Ÿå†²çª"><a href="#4-2-äº§ç”Ÿå†²çª" class="headerlink" title="4.2 äº§ç”Ÿå†²çª"></a>4.2 äº§ç”Ÿå†²çª</h4><p>ä¿®æ”¹ä¸¤ä¸ªåˆ†æ”¯ï¼Œä¸­åŒä¸€æ–‡ä»¶åŒä¸€è¡Œï¼Œåˆå¹¶ä¸¤ä¸ªåˆ†æ”¯ï¼š</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/eda203702114339268b657212811c5f.png"></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/61073b71dfe7abee793f6b335747116.png"></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/b9218cbf54fd3120e70da480441c654.png"></p><h4 id="4-3-è§£å†³å†²çª"><a href="#4-3-è§£å†³å†²çª" class="headerlink" title="4.3 è§£å†³å†²çª"></a>4.3 è§£å†³å†²çª</h4><p>ç¼–è¾‘æœ‰å†²çªçš„æ–‡ä»¶ï¼Œ<strong>åˆ é™¤ç‰¹æ®Šç¬¦å·</strong>ï¼Œå†³å®šè¦ä½¿ç”¨çš„å†…å®¹ã€‚éšå<code>git add .</code> &amp; <code>git commit -m &quot;message&quot;</code>æ­£å¼åˆå¹¶åˆ†æ”¯ã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/73ccf068132905eee5e42c7ab2e0514.png"></p><h4 id="4-4-åˆ›å»ºåˆ†æ”¯å’Œåˆ‡æ¢åˆ†æ”¯"><a href="#4-4-åˆ›å»ºåˆ†æ”¯å’Œåˆ‡æ¢åˆ†æ”¯" class="headerlink" title="4.4 åˆ›å»ºåˆ†æ”¯å’Œåˆ‡æ¢åˆ†æ”¯"></a>4.4 åˆ›å»ºåˆ†æ”¯å’Œåˆ‡æ¢åˆ†æ”¯</h4><p>masterã€ hot-fix å…¶å®éƒ½æ˜¯æŒ‡å‘å…·ä½“ç‰ˆæœ¬è®°å½•çš„æŒ‡é’ˆã€‚å½“å‰æ‰€åœ¨çš„åˆ†æ”¯ï¼Œå…¶å®æ˜¯ç”± HEAD å†³å®šçš„ã€‚æ‰€ä»¥åˆ›å»ºåˆ†æ”¯çš„æœ¬è´¨å°±æ˜¯å¤šåˆ›å»ºä¸€ä¸ªæŒ‡é’ˆã€‚</p><ul><li>  HEAD å¦‚æœæŒ‡å‘ masterï¼Œé‚£ä¹ˆæˆ‘ä»¬ç°åœ¨å°±åœ¨ master åˆ†æ”¯ä¸Šã€‚</li><li>  HEAD å¦‚æœæ‰§è¡Œ hot-fixï¼Œé‚£ä¹ˆæˆ‘ä»¬ç°åœ¨å°±åœ¨ hot-fix åˆ†æ”¯ä¸Šã€‚</li></ul><p>æ‰€ä»¥åˆ‡æ¢åˆ†æ”¯çš„æœ¬è´¨å°±æ˜¯ç§»åŠ¨ HEAD æŒ‡é’ˆã€‚</p><h3 id="5-è¿œç¨‹åˆ†æ”¯"><a href="#5-è¿œç¨‹åˆ†æ”¯" class="headerlink" title="5. è¿œç¨‹åˆ†æ”¯"></a>5. è¿œç¨‹åˆ†æ”¯</h3><h4 id="5-1-åˆ›å»ºè¿œç¨‹åˆ†æ”¯"><a href="#5-1-åˆ›å»ºè¿œç¨‹åˆ†æ”¯" class="headerlink" title="5.1 åˆ›å»ºè¿œç¨‹åˆ†æ”¯"></a>5.1 åˆ›å»ºè¿œç¨‹åˆ†æ”¯</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">git checkout -b my-test  //åœ¨å½“å‰åˆ†æ”¯ä¸‹åˆ›å»ºmy-testçš„æœ¬åœ°åˆ†æ”¯åˆ†æ”¯<br>git push origin my-test:my-test  //å°†my-teståˆ†æ”¯æ¨é€åˆ°è¿œç¨‹<br>æˆ–<br>git push origin my-test //æœ¬åœ°åˆ†æ”¯å’Œè¿œç¨‹åˆ†æ”¯é‡å<br></code></pre></td></tr></table></figure><p><code>git push origin my-test:my-test</code>å…¶ä¸­ç¬¬ä¸€ä¸ª<code>my-test</code>æ˜¯æœ¬åœ°åˆ†æ”¯åï¼Œç¬¬äºŒä¸ª<code>my-test</code>æ˜¯è¿œç¨‹åˆ†æ”¯å</p><h4 id="5-2-å»ºç«‹æœ¬åœ°åˆ†æ”¯ä¸è¿œç¨‹åˆ†æ”¯çš„è”ç³»"><a href="#5-2-å»ºç«‹æœ¬åœ°åˆ†æ”¯ä¸è¿œç¨‹åˆ†æ”¯çš„è”ç³»" class="headerlink" title="5.2 å»ºç«‹æœ¬åœ°åˆ†æ”¯ä¸è¿œç¨‹åˆ†æ”¯çš„è”ç³»"></a>5.2 å»ºç«‹æœ¬åœ°åˆ†æ”¯ä¸è¿œç¨‹åˆ†æ”¯çš„è”ç³»</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git branch --set-upstream-to=origin/develop develop<br></code></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œ<code>origin</code>æ˜¯è¿œç¨‹ä»“åº“çš„åˆ«åï¼Œç¬¬ä¸€ä¸ª<code>develop</code>æ˜¯è¿œç¨‹åˆ†æ”¯åï¼Œç¬¬äºŒä¸ªæ˜¯<code>debelop</code>æœ¬åœ°åˆ†æ”¯å</p><h4 id="5-3-æŸ¥çœ‹æ‰€æœ‰åˆ†æ”¯"><a href="#5-3-æŸ¥çœ‹æ‰€æœ‰åˆ†æ”¯" class="headerlink" title="5.3 æŸ¥çœ‹æ‰€æœ‰åˆ†æ”¯"></a>5.3 æŸ¥çœ‹æ‰€æœ‰åˆ†æ”¯</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git branch -vv<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/98446cf13d8282318d8127c5e566a82.png"></p><blockquote><p>é»„è‰²æ¡†æ˜¯æœ¬åœ°åˆ†æ”¯åï¼Œç»¿è‰²æ¡†æ˜¯è¿œç¨‹åˆ†æ”¯åã€‚éœ€è¦æ³¨æ„çš„æ˜¯æœ‰äº›æœ¬åœ°åˆ†æ”¯æ²¡æœ‰å…³è”è¿œç¨‹åˆ†æ”¯ã€‚</p></blockquote><h2 id="å››ã€ä½¿ç”¨Github"><a href="#å››ã€ä½¿ç”¨Github" class="headerlink" title="å››ã€ä½¿ç”¨Github"></a>å››ã€ä½¿ç”¨Github</h2><p>å›¢é˜Ÿå†…åä½œ</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/c397bde00d728c4e41eca79f578d25c3.png"></p><p>è·¨å›¢é˜Ÿåä½œ</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/e3069f865cc2d9760801b7a06c9d213b.png"></p><p><a href="https://github.com/">GitHub ç½‘å€</a></p><h3 id="1-åˆ›å»ºè¿œç¨‹åº“"><a href="#1-åˆ›å»ºè¿œç¨‹åº“" class="headerlink" title="1. åˆ›å»ºè¿œç¨‹åº“"></a>1. åˆ›å»ºè¿œç¨‹åº“</h3><p>ç™»é™†åï¼Œç‚¹å‡»åœ¨ç½‘é¡µå³ä¸Šè§’çš„ â€œ+â€ â€“&gt; â€œNew repositoryâ€ï¼Œåˆ›å»ºè¿œç¨‹åº“ã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/3dfd6ad9419bfcef2635e08a5c02e86c.png"></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/3ddd9d9b5ec3b0ab8c238ef66a183d1.png"></p><h4 id="1-1-è¿œç¨‹ä»“åº“æ“ä½œ"><a href="#1-1-è¿œç¨‹ä»“åº“æ“ä½œ" class="headerlink" title="1.1 è¿œç¨‹ä»“åº“æ“ä½œ"></a>1.1 è¿œç¨‹ä»“åº“æ“ä½œ</h4><table><thead><tr><th>å‘½ä»¤åç§°</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>git remote -v</td><td>æŸ¥çœ‹å½“å‰æ‰€æœ‰è¿œç¨‹åœ°å€åˆ«å</td></tr><tr><td>git remote add åˆ«å è¿œç¨‹åœ°å€</td><td>èµ·åˆ«å</td></tr><tr><td>git push åˆ«å åˆ†æ”¯</td><td>æ¨é€æœ¬åœ°åˆ†æ”¯ä¸Šçš„å†…å®¹åˆ°è¿œç¨‹ä»“åº“</td></tr><tr><td>git clone è¿œç¨‹åœ°å€</td><td>å°†è¿œç¨‹ä»“åº“çš„å†…å®¹å…‹éš†åˆ°æœ¬åœ°</td></tr><tr><td>git pull è¿œç¨‹åº“åœ°å€åˆ«å è¿œç¨‹åˆ†æ”¯å</td><td>å°†è¿œç¨‹ä»“åº“å¯¹äºåˆ†æ”¯æœ€æ–°å†…å®¹æ‹‰ä¸‹æ¥åä¸ å½“å‰æœ¬åœ°åˆ†æ”¯ç›´æ¥åˆå¹¶</td></tr></tbody></table><h3 id="2-å…³è”è¿œç¨‹åº“"><a href="#2-å…³è”è¿œç¨‹åº“" class="headerlink" title="2. å…³è”è¿œç¨‹åº“"></a>2. å…³è”è¿œç¨‹åº“</h3><p><strong>åŸºæœ¬è¯­æ³•</strong>ï¼š</p><ul><li>  <code>git remote -v</code> æŸ¥çœ‹å½“å‰æ‰€æœ‰è¿œç¨‹åœ°å€åˆ«å</li><li>  <code>git remote add åˆ«å è¿œç¨‹åœ°å€</code></li></ul><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/682725a20f0d99a4467e2a6cda04ad2.png"></p><p>è¿™ä¸ªåœ°å€åœ¨åˆ›å»ºå®Œè¿œç¨‹ä»“åº“åç”Ÿæˆçš„è¿æ¥ ï¼Œå¦‚å›¾æ‰€ç¤º</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/94534c6c6ba1d748bbfcc87338e38d7.png"></p><h3 id="3-æ¨é€æœ¬åœ°åº“åˆ°è¿œç¨‹åº“"><a href="#3-æ¨é€æœ¬åœ°åº“åˆ°è¿œç¨‹åº“" class="headerlink" title="3. æ¨é€æœ¬åœ°åº“åˆ°è¿œç¨‹åº“"></a>3. æ¨é€æœ¬åœ°åº“åˆ°è¿œç¨‹åº“</h3><p>åŸºæœ¬è¯­æ³•ï¼š<code>git push åˆ«å åˆ†æ”¯</code>  å°†è¯¥åˆ†æ”¯æ¨é€ä¸Šå»</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/7bec3b7357867896ea8f87838591b41.png"></p><h4 id="3-1-git-pushè¯¦è§£"><a href="#3-1-git-pushè¯¦è§£" class="headerlink" title="3.1 git pushè¯¦è§£"></a>3.1 git pushè¯¦è§£</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git push &lt;è¿œç¨‹ä¸»æœºå&gt; &lt;æœ¬åœ°åˆ†æ”¯å&gt;:&lt;è¿œç¨‹åˆ†æ”¯å&gt;<br></code></pre></td></tr></table></figure><p>å¦‚æœæœ¬åœ°åˆ†æ”¯åä¸è¿œç¨‹åˆ†æ”¯åç›¸åŒï¼Œåˆ™å¯ä»¥çœç•¥å†’å·ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git push &lt;è¿œç¨‹ä¸»æœºå&gt; &lt;æœ¬åœ°åˆ†æ”¯å&gt;<br></code></pre></td></tr></table></figure><p>å¦‚æœå½“å‰æœ¬åœ°åˆ†æ”¯å…³è”è¿‡è¿œç¨‹åˆ†æ”¯ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git push<br></code></pre></td></tr></table></figure><h3 id="4-æ‹‰å–è¿œç¨‹åº“åˆ°æœ¬åœ°åº“"><a href="#4-æ‹‰å–è¿œç¨‹åº“åˆ°æœ¬åœ°åº“" class="headerlink" title="4. æ‹‰å–è¿œç¨‹åº“åˆ°æœ¬åœ°åº“"></a>4. æ‹‰å–è¿œç¨‹åº“åˆ°æœ¬åœ°åº“</h3><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“è¿œç¨‹åº“ä¸æœ¬åœ°åº“ä¸ç›¸åŒæ—¶ï¼Œéœ€è¦å…ˆæ‹‰å–è¿œç¨‹åº“ï¼ˆå¦‚æœç›´æ¥pushï¼Œä¼šå‡ºé”™ï¼‰</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/5eca728584bde973a8c9c109f26314c.png"></p><h4 id="4-1-git-pullè¯¦è§£"><a href="#4-1-git-pullè¯¦è§£" class="headerlink" title="4.1 git pullè¯¦è§£"></a>4.1 git pullè¯¦è§£</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git pull &lt;è¿œç¨‹ä¸»æœºå&gt; &lt;è¿œç¨‹åˆ†æ”¯å&gt;:&lt;æœ¬åœ°åˆ†æ”¯å&gt;<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/f4b96f8b373b6e9ff02775e89050c9f.png"></p><p>ä¸»è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>git pull</code>ä¹‹åæŸ¥çœ‹æœ¬åœ°åº“çŠ¶æ€ï¼Œå‘ç°æœ¬åœ°åº“æ˜¯å¹²å‡€çš„ï¼Œè¯´æ˜<code>git pull</code>ä¼šè‡ªåŠ¨<code>git add .</code>å’Œ<code>git commit</code></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/110ae677e2075dabba3ba280b680768.png"></p><h4 id="4-2-æ—¥å¸¸æäº¤ä»£ç åˆ°è¿œç¨‹åº“çš„æµç¨‹"><a href="#4-2-æ—¥å¸¸æäº¤ä»£ç åˆ°è¿œç¨‹åº“çš„æµç¨‹" class="headerlink" title="4.2 æ—¥å¸¸æäº¤ä»£ç åˆ°è¿œç¨‹åº“çš„æµç¨‹"></a>4.2 æ—¥å¸¸æäº¤ä»£ç åˆ°è¿œç¨‹åº“çš„æµç¨‹</h4><p>æ—¥å¸¸æäº¤ä»£ç åˆ°è¿œç¨‹åº“çš„æµç¨‹å¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">git add -A           #éœ€è¦æ·»åŠ åˆ°ç‰ˆæœ¬åº“ä¸­çš„æ–‡ä»¶ -A å°±ä»£è¡¨ç€æ‰€æœ‰æ–‡ä»¶(é™¤å¼€äº† .gitignoreå¿½ç•¥æ‰çš„æ–‡ä»¶)<br>git commit -m &#x27;æœ¬æ¬¡æäº¤çš„å¤‡æ³¨&#x27;<br>git pull            #å°†è¿œç¨‹çš„åº“å’Œæœ¬åœ°çš„åº“ç‰ˆæœ¬åŒæ­¥ä¸€ä¸‹,å› ä¸ºè¿œç¨‹åº“å¯èƒ½å‘ç”Ÿäº†ä¿®æ”¹(å¤šäººåˆä½œå¼€å‘æ—¶)<br>git push  <br></code></pre></td></tr></table></figure><p>è¿™æ ·æ“ä½œçš„å‰ææ˜¯æœ¬åœ°è¿œç¨‹éƒ½æ˜¯åŒä¸€ä¸ªåˆ†æ”¯ä¸Š</p><h4 id="4-3-ä¸ºä»€ä¹ˆåœ¨git-pushå‰éœ€è¦å…ˆgit-pullå‘¢ï¼Ÿ"><a href="#4-3-ä¸ºä»€ä¹ˆåœ¨git-pushå‰éœ€è¦å…ˆgit-pullå‘¢ï¼Ÿ" class="headerlink" title="4.3 ä¸ºä»€ä¹ˆåœ¨git pushå‰éœ€è¦å…ˆgit pullå‘¢ï¼Ÿ"></a>4.3 ä¸ºä»€ä¹ˆåœ¨git pushå‰éœ€è¦å…ˆgit pullå‘¢ï¼Ÿ</h4><ol><li>æœ¬åœ°å’Œè¿œç¨‹çš„å…³ç³»ç›¸å½“äºä¸¤ä¸ªåˆ†æ”¯,ä½ æ„Ÿè§‰ä¸€æ ·æ˜¯å› ä¸ºä½ <code>git pull</code> çš„æ—¶å€™å·²ç»è‡ªåŠ¨ç»™ç»‘å®šå¥½å¯¹åº”å…³ç³»äº†, set-upstream..balbala</li><li>ä½ è¿œç¨‹æ–°å»ºäº†ä¸€ä¸ªåˆ†æ”¯æ‹‰åˆ°æœ¬åœ°çš„é“ç†æ˜¯ä¸€æ ·çš„,å±äºå¤åˆ¶äº†ä¸€ä»½,ä½†æ˜¯æœ¬åœ°åˆ†æ”¯å’Œè¿œç¨‹åˆ†æ”¯å·²ç»æ˜¯ä¸¤ä¸ªä¸œè¥¿äº†</li><li>æœ¬åœ°åˆ†æ”¯å±äºæœ¬åœ°ä»“åº“é‡Œ,æ˜¯åŒ…å«å…³ç³»,ä¸€ä¸ªä»“åº“é‡Œå¯ä»¥æœ‰å¾ˆå¤šåˆ†æ”¯, å¦‚æœæ˜¯ tag çš„è¯å¯ä»¥åˆ†ç¦»å‡ºç‹¬ç«‹çš„ä»“åº“</li><li>è‚¯å®šä¸ä¼šå…¨é‡æ¨é€åˆ°è¿œç¨‹çš„,æ˜¯é€šè¿‡å¯¹æ¯” commit çš„è®°å½•,å¦‚æœæœ¬åœ°é«˜äºè¿œç¨‹å°±ç›´æ¥æŠŠå¤šå‡ºæ¥çš„<code>commit</code> ç»™æ€¼ä¸Šå»,å¦‚æœæœ¬åœ°çš„è¿™å‡ ä¸ª <code>commit</code> å’Œè¿œç¨‹çš„ <code>commit</code> æœ‰å†²çªçš„éƒ¨åˆ†å°±<code>merge</code>,ç„¶åæ ¹æ®æäº¤æ—¶é—´æ’åºå†æ–°å»ºä¸€ä¸ªmerge çš„ commit è®°å½•å†æ€¼ä¸Šå»</li><li>è¿™ä¸ªå…ˆ commit å† pull å† push çš„æƒ…å†µå°±æ˜¯ä¸ºäº†åº”å¯¹å¤šäººåˆå¹¶å¼€å‘çš„æƒ…å†µ,<ol><li><code>commit</code> æ˜¯ä¸ºäº†å‘Šè¯‰ git æˆ‘è¿™æ¬¡æäº¤æ”¹äº†å“ªäº›ä¸œè¥¿,ä¸ç„¶ä½ åªæ˜¯æ”¹äº†ä½†æ˜¯ git ä¸çŸ¥é“ä½ æ”¹äº†,ä¹Ÿå°±æ— ä»åˆ¤æ–­æ¯”è¾ƒ;</li><li><code>pull</code>æ˜¯ä¸ºäº†æœ¬åœ° commit å’Œè¿œç¨‹commit çš„å¯¹æ¯”è®°å½•,git æ˜¯æŒ‰ç…§æ–‡ä»¶çš„è¡Œæ•°æ“ä½œè¿›è¡Œå¯¹æ¯”çš„,å¦‚æœåŒæ—¶æ“ä½œäº†æŸæ–‡ä»¶çš„åŒä¸€è¡Œé‚£ä¹ˆå°±ä¼šäº§ç”Ÿå†²çª,git ä¹Ÿä¼šæŠŠè¿™ä¸ªå†²çªç»™æ ‡è®°å‡ºæ¥,è¿™ä¸ªæ—¶å€™å°±éœ€è¦å…ˆæŠŠå’Œä½ å†²çªçš„é‚£ä¸ªäººæ‹‰è¿‡æ¥é—®é—®ä¿ç•™è°çš„ä»£ç ,ç„¶ååœ¨ <code>git add &amp;&amp; git commit &amp;&amp; git pull</code> è¿™ä¸‰è¿,å†æ¬¡ pull ä¸€æ¬¡æ˜¯ä¸ºäº†é˜²æ­¢å†ä½ ä»¬åå•†çš„æ—¶å€™å¦ä¸€ä¸ªäººç»™åˆæäº¤äº†ä¸€ç‰ˆä¸œè¥¿,å¦‚æœçœŸå‘ç”Ÿäº†é‚£æµç¨‹é‡å¤ä¸€é,é€šå¸¸æ²¡æœ‰å†²çªçš„æ—¶å€™å°±ç›´æ¥ç»™ä½ åˆå¹¶äº†,ä¸ä¼šæŠŠä½ çš„ä»£ç ç»™è¦†ç›–æ‰</li><li>å‡ºç°ä»£ç è¦†ç›–æˆ–è€…ä¸¢å¤±çš„æƒ…å†µ:æ¯”å¦‚A Bä¸¤äººçš„ä»£ç pull æ—¶å€™çš„ç‰ˆæœ¬éƒ½æ˜¯1,Aåœ¨æœ¬åœ°æäº¤äº†2,3å¹¶ä¸”æ¨é€åˆ°è¿œç¨‹äº†,B è¿›è¡Œä¿®æ”¹çš„æ—¶å€™æ²¡æœ‰<code>commit</code> æ“ä½œ,ä»–å…ˆè‡ªå·±å†™äº†ä¸œè¥¿,ç„¶å <code>git pull</code> è¿™ä¸ªæ—¶å€™ B æœ¬åœ°ç‰ˆæœ¬å·²ç»åˆ°3äº†,B åœ¨æœ¬åœ°ç‰ˆæœ¬3çš„æ—¶å€™æ”¹äº† A å†™è¿‡çš„ä»£ç ,å†è¿›è¡Œäº†<code>git commit &amp;&amp; git push</code> é‚£ä¹ˆåœ¨è¿œç¨‹ç‰ˆæœ¬ä¸­å°±æ˜¯4,è€Œä¸” A çš„ä»£ç è¢«è¦†ç›–äº†,æ‰€ä»¥è¯´æ‰€æœ‰äººéƒ½è¦å…ˆ commit å† pull,ä¸ç„¶çœŸçš„ä¼šè¦†ç›–ä»£ç çš„<strong>ç»è¿‡æœ¬äººäº²è‡ªå®éªŒï¼Œè¿™ç§æƒ…å†µä¸ä¼šå‘ç”Ÿä»£ç è¦†ç›–é—®é¢˜</strong></li></ol></li><li>ä¸¤ä¸ªäº’ç›¸åˆå¹¶çš„å”¯ä¸€åŒºåˆ«å°±æ˜¯ A-&gt;B çš„æ—¶å€™ B åˆ†æ”¯ä¸Šä¼šäº§ç”Ÿä¸€ä¸ª merge_commit çš„ä¿¡æ¯,è¿™ä¸ªæ—¶å€™ B æ˜¯åˆå¹¶çŠ¶æ€è€Œ A æœªåˆå¹¶çŠ¶æ€,å¦‚æœç°åœ¨<strong>æ²¡æœ‰å‘ç”Ÿä»»ä½•æ”¹åŠ¨</strong>æ‰§è¡Œ B-&gt;A å°±ç›´æ¥åˆ‡æ¢è¿‡å»äº†,è¿ merge_commit éƒ½ä¸ä¼šç”Ÿæˆäº†</li></ol><p><strong>è¿™åˆå¹¶çš„æ—¶å€™å‘ç”Ÿäº†ä»€ä¹ˆ?</strong></p><p>æ¯”å¦‚ä½ ä»ä¸€ä¸ªgit logä¸º<code>1,2,3,4,5,6</code>çš„è¿œç¨‹åº“æ‹‰å–åˆ°äº†æœ¬åœ°, å¦ä¸€ä¸ªåŒäº‹ä¹Ÿæ‹‰å–äº†åŒæ ·çš„ä»£ç ,è€Œä¸”ä½ çš„åŒäº‹å…ˆäºä½ æäº¤åˆ°è¿œç¨‹äº†, æ­¤æ—¶<strong>è¿œç¨‹</strong>çš„ç‰ˆæœ¬æ˜¯<code>1,2,3,4,5,6,7_new,8_new</code>, è€Œä½ å½“å‰åªæ˜¯<strong>æœ¬åœ°</strong>çš„ç‰ˆæœ¬<code>1,2,3,4,5,6,7_local,8_local,9_local</code> ä»è¿™é‡Œä½ å°±èƒ½çœ‹å‡ºä½ å‰ä¸€éƒ¨åˆ†å’Œ<strong>è¿œç¨‹</strong>çš„ä¸€æ ·,åä¸€éƒ¨åˆ†å’Œ<strong>è¿œç¨‹</strong>çš„ä¸ä¸€æ ·, è¿™ä¸ªæ—¶å€™ä½ ä¸èƒ½æ­£å¸¸æ¨é€ä¸Šå»çš„,å¦‚æœä½ é‡‡å–<code>git push origin master --force</code> é‚£ä¹ˆ<strong>è¿œç¨‹</strong>çš„ç‰ˆæœ¬å°±å˜æˆäº†<code>1,2,3,4,5,6,7_local,8_local,9_local</code> ä¹‹å‰ä½ åŒäº‹æ¨é€çš„<code>7_new,8_new</code>è¿™ä¸¤æ¬¡æ¨é€è¢«è¦†ç›–äº†,è¿™ä¸æ˜¯å¤§å®¶æƒ³è¦çš„æƒ…å†µ å› æ­¤éœ€è¦<code>git pull</code>æ¥å°†<strong>æœ¬åœ°</strong>çš„ç‰ˆæœ¬åˆå¹¶æˆæ · <code>1,2,3,4,5,6,7_new,7_local,8_local,8_new,9_local,10_commit_merge</code> è¿œç¨‹å’Œ<strong>æœ¬åœ°</strong>çš„æ’åºæ˜¯æŒ‰å½“æ—¶ <code>commit</code> çš„æ—¶é—´æ¥æ’çš„,æœ€åä¸€ä¸ª<code>10_commit_merge</code>å°±æ˜¯ä½ <strong>æœ¬åœ°</strong>å’Œ<strong>è¿œç¨‹</strong>åˆå¹¶çš„æ ‡å¿—,æœ€åä½ æ¨é€åˆ°è¿œç¨‹ä»“åº“çš„åº”è¯¥ä¹Ÿæ˜¯è¿™ä¸ª, å› ä¸ºä½ ä»¬æ“ä½œçš„æ˜¯åŒä¸€ä¸ªåº“å§‹ç»ˆè¦ä¿æŒä»£ç çš„åŒæ­¥,æ‰€ä»¥ä¸€æ—¦ç‰ˆæœ¬åº“å‘ç”Ÿæ”¹åŠ¨åŒä¸€åˆ†æ”¯ä¸‹çš„æ‰€æœ‰äººéƒ½è¦è·Ÿç€å»åŒæ­¥ä»–,å› ä¸ºå„å¼€å‘å„çš„ç›´æ¥å¾€ä¸Šæ¨ git è¿˜æ²¡æ™ºèƒ½åˆ°å¸®ä½ å¤„ç†å†²çªçš„åœ°æ­¥ </p><h3 id="5-å…‹éš†è¿œç¨‹åº“åˆ°æœ¬åœ°"><a href="#5-å…‹éš†è¿œç¨‹åº“åˆ°æœ¬åœ°" class="headerlink" title="5. å…‹éš†è¿œç¨‹åº“åˆ°æœ¬åœ°"></a>5. å…‹éš†è¿œç¨‹åº“åˆ°æœ¬åœ°</h3><p>åŸºæœ¬è¯­æ³•ï¼š<code>git clone è¿œç¨‹åœ°å€</code>åœ¨è¿œç¨‹åº“è·å–åœ°å€ URL</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼šè¿œç¨‹åœ°å€å¦‚æœæ˜¯httpsæ ¼å¼çš„ï¼Œä»»ä½•äººéƒ½å¯ä»¥å…‹éš†ã€‚è¿œç¨‹åœ°å€å¦‚æœæ˜¯sshå½¢å¼çš„ï¼Œåªæœ‰é¡¹ç›®çš„å‚ä¸è€…æ‰å¯ä»¥å…‹éš†ã€‚åœ¨gitä¸­cloneé¡¹ç›®æœ‰ä¸¤ç§æ–¹å¼ï¼šHTTPSå’ŒSSHï¼Œå®ƒä»¬çš„åŒºåˆ«å¦‚ä¸‹ï¼š HTTPSï¼šä¸ç®¡æ˜¯è°ï¼Œæ‹¿åˆ°urléšä¾¿cloneï¼Œä½†æ˜¯åœ¨pushçš„æ—¶å€™éœ€è¦éªŒè¯ç”¨æˆ·åå’Œå¯†ç ï¼› SSHï¼šcloneçš„é¡¹ç›®ä½ å¿…é¡»æ˜¯æ‹¥æœ‰è€…æˆ–è€…ç®¡ç†å‘˜ï¼Œè€Œä¸”éœ€è¦åœ¨cloneå‰æ·»åŠ SSH Keyã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/bed545d3938cde21c57c8f86ffcfffd.png"></p><p>å…‹éš†å®Œæˆåï¼ŒæŸ¥çœ‹è¿œç¨‹ä»“åº“åˆ«åï¼Œå’Œåˆ†æ”¯å¯¹åº”æƒ…å†µï¼š</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/d75f5d9b4a0889a1f2aca32b259d3c3.png"></p><p>clone ä¼šåšå¦‚ä¸‹æ“ä½œï¼š</p><ol><li> æ‹‰å–ä»£ç ã€‚</li><li> åˆå§‹åŒ–æœ¬åœ°ä»“åº“ã€‚</li><li> åˆ›å»ºåˆ«åã€‚</li><li> åˆ›å»ºå¯¹åº”åˆ†æ”¯</li></ol><h3 id="6-å›¢é˜Ÿå†…åä½œ"><a href="#6-å›¢é˜Ÿå†…åä½œ" class="headerlink" title="6. å›¢é˜Ÿå†…åä½œ"></a>6. å›¢é˜Ÿå†…åä½œ</h3><p>ä¸€ã€é€‰æ‹©é‚€è¯·åˆä½œè€…ã€‚ï¼ˆåœ¨ä»“åº“è®¾ç½®é‡Œæ“ä½œï¼‰</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/945f1ba6e29fb725ee0d852ff59c3851.png"></p><p>äºŒã€å¡«å…¥ç›®æ ‡åˆä½œè€…ã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/ee1b6a6656efe2adbb740b38954529b9.png"></p><p>ä¸‰ã€å¤åˆ¶ç½‘å€å‘é€ç»™ä½ ç›®æ ‡åˆä½œè€… ï¼Œ å¤åˆ¶å†…å®¹å¦‚ä¸‹ï¼š<a href="https://github.com/atguiguyueyue/git-shTest/invitations%E3%80%82">https://github.com/atguiguyueyue/git-shTest/invitationsã€‚</a></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/0f5ec0155e64421d315594aa537fd187.png"></p><p>å››ã€ç›®æ ‡åˆä½œè€…æ¥æ”¶åˆ°ç½‘å€ï¼Œç”¨æµè§ˆå™¨æ‰“å¼€å®ƒï¼Œç‚¹å‡»æ¥å—é‚€è¯·ã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/295a2398e0a3150d50530d5db21103aa.png"></p><p>äº”ã€æ¥å—é‚€è¯·æˆåŠŸä¹‹åï¼Œå¯ä»¥åœ¨ç›®æ ‡åˆä½œè€… Github è´¦å·ä¸Šçœ‹åˆ°å°†æ¥å…±åŒå¼€å‘è¿œç¨‹ä»“åº“ã€‚</p><p>å…­ã€ç›®æ ‡åˆä½œè€…å¯ä»¥ä¿®æ”¹å†…å®¹å¹¶ push åˆ°è¿œç¨‹ä»“åº“ã€‚</p><p>ä¸ƒã€å›åˆ°å‘é€åˆä½œé‚€è¯·è€…çš„ GitHub è¿œç¨‹ä»“åº“ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæœ€åä¸€æ¬¡æ˜¯ç›®æ ‡åˆä½œè€…æäº¤çš„ã€‚</p><h3 id="7-è·¨å›¢é˜Ÿåä½œ"><a href="#7-è·¨å›¢é˜Ÿåä½œ" class="headerlink" title="7. è·¨å›¢é˜Ÿåä½œ"></a>7. è·¨å›¢é˜Ÿåä½œ</h3><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/e3069f865cc2d9760801b7a06c9d213b.png"></p><p>ä¸€ã€å°†è¿œç¨‹ä»“åº“çš„åœ°å€å¤åˆ¶å‘ç»™é‚€è¯·è·¨å›¢é˜Ÿåä½œçš„äººï¼Œæ¯”å¦‚ä¸œæ–¹ä¸è´¥ã€‚</p><p>äºŒã€åœ¨ä¸œæ–¹ä¸è´¥çš„ GitHub è´¦å·é‡Œçš„åœ°å€æ å¤åˆ¶æ”¶åˆ°çš„é“¾æ¥ï¼Œç„¶åç‚¹å‡» ç½‘é¡µå³ä¸Šæ–¹çš„ Fork æŒ‰é’®ï¼Œå°†é¡¹ç›®å‰åˆ°è‡ªå·±çš„æœ¬åœ°ä»“åº“ã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/4856e4845a7f0dbb54c79bd804892f5e.png"></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/c641d9ba65f20ba58d3f98ec792ae0e5.png"></p><p>forkæˆåŠŸåå¯ä»¥çœ‹åˆ°å½“å‰ä»“åº“ä¿¡æ¯ã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/3078d75badb2fd393dbe172327dc094c.png"></p><p>ä¸‰ã€ä¸œæ–¹ä¸è´¥å°±å¯ä»¥åœ¨çº¿ç¼–è¾‘forkè¿‡æ¥çš„æ–‡ä»¶ã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/40aa522895eb04a6c203a9bcbca25005.png"></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/eb19249416069d158e2b4280a679063f.png"></p><p>å››ã€ç¼–è¾‘å®Œæ¯•åï¼Œå¡«å†™æè¿°ä¿¡æ¯å¹¶ç‚¹å‡»å·¦ä¸‹è§’ç»¿è‰²æŒ‰é’®æäº¤ã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/c87379a8a91eb65e2961475129362da4.png"></p><p>äº”ã€æ¥ä¸‹æ¥ç‚¹å‡»ä¸Šæ–¹çš„ Pull è¯·æ±‚ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªæ–°çš„è¯·æ±‚ã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/8bdb52dc24df07d8d846a4fe19985908.png"></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/9c2f07c7ba5586e3923ba870a37c856d.png"></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/996007e8e9fee91ef37af6818e164139.png"></p><p>å…­ã€å›åˆ°å²³å²³ GitHub è´¦å·å¯ä»¥çœ‹åˆ°æœ‰ä¸€ä¸ª Pull request è¯·æ±‚ã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/c634b139396001cb2fcb64b8e2a078e1.png"></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/d666e1f3544c07821e85b602d0beffc5.png"></p><p>è¿›å…¥åˆ°èŠå¤©å®¤ï¼Œå¯ä»¥è®¨è®ºä»£ç ç›¸å…³å†…å®¹ã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/3d97452ea50fffca42ec29308c842692.png"></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/9c477d95ea98448b966264bdae235b64.png"></p><p>ä¸ƒã€å¦‚æœä»£ç æ²¡æœ‰é—®é¢˜ï¼Œå¯ä»¥ç‚¹å‡» Merge pull reque åˆå¹¶ä»£ç ã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/894bdb75678d7793e92f1099e5c1d080.png"></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/2964db9c2239859ee59c4bfb9fb25513.png"></p><h3 id="8-SSH-å…å¯†ç™»å½•"><a href="#8-SSH-å…å¯†ç™»å½•" class="headerlink" title="8. SSH å…å¯†ç™»å½•"></a>8. SSH å…å¯†ç™»å½•</h3><p><strong>sshé…ç½®åªæ˜¯çœå»äº†è¾“å…¥githubè´¦å·å¯†ç çš„è¿™ä¸€æ­¥æ“ä½œï¼Œæ‰€ä»¥è·Ÿgithubä»“åº“å…³ç³»ä¸å¤§ï¼Œè·Ÿgithubè´¦å·å…³ç³»å¤§</strong></p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿œç¨‹ä»“åº“ä¸­è¿˜æœ‰ä¸€ä¸ª SSH çš„åœ°å€ï¼Œå› æ­¤æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ SSH è¿›è¡Œè®¿é—®ã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/197d6964ccfb06f1eaf22f795061826d.png"></p><p>å…ˆåˆ°ç”¨æˆ·çš„ä¸»é¡µç›®å½•ï¼Œè¿è¡Œå‘½ä»¤ ssh-keygen ç”Ÿæˆ. ssh ç›®å½•ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ssh-keygen -t rsa -C &quot;604713431@qq.com&quot;<br></code></pre></td></tr></table></figure><p><code>-t rsa</code>æ˜¯ä½¿ç”¨éå¯¹ç§°åŠ å¯†åè®®<code>rsa</code>ï¼Œ<code>-C &quot;****&quot;</code>æ˜¯æ³¨é‡Šã€‚</p><p>åœ¨å®¶ç›®å½•ä¸‹ç”Ÿæˆäº†<code>id_rsa</code>æ˜¯ç§é’¥ï¼Œæ”¾åœ¨æœ¬åœ°ï¼›<code>id_rsa.pub</code>æ˜¯å…¬é’¥ï¼Œæ”¾åœ¨æœåŠ¡å™¨ã€‚</p><p>ç„¶åï¼Œå°†ç”Ÿæˆçš„å…¬é’¥æ·»åŠ è‡³ Github è´¦å· SSH è®¾ç½®</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/2d213036d44d57f07ad75b23d20871ea.png"></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/0a6a75ce73adad73a535947dce7fa525.png"></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/0c2f4dd9ef30bdc8c47ae59e50b8851b.png"></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/1f54c4dccd3d8a17e909042c28181fb6.png"></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/0ad893fd8447ac90ed0ee7ceafdf582e.png"></p><p>æ·»åŠ å…¬é’¥åï¼Œä½¿ç”¨sshæ–¹æ³•å¯ä¸ç”¨è¾“å…¥ Github è´¦å·å¯†ç ä¾¿å¯<code>push</code>æˆ–è€…<code>pull</code>ã€‚</p><h2 id="äº”ã€IDEAé›†æˆGit"><a href="#äº”ã€IDEAé›†æˆGit" class="headerlink" title="äº”ã€IDEAé›†æˆGit"></a>äº”ã€IDEAé›†æˆGit</h2><p>åœ¨IDEAä¸­ï¼Œçº¢è‰²è¡¨ç¤ºæ–‡ä»¶æ–°åˆ›å»ºå¹¶æœªè¢«<code>add</code>æäº¤åˆ°æš‚å­˜åŒºï¼Œç»¿è‰²ä»£è¡¨æ–‡ä»¶æœªè¢«<code>commit</code>æäº¤åˆ°æœ¬åœ°ç‰ˆæœ¬åº“ï¼Œè“è‰²ä»£è¡¨æ–‡ä»¶è¢«ä¿®æ”¹äº†ï¼Œéœ€è¦é‡æ–°<code>add &amp; commit</code>(æ­¤å¤„ä¹Ÿå¯ä»¥ç›´æ¥<code>commit</code>)ï¼ˆä½†æ˜¯ä¹‹å‰è¢«<code>add &amp; commit</code>è¿‡ï¼‰ã€‚</p><p><code>git log</code>ä¸­ç»¿è‰²æ ‡ç­¾ä»£è¡¨åˆ†æ”¯ï¼Œé»„è‰²æ ‡ç­¾ä»£è¡¨<code>HEAD</code>å¤´æŒ‡é’ˆã€‚</p><h3 id="1-é…ç½®-Git-å¿½ç•¥æ–‡ä»¶"><a href="#1-é…ç½®-Git-å¿½ç•¥æ–‡ä»¶" class="headerlink" title="1. é…ç½® Git å¿½ç•¥æ–‡ä»¶"></a>1. é…ç½® Git å¿½ç•¥æ–‡ä»¶</h3><p>ä¸é¡¹ç›®çš„å®é™…åŠŸèƒ½æ— å…³ï¼Œä¸å‚ä¸æœåŠ¡å™¨ä¸Šéƒ¨ç½²è¿è¡Œã€‚æŠŠå®ƒä»¬å¿½ç•¥æ‰èƒ½å¤Ÿå±è”½ IDE å·¥å…·ä¹‹é—´çš„å·®å¼‚ã€‚ä¾‹å¦‚ï¼ŒMaven å·¥ç¨‹æ ¹æ® src ç”Ÿæˆçš„ targetã€‚</p><p>åˆ›å»ºå¿½ç•¥è§„åˆ™æ–‡ä»¶ xxxx.ignoreï¼ˆå‰ç¼€åéšä¾¿èµ·ï¼Œå»ºè®®æ˜¯ git.ignoreï¼‰ï¼Œè¿™ä¸ªæ–‡ä»¶çš„å­˜æ”¾ä½ç½®åŸåˆ™ä¸Šåœ¨å“ªé‡Œéƒ½å¯ä»¥ï¼Œä¸ºäº†ä¾¿äºè®©~/.gitconfig æ–‡ä»¶å¼•ç”¨ï¼Œ<strong>å»ºè®®</strong>ä¹Ÿæ”¾åœ¨ç”¨æˆ·å®¶ç›®å½•ä¸‹ã€‚</p><p>git.ignore æ–‡ä»¶æ¨¡ç‰ˆå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli"><span class="hljs-comment"># Compiled class file</span><br>*<span class="hljs-string">.class</span><br><br><span class="hljs-comment"># Log file</span><br>*<span class="hljs-string">.log</span><br><br><span class="hljs-comment"># BlueJ files</span><br>*<span class="hljs-string">.ctxt</span><br><br><span class="hljs-comment"># Mobile Tools for Java (J2ME)</span><br><span class="hljs-string">.mtj.tmp/</span><br><br><span class="hljs-comment"># Package Files #</span><br>*<span class="hljs-string">.jar</span><br>*<span class="hljs-string">.war</span><br>*<span class="hljs-string">.nar</span><br>*<span class="hljs-string">.ear</span><br>*<span class="hljs-string">.zip</span><br>*<span class="hljs-string">.tar.gz</span><br>*<span class="hljs-string">.rar</span><br><br><span class="hljs-comment"># virtual machine crash logs, see http://www.java.com/en/download/help/error_hotspot.xml</span><br>hs_err_pid*<br><span class="hljs-string">.classpath</span><br><span class="hljs-string">.project</span><br><span class="hljs-string">.settings</span><br>target<br><span class="hljs-string">.idea</span><br>*<span class="hljs-string">.iml</span><br><br></code></pre></td></tr></table></figure><p>åœ¨. gitconfig æ–‡ä»¶ä¸­å¼•ç”¨å¿½ç•¥é…ç½®æ–‡ä»¶ï¼ˆæ­¤æ–‡ä»¶åœ¨ Windows çš„å®¶ç›®å½•ä¸­ï¼‰</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[user]</span><br>    <span class="hljs-attr">name</span> = Layne<br>    <span class="hljs-attr">email</span> = Layne@atguigu.com<br><span class="hljs-section">[core]</span><br><span class="hljs-attr">excludesfile</span> = C:/Users/asus/git.ignore<br><br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼šè¿™é‡Œè¦ä½¿ç”¨ â€œæ­£æ–œçº¿ï¼ˆ/ï¼‰â€ï¼Œä¸è¦ä½¿ç”¨ â€œåæ–œçº¿ï¼ˆ\ï¼‰â€</p><h3 id="2-åœ¨-IDEA-é…ç½®-Git-ç¨‹åº"><a href="#2-åœ¨-IDEA-é…ç½®-Git-ç¨‹åº" class="headerlink" title="2. åœ¨ IDEA é…ç½® Git ç¨‹åº"></a>2. åœ¨ IDEA é…ç½® Git ç¨‹åº</h3><p>åœ¨èœå•æ  File-&gt;Setting-&gt; æœç´¢æ æœ Gitï¼Œé…ç½® Git çš„å®‰è£…è·¯å¾„ã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/d86ae18c01b9a08bc73f02aa6c1b3708.png"></p><h3 id="3-IDEAåˆå§‹åŒ–-Git"><a href="#3-IDEAåˆå§‹åŒ–-Git" class="headerlink" title="3. IDEAåˆå§‹åŒ– Git"></a>3. IDEAåˆå§‹åŒ– Git</h3><p>å…ˆåˆ›å»ºä¸€ä¸ªåå« HelloGit çš„ Maven å·¥ç¨‹ã€‚</p><p>åœ¨èœå•æ  VCS -&gt; Import into Version Control -&gt; Create Git Repository</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/4bbfb1e76fb25655b3fe6900bb29ea47.png"></p><p>é€‰æ‹©è¦åˆ›å»º Git æœ¬åœ°ä»“åº“çš„å·¥ç¨‹ï¼Œä¹Ÿå°±æ˜¯ HelloGit å·¥ç¨‹ï¼Œç„¶åæ·»åŠ  OKã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/5dc609978787f3e5a83dbdf954a3e039.png"></p><h3 id="4-æ·»åŠ åˆ°æš‚å­˜åŒº-1"><a href="#4-æ·»åŠ åˆ°æš‚å­˜åŒº-1" class="headerlink" title="4. æ·»åŠ åˆ°æš‚å­˜åŒº"></a>4. æ·»åŠ åˆ°æš‚å­˜åŒº</h3><p>åˆ›å»ºä¸€ä¸ª HelloGit ç±»ï¼Œå°†å…¶æ·»åŠ  Git æš‚å­˜åŒºã€‚</p><p>å³é”®ç‚¹å‡» HelloGit ç±»ï¼Œé€‰æ‹© Git-&gt;Addã€‚å¯ä»¥å³é”®ç‚¹å‡» HelloGité¡¹ç›®æ ¹ç›®å½•ï¼Œæ›´å¤§èŒƒå›´åœ°æ·»åŠ æ–‡ä»¶åˆ°æš‚å­˜åŒºã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/9ec5087e543611c5ac99b171277f590.png"></p><p>æ·»åŠ æˆåŠŸåï¼Œæ–‡ä»¶åä¼šä»çº¢è‰²å˜æˆç»¿è‰²ã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/ec95c2b0b99d1f3a0ac8ad3291fdde50.png"></p><h3 id="5-æäº¤è‡³æœ¬åœ°åº“"><a href="#5-æäº¤è‡³æœ¬åœ°åº“" class="headerlink" title="5. æäº¤è‡³æœ¬åœ°åº“"></a>5. æäº¤è‡³æœ¬åœ°åº“</h3><p>å³é”®ç‚¹å‡» HelloGitï¼Œé€‰æ‹© Git-&gt;Commit Directoryã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/9a73d7bbac024bfe61951662f5bf6ded.png"></p><p>æ·»åŠ æ³¨é‡Šåæäº¤ï¼š</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/281c7f26319b59e7584103c2a3ee88dd.png"></p><p>æ·»åŠ æˆåŠŸåï¼Œåå°æ‰“å°ç›¸å…³ä¿¡æ¯ã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/3bdf7a9135d3ae80b9aad4d678626491.png"></p><h3 id="6-åˆ‡æ¢ç‰ˆæœ¬"><a href="#6-åˆ‡æ¢ç‰ˆæœ¬" class="headerlink" title="6. åˆ‡æ¢ç‰ˆæœ¬"></a>6. åˆ‡æ¢ç‰ˆæœ¬</h3><p>åœ¨ IDEA çš„å·¦ä¸‹è§’ï¼Œç‚¹å‡» Gitï¼Œç„¶åç‚¹å‡» Log æŸ¥çœ‹ç‰ˆæœ¬</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/69e6670ea5681781c173f1c86864ae1e.png"></p><p>å³é”®é€‰æ‹©è¦åˆ‡æ¢çš„ç‰ˆæœ¬ï¼Œç„¶ååœ¨èœå•é‡Œç‚¹å‡» Checkout Revisionã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/5530ac3d829954cebd23ed15a681769f.png"></p><h3 id="7-åˆ›å»ºåˆ†æ”¯"><a href="#7-åˆ›å»ºåˆ†æ”¯" class="headerlink" title="7. åˆ›å»ºåˆ†æ”¯"></a>7. åˆ›å»ºåˆ†æ”¯</h3><p>å³é”®ç‚¹å‡» HelloGitï¼ŒGit -&gt; Repository -&gt; Branchesï¼Œæˆ–è€…ç‚¹å‡» IDEA çš„å³ä¸‹è§’ï¼Œå¦‚å›¾çº¢åœˆæ‰€ç¤ºéƒ¨ä½ï¼š</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/3e31e84cd2f7b5b95bb2639abcb1804f.png"></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/c7544c1bade118b3177907ad903a8082.png"></p><p>é€‰æ‹©ç‚¹å‡» New Branchï¼š</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/b9c18ec9924788adfa432b7b924308ce.png"></p><p>åˆ›å»ºæ–°åˆ†æ”¯ï¼š</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/8a4a5e7cf7511d086ddac0be704e850f.png"></p><h3 id="8-åˆ‡æ¢åˆ†æ”¯"><a href="#8-åˆ‡æ¢åˆ†æ”¯" class="headerlink" title="8. åˆ‡æ¢åˆ†æ”¯"></a>8. åˆ‡æ¢åˆ†æ”¯</h3><p>è·Ÿ<strong>åˆ›å»ºåˆ†æ”¯</strong>æ­¥éª¤ç›¸ä¼¼ï¼Œå¦‚ç‚¹å‡» IDEA çš„å³ä¸‹è§’ï¼ˆå®ƒæ˜¾ç¤ºé¡¹ç›®æ­£å¤„åœ¨é‚£æ¡åˆ†æ”¯ï¼‰ï¼Œå¦‚å›¾çº¢åœˆæ‰€ç¤ºéƒ¨ä½ï¼Œé€‰æ‹©ä½ æƒ³è¦åˆ‡æ¢çš„åˆ†æ”¯ï¼Œç„¶å checkoutï¼š</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/6678ecf9283ace1783e83e184847a29.png"></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/afbbe9a835629f522d0b02024fe2c11b.png"></p><p>æˆ–è€…åœ¨ log çª—å£ï¼Œå³é”®ç‚¹å‡»åˆ†æ”¯ï¼Œé€‰æ‹© checkoutï¼š</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/7ab6ab48e9b5a42009757b8b17b901f0.png"></p><h3 id="9-åˆå¹¶åˆ†æ”¯-æ­£å¸¸åˆå¹¶"><a href="#9-åˆå¹¶åˆ†æ”¯-æ­£å¸¸åˆå¹¶" class="headerlink" title="9. åˆå¹¶åˆ†æ”¯ (æ­£å¸¸åˆå¹¶)"></a>9. åˆå¹¶åˆ†æ”¯ (æ­£å¸¸åˆå¹¶)</h3><p>å…ˆåœ¨ hot-fix åˆ†æ”¯ä¿®æ”¹ HelloGit ç±»ï¼Œå¹¶å°†å…¶æäº¤ï¼š</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/41667203b7e067b59d1310cce4d92b15.png"></p><p>ç„¶ååˆ‡æ¢åˆ° master åˆ†æ”¯ï¼Œå³ä¸‹è§’çš„ hot-fix ä¼šå˜ä¸º masterï¼š</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/f183b86164b0e00e9d6e8c8c9a4a17da.png"></p><p>ç„¶åï¼Œç‚¹å‡» IDEA çª—å£çš„å³ä¸‹è§’çš„ masterï¼Œå°† hot-fix åˆ†æ”¯åˆå¹¶åˆ°å½“å‰ master åˆ†æ”¯ã€‚é€‰æ‹© hot-fix-&gt;Merge into Current</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/fff1d4e014223aa2cc70f0fdc237f350.png"></p><p>å¦‚æœä»£ç æ²¡æœ‰å†²çªï¼Œ åˆ†æ”¯ç›´æ¥åˆå¹¶æˆåŠŸï¼Œåˆ†æ”¯åˆå¹¶æˆåŠŸä»¥åï¼Œä»£ç è‡ªåŠ¨æäº¤ï¼Œæ— éœ€æ‰‹åŠ¨æäº¤æœ¬åœ°åº“ã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/271421c28750e86e69accd6ac687490c.png"></p><h3 id="10-åˆå¹¶åˆ†æ”¯-å†²çªåˆå¹¶"><a href="#10-åˆå¹¶åˆ†æ”¯-å†²çªåˆå¹¶" class="headerlink" title="10. åˆå¹¶åˆ†æ”¯ (å†²çªåˆå¹¶)"></a>10. åˆå¹¶åˆ†æ”¯ (å†²çªåˆå¹¶)</h3><p>åˆ†åˆ«åœ¨ masterï¼Œhot-fix åˆ†æ”¯ä¿®æ”¹ HelloGit ç±»åŒä¸€è¡Œï¼Œå¹¶æäº¤ï¼Œæ•…æ„åˆ¶ä½œå†²çªï¼š</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/53daad680bc796069dc1ce61682d4abc.png"></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/f8fcf275169cdec742d31ce85ce20d7f.png"></p><p>åˆ‡æ¢åˆ° master åˆ†æ”¯ï¼Œå°† hot-fix çš„åˆå¹¶åˆ° master åˆ†æ”¯ï¼š</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/1573ef3ec85b85c4215189d74065012.png"></p><p>å†²çªäº§ç”Ÿï¼Œéœ€è¦äººå·¥è§£å†³ï¼š</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/eb3804e00dccfa2658aa33c972d8996e.png"></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/511c531d359729b40f0850a4c9e0398.png"></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/eafebea94008b4f1f0ae15f8b2092919.png"></p><p>ä»£ç å†²çªè§£å†³ï¼Œå°†ä»£ç æäº¤æœ¬åœ°åº“åï¼Œå¦‚å›¾æ‰€ç¤ºï¼š</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/15a9058f7f35112b8605cd69aaf42e35.png"></p><h2 id="å…­ã€IDEAé›†æˆGitHub"><a href="#å…­ã€IDEAé›†æˆGitHub" class="headerlink" title="å…­ã€IDEAé›†æˆGitHub"></a>å…­ã€IDEAé›†æˆGitHub</h2><h3 id="1-è®¾ç½®-GitHub-è´¦å·"><a href="#1-è®¾ç½®-GitHub-è´¦å·" class="headerlink" title="1. è®¾ç½® GitHub è´¦å·"></a>1. è®¾ç½® GitHub è´¦å·</h3><p>åœ¨èœå•æ  File-&gt;Setting-&gt; æœç´¢æ æœ GitHubï¼Œæ·»åŠ  GitHub è´¦å·ï¼š</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/00572764f1ed257dbc2d0f668434e6a0.png"></p><p>ç”±äºç½‘ç»œé—®é¢˜ï¼Œä¼šæ—¶å¸¸ç™»é™†ä¸äº†ï¼š</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/3084475acd640b1adf621688462a1504.png"></p><p>è§£å†³æ–¹æ³•ï¼šå¯é€šè¿‡ Token ç™»é™†ã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/75ed9ef7614c18c244456c4089dfde6.png"></p><p>ç™»é™† Github ç½‘ç«™ï¼Œ<strong>è·å– Token</strong>ï¼Œæ“ä½œæ­¥éª¤çœ‹ä¸‹å›¾ï¼š</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/1d162ac7e37a01549448032011f2a62.png"></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/9b2489e068b004bee03a227760248edb.png"></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/200c556f6f0b6d44c442b58d6e8bb7ea.png"></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/81a82fb47421c0a802cd1cfad7297e43.png"></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/3f596f2f68d50d277eefe1a4e6035d2d.png"></p><p>å°†ç”Ÿæˆçš„ token ç”¨æ¥ IDEA ç™»å½•ã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/704eafd9157658a0be35b081c3530ced.png"></p><h3 id="2-åˆ†äº«é¡¹ç›®åˆ°-GitHub"><a href="#2-åˆ†äº«é¡¹ç›®åˆ°-GitHub" class="headerlink" title="2. åˆ†äº«é¡¹ç›®åˆ° GitHub"></a>2. åˆ†äº«é¡¹ç›®åˆ° GitHub</h3><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/e057d2e660c2033ef9eae0c638aee2bc.png"></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/a5ba3e09a890113b94420c3939dac239.png"></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/44b2419dd2eebc2c053fb642188e8909.png"></p><h3 id="3-æ¨é€ä»£ç åˆ°GitHubè¿œç¨‹åº“"><a href="#3-æ¨é€ä»£ç åˆ°GitHubè¿œç¨‹åº“" class="headerlink" title="3. æ¨é€ä»£ç åˆ°GitHubè¿œç¨‹åº“"></a>3. æ¨é€ä»£ç åˆ°GitHubè¿œç¨‹åº“</h3><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/84baeaa175c6faa3ff538e0313187eff.png"></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/1ee51e1ed781404a93655f1ad10bd9ca.png"></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/bb9689e1fc2e1167e68ef39f73f28af7.png"></p><p>æ³¨æ„ï¼š push æ˜¯å°†æœ¬åœ°åº“ä»£ç æ¨é€åˆ°è¿œç¨‹åº“ï¼Œå¦‚æœæœ¬åœ°åº“ä»£ç è·Ÿè¿œç¨‹åº“ä»£ç ç‰ˆæœ¬ä¸ä¸€è‡´ï¼Œpush çš„æ“ä½œæ˜¯ä¼šè¢«æ‹’ç»çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ è¦æƒ³ push æˆåŠŸï¼Œä¸€å®šè¦ä¿è¯æœ¬åœ°åº“çš„ç‰ˆæœ¬è¦æ¯”è¿œç¨‹åº“çš„ç‰ˆæœ¬é«˜ï¼ <strong>å› æ­¤ä¸€ä¸ªæˆç†Ÿçš„ç¨‹åºå‘˜åœ¨åŠ¨æ‰‹æ”¹æœ¬åœ°ä»£ç ä¹‹å‰ï¼Œä¸€å®šä¼šå…ˆæ£€æŸ¥ä¸‹è¿œç¨‹åº“è·Ÿæœ¬åœ°ä»£ç çš„åŒºåˆ«ï¼å¦‚æœæœ¬åœ°çš„ä»£ç ç‰ˆæœ¬å·²ç»è½åï¼Œåˆ‡è®°è¦å…ˆ pull æ‹‰å–ä¸€ä¸‹è¿œç¨‹åº“çš„ä»£ç ï¼Œå°†æœ¬åœ°ä»£ç æ›´æ–°åˆ°æœ€æ–°ä»¥åï¼Œç„¶åå†ä¿®æ”¹ï¼Œæäº¤ï¼Œæ¨é€ï¼</strong></p><h3 id="4-æ‹‰å–GitHubè¿œç¨‹åº“ä»£ç åˆå¹¶æœ¬åœ°åº“"><a href="#4-æ‹‰å–GitHubè¿œç¨‹åº“ä»£ç åˆå¹¶æœ¬åœ°åº“" class="headerlink" title="4. æ‹‰å–GitHubè¿œç¨‹åº“ä»£ç åˆå¹¶æœ¬åœ°åº“"></a>4. æ‹‰å–GitHubè¿œç¨‹åº“ä»£ç åˆå¹¶æœ¬åœ°åº“</h3><p>å³é”®ç‚¹å‡»é¡¹ç›®ï¼Œå¯ä»¥å°†è¿œç¨‹ä»“åº“çš„å†…å®¹ pull åˆ°æœ¬åœ°ä»“åº“ã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/193d00830bc1636e2ae2640b749b9899.png"></p><p>æ³¨æ„ï¼š pull æ˜¯æ‹‰å–è¿œç«¯ä»“åº“ä»£ç åˆ°æœ¬åœ°ï¼Œå¦‚æœè¿œç¨‹åº“ä»£ç å’Œæœ¬åœ°åº“ä»£ç ä¸ä¸€è‡´ï¼Œä¼šè‡ªåŠ¨åˆå¹¶ï¼Œå¦‚æœè‡ªåŠ¨åˆå¹¶å¤±è´¥ï¼Œè¿˜ä¼šæ¶‰åŠåˆ°æ‰‹åŠ¨è§£å†³å†²çªçš„é—®é¢˜ã€‚</p><h3 id="5-å…‹éš†ä»£ç åˆ°æœ¬åœ°"><a href="#5-å…‹éš†ä»£ç åˆ°æœ¬åœ°" class="headerlink" title="5. å…‹éš†ä»£ç åˆ°æœ¬åœ°"></a>5. å…‹éš†ä»£ç åˆ°æœ¬åœ°</h3><p>åœ¨èœå•æ çš„ File-&gt;Close Project-&gt;Get from Version Controlã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/f436b8f9156e5e5ce8c0e2b3b5fe3639.png"></p><p>æˆ–è€…åœ¨èœå•æ  VCS-&gt;Get from Version Controlã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/63f9691dd0a7627bd44a125942be7f31.png"></p><h2 id="ä¸ƒã€Giteeä½¿ç”¨"><a href="#ä¸ƒã€Giteeä½¿ç”¨" class="headerlink" title="ä¸ƒã€Giteeä½¿ç”¨"></a>ä¸ƒã€Giteeä½¿ç”¨</h2><h3 id="1-Giteeç®€ä»‹-amp-åˆ›å»ºè¿œç¨‹åº“"><a href="#1-Giteeç®€ä»‹-amp-åˆ›å»ºè¿œç¨‹åº“" class="headerlink" title="1. Giteeç®€ä»‹ &amp; åˆ›å»ºè¿œç¨‹åº“"></a>1. Giteeç®€ä»‹ &amp; åˆ›å»ºè¿œç¨‹åº“</h3><h4 id="1-1-ç äº‘ç®€ä»‹"><a href="#1-1-ç äº‘ç®€ä»‹" class="headerlink" title="1.1 ç äº‘ç®€ä»‹"></a>1.1 ç äº‘ç®€ä»‹</h4><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œ GitHub æœåŠ¡å™¨åœ¨å›½å¤–ï¼Œ ä½¿ç”¨ GitHub ä½œä¸ºé¡¹ç›®æ‰˜ç®¡ç½‘ç«™ï¼Œå¦‚æœç½‘é€Ÿä¸å¥½çš„è¯ï¼Œä¸¥é‡å½±å“ä½¿ç”¨ä½“éªŒï¼Œç”šè‡³ä¼šå‡ºç°ç™»å½•ä¸ä¸Šçš„æƒ…å†µã€‚é’ˆå¯¹è¿™ä¸ªæƒ…å†µï¼Œ å¤§å®¶ä¹Ÿå¯ä»¥ä½¿ç”¨å›½å†…çš„é¡¹ç›®æ‰˜ç®¡ç½‘ç«™ - ç äº‘ã€‚</p><p>ç äº‘æ˜¯å¼€æºä¸­å›½æ¨å‡ºçš„åŸºäº Git çš„ä»£ç æ‰˜ç®¡æœåŠ¡ä¸­å¿ƒï¼Œ ç½‘å€æ˜¯ <a href="https://gitee.com/">https://gitee.com/</a> ï¼Œä½¿ç”¨æ–¹å¼è·Ÿ GitHub ä¸€æ ·ï¼Œè€Œä¸”å®ƒè¿˜æ˜¯ä¸€ä¸ªä¸­æ–‡ç½‘ç«™ï¼Œå¦‚æœä½ è‹±æ–‡ä¸æ˜¯å¾ˆå¥½ï¼Œå®ƒæ˜¯æœ€å¥½çš„é€‰æ‹©ã€‚</p><p>è€Œä¸”ï¼ŒGiteeçš„æ“ä½œå’ŒGitHubåŸºæœ¬ä¸€æ ·ã€‚</p><h4 id="1-2-åˆ›å»ºè¿œç¨‹åº“"><a href="#1-2-åˆ›å»ºè¿œç¨‹åº“" class="headerlink" title="1.2 åˆ›å»ºè¿œç¨‹åº“"></a>1.2 åˆ›å»ºè¿œç¨‹åº“</h4><p>è·Ÿ Github çš„ç±»ä¼¼ã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/c8c01b7813e8578423ee2d790a580ee4.png"></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/16341a72fa521e904f7b5a5489d4c693.png"></p><p>å¦å¤–ï¼Œå¯ä»¥ä» GitHub ä¸ GitLab ä¸­å¯¼å…¥ä»“åº“ã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/c5daf945afdd2f2836c1e9e20e8e389b.png"></p><p>ç‚¹å‡»åˆ·æ–°æŒ‰é’®ï¼Œä»GitHubè·å–æ›´æ–°</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/3441eab01ee412c90cb4f2be908833f.png" alt="3441eab01ee412c90cb4f2be908833f"></p><h3 id="2-IDEA-é›†æˆ-Gitee-ç äº‘"><a href="#2-IDEA-é›†æˆ-Gitee-ç äº‘" class="headerlink" title="2. IDEA é›†æˆ Gitee ç äº‘"></a>2. IDEA é›†æˆ Gitee ç äº‘</h3><p>é¦–å…ˆï¼Œè¦åœ¨ IDEA å®‰è£… Gitee æ’ä»¶ã€‚</p><p>åœ¨èœå•æ é€‰ File-&gt;Settings-&gt;Pluginsï¼Œæœ Giteeã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/0241b8536ebed6fb08dcf04804c62cb0.png"></p><p>å®‰è£…æ’ä»¶æˆåŠŸåï¼Œé‡å¯ IDEAã€‚</p><p>åŠŸèƒ½è·Ÿåœ¨ IDEA çš„ Github æ’ä»¶ï¼ŒåŠŸèƒ½ç±»ä¼¼ï¼Œå¦‚æ·»åŠ  Gitee è´¦å·ç­‰ï¼Œå¯å‚è€ƒå‰æ–‡ IDEA çš„ Github æ’ä»¶ï¼Œè§¦ç±»æ—é€šã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/87e35b8ee0fd1fd4136f2b2727cbf02a.png"></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/89e7174170b4ecc1c4ba896e3f1c9ad9.png"></p><h2 id="å…«ã€GitLab"><a href="#å…«ã€GitLab" class="headerlink" title="å…«ã€GitLab"></a>å…«ã€GitLab</h2><h3 id="1-GitLabç®€ä»‹-amp-å®‰è£…ç¯å¢ƒå‡†å¤‡"><a href="#1-GitLabç®€ä»‹-amp-å®‰è£…ç¯å¢ƒå‡†å¤‡" class="headerlink" title="1. GitLabç®€ä»‹ &amp; å®‰è£…ç¯å¢ƒå‡†å¤‡"></a>1. GitLabç®€ä»‹ &amp; å®‰è£…ç¯å¢ƒå‡†å¤‡</h3><h4 id="1-1-GitLab-ç®€ä»‹"><a href="#1-1-GitLab-ç®€ä»‹" class="headerlink" title="1.1 GitLab ç®€ä»‹"></a>1.1 GitLab ç®€ä»‹</h4><p>GitLab æ˜¯ç”± GitLab Inc. å¼€å‘ï¼Œä½¿ç”¨ MIT è®¸å¯è¯çš„åŸºäºç½‘ç»œçš„ Git ä»“åº“ç®¡ç†å·¥å…·ï¼Œä¸”å…·æœ‰ wiki å’Œ issue è·Ÿè¸ªåŠŸèƒ½ã€‚ä½¿ç”¨ Git ä½œä¸ºä»£ç ç®¡ç†å·¥å…·ï¼Œå¹¶åœ¨æ­¤åŸºç¡€ä¸Šæ­å»ºèµ·æ¥çš„ web æœåŠ¡ã€‚ï¼ˆå¯æ­å»ºå±€åŸŸç½‘ Git ä»“åº“ï¼‰ã€‚</p><p>GitLab ç”±ä¹Œå…‹å…°ç¨‹åºå‘˜ DmitriyZaporozhets å’Œ ValerySizov å¼€å‘ï¼Œå®ƒä½¿ç”¨ Ruby è¯­è¨€å†™æˆã€‚åæ¥ï¼Œä¸€äº›éƒ¨åˆ†ç”¨ Go è¯­è¨€é‡å†™ã€‚æˆªæ­¢ 2018 å¹´ 5 æœˆï¼Œè¯¥å…¬å¸çº¦æœ‰ 290 åå›¢é˜Ÿæˆå‘˜ï¼Œä»¥åŠ 2000 å¤šåå¼€æºè´¡çŒ®è€…ã€‚ GitLab è¢« IBMï¼Œ Sonyï¼Œ JÃ¼lichResearchCenterï¼Œ NASAï¼Œ Alibabaï¼ŒInvinceaï¼Œ Oâ€™ReillyMediaï¼Œ Leibniz-Rechenzentrum(LRZ)ï¼Œ CERNï¼Œ SpaceX ç­‰ç»„ç»‡ä½¿ç”¨ã€‚</p><h4 id="1-2-GitLab-å®˜ç½‘åœ°å€"><a href="#1-2-GitLab-å®˜ç½‘åœ°å€" class="headerlink" title="1.2 GitLab å®˜ç½‘åœ°å€"></a>1.2 GitLab å®˜ç½‘åœ°å€</h4><p><a href="https://about.gitlab.com/">å®˜ç½‘åœ°å€</a></p><p><a href="https://about.gitlab.com/installation/">å®‰è£…è¯´æ˜</a></p><h4 id="1-3-GitLab-å®‰è£…å‡†å¤‡"><a href="#1-3-GitLab-å®‰è£…å‡†å¤‡" class="headerlink" title="1.3 GitLab å®‰è£…å‡†å¤‡"></a>1.3 GitLab å®‰è£…å‡†å¤‡</h4><ol><li> å‡†å¤‡ä¸€ä¸ªç³»ç»Ÿä¸º CentOS7 ä»¥ä¸Šç‰ˆæœ¬çš„æœåŠ¡å™¨ï¼Œ è¦æ±‚å†…å­˜ 4Gï¼Œç£ç›˜ 50Gã€‚</li><li> å…³é—­é˜²ç«å¢™ï¼Œ å¹¶ä¸”é…ç½®å¥½ä¸»æœºåå’Œ IPï¼Œä¿è¯æœåŠ¡å™¨å¯ä»¥ä¸Šç½‘ã€‚</li><li> æ­¤æ•™ç¨‹ä½¿ç”¨è™šæ‹Ÿæœºï¼šä¸»æœºåï¼š gitlab-server <code>ä¿®æ”¹/etc/hostnameæ–‡ä»¶ä¸ºgitlab-server</code>IP åœ°å€ï¼š 192.168.6.200(ä¿®æ”¹ç›¸å¯¹åº”æ–‡ä»¶)</li><li> Yum åœ¨çº¿å®‰è£… gitlab- ce æ—¶ï¼Œéœ€è¦ä¸‹è½½å‡ ç™¾ M çš„å®‰è£…æ–‡ä»¶ï¼Œéå¸¸è€—æ—¶ï¼Œæ‰€ä»¥æœ€å¥½æå‰æŠŠæ‰€éœ€ RPM åŒ…ä¸‹è½½åˆ°æœ¬åœ°ï¼Œç„¶åä½¿ç”¨ç¦»çº¿ rpm çš„æ–¹å¼å®‰è£…ã€‚<a href="https://packages.gitlab.com/gitlab/gitlab-ce/packages/el/7/gitlab-ce-13.10.2-ce.0.el7.x86_64.rpm">ä¸‹è½½åœ°å€</a>ã€‚æ³¨ï¼šèµ„æ–™é‡Œæä¾›äº†æ­¤ rpm åŒ…ï¼Œç›´æ¥å°†æ­¤åŒ…ä¸Šä¼ åˆ°æœåŠ¡å™¨ / opt/module ç›®å½•ä¸‹å³å¯ã€‚</li></ol><h3 id="2-GitLab-å®‰è£…-amp-åˆå§‹åŒ–æœåŠ¡-amp-å¯åŠ¨æœåŠ¡"><a href="#2-GitLab-å®‰è£…-amp-åˆå§‹åŒ–æœåŠ¡-amp-å¯åŠ¨æœåŠ¡" class="headerlink" title="2. GitLab å®‰è£… &amp; åˆå§‹åŒ–æœåŠ¡ &amp; å¯åŠ¨æœåŠ¡"></a>2. GitLab å®‰è£… &amp; åˆå§‹åŒ–æœåŠ¡ &amp; å¯åŠ¨æœåŠ¡</h3><h4 id="2-1-ç¼–å†™å®‰è£…è„šæœ¬"><a href="#2-1-ç¼–å†™å®‰è£…è„šæœ¬" class="headerlink" title="2.1 ç¼–å†™å®‰è£…è„šæœ¬"></a>2.1 ç¼–å†™å®‰è£…è„šæœ¬</h4><p>å®‰è£… gitlab æ­¥éª¤æ¯”è¾ƒç¹çï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å‚è€ƒ<a href="https://packages.gitlab.com/install/repositories/gitlab/gitlab-ce/script.rpm.sh">å®˜ç½‘ç¼–å†™ gitlab çš„å®‰è£…è„šæœ¬</a>ã€‚</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs vim">[root@gitlab-server module]# <span class="hljs-keyword">vim</span> gitlab-install.<span class="hljs-keyword">sh</span><br>sudo rpm -ivh /<span class="hljs-keyword">opt</span>/module/gitlab-<span class="hljs-keyword">ce</span>-<span class="hljs-number">13.10</span>.<span class="hljs-number">2</span>-<span class="hljs-keyword">ce</span>.<span class="hljs-number">0</span>.el7.x86_64.rpm<br><br>sudo yum install -<span class="hljs-keyword">y</span> curl policycoreutils-<span class="hljs-keyword">python</span> openssh-server cronie<br><br>sudo lokkit -s http -s ssh<br><br>sudo yum install -<span class="hljs-keyword">y</span> postfix<br><br>sudo service postfix start<br><br>sudo chkconfig postfix <span class="hljs-keyword">on</span><br><br>curl http<span class="hljs-variable">s:</span>//packages.gitlab.<span class="hljs-keyword">com</span>/install/repositories/gitlab/gitlabce/script.rpm.<span class="hljs-keyword">sh</span> | sudo bash<br><br>sudo EXTERNAL_URL=<span class="hljs-string">&quot;http://gitlab.example.com&quot;</span> yum -<span class="hljs-keyword">y</span> install gitlabce<br><br></code></pre></td></tr></table></figure><p>ç»™è„šæœ¬å¢åŠ æ‰§è¡Œæƒé™</p><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs tap">[root@gitlab-server module]<span class="hljs-comment"># chmod +x gitlab-install.sh</span><br>[root@gitlab-server module]<span class="hljs-comment"># ll</span><br>æ€»ç”¨é‡ 403104<br>-rw-r--r--.<span class="hljs-number"> 1 </span>root root<span class="hljs-number"> 412774002 </span>4 æœˆ<span class="hljs-number"> 7 </span>15:47 gitlab-ce-13.10.2-<br>ce.0.el7.x86_64.rpm<br>-rwxr-xr-x.<span class="hljs-number"> 1 </span>root root<span class="hljs-number"> 416 </span>4 æœˆ<span class="hljs-number"> 7 </span>15:49 gitlab-install.sh<br><br></code></pre></td></tr></table></figure><p>ç„¶åæ‰§è¡Œè¯¥è„šæœ¬ï¼Œå¼€å§‹å®‰è£… gitlab-ceã€‚æ³¨æ„ä¸€å®šè¦ä¿è¯æœåŠ¡å™¨å¯ä»¥ä¸Šç½‘ã€‚</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs clean">[root@gitlab-server <span class="hljs-keyword">module</span>]# ./gitlab-install.sh<br>è­¦å‘Šï¼š /opt/<span class="hljs-keyword">module</span>/gitlab-ce<span class="hljs-number">-13.10</span><span class="hljs-number">.2</span>-ce<span class="hljs-number">.0</span>.el7.x86_64.rpm: å¤´ V4<br>RSA/SHA1 Signature, å¯†é’¥ ID f27eab47: NOKEY<br>å‡†å¤‡ä¸­... #################################<br>[<span class="hljs-number">100</span>%]<br>æ­£åœ¨å‡çº§/å®‰è£…...<br><span class="hljs-number">1</span>:gitlab-ce<span class="hljs-number">-13.10</span><span class="hljs-number">.2</span>-ce<span class="hljs-number">.0</span>.el7<br>################################# [<span class="hljs-number">100</span>%]<br>ã€‚ ã€‚ ã€‚ ã€‚ ã€‚ ã€‚<br><br></code></pre></td></tr></table></figure><h4 id="2-2-åˆå§‹åŒ–-GitLab-æœåŠ¡"><a href="#2-2-åˆå§‹åŒ–-GitLab-æœåŠ¡" class="headerlink" title="2.2 åˆå§‹åŒ– GitLab æœåŠ¡"></a>2.2 åˆå§‹åŒ– GitLab æœåŠ¡</h4><p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤åˆå§‹åŒ– GitLab æœåŠ¡ï¼Œè¿‡ç¨‹å¤§æ¦‚éœ€è¦å‡ åˆ†é’Ÿï¼Œè€å¿ƒç­‰å¾…â€¦</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql">[root<span class="hljs-variable">@gitlab</span><span class="hljs-operator">-</span>server <span class="hljs-keyword">module</span>]# gitlab<span class="hljs-operator">-</span>ctl reconfigure<br>ã€‚ ã€‚ ã€‚ ã€‚ ã€‚ ã€‚<br><span class="hljs-keyword">Running</span> handlers:<br><span class="hljs-keyword">Running</span> handlers complete<br>Chef Client finished, <span class="hljs-number">425</span><span class="hljs-operator">/</span><span class="hljs-number">608</span> resources updated <span class="hljs-keyword">in</span> <span class="hljs-number">03</span> minutes <span class="hljs-number">08</span><br>seconds<br>gitlab Reconfigured<span class="hljs-operator">!</span><br><br></code></pre></td></tr></table></figure><h4 id="2-3-å¯åŠ¨-GitLab-æœåŠ¡"><a href="#2-3-å¯åŠ¨-GitLab-æœåŠ¡" class="headerlink" title="2.3 å¯åŠ¨ GitLab æœåŠ¡"></a>2.3 å¯åŠ¨ GitLab æœåŠ¡</h4><p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å¯åŠ¨ GitLab æœåŠ¡ï¼Œå¦‚éœ€åœæ­¢ï¼Œæ‰§è¡Œ <code>gitlab-ctl stop</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs yaml">[<span class="hljs-string">root@gitlab-server</span> <span class="hljs-string">module</span>]<span class="hljs-comment"># gitlab-ctl start</span><br><span class="hljs-attr">ok: run: alertmanager:</span> <span class="hljs-string">(pid</span> <span class="hljs-number">6812</span><span class="hljs-string">)</span> <span class="hljs-string">134s</span><br><span class="hljs-attr">ok: run: gitaly:</span> <span class="hljs-string">(pid</span> <span class="hljs-number">6740</span><span class="hljs-string">)</span> <span class="hljs-string">135s</span><br><span class="hljs-attr">ok: run: gitlab-monitor:</span> <span class="hljs-string">(pid</span> <span class="hljs-number">6765</span><span class="hljs-string">)</span> <span class="hljs-string">135s</span><br><span class="hljs-attr">ok: run: gitlab-workhorse:</span> <span class="hljs-string">(pid</span> <span class="hljs-number">6722</span><span class="hljs-string">)</span> <span class="hljs-string">136s</span><br><span class="hljs-attr">ok: run: logrotate:</span> <span class="hljs-string">(pid</span> <span class="hljs-number">5994</span><span class="hljs-string">)</span> <span class="hljs-string">197s</span><br><span class="hljs-attr">ok: run: nginx:</span> <span class="hljs-string">(pid</span> <span class="hljs-number">5930</span><span class="hljs-string">)</span> <span class="hljs-string">203s</span><br><span class="hljs-attr">ok: run: node-exporter:</span> <span class="hljs-string">(pid</span> <span class="hljs-number">6234</span><span class="hljs-string">)</span> <span class="hljs-string">185s</span><br><span class="hljs-attr">ok: run: postgres-exporter:</span> <span class="hljs-string">(pid</span> <span class="hljs-number">6834</span><span class="hljs-string">)</span> <span class="hljs-string">133s</span><br><span class="hljs-attr">ok: run: postgresql:</span> <span class="hljs-string">(pid</span> <span class="hljs-number">5456</span><span class="hljs-string">)</span> <span class="hljs-string">257s</span><br><span class="hljs-attr">ok: run: prometheus:</span> <span class="hljs-string">(pid</span> <span class="hljs-number">6777</span><span class="hljs-string">)</span> <span class="hljs-string">134s</span><br><span class="hljs-attr">ok: run: redis:</span> <span class="hljs-string">(pid</span> <span class="hljs-number">5327</span><span class="hljs-string">)</span> <span class="hljs-string">263s</span><br><span class="hljs-attr">ok: run: redis-exporter:</span> <span class="hljs-string">(pid</span> <span class="hljs-number">6391</span><span class="hljs-string">)</span> <span class="hljs-string">173s</span><br><span class="hljs-attr">ok: run: sidekiq:</span> <span class="hljs-string">(pid</span> <span class="hljs-number">5797</span><span class="hljs-string">)</span> <span class="hljs-string">215s</span><br><span class="hljs-attr">ok: run: unicorn:</span> <span class="hljs-string">(pid</span> <span class="hljs-number">5728</span><span class="hljs-string">)</span> <span class="hljs-string">221s</span><br><br></code></pre></td></tr></table></figure><h3 id="3-GitLab-ç™»å½•-amp-åˆ›å»ºè¿œç¨‹åº“"><a href="#3-GitLab-ç™»å½•-amp-åˆ›å»ºè¿œç¨‹åº“" class="headerlink" title="3. GitLab ç™»å½• &amp; åˆ›å»ºè¿œç¨‹åº“"></a>3. GitLab ç™»å½• &amp; åˆ›å»ºè¿œç¨‹åº“</h3><h4 id="3-1-ç™»å½•-GitLab"><a href="#3-1-ç™»å½•-GitLab" class="headerlink" title="3.1 ç™»å½• GitLab"></a>3.1 ç™»å½• GitLab</h4><p>ä½¿ç”¨ä¸»æœºåæˆ–è€… IP åœ°å€å³å¯è®¿é—® GitLab æœåŠ¡ã€‚å¯é…ä¸€ä¸‹ windows çš„ hosts æ–‡ä»¶ï¼ˆC:\Windows\System32\drivers\etcï¼‰ã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/048956890f1e644fb77e8d58092a8b6d.png"></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/1870c658dcabcf08fbc3b5b9fa6b2243.png"></p><p>é¦–æ¬¡ç™»é™†ä¹‹å‰ï¼Œéœ€è¦ä¿®æ”¹ä¸‹ GitLab æä¾›çš„ root è´¦æˆ·çš„å¯†ç ï¼Œè¦æ±‚ 8 ä½ä»¥ä¸Šï¼ŒåŒ…å«å¤§å°å†™å­æ¯å’Œç‰¹æ®Šç¬¦å·ã€‚</p><p>ç„¶åä½¿ç”¨ä¿®æ”¹åçš„å¯†ç ç™»å½• GitLabã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/5608650ec5e913d5ab549f30fbb477d3.png"></p><p>GitLab ç™»å½•æˆåŠŸã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/3231f6dd1a07f90326ec0506eaae747f.png"></p><h4 id="3-2-åˆ›å»ºè¿œç¨‹åº“"><a href="#3-2-åˆ›å»ºè¿œç¨‹åº“" class="headerlink" title="3.2 åˆ›å»ºè¿œç¨‹åº“"></a>3.2 åˆ›å»ºè¿œç¨‹åº“</h4><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/2ab639dfaa57cd499133c2c4cde1222a.png"></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/f135a7b76c745c3aeef9034a82c8afaf.png"></p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/5ff82d173fe047244945c8cd255a4b33.png"></p><h3 id="4-IDEA-é›†æˆ-GitLab"><a href="#4-IDEA-é›†æˆ-GitLab" class="headerlink" title="4. IDEA é›†æˆ GitLab"></a>4. IDEA é›†æˆ GitLab</h3><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/1f34175126922c56c158f466dd4d665c.png"></p><p>æ¥ä¸‹æ¥æ’ä»¶é…ç½®ï¼ŒGit æ“ä½œç­‰ä¸ Githubã€Gitee çš„ IDEA æ’ä»¶å¤§åŒå°å¼‚ï¼Œä¸å†èµ˜è¿°ï¼Œè‡ªå·±è§¦ç±»æ—é€šå§ï¼</p><h2 id="ä¹ã€GitæŠ¥é”™å¤„ç†"><a href="#ä¹ã€GitæŠ¥é”™å¤„ç†" class="headerlink" title="ä¹ã€GitæŠ¥é”™å¤„ç†"></a>ä¹ã€GitæŠ¥é”™å¤„ç†</h2><h3 id="1-SSLæŠ¥é”™"><a href="#1-SSLæŠ¥é”™" class="headerlink" title="1.SSLæŠ¥é”™"></a>1.SSLæŠ¥é”™</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">fatal: unable to access &#x27;https://github.com/.......&#x27;: OpenSSL SSL_read: Connection was reset, errno 10054<br></code></pre></td></tr></table></figure><p>äº§ç”ŸåŸå› ï¼šä¸€èˆ¬æ˜¯è¿™æ˜¯å› ä¸ºæœåŠ¡å™¨çš„SSLè¯ä¹¦æ²¡æœ‰ç»è¿‡ç¬¬ä¸‰æ–¹æœºæ„çš„ç­¾ç½²ï¼Œæ‰€ä»¥æ‰æŠ¥é”™ã€‚å‚è€ƒç½‘ä¸Šè§£å†³åŠæ³•ï¼šè§£é™¤ssléªŒè¯åï¼Œå†æ¬¡gitå³å¯ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git config --global http.sslVerify &quot;false&quot;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Git</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Git</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hexoä½¿ç”¨æ–¹æ³•</title>
    <link href="/2022/01/18/Hexo%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95/"/>
    <url>/2022/01/18/Hexo%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95/</url>
    
    <content type="html"><![CDATA[<h1 id="Hexoä½¿ç”¨æ–¹æ³•"><a href="#Hexoä½¿ç”¨æ–¹æ³•" class="headerlink" title="Hexoä½¿ç”¨æ–¹æ³•"></a>Hexoä½¿ç”¨æ–¹æ³•</h1><h2 id="ä¸€ã€æ­å»ºHexoåšå®¢"><a href="#ä¸€ã€æ­å»ºHexoåšå®¢" class="headerlink" title="ä¸€ã€æ­å»ºHexoåšå®¢"></a>ä¸€ã€æ­å»ºHexoåšå®¢</h2><h3 id="1-ä¸‹è½½Node-js"><a href="#1-ä¸‹è½½Node-js" class="headerlink" title="1. ä¸‹è½½Node.js"></a>1. ä¸‹è½½Node.js</h3><p>å»<a href="https://nodejs.org/en/">Node.jså®˜ç½‘</a>ä¸‹è½½Node.jsç¨³å®šç‰ˆæœ¬</p><h3 id="2-æ›´æ¢ä¸‹è½½cnpmå¹¶æ›´æ¢æ·˜å®æº"><a href="#2-æ›´æ¢ä¸‹è½½cnpmå¹¶æ›´æ¢æ·˜å®æº" class="headerlink" title="2. æ›´æ¢ä¸‹è½½cnpmå¹¶æ›´æ¢æ·˜å®æº"></a>2. æ›´æ¢ä¸‹è½½cnpmå¹¶æ›´æ¢æ·˜å®æº</h3><figure class="highlight shell"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><pre><code class="hljs shell">npm install -g cnpm --registry=https://registry.npm.taobao.org<br></code></pre></td></tr></table></figure><h3 id="3-Windowsç‰¹æ®Šæ“ä½œ"><a href="#3-Windowsç‰¹æ®Šæ“ä½œ" class="headerlink" title="3. Windowsç‰¹æ®Šæ“ä½œ"></a>3. Windowsç‰¹æ®Šæ“ä½œ</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">set-ExecutionPolicy RemoteSigned<br></code></pre></td></tr></table></figure><p>æ›´æ”¹ç­–ç•¥ï¼Œæ”¾è¡Œcnpm</p><h3 id="4-å®‰è£…Hexoåšå®¢æ¡†æ¶"><a href="#4-å®‰è£…Hexoåšå®¢æ¡†æ¶" class="headerlink" title="4. å®‰è£…Hexoåšå®¢æ¡†æ¶"></a>4. å®‰è£…Hexoåšå®¢æ¡†æ¶</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">cnpm install -g hexo-cli<br></code></pre></td></tr></table></figure><h3 id="5-å»ºç«‹åšå®¢æ–‡ä»¶å¤¹"><a href="#5-å»ºç«‹åšå®¢æ–‡ä»¶å¤¹" class="headerlink" title="5. å»ºç«‹åšå®¢æ–‡ä»¶å¤¹"></a>5. å»ºç«‹åšå®¢æ–‡ä»¶å¤¹</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">mkdir blog<br></code></pre></td></tr></table></figure><p><strong>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä»è¿™é‡Œå¾€ä¸‹ï¼Œæ‰€æœ‰æ­¥éª¤éƒ½æ˜¯åœ¨<code>blog</code>æ–‡ä»¶å¤¹ä¸‹çš„ã€‚</strong></p><h3 id="6-ç”ŸæˆHexoåšå®¢"><a href="#6-ç”ŸæˆHexoåšå®¢" class="headerlink" title="6. ç”ŸæˆHexoåšå®¢"></a>6. ç”ŸæˆHexoåšå®¢</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo hexo init<br></code></pre></td></tr></table></figure><h2 id="äºŒã€ä½¿ç”¨Hexo"><a href="#äºŒã€ä½¿ç”¨Hexo" class="headerlink" title="äºŒã€ä½¿ç”¨Hexo"></a>äºŒã€ä½¿ç”¨Hexo</h2><h3 id="1-æœ¬åœ°å¯åŠ¨åšå®¢"><a href="#1-æœ¬åœ°å¯åŠ¨åšå®¢" class="headerlink" title="1. æœ¬åœ°å¯åŠ¨åšå®¢"></a>1. æœ¬åœ°å¯åŠ¨åšå®¢</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hexo s<br></code></pre></td></tr></table></figure><p>hexo start</p><h3 id="2-æ–°å»ºä¸€ç¯‡æ–‡ç« "><a href="#2-æ–°å»ºä¸€ç¯‡æ–‡ç« " class="headerlink" title="2. æ–°å»ºä¸€ç¯‡æ–‡ç« "></a>2. æ–°å»ºä¸€ç¯‡æ–‡ç« </h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hexo n &quot;æ–‡ç« å&quot;<br></code></pre></td></tr></table></figure><p>ç„¶åå°±å¯ä»¥åœ¨<code>blog\source\_posts</code>è·¯å¾„ä¸‹çœ‹è§ç”Ÿæˆçš„æ–‡ç« ã€‚</p><h3 id="3-Hexo-æ¸…ç†"><a href="#3-Hexo-æ¸…ç†" class="headerlink" title="3. Hexo æ¸…ç†"></a>3. Hexo æ¸…ç†</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hexo clean<br></code></pre></td></tr></table></figure><h3 id="4-Hexo-ç”Ÿæˆ"><a href="#4-Hexo-ç”Ÿæˆ" class="headerlink" title="4. Hexo ç”Ÿæˆ"></a>4. Hexo ç”Ÿæˆ</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hexo g<br></code></pre></td></tr></table></figure><p>hexo generate</p><h3 id="5-ä¸€ç¯‡æ–‡ç« é…ç½®å¤šä¸ªåˆ†ç±»"><a href="#5-ä¸€ç¯‡æ–‡ç« é…ç½®å¤šä¸ªåˆ†ç±»" class="headerlink" title="5. ä¸€ç¯‡æ–‡ç« é…ç½®å¤šä¸ªåˆ†ç±»"></a>5. ä¸€ç¯‡æ–‡ç« é…ç½®å¤šä¸ªåˆ†ç±»</h3><p>ä¸‹é¢çš„åˆ†ç±»ä¼šå°†è¯¥åˆ†ç« æ”¾åˆ° <code>Java/Servlet</code>è¿™ä¸ªåˆ†ç±»ä¸‹ã€‚</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs markdown">categories:<br><span class="hljs-bullet">  -</span> Java<br><span class="hljs-bullet">  -</span> Servlet<br></code></pre></td></tr></table></figure><p>åŒæ ·çš„ä½œç”¨æˆ‘ä»¬ä¹Ÿå¯ä»¥è¿™æ ·å†™ã€‚</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">categories</span>:<span class="hljs-meta"> [Java, Servlet]</span><br></code></pre></td></tr></table></figure><p>ä¸Šé¢ä¸¤ç§æ–¹æ³•æœ€ç»ˆæ•ˆæœä¸€æ ·ï¼Œéƒ½æ˜¯å°†æ–‡ç« æ”¾åœ¨äº†ä¸€ä¸ªå­åˆ†ç±»çš„ç›®å½•ä¸‹ï¼Œæ•ˆæœå¦‚å›¾ã€‚</p><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/uPic/12972816-cc5be43b9b70f040.png"> </p><p>å¦‚æœæˆ‘ä»¬çš„è¦æ±‚æ˜¯å°†æ–‡ç« åŒæ—¶åˆ†åˆ°å¤šä¸ªä¸åŒçš„åˆ†ç±»ä¸­å‘¢ï¼Œæˆ‘ä»¬åº”è¯¥è¿™æ ·ï¼š</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs markdown">categories:<br><span class="hljs-bullet">  -</span> [Java]<br><span class="hljs-bullet">  -</span> [Servlet]<br></code></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œå°±å¯ä»¥å°†ä¸Šé¢çš„æ–‡ç« åˆ†ç±»åˆ° <code>Java</code> å’Œ <code>Servlet</code> è¿™ä¸¤ä¸ªä¸åŒçš„ç›®å½•ä¸­äº†ã€‚<strong>æ­¤å¤„éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œ- ä¸ [ ä¹‹é—´æœ‰ç©ºæ ¼ã€‚</strong></p><p>æ‰©å±•ä¸€ä¸‹ï¼Œå¦‚æœæˆ‘ä»¬å°†å…¶åˆ†ç±»åˆ° <code>Java/Servlet</code> å’Œ <code>Programming</code> ä¸¤ä¸ªä¸åŒçš„ç›®å½•ä¸‹ï¼Œæˆ‘ä»¬åº”è¯¥å¦‚ä¸‹å†™ï¼š</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs markdown">categories:<br><span class="hljs-bullet">  -</span> [Java, Servlet]<br><span class="hljs-bullet">  -</span> [Programming]<br></code></pre></td></tr></table></figure><h3 id="6-ä¸€ç¯‡æ–‡ç« é…ç½®å¤šä¸ªæ ‡ç­¾"><a href="#6-ä¸€ç¯‡æ–‡ç« é…ç½®å¤šä¸ªæ ‡ç­¾" class="headerlink" title="6. ä¸€ç¯‡æ–‡ç« é…ç½®å¤šä¸ªæ ‡ç­¾"></a>6. ä¸€ç¯‡æ–‡ç« é…ç½®å¤šä¸ªæ ‡ç­¾</h3><p>é…ç½®æ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs markdown">tag:<br><span class="hljs-bullet">    -</span> å‰ç«¯<br><span class="hljs-bullet">    -</span> Hexo<br><span class="hljs-bullet">    -</span> HTML<br><span class="hljs-bullet">    -</span> JavaScript<br></code></pre></td></tr></table></figure><h2 id="ä¸‰ã€å°†åšå®¢éƒ¨ç½²åˆ°Githubä¸Š"><a href="#ä¸‰ã€å°†åšå®¢éƒ¨ç½²åˆ°Githubä¸Š" class="headerlink" title="ä¸‰ã€å°†åšå®¢éƒ¨ç½²åˆ°Githubä¸Š"></a>ä¸‰ã€å°†åšå®¢éƒ¨ç½²åˆ°Githubä¸Š</h2><p>å°†åšå®¢éƒ¨ç½²åˆ°Githubä¸Šï¼Œè¿™æ ·ä¸ç”¨å¤‡æ¡ˆä¹Ÿä¸ç”¨äº‘æœåŠ¡å™¨ï¼Œæ¯”è¾ƒæ–¹ä¾¿ã€‚</p><h3 id="1-Githubä¸Šæ–°å»ºä»“åº“"><a href="#1-Githubä¸Šæ–°å»ºä»“åº“" class="headerlink" title="1. Githubä¸Šæ–°å»ºä»“åº“"></a>1. Githubä¸Šæ–°å»ºä»“åº“</h3><p><img src="https://raw.githubusercontent.com/JYGQAQ/PicGo/master/b39cf6827134af18affb5fbc934318e.png"></p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œä»“åº“å<strong>å¿…é¡»</strong>æ˜¯<code>ç”¨æˆ·å.github.io</code>ã€‚</p><h3 id="2-å®‰è£…Gitéƒ¨ç½²æ’ä»¶"><a href="#2-å®‰è£…Gitéƒ¨ç½²æ’ä»¶" class="headerlink" title="2. å®‰è£…Gitéƒ¨ç½²æ’ä»¶"></a>2. å®‰è£…Gitéƒ¨ç½²æ’ä»¶</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">cnpm install --save hexo-deployer-git<br></code></pre></td></tr></table></figure><h3 id="3-åœ¨-config-ymlæ›´æ”¹é…ç½®"><a href="#3-åœ¨-config-ymlæ›´æ”¹é…ç½®" class="headerlink" title="3. åœ¨_config.ymlæ›´æ”¹é…ç½®"></a>3. åœ¨_config.ymlæ›´æ”¹é…ç½®</h3><p>åœ¨<code>_config.yml</code>çš„<code>deploy:</code>æ·»åŠ ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">type: git<br>repo: https://github.com/JYGQAQ/JYGQAQ.github.io<br>branch: master<br></code></pre></td></tr></table></figure><h3 id="4-Hexoéƒ¨ç½²åˆ°è¿œç«¯"><a href="#4-Hexoéƒ¨ç½²åˆ°è¿œç«¯" class="headerlink" title="4. Hexoéƒ¨ç½²åˆ°è¿œç«¯"></a>4. Hexoéƒ¨ç½²åˆ°è¿œç«¯</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hexo d<br></code></pre></td></tr></table></figure><p>deploy : éƒ¨ç½²</p><p><strong>è‹¥æ­¤å¤„å‡ºç°<code>Errorï¼š Spawn failed</code></strong></p><h4 id="è§£å†³æ–¹æ³•ä¸€ï¼š"><a href="#è§£å†³æ–¹æ³•ä¸€ï¼š" class="headerlink" title="è§£å†³æ–¹æ³•ä¸€ï¼š"></a>è§£å†³æ–¹æ³•ä¸€ï¼š</h4><p><strong>å¯ä»¥å°è¯•å°†<code>_config.yml</code>ä¸­çš„<code>repo</code>æ”¹ä¸º<code>ssh</code>æ–¹å¼</strong></p><p>åŸå› å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">gitä¸å†æ”¯æŒç”¨æˆ·åå¯†ç éªŒè¯äº†ï¼Œå…¶å®æ”¹ä¸€ä¸‹ä»“åº“åœ°å€å°±å¯ä»¥äº†ã€‚<br>åŸæ¥ç”¨çš„httpsçš„ä»“åº“ï¼Œæ”¹æˆsshçš„ä»“åº“åœ°å€å°±è¡Œäº†ã€‚<br></code></pre></td></tr></table></figure><h4 id="è§£å†³æ–¹æ³•äºŒï¼š"><a href="#è§£å†³æ–¹æ³•äºŒï¼š" class="headerlink" title="è§£å†³æ–¹æ³•äºŒï¼š"></a>è§£å†³æ–¹æ³•äºŒï¼š</h4><ol><li><p>æ‰“å¼€GitHubä¸»é¡µï¼Œç‚¹å‡»å¤´åƒæ‰¾åˆ°Settings</p></li><li><p>åœ¨å·¦è¾¹ç›®å½•æ æ‰¾åˆ°Personal access tokensï¼Œç‚¹å‡»Generate new tokenï¼ŒæŒ‰ç…§æ­¥éª¤ç”³è¯·</p></li><li><p>Scopesé‚£é‡Œå¯ä»¥å…¨é€‰</p></li><li><p>åœ¨macä¸Šæ‰“å¼€keychain accessï¼Œæœç´¢GitHubï¼Œè¾“å…¥åˆšåˆšçš„Token(éœ€è¦æ³¨æ„çš„æ˜¯tokenç”Ÿæˆåä¸€å®šè¦å¤åˆ¶ï¼Œåˆ·æ–°githubå°±å†ä¹Ÿçœ‹ä¸åˆ°äº†ï¼Œéœ€è¦é‡æ–°ç”Ÿæˆ)</p></li><li><p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤<br> <code>$ git remote add origin https://â€œåˆšåˆšå¾—åˆ°çš„Tokenâ€œ@github.com/â€œUseråâ€/â€œä»“åº“åï¼ˆXXX.github.ioï¼‰â€.git</code></p></li><li><p>ä¿®æ”¹Hexoçš„ config.ymlé…ç½®æ–‡ä»¶</p></li></ol>  <figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk">deploy:<br>  type: git<br>  repo: https:<span class="hljs-regexp">//</span><span class="hljs-string">&quot;Token&quot;</span>@github.com<span class="hljs-regexp">/â€œç”¨æˆ·åâ€/</span>â€œä»“åº“åï¼ˆXXX.github.ioï¼‰â€.git<br>  branch: master<br></code></pre></td></tr></table></figure><h3 id="5-è®¿é—®åšå®¢"><a href="#5-è®¿é—®åšå®¢" class="headerlink" title="5. è®¿é—®åšå®¢"></a>5. è®¿é—®åšå®¢</h3><p>åšå®¢çš„ç½‘å€å°±æ˜¯ä»“åº“å</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">jygqaq.github.io<br></code></pre></td></tr></table></figure><p>ç”±äºåŸŸåæ²¡æœ‰å¤§å°å†™ï¼Œæ‰€ä»¥æ˜¯å°å†™ã€‚</p><h2 id="å››ã€æ›´æ¢ä¸»é¢˜"><a href="#å››ã€æ›´æ¢ä¸»é¢˜" class="headerlink" title="å››ã€æ›´æ¢ä¸»é¢˜"></a>å››ã€æ›´æ¢ä¸»é¢˜</h2><h3 id="1-å…‹éš†ä¸»é¢˜ä»“åº“"><a href="#1-å…‹éš†ä¸»é¢˜ä»“åº“" class="headerlink" title="1. å…‹éš†ä¸»é¢˜ä»“åº“"></a>1. å…‹éš†ä¸»é¢˜ä»“åº“</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git clone git@github.com:jerryc127/hexo-theme-butterfly.git themes/butterfly<br></code></pre></td></tr></table></figure><p>æŠŠé¡¹ç›®cloneåˆ°themesç›®å½•ä¸‹çš„butterflyæ–‡ä»¶å¤¹</p><p>ä½¿ç”¨butterflyè¿˜éœ€è¦å®‰è£…ä¾èµ–</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">npm install hexo-renderer-pug hexo-renderer-stylus --save<br></code></pre></td></tr></table></figure><h3 id="2-æ›´æ”¹Hexoé…ç½®æ–‡ä»¶"><a href="#2-æ›´æ”¹Hexoé…ç½®æ–‡ä»¶" class="headerlink" title="2. æ›´æ”¹Hexoé…ç½®æ–‡ä»¶"></a>2. æ›´æ”¹Hexoé…ç½®æ–‡ä»¶</h3><p>æ›´æ”¹<code>_config.yml</code>é…ç½®æ–‡ä»¶ä¸­çš„ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">theme: butterfly<br></code></pre></td></tr></table></figure><h3 id="3-æ¸…ç†Hexo"><a href="#3-æ¸…ç†Hexo" class="headerlink" title="3. æ¸…ç†Hexo"></a>3. æ¸…ç†Hexo</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hexo clean<br></code></pre></td></tr></table></figure><h3 id="4-Hexoç”Ÿæˆ"><a href="#4-Hexoç”Ÿæˆ" class="headerlink" title="4. Hexoç”Ÿæˆ"></a>4. Hexoç”Ÿæˆ</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hexo g<br></code></pre></td></tr></table></figure><h3 id="5-Hexo-Start"><a href="#5-Hexo-Start" class="headerlink" title="5. Hexo Start"></a>5. Hexo Start</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hexo s<br></code></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä½¿ç”¨<code>fluid</code>ä¸»é¢˜ï¼Œé‚£ä¹ˆ<code>themes/fluid/_config.yml</code>æ¯”<code>themes/fluid/_config.fluid.yml</code>ä¼˜å…ˆçº§è¦é«˜ã€‚</p><h2 id="äº”ã€è¿ç§»åšå®¢"><a href="#äº”ã€è¿ç§»åšå®¢" class="headerlink" title="äº”ã€è¿ç§»åšå®¢"></a>äº”ã€è¿ç§»åšå®¢</h2><h3 id="1-é…ç½®ç¯å¢ƒ"><a href="#1-é…ç½®ç¯å¢ƒ" class="headerlink" title="1. é…ç½®ç¯å¢ƒ"></a>1. é…ç½®ç¯å¢ƒ</h3><p>æ ¹æ®æœ¬åšå®¢é‡æ–°é…ç½®ç¯å¢ƒ</p><h3 id="2-æ›´æ¢æ–‡ä»¶"><a href="#2-æ›´æ¢æ–‡ä»¶" class="headerlink" title="2. æ›´æ¢æ–‡ä»¶"></a>2. æ›´æ¢æ–‡ä»¶</h3><p>éœ€è¦è·Ÿæ¢ä»¥ä¸‹æ–‡ä»¶ï¼š</p><ul><li><code>_config.yml</code></li><li><code>package.json</code></li><li><code>scaffolds</code></li><li><code>source</code></li><li><code>theme</code></li></ul>]]></content>
    
    
    <categories>
      
      <category>Hexo</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Hexo</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
